!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("object"==typeof module&&module.exports)try{var i=require("jsdom").JSDOM,n=new i,r=n.window,s=r.navigator;module.exports=t(r,s)}catch(a){module.exports=t()}else e.pc=t(e,e.navigator)}(this,function(e,t){window=e||window,navigator=t||navigator;var i=function(){for(var e={},t=["Array","Object","Function","Date","RegExp","Float32Array"],i=0;i<t.length;i++)e["[object "+t[i]+"]"]=t[i].toLowerCase();return e}(),n={version:"1.4.3",revision:"c1a9280",config:{},common:{},apps:{},data:{},unpack:function(){console.warn("pc.unpack has been deprecated and will be removed shortly. Please update your code.")},makeArray:function(e){var t,i=[],n=e.length;for(t=0;t<n;++t)i.push(e[t]);return i},type:function(e){if(null===e)return"null";var t=typeof e;return"undefined"===t||"number"===t||"string"===t||"boolean"===t?t:i[Object.prototype.toString.call(e)]},extend:function(e,t){var i,r;for(i in t)r=t[i],"object"==n.type(r)?e[i]=n.extend({},r):"array"==n.type(r)?e[i]=n.extend([],r):e[i]=r;return e},isDefined:function(e){var t;return e!==t}};"undefined"!=typeof exports&&(exports.pc=n),function(){if("undefined"!=typeof document){var e=function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenchange",!0,!1,null),e.target.dispatchEvent(t)},t=function(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenerror",!0,!1,null),e.target.dispatchEvent(t)};document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1),document.addEventListener("webkitfullscreenerror",t,!1),document.addEventListener("mozfullscreenerror",t,!1),document.addEventListener("MSFullscreenError",t,!1),Element.prototype.mozRequestFullScreen?Element.prototype.requestFullscreen=function(){this.mozRequestFullScreen()}:Element.prototype.requestFullscreen=Element.prototype.requestFullscreen||Element.prototype.webkitRequestFullscreen||Element.prototype.msRequestFullscreen,document.exitFullscreen=document.exitFullscreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen,document.hasOwnProperty("fullscreenElement")||Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,get:function(){return document.webkitCurrentFullScreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement}}),document.hasOwnProperty("fullscreenEnabled")||Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,get:function(){return document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}})}}(),Math.log2=Math.log2||function(e){return Math.log(e)*Math.LOG2E},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(i[s]=r[s])}return i},writable:!0,configurable:!0}),function(){if("undefined"!=typeof navigator&&"undefined"!=typeof document){navigator.pointer=navigator.pointer||navigator.webkitPointer||navigator.mozPointer;var e=function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(e)},t=function(){var e=document.createEvent("CustomEvent");e.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(e)};document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("webkitpointerlocklost",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("mozpointerlocklost",e,!1),document.addEventListener("webkitpointerlockerror",t,!1),document.addEventListener("mozpointerlockerror",t,!1),Element.prototype.mozRequestPointerLock?Element.prototype.requestPointerLock=function(){this.mozRequestPointerLock()}:Element.prototype.requestPointerLock=Element.prototype.requestPointerLock||Element.prototype.webkitRequestPointerLock||Element.prototype.mozRequestPointerLock,!Element.prototype.requestPointerLock&&navigator.pointer&&(Element.prototype.requestPointerLock=function(){var i=this;document.pointerLockElement=i,navigator.pointer.lock(i,e,t)}),document.exitPointerLock=document.exitPointerLock||document.webkitExitPointerLock||document.mozExitPointerLock,document.exitPointerLock||(document.exitPointerLock=function(){navigator.pointer&&(document.pointerLockElement=null,navigator.pointer.unlock())})}}(),function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,i){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),s=window.setTimeout(function(){t(n+r)},r);return e=n+r,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),String.prototype.includes||(String.prototype.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),Object.assign(n,function(){var e=function(e,t,i,n){this.buffer=new ArrayBuffer(16),this.data=new Float32Array(this.buffer,0,4),this.data3=new Float32Array(this.buffer,0,3);var r=e&&e.length;3===r||4===r?(this.data[0]=e[0],this.data[1]=e[1],this.data[2]=e[2],this.data[3]=void 0!==e[3]?e[3]:1):(this.data[0]=e||0,this.data[1]=t||0,this.data[2]=i||0,this.data[3]=void 0!==n?n:1)};return Object.assign(e.prototype,{clone:function(){return new n.Color(this.data[0],this.data[1],this.data[2],this.data[3])},copy:function(e){var t=this.data,i=e.data;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],this},set:function(e,t,i,n){var r=this.data;return r[0]=e,r[1]=t,r[2]=i,r[3]=void 0===n?1:n,this},fromString:function(e){var t,i=parseInt(e.replace("#","0x"),16);return e.length>7?t=n.math.intToBytes32(i):(t=n.math.intToBytes24(i),t[3]=255),this.set(t[0]/255,t[1]/255,t[2]/255,t[3]/255),this},toString:function(e){var t="#"+((1<<24)+(Math.round(255*this.r)<<16)+(Math.round(255*this.g)<<8)+Math.round(255*this.b)).toString(16).slice(1);if(e===!0){var i=Math.round(255*this.a).toString(16);t+=this.a<16/255?"0"+i:i}return t}}),Object.defineProperty(e.prototype,"r",{get:function(){return this.data[0]},set:function(e){this.data[0]=e}}),Object.defineProperty(e.prototype,"g",{get:function(){return this.data[1]},set:function(e){this.data[1]=e}}),Object.defineProperty(e.prototype,"b",{get:function(){return this.data[2]},set:function(e){this.data[2]=e}}),Object.defineProperty(e.prototype,"a",{get:function(){return this.data[3]},set:function(e){this.data[3]=e}}),{Color:e}}()),n.guid=function(){return{create:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})}}}(),Object.assign(n,function(){var e=function(){this._isRunning=!1,this._a=0,this._b=0};return Object.assign(e.prototype,{start:function(){this._isRunning=!0,this._a=n.now()},stop:function(){this._isRunning=!1,this._b=n.now()},getMilliseconds:function(){return this._b-this._a}}),{Timer:e,now:window.performance&&window.performance.now&&window.performance.timing?function(){return window.performance.now()}:Date.now}}()),Object.assign(n,function(){return{hashCode:function(e){for(var t=0,i=0,n=e.length;i<n;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}}}()),Object.assign(n,function(){return{createURI:function(e){var t="";if((e.authority||e.scheme)&&(e.host||e.hostpath))throw new Error("Can't have 'scheme' or 'authority' and 'host' or 'hostpath' option");if(e.host&&e.hostpath)throw new Error("Can't have 'host' and 'hostpath' option");if(e.path&&e.hostpath)throw new Error("Can't have 'path' and 'hostpath' option");return e.scheme&&(t+=e.scheme+":"),e.authority&&(t+="//"+e.authority),e.host&&(t+=e.host),e.path&&(t+=e.path),e.hostpath&&(t+=e.hostpath),e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t},URI:function(e){var t=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,i=e.match(t);this.scheme=i[2],this.authority=i[4],this.path=i[5],this.query=i[7],this.fragment=i[9],this.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},this.getQuery=function(){var e,t,i={};return this.query&&(e=decodeURIComponent(this.query).split("&"),e.forEach(function(e,n,r){t=e.split("="),i[t[0]]=t[1]},this)),i},this.setQuery=function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(""!==t&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i]));this.query=t}}}}()),Object.assign(n,function(){var e={write:function(e){console.log(e)},open:function(){n.log.write("Powered by PlayCanvas "+n.version+" "+n.revision)},info:function(e){console.info("INFO:    "+e)},debug:function(e){console.debug("DEBUG:   "+e)},error:function(e){console.error("ERROR:   "+e)},warning:function(e){console.warn("WARNING: "+e)},alert:function(e){n.log.write("ALERT:   "+e),alert(e)},assert:function(e,t){e===!1&&n.log.write("ASSERT:  "+t)}};return{log:e}}());var r=(n.log.info,n.log.debug,n.log.warning),s=n.log.error;n.log.alert,n.log.assert;n.path=function(){return{delimiter:"/",join:function(){var e,t=arguments.length,i=arguments[0];for(e=0;e<t-1;++e){var r=arguments[e],s=arguments[e+1];if(!n.isDefined(r)||!n.isDefined(s))throw new Error("undefined argument to pc.path.join");s[0]!==n.path.delimiter?i+=r&&s&&r[r.length-1]!==n.path.delimiter&&s[0]!==n.path.delimiter?n.path.delimiter+s:s:i=s}return i},split:function(e){var t=e.split(n.path.delimiter),i=t.slice(t.length-1)[0],r=t.slice(0,t.length-1).join(n.path.delimiter);return[r,i]},getBasename:function(e){return n.path.split(e)[1]},getDirectory:function(e){var t=e.split(n.path.delimiter);return t.slice(0,t.length-1).join(n.path.delimiter)},getExtension:function(e){var t=e.split("?")[0].split(".").pop();return t!==e?"."+t:""},isRelativePath:function(e){return"/"!==e.charAt(0)&&null===e.match(/:\/\//)},extractPath:function(e){var t=".",i=e.split("/"),r=0;if(i.length>1)for(n.path.isRelativePath(e)===!1&&(t=""),r=0;r<i.length-1;++r)t+="/"+i[r];return t}}}(),n.string=function(){return{ASCII_LOWERCASE:"abcdefghijklmnopqrstuvwxyz",ASCII_UPPERCASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",ASCII_LETTERS:this.ASCII_LOWERCASE+this.ASCII_UPPERCASE,format:function(e){var t,i=0,r=n.makeArray(arguments);for(r.shift(),i=0;i<r.length;i++)t=new RegExp("\\{"+i+"\\}","gi"),e=e.replace(t,r[i]);return e},startsWith:function(e,t){return console.warn("WARNING: startsWith: Function is deprecated. Use String.startsWith instead."),e.startsWith(t)},endsWith:function(e,t){return console.warn("WARNING: endsWith: Function is deprecated. Use String.endsWith instead."),e.endsWith(t)},toBool:function(e,t){if("true"===e)return!0;if(t){if("false"===e)return!1;throw new Error("Not a boolean string")}return!1}}}(),n.debug=function(){var e=null,t=null,i=null,n=null;return{display:function(r){function s(){e=document.createElement("table"),t=document.createElement("tr"),i=document.createElement("td"),n=document.createElement("td"),e.style.cssText="position:absolute;font-family:sans-serif;font-size:12px;color:#cccccc",e.style.top="0px",e.style.left="0px",e.style.border="thin solid #cccccc",document.body.appendChild(e)}e||s(),e.innerHTML="";for(var a in r){var o=t.cloneNode(),h=i.cloneNode(),l=n.cloneNode();h.textContent=a,l.textContent=r[a],o.appendChild(h),o.appendChild(l),e.appendChild(o)}}}}(),n.events={attach:function(e){var t=n.events;return e.on=t.on,e.off=t.off,e.fire=t.fire,e.once=t.once,e.hasEvent=t.hasEvent,e._callbackActive={},e},on:function(e,t,i){return e&&"string"==typeof e&&t?(this._callbacks||(this._callbacks={}),this._callbacks[e]||(this._callbacks[e]=[]),this._callbackActive||(this._callbackActive={}),this._callbackActive[e]&&this._callbackActive[e]===this._callbacks[e]&&(this._callbackActive[e]=this._callbackActive[e].slice()),this._callbacks[e].push({callback:t,scope:i||this}),this):this},off:function(e,t,i){if(!this._callbacks)return this;if(this._callbackActive)if(e)this._callbackActive[e]&&this._callbackActive[e]===this._callbacks[e]&&(this._callbackActive[e]=this._callbackActive[e].slice());else for(var n in this._callbackActive)this._callbacks[n]&&this._callbacks[n]===this._callbackActive[n]&&(this._callbackActive[n]=this._callbackActive[n].slice());if(e)if(t){var r=this._callbacks[e];if(!r)return this;for(var s=r.length;s--;)r[s].callback===t&&(i&&r[s].scope!==i||r.splice(s,1))}else this._callbacks[e]&&delete this._callbacks[e];else this._callbacks=null;return this},fire:function(e,t,i,n,r,s,a,o,h){if(!e||!this._callbacks||!this._callbacks[e])return this;var l;this._callbackActive||(this._callbackActive={}),this._callbackActive[e]?(this._callbackActive[e]===this._callbacks[e]&&(this._callbackActive[e]=this._callbackActive[e].slice()),l=this._callbacks[e].slice()):this._callbackActive[e]=this._callbacks[e];for(var c=0;(l||this._callbackActive[e])&&c<(l||this._callbackActive[e]).length;c++){var d=(l||this._callbackActive[e])[c];if(d.callback.call(d.scope,t,i,n,r,s,a,o,h),d.callback.once){var u=this._callbacks[e].indexOf(d);u!==-1&&(this._callbackActive[e]===this._callbacks[e]&&(this._callbackActive[e]=this._callbackActive[e].slice()),this._callbacks[e].splice(u,1))}}return l||(this._callbackActive[e]=null),this},once:function(e,t,i){return t.once=!0,this.on(e,t,i),this},hasEvent:function(e){return this._callbacks&&this._callbacks[e]&&0!==this._callbacks[e].length||!1}},Object.assign(n,function(){var e=function(e){this._index={},this._key=e||null};Object.assign(e.prototype,{addItem:function(e){for(var t=e.tags._list,i=0;i<t.length;i++)this.add(t[i],e)},removeItem:function(e){for(var t=e.tags._list,i=0;i<t.length;i++)this.remove(t[i],e)},add:function(e,t){this._index[e]&&this._index[e].list.indexOf(t)!==-1||(this._index[e]||(this._index[e]={list:[]},this._key&&(this._index[e].keys={})),this._index[e].list.push(t),this._key&&(this._index[e].keys[t[this._key]]=t))},remove:function(e,t){if(this._index[e]&&(!this._key||this._index[e].keys[t[this._key]])){var i=this._index[e].indexOf(t);i!==-1&&(this._index[e].list.splice(i,1),this._key&&delete this._index[e].keys[t[this._key]],0===this._index[e].list.length&&delete this._index[e])}},find:function(e){var t,i,n,r,s,a,o,h,l=this,c={},d=[],u=function(e,t){return l._index[e].list.length-l._index[t].list.length};for(t=0;t<e.length;t++){if(s=e[t],s instanceof Array){if(0===s.length)continue;if(1!==s.length){for(h=!1,n=0;n<s.length;n++)if(!this._index[s[n]]){h=!0;break}if(h)continue;for(a=s.slice(0).sort(u),o=a.slice(1),1===o.length&&(o=o[0]),i=0;i<this._index[a[0]].list.length;i++)r=this._index[a[0]].list[i],(this._key?!c[r[this._key]]:d.indexOf(r)===-1)&&r.tags.has(o)&&(this._key&&(c[r[this._key]]=!0),d.push(r));continue}s=s[0]}if(s&&"string"==typeof s&&this._index[s])for(i=0;i<this._index[s].list.length;i++)r=this._index[s].list[i],this._key?c[r[this._key]]||(c[r[this._key]]=!0,d.push(r)):d.indexOf(r)===-1&&d.push(r)}return d}});var t=function(e){this._index={},this._list=[],this._parent=e,n.events.attach(this)};return Object.assign(t.prototype,{add:function(){var e=!1,t=this._processArguments(arguments,!0);if(!t.length)return e;for(var i=0;i<t.length;i++)this._index[t[i]]||(e=!0,this._index[t[i]]=!0,this._list.push(t[i]),this.fire("add",t[i],this._parent));return e&&this.fire("change",this._parent),e},remove:function(){var e=!1;if(!this._list.length)return e;var t=this._processArguments(arguments,!0);if(!t.length)return e;for(var i=0;i<t.length;i++)this._index[t[i]]&&(e=!0,delete this._index[t[i]],this._list.splice(this._list.indexOf(t[i]),1),this.fire("remove",t[i],this._parent));return e&&this.fire("change",this._parent),e},clear:function(){if(this._list.length){var e=this._list.slice(0);this._list=[],this._index={};for(var t=0;t<e.length;t++)this.fire("remove",e[t],this._parent);this.fire("change",this._parent)}},has:function(){return!!this._list.length&&this._has(this._processArguments(arguments))},_has:function(e){if(!this._list.length||!e.length)return!1;for(var t=0;t<e.length;t++)if(1===e[t].length){if(this._index[e[t][0]])return!0}else{for(var i=!0,n=0;n<e[t].length;n++)if(!this._index[e[t][n]]){i=!1;break}if(i)return!0}return!1},list:function(){return this._list.slice(0)},_processArguments:function(e,t){var i=[],n=[];if(!e||!e.length)return i;for(var r=0;r<e.length;r++)if(e[r]instanceof Array){t||(n=[]);for(var s=0;s<e[r].length;s++)"string"==typeof e[r][s]&&(t?i.push(e[r][s]):n.push(e[r][s]));!t&&n.length&&i.push(n)}else"string"==typeof e[r]&&(t?i.push(e[r]):i.push([e[r]]));return i}}),Object.defineProperty(t.prototype,"size",{get:function(){return this._list.length}}),{TagsCache:e,Tags:t}}()),Object.assign(n,function(){var e=function(e,t){this._constructor=e,this._pool=[],this._count=0,this._resize(t)};return Object.assign(e.prototype,{_resize:function(e){if(e>this._pool.length)for(var t=this._pool.length;t<e;t++)this._pool[t]=new this._constructor},allocate:function(){return this._count>=this._pool.length&&this._resize(2*this._pool.length),this._pool[this._count++]},freeAll:function(){this._count=0}}),{AllocatePool:e}}()),Object.assign(n,function(){var e={desktop:!1,mobile:!1,ios:!1,android:!1,windows:!1,cocoonjs:!1,xbox:!1,gamepads:!1,touch:!1},t=navigator.userAgent;return/(windows|mac os|linux|cros)/i.test(t)&&(e.desktop=!0),/xbox/i.test(t)&&(e.xbox=!0),/(windows phone|iemobile|wpdesktop)/i.test(t)?(e.desktop=!1,e.mobile=!0,e.windows=!0):/android/i.test(t)?(e.desktop=!1,e.mobile=!0,e.android=!0):/ip([ao]d|hone)/i.test(t)&&(e.desktop=!1,e.mobile=!0,e.ios=!0),navigator.isCocoonJS&&(e.cocoonjs=!0),e.touch="ontouchstart"in window,e.gamepads="getGamepads"in navigator,{platform:e}}()),n.math={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,clamp:function(e,t,i){return e>=i?i:e<=t?t:e},intToBytes24:function(e){var t,i,n;return t=e>>16&255,i=e>>8&255,n=255&e,[t,i,n]},intToBytes32:function(e){var t,i,n,r;return t=e>>24&255,i=e>>16&255,n=e>>8&255,r=255&e,[t,i,n,r]},bytesToInt24:function(e,t,i){return e.length&&(i=e[2],t=e[1],e=e[0]),e<<16|t<<8|i},bytesToInt32:function(e,t,i,n){return e.length&&(n=e[3],i=e[2],t=e[1],e=e[0]),(e<<24|t<<16|i<<8|n)>>>32},lerp:function(e,t,i){return e+(t-e)*n.math.clamp(i,0,1)},lerpAngle:function(e,t,i){return t-e>180&&(t-=360),t-e<-180&&(t+=360),n.math.lerp(e,t,n.math.clamp(i,0,1))},powerOfTwo:function(e){return 0!==e&&!(e&e-1)},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e},random:function(e,t){var i=t-e;return Math.random()*i+e},smoothstep:function(e,t,i){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))},smootherstep:function(e,t,i){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(6*i-15)+10))}},Object.assign(n,function(){var e=function(e,t){return e&&2===e.length?void(this.data=new Float32Array(e)):(this.data=new Float32Array(2),this.data[0]=e||0,void(this.data[1]=t||0))};return Object.assign(e.prototype,{add:function(e){var t=this.data,i=e.data;return t[0]+=i[0],t[1]+=i[1],this},add2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],this},clone:function(){return(new e).copy(this)},copy:function(e){var t=this.data,i=e.data;return t[0]=i[0],t[1]=i[1],this},dot:function(e){var t=this.data,i=e.data;return t[0]*i[0]+t[1]*i[1]},equals:function(e){var t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]},length:function(){var e=this.data;return Math.sqrt(e[0]*e[0]+e[1]*e[1])},lengthSq:function(){var e=this.data;return e[0]*e[0]+e[1]*e[1]},lerp:function(e,t,i){var n=e.data,r=t.data,s=this.data;return s[0]=n[0]+i*(r[0]-n[0]),s[1]=n[1]+i*(r[1]-n[1]),this},mul:function(e){var t=this.data,i=e.data;return t[0]*=i[0],t[1]*=i[1],this},mul2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]*n[0],r[1]=i[1]*n[1],this},normalize:function(){var e=this.data,t=e[0]*e[0]+e[1]*e[1];if(t>0){var i=1/Math.sqrt(t);e[0]*=i,e[1]*=i}return this},scale:function(e){var t=this.data;return t[0]*=e,t[1]*=e,this},set:function(e,t){var i=this.data;return i[0]=e,i[1]=t,this},sub:function(e){var t=this.data,i=e.data;return t[0]-=i[0],t[1]-=i[1],this},sub2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]-n[0],r[1]=i[1]-n[1],this},toString:function(){return"["+this.data[0]+", "+this.data[1]+"]"}}),Object.defineProperty(e.prototype,"x",{get:function(){return this.data[0]},set:function(e){this.data[0]=e}}),Object.defineProperty(e.prototype,"y",{get:function(){return this.data[1]},set:function(e){this.data[1]=e}}),Object.defineProperty(e,"ONE",{get:function(){var t=new e(1,1);return function(){return t}}()}),Object.defineProperty(e,"RIGHT",{get:function(){var t=new e(1,0);return function(){return t}}()}),Object.defineProperty(e,"UP",{get:function(){var t=new e(0,1);return function(){return t}}()}),Object.defineProperty(e,"ZERO",{get:function(){var t=new e(0,0);return function(){return t}}()}),{Vec2:e}}()),Object.assign(n,function(){var e=function(e,t,i){return e&&3===e.length?void(this.data=new Float32Array(e)):(this.data=new Float32Array(3),this.data[0]=e||0,this.data[1]=t||0,void(this.data[2]=i||0))};return Object.assign(e.prototype,{add:function(e){var t=this.data,i=e.data;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],this},add2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],this},clone:function(){return(new e).copy(this)},copy:function(e){var t=this.data,i=e.data;return t[0]=i[0],t[1]=i[1],t[2]=i[2],this},cross:function(e,t){var i,n,r,s,a,o,h,l,c;return i=e.data,n=t.data,r=this.data,s=i[0],a=i[1],o=i[2],h=n[0],l=n[1],c=n[2],r[0]=a*c-l*o,r[1]=o*h-c*s,r[2]=s*l-h*a,this},dot:function(e){var t=this.data,i=e.data;return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},equals:function(e){var t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]},length:function(){var e=this.data;return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(){var e=this.data;return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},lerp:function(e,t,i){var n=e.data,r=t.data,s=this.data;return s[0]=n[0]+i*(r[0]-n[0]),s[1]=n[1]+i*(r[1]-n[1]),s[2]=n[2]+i*(r[2]-n[2]),this},mul:function(e){var t=this.data,i=e.data;return t[0]*=i[0],t[1]*=i[1],t[2]*=i[2],this},mul2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]*n[0],r[1]=i[1]*n[1],r[2]=i[2]*n[2],this},normalize:function(){var e=this.data,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(t>0){var i=1/Math.sqrt(t);e[0]*=i,e[1]*=i,e[2]*=i}return this},project:function(e){var t=this.data,i=e.data,n=t[0]*i[0]+t[1]*i[1]+t[2]*i[2],r=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],s=n/r;return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,this},scale:function(e){var t=this.data;return t[0]*=e,t[1]*=e,t[2]*=e,this},set:function(e,t,i){var n=this.data;return n[0]=e,n[1]=t,n[2]=i,this},sub:function(e){var t=this.data,i=e.data;return t[0]-=i[0],t[1]-=i[1],t[2]-=i[2],this},sub2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]-n[0],r[1]=i[1]-n[1],r[2]=i[2]-n[2],this},toString:function(){return"["+this.data[0]+", "+this.data[1]+", "+this.data[2]+"]"}}),Object.defineProperty(e.prototype,"x",{get:function(){return this.data[0]},set:function(e){this.data[0]=e}}),Object.defineProperty(e.prototype,"y",{get:function(){return this.data[1]},set:function(e){this.data[1]=e}}),Object.defineProperty(e.prototype,"z",{get:function(){return this.data[2]},set:function(e){this.data[2]=e}}),Object.defineProperty(e,"BACK",{get:function(){var t=new e(0,0,1);return function(){return t}}()}),Object.defineProperty(e,"DOWN",{get:function(){var t=new e(0,(-1),0);return function(){return t}}()}),Object.defineProperty(e,"FORWARD",{get:function(){var t=new e(0,0,(-1));return function(){return t}}()}),Object.defineProperty(e,"LEFT",{get:function(){var t=new e((-1),0,0);return function(){return t}}()}),Object.defineProperty(e,"ONE",{get:function(){var t=new e(1,1,1);return function(){return t}}()}),Object.defineProperty(e,"RIGHT",{get:function(){var t=new e(1,0,0);return function(){return t}}()}),Object.defineProperty(e,"UP",{get:function(){var t=new e(0,1,0);return function(){return t}}()}),Object.defineProperty(e,"ZERO",{get:function(){var t=new e(0,0,0);return function(){return t}}()}),{Vec3:e}}()),Object.assign(n,function(){var e=function(e,t,i,n){return e&&4===e.length?void(this.data=new Float32Array(e)):(this.data=new Float32Array(4),this.data[0]=e||0,this.data[1]=t||0,this.data[2]=i||0,void(this.data[3]=n||0))};return Object.assign(e.prototype,{add:function(e){var t=this.data,i=e.data;return t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[3],this},add2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],r[3]=i[3]+n[3],this},clone:function(){return(new e).copy(this)},copy:function(e){var t=this.data,i=e.data;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],this},dot:function(e){var t=this.data,i=e.data;return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]+t[3]*i[3]},equals:function(e){var t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]},length:function(){var e=this.data;return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3])},lengthSq:function(){var e=this.data;return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]},lerp:function(e,t,i){var n=e.data,r=t.data,s=this.data;return s[0]=n[0]+i*(r[0]-n[0]),s[1]=n[1]+i*(r[1]-n[1]),s[2]=n[2]+i*(r[2]-n[2]),s[3]=n[3]+i*(r[3]-n[3]),this},mul:function(e){var t=this.data,i=e.data;return t[0]*=i[0],t[1]*=i[1],t[2]*=i[2],t[3]*=i[3],this},mul2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]*n[0],r[1]=i[1]*n[1],r[2]=i[2]*n[2],r[3]=i[3]*n[3],this},normalize:function(){var e=this.data,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3];if(t>0){var i=1/Math.sqrt(t);e[0]*=i,e[1]*=i,e[2]*=i,e[3]*=i}return this},scale:function(e){var t=this.data;return t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,this},set:function(e,t,i,n){var r=this.data;return r[0]=e,r[1]=t,r[2]=i,r[3]=n,this},sub:function(e){var t=this.data,i=e.data;return t[0]-=i[0],t[1]-=i[1],t[2]-=i[2],t[3]-=i[3],this},sub2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]-n[0],r[1]=i[1]-n[1],r[2]=i[2]-n[2],r[3]=i[3]-n[3],this},toString:function(){return"["+this.data[0]+", "+this.data[1]+", "+this.data[2]+", "+this.data[3]+"]"}}),Object.defineProperty(e.prototype,"x",{get:function(){return this.data[0]},set:function(e){this.data[0]=e}}),Object.defineProperty(e.prototype,"y",{get:function(){return this.data[1]},set:function(e){this.data[1]=e}}),Object.defineProperty(e.prototype,"z",{get:function(){return this.data[2]},set:function(e){this.data[2]=e}}),Object.defineProperty(e.prototype,"w",{get:function(){return this.data[3]},set:function(e){this.data[3]=e}}),Object.defineProperty(e,"ONE",{get:function(){var t=new e(1,1,1,1);return function(){return t}}()}),Object.defineProperty(e,"ZERO",{get:function(){var t=new e(0,0,0,0);return function(){return t}}()}),{Vec4:e}}()),Object.assign(n,function(){var e="number",t=function(t,i,n,r,s,a,o,h,l){return t&&9===t.length?void(this.data=new Float32Array(t)):(this.data=new Float32Array(9),void(typeof t===e?(this.data[0]=t,this.data[1]=i,this.data[2]=n,this.data[3]=r,this.data[4]=s,this.data[5]=a,this.data[6]=o,this.data[7]=h,this.data[8]=l):this.setIdentity()))};return Object.assign(t.prototype,{clone:function(){return(new n.Mat3).copy(this)},copy:function(e){var t=e.data,i=this.data;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],this},equals:function(e){var t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]},isIdentity:function(){var e=this.data;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&1===e[4]&&0===e[5]&&0===e[6]&&0===e[7]&&1===e[8]},setIdentity:function(){var e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,this},toString:function(){for(var e="[",t=0;t<9;t++)e+=this.data[t],e+=9!==t?", ":"";return e+="]"},transpose:function(){var e,t=this.data;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}}),Object.defineProperty(t,"IDENTITY",{get:function(){var e=new t;return function(){return e}}()}),Object.defineProperty(t,"ZERO",{get:function(){var e=new t(0,0,0,0,0,0,0,0,0);return function(){return e}}()}),{Mat3:t}}()),Object.assign(n,function(){var e="number",t=function(t,i,n,r,s,a,o,h,l,c,d,u,f,p,_,m){return t&&16===t.length?void(this.data=new Float32Array(t)):(this.data=new Float32Array(16),void(typeof t===e?(this.data[0]=t,this.data[1]=i,this.data[2]=n,this.data[3]=r,this.data[4]=s,this.data[5]=a,this.data[6]=o,this.data[7]=h,this.data[8]=l,this.data[9]=c,this.data[10]=d,this.data[11]=u,this.data[12]=f,this.data[13]=p,this.data[14]=_,this.data[15]=m):this.setIdentity()))};return Object.assign(t.prototype,{add2:function(e,t){var i=e.data,n=t.data,r=this.data;return r[0]=i[0]+n[0],r[1]=i[1]+n[1],r[2]=i[2]+n[2],r[3]=i[3]+n[3],r[4]=i[4]+n[4],r[5]=i[5]+n[5],r[6]=i[6]+n[6],r[7]=i[7]+n[7],r[8]=i[8]+n[8],r[9]=i[9]+n[9],r[10]=i[10]+n[10],r[11]=i[11]+n[11],r[12]=i[12]+n[12],r[13]=i[13]+n[13],r[14]=i[14]+n[14],r[15]=i[15]+n[15],this},add:function(e){return this.add2(this,e)},clone:function(){return(new n.Mat4).copy(this)},copy:function(e){var t=e.data,i=this.data;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],this},equals:function(e){var t=this.data,i=e.data;return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]&&t[3]===i[3]&&t[4]===i[4]&&t[5]===i[5]&&t[6]===i[6]&&t[7]===i[7]&&t[8]===i[8]&&t[9]===i[9]&&t[10]===i[10]&&t[11]===i[11]&&t[12]===i[12]&&t[13]===i[13]&&t[14]===i[14]&&t[15]===i[15]},isIdentity:function(){var e=this.data;return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},mul2:function(e,t){var i,n,r,s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E=e.data,T=t.data,S=this.data;return i=E[0],n=E[1],r=E[2],s=E[3],a=E[4],o=E[5],h=E[6],l=E[7],c=E[8],d=E[9],u=E[10],f=E[11],p=E[12],_=E[13],m=E[14],A=E[15],v=T[0],y=T[1],g=T[2],b=T[3],S[0]=i*v+a*y+c*g+p*b,S[1]=n*v+o*y+d*g+_*b,S[2]=r*v+h*y+u*g+m*b,S[3]=s*v+l*y+f*g+A*b,v=T[4],y=T[5],g=T[6],b=T[7],S[4]=i*v+a*y+c*g+p*b,S[5]=n*v+o*y+d*g+_*b,S[6]=r*v+h*y+u*g+m*b,S[7]=s*v+l*y+f*g+A*b,v=T[8],y=T[9],g=T[10],b=T[11],S[8]=i*v+a*y+c*g+p*b,S[9]=n*v+o*y+d*g+_*b,S[10]=r*v+h*y+u*g+m*b,S[11]=s*v+l*y+f*g+A*b,v=T[12],y=T[13],g=T[14],b=T[15],S[12]=i*v+a*y+c*g+p*b,S[13]=n*v+o*y+d*g+_*b,S[14]=r*v+h*y+u*g+m*b,S[15]=s*v+l*y+f*g+A*b,this},mul:function(e){return this.mul2(this,e)},transformPoint:function(e,t){var i,r,s,a=this.data,o=e.data;return t=void 0===t?new n.Vec3:t,i=o[0]*a[0]+o[1]*a[4]+o[2]*a[8]+a[12],r=o[0]*a[1]+o[1]*a[5]+o[2]*a[9]+a[13],s=o[0]*a[2]+o[1]*a[6]+o[2]*a[10]+a[14],t.set(i,r,s)},transformVector:function(e,t){var i,r,s,a=this.data,o=e.data;return t=void 0===t?new n.Vec3:t,i=o[0]*a[0]+o[1]*a[4]+o[2]*a[8],r=o[0]*a[1]+o[1]*a[5]+o[2]*a[9],s=o[0]*a[2]+o[1]*a[6]+o[2]*a[10],t.set(i,r,s)},transformVec4:function(e,t){var i,r,s,a,o=this.data,h=e.data;return t=void 0===t?new n.Vec4:t,i=h[0]*o[0]+h[1]*o[4]+h[2]*o[8]+h[3]*o[12],r=h[0]*o[1]+h[1]*o[5]+h[2]*o[9]+h[3]*o[13],s=h[0]*o[2]+h[1]*o[6]+h[2]*o[10]+h[3]*o[14],a=h[0]*o[3]+h[1]*o[7]+h[2]*o[11]+h[3]*o[15],t.set(i,r,s,a)},setLookAt:function(){var e,t,i;return e=new n.Vec3,t=new n.Vec3,i=new n.Vec3,function(n,r,s){i.sub2(n,r).normalize(),
t.copy(s).normalize(),e.cross(t,i).normalize(),t.cross(i,e);var a=this.data;return a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=0,a[4]=t.x,a[5]=t.y,a[6]=t.z,a[7]=0,a[8]=i.x,a[9]=i.y,a[10]=i.z,a[11]=0,a[12]=n.x,a[13]=n.y,a[14]=n.z,a[15]=1,this}}(),setFrustum:function(e,t,i,n,r,s){var a,o,h,l,c;return a=2*r,o=t-e,h=n-i,l=s-r,c=this.data,c[0]=a/o,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a/h,c[6]=0,c[7]=0,c[8]=(t+e)/o,c[9]=(n+i)/h,c[10]=(-s-r)/l,c[11]=-1,c[12]=0,c[13]=0,c[14]=-a*s/l,c[15]=0,this},setPerspective:function(e,t,i,n,r){var s,a;return r?(s=i*Math.tan(e*Math.PI/360),a=s/t):(a=i*Math.tan(e*Math.PI/360),s=a*t),this.setFrustum(-s,s,-a,a,i,n)},setOrtho:function(e,t,i,n,r,s){var a=this.data;return a[0]=2/(t-e),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(n-i),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/(s-r),a[11]=0,a[12]=-(t+e)/(t-e),a[13]=-(n+i)/(n-i),a[14]=-(s+r)/(s-r),a[15]=1,this},setFromAxisAngle:function(e,t){var i,r,s,a,o,h,l,c,d;return t*=n.math.DEG_TO_RAD,i=e.x,r=e.y,s=e.z,a=Math.cos(t),o=Math.sin(t),h=1-a,l=h*i,c=h*r,d=this.data,d[0]=l*i+a,d[1]=l*r+o*s,d[2]=l*s-o*r,d[3]=0,d[4]=l*r-o*s,d[5]=c*r+a,d[6]=c*s+o*i,d[7]=0,d[8]=l*s+o*r,d[9]=c*s-i*o,d[10]=h*s*s+a,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1,this},setTranslate:function(e,t,i){var n=this.data;return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=t,n[14]=i,n[15]=1,this},setScale:function(e,t,i){var n=this.data;return n[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},invert:function(){var e,t,i,n,r,s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T,S,w,C,M,P,I,R;return R=this.data,e=R[0],t=R[1],i=R[2],n=R[3],r=R[4],s=R[5],a=R[6],o=R[7],h=R[8],l=R[9],c=R[10],d=R[11],u=R[12],f=R[13],p=R[14],_=R[15],m=e*s-t*r,A=e*a-i*r,v=e*o-n*r,y=t*a-i*s,g=t*o-n*s,b=i*o-n*a,E=h*f-l*u,T=h*p-c*u,S=h*_-d*u,w=l*p-c*f,C=l*_-d*f,M=c*_-d*p,P=m*M-A*C+v*w+y*S-g*T+b*E,0===P?this.setIdentity():(I=1/P,R[0]=(s*M-a*C+o*w)*I,R[1]=(-t*M+i*C-n*w)*I,R[2]=(f*b-p*g+_*y)*I,R[3]=(-l*b+c*g-d*y)*I,R[4]=(-r*M+a*S-o*T)*I,R[5]=(e*M-i*S+n*T)*I,R[6]=(-u*b+p*v-_*A)*I,R[7]=(h*b-c*v+d*A)*I,R[8]=(r*C-s*S+o*E)*I,R[9]=(-e*C+t*S-n*E)*I,R[10]=(u*g-f*v+_*m)*I,R[11]=(-h*g+l*v-d*m)*I,R[12]=(-r*w+s*T-a*E)*I,R[13]=(e*w-t*T+i*E)*I,R[14]=(-u*y+f*A-p*m)*I,R[15]=(h*y-l*A+c*m)*I),this},set:function(e){var t=this.data;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},setIdentity:function(){var e=this.data;return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},setTRS:function(e,t,i){var n,r,s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T,S,w;return n=e.x,r=e.y,s=e.z,a=t.x,o=t.y,h=t.z,l=t.w,c=i.x,d=i.y,u=i.z,f=a+a,p=o+o,_=h+h,m=a*f,A=a*p,v=a*_,y=o*p,g=o*_,b=h*_,E=l*f,T=l*p,S=l*_,w=this.data,w[0]=(1-(y+b))*c,w[1]=(A+S)*c,w[2]=(v-T)*c,w[3]=0,w[4]=(A-S)*d,w[5]=(1-(m+b))*d,w[6]=(g+E)*d,w[7]=0,w[8]=(v+T)*u,w[9]=(g-E)*u,w[10]=(1-(m+y))*u,w[11]=0,w[12]=n,w[13]=r,w[14]=s,w[15]=1,this},transpose:function(){var e,t=this.data;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},invertTo3x3:function(e){var t,i,n,r,s,a,o,h,l,c,d,u,f;c=this.data,d=e.data;var p=c[0],_=c[1],m=c[2],A=c[4],v=c[5],y=c[6],g=c[8],b=c[9],E=c[10];return t=E*v-y*b,i=-E*_+m*b,n=y*_-m*v,r=-E*A+y*g,s=E*p-m*g,a=-y*p+m*A,o=b*A-v*g,h=-b*p+_*g,l=v*p-_*A,u=p*t+_*r+m*o,0===u?this:(f=1/u,d[0]=f*t,d[1]=f*i,d[2]=f*n,d[3]=f*r,d[4]=f*s,d[5]=f*a,d[6]=f*o,d[7]=f*h,d[8]=f*l,this)},getTranslation:function(e){return e=void 0===e?new n.Vec3:e,e.set(this.data[12],this.data[13],this.data[14])},getX:function(e){return e=void 0===e?new n.Vec3:e,e.set(this.data[0],this.data[1],this.data[2])},getY:function(e){return e=void 0===e?new n.Vec3:e,e.set(this.data[4],this.data[5],this.data[6])},getZ:function(e){return e=void 0===e?new n.Vec3:e,e.set(this.data[8],this.data[9],this.data[10])},getScale:function(){var e,t,i;return e=new n.Vec3,t=new n.Vec3,i=new n.Vec3,function(r){return r=void 0===r?new n.Vec3:r,this.getX(e),this.getY(t),this.getZ(i),r.set(e.length(),t.length(),i.length()),r}}(),setFromEulerAngles:function(e,t,i){var r,s,a,o,h,l,c;return e*=n.math.DEG_TO_RAD,t*=n.math.DEG_TO_RAD,i*=n.math.DEG_TO_RAD,r=Math.sin(-e),s=Math.cos(-e),a=Math.sin(-t),o=Math.cos(-t),h=Math.sin(-i),l=Math.cos(-i),c=this.data,c[0]=o*l,c[1]=-o*h,c[2]=a,c[3]=0,c[4]=s*h+l*r*a,c[5]=s*l-r*a*h,c[6]=-o*r,c[7]=0,c[8]=r*h-s*l*a,c[9]=l*r+s*a*h,c[10]=s*o,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,this},getEulerAngles:function(){var e=new n.Vec3;return function(t){var i,r,s,a,o,h,l,c;return t=void 0===t?new n.Vec3:t,this.getScale(e),a=e.x,o=e.y,h=e.z,l=this.data,r=Math.asin(-l[2]/a),c=.5*Math.PI,r<c?r>-c?(i=Math.atan2(l[6]/o,l[10]/h),s=Math.atan2(l[1]/a,l[0]/a)):(s=0,i=-Math.atan2(l[4]/o,l[5]/o)):(s=0,i=Math.atan2(l[4]/o,l[5]/o)),t.set(i,r,s).scale(n.math.RAD_TO_DEG)}}(),toString:function(){var e,t;for(t="[",e=0;e<16;e+=1)t+=this.data[e],t+=15!==e?", ":"";return t+="]"}}),Object.defineProperty(t,"IDENTITY",{get:function(){var e=new t;return function(){return e}}()}),Object.defineProperty(t,"ZERO",{get:function(){var e=new t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return function(){return e}}()}),{Mat4:t}}()),Object.assign(n,function(){var e=function(e,t,i,n){e&&4===e.length?(this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3]):(this.x=void 0===e?0:e,this.y=void 0===t?0:t,this.z=void 0===i?0:i,this.w=void 0===n?1:n)};return Object.assign(e.prototype,{clone:function(){return new n.Quat(this.x,this.y,this.z,this.w)},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},getAxisAngle:function(e){var t=2*Math.acos(this.w),i=Math.sin(t/2);return 0!==i?(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i,(e.x<0||e.y<0||e.z<0)&&(e.x*=-1,e.y*=-1,e.z*=-1,t*=-1)):(e.x=1,e.y=0,e.z=0),t*n.math.RAD_TO_DEG},getEulerAngles:function(e){var t,i,r,s,a,o,h,l;return e=void 0===e?new n.Vec3:e,s=this.x,a=this.y,o=this.z,h=this.w,l=2*(h*a-s*o),l<=-.99999?(t=2*Math.atan2(s,h),i=-Math.PI/2,r=0):l>=.99999?(t=2*Math.atan2(s,h),i=Math.PI/2,r=0):(t=Math.atan2(2*(h*s+a*o),1-2*(s*s+a*a)),i=Math.asin(l),r=Math.atan2(2*(h*o+s*a),1-2*(a*a+o*o))),e.set(t,i,r).scale(n.math.RAD_TO_DEG)},invert:function(){return this.conjugate().normalize()},length:function(){var e,t,i,n;return e=this.x,t=this.y,i=this.z,n=this.w,Math.sqrt(e*e+t*t+i*i+n*n)},lengthSq:function(){var e,t,i,n;return e*e+t*t+i*i+n*n},mul:function(e){var t,i,n,r,s,a,o,h;return t=this.x,i=this.y,n=this.z,r=this.w,s=e.x,a=e.y,o=e.z,h=e.w,this.x=r*s+t*h+i*o-n*a,this.y=r*a+i*h+n*s-t*o,this.z=r*o+n*h+t*a-i*s,this.w=r*h-t*s-i*a-n*o,this},mul2:function(e,t){var i,n,r,s,a,o,h,l;return i=e.x,n=e.y,r=e.z,s=e.w,a=t.x,o=t.y,h=t.z,l=t.w,this.x=s*a+i*l+n*h-r*o,this.y=s*o+n*l+r*a-i*h,this.z=s*h+r*l+i*o-n*a,this.w=s*l-i*a-n*o-r*h,this},normalize:function(){var e=this.length();return 0===e?(this.x=this.y=this.z=0,this.w=1):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this},set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setFromAxisAngle:function(e,t){var i,r;return t*=.5*n.math.DEG_TO_RAD,i=Math.sin(t),r=Math.cos(t),this.x=i*e.x,this.y=i*e.y,this.z=i*e.z,this.w=r,this},setFromEulerAngles:function(e,t,i){var r,s,a,o,h,l,c;return c=.5*n.math.DEG_TO_RAD,e*=c,t*=c,i*=c,r=Math.sin(e),s=Math.cos(e),a=Math.sin(t),o=Math.cos(t),h=Math.sin(i),l=Math.cos(i),this.x=r*o*l-s*a*h,this.y=s*a*l+r*o*h,this.z=s*o*h-r*a*l,this.w=s*o*l+r*a*h,this},setFromMat4:function(e){var t,i,n,r,s,a,o,h,l,c,d,u,f,p,_;return e=e.data,t=e[0],i=e[1],n=e[2],r=e[4],s=e[5],a=e[6],o=e[8],h=e[9],l=e[10],f=1/Math.sqrt(t*t+i*i+n*n),p=1/Math.sqrt(r*r+s*s+a*a),_=1/Math.sqrt(o*o+h*h+l*l),t*=f,i*=f,n*=f,r*=p,s*=p,a*=p,o*=_,h*=_,l*=_,c=t+s+l,c>=0?(d=Math.sqrt(c+1),this.w=.5*d,d=.5/d,this.x=(a-h)*d,this.y=(o-n)*d,this.z=(i-r)*d):t>s?t>l?(u=t-(s+l)+1,u=Math.sqrt(u),this.x=.5*u,u=.5/u,this.w=(a-h)*u,this.y=(i+r)*u,this.z=(n+o)*u):(u=l-(t+s)+1,u=Math.sqrt(u),this.z=.5*u,u=.5/u,this.w=(i-r)*u,this.x=(o+n)*u,this.y=(h+a)*u):s>l?(u=s-(l+t)+1,u=Math.sqrt(u),this.y=.5*u,u=.5/u,this.w=(o-n)*u,this.z=(a+h)*u,this.x=(r+i)*u):(u=l-(t+s)+1,u=Math.sqrt(u),this.z=.5*u,u=.5/u,this.w=(i-r)*u,this.x=(o+n)*u,this.y=(h+a)*u),this},slerp:function(e,t,i){var n,r,s,a,o,h,l,c;n=e.x,r=e.y,s=e.z,a=e.w,o=t.x,h=t.y,l=t.z,c=t.w;var d=a*c+n*o+r*h+s*l;if(d<0&&(c=-c,o=-o,h=-h,l=-l,d=-d),Math.abs(d)>=1)return this.w=a,this.x=n,this.y=r,this.z=s,this;var u=Math.acos(d),f=Math.sqrt(1-d*d);if(Math.abs(f)<.001)return this.w=.5*a+.5*c,this.x=.5*n+.5*o,this.y=.5*r+.5*h,this.z=.5*s+.5*l,this;var p=Math.sin((1-i)*u)/f,_=Math.sin(i*u)/f;return this.w=a*p+c*_,this.x=n*p+o*_,this.y=r*p+h*_,this.z=s*p+l*_,this},transformVector:function(e,t){void 0===t&&(t=new n.Vec3);var i=e.x,r=e.y,s=e.z,a=this.x,o=this.y,h=this.z,l=this.w,c=l*i+o*s-h*r,d=l*r+h*i-a*s,u=l*s+a*r-o*i,f=-a*i-o*r-h*s;return t.x=c*l+f*-a+d*-h-u*-o,t.y=d*l+f*-o+u*-a-c*-h,t.z=u*l+f*-h+c*-o-d*-a,t},toString:function(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}}),Object.defineProperty(e,"IDENTITY",{get:function(){var t=new e;return function(){return t}}()}),Object.defineProperty(e,"ZERO",{get:function(){var t=new e(0,0,0,0);return function(){return t}}()}),{Quat:e}}()),Object.assign(n,function(){var e=0,t=1,i=2,r=3,s=function(e){if(this.keys=[],this.type=t,this.tension=.5,e)for(var i=0;i<e.length-1;i+=2)this.keys.push([e[i],e[i+1]]);this.sort()};return Object.assign(s.prototype,{add:function(e,t){for(var i=this.keys,n=i.length,r=0;r<n&&!(i[r][0]>e);r++);var s=[e,t];return this.keys.splice(r,0,s),s},get:function(e){return this.keys[e]},sort:function(){this.keys.sort(function(e,t){return e[0]-t[0]})},value:function(e){var s,a,o=this.keys;if(!o.length)return 0;if(e<o[0][0])return o[0][1];if(e>o[o.length-1][0])return o[o.length-1][1];var h=0,l=o.length?o[0][1]:0,c=1,d=0;for(s=0,a=o.length;s<a;s++){if(o[s][0]===e)return o[s][1];if(d=o[s][1],e<o[s][0]){c=o[s][0];break}h=o[s][0],l=o[s][1]}var u=c-h,f=0===u?0:(e-h)/u;if(this.type===t)f*=f*(3-2*f);else if(this.type===i||this.type===r){var p=l,_=d,m=p+(p-_),A=_+(_-p),v=c-h,y=v,g=v;return s>0&&s--,s>0&&(m=o[s-1][1],y=o[s][0]-o[s-1][0]),o.length>s+1&&(v=o[s+1][0]-o[s][0]),o.length>s+2&&(g=o[s+2][0]-o[s+1][0],A=o[s+2][1]),m=p+(m-p)*v/y,A=_+(A-_)*v/g,this.type===i?this._interpolateCatmullRom(m,p,_,A,f):this._interpolateCardinal(m,p,_,A,f,this.tension)}return n.math.lerp(l,d,f)},_interpolateHermite:function(e,t,i,n,r){var s=r*r,a=r*r*r,o=2*a-3*s+1,h=-2*a+3*s,l=a-2*s+r,c=a-s;return e*o+t*h+i*l+n*c},_interpolateCardinal:function(e,t,i,n,r,s){var a=s*(i-e),o=s*(n-t);return this._interpolateHermite(t,i,a,o,r)},_interpolateCatmullRom:function(e,t,i,n,r){return this._interpolateCardinal(e,t,i,n,r,.5)},closest:function(e){for(var t=this.keys,i=t.length,n=2,r=null,s=0;s<i;s++){var a=Math.abs(e-t[s][0]);if(!(n>=a))break;n=a,r=t[s]}return r},clone:function(){var e=new n.Curve;return e.keys=n.extend(e.keys,this.keys),e.type=this.type,e},quantize:function(e){e=Math.max(e,2);for(var t=new Float32Array(e),i=1/(e-1),n=0;n<e;n++){var r=this.value(i*n);t[n]=r}return t}}),Object.defineProperty(s.prototype,"length",{get:function(){return this.keys.length}}),{Curve:s,CURVE_LINEAR:e,CURVE_SMOOTHSTEP:t,CURVE_CATMULL:i,CURVE_CARDINAL:r}}()),Object.assign(n,function(){var e=function(){var e;if(this.curves=[],this._type=n.CURVE_SMOOTHSTEP,arguments.length>1)for(e=0;e<arguments.length;e++)this.curves.push(new n.Curve(arguments[e]));else if(0===arguments.length)this.curves.push(new n.Curve);else{var t=arguments[0];if("number"===n.type(t))for(e=0;e<t;e++)this.curves.push(new n.Curve);else for(e=0;e<t.length;e++)this.curves.push(new n.Curve(t[e]))}};return Object.assign(e.prototype,{get:function(e){return this.curves[e]},value:function(e,t){var i=this.curves.length;t=t||[],t.length=i;for(var n=0;n<i;n++)t[n]=this.curves[n].value(e);return t},clone:function(){var e=new n.CurveSet;e.curves=[];for(var t=0;t<this.curves.length;t++)e.curves.push(this.curves[t].clone());return e._type=this._type,e},quantize:function(e){e=Math.max(e,2);for(var t=this.curves.length,i=new Float32Array(e*t),n=1/(e-1),r=[],s=0;s<e;s++){var a=this.value(n*s,r);if(1==t)i[s]=a[0];else for(var o=0;o<t;o++)i[s*t+o]=a[o]}return i}}),Object.defineProperty(e.prototype,"length",{get:function(){return this.curves.length}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e;for(var t=0;t<this.curves.length;t++)this.curves[t].type=e}}),{CurveSet:e}}()),Object.assign(n,function(){var e=new n.Vec3,t=new n.Vec3,i=new n.Vec3,r=new n.Vec3,s=new n.Vec3,a=function(e,t){this.center=e||new n.Vec3(0,0,0),this.halfExtents=t||new n.Vec3(.5,.5,.5),this._min=new n.Vec3,this._max=new n.Vec3};return Object.assign(a.prototype,{add:function(e){var t=this.center.data,i=t[0],n=t[1],r=t[2],s=this.halfExtents.data,a=s[0],o=s[1],h=s[2],l=i-a,c=i+a,d=n-o,u=n+o,f=r-h,p=r+h,_=e.center.data,m=_[0],A=_[1],v=_[2],y=e.halfExtents.data,g=y[0],b=y[1],E=y[2],T=m-g,S=m+g,w=A-b,C=A+b,M=v-E,P=v+E;T<l&&(l=T),S>c&&(c=S),w<d&&(d=w),C>u&&(u=C),M<f&&(f=M),P>p&&(p=P),t[0]=.5*(l+c),t[1]=.5*(d+u),t[2]=.5*(f+p),s[0]=.5*(c-l),s[1]=.5*(u-d),s[2]=.5*(p-f)},copy:function(e){this.center.copy(e.center),this.halfExtents.copy(e.halfExtents),this.type=e.type},clone:function(){return new n.BoundingBox(this.center.clone(),this.halfExtents.clone())},intersects:function(e){var t=this.getMax(),i=this.getMin(),n=e.getMax(),r=e.getMin();return i.x<=n.x&&t.x>=r.x&&i.y<=n.y&&t.y>=r.y&&i.z<=n.z&&t.z>=r.z},_intersectsRay:function(n,s){for(var a=e.copy(this.getMin()).sub(n.origin).data,o=t.copy(this.getMax()).sub(n.origin).data,h=n.direction.data,l=0;l<3;l++)0===h[l]?(a[l]=a[l]<0?-Number.MAX_VALUE:Number.MAX_VALUE,o[l]=o[l]<0?-Number.MAX_VALUE:Number.MAX_VALUE):(a[l]/=h[l],o[l]/=h[l]);var c=i.set(Math.min(a[0],o[0]),Math.min(a[1],o[1]),Math.min(a[2],o[2])).data,d=r.set(Math.max(a[0],o[0]),Math.max(a[1],o[1]),Math.max(a[2],o[2])).data,u=Math.min(Math.min(d[0],d[1]),d[2]),f=Math.max(Math.max(c[0],c[1]),c[2]),p=u>=f&&f>=0;return p&&s.copy(n.direction).scale(f).add(n.origin),p},_fastIntersectsRay:function(n){var a=e,o=t,h=i,l=r,c=s,d=n.direction;return a.sub2(n.origin,this.center),l.set(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z)),h.mul2(a,d),!(l.x>this.halfExtents.x&&h.x>=0)&&(!(l.y>this.halfExtents.y&&h.y>=0)&&(!(l.z>this.halfExtents.z&&h.z>=0)&&(c.set(Math.abs(d.x),Math.abs(d.y),Math.abs(d.z)),o.cross(d,a),o.set(Math.abs(o.x),Math.abs(o.y),Math.abs(o.z)),!(o.x>this.halfExtents.y*c.z+this.halfExtents.z*c.y)&&(!(o.y>this.halfExtents.x*c.z+this.halfExtents.z*c.x)&&!(o.z>this.halfExtents.x*c.y+this.halfExtents.y*c.x)))))},intersectsRay:function(e,t){return t?this._intersectsRay(e,t):this._fastIntersectsRay(e)},setMinMax:function(e,t){this.center.add2(t,e).scale(.5),this.halfExtents.sub2(t,e).scale(.5)},getMin:function(){return this._min.copy(this.center).sub(this.halfExtents)},getMax:function(){return this._max.copy(this.center).add(this.halfExtents)},containsPoint:function(e){var t,i=this.getMin(),n=this.getMax();for(t=0;t<3;++t)if(e.data[t]<i.data[t]||e.data[t]>n.data[t])return!1;return!0},setFromTransformedAabb:function(e,t){var i=this.center,n=this.halfExtents,r=e.center.data,s=e.halfExtents.data;t=t.data;var a=t[0],o=t[4],h=t[8],l=t[1],c=t[5],d=t[9],u=t[2],f=t[6],p=t[10],_=Math.abs(a),m=Math.abs(o),A=Math.abs(h),v=Math.abs(l),y=Math.abs(c),g=Math.abs(d),b=Math.abs(u),E=Math.abs(f),T=Math.abs(p);i.set(t[12]+a*r[0]+o*r[1]+h*r[2],t[13]+l*r[0]+c*r[1]+d*r[2],t[14]+u*r[0]+f*r[1]+p*r[2]),n.set(_*s[0]+m*s[1]+A*s[2],v*s[0]+y*s[1]+g*s[2],b*s[0]+E*s[1]+T*s[2])},compute:function(i){for(var n=e.set(i[0],i[1],i[2]),r=t.set(i[0],i[1],i[2]),s=i.length/3,a=1;a<s;a++){var o=i[3*a+0],h=i[3*a+1],l=i[3*a+2];o<n.x&&(n.x=o),h<n.y&&(n.y=h),l<n.z&&(n.z=l),o>r.x&&(r.x=o),h>r.y&&(r.y=h),l>r.z&&(r.z=l)}this.setMinMax(n,r)},intersectsBoundingSphere:function(e){var t=this._distanceToBoundingSphereSq(e);return t<=e.radius*e.radius},_distanceToBoundingSphereSq:function(e){for(var t=this.getMin(),i=this.getMax(),n=0,r=0;r<3;++r){var s=0,a=e.center.data[r],o=t.data[r],h=i.data[r],l=0;a<o&&(l=o-a,s+=l*l),a>h&&(l=a-h,s+=l*l),n+=s}return n}}),{BoundingBox:a}}()),Object.assign(n,function(){function e(e,t){this.center=e||new n.Vec3(0,0,0),this.radius=void 0===t?.5:t}var t=new n.Vec3,i=new n.Vec3,r=new n.Vec3,s=new n.Vec3;return Object.assign(e.prototype,{containsPoint:function(e){var i=t.sub2(e,this.center).lengthSq(),n=this.radius;return i<n*n},compute:function(e){var n,a=e.length/3,o=t,h=i,l=r;for(n=0;n<a;n++)o.set(e[3*n],e[3*n+1],e[3*n+2]),l.addSelf(o),n%100===0&&(l.scale(1/a),h.add(l),l.set(0,0,0));l.scale(1/a),h.add(l),this.center.copy(h);var c=0,d=s;for(n=0;n<a;n++)o.set(e[3*n],e[3*n+1],e[3*n+2]),d.sub2(o,this.center),c=Math.max(d.lengthSq(),c);this.radius=Math.sqrt(c)},intersectsRay:function(e,n){var r=t.copy(e.origin).sub(this.center),s=r.dot(i.copy(e.direction).normalize()),a=r.dot(r)-this.radius*this.radius;if(a>0&&s>0)return null;var o=s*s-a;if(o<0)return!1;var h=Math.abs(-s-Math.sqrt(o));return n&&n.copy(e.direction).scale(h).add(e.origin),!0},intersectsBoundingSphere:function(e){t.sub2(e.center,this.center);var i=e.radius+this.radius;return t.lengthSq()<=i*i}}),{BoundingSphere:e}}()),Object.assign(n,function(){var e=new n.Mat4,t=function(e,t){e=e||(new n.Mat4).setPerspective(90,16/9,.1,1e3),t=t||new n.Mat4,this.planes=[];for(var i=0;i<6;i++)this.planes[i]=[];this.update(e,t)};return Object.assign(t.prototype,{update:function(t,i){e.mul2(t,i);var n=e.data;this.planes[0][0]=n[3]-n[0],this.planes[0][1]=n[7]-n[4],this.planes[0][2]=n[11]-n[8],this.planes[0][3]=n[15]-n[12];var r=Math.sqrt(this.planes[0][0]*this.planes[0][0]+this.planes[0][1]*this.planes[0][1]+this.planes[0][2]*this.planes[0][2]);this.planes[0][0]/=r,this.planes[0][1]/=r,this.planes[0][2]/=r,this.planes[0][3]/=r,this.planes[1][0]=n[3]+n[0],this.planes[1][1]=n[7]+n[4],this.planes[1][2]=n[11]+n[8],this.planes[1][3]=n[15]+n[12],r=Math.sqrt(this.planes[1][0]*this.planes[1][0]+this.planes[1][1]*this.planes[1][1]+this.planes[1][2]*this.planes[1][2]),this.planes[1][0]/=r,this.planes[1][1]/=r,this.planes[1][2]/=r,this.planes[1][3]/=r,this.planes[2][0]=n[3]+n[1],this.planes[2][1]=n[7]+n[5],this.planes[2][2]=n[11]+n[9],this.planes[2][3]=n[15]+n[13],r=Math.sqrt(this.planes[2][0]*this.planes[2][0]+this.planes[2][1]*this.planes[2][1]+this.planes[2][2]*this.planes[2][2]),this.planes[2][0]/=r,this.planes[2][1]/=r,this.planes[2][2]/=r,this.planes[2][3]/=r,this.planes[3][0]=n[3]-n[1],this.planes[3][1]=n[7]-n[5],this.planes[3][2]=n[11]-n[9],this.planes[3][3]=n[15]-n[13],r=Math.sqrt(this.planes[3][0]*this.planes[3][0]+this.planes[3][1]*this.planes[3][1]+this.planes[3][2]*this.planes[3][2]),this.planes[3][0]/=r,this.planes[3][1]/=r,this.planes[3][2]/=r,this.planes[3][3]/=r,this.planes[4][0]=n[3]-n[2],this.planes[4][1]=n[7]-n[6],this.planes[4][2]=n[11]-n[10],this.planes[4][3]=n[15]-n[14],r=Math.sqrt(this.planes[4][0]*this.planes[4][0]+this.planes[4][1]*this.planes[4][1]+this.planes[4][2]*this.planes[4][2]),this.planes[4][0]/=r,this.planes[4][1]/=r,this.planes[4][2]/=r,this.planes[4][3]/=r,this.planes[5][0]=n[3]+n[2],this.planes[5][1]=n[7]+n[6],this.planes[5][2]=n[11]+n[10],this.planes[5][3]=n[15]+n[14],r=Math.sqrt(this.planes[5][0]*this.planes[5][0]+this.planes[5][1]*this.planes[5][1]+this.planes[5][2]*this.planes[5][2]),this.planes[5][0]/=r,this.planes[5][1]/=r,this.planes[5][2]/=r,this.planes[5][3]/=r},containsPoint:function(e){for(var t=0;t<6;t++)if(this.planes[t][0]*e.x+this.planes[t][1]*e.y+this.planes[t][2]*e.z+this.planes[t][3]<=0)return!1;return!0},containsSphere:function(e){var t,i,n,r=0,s=e.radius,a=e.center.data,o=a[0],h=a[1],l=a[2],c=this.planes;for(i=0;i<6;i++){if(n=c[i],t=n[0]*o+n[1]*h+n[2]*l+n[3],t<=-s)return 0;t>s&&r++}return 6===r?2:1}}),{Frustum:t}}()),Object.assign(n,function(){var e=new n.Vec3,t=function(e,t){this.normal=t||new n.Vec3(0,0,1),this.point=e||new n.Vec3(0,0,0)};return Object.assign(t.prototype,{intersectsLine:function(e,t,i){var n=-this.normal.dot(this.point),r=this.normal.dot(e)+n,s=this.normal.dot(t)+n,a=r/(r-s),o=a>=0&&a<=1;return o&&i&&i.lerp(e,t,a),o},intersectsRay:function(t,i){var n=e.sub2(this.point,t.origin),r=this.normal.dot(n)/this.normal.dot(t.direction),s=r>=0;return s&&i&&i.copy(t.direction).scale(r).add(t.origin),s}}),{Plane:t}}()),Object.assign(n,function(){var e=function(e,t){this.origin=e||new n.Vec3(0,0,0),this.direction=t||new n.Vec3(0,0,(-1))};return{Ray:e}}()),Object.assign(n,function(){var e=new n.Ray,t=new n.Vec3,i=new n.BoundingSphere,r=new n.Mat4,s=function(e,t){this.halfExtents=t||new n.Vec3(.5,.5,.5),e=e||r.setIdentity(),this._modelTransform=e.clone().invert(),this._aabb=new n.BoundingBox(new n.Vec3,this.halfExtents)};return Object.assign(s.prototype,{intersectsRay:function(t,i){if(this._modelTransform.transformPoint(t.origin,e.origin),this._modelTransform.transformVector(t.direction,e.direction),i){var n=this._aabb._intersectsRay(e,i);return r.copy(this._modelTransform).invert().transformPoint(i,i),n}return this._aabb._fastIntersectsRay(e)},containsPoint:function(e){return this._modelTransform.transformPoint(e,t),this._aabb.containsPoint(t)},intersectsBoundingSphere:function(e){return this._modelTransform.transformPoint(e.center,i.center),i.radius=e.radius,!!this._aabb.intersectsBoundingSphere(i)}}),Object.defineProperty(s.prototype,"worldTransform",{set:function(e){this._modelTransform.copy(e).invert()}}),{OrientedBox:s}}()),function(){var e={ADDRESS_REPEAT:0,ADDRESS_CLAMP_TO_EDGE:1,ADDRESS_MIRRORED_REPEAT:2,BLENDMODE_ZERO:0,BLENDMODE_ONE:1,BLENDMODE_SRC_COLOR:2,BLENDMODE_ONE_MINUS_SRC_COLOR:3,BLENDMODE_DST_COLOR:4,BLENDMODE_ONE_MINUS_DST_COLOR:5,BLENDMODE_SRC_ALPHA:6,BLENDMODE_SRC_ALPHA_SATURATE:7,BLENDMODE_ONE_MINUS_SRC_ALPHA:8,BLENDMODE_DST_ALPHA:9,BLENDMODE_ONE_MINUS_DST_ALPHA:10,BLENDEQUATION_ADD:0,BLENDEQUATION_SUBTRACT:1,BLENDEQUATION_REVERSE_SUBTRACT:2,BLENDEQUATION_MIN:3,BLENDEQUATION_MAX:4,BUFFER_STATIC:0,BUFFER_DYNAMIC:1,BUFFER_STREAM:2,BUFFER_GPUDYNAMIC:3,CLEARFLAG_COLOR:1,CLEARFLAG_DEPTH:2,CLEARFLAG_STENCIL:4,CUBEFACE_POSX:0,CUBEFACE_NEGX:1,CUBEFACE_POSY:2,CUBEFACE_NEGY:3,CUBEFACE_POSZ:4,CUBEFACE_NEGZ:5,CULLFACE_NONE:0,CULLFACE_BACK:1,CULLFACE_FRONT:2,CULLFACE_FRONTANDBACK:3,TYPE_INT8:0,TYPE_UINT8:1,TYPE_INT16:2,TYPE_UINT16:3,TYPE_INT32:4,TYPE_UINT32:5,TYPE_FLOAT32:6,FILTER_NEAREST:0,FILTER_LINEAR:1,FILTER_NEAREST_MIPMAP_NEAREST:2,FILTER_NEAREST_MIPMAP_LINEAR:3,FILTER_LINEAR_MIPMAP_NEAREST:4,FILTER_LINEAR_MIPMAP_LINEAR:5,FUNC_NEVER:0,FUNC_LESS:1,FUNC_EQUAL:2,FUNC_LESSEQUAL:3,FUNC_GREATER:4,FUNC_NOTEQUAL:5,FUNC_GREATEREQUAL:6,FUNC_ALWAYS:7,INDEXFORMAT_UINT8:0,INDEXFORMAT_UINT16:1,INDEXFORMAT_UINT32:2,PIXELFORMAT_A8:0,PIXELFORMAT_L8:1,PIXELFORMAT_L8_A8:2,PIXELFORMAT_R5_G6_B5:3,PIXELFORMAT_R5_G5_B5_A1:4,PIXELFORMAT_R4_G4_B4_A4:5,PIXELFORMAT_R8_G8_B8:6,PIXELFORMAT_R8_G8_B8_A8:7,PIXELFORMAT_DXT1:8,PIXELFORMAT_DXT3:9,PIXELFORMAT_DXT5:10,PIXELFORMAT_RGB16F:11,PIXELFORMAT_RGBA16F:12,PIXELFORMAT_RGB32F:13,PIXELFORMAT_RGBA32F:14,PIXELFORMAT_R32F:15,PIXELFORMAT_DEPTH:16,PIXELFORMAT_DEPTHSTENCIL:17,PIXELFORMAT_111110F:18,PIXELFORMAT_SRGB:19,PIXELFORMAT_SRGBA:20,PIXELFORMAT_ETC1:21,PIXELFORMAT_PVRTC_2BPP_RGB_1:22,PIXELFORMAT_PVRTC_2BPP_RGBA_1:23,PIXELFORMAT_PVRTC_4BPP_RGB_1:24,PIXELFORMAT_PVRTC_4BPP_RGBA_1:25,PRIMITIVE_POINTS:0,PRIMITIVE_LINES:1,PRIMITIVE_LINELOOP:2,PRIMITIVE_LINESTRIP:3,PRIMITIVE_TRIANGLES:4,PRIMITIVE_TRISTRIP:5,PRIMITIVE_TRIFAN:6,SEMANTIC_POSITION:"POSITION",SEMANTIC_NORMAL:"NORMAL",SEMANTIC_TANGENT:"TANGENT",SEMANTIC_BLENDWEIGHT:"BLENDWEIGHT",SEMANTIC_BLENDINDICES:"BLENDINDICES",SEMANTIC_COLOR:"COLOR",SEMANTIC_TEXCOORD0:"TEXCOORD0",SEMANTIC_TEXCOORD1:"TEXCOORD1",SEMANTIC_TEXCOORD2:"TEXCOORD2",SEMANTIC_TEXCOORD3:"TEXCOORD3",SEMANTIC_TEXCOORD4:"TEXCOORD4",SEMANTIC_TEXCOORD5:"TEXCOORD5",SEMANTIC_TEXCOORD6:"TEXCOORD6",SEMANTIC_TEXCOORD7:"TEXCOORD7",SEMANTIC_ATTR0:"ATTR0",SEMANTIC_ATTR1:"ATTR1",SEMANTIC_ATTR2:"ATTR2",SEMANTIC_ATTR3:"ATTR3",SEMANTIC_ATTR4:"ATTR4",SEMANTIC_ATTR5:"ATTR5",SEMANTIC_ATTR6:"ATTR6",SEMANTIC_ATTR7:"ATTR7",SEMANTIC_ATTR8:"ATTR8",SEMANTIC_ATTR9:"ATTR9",SEMANTIC_ATTR10:"ATTR10",SEMANTIC_ATTR11:"ATTR11",SEMANTIC_ATTR12:"ATTR12",SEMANTIC_ATTR13:"ATTR13",SEMANTIC_ATTR14:"ATTR14",SEMANTIC_ATTR15:"ATTR15",SHADERTAG_MATERIAL:1,STENCILOP_KEEP:0,STENCILOP_ZERO:1,STENCILOP_REPLACE:2,STENCILOP_INCREMENT:3,STENCILOP_INCREMENTWRAP:4,STENCILOP_DECREMENT:5,STENCILOP_DECREMENTWRAP:6,STENCILOP_INVERT:7,TEXTURELOCK_READ:1,TEXTURELOCK_WRITE:2,TEXHINT_NONE:0,TEXHINT_SHADOWMAP:1,TEXHINT_ASSET:2,TEXHINT_LIGHTMAP:3,UNIFORMTYPE_BOOL:0,UNIFORMTYPE_INT:1,UNIFORMTYPE_FLOAT:2,UNIFORMTYPE_VEC2:3,UNIFORMTYPE_VEC3:4,UNIFORMTYPE_VEC4:5,UNIFORMTYPE_IVEC2:6,UNIFORMTYPE_IVEC3:7,UNIFORMTYPE_IVEC4:8,UNIFORMTYPE_BVEC2:9,UNIFORMTYPE_BVEC3:10,UNIFORMTYPE_BVEC4:11,UNIFORMTYPE_MAT2:12,UNIFORMTYPE_MAT3:13,UNIFORMTYPE_MAT4:14,UNIFORMTYPE_TEXTURE2D:15,UNIFORMTYPE_TEXTURECUBE:16,UNIFORMTYPE_FLOATARRAY:17,UNIFORMTYPE_TEXTURE2D_SHADOW:18,UNIFORMTYPE_TEXTURECUBE_SHADOW:19,UNIFORMTYPE_TEXTURE3D:20};Object.assign(n,e),n.gfx={},Object.assign(n.gfx,e)}(),Object.assign(n,function(){var e=function(e){this.name=e,this.value=null,this.versionObject=new n.VersionedObject};return Object.assign(e.prototype,{setValue:function(e){this.value=e,this.versionObject.increment()},getValue:function(e){return this.value}}),{ScopeId:e}}()),Object.assign(n,function(){var e=function(e){this.name=e,this.variables={},this.namespaces={}};return Object.assign(e.prototype,{resolve:function(e){return this.variables.hasOwnProperty(e)||(this.variables[e]=new n.ScopeId(e)),this.variables[e]},getSubSpace:function(e){return this.namespaces.hasOwnProperty(e)||(this.namespaces[e]=new n.ScopeSpace(e)),this.namespaces[e]}}),{ScopeSpace:e}}()),Object.assign(n,function(){var e=function(){this.globalId=0,this.revision=0};return Object.assign(e.prototype,{equals:function(e){return this.globalId===e.globalId&&this.revision===e.revision},notequals:function(e){return this.globalId!==e.globalId||this.revision!==e.revision},copy:function(e){this.globalId=e.globalId,this.revision=e.revision},reset:function(){this.globalId=0,this.revision=0}}),{Version:e}}()),Object.assign(n,function(){var e=0,t=function(){e++,this.version=new n.Version,this.version.globalId=e};return Object.assign(t.prototype,{increment:function(){this.version.revision++}}),{VersionedObject:t}}()),Object.assign(n,function(){function e(e,a){switch(this.index=0,a.dataType){case n.TYPE_INT8:this.array=new Int8Array(e,a.offset);break;case n.TYPE_UINT8:this.array=new Uint8Array(e,a.offset);break;case n.TYPE_INT16:this.array=new Int16Array(e,a.offset);break;case n.TYPE_UINT16:this.array=new Uint16Array(e,a.offset);break;case n.TYPE_INT32:this.array=new Int32Array(e,a.offset);break;case n.TYPE_UINT32:this.array=new Uint32Array(e,a.offset);break;case n.TYPE_FLOAT32:this.array=new Float32Array(e,a.offset)}switch(a.numComponents){case 1:this.set=t;break;case 2:this.set=i;break;case 3:this.set=r;break;case 4:this.set=s}}function t(e){this.array[this.index]=e}function i(e,t){this.array[this.index]=e,this.array[this.index+1]=t}function r(e,t,i){this.array[this.index]=e,this.array[this.index+1]=t,this.array[this.index+2]=i}function s(e,t,i,n){this.array[this.index]=e,this.array[this.index+1]=t,this.array[this.index+2]=i,this.array[this.index+3]=n}function a(t){this.vertexBuffer=t,this.buffer=this.vertexBuffer.lock(),this.setters=[],this.element={};for(var i=this.vertexBuffer.getFormat(),n=0;n<i.elements.length;n++){var r=i.elements[n];this.setters[n]=new e(this.buffer,r),this.element[r.name]=this.setters[n]}}return Object.assign(a.prototype,{next:function(){for(var e=0,t=this.setters,i=this.setters.length,n=this.vertexBuffer.getFormat();e<i;){var r=t[e++];r.index+=n.size/r.array.constructor.BYTES_PER_ELEMENT}},end:function(){this.vertexBuffer.unlock()}}),{VertexIterator:a}}()),Object.assign(n,function(){var e=[];e[n.TYPE_INT8]=1,e[n.TYPE_UINT8]=1,e[n.TYPE_INT16]=2,e[n.TYPE_UINT16]=2,e[n.TYPE_INT32]=4,e[n.TYPE_UINT32]=4,e[n.TYPE_FLOAT32]=4;var t=function(t,i){var r,s,a;for(this.elements=[],this.hasUv0=!1,this.hasUv1=!1,this.hasColor=!1,this.size=0,r=0,s=i.length;r<s;r++){var o=i[r];a={name:o.semantic,offset:0,stride:0,stream:-1,scopeId:t.scope.resolve(o.semantic),dataType:o.type,numComponents:o.components,normalize:void 0!==o.normalize&&o.normalize,size:o.components*e[o.type]},this.elements.push(a),this.size+=4*Math.ceil(a.size/4),o.semantic===n.SEMANTIC_TEXCOORD0?this.hasUv0=!0:o.semantic===n.SEMANTIC_TEXCOORD1?this.hasUv1=!0:o.semantic===n.SEMANTIC_COLOR&&(this.hasColor=!0)}var h=0;for(r=0,s=this.elements.length;r<s;r++)a=this.elements[r],a.offset=h,a.stride=this.size,h+=a.size};return{VertexFormat:t}}()),Object.assign(n,function(){var e=function(e,t,i,r,s){this.usage=r||n.BUFFER_STATIC,this.format=t,this.numVertices=i,this.numBytes=t.size*i,e._vram.vb+=this.numBytes,this.device=e,s?this.setData(s):this.storage=new ArrayBuffer(this.numBytes),this.device.buffers.push(this)};return Object.assign(e.prototype,{destroy:function(){var e=this.device,t=e.buffers.indexOf(this);if(t!==-1&&e.buffers.splice(t,1),this.bufferId){var i=e.gl;i.deleteBuffer(this.bufferId),e._vram.vb-=this.storage.byteLength,this.bufferId=null,e.boundBuffer=null,e.vertexBuffers.length=0,e.vbOffsets.length=0,e.attributesInvalidated=!0;for(var n in e.enabledAttributes)i.disableVertexAttribArray(n);e.enabledAttributes={}}},getFormat:function(){return this.format},getUsage:function(){return this.usage},getNumVertices:function(){return this.numVertices},lock:function(){return this.storage},unlock:function(){var e=this.device.gl;this.bufferId||(this.bufferId=e.createBuffer());var t;switch(this.usage){case n.BUFFER_STATIC:t=e.STATIC_DRAW;break;case n.BUFFER_DYNAMIC:t=e.DYNAMIC_DRAW;break;case n.BUFFER_STREAM:t=e.STREAM_DRAW;break;case n.BUFFER_GPUDYNAMIC:t=this.device.webgl2?e.DYNAMIC_COPY:e.STATIC_DRAW}e.bindBuffer(e.ARRAY_BUFFER,this.bufferId),e.bufferData(e.ARRAY_BUFFER,this.storage,t)},setData:function(e){return e.byteLength!==this.numBytes?(console.error("VertexBuffer: wrong initial data size: expected "+this.numBytes+", got "+e.byteLength),!1):(this.storage=e,this.unlock(),!0)}}),{VertexBuffer:e}}()),Object.assign(n,function(){var e=function(e,t,i,r,s){this.usage=r||n.BUFFER_STATIC,this.format=t,this.numIndices=i,this.device=e;var a,o=this.device.gl;t===n.INDEXFORMAT_UINT8?(a=1,this.glFormat=o.UNSIGNED_BYTE):t===n.INDEXFORMAT_UINT16?(a=2,this.glFormat=o.UNSIGNED_SHORT):t===n.INDEXFORMAT_UINT32&&(a=4,this.glFormat=o.UNSIGNED_INT),this.bytesPerIndex=a,this.numBytes=this.numIndices*a,s?this.setData(s):this.storage=new ArrayBuffer(this.numBytes),e._vram.ib+=this.numBytes,this.device.buffers.push(this)};return Object.assign(e.prototype,{destroy:function(){var e=this.device,t=e.buffers.indexOf(this);if(t!==-1&&e.buffers.splice(t,1),this.bufferId){var i=this.device.gl;i.deleteBuffer(this.bufferId),this.device._vram.ib-=this.storage.byteLength,this.bufferId=null,this.device.indexBuffer===this&&(this.device.indexBuffer=null)}},getFormat:function(){return this.format},getNumIndices:function(){return this.numIndices},lock:function(){return this.storage},unlock:function(){var e=this.device.gl;this.bufferId||(this.bufferId=e.createBuffer());var t;switch(this.usage){case n.BUFFER_STATIC:t=e.STATIC_DRAW;break;case n.BUFFER_DYNAMIC:t=e.DYNAMIC_DRAW;break;case n.BUFFER_STREAM:t=e.STREAM_DRAW;break;case n.BUFFER_GPUDYNAMIC:t=this.device.webgl2?e.DYNAMIC_COPY:e.STATIC_DRAW}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.bufferId),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.storage,t)},setData:function(e){return e.byteLength!==this.numBytes?(console.error("IndexBuffer: wrong initial data size: expected "+this.numBytes+", got "+e.byteLength),!1):(this.storage=e,this.unlock(),!0)}}),{IndexBuffer:e
}}()),Object.assign(n,function(){var e=function(e,t){t=t||n.BUFFER_GPUDYNAMIC,this.device=e.device;var i=this.device.gl;this._inputBuffer=e,t===n.BUFFER_GPUDYNAMIC&&e.usage!==t&&(i.bindBuffer(i.ARRAY_BUFFER,e.bufferId),i.bufferData(i.ARRAY_BUFFER,e.storage,i.DYNAMIC_COPY)),this._outputBuffer=new n.VertexBuffer(e.device,e.format,e.numVertices,t,e.storage)};return e.createShader=function(e,t,i){return n.shaderChunks.createShaderFromCode(e,t,null,i,!0)},Object.assign(e.prototype,{destroy:function(){this._outputBuffer.destroy()},process:function(e,t){void 0===t&&(t=!0);var i=this.device;if(i.setRenderTarget(null),i.updateBegin(),i.setVertexBuffer(this._inputBuffer,0),i.setRaster(!1),i.setTransformFeedbackBuffer(this._outputBuffer),i.setShader(e),i.draw({type:n.PRIMITIVE_POINTS,base:0,count:this._inputBuffer.numVertices,indexed:!1}),i.setTransformFeedbackBuffer(null),i.setRaster(!0),i.updateEnd(),t){var r=this._inputBuffer.bufferId;this._inputBuffer.bufferId=this._outputBuffer.bufferId,this._outputBuffer.bufferId=r}}}),Object.defineProperty(e.prototype,"inputBuffer",{get:function(){return this._inputBuffer}}),Object.defineProperty(e.prototype,"outputBuffer",{get:function(){return this._outputBuffer}}),{TransformFeedback:e}}()),Object.assign(n,function(){var e=function(e,t){this.device=e,this.name=null,this._width=4,this._height=4,this._depth=1,this._pot=!0,this._format=n.PIXELFORMAT_R8_G8_B8_A8,this.rgbm=!1,this._cubemap=!1,this._volume=!1,this.fixCubemapSeams=!1,this._flipY=!0,this._mipmaps=!0,this._minFilter=n.FILTER_LINEAR_MIPMAP_LINEAR,this._magFilter=n.FILTER_LINEAR,this._anisotropy=1,this._addressU=n.ADDRESS_REPEAT,this._addressV=n.ADDRESS_REPEAT,this._addressW=n.ADDRESS_REPEAT,this._compareOnRead=!1,this._compareFunc=n.FUNC_LESS,void 0!==t&&(this._width=void 0!==t.width?t.width:this._width,this._height=void 0!==t.height?t.height:this._height,this._pot=n.math.powerOfTwo(this._width)&&n.math.powerOfTwo(this._height),this._format=void 0!==t.format?t.format:this._format,this.rgbm=void 0!==t.rgbm?t.rgbm:this.rgbm,void 0!==t.mipmaps?this._mipmaps=t.mipmaps:this._mipmaps=void 0!==t.autoMipmap?t.autoMipmap:this._mipmaps,this._cubemap=void 0!==t.cubemap?t.cubemap:this._cubemap,this.fixCubemapSeams=void 0!==t.fixCubemapSeams?t.fixCubemapSeams:this.fixCubemapSeams,this._minFilter=void 0!==t.minFilter?t.minFilter:this._minFilter,this._magFilter=void 0!==t.magFilter?t.magFilter:this._magFilter,this._anisotropy=void 0!==t.anisotropy?t.anisotropy:this._anisotropy,this._addressU=void 0!==t.addressU?t.addressU:this._addressU,this._addressV=void 0!==t.addressV?t.addressV:this._addressV,this._compareOnRead=void 0!==t.compareOnRead?t.compareOnRead:this._compareOnRead,this._compareFunc=void 0!==t._compareFunc?t._compareFunc:this._compareFunc,this._flipY=void 0!==t.flipY?t.flipY:this._flipY,e.webgl2&&(this._depth=void 0!==t.depth?t.depth:this._depth,this._volume=void 0!==t.volume?t.volume:this._volume,this._addressW=void 0!==t.addressW?t.addressW:this._addressW)),this._compressed=this._format===n.PIXELFORMAT_DXT1||this._format===n.PIXELFORMAT_DXT3||this._format===n.PIXELFORMAT_DXT5||this._format>=n.PIXELFORMAT_ETC1,this._invalid=!1,this._lockedLevel=-1,this._levels=this._cubemap?[[null,null,null,null,null,null]]:[null],this.dirtyAll(),this._gpuSize=0,this.device.textures.push(this)};Object.defineProperty(e.prototype,"minFilter",{get:function(){return this._minFilter},set:function(e){this._minFilter!==e&&(this._minFilter=e,this._minFilterDirty=!0)}}),Object.defineProperty(e.prototype,"magFilter",{get:function(){return this._magFilter},set:function(e){this._magFilter!==e&&(this._magFilter=e,this._magFilterDirty=!0)}}),Object.defineProperty(e.prototype,"addressU",{get:function(){return this._addressU},set:function(e){this._addressU!==e&&(this._addressU=e,this._addressUDirty=!0)}}),Object.defineProperty(e.prototype,"addressV",{get:function(){return this._addressV},set:function(e){this._addressV!==e&&(this._addressV=e,this._addressVDirty=!0)}}),Object.defineProperty(e.prototype,"addressW",{get:function(){return this._addressW},set:function(e){if(this.device.webgl2)return this._volume?void(e!==this._addressW&&(this._addressW=e,this._addressWDirty=!0)):void r("Can't set W addressing mode for a non-3D texture.")}}),Object.defineProperty(e.prototype,"compareOnRead",{get:function(){return this._compareOnRead},set:function(e){this._compareOnRead!==e&&(this._compareOnRead=e,this._compareModeDirty=!0)}}),Object.defineProperty(e.prototype,"compareFunc",{get:function(){return this._compareFunc},set:function(e){this._compareFunc!==e&&(this._compareFunc=e,this._compareModeDirty=!0)}}),Object.defineProperty(e.prototype,"autoMipmap",{get:function(){return this._mipmaps},set:function(e){this._mipmaps=e}}),Object.defineProperty(e.prototype,"mipmaps",{get:function(){return this._mipmaps},set:function(e){this._mipmaps!==e&&(this._mipmaps=e,this._minFilterDirty=!0,e&&(this._needsMipmapsUpload=!0))}}),Object.defineProperty(e.prototype,"anisotropy",{get:function(){return this._anisotropy},set:function(e){this._anisotropy!==e&&(this._anisotropy=e,this._anisotropyDirty=!0)}}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width}}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height}}),Object.defineProperty(e.prototype,"depth",{get:function(){return this._depth}}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format}}),Object.defineProperty(e.prototype,"cubemap",{get:function(){return this._cubemap}});var t=null;return Object.defineProperty(e.prototype,"gpuSize",{get:function(){t||(t=[],t[n.PIXELFORMAT_A8]=1,t[n.PIXELFORMAT_L8]=1,t[n.PIXELFORMAT_L8_A8]=1,t[n.PIXELFORMAT_R5_G6_B5]=2,t[n.PIXELFORMAT_R5_G5_B5_A1]=2,t[n.PIXELFORMAT_R4_G4_B4_A4]=2,t[n.PIXELFORMAT_R8_G8_B8]=4,t[n.PIXELFORMAT_R8_G8_B8_A8]=4,t[n.PIXELFORMAT_RGB16F]=8,t[n.PIXELFORMAT_RGBA16F]=8,t[n.PIXELFORMAT_RGB32F]=16,t[n.PIXELFORMAT_RGBA32F]=16,t[n.PIXELFORMAT_R32F]=4,t[n.PIXELFORMAT_DEPTH]=4,t[n.PIXELFORMAT_DEPTHSTENCIL]=4,t[n.PIXELFORMAT_111110F]=4,t[n.PIXELFORMAT_SRGB]=4,t[n.PIXELFORMAT_SRGBA]=4);var e=1;!this._pot||!this._mipmaps&&this._minFilter!==n.FILTER_NEAREST_MIPMAP_NEAREST&&this._minFilter!==n.FILTER_NEAREST_MIPMAP_LINEAR&&this._minFilter!==n.FILTER_LINEAR_MIPMAP_NEAREST&&this._minFilter!==n.FILTER_LINEAR_MIPMAP_LINEAR||this._compressed&&1===this._levels.length||(e=Math.round(Math.log2(Math.max(this._width,this._height))+1));for(var i=this._width,r=this._height,s=this._depth,a=0,o=0;o<e;o++){if(this._compressed)if(this._format===n.PIXELFORMAT_ETC1)a+=Math.floor((i+3)/4)*Math.floor((r+3)/4)*8*s;else if(this._format===n.PIXELFORMAT_PVRTC_2BPP_RGB_1||this._format===n.PIXELFORMAT_PVRTC_2BPP_RGBA_1)a+=Math.max(i,16)*Math.max(r,8)/4*s;else if(this._format===n.PIXELFORMAT_PVRTC_4BPP_RGB_1||this._format===n.PIXELFORMAT_PVRTC_4BPP_RGBA_1)a+=Math.max(i,8)*Math.max(r,8)/2*s;else{var h=4,l=4,c=this._format===n.PIXELFORMAT_DXT1?8:16,d=Math.floor((i+h-1)/h),u=Math.floor((r+l-1)/l),f=d*u;a+=f*c*s}else a+=i*r*s*t[this._format];i=Math.max(.5*i,1),r=Math.max(.5*r,1),s=Math.max(.5*s,1)}return this._cubemap&&(a*=6),a}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume}}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._needsUpload=!0)}}),Object.assign(e.prototype,{destroy:function(){var e=this.device,t=e.textures.indexOf(this);if(t!==-1&&e.textures.splice(t,1),this._glTextureId){var i=this.device.gl;i.deleteTexture(this._glTextureId),this.device._vram.tex-=this._gpuSize,this._glTextureId=null}},dirtyAll:function(){this._glTextureId=void 0,this._levelsUpdated=this._cubemap?[[!0,!0,!0,!0,!0,!0]]:[!0],this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps,this._mipmapsUploaded=!1,this._minFilterDirty=!0,this._magFilterDirty=!0,this._addressUDirty=!0,this._addressVDirty=!0,this._addressWDirty=this._volume,this._anisotropyDirty=!0,this._compareModeDirty=!0},lock:function(e){if(e=e||{level:0,face:0,mode:n.TEXTURELOCK_WRITE},void 0===e.level&&(e.level=0),void 0===e.face&&(e.face=0),void 0===e.mode&&(e.mode=n.TEXTURELOCK_WRITE),this._lockedLevel=e.level,null===this._levels[e.level])switch(this._format){case n.PIXELFORMAT_A8:case n.PIXELFORMAT_L8:this._levels[e.level]=new Uint8Array(this._width*this._height*this._depth);break;case n.PIXELFORMAT_L8_A8:this._levels[e.level]=new Uint8Array(this._width*this._height*this._depth*2);break;case n.PIXELFORMAT_R5_G6_B5:case n.PIXELFORMAT_R5_G5_B5_A1:case n.PIXELFORMAT_R4_G4_B4_A4:this._levels[e.level]=new Uint16Array(this._width*this._height*this._depth);break;case n.PIXELFORMAT_R8_G8_B8:this._levels[e.level]=new Uint8Array(this._width*this._height*this._depth*3);break;case n.PIXELFORMAT_R8_G8_B8_A8:this._levels[e.level]=new Uint8Array(this._width*this._height*this._depth*4);break;case n.PIXELFORMAT_DXT1:this._levels[e.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*8*this._depth);break;case n.PIXELFORMAT_DXT3:case n.PIXELFORMAT_DXT5:this._levels[e.level]=new Uint8Array(Math.floor((this._width+3)/4)*Math.floor((this._height+3)/4)*16*this._depth);break;case n.PIXELFORMAT_RGB16F:this._levels[e.level]=new Uint16Array(this._width*this._height*this._depth*3);break;case n.PIXELFORMAT_RGB32F:this._levels[e.level]=new Float32Array(this._width*this._height*this._depth*3);break;case n.PIXELFORMAT_RGBA16F:this._levels[e.level]=new Uint16Array(this._width*this._height*this._depth*4);break;case n.PIXELFORMAT_RGBA32F:this._levels[e.level]=new Float32Array(this._width*this._height*this._depth*4)}return this._levels[e.level]},setSource:function(e){var t,i,r,s=!1;if(this._cubemap){if(e[0]){for(i=e[0].width||0,r=e[0].height||0,t=0;t<6;t++)if(!(e[t]&&e[t].width===i&&e[t].height===r&&(e[t]instanceof HTMLImageElement||e[t]instanceof HTMLCanvasElement||e[t]instanceof HTMLVideoElement))){s=!0;break}}else s=!0;if(!s)for(t=0;t<6;t++)this._levels[0][t]!==e[t]&&(this._levelsUpdated[0][t]=!0)}else e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||(s=!0),s||(e!==this._levels[0]&&(this._levelsUpdated[0]=!0),i=e.width,r=e.height);if(s)if(this._width=4,this._height=4,this._pot=!0,this._cubemap)for(t=0;t<6;t++)this._levels[0][t]=null,this._levelsUpdated[0][t]=!0;else this._levels[0]=null,this._levelsUpdated[0]=!0;else this._width=i,this._height=r,this._pot=n.math.powerOfTwo(this._width)&&n.math.powerOfTwo(this._height),this._levels[0]=e;this._invalid===s&&s||(this._invalid=s,this.upload())},getSource:function(){return this._levels[0]},unlock:function(){this.upload(),this._lockedLevel=-1},upload:function(){this._needsUpload=!0,this._needsMipmapsUpload=this._mipmaps},getDds:function(){this.format!==n.PIXELFORMAT_R8_G8_B8_A8&&console.error("This format is not implemented yet");for(var e,t,i=128,r=0;this._levels[r];){var s;if(this.cubemap)for(t=0;t<6;t++){if(!this._levels[r][t])return void console.error("No level data for mip "+r+", face "+t);if(s=this._levels[r][t].length,!s)return void console.error("No byte array for mip "+r+", face "+t);i+=s}else{if(s=this._levels[r].length,!s)return void console.error("No byte array for mip "+r);i+=s}i+=this._levels[r].length,r++}var a=new ArrayBuffer(i),o=new Uint32Array(a,0,32),h=542327876,l=124,c=528391,d=131072,u=32,f=65,p=4096,_=4194304,m=8,A=65024,v=c;this._levels.length>1&&(v|=d);var y=p;this._levels.length>1&&(y|=_),(this._levels.length>1||this.cubemap)&&(y|=m);var g=this.cubemap?A:0;for(o[0]=h,o[1]=l,o[2]=v,o[3]=this.height,o[4]=this.width,o[5]=this.width*this.height*4,o[6]=0,o[7]=this._levels.length,r=0;r<11;r++)o[8+r]=0;o[19]=u,o[20]=f,o[21]=0,o[22]=32,o[23]=16711680,o[24]=65280,o[25]=255,o[26]=4278190080,o[27]=y,o[28]=g,o[29]=0,o[30]=0,o[31]=0;var b,E,T=128;if(this.cubemap)for(t=0;t<6;t++)for(r=0;r<this._levels.length;r++){for(b=this._levels[r][t],E=new Uint8Array(a,T,b.length),e=0;e<b.length;e++)E[e]=b[e];T+=b.length}else for(r=0;r<this._levels.length;r++){for(b=this._levels[r],E=new Uint8Array(a,T,b.length),e=0;e<b.length;e++)E[e]=b[e];T+=b.length}return a}}),{Texture:e}}()),Object.assign(n,function(){var e={depth:!0,face:0},t=function(t){var i=arguments[1],r=arguments[2];if(t instanceof n.GraphicsDevice?(this._colorBuffer=i,t=r):this._colorBuffer=t.colorBuffer,this._glFrameBuffer=null,this._glDepthBuffer=null,t=void 0!==t?t:e,this._depthBuffer=t.depthBuffer,this._face=void 0!==t.face?t.face:0,this._depthBuffer){var s=this._depthBuffer._format;s===n.PIXELFORMAT_DEPTH?(this._depth=!0,this._stencil=!1):s===n.PIXELFORMAT_DEPTHSTENCIL?(this._depth=!0,this._stencil=!0):(this._depth=!1,this._stencil=!1)}else this._depth=void 0===t.depth||t.depth,this._stencil=void 0!==t.stencil&&t.stencil;this._samples=void 0!==t.samples?t.samples:1,this.autoResolve=void 0===t.autoResolve||t.autoResolve,this._glResolveFrameBuffer=null,this._glMsaaColorBuffer=null,this._glMsaaDepthBuffer=null};return Object.assign(t.prototype,{destroy:function(){if(this._device){var e=this._device,t=e.targets.indexOf(this);t!==-1&&e.targets.splice(t,1);var i=e.gl;this._glFrameBuffer&&(i.deleteFramebuffer(this._glFrameBuffer),this._glFrameBuffer=null),this._glDepthBuffer&&(i.deleteRenderbuffer(this._glDepthBuffer),this._glDepthBuffer=null),this._glResolveFrameBuffer&&(i.deleteFramebuffer(this._glResolveFrameBuffer),this._glResolveFrameBuffer=null),this._glMsaaColorBuffer&&(i.deleteRenderbuffer(this._glMsaaColorBuffer),this._glMsaaColorBuffer=null),this._glMsaaDepthBuffer&&(i.deleteRenderbuffer(this._glMsaaDepthBuffer),this._glMsaaDepthBuffer=null)}},resolve:function(e,t){if(this._device&&this._device.webgl2){var i=this._device.gl;void 0===e&&(e=!0),void 0===t&&this._depthBuffer&&(t=!0),i.bindFramebuffer(i.READ_FRAMEBUFFER,this._glFrameBuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this._glResolveFrameBuffer),i.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,(e?i.COLOR_BUFFER_BIT:0)|(t?i.DEPTH_BUFFER_BIT:0),i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this._glFrameBuffer)}},copy:function(e,t,i){if(!this._device){if(!e._device)return!1;this._device=e._device}return this._device.copyRenderTarget(e,this,t,i)}}),Object.defineProperty(t.prototype,"colorBuffer",{get:function(){return this._colorBuffer}}),Object.defineProperty(t.prototype,"depthBuffer",{get:function(){return this._depthBuffer}}),Object.defineProperty(t.prototype,"face",{get:function(){return this._face}}),Object.defineProperty(t.prototype,"width",{get:function(){return this._colorBuffer?this._colorBuffer.width:this._depthBuffer.width}}),Object.defineProperty(t.prototype,"height",{get:function(){return this._colorBuffer?this._colorBuffer.height:this._depthBuffer.height}}),{RenderTarget:t}}()),Object.assign(n,function(){var e=function(e,t,i,r){this.locationId=r,this.scopeId=e.scope.resolve(t),this.version=new n.Version,i===n.UNIFORMTYPE_FLOAT&&"[0]"===t.substr(t.length-3)&&(i=n.UNIFORMTYPE_FLOATARRAY),this.dataType=i,this.value=[null,null,null,null],this.array=[]};return{ShaderInput:e}}()),Object.assign(n,function(){function e(e){for(var t=e.split("\n"),i=0,n=t.length;i<n;i++)t[i]=i+1+":\t"+t[i];return t.join("\n")}function t(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}function i(e,t,i){var n=e.createProgram();return e.attachShader(n,t),e.attachShader(n,i),n}var r=function(e,t){this.device=e,this.definition=t,this._refCount=0,this.compile(),this.device.shaders.push(this)};return Object.assign(r.prototype,{compile:function(){this.ready=!1;var e=this.device.gl;this.vshader=t(e,e.VERTEX_SHADER,this.definition.vshader),this.fshader=t(e,e.FRAGMENT_SHADER,this.definition.fshader),this.program=i(e,this.vshader,this.fshader),this.device._shaderStats.vsCompiled++,this.device._shaderStats.fsCompiled++,this.device._shaderStats.linked++,this.definition.tag===n.SHADERTAG_MATERIAL&&this.device._shaderStats.materialShaders++},link:function(){var t=this.device.gl,i=!0;if(this.device.webgl2&&this.definition.useTransformFeedback){var r=this.definition.attributes,a=[];for(var o in r)r.hasOwnProperty(o)&&a.push("out_"+o);t.transformFeedbackVaryings(this.program,a,t.INTERLEAVED_ATTRIBS)}t.linkProgram(this.program),t.getShaderParameter(this.vshader,t.COMPILE_STATUS)||(s("Failed to compile vertex shader:\n\n"+e(this.definition.vshader)+"\n\n"+t.getShaderInfoLog(this.vshader)),i=!1),t.getShaderParameter(this.fshader,t.COMPILE_STATUS)||(s("Failed to compile fragment shader:\n\n"+e(this.definition.fshader)+"\n\n"+t.getShaderInfoLog(this.fshader)),i=!1),t.getProgramParameter(this.program,t.LINK_STATUS)||(s("Failed to link shader program. Error: "+t.getProgramInfoLog(this.program)),i=!1),t.deleteShader(this.vshader),t.deleteShader(this.fshader),this.attributes=[],this.uniforms=[],this.samplers=[];var h,l,c=0,d={};d[t.BOOL]=n.UNIFORMTYPE_BOOL,d[t.INT]=n.UNIFORMTYPE_INT,d[t.FLOAT]=n.UNIFORMTYPE_FLOAT,d[t.FLOAT_VEC2]=n.UNIFORMTYPE_VEC2,d[t.FLOAT_VEC3]=n.UNIFORMTYPE_VEC3,d[t.FLOAT_VEC4]=n.UNIFORMTYPE_VEC4,d[t.INT_VEC2]=n.UNIFORMTYPE_IVEC2,d[t.INT_VEC3]=n.UNIFORMTYPE_IVEC3,d[t.INT_VEC4]=n.UNIFORMTYPE_IVEC4,d[t.BOOL_VEC2]=n.UNIFORMTYPE_BVEC2,d[t.BOOL_VEC3]=n.UNIFORMTYPE_BVEC3,d[t.BOOL_VEC4]=n.UNIFORMTYPE_BVEC4,d[t.FLOAT_MAT2]=n.UNIFORMTYPE_MAT2,d[t.FLOAT_MAT3]=n.UNIFORMTYPE_MAT3,d[t.FLOAT_MAT4]=n.UNIFORMTYPE_MAT4,d[t.SAMPLER_2D]=n.UNIFORMTYPE_TEXTURE2D,d[t.SAMPLER_CUBE]=n.UNIFORMTYPE_TEXTURECUBE,this.device.webgl2&&(d[t.SAMPLER_2D_SHADOW]=n.UNIFORMTYPE_TEXTURE2D_SHADOW,d[t.SAMPLER_CUBE_SHADOW]=n.UNIFORMTYPE_TEXTURECUBE_SHADOW,d[t.SAMPLER_3D]=n.UNIFORMTYPE_TEXTURE3D);for(var u=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);c<u;)h=t.getActiveAttrib(this.program,c++),l=t.getAttribLocation(this.program,h.name),void 0===this.definition.attributes[h.name]&&console.error('Vertex shader attribute "'+h.name+'" is not mapped to a semantic in shader definition.'),this.attributes.push(new n.ShaderInput(this.device,this.definition.attributes[h.name],d[h.type],l));c=0;for(var f=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);c<f;)h=t.getActiveUniform(this.program,c++),l=t.getUniformLocation(this.program,h.name),h.type===t.SAMPLER_2D||h.type===t.SAMPLER_CUBE||this.device.webgl2&&(h.type===t.SAMPLER_2D_SHADOW||h.type===t.SAMPLER_CUBE_SHADOW||h.type===t.SAMPLER_3D)?this.samplers.push(new n.ShaderInput(this.device,h.name,d[h.type],l)):this.uniforms.push(new n.ShaderInput(this.device,h.name,d[h.type],l));return this.ready=!0,i},destroy:function(){var e=this.device,t=e.shaders.indexOf(this);if(t!==-1&&e.shaders.splice(t,1),this.program){var i=e.gl;i.deleteProgram(this.program),this.program=null,this.device.removeShaderFromCache(this)}}}),{Shader:r}}()),Object.assign(n,function(){var e=function(e){this._device=e,this._cache={},this._generators={},this._isClearingCache=!1};return e.prototype.register=function(e,t){this.isRegistered(e)||(this._generators[e]=t)},e.prototype.unregister=function(e){this.isRegistered(e)&&delete this._generators[e]},e.prototype.isRegistered=function(e){var t=this._generators[e];return void 0!==t},e.prototype.getProgram=function(e,t){var i=this._generators[e];if(void 0===i)return null;var r=this._device,s=i.generateKey(r,t),a=this._cache[s];if(!a){var o=i.createShaderDefinition(r,t);a=this._cache[s]=new n.Shader(r,o)}return a},e.prototype.clearCache=function(){var e=this._cache;this._isClearingCache=!0;for(var t in e)e.hasOwnProperty(t)&&e[t].destroy();this._cache={},this._isClearingCache=!1},e.prototype.removeFromCache=function(e){if(!this._isClearingCache){var t=this._cache;for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e){delete t[i];break}}},{ProgramLibrary:e}}()),Object.assign(n,function(){function e(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),i=navigator.userAgent.match(/Trident.*rv:11\./);return t>0||!!i}function t(e,t){var i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var n=2,r=2;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,r,0,e.RGBA,t,null);var s=e.createFramebuffer();return e.bindFramebuffer(e.FRAMEBUFFER,s),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.bindTexture(e.TEXTURE_2D,null),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE?(e.deleteTexture(i),!1):(e.deleteTexture(i),e.bindFramebuffer(e.FRAMEBUFFER,null),!0)}function i(e){var t=new ArrayBuffer(16),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.getError(),e.vertexAttribPointer(0,4,e.UNSIGNED_BYTE,!1,4,0);var n=0===e.getError();return e.deleteBuffer(i),n}var r="resizecanvas",s=function(e,t){var i=e.width,n=e.height;if(i>t||n>t){var r=t/Math.max(i,n),s=Math.floor(i*r),a=Math.floor(n*r);console.warn("Image dimensions larger than max supported texture size of "+t+". Resizing from "+i+", "+n+" to "+s+", "+a+".");var o=document.createElement("canvas");o.width=s,o.height=a;var h=o.getContext("2d");return h.drawImage(e,0,0,i,n,0,0,s,a),o}return e},a=function(e,r){var s;this.canvas=e,this.shader=null,this.indexBuffer=null,this.vertexBuffers=[],this.vbOffsets=[],this._enableAutoInstancing=!1,this.autoInstancingMaxObjects=16384,this.attributesInvalidated=!0,this.boundBuffer=null,this.instancedAttribs={},this.enabledAttributes={},this.transformFeedbackBuffer=null,this.activeFramebuffer=null,this.activeTexture=0,this.textureUnits=[],this._maxPixelRatio=1,this.renderTarget=null,this.feedback=null,this._width=0,this._height=0,this.updateClientRect(),this.shaders=[],this.buffers=[],this.textures=[],this.targets=[],this.contextLost=!1,e.addEventListener("webglcontextlost",function(e){e.preventDefault(),this.contextLost=!0,this.fire("devicelost")}.bind(this),!1),e.addEventListener("webglcontextrestored",function(){this.initializeContext(),this.contextLost=!1,this.fire("devicerestored")}.bind(this),!1);var a=!r||void 0===r.preferWebGl2||r.preferWebGl2,o=a?["webgl2","experimental-webgl2","webgl","experimental-webgl"]:["webgl","experimental-webgl"],h=null;for(r=r||{},r.stencil=!0,s=0;s<o.length;s++){try{h=e.getContext(o[s],r)}catch(l){}if(h){this.webgl2=a&&s<2;break}}if(!h)throw new Error("WebGL not supported");for(this.gl=h,this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState(),s=0;s<this.maxCombinedTextures;s++)this.textureUnits.push([null,null,null]);(function(){this.defaultClearOptions={color:[0,0,0,1],depth:1,stencil:0,flags:n.CLEARFLAG_COLOR|n.CLEARFLAG_DEPTH},this.glAddress=[h.REPEAT,h.CLAMP_TO_EDGE,h.MIRRORED_REPEAT],this.glBlendEquation=[h.FUNC_ADD,h.FUNC_SUBTRACT,h.FUNC_REVERSE_SUBTRACT,this.webgl2?h.MIN:this.extBlendMinmax?this.extBlendMinmax.MIN_EXT:h.FUNC_ADD,this.webgl2?h.MAX:this.extBlendMinmax?this.extBlendMinmax.MAX_EXT:h.FUNC_ADD],this.glBlendFunction=[h.ZERO,h.ONE,h.SRC_COLOR,h.ONE_MINUS_SRC_COLOR,h.DST_COLOR,h.ONE_MINUS_DST_COLOR,h.SRC_ALPHA,h.SRC_ALPHA_SATURATE,h.ONE_MINUS_SRC_ALPHA,h.DST_ALPHA,h.ONE_MINUS_DST_ALPHA],this.glComparison=[h.NEVER,h.LESS,h.EQUAL,h.LEQUAL,h.GREATER,h.NOTEQUAL,h.GEQUAL,h.ALWAYS],this.glStencilOp=[h.KEEP,h.ZERO,h.REPLACE,h.INCR,h.INCR_WRAP,h.DECR,h.DECR_WRAP,h.INVERT],this.glClearFlag=[0,h.COLOR_BUFFER_BIT,h.DEPTH_BUFFER_BIT,h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT,h.STENCIL_BUFFER_BIT,h.STENCIL_BUFFER_BIT|h.COLOR_BUFFER_BIT,h.STENCIL_BUFFER_BIT|h.DEPTH_BUFFER_BIT,h.STENCIL_BUFFER_BIT|h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT],this.glCull=[0,h.BACK,h.FRONT,h.FRONT_AND_BACK],this.glFilter=[h.NEAREST,h.LINEAR,h.NEAREST_MIPMAP_NEAREST,h.NEAREST_MIPMAP_LINEAR,h.LINEAR_MIPMAP_NEAREST,h.LINEAR_MIPMAP_LINEAR],this.glPrimitive=[h.POINTS,h.LINES,h.LINE_LOOP,h.LINE_STRIP,h.TRIANGLES,h.TRIANGLE_STRIP,h.TRIANGLE_FAN],this.glType=[h.BYTE,h.UNSIGNED_BYTE,h.SHORT,h.UNSIGNED_SHORT,h.INT,h.UNSIGNED_INT,h.FLOAT],this.targetToSlot={},this.targetToSlot[h.TEXTURE_2D]=0,this.targetToSlot[h.TEXTURE_CUBE_MAP]=1,this.targetToSlot[h.TEXTURE_3D]=2;var e,r,a,o,l;this.commitFunction=[],this.commitFunction[n.UNIFORMTYPE_BOOL]=function(e,t){e.value!==t&&(h.uniform1i(e.locationId,t),e.value=t)},this.commitFunction[n.UNIFORMTYPE_INT]=this.commitFunction[n.UNIFORMTYPE_BOOL],this.commitFunction[n.UNIFORMTYPE_FLOAT]=function(e,t){e.value!==t&&(h.uniform1f(e.locationId,t),e.value=t)},this.commitFunction[n.UNIFORMTYPE_VEC2]=function(t,i){l=t.value,e=i[0],r=i[1],l[0]===e&&l[1]===r||(h.uniform2fv(t.locationId,i),l[0]=e,l[1]=r)},this.commitFunction[n.UNIFORMTYPE_VEC3]=function(t,i){l=t.value,e=i[0],r=i[1],a=i[2],l[0]===e&&l[1]===r&&l[2]===a||(h.uniform3fv(t.locationId,i),l[0]=e,l[1]=r,l[2]=a)},this.commitFunction[n.UNIFORMTYPE_VEC4]=function(t,i){l=t.value,e=i[0],r=i[1],a=i[2],o=i[3],l[0]===e&&l[1]===r&&l[2]===a&&l[3]===o||(h.uniform4fv(t.locationId,i),l[0]=e,l[1]=r,l[2]=a,l[3]=o)},this.commitFunction[n.UNIFORMTYPE_IVEC2]=function(t,i){l=t.value,e=i[0],r=i[1],l[0]===e&&l[1]===r||(h.uniform2iv(t.locationId,i),l[0]=e,l[1]=r)},this.commitFunction[n.UNIFORMTYPE_BVEC2]=this.commitFunction[n.UNIFORMTYPE_IVEC2],this.commitFunction[n.UNIFORMTYPE_IVEC3]=function(t,i){l=t.value,e=i[0],r=i[1],a=i[2],l[0]===e&&l[1]===r&&l[2]===a||(h.uniform3iv(t.locationId,i),l[0]=e,l[1]=r,l[2]=a)},this.commitFunction[n.UNIFORMTYPE_BVEC3]=this.commitFunction[n.UNIFORMTYPE_IVEC3],this.commitFunction[n.UNIFORMTYPE_IVEC4]=function(t,i){l=t.value,e=i[0],r=i[1],a=i[2],o=i[3],l[0]===e&&l[1]===r&&l[2]===a&&l[3]===o||(h.uniform4iv(t.locationId,i),l[0]=e,l[1]=r,l[2]=a,l[3]=o)},this.commitFunction[n.UNIFORMTYPE_BVEC4]=this.commitFunction[n.UNIFORMTYPE_IVEC4],this.commitFunction[n.UNIFORMTYPE_MAT2]=function(e,t){h.uniformMatrix2fv(e.locationId,!1,t)},this.commitFunction[n.UNIFORMTYPE_MAT3]=function(e,t){h.uniformMatrix3fv(e.locationId,!1,t)},this.commitFunction[n.UNIFORMTYPE_MAT4]=function(e,t){h.uniformMatrix4fv(e.locationId,!1,t)},this.commitFunction[n.UNIFORMTYPE_FLOATARRAY]=function(e,t){h.uniform1fv(e.locationId,t)},this.scope=new n.ScopeSpace("Device"),this.programLib=new n.ProgramLibrary(this);for(var c in n.programlib)this.programLib.register(c,n.programlib[c]);n.events.attach(this),this.supportsBoneTextures=this.extTextureFloat&&this.maxVertexTextures>0,this.useTexCubeLod=this.extTextureLod&&this.maxTextures<16;var d=this.vertexUniformsCount;for(d-=16,d-=8,d-=1,d-=16,this.boneLimit=Math.floor(d/4),this.boneLimit=Math.min(this.boneLimit,128),"Mali-450 MP"===this.unmaskedRenderer&&(this.boneLimit=34),"Apple A8 GPU"===this.unmaskedRenderer&&(this.forceCpuParticles=!0),this._drawCallsPerFrame=0,this._shaderSwitchesPerFrame=0,this._primsPerFrame=[],s=n.PRIMITIVE_POINTS;s<=n.PRIMITIVE_TRIFAN;s++)this._primsPerFrame[s]=0;if(this._renderTargetCreationTime=0,this._vram={tex:0,vb:0,ib:0},this._shaderStats={vsCompiled:0,fsCompiled:0,linked:0,materialShaders:0,compileTime:0},this.supportsUnsignedByte=i(h),this.constantTexSource=this.scope.resolve("source"),n._benchmarked)this.extTextureFloatRenderable=n.extTextureFloatRenderable,this.extTextureHalfFloatRenderable=n.extTextureHalfFloatRenderable,this.extTextureFloatHighPrecision=n.extTextureFloatHighPrecision;else{if(this.extTextureFloat&&(this.webgl2?this.extTextureFloatRenderable=this.extColorBufferFloat:this.extTextureFloatRenderable=t(h,h.FLOAT)),this.extTextureHalfFloat&&(this.webgl2?this.extTextureHalfFloatRenderable=this.extColorBufferFloat:this.extTextureHalfFloatRenderable=t(h,this.extTextureHalfFloat.HALF_FLOAT_OES)),this.extTextureFloatRenderable){var u=this,f=n.shaderChunks,p=f.createShaderFromCode(u,f.fullscreenQuadVS,f.precisionTestPS,"ptest1"),_=f.createShaderFromCode(u,f.fullscreenQuadVS,f.precisionTest2PS,"ptest2"),m=1,A=new n.Texture(u,{format:n.PIXELFORMAT_RGBA32F,width:m,height:m,mipmaps:!1,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),v=new n.RenderTarget(u,A,{depth:!1});n.drawQuadWithShader(u,v,p);var y=new n.Texture(u,{format:n.PIXELFORMAT_R8_G8_B8_A8,width:m,height:m,mipmaps:!1,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),g=new n.RenderTarget(u,y,{depth:!1});this.constantTexSource.setValue(A),n.drawQuadWithShader(u,g,_);var b=new Uint8Array(m*m*4);h.bindFramebuffer(h.FRAMEBUFFER,g._glFrameBuffer),h.readPixels(0,0,m,m,h.RGBA,h.UNSIGNED_BYTE,b);var E=b[0]/255,T=b[1]/255,S=b[2]/255,w=b[3]/255,C=E/16777216+T/65536+S/256+w;this.extTextureFloatHighPrecision=0===C,A.destroy(),v.destroy(),y.destroy(),g.destroy(),n.destroyPostEffectQuad(),h.bindFramebuffer(h.FRAMEBUFFER,null)}n.extTextureFloatRenderable=this.extTextureFloatRenderable,n.extTextureHalfFloatRenderable=this.extTextureHalfFloatRenderable,n.extTextureFloatHighPrecision=this.extTextureFloatHighPrecision,n._benchmarked=!0}}).call(this)};return Object.assign(a.prototype,{getPrecision:function(){var e=this.gl,t="highp";if(e.getShaderPrecisionFormat){var i=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT),n=e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT),r=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT),s=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT),a=i.precision>0&&r.precision>0,o=n.precision>0&&s.precision>0;a||(t=o?"mediump":"lowp")}return t},initializeExtensions:function(){var t=this.gl;this.webgl2?(this.extBlendMinmax=!0,this.extDrawBuffers=!0,this.extInstancing=!0,this.extStandardDerivatives=!0,this.extTextureFloat=!0,this.extTextureHalfFloat=!0,this.extTextureHalfFloatLinear=!0,this.extTextureLod=!0,this.extUintElement=!0):(this.extBlendMinmax=t.getExtension("EXT_blend_minmax"),this.extDrawBuffers=t.getExtension("EXT_draw_buffers"),this.extInstancing=t.getExtension("ANGLE_instanced_arrays"),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTextureFloat=t.getExtension("OES_texture_float"),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloatLinear=t.getExtension("OES_texture_half_float_linear"),this.extTextureLod=t.getExtension("EXT_shader_texture_lod"),this.extUintElement=t.getExtension("OES_element_index_uint")),this.extRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear"),this.extColorBufferFloat=t.getExtension("EXT_color_buffer_float"),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extCompressedTextureETC1=t.getExtension("WEBGL_compressed_texture_etc1"),this.extCompressedTexturePVRTC=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.extCompressedTextureS3TC=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),this.extCompressedTextureS3TC&&e()&&(this.extCompressedTextureS3TC=null)},initializeCapabilities:function(){var e=this.gl;this.maxPrecision=this.precision=this.getPrecision();var t=e.getContextAttributes();this.supportsMsaa=t.antialias,this.supportsStencil=t.stencil,this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxCubeMapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxRenderBufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxTextures=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxCombinedTextures=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.vertexUniformsCount=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.fragmentUniformsCount=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),this.unmaskedRenderer=this.extRendererInfo?e.getParameter(this.extRendererInfo.UNMASKED_RENDERER_WEBGL):"",this.unmaskedVendor=this.extRendererInfo?e.getParameter(this.extRendererInfo.UNMASKED_VENDOR_WEBGL):"",this.webgl2?(this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS),this.maxColorAttachments=e.getParameter(e.MAX_COLOR_ATTACHMENTS),this.maxVolumeSize=e.getParameter(e.MAX_3D_TEXTURE_SIZE)):(this.maxDrawBuffers=this.extDrawBuffers?e.getParameter(this.extDrawBuffers.MAX_DRAW_BUFFERS_EXT):1,
this.maxColorAttachments=this.extDrawBuffers?e.getParameter(this.extDrawBuffers.MAX_COLOR_ATTACHMENTS_EXT):1,this.maxVolumeSize=1)},initializeRenderState:function(){var e=this.gl;this.blending=!1,e.disable(e.BLEND),this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ZERO,this.blendSrcAlpha=n.BLENDMODE_ONE,this.blendDstAlpha=n.BLENDMODE_ZERO,this.separateAlphaBlend=!1,this.blendEquation=n.BLENDEQUATION_ADD,this.blendAlphaEquation=n.BLENDEQUATION_ADD,this.separateAlphaEquation=!1,e.blendFunc(e.ONE,e.ZERO),e.blendEquation(e.FUNC_ADD),this.writeRed=!0,this.writeGreen=!0,this.writeBlue=!0,this.writeAlpha=!0,e.colorMask(!0,!0,!0,!0),this.cullMode=n.CULLFACE_BACK,e.enable(e.CULL_FACE),e.cullFace(e.BACK),this.depthTest=!0,e.enable(e.DEPTH_TEST),this.depthFunc=n.FUNC_LESSEQUAL,e.depthFunc(e.LEQUAL),this.depthWrite=!0,e.depthMask(!0),this.stencil=!1,e.disable(e.STENCIL_TEST),this.stencilFuncFront=this.stencilFuncBack=n.FUNC_ALWAYS,this.stencilRefFront=this.stencilRefBack=0,this.stencilMaskFront=this.stencilMaskBack=255,e.stencilFunc(e.ALWAYS,0,255),this.stencilFailFront=this.stencilFailBack=n.STENCILOP_KEEP,this.stencilZfailFront=this.stencilZfailBack=n.STENCILOP_KEEP,this.stencilZpassFront=this.stencilZpassBack=n.STENCILOP_KEEP,this.stencilWriteMaskFront=255,this.stencilWriteMaskBack=255,e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(255),this.alphaToCoverage=!1,this.raster=!0,this.webgl2&&(e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.disable(e.RASTERIZER_DISCARD)),this.depthBiasEnabled=!1,e.disable(e.POLYGON_OFFSET_FILL),this.clearDepth=1,e.clearDepth(1),this.clearRed=0,this.clearBlue=0,this.clearGreen=0,this.clearAlpha=0,e.clearColor(0,0,0,0),this.clearStencil=0,e.clearStencil(0),this.vx=this.vy=this.vw=this.vh=0,this.sx=this.sy=this.sw=this.sh=0,this.webgl2?e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.NICEST):this.extStandardDerivatives&&e.hint(this.extStandardDerivatives.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,e.NICEST),e.enable(e.SCISSOR_TEST),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE)},initializeContext:function(){this.initializeExtensions(),this.initializeCapabilities(),this.initializeRenderState();var e,t;for(e=0,t=this.shaders.length;e<t;e++)this.shaders[e].compile();for(this.shader=null,e=0,t=this.buffers.length;e<t;e++)this.buffers[e].bufferId=void 0,this.buffers[e].unlock();for(this.boundBuffer=null,this.indexBuffer=null,this.attributesInvalidated=!0,this.enabledAttributes={},this.vertexBuffers=[],e=0,t=this.textures.length;e<t;e++){var i=this.textures[e];i.dirtyAll()}for(this.activeTexture=0,this.textureUnits.length=0,e=0;e<this.maxCombinedTextures;e++)this.textureUnits.push([null,null,null]);for(e=0,t=this.targets.length;e<t;e++)this.targets[e]._glFrameBuffer=void 0,this.targets[e]._glDepthBuffer=void 0,this.targets[e]._glResolveFrameBuffer=void 0,this.targets[e]._glMsaaColorBuffer=void 0,this.targets[e]._glMsaaDepthBuffer=void 0;this.renderTarget=null,this.activeFramebuffer=null,this.feedback=null,this.transformFeedbackBuffer=null},updateClientRect:function(){this.clientRect=this.canvas.getBoundingClientRect()},setViewport:function(e,t,i,n){this.vx===e&&this.vy===t&&this.vw===i&&this.vh===n||(this.gl.viewport(e,t,i,n),this.vx=e,this.vy=t,this.vw=i,this.vh=n)},setScissor:function(e,t,i,n){this.sx===e&&this.sy===t&&this.sw===i&&this.sh===n||(this.gl.scissor(e,t,i,n),this.sx=e,this.sy=t,this.sw=i,this.sh=n)},getProgramLibrary:function(){return this.programLib},setProgramLibrary:function(e){this.programLib=e},setFramebuffer:function(e){this.activeFramebuffer!==e&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e),this.activeFramebuffer=e)},_checkFbo:function(){var e=this.gl,t=e.checkFramebufferStatus(e.FRAMEBUFFER);switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("ERROR: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case e.FRAMEBUFFER_UNSUPPORTED:console.error("ERROR: FRAMEBUFFER_UNSUPPORTED");break;case e.FRAMEBUFFER_COMPLETE:}},copyRenderTarget:function(e,t,i,r){var s=this.gl;if(!this.webgl2&&r)return!1;if(i)if(t){if(!e._colorBuffer||!t._colorBuffer)return!1;if(e._colorBuffer._format!==t._colorBuffer._format)return!1}else if(!e._colorBuffer)return!1;if(r){if(!e._depthBuffer||!t._depthBuffer)return!1;if(e._depthBuffer._format!==t._depthBuffer._format)return!1}if(this.webgl2&&t){var a=this.renderTarget;this.renderTarget=t,this.updateBegin(),s.bindFramebuffer(s.READ_FRAMEBUFFER,e?e._glFrameBuffer:null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,t._glFrameBuffer);var o=e?e.width:t.width,h=e?e.height:t.height;s.blitFramebuffer(0,0,o,h,0,0,o,h,(i?s.COLOR_BUFFER_BIT:0)|(r?s.DEPTH_BUFFER_BIT:0),s.NEAREST),this.renderTarget=a,s.bindFramebuffer(s.FRAMEBUFFER,a?a._glFrameBuffer:null)}else{if(!this._copyShader){var l=n.shaderChunks;this._copyShader=l.createShaderFromCode(this,l.fullscreenQuadVS,l.outputTex2DPS,"outputTex2D")}this.constantTexSource.setValue(e._colorBuffer),n.drawQuadWithShader(this,t,this._copyShader)}return!0},updateBegin:function(){var e=this.gl;this.boundBuffer=null,this.indexBuffer=null;var t=this.renderTarget;if(t)if(t._glFrameBuffer)this.setFramebuffer(t._glFrameBuffer);else{t._device=this,t._glFrameBuffer=e.createFramebuffer(),this.setFramebuffer(t._glFrameBuffer);var i=t._colorBuffer;i&&(i._glTextureId||(i._width=Math.min(i.width,this.maxRenderBufferSize),i._height=Math.min(i.height,this.maxRenderBufferSize),this.setTexture(i,0)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,i._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,i._glTextureId,0));var n=t._depthBuffer;if(n&&this.webgl2)n._glTextureId||(n._width=Math.min(n.width,this.maxRenderBufferSize),n._height=Math.min(n.height,this.maxRenderBufferSize),this.setTexture(n,0)),t._stencil?e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,n._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,t._depthBuffer._glTextureId,0):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,n._cubemap?e.TEXTURE_CUBE_MAP_POSITIVE_X+t._face:e.TEXTURE_2D,t._depthBuffer._glTextureId,0);else if(t._depth){var r=t._samples>1&&this.webgl2;r||(t._glDepthBuffer||(t._glDepthBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glDepthBuffer),t._stencil?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t._glDepthBuffer)):(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t._glDepthBuffer)),e.bindRenderbuffer(e.RENDERBUFFER,null))}this.webgl2&&t._samples>1&&(t._glResolveFrameBuffer=t._glFrameBuffer,t._glFrameBuffer=e.createFramebuffer(),this.setFramebuffer(t._glFrameBuffer),i&&(t._glMsaaColorBuffer||(t._glMsaaColorBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glMsaaColorBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,i._glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,t._glMsaaColorBuffer)),t._depth&&(t._glMsaaDepthBuffer||(t._glMsaaDepthBuffer=e.createRenderbuffer()),e.bindRenderbuffer(e.RENDERBUFFER,t._glMsaaDepthBuffer),t._stencil?(e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,e.DEPTH24_STENCIL8,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t._glMsaaDepthBuffer)):(e.renderbufferStorageMultisample(e.RENDERBUFFER,t._samples,e.DEPTH_COMPONENT32F,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t._glMsaaDepthBuffer)))),this.targets.push(t)}else this.setFramebuffer(null)},updateEnd:function(){var e=this.gl,t=this.renderTarget;if(t){var i=t._colorBuffer;i&&i._glTextureId&&i.mipmaps&&i._pot&&(this.bindTexture(this.maxCombinedTextures-1,i._glTarget,i._glTextureId),e.generateMipmap(i._glTarget)),this.webgl2&&t._samples>1&&t.autoResolve&&t.resolve()}},initializeTexture:function(e){var t,i=this.gl;switch(e._glTextureId=i.createTexture(),e._glTarget=e._cubemap?i.TEXTURE_CUBE_MAP:e._volume?i.TEXTURE_3D:i.TEXTURE_2D,e._format){case n.PIXELFORMAT_A8:e._glFormat=i.ALPHA,e._glInternalFormat=i.ALPHA,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_L8:e._glFormat=i.LUMINANCE,e._glInternalFormat=i.LUMINANCE,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_L8_A8:e._glFormat=i.LUMINANCE_ALPHA,e._glInternalFormat=i.LUMINANCE_ALPHA,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_R5_G6_B5:e._glFormat=i.RGB,e._glInternalFormat=i.RGB,e._glPixelType=i.UNSIGNED_SHORT_5_6_5;break;case n.PIXELFORMAT_R5_G5_B5_A1:e._glFormat=i.RGBA,e._glInternalFormat=i.RGBA,e._glPixelType=i.UNSIGNED_SHORT_5_5_5_1;break;case n.PIXELFORMAT_R4_G4_B4_A4:e._glFormat=i.RGBA,e._glInternalFormat=i.RGBA,e._glPixelType=i.UNSIGNED_SHORT_4_4_4_4;break;case n.PIXELFORMAT_R8_G8_B8:e._glFormat=i.RGB,e._glInternalFormat=this.webgl2?i.RGB8:i.RGB,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_R8_G8_B8_A8:e._glFormat=i.RGBA,e._glInternalFormat=this.webgl2?i.RGBA8:i.RGBA,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_DXT1:t=this.extCompressedTextureS3TC,e._glFormat=i.RGB,e._glInternalFormat=t.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case n.PIXELFORMAT_DXT3:t=this.extCompressedTextureS3TC,e._glFormat=i.RGBA,e._glInternalFormat=t.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n.PIXELFORMAT_DXT5:t=this.extCompressedTextureS3TC,e._glFormat=i.RGBA,e._glInternalFormat=t.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case n.PIXELFORMAT_ETC1:t=this.extCompressedTextureETC1,e._glFormat=i.RGB,e._glInternalFormat=t.COMPRESSED_RGB_ETC1_WEBGL;break;case n.PIXELFORMAT_PVRTC_2BPP_RGB_1:t=this.extCompressedTexturePVRTC,e._glFormat=i.RGB,e._glInternalFormat=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case n.PIXELFORMAT_PVRTC_2BPP_RGBA_1:t=this.extCompressedTexturePVRTC,e._glFormat=i.RGBA,e._glInternalFormat=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case n.PIXELFORMAT_PVRTC_4BPP_RGB_1:t=this.extCompressedTexturePVRTC,e._glFormat=i.RGB,e._glInternalFormat=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case n.PIXELFORMAT_PVRTC_4BPP_RGBA_1:t=this.extCompressedTexturePVRTC,e._glFormat=i.RGBA,e._glInternalFormat=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;case n.PIXELFORMAT_RGB16F:t=this.extTextureHalfFloat,e._glFormat=i.RGB,this.webgl2?(e._glInternalFormat=i.RGB16F,e._glPixelType=i.HALF_FLOAT):(e._glInternalFormat=i.RGB,e._glPixelType=t.HALF_FLOAT_OES);break;case n.PIXELFORMAT_RGBA16F:t=this.extTextureHalfFloat,e._glFormat=i.RGBA,this.webgl2?(e._glInternalFormat=i.RGBA16F,e._glPixelType=i.HALF_FLOAT):(e._glInternalFormat=i.RGBA,e._glPixelType=t.HALF_FLOAT_OES);break;case n.PIXELFORMAT_RGB32F:e._glFormat=i.RGB,this.webgl2?e._glInternalFormat=i.RGB32F:e._glInternalFormat=i.RGB,e._glPixelType=i.FLOAT;break;case n.PIXELFORMAT_RGBA32F:e._glFormat=i.RGBA,this.webgl2?e._glInternalFormat=i.RGBA32F:e._glInternalFormat=i.RGBA,e._glPixelType=i.FLOAT;break;case n.PIXELFORMAT_R32F:e._glFormat=i.RED,e._glInternalFormat=i.R32F,e._glPixelType=i.FLOAT;break;case n.PIXELFORMAT_DEPTH:this.webgl2?(e._glFormat=i.DEPTH_COMPONENT,e._glInternalFormat=i.DEPTH_COMPONENT32F,e._glPixelType=i.FLOAT):(e._glFormat=i.DEPTH_COMPONENT,e._glInternalFormat=i.DEPTH_COMPONENT,e._glPixelType=i.UNSIGNED_SHORT);break;case n.PIXELFORMAT_DEPTHSTENCIL:e._glFormat=i.DEPTH_STENCIL,e._glInternalFormat=i.DEPTH24_STENCIL8,e._glPixelType=i.UNSIGNED_INT_24_8;break;case n.PIXELFORMAT_111110F:e._glFormat=i.RGB,e._glInternalFormat=i.R11F_G11F_B10F,e._glPixelType=i.FLOAT;break;case n.PIXELFORMAT_SRGB:e._glFormat=i.RGB,e._glInternalFormat=i.SRGB8,e._glPixelType=i.UNSIGNED_BYTE;break;case n.PIXELFORMAT_SRGBA:e._glFormat=i.RGBA,e._glInternalFormat=i.SRGB8_ALPHA8,e._glPixelType=i.UNSIGNED_BYTE}},uploadTexture:function(e){var t=this.gl;if(e._needsUpload||!(e._needsMipmapsUpload&&e._mipmapsUploaded||!e._pot)){for(var i,n,r=0;e._levels[r]||0===r;)if(e._needsUpload||0!==r){if(r&&(!e._needsMipmapsUpload||!e._mipmaps))break;if(i=e._levels[r],1!=r||e._compressed||(t.generateMipmap(e._glTarget),e._mipmapsUploaded=!0),e._cubemap){var a;if(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i[0]instanceof HTMLCanvasElement||i[0]instanceof HTMLImageElement||i[0]instanceof HTMLVideoElement){for(a=0;a<6;a++)if(e._levelsUpdated[0][a]){var o=i[a];o instanceof HTMLImageElement&&(o.width>this.maxCubeMapSize||o.height>this.maxCubeMapSize)&&(o=s(o,this.maxCubeMapSize),0===r&&(e.width=o.width,e.height=o.height)),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,e._glInternalFormat,e._glFormat,e._glPixelType,o)}}else for(n=1/Math.pow(2,r),a=0;a<6;a++)if(e._levelsUpdated[0][a]){var h=i[a];e._compressed?t.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),0,h):t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+a,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),0,e._glFormat,e._glPixelType,h)}}else e._volume?(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),n=1/Math.pow(2,r),e._compressed?t.compressedTexImage3D(t.TEXTURE_3D,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),Math.max(e._depth*n,1),0,i):t.texImage3D(t.TEXTURE_3D,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),Math.max(e._depth*n,1),0,e._glFormat,e._glPixelType,i)):(i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof HTMLVideoElement?(i instanceof HTMLImageElement&&(i.width>this.maxTextureSize||i.height>this.maxTextureSize)&&(i=s(i,this.maxTextureSize),0===r&&(e.width=i.width,e.height=i.height)),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e._flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.texImage2D(t.TEXTURE_2D,r,e._glInternalFormat,e._glFormat,e._glPixelType,i)):(t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),n=1/Math.pow(2,r),e._compressed?t.compressedTexImage2D(t.TEXTURE_2D,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),0,i):t.texImage2D(t.TEXTURE_2D,r,e._glInternalFormat,Math.max(e._width*n,1),Math.max(e._height*n,1),0,e._glFormat,e._glPixelType,i)),0===r?e._mipmapsUploaded=!1:e._mipmapsUploaded=!0);r++}else r++;if(e._needsUpload)if(e._cubemap)for(var l=0;l<6;l++)e._levelsUpdated[0][l]=!1;else e._levelsUpdated[0]=!1;!e._compressed&&e._mipmaps&&e._needsMipmapsUpload&&e._pot&&1===e._levels.length&&(t.generateMipmap(e._glTarget),e._mipmapsUploaded=!0),e._gpuSize&&(this._vram.tex-=e._gpuSize),e._gpuSize=e.gpuSize,this._vram.tex+=e._gpuSize}},bindTexture:function(e,t,i){var n=this.targetToSlot[t];if(this.textureUnits[e][n]!==i){var r=this.gl;this.activeTexture!==e&&(r.activeTexture(r.TEXTURE0+e),this.activeTexture=e),r.bindTexture(t,i),this.textureUnits[e][n]=i}},setTexture:function(e,t){var i=this.gl;e._glTextureId||this.initializeTexture(e),this.bindTexture(t,e._glTarget,e._glTextureId);var r=e._minFilterDirty||e._magFilterDirty||e._addressUDirty||e._addressVDirty||e._addressWDirty||e._anisotropyDirty||e._compareModeDirty;if(r){if(e._minFilterDirty){var s=e._minFilter;(!e._pot||!e._mipmaps||e._compressed&&1===e._levels.length)&&(s===n.FILTER_NEAREST_MIPMAP_NEAREST||s===n.FILTER_NEAREST_MIPMAP_LINEAR?s=n.FILTER_NEAREST:s!==n.FILTER_LINEAR_MIPMAP_NEAREST&&s!==n.FILTER_LINEAR_MIPMAP_LINEAR||(s=n.FILTER_LINEAR)),i.texParameteri(e._glTarget,i.TEXTURE_MIN_FILTER,this.glFilter[s]),e._minFilterDirty=!1}if(e._magFilterDirty&&(i.texParameteri(e._glTarget,i.TEXTURE_MAG_FILTER,this.glFilter[e._magFilter]),e._magFilterDirty=!1),e._addressUDirty&&(this.webgl2?i.texParameteri(e._glTarget,i.TEXTURE_WRAP_S,this.glAddress[e._addressU]):i.texParameteri(e._glTarget,i.TEXTURE_WRAP_S,this.glAddress[e._pot?e._addressU:n.ADDRESS_CLAMP_TO_EDGE]),e._addressUDirty=!1),e._addressVDirty&&(this.webgl2?i.texParameteri(e._glTarget,i.TEXTURE_WRAP_T,this.glAddress[e._addressV]):i.texParameteri(e._glTarget,i.TEXTURE_WRAP_T,this.glAddress[e._pot?e._addressV:n.ADDRESS_CLAMP_TO_EDGE]),e._addressVDirty=!1),e._addressWDirty&&(this.webgl2&&i.texParameteri(e._glTarget,i.TEXTURE_WRAP_R,this.glAddress[e._addressW]),e._addressWDirty=!1),e._compareModeDirty&&(this.webgl2&&(i.texParameteri(e._glTarget,i.TEXTURE_COMPARE_MODE,e._compareOnRead?i.COMPARE_REF_TO_TEXTURE:i.NONE),i.texParameteri(e._glTarget,i.TEXTURE_COMPARE_FUNC,this.glComparison[e._compareFunc])),e._compareModeDirty=!1),e._anisotropyDirty){var a=this.extTextureFilterAnisotropic;a&&i.texParameterf(e._glTarget,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.max(1,Math.min(Math.round(e._anisotropy),this.maxAnisotropy))),e._anisotropyDirty=!1}}(e._needsUpload||e._needsMipmapsUpload)&&(this.uploadTexture(e),e._needsUpload=!1,e._needsMipmapsUpload=!1)},draw:function(e,t){var i,r,s,a,o,h,l,c,d,u,f,p,_=this.gl,m=this.shader,A=m.samplers,v=m.uniforms;if(t>1&&(this.boundBuffer=null,this.attributesInvalidated=!0),this.attributesInvalidated){var y,g,b,E,T,S=m.attributes;for(i=0,s=S.length;i<s;i++)y=S[i],g=y.scopeId.value,null!==g&&(b=this.vertexBuffers[g.stream],E=this.vbOffsets[g.stream]||0,T=b.bufferId,this.boundBuffer!==T&&(_.bindBuffer(_.ARRAY_BUFFER,T),this.boundBuffer=T),p=y.locationId,this.enabledAttributes[p]||(_.enableVertexAttribArray(p),this.enabledAttributes[p]=!0),_.vertexAttribPointer(p,g.numComponents,this.glType[g.dataType],g.normalize,g.stride,g.offset+E),1===g.stream&&t>1?this.instancedAttribs[p]||(this.extInstancing.vertexAttribDivisorANGLE(p,1),this.instancedAttribs[p]=!0):this.instancedAttribs[p]&&(this.extInstancing.vertexAttribDivisorANGLE(p,0),this.instancedAttribs[p]=!1));this.attributesInvalidated=!1}var w=0;for(i=0,s=A.length;i<s;i++)if(a=A[i],o=a.scopeId.value)if(o instanceof n.Texture)h=o,this.setTexture(h,w),a.slot!==w&&(_.uniform1i(a.locationId,w),a.slot=w),w++;else{for(a.array.length=0,l=o.length,r=0;r<l;r++)h=o[r],this.setTexture(h,w),a.array[r]=w,w++;_.uniform1iv(a.locationId,a.array)}for(i=0,s=v.length;i<s;i++)c=v[i],d=c.scopeId,u=c.version,f=d.versionObject.version,u.globalId===f.globalId&&u.revision===f.revision||(u.globalId=f.globalId,u.revision=f.revision,null!==d.value&&this.commitFunction[c.dataType](c,d.value));this._drawCallsPerFrame++,this._primsPerFrame[e.type]+=e.count*(t>1?t:1),this.webgl2&&this.transformFeedbackBuffer&&(_.bindBufferBase(_.TRANSFORM_FEEDBACK_BUFFER,0,this.transformFeedbackBuffer.bufferId),_.beginTransformFeedback(_.POINTS)),e.indexed?t>1?(this.extInstancing.drawElementsInstancedANGLE(this.glPrimitive[e.type],e.count,this.indexBuffer.glFormat,2*e.base,t),this.boundBuffer=null,this.attributesInvalidated=!0):_.drawElements(this.glPrimitive[e.type],e.count,this.indexBuffer.glFormat,e.base*this.indexBuffer.bytesPerIndex):t>1?(this.extInstancing.drawArraysInstancedANGLE(this.glPrimitive[e.type],e.base,e.count,t),this.boundBuffer=null,this.attributesInvalidated=!0):_.drawArrays(this.glPrimitive[e.type],e.base,e.count),this.webgl2&&this.transformFeedbackBuffer&&(_.endTransformFeedback(),_.bindBufferBase(_.TRANSFORM_FEEDBACK_BUFFER,0,null))},clear:function(e){var t=this.defaultClearOptions;e=e||t;var i=void 0==e.flags?t.flags:e.flags;if(0!==i){var r=this.gl;if(i&n.CLEARFLAG_COLOR){var s=void 0==e.color?t.color:e.color;this.setClearColor(s[0],s[1],s[2],s[3])}if(i&n.CLEARFLAG_DEPTH){var a=void 0==e.depth?t.depth:e.depth;this.setClearDepth(a),this.depthWrite||r.depthMask(!0)}if(i&n.CLEARFLAG_STENCIL){var o=void 0==e.stencil?t.stencil:e.stencil;this.setClearStencil(o)}r.clear(this.glClearFlag[i]),i&n.CLEARFLAG_DEPTH&&(this.depthWrite||r.depthMask(!1))}},readPixels:function(e,t,i,n,r){var s=this.gl;s.readPixels(e,t,i,n,s.RGBA,s.UNSIGNED_BYTE,r)},setClearDepth:function(e){e!==this.clearDepth&&(this.gl.clearDepth(e),this.clearDepth=e)},setClearColor:function(e,t,i,n){e===this.clearRed&&t===this.clearGreen&&i===this.clearBlue&&n===this.clearAlpha||(this.gl.clearColor(e,t,i,n),this.clearRed=e,this.clearGreen=t,this.clearBlue=i,this.clearAlpha=n)},setClearStencil:function(e){e!==this.clearStencil&&(this.gl.clearStencil(e),this.clearStencil=e)},setRenderTarget:function(e){this.renderTarget=e},getRenderTarget:function(){return this.renderTarget},getDepthTest:function(){return this.depthTest},setDepthTest:function(e){if(this.depthTest!==e){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.depthTest=e}},setDepthFunc:function(e){this.depthFunc!==e&&(this.gl.depthFunc(this.glComparison[e]),this.depthFunc=e)},getDepthWrite:function(){return this.depthWrite},setDepthWrite:function(e){this.depthWrite!==e&&(this.gl.depthMask(e),this.depthWrite=e)},setColorWrite:function(e,t,i,n){this.writeRed===e&&this.writeGreen===t&&this.writeBlue===i&&this.writeAlpha===n||(this.gl.colorMask(e,t,i,n),this.writeRed=e,this.writeGreen=t,this.writeBlue=i,this.writeAlpha=n)},setAlphaToCoverage:function(e){this.webgl2&&this.alphaToCoverage!==e&&(this.alphaToCoverage=e,e?this.gl.enable(this.gl.SAMPLE_ALPHA_TO_COVERAGE):this.gl.disable(this.gl.SAMPLE_ALPHA_TO_COVERAGE))},setTransformFeedbackBuffer:function(e){if(this.transformFeedbackBuffer!==e&&(this.transformFeedbackBuffer=e,this.webgl2)){var t=this.gl;e?(this.feedback||(this.feedback=t.createTransformFeedback()),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,this.feedback)):t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}},setRaster:function(e){this.raster!==e&&(this.raster=e,this.webgl2&&(e?this.gl.disable(this.gl.RASTERIZER_DISCARD):this.gl.enable(this.gl.RASTERIZER_DISCARD)))},setDepthBias:function(e){this.depthBiasEnabled!==e&&(this.depthBiasEnabled=e,e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL))},setDepthBiasValues:function(e,t){this.gl.polygonOffset(t,e)},getBlending:function(){return this.blending},setBlending:function(e){if(this.blending!==e){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.blending=e}},setStencilTest:function(e){if(this.stencil!==e){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.stencil=e}},setStencilFunc:function(e,t,i){if(this.stencilFuncFront!==e||this.stencilRefFront!==t||this.stencilMaskFront!==i||this.stencilFuncBack!==e||this.stencilRefBack!==t||this.stencilMaskBack!==i){var n=this.gl;n.stencilFunc(this.glComparison[e],t,i),this.stencilFuncFront=this.stencilFuncBack=e,this.stencilRefFront=this.stencilRefBack=t,this.stencilMaskFront=this.stencilMaskBack=i}},setStencilFuncFront:function(e,t,i){if(this.stencilFuncFront!==e||this.stencilRefFront!==t||this.stencilMaskFront!==i){var n=this.gl;n.stencilFuncSeparate(n.FRONT,this.glComparison[e],t,i),this.stencilFuncFront=e,this.stencilRefFront=t,this.stencilMaskFront=i}},setStencilFuncBack:function(e,t,i){if(this.stencilFuncBack!==e||this.stencilRefBack!==t||this.stencilMaskBack!==i){var n=this.gl;n.stencilFuncSeparate(n.BACK,this.glComparison[e],t,i),this.stencilFuncBack=e,this.stencilRefBack=t,this.stencilMaskBack=i}},setStencilOperation:function(e,t,i,n){this.stencilFailFront===e&&this.stencilZfailFront===t&&this.stencilZpassFront===i&&this.stencilFailBack===e&&this.stencilZfailBack===t&&this.stencilZpassBack===i||(this.gl.stencilOp(this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailFront=this.stencilFailBack=e,this.stencilZfailFront=this.stencilZfailBack=t,this.stencilZpassFront=this.stencilZpassBack=i),this.stencilWriteMaskFront===n&&this.stencilWriteMaskBack===n||(this.gl.stencilMask(n),this.stencilWriteMaskFront=n,this.stencilWriteMaskBack=n)},setStencilOperationFront:function(e,t,i,n){this.stencilFailFront===e&&this.stencilZfailFront===t&&this.stencilZpassFront===i||(this.gl.stencilOpSeparate(this.gl.FRONT,this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailFront=e,this.stencilZfailFront=t,this.stencilZpassFront=i),this.stencilWriteMaskFront!==n&&(this.gl.stencilMaskSeparate(this.gl.FRONT,n),this.stencilWriteMaskFront=n)},setStencilOperationBack:function(e,t,i,n){this.stencilFailBack===e&&this.stencilZfailBack===t&&this.stencilZpassBack===i||(this.gl.stencilOpSeparate(this.gl.BACK,this.glStencilOp[e],this.glStencilOp[t],this.glStencilOp[i]),this.stencilFailBack=e,this.stencilZfailBack=t,this.stencilZpassBack=i),this.stencilWriteMaskBack!==n&&(this.gl.stencilMaskSeparate(this.gl.BACK,n),this.stencilWriteMaskBack=n)},setBlendFunction:function(e,t){(this.blendSrc!==e||this.blendDst!==t||this.separateAlphaBlend)&&(this.gl.blendFunc(this.glBlendFunction[e],this.glBlendFunction[t]),this.blendSrc=e,this.blendDst=t,this.separateAlphaBlend=!1)},setBlendFunctionSeparate:function(e,t,i,n){this.blendSrc===e&&this.blendDst===t&&this.blendSrcAlpha===i&&this.blendDstAlpha===n&&this.separateAlphaBlend||(this.gl.blendFuncSeparate(this.glBlendFunction[e],this.glBlendFunction[t],this.glBlendFunction[i],this.glBlendFunction[n]),this.blendSrc=e,this.blendDst=t,this.blendSrcAlpha=i,this.blendDstAlpha=n,this.separateAlphaBlend=!0)},setBlendEquation:function(e){(this.blendEquation!==e||this.separateAlphaEquation)&&(this.gl.blendEquation(this.glBlendEquation[e]),this.blendEquation=e,this.separateAlphaEquation=!1)},setBlendEquationSeparate:function(e,t){this.blendEquation===e&&this.blendAlphaEquation===t&&this.separateAlphaEquation||(this.gl.blendEquationSeparate(this.glBlendEquation[e],this.glBlendEquation[t]),this.blendEquation=e,this.blendAlphaEquation=t,this.separateAlphaEquation=!0)},setCullMode:function(e){if(this.cullMode!==e){if(e===n.CULLFACE_NONE)this.gl.disable(this.gl.CULL_FACE);else{this.cullMode===n.CULLFACE_NONE&&this.gl.enable(this.gl.CULL_FACE);var t=this.glCull[e];this.cullFace!==t&&(this.gl.cullFace(t),this.cullFace=t)}this.cullMode=e}},getCullMode:function(){return this.cullMode},setIndexBuffer:function(e){if(this.indexBuffer!==e){this.indexBuffer=e;var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e?e.bufferId:null)}},setVertexBuffer:function(e,t,i){if(this.vertexBuffers[t]!==e||this.vbOffsets[t]!==i){this.vertexBuffers[t]=e,this.vbOffsets[t]=i;for(var n=e.getFormat(),r=0,s=n.elements,a=s.length;r<a;){var o=s[r++];o.stream=t,o.scopeId.setValue(o)}this.attributesInvalidated=!0}},setShader:function(e){if(e!==this.shader){if(this.shader=e,!e.ready&&!e.link())return!1;this._shaderSwitchesPerFrame++,this.gl.useProgram(e.program),this.attributesInvalidated=!0}return!0},getHdrFormat:function(){return this.extTextureHalfFloatRenderable?n.PIXELFORMAT_RGB16F:this.extTextureFloatRenderable?n.PIXELFORMAT_RGB32F:n.PIXELFORMAT_R8_G8_B8_A8},getBoneLimit:function(){return this.boneLimit},setBoneLimit:function(e){this.boneLimit=e},enableValidation:function(e){console.warn("enableValidation: This function is deprecated and will be removed shortly.")},validate:function(){console.warn("validate: This function is deprecated and will be removed shortly.")},resizeCanvas:function(e,t){this._width=e,this._height=t;var i=Math.min(this._maxPixelRatio,window.devicePixelRatio);e*=i,t*=i,this.canvas.width=e,this.canvas.height=t,this.fire(r,e,t)},setResolution:function(e,t){this._width=e,this._height=t,this.canvas.width=e,this.canvas.height=t,this.fire(r,e,t)},clearShaderCache:function(){this.programLib.clearCache()},removeShaderFromCache:function(e){this.programLib.removeFromCache(e)},destroy:function(){this.webgl2&&this.feedback&&this.gl.deleteTransformFeedback(this.feedback)}}),Object.defineProperty(a.prototype,"width",{get:function(){return this.gl.drawingBufferWidth||this.canvas.width}}),Object.defineProperty(a.prototype,"height",{get:function(){return this.gl.drawingBufferHeight||this.canvas.height}}),Object.defineProperty(a.prototype,"fullscreen",{get:function(){return!!document.fullscreenElement},set:function(e){if(e){var t=this.gl.canvas;t.requestFullscreen()}else document.exitFullscreen()}}),Object.defineProperty(a.prototype,"enableAutoInstancing",{get:function(){return this._enableAutoInstancing},set:function(e){this._enableAutoInstancing=e&&this.extInstancing}}),Object.defineProperty(a.prototype,"maxAnisotropy",{get:function(){var e;return function(){if(void 0===e){e=1;var t=this.gl,i=this.extTextureFilterAnisotropic;i&&(e=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}return e}}()}),Object.defineProperty(a.prototype,"maxPixelRatio",{get:function(){return this._maxPixelRatio},set:function(e){this._maxPixelRatio=e,this.resizeCanvas(this._width,this._height)}}),{GraphicsDevice:a,precalculatedTangents:!0}}()),Object.assign(n,function(){var e={},t={vertex_position:n.SEMANTIC_POSITION,vertex_normal:n.SEMANTIC_NORMAL,vertex_tangent:n.SEMANTIC_TANGENT,vertex_texCoord0:n.SEMANTIC_TEXCOORD0,vertex_texCoord1:n.SEMANTIC_TEXCOORD1,vertex_texCoord2:n.SEMANTIC_TEXCOORD2,vertex_texCoord3:n.SEMANTIC_TEXCOORD3,vertex_texCoord4:n.SEMANTIC_TEXCOORD4,vertex_texCoord5:n.SEMANTIC_TEXCOORD5,vertex_texCoord6:n.SEMANTIC_TEXCOORD6,vertex_texCoord7:n.SEMANTIC_TEXCOORD7,vertex_color:n.SEMANTIC_COLOR,vertex_boneIndices:n.SEMANTIC_BLENDINDICES,vertex_boneWeights:n.SEMANTIC_BLENDWEIGHT};return e.collectAttribs=function(e){for(var i={},n=0,r=e.indexOf("attribute");r>=0&&!(r>0&&"/"===e[r-1]);){var s=e.indexOf(";",r),a=e.lastIndexOf(" ",s),o=e.substr(a+1,s-(a+1)),h=t[o];void 0!==h?i[o]=h:(i[o]="ATTR"+n,n++),r=e.indexOf("attribute",r+1)}return i},e.createShader=function(t,i,r,s){var a=e[i],o=n.programlib.precisionCode(t)+"\n"+e[r],h=this.collectAttribs(a);return t.webgl2&&(a=n.programlib.versionCode(t)+this.gles3VS+a,o=n.programlib.versionCode(t)+this.gles3PS+o),new n.Shader(t,{attributes:h,vshader:a,fshader:o,useTransformFeedback:s})},e.createShaderFromCode=function(e,t,i,r,s){var a=e.programLib._cache,o=a[r];if(void 0!==o)return o;i=n.programlib.precisionCode(e)+"\n"+(i||n.programlib.dummyFragmentCode());var h=this.collectAttribs(t);return e.webgl2&&(t=n.programlib.versionCode(e)+this.gles3VS+t,i=n.programlib.versionCode(e)+this.gles3PS+i),a[r]=new n.Shader(e,{attributes:h,vshader:t,fshader:i,useTransformFeedback:s}),a[r]},{shaderChunks:e}}()),Object.assign(n,function(){function e(e,t,s,a,o,h){if(null===i){var l=new n.VertexFormat(e,[{semantic:n.SEMANTIC_POSITION,components:2,type:n.TYPE_FLOAT32}]);i=new n.VertexBuffer(e,l,4);var c=new n.VertexIterator(i);c.element[n.SEMANTIC_POSITION].set(-1,-1),c.next(),c.element[n.SEMANTIC_POSITION].set(1,-1),c.next(),c.element[n.SEMANTIC_POSITION].set(-1,1),c.next(),c.element[n.SEMANTIC_POSITION].set(1,1),c.end()}var d=e.renderTarget;e.setRenderTarget(t),e.updateBegin();var u,f,p,_,m,A,v,y;a?(u=a.x,f=a.y,p=a.z,_=a.w):(p=t?t.width:e.width,_=t?t.height:e.height,u=0,f=0),o?(m=o.x,A=o.y,v=o.z,y=o.w):(m=u,A=f,v=p,y=_),e.setViewport(u,f,p,_),e.setScissor(m,A,v,y);var g=e.getDepthTest(),b=e.getDepthWrite(),E=e.getCullMode();e.setDepthTest(!1),e.setDepthWrite(!1),e.setCullMode(n.CULLFACE_NONE),h||e.setBlending(!1),e.setVertexBuffer(i,0),e.setShader(s),e.draw(r),e.setDepthTest(g),e.setDepthWrite(b),e.setCullMode(E),e.updateEnd(),e.setRenderTarget(d),e.updateBegin()}function t(){i=null}var i=null,r={type:n.PRIMITIVE_TRISTRIP,base:0,count:4,indexed:!1};return{drawQuadWithShader:e,destroyPostEffectQuad:t}}()),Object.assign(n,function(){function e(e,t,i){var r=t._colorBuffer;if(r.format==n.PIXELFORMAT_R8_G8_B8_A8){var s=new Uint8Array(r.width*r.height*4),a=e.gl;e.setFramebuffer(t._glFrameBuffer),a.readPixels(0,0,r.width,r.height,a.RGBA,a.UNSIGNED_BYTE,s),r._levels||(r._levels=[]),r._levels[0]||(r._levels[0]=[]),r._levels[0][i]=s}}function t(t){var i=t.device,r=t.sourceCubemap,s=t.method,a=t.samples,o=t.cpuSync;if(o&&!r._levels[0])return void console.error("ERROR: prefilter: cubemap must have _levels");var h,l,c,d,u,f,p=n.shaderChunks,_=r.rgbm,m=p.createShaderFromCode(i,p.fullscreenQuadVS,p.rgbmPS+p.prefilterCubemapPS.replace(/\$METHOD/g,0===s?"cos":"phong").replace(/\$NUMSAMPLES/g,a).replace(/\$textureCube/g,_?"textureCubeRGBM":"textureCube"),"prefilter"+s+a+_),A=p.createShaderFromCode(i,p.fullscreenQuadVS,p.outputCubemapPS,"outputCubemap"),v=i.scope.resolve("source"),y=i.scope.resolve("params"),g=new n.Vec4,b=r.width,E=r.format,T=[[],t.filteredFixed,t.filteredRgbm,t.filteredFixedRgbm],S=0===s?[.9,.85,.7,.4,.25]:[512,128,32,8,2],w=[64,32,16,8,4],C=5,M=E===n.PIXELFORMAT_R8_G8_B8,P=!1;
if(o&&(P=r._levels[0][0]instanceof HTMLImageElement),(M||P)&&o){for(E=n.PIXELFORMAT_R8_G8_B8_A8,u=new n.gfx.Texture(i,{cubemap:!0,rgbm:_,format:E,width:b,height:b,mipmaps:!1}),c=0;c<6;c++)h=new n.RenderTarget(i,u,{face:c,depth:!1}),g.x=c,g.y=0,v.setValue(r),y.setValue(g.data),n.drawQuadWithShader(i,h,A),e(i,h,c);r=u}if(b>128){var I=Math.round(Math.log2(128)),R=Math.round(Math.log2(b)),x=R-I;for(l=0;l<x;l++){b=.5*r.width;var O=0===s?1:Math.pow(2,Math.round(Math.log2(S[0])+2*(x-l)));for(u=new n.gfx.Texture(i,{cubemap:!0,rgbm:_,format:E,width:b,height:b,mipmaps:!1}),c=0;c<6;c++)h=new n.RenderTarget(i,u,{face:c,depth:!1}),g.x=c,g.y=O,g.z=b,g.w=_?3:0,v.setValue(r),y.setValue(g.data),n.drawQuadWithShader(i,h,A),l===x-1&&o&&e(i,h,c);r=u}}t.sourceCubemap=r;var k=null;if(!_&&t.filteredFixedRgbm){for(u=new n.gfx.Texture(i,{cubemap:!0,rgbm:!0,format:n.PIXELFORMAT_R8_G8_B8_A8,width:b,height:b,mipmaps:!1}),c=0;c<6;c++)h=new n.RenderTarget(i,u,{face:c,depth:!1}),g.x=c,g.w=2,v.setValue(r),y.setValue(g.data),n.drawQuadWithShader(i,h,A),e(i,h,c);k=u}var D=0===s?1:2048,L=0===s?0:-1;for(T[L]=[],l=0;l<C;l++)for(d=L;d<T.length;d++)null!=T[d]&&(T[d][l]=new n.gfx.Texture(i,{cubemap:!0,rgbm:!(d<2)||_,format:d<2?E:n.PIXELFORMAT_R8_G8_B8_A8,fixCubemapSeams:1===d||3===d,width:w[l],height:w[l],mipmaps:!1}));for(d=L;d<T.length;d++)if(null!=T[d]){if(d>1&&_){T[d]=T[d-2];continue}for(l=0;l<C;l++)for(c=0;c<6;c++)h=new n.RenderTarget(i,T[d][l],{face:c,depth:!1}),g.x=c,g.y=d<0?D:S[l],g.z=w[l],g.w=_?3:d,v.setValue(0===l?r:0===s?T[0][l-1]:T[-1][l-1]),y.setValue(g.data),n.drawQuadWithShader(i,h,m),o&&e(i,h,c)}t.filtered=T[0];var N;if(o&&t.singleFilteredFixed){for(N=[r,t.filteredFixed[0],t.filteredFixed[1],t.filteredFixed[2],t.filteredFixed[3],t.filteredFixed[4],t.filteredFixed[5]],f=new n.gfx.Texture(i,{cubemap:!0,rgbm:_,fixCubemapSeams:!0,format:E,width:128,height:128,addressU:n.ADDRESS_CLAMP_TO_EDGE,addressV:n.ADDRESS_CLAMP_TO_EDGE}),l=0;l<6;l++)f._levels[l]=N[l]._levels[0];f.upload(),f._prefilteredMips=!0,t.singleFilteredFixed=f}if(o&&t.singleFilteredFixedRgbm&&t.filteredFixedRgbm){for(N=[k,t.filteredFixedRgbm[0],t.filteredFixedRgbm[1],t.filteredFixedRgbm[2],t.filteredFixedRgbm[3],t.filteredFixedRgbm[4],t.filteredFixedRgbm[5]],f=new n.gfx.Texture(i,{cubemap:!0,rgbm:!0,fixCubemapSeams:!0,format:n.PIXELFORMAT_R8_G8_B8_A8,width:128,height:128,addressU:n.ADDRESS_CLAMP_TO_EDGE,addressV:n.ADDRESS_CLAMP_TO_EDGE}),l=0;l<6;l++)f._levels[l]=N[l]._levels[0];f.upload(),f._prefilteredMips=!0,t.singleFilteredFixedRgbm=f}}function i(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}function r(e,t,n){var r=2*(e+.5)/n-1,s=2*(t+.5)/n-1;r*=1-1/n,s*=1-1/n;var a=1/n,o=r-a,h=s-a,l=r+a,c=s+a,d=i(o,h)-i(o,c)-i(l,h)+i(l,c);return 0===e&&0===t||e===n-1&&0===t||0===e&&t===n-1||e===n-1&&t===n-1?d/=3:0!==e&&0!==t&&e!==n-1&&t!==n-1||(d*=.5),d}function s(e,t){var i,s,a,o=e.width;if(e.format!=n.PIXELFORMAT_R8_G8_B8_A8)return void console.error("ERROR: SH: cubemap must be RGBA8");if(!e._levels[0])return void console.error("ERROR: SH: cubemap must be synced to CPU");if(!e._levels[0][0].length){if(!(e._levels[0][0]instanceof HTMLImageElement))return void console.error("ERROR: SH: cubemap must be composed of arrays or images");var h=n.Application.getApplication().graphicsDevice,l=h.gl,c=n.shaderChunks,d=c.createShaderFromCode(h,c.fullscreenQuadVS,c.fullscreenQuadPS,"fsQuadSimple"),u=h.scope.resolve("source");for(i=0;i<6;i++){var f=e._levels[0][i],p=new n.Texture(h,{cubemap:!1,rgbm:!1,format:e.format,width:o,height:o,mipmaps:!1});p._levels[0]=f,p.upload();var _=new n.Texture(h,{cubemap:!1,rgbm:!1,format:e.format,width:o,height:o,mipmaps:!1}),m=new n.RenderTarget(h,_,{depth:!1});u.setValue(p),n.drawQuadWithShader(h,m,d);var A=new Uint8Array(o*o*4);l.bindFramebuffer(l.FRAMEBUFFER,m._glFrameBuffer),l.readPixels(0,0,p.width,p.height,l.RGBA,l.UNSIGNED_BYTE,A),e._levels[0][i]=A}}var v=[];for(a=0;a<o;a++)for(s=0;s<o;s++){var y=s/(o-1)*2-1,g=a/(o-1)*2-1;v[a*o+s]=new n.Vec3(y,g,1).normalize()}var b,E,T,S,w,C,M,P,I,R,x,O,k,D,L=new Float32Array(27),N=0,F=3,B=6,V=9,U=12,G=15,W=18,z=21,H=24,j=0,Y=1,X=2,Z=3,K=4,Q=5,J=0;for(i=0;i<6;i++)for(a=0;a<o;a++)for(s=0;s<o;s++)for(b=a*o+s,w=r(s,a,o),R=4*w/17,x=8*w/17,O=15*w/17,k=5*w/68,D=15*w/68,C=v[b],i==j?(M=C.z,P=-C.y,I=-C.x):i==Y?(M=-C.z,P=-C.y,I=C.x):i==X?(M=C.x,P=C.z,I=C.y):i==Z?(M=C.x,P=-C.z,I=-C.y):i==K?(M=C.x,P=-C.y,I=C.z):i==Q&&(M=-C.x,P=-C.y,I=-C.z),t||(M=-M),T=e._levels[0][i][4*b+3]/255,E=0;E<3;E++)S=e._levels[0][i][4*b+E]/255,e.rgbm?(S*=8*T,S*=S):S=Math.pow(S,2.2),L[N+E]+=S*R,L[F+E]+=S*x*M,L[B+E]+=S*x*P,L[V+E]+=S*x*I,L[U+E]+=S*O*M*I,L[G+E]+=S*O*I*P,L[W+E]+=S*O*P*M,L[z+E]+=S*k*(3*I*I-1),L[H+E]+=S*D*(M*M-P*P),J+=w;for(E=0;E<L.length;E++)L[E]*=4*Math.PI/J;return L}return{prefilterCubemap:t,shFromCubemap:s}}()),Object.assign(n,function(){function e(e,t,i,s){var a=n.shaderChunks,o=a.createShaderFromCode(e,a.fullscreenQuadVS,(t.fixCubemapSeams?a.fixCubemapSeamsStretchPS:a.fixCubemapSeamsNonePS)+a.genParaboloidPS,"genParaboloid"),h=e.scope.resolve("source"),l=e.scope.resolve("params"),c=new n.Vec4,d=t.width,u=t.rgbm,f=t.format;d=Math.max(d,8)*r;var p=new n.gfx.Texture(e,{rgbm:u,format:f,width:2*d,height:d,mipmaps:!1}),_=new n.RenderTarget(e,p,{depth:!1});return c.x=i,c.y=s?-1:1,h.setValue(t),l.setValue(c.data),n.drawQuadWithShader(e,_,o),p}function t(e,t){e.x=.5*n.math.clamp(t-2,0,1);var i=t-6*e.x,r=1-e.x;return e.y=Math.min(.5*i,.75)*r+e.x,e.z=(1-.5*n.math.clamp(i,0,1))*r,e.w=.5*e.z,1/e.z}function i(e,i,s){var a,o;o=new n.Vec4;for(var h,l=new n.Vec4,c=2*i[0].width*r,d=n.shaderChunks,u=d.createShaderFromCode(e,d.fullscreenQuadVS,d.dpAtlasQuadPS,"dpAtlasQuad"),f=e.scope.resolve("source"),p=e.scope.resolve("params"),_=new n.gfx.Texture(e,{rgbm:i[0].rgbm,format:i[0].format,width:c,height:c,mipmaps:!1}),m=new n.RenderTarget(e,_,{depth:!1}),A=2,v=c,y=(v+A)/v-1,g=0;g<6;g++)a=n.paraboloidFromCubemap(e,i[g],g,s),f.setValue(a),h=t(o,g),l.x=h*y,l.y=2*l.x,l.x+=1,l.y+=1,p.setValue(l.data),o.x*=c,o.y*=c,o.z*=c,o.w*=c,n.drawQuadWithShader(e,m,u,o);return _}var r=2;return{paraboloidFromCubemap:e,generateDpAtlas:i}}()),n.shaderChunks.TBNPS="void getTBN() {\n    dTBN = mat3(normalize(dTangentW), normalize(dBinormalW), normalize(dVertexNormalW));\n}\n",n.shaderChunks.TBNfastPS="void getTBN() {\n    dTBN = mat3(dTangentW, dBinormalW, dVertexNormalW);\n}\n",n.shaderChunks.alphaTestPS="uniform float alpha_ref;\nvoid alphaTest(float a) {\n    if (a < alpha_ref) discard;\n}\n",n.shaderChunks.ambientConstantPS="\nvoid addAmbient() {\n    dDiffuseLight += light_globalAmbient;\n}\n",n.shaderChunks.ambientPrefilteredCubePS="#ifndef PMREM4\n#define PMREM4\nuniform samplerCube texture_prefilteredCubeMap4;\n#endif\nvoid addAmbient() {\n    vec3 fixedReflDir = fixSeamsStatic(dNormalW, 1.0 - 1.0 / 4.0);\n    fixedReflDir.x *= -1.0;\n    dDiffuseLight += processEnvironment($DECODE(textureCube(texture_prefilteredCubeMap4, fixedReflDir)).rgb);\n}\n",n.shaderChunks.ambientPrefilteredCubeLodPS="#ifndef PMREM4\n#define PMREM4\n#extension GL_EXT_shader_texture_lod : enable\nuniform samplerCube texture_prefilteredCubeMap128;\n#endif\nvoid addAmbient() {\n    vec3 fixedReflDir = fixSeamsStatic(dNormalW, 1.0 - 1.0 / 4.0);\n    fixedReflDir.x *= -1.0;\n    dDiffuseLight += processEnvironment($DECODE( textureCubeLodEXT(texture_prefilteredCubeMap128, fixedReflDir, 5.0) ).rgb);\n}\n",n.shaderChunks.ambientSHPS="uniform vec3 ambientSH[9];\nvoid addAmbient() {\n    vec3 n = dNormalW;\n    vec3 color =\n                        ambientSH[0] +\n                        ambientSH[1] * n.x +\n                        ambientSH[2] * n.y +\n                        ambientSH[3] * n.z +\n                        ambientSH[4] * n.x * n.z +\n                        ambientSH[5] * n.z * n.y +\n                        ambientSH[6] * n.y * n.x +\n                        ambientSH[7] * (3.0 * n.z * n.z - 1.0) +\n                        ambientSH[8] * (n.x * n.x - n.y * n.y);\n    dDiffuseLight += processEnvironment(max(color, vec3(0.0)));\n}\n",n.shaderChunks.aoPS="#ifdef MAPTEXTURE\nuniform sampler2D texture_aoMap;\n#endif\nvoid applyAO() {\n    dAo = 1.0;\n    #ifdef MAPTEXTURE\n        dAo *= texture2D(texture_aoMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        dAo *= saturate(vVertexColor.$VC);\n    #endif\n    dDiffuseLight *= dAo;\n}\n",n.shaderChunks.aoSpecOccPS="uniform float material_occludeSpecularIntensity;\nvoid occludeSpecular() {\n    // approximated specular occlusion from AO\n    float specPow = exp2(dGlossiness * 11.0);\n    // http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx\n    float specOcc = saturate(pow(dot(dNormalW, dViewDirW) + dAo, 0.01*specPow) - 1.0 + dAo);\n    specOcc = mix(1.0, specOcc, material_occludeSpecularIntensity);\n    dSpecularLight *= specOcc;\n    dReflection *= specOcc;\n}\n",n.shaderChunks.aoSpecOccConstPS="void occludeSpecular() {\n    // approximated specular occlusion from AO\n    float specPow = exp2(dGlossiness * 11.0);\n    // http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx\n    float specOcc = saturate(pow(dot(dNormalW, dViewDirW) + dAo, 0.01*specPow) - 1.0 + dAo);\n    dSpecularLight *= specOcc;\n    dReflection *= specOcc;\n}\n",n.shaderChunks.aoSpecOccConstSimplePS="void occludeSpecular() {\n    float specOcc = dAo;\n    dSpecularLight *= specOcc;\n    dReflection *= specOcc;\n}\n",n.shaderChunks.aoSpecOccSimplePS="uniform float material_occludeSpecularIntensity;\nvoid occludeSpecular() {\n    float specOcc = mix(1.0, dAo, material_occludeSpecularIntensity);\n    dSpecularLight *= specOcc;\n    dReflection *= specOcc;\n}\n",n.shaderChunks.bakeDirLmEndPS="\n    vec4 dirLm = texture2D(texture_dirLightMap, vUv1);\n    if (bakeDir > 0.5) {\n        if (dAtten > 0.00001) {\n            dirLm.xyz = dirLm.xyz * 2.0 - vec3(1.0);\n            dAtten = saturate(dAtten);\n            gl_FragColor.rgb = normalize(dLightDirNormW.xyz*dAtten + dirLm.xyz*dirLm.w) * 0.5 + vec3(0.5);\n            gl_FragColor.a = dirLm.w + dAtten;\n            gl_FragColor.a = max(gl_FragColor.a, 1.0 / 255.0);\n        } else {\n            gl_FragColor = dirLm;\n        }\n    } else {\n        gl_FragColor.rgb = dirLm.xyz;\n        gl_FragColor.a = max(dirLm.w, dAtten > 0.00001? (1.0/255.0) : 0.0);\n    }\n",n.shaderChunks.bakeLmEndPS="\ngl_FragColor.rgb = dDiffuseLight;\ngl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(0.5));\ngl_FragColor.rgb /= 8.0;\ngl_FragColor.a = clamp( max( max( gl_FragColor.r, gl_FragColor.g ), max( gl_FragColor.b, 1.0 / 255.0 ) ), 0.0,1.0 );\ngl_FragColor.a = ceil(gl_FragColor.a * 255.0) / 255.0;\ngl_FragColor.rgb /= gl_FragColor.a;\n",n.shaderChunks.basePS="\nuniform vec3 view_position;\nuniform vec3 light_globalAmbient;\nfloat square(float x) {\n    return x*x;\n}\nfloat saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\nvec3 saturate(vec3 x) {\n    return clamp(x, vec3(0.0), vec3(1.0));\n}\n",n.shaderChunks.baseVS="\nattribute vec3 vertex_position;\nattribute vec3 vertex_normal;\nattribute vec4 vertex_tangent;\nattribute vec2 vertex_texCoord0;\nattribute vec2 vertex_texCoord1;\nattribute vec4 vertex_color;\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nvec3 dPositionW;\nmat4 dModelMatrix;\nmat3 dNormalMatrix;\nvec3 dLightPosW;\nvec3 dLightDirNormW;\nvec3 dNormalW;\n",n.shaderChunks.biasConstPS="#define SHADOWBIAS\nfloat getShadowBias(float resolution, float maxBias) {\n    return maxBias;\n}\n",n.shaderChunks.blurVSMPS="\nvarying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\n#ifdef GAUSS\nuniform float weight[SAMPLES];\n#endif\n#ifdef PACKED\nfloat decodeFloatRG(vec2 rg) {\n    return rg.y*(1.0/255.0) + rg.x;\n}\nvec2 encodeFloatRG( float v ) {\n  vec2 enc = vec2(1.0, 255.0) * v;\n  enc = fract(enc);\n  enc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n  return enc;\n}\n#endif\nvoid main(void) {\n    vec3 moments = vec3(0.0);\n    vec2 uv = vUv0 - pixelOffset * (float(SAMPLES) * 0.5);\n    for(int i=0; i<SAMPLES; i++) {\n        vec4 c = texture2D(source, uv + pixelOffset * float(i));\n        #ifdef PACKED\n        c.xy = vec2(decodeFloatRG(c.xy), decodeFloatRG(c.zw));\n        #endif\n        #ifdef GAUSS\n        moments += c.xyz * weight[i];\n        #else\n        moments += c.xyz;\n        #endif\n    }\n    #ifndef GAUSS\n    moments /= float(SAMPLES);\n    #endif\n    #ifdef PACKED\n    gl_FragColor = vec4(encodeFloatRG(moments.x), encodeFloatRG(moments.y));\n    #else\n    gl_FragColor = vec4(moments.x, moments.y, moments.z, 1.0);\n    #endif\n}\n",n.shaderChunks.combineDiffusePS="vec3 combineColor() {\n    return dAlbedo * dDiffuseLight;\n}\n",n.shaderChunks.combineDiffuseSpecularPS="vec3 combineColor() {\n    return mix(dAlbedo * dDiffuseLight, dSpecularLight + dReflection.rgb * dReflection.a, dSpecularity);\n}\n",n.shaderChunks.combineDiffuseSpecularNoConservePS="vec3 combineColor() {\n    return dAlbedo * dDiffuseLight + (dSpecularLight + dReflection.rgb * dReflection.a) * dSpecularity;\n}\n",n.shaderChunks.combineDiffuseSpecularNoReflPS="vec3 combineColor() {\n    return dAlbedo * dDiffuseLight + dSpecularLight * dSpecularity;\n}\n",n.shaderChunks.combineDiffuseSpecularNoReflSeparateAmbientPS="uniform vec3 material_ambient;\nvec3 combineColor() {\n    return (dDiffuseLight - light_globalAmbient) * dAlbedo + dSpecularLight * dSpecularity + material_ambient * light_globalAmbient;\n}\n",n.shaderChunks.combineDiffuseSpecularOldPS="vec3 combineColor() {\n    return mix(dAlbedo * dDiffuseLight + dSpecularLight * dSpecularity, dReflection.rgb, dReflection.a);\n}\n",n.shaderChunks.cookiePS="vec4 getCookie2D(sampler2D tex, mat4 transform, float intensity) {\n    vec4 projPos = transform * vec4(vPositionW, 1.0);\n    projPos.xy /= projPos.w;\n    return mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DClip(sampler2D tex, mat4 transform, float intensity) {\n    vec4 projPos = transform * vec4(vPositionW, 1.0);\n    projPos.xy /= projPos.w;\n    if (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n    return mix(vec4(1.0), texture2D(tex, projPos.xy), intensity);\n}\nvec4 getCookie2DXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n    vec4 projPos = transform * vec4(vPositionW, 1.0);\n    projPos.xy /= projPos.w;\n    projPos.xy += cookieOffset;\n    vec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n    return mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookie2DClipXform(sampler2D tex, mat4 transform, float intensity, vec4 cookieMatrix, vec2 cookieOffset) {\n    vec4 projPos = transform * vec4(vPositionW, 1.0);\n    projPos.xy /= projPos.w;\n    projPos.xy += cookieOffset;\n    if (projPos.x < 0.0 || projPos.x > 1.0 || projPos.y < 0.0 || projPos.y > 1.0 || projPos.z < 0.0) return vec4(0.0);\n    vec2 uv = mat2(cookieMatrix) * (projPos.xy-vec2(0.5)) + vec2(0.5);\n    return mix(vec4(1.0), texture2D(tex, uv), intensity);\n}\nvec4 getCookieCube(samplerCube tex, mat4 transform, float intensity) {\n    return mix(vec4(1.0), textureCube(tex, dLightDirNormW * mat3(transform)), intensity);\n}\n",n.shaderChunks.cubeMapProjectBoxPS="uniform vec3 envBoxMin, envBoxMax;\nvec3 cubeMapProject(vec3 nrdir) {\n    vec3 rbmax = (envBoxMax - vPositionW) / nrdir;\n    vec3 rbmin = (envBoxMin - vPositionW) / nrdir;\n    vec3 rbminmax;\n    rbminmax.x = nrdir.x>0.0? rbmax.x : rbmin.x;\n    rbminmax.y = nrdir.y>0.0? rbmax.y : rbmin.y;\n    rbminmax.z = nrdir.z>0.0? rbmax.z : rbmin.z;\n    float fa = min(min(rbminmax.x, rbminmax.y), rbminmax.z);\n    vec3 posonbox = vPositionW + nrdir * fa;\n    vec3 envBoxPos = (envBoxMin + envBoxMax) * 0.5;\n    return posonbox - envBoxPos;\n}\n",n.shaderChunks.cubeMapProjectNonePS="vec3 cubeMapProject(vec3 dir) {\n    return dir;\n}\n",n.shaderChunks.diffusePS="#ifdef MAPCOLOR\nuniform vec3 material_diffuse;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_diffuseMap;\n#endif\nvoid getAlbedo() {\n    dAlbedo = vec3(1.0);\n    #ifdef MAPCOLOR\n        dAlbedo *= material_diffuse.rgb;\n    #endif\n    #ifdef MAPTEXTURE\n        dAlbedo *= texture2DSRGB(texture_diffuseMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        dAlbedo *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n}\n",n.shaderChunks.dilatePS="varying vec2 vUv0;\nuniform sampler2D source;\nuniform vec2 pixelOffset;\nvoid main(void) {\n    vec4 c = texture2D(source, vUv0);\n    c = c.a>0.0? c : texture2D(source, vUv0 - pixelOffset);\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, -pixelOffset.y));\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, -pixelOffset.y));\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, 0));\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(pixelOffset.x, 0));\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(-pixelOffset.x, pixelOffset.y));\n    c = c.a>0.0? c : texture2D(source, vUv0 + vec2(0, pixelOffset.y));\n    c = c.a>0.0? c : texture2D(source, vUv0 + pixelOffset);\n    gl_FragColor = c;\n}\n",n.shaderChunks.dpAtlasQuadPS="varying vec2 vUv0;\nuniform sampler2D source;\nuniform vec4 params;\nvoid main(void) {\n    vec2 uv = vUv0;\n    uv = uv * 2.0 - vec2(1.0);\n    uv *= params.xy;\n    uv = uv * 0.5 + 0.5;\n    gl_FragColor = texture2D(source, uv);\n}\n",n.shaderChunks.emissivePS="#ifdef MAPCOLOR\nuniform vec3 material_emissive;\n#endif\n#ifdef MAPFLOAT\nuniform float material_emissiveIntensity;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_emissiveMap;\n#endif\nvec3 getEmission() {\n    vec3 emission = vec3(1.0);\n    #ifdef MAPFLOAT\n        emission *= material_emissiveIntensity;\n    #endif\n    #ifdef MAPCOLOR\n        emission *= material_emissive;\n    #endif\n    #ifdef MAPTEXTURE\n        emission *= $texture2DSAMPLE(texture_emissiveMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        emission *= gammaCorrectInput(saturate(vVertexColor.$VC));\n    #endif\n    return emission;\n}\n",n.shaderChunks.endPS="   gl_FragColor.rgb = combineColor();\n   gl_FragColor.rgb += getEmission();\n   gl_FragColor.rgb = addFog(gl_FragColor.rgb);\n   #ifndef HDR\n    gl_FragColor.rgb = toneMap(gl_FragColor.rgb);\n    gl_FragColor.rgb = gammaCorrectOutput(gl_FragColor.rgb);\n   #endif\n",n.shaderChunks.envConstPS="vec3 processEnvironment(vec3 color) {\n    return color;\n}\n",n.shaderChunks.envMultiplyPS="uniform float skyboxIntensity;\nvec3 processEnvironment(vec3 color) {\n    return color * skyboxIntensity;\n}\n",n.shaderChunks.extensionPS="",n.shaderChunks.extensionVS="\n",n.shaderChunks.falloffInvSquaredPS="float getFalloffInvSquared(float lightRadius) {\n    float sqrDist = dot(dLightDirW, dLightDirW);\n    float falloff = 1.0 / (sqrDist + 1.0);\n    float invRadius = 1.0 / lightRadius;\n    falloff *= 16.0;\n    falloff *= square( saturate( 1.0 - square( sqrDist * square(invRadius) ) ) );\n    return falloff;\n}\n",n.shaderChunks.falloffLinearPS="float getFalloffLinear(float lightRadius) {\n    float d = length(dLightDirW);\n    return max(((lightRadius - d) / lightRadius), 0.0);\n}\n",n.shaderChunks.fixCubemapSeamsNonePS="vec3 fixSeams(vec3 vec, float mipmapIndex) {\n    return vec;\n}\nvec3 fixSeams(vec3 vec) {\n    return vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n    return vec;\n}\n",n.shaderChunks.fixCubemapSeamsStretchPS="vec3 fixSeams(vec3 vec, float mipmapIndex) {\n    float scale = 1.0 - exp2(mipmapIndex) / 128.0;\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n    if (abs(vec.x) != M) vec.x *= scale;\n    if (abs(vec.y) != M) vec.y *= scale;\n    if (abs(vec.z) != M) vec.z *= scale;\n    return vec;\n}\nvec3 fixSeams(vec3 vec) {\n    float scale = 1.0 - 1.0 / 128.0;\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n    if (abs(vec.x) != M) vec.x *= scale;\n    if (abs(vec.y) != M) vec.y *= scale;\n    if (abs(vec.z) != M) vec.z *= scale;\n    return vec;\n}\nvec3 fixSeamsStatic(vec3 vec, float invRecMipSize) {\n    float scale = invRecMipSize;\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n    if (abs(vec.x) != M) vec.x *= scale;\n    if (abs(vec.y) != M) vec.y *= scale;\n    if (abs(vec.z) != M) vec.z *= scale;\n    return vec;\n}\n",n.shaderChunks.fogExpPS="uniform vec3 fog_color;\nuniform float fog_density;\nvec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = exp(-depth * fog_density);\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(fog_color, color, fogFactor);\n}\n",n.shaderChunks.fogExp2PS="uniform vec3 fog_color;\nuniform float fog_density;\nvec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = exp(-depth * depth * fog_density * fog_density);\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    return mix(fog_color, color, fogFactor);\n}\n",n.shaderChunks.fogLinearPS="uniform vec3 fog_color;\nuniform float fog_start;\nuniform float fog_end;\nvec3 addFog(vec3 color) {\n    float depth = gl_FragCoord.z / gl_FragCoord.w;\n    float fogFactor = (fog_end - depth) / (fog_end - fog_start);\n    fogFactor = clamp(fogFactor, 0.0, 1.0);\n    fogFactor = gammaCorrectInput(fogFactor);\n    return mix(fog_color, color, fogFactor);\n}\n",n.shaderChunks.fogNonePS="vec3 addFog(vec3 color) {\n    return color;\n}\n",n.shaderChunks.fresnelSchlickPS="// Schlick's approximation\nuniform float material_fresnelFactor; // unused\nvoid getFresnel() {\n    float fresnel = 1.0 - max(dot(dNormalW, dViewDirW), 0.0);\n    float fresnel2 = fresnel * fresnel;\n    fresnel *= fresnel2 * fresnel2;\n    fresnel *= dGlossiness * dGlossiness;\n    dSpecularity = dSpecularity + (1.0 - dSpecularity) * fresnel;\n}\n",n.shaderChunks.fullscreenQuadPS="varying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n    gl_FragColor = texture2D(source, vUv0);\n}\n",n.shaderChunks.fullscreenQuadVS="attribute vec2 vertex_position;\nvarying vec2 vUv0;\nvoid main(void)\n{\n    gl_Position = vec4(vertex_position, 0.5, 1.0);\n    vUv0 = vertex_position.xy*0.5+0.5;\n}\n",n.shaderChunks.gamma1_0PS="vec4 texture2DSRGB(sampler2D tex, vec2 uv) {\n    return texture2D(tex, uv);\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv, float bias) {\n    return texture2D(tex, uv, bias);\n}\nvec4 textureCubeSRGB(samplerCube tex, vec3 uvw) {\n    return textureCube(tex, uvw);\n}\nvec3 gammaCorrectOutput(vec3 color) {\n    return color;\n}\nvec3 gammaCorrectInput(vec3 color) {\n    return color;\n}\nfloat gammaCorrectInput(float color) {\n    return color;\n}\nvec4 gammaCorrectInput(vec4 color) {\n    return color;\n}\n",n.shaderChunks.gamma2_2PS="vec3 gammaCorrectInput(vec3 color) {\n    return pow(color, vec3(2.2));\n}\nfloat gammaCorrectInput(float color) {\n    return pow(color, 2.2);\n}\nvec4 gammaCorrectInput(vec4 color) {\n    return vec4(pow(color.rgb, vec3(2.2)), color.a);\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv) {\n    vec4 rgba = texture2D(tex, uv);\n    rgba.rgb = gammaCorrectInput(rgba.rgb);\n    return rgba;\n}\nvec4 texture2DSRGB(sampler2D tex, vec2 uv, float bias) {\n    vec4 rgba = texture2D(tex, uv, bias);\n    rgba.rgb = gammaCorrectInput(rgba.rgb);\n    return rgba;\n}\nvec4 textureCubeSRGB(samplerCube tex, vec3 uvw) {\n    vec4 rgba = textureCube(tex, uvw);\n    rgba.rgb = gammaCorrectInput(rgba.rgb);\n    return rgba;\n}\nvec3 gammaCorrectOutput(vec3 color) {\n#ifdef HDR\n    return color;\n#else\n    color += vec3(0.0000001);\n    return pow(color, vec3(0.45));\n#endif\n}\n",n.shaderChunks.genParaboloidPS="varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params; // x = mip\nvoid main(void) {\n    vec2 uv = vUv0;\n    float side = uv.x < 0.5? 1.0 : -1.0;\n    vec2 tc;\n    tc.x = fract(uv.x * 2.0) * 2.0 - 1.0;\n    tc.y = uv.y * 2.0 - 1.0;\n    // scale projection a bit to have a little overlap for filtering\n    const float scale = 1.1;\n    tc *= scale;\n    vec3 dir;\n    dir.y = (dot(tc, tc) - 1.0) * side; // from 1.0 center to 0.0 borders quadratically\n    dir.xz = tc * -2.0;\n    dir.x *= -side * params.y; // flip original cubemap x instead of doing it at runtime\n    dir = fixSeams(dir, params.x);\n    vec4 color = textureCube(source, dir, -100.0);\n    gl_FragColor = color;\n}\n",n.shaderChunks.gles3PS="#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad\n#define GL2\n",n.shaderChunks.gles3VS="#define attribute in\n#define varying out\n#define texture2D texture\n#define GL2\n#define VERTEXSHADER\n",n.shaderChunks.glossPS="#ifdef MAPFLOAT\nuniform float material_shininess;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_glossMap;\n#endif\nvoid getGlossiness() {\n    dGlossiness = 1.0;\n    #ifdef MAPFLOAT\n        dGlossiness *= material_shininess;\n    #endif\n    #ifdef MAPTEXTURE\n        dGlossiness *= texture2D(texture_glossMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        dGlossiness *= saturate(vVertexColor.$VC);\n    #endif\n    dGlossiness += 0.0000001;\n}\n",n.shaderChunks.instancingVS="\nattribute vec4 instance_line1;\nattribute vec4 instance_line2;\nattribute vec4 instance_line3;\nattribute vec4 instance_line4;\n",n.shaderChunks.lightDiffuseLambertPS="float getLightDiffuse() {\n    return max(dot(dNormalW, -dLightDirNormW), 0.0);\n}\n",n.shaderChunks.lightDirPointPS="void getLightDirPoint(vec3 lightPosW) {\n    dLightDirW = vPositionW - lightPosW;\n    dLightDirNormW = normalize(dLightDirW);\n    dLightPosW = lightPosW;\n}\n",n.shaderChunks.lightSpecularBlinnPS="// Energy-conserving (hopefully) Blinn-Phong\nfloat getLightSpecular() {\n    vec3 h = normalize( -dLightDirNormW + dViewDirW );\n    float nh = max( dot( h, dNormalW ), 0.0 );\n    float specPow = exp2(dGlossiness * 11.0); // glossiness is linear, power is not; 0 - 2048\n    specPow = antiAliasGlossiness(specPow);\n    // Hack: On Mac OS X, calling pow with zero for the exponent generates hideous artifacts so bias up a little\n    specPow = max(specPow, 0.0001);\n    return pow(nh, specPow) * (specPow + 2.0) / 8.0;\n}\n",n.shaderChunks.lightSpecularPhongPS="float getLightSpecular() {\n    float specPow = dGlossiness;\n    specPow = antiAliasGlossiness(specPow);\n    // Hack: On Mac OS X, calling pow with zero for the exponent generates hideous artifacts so bias up a little\n    return pow(max(dot(dReflDirW, -dLightDirNormW), 0.0), specPow + 0.0001);\n}\n",n.shaderChunks.lightmapDirPS="uniform sampler2D texture_lightMap;\nuniform sampler2D texture_dirLightMap;\nvoid addLightMap() {\n    vec3 color = $texture2DSAMPLE(texture_lightMap, $UV).$CH;\n    vec4 dir = texture2D(texture_dirLightMap, $UV);\n    if (dot(dir.xyz,vec3(1.0)) < 0.00001) {\n        dDiffuseLight += color;\n        return;\n    }\n    dLightDirNormW = normalize(dir.xyz * 2.0 - vec3(1.0));\n    float vlight = saturate(dot(dLightDirNormW, -dVertexNormalW));\n    float flight = saturate(dot(dLightDirNormW, -dNormalW));\n    float nlight = (flight / max(vlight,0.01)) * 0.5;\n    dDiffuseLight += color * nlight * 2.0;\n}\nvoid addDirLightMap() {\n    vec4 dir = texture2D(texture_dirLightMap, $UV);\n    if (dot(dir.xyz,vec3(1.0)) < 0.00001) return;\n    vec3 color = $texture2DSAMPLE(texture_lightMap, $UV).$CH;\n    dLightDirNormW = normalize(dir.xyz * 2.0 - vec3(1.0));\n    dSpecularLight += vec3(getLightSpecular()) * color;\n}\n",n.shaderChunks.lightmapSinglePS="#ifdef MAPTEXTURE\nuniform sampler2D texture_lightMap;\n#endif\nvoid addLightMap() {\n    vec3 lm = vec3(1.0);\n    #ifdef MAPTEXTURE\n        lm *= $texture2DSAMPLE(texture_lightMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        lm *= saturate(vVertexColor.$VC);\n    #endif\n    \n    dDiffuseLight += lm;\n}\n",n.shaderChunks.lightmapSingleVertPS="void addLightMap() {\n    dDiffuseLight += saturate(vVertexColor.$CH);\n}\n",n.shaderChunks.metalnessPS="void processMetalness(float metalness) {\n    const float dielectricF0 = 0.04;\n    dSpecularity = mix(vec3(dielectricF0), dAlbedo, metalness);\n    dAlbedo *= 1.0 - metalness;\n}\n#ifdef MAPFLOAT\nuniform float material_metalness;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_metalnessMap;\n#endif\nvoid getSpecularity() {\n    float metalness = 1.0;\n    #ifdef MAPFLOAT\n        metalness *= material_metalness;\n    #endif\n    #ifdef MAPTEXTURE\n        metalness *= texture2D(texture_metalnessMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        metalness *= saturate(vVertexColor.$VC);\n    #endif\n    processMetalness(metalness);\n}\n",n.shaderChunks.msdfPS="uniform sampler2D texture_msdfMap;\n#ifdef GL_OES_standard_derivatives\n#define USE_FWIDTH\n#endif\n#ifdef GL2\n#define USE_FWIDTH\n#endif\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\nfloat map (float min, float max, float v) {\n    return (v - min) / (max - min);\n}\n// msdf way\n// vec4 applyMsdf(vec4 color) {\n//     vec3 tsample = texture(texture_msdfMap, vUv0).rgb;\n   \n//     // separate\n//     vec2 msdfUnit = 4.0 / vec2(512.0, 256.0);\n//     float sigDist = median(tsample.r, tsample.g, tsample.b) - 0.5;\n//     sigDist *= dot(msdfUnit, 0.5/fwidth(vUv0));\n//     float distance = clamp(sigDist + 0.5, 0.0, 1.0);\n//     return mix(vec4(0.0), color, distance);\n// }\nuniform float font_sdfIntensity; // intensity is used to boost the value read from the SDF, 0 is no boost, 1.0 is max boost\nuniform float font_pxrange;      // the number of pixels between inside and outside the font in SDF\nuniform float font_textureWidth; // the width of the texture atlas\nvec4 applyMsdf(vec4 color) {\n    float font_size = 16.0; // TODO fix this\n    // sample the field\n    vec3 tsample = texture2D(texture_msdfMap, vUv0).rgb;\n    // get the signed distance value\n    float sigDist = median(tsample.r, tsample.g, tsample.b);\n    #ifdef USE_FWIDTH\n        // smoothing depends on size of texture on screen\n        vec2 w = fwidth(vUv0);\n        float smoothing = clamp(map(0.0, 2.0 * font_pxrange / font_textureWidth, w.x), 0.0, 0.5);\n    #else\n        // smoothing gets smaller as the font size gets bigger\n        // don't have fwidth we can approximate from font size, this doesn't account for scaling\n        // so a big font scaled down will be wrong...\n        float smoothing = clamp(2.0 * font_pxrange / font_size, 0.0, 0.5);\n        // for small fonts we remap the distance field to intensify it\n        // float mapMin = 0.05;\n        // float mapMax = clamp(((font_size * 0.4 / 40.0) + 0.52), mapMin, 1.0);\n    #endif\n    float mapMin = 0.05;\n    float mapMax = clamp(1.0 - font_sdfIntensity, mapMin, 1.0);\n    \n    // remap to a smaller range (used on smaller font sizes)\n    sigDist = map(mapMin, mapMax, sigDist);\n    float center = 0.5;\n    // calculate smoothing and use to generate opacity\n    // float smoothing = clamp(font_smoothing * (1.0-roy), 0.0, center);\n    float opacity = smoothstep(center-smoothing, center+smoothing, sigDist);\n    // return final color\n    return mix(vec4(0.0), color, opacity);\n}",n.shaderChunks.normalVS="vec3 getNormal() {\n    #ifdef SKIN\n        dNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n    #elif defined(INSTANCING)\n        dNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n    #else\n        dNormalMatrix = matrix_normal;\n    #endif\n    return normalize(dNormalMatrix * vertex_normal);\n}\n",n.shaderChunks.normalInstancedVS="vec3 getNormal() {\n    dNormalMatrix = mat3(instance_line1.xyz, instance_line2.xyz, instance_line3.xyz);\n    return normalize(dNormalMatrix * vertex_normal);\n}\n",
n.shaderChunks.normalMapPS="uniform sampler2D texture_normalMap;\nuniform float material_bumpiness;\nvoid getNormal() {\n    vec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n    dNormalMap = normalMap;\n    dNormalW = dTBN * normalMap;\n}\n",n.shaderChunks.normalMapFloatPS="uniform sampler2D texture_normalMap;\nuniform float material_bumpiness;\nvoid getNormal() {\n    vec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n    dNormalMap = normalMap;\n    normalMap = normalize(mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness));\n    dNormalW = dTBN * normalMap;\n}\n",n.shaderChunks.normalMapFloatTBNfastPS="uniform sampler2D texture_normalMap;\nuniform float material_bumpiness;\nvoid getNormal() {\n    vec3 normalMap = unpackNormal(texture2D(texture_normalMap, $UV));\n    dNormalMap = normalMap;\n    normalMap = mix(vec3(0.0, 0.0, 1.0), normalMap, material_bumpiness);\n    dNormalW = normalize(dTBN * normalMap);\n}\n",n.shaderChunks.normalSkinnedVS="vec3 getNormal() {\n    dNormalMatrix = mat3(dModelMatrix[0].xyz, dModelMatrix[1].xyz, dModelMatrix[2].xyz);\n    return normalize(dNormalMatrix * vertex_normal);\n}\n",n.shaderChunks.normalVertexPS="void getNormal() {\n    dNormalW = normalize(dVertexNormalW);\n}\n",n.shaderChunks.normalXYPS="vec3 unpackNormal(vec4 nmap) {\n    vec3 normal;\n    normal.xy = nmap.wy * 2.0 - 1.0;\n    normal.z = sqrt(1.0 - saturate(dot(normal.xy, normal.xy)));\n    return normal;\n}\n",n.shaderChunks.normalXYZPS="vec3 unpackNormal(vec4 nmap) {\n    return nmap.xyz * 2.0 - 1.0;\n}\n",n.shaderChunks.opacityPS="#ifdef MAPFLOAT\nuniform float material_opacity;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_opacityMap;\n#endif\nvoid getOpacity() {\n    dAlpha = 1.0;\n    #ifdef MAPFLOAT\n        dAlpha *= material_opacity;\n    #endif\n    #ifdef MAPTEXTURE\n        dAlpha *= texture2D(texture_opacityMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        dAlpha *= saturate(vVertexColor.$VC);\n    #endif\n}\n",n.shaderChunks.outputAlphaPS="gl_FragColor.a = dAlpha;\n",n.shaderChunks.outputAlphaOpaquePS="gl_FragColor.a = 1.0;\n",n.shaderChunks.outputAlphaPremulPS="gl_FragColor.rgb *= dAlpha;\ngl_FragColor.a = dAlpha;\n",n.shaderChunks.outputCubemapPS="varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params;\nfloat saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\nvec4 encodeRGBM(vec4 color) { // modified RGBM\n    color.rgb = pow(color.rgb, vec3(0.5));\n    color.rgb *= 1.0 / 8.0;\n    color.a = saturate( max( max( color.r, color.g ), max( color.b, 1.0 / 255.0 ) ) );\n    color.a = ceil(color.a * 255.0) / 255.0;\n    color.rgb /= color.a;\n    return color;\n}\nvoid main(void) {\n    vec2 st = vUv0 * 2.0 - 1.0;\n    float face = params.x;\n    vec3 vec;\n    if (face==0.0) {\n        vec = vec3(1, -st.y, -st.x);\n    } else if (face==1.0) {\n        vec = vec3(-1, -st.y, st.x);\n    } else if (face==2.0) {\n        vec = vec3(st.x, 1, st.y);\n    } else if (face==3.0) {\n        vec = vec3(st.x, -1, -st.y);\n    } else if (face==4.0) {\n        vec = vec3(st.x, -st.y, 1);\n    } else {\n        vec = vec3(-st.x, -st.y, -1);\n    }\n    gl_FragColor = textureCube(source, vec);\n    if (params.w >= 2.0) gl_FragColor = encodeRGBM(gl_FragColor);\n}\n",n.shaderChunks.outputTex2DPS="varying vec2 vUv0;\nuniform sampler2D source;\nvoid main(void) {\n    gl_FragColor = texture2D(source, vUv0);\n}\n",n.shaderChunks.packDepthPS="// Packing a float in GLSL with multiplication and mod\n// http://blog.gradientstudios.com/2012/08/23/shadow-map-improvement\nvec4 packFloat(float depth) {\n    const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    // combination of mod and multiplication and division works better\n    vec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n    res -= res.xxyz * bit_mask;\n    return res;\n}\n",n.shaderChunks.packDepthMaskPS="vec4 packFloat(float depth) {\n    const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    // combination of mod and multiplication and division works better\n    vec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n    res.x = 0.0;\n    res -= res.xxyz * bit_mask;\n    return res;\n}\n",n.shaderChunks.parallaxPS="uniform sampler2D texture_heightMap;\nuniform float material_heightMapFactor;\nvoid getParallax() {\n    float parallaxScale = material_heightMapFactor;\n    float height = texture2D(texture_heightMap, $UV).$CH;\n    height = height * parallaxScale - parallaxScale*0.5;\n    vec3 viewDirT = dViewDirW * dTBN;\n    viewDirT.z += 0.42;\n    dUvOffset = height * (viewDirT.xy / viewDirT.z);\n}\n",n.shaderChunks.particlePS="varying vec4 texCoordsAlphaLife;\nuniform sampler2D colorMap;\nuniform sampler2D internalTex3;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nuniform float softening;\nuniform float colorMult;\nfloat saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n    const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n    float depth = dot(rgbaDepth, bitShift);\n    return depth;\n}\n#endif\nvoid main(void) {\n    vec4 tex         = texture2DSRGB(colorMap, texCoordsAlphaLife.xy);\n    vec4 ramp     = texture2DSRGB(internalTex3, vec2(texCoordsAlphaLife.w, 0.0));\n    ramp.rgb *= colorMult;\n    ramp.a += texCoordsAlphaLife.z;\n    vec3 rgb =     tex.rgb * ramp.rgb;\n    float a =         tex.a * ramp.a;\n",n.shaderChunks.particleVS="\nvec3 unpack3NFloats(float src) {\n    float r = fract(src);\n    float g = fract(src * 256.0);\n    float b = fract(src * 65536.0);\n    return vec3(r, g, b);\n}\nfloat saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\nvec4 tex1Dlod_lerp(sampler2D tex, vec2 tc) {\n    return mix( texture2D(tex,tc), texture2D(tex,tc + graphSampleSize), fract(tc.x*graphNumSamples) );\n}\nvec4 tex1Dlod_lerp(sampler2D tex, vec2 tc, out vec3 w) {\n    vec4 a = texture2D(tex,tc);\n    vec4 b = texture2D(tex,tc + graphSampleSize);\n    float c = fract(tc.x*graphNumSamples);\n    vec3 unpackedA = unpack3NFloats(a.w);\n    vec3 unpackedB = unpack3NFloats(b.w);\n    w = mix(unpackedA, unpackedB, c);\n    return mix(a, b, c);\n}\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix) {\n    float c = cos(pRotation);\n    float s = sin(pRotation);\n    mat2 m = mat2(c, -s, s, c);\n    rotMatrix = m;\n    return m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY) {\n    vec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n    return pos;\n}\nvoid main(void) {\n    vec3 meshLocalPos = particle_vertexData.xyz;\n    float id = floor(particle_vertexData.w);\n    float rndFactor = fract(sin(id + 1.0 + seed));\n    vec3 rndFactor3 = vec3(rndFactor, fract(rndFactor*10.0), fract(rndFactor*100.0));\n    float uv = id / numParticlesPot;\n    readInput(uv);\n    vec2 velocityV = normalize((mat3(matrix_view) * inVel).xy); // should be removed by compiler if align/stretch is not used\n    float particleLifetime = lifetime;\n    if (inLife <= 0.0 || inLife > particleLifetime || !inShow) meshLocalPos = vec3(0.0);\n    vec2 quadXY = meshLocalPos.xy;\n    float nlife = clamp(inLife / particleLifetime, 0.0, 1.0);\n    vec3 paramDiv;\n    vec4 params = tex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n    float scale = params.y;\n    float scaleDiv = paramDiv.x;\n    float alphaDiv = paramDiv.z;\n    scale += (scaleDiv * 2.0 - 1.0) * scaleDivMult * fract(rndFactor*10000.0);\n    texCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5,    (alphaDiv * 2.0 - 1.0) * alphaDivMult * fract(rndFactor*1000.0),    nlife);\n    vec3 particlePos = inPos;\n    vec3 particlePosMoved = vec3(0.0);\n    mat2 rotMatrix;\n",n.shaderChunks.particleAnimFrameClampVS="\n    float animFrame = min(floor(texCoordsAlphaLife.w * animTexParams.z), animTexParams.w);\n",n.shaderChunks.particleAnimFrameLoopVS="\n    float animFrame = floor(texCoordsAlphaLife.w * animTexParams.z);\n",n.shaderChunks.particleAnimTexVS="\n    float atlasX = animFrame * animTexParams.x;\n    float atlasY = floor(atlasX) * animTexParams.y;\n    atlasX = fract(atlasX);\n    texCoordsAlphaLife.xy *= animTexParams.xy;\n    texCoordsAlphaLife.xy += vec2(atlasX, atlasY);\n    texCoordsAlphaLife.y = 1.0 - texCoordsAlphaLife.y;\n",n.shaderChunks.particleInputFloatPS="void readInput(float uv) {\n    vec4 tex = texture2D(particleTexIN, vec2(uv, 0.25));\n    vec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.75));\n    inPos = tex.xyz;\n    inVel = tex2.xyz;\n    inAngle = (tex.w < 0.0? -tex.w : tex.w) - 1000.0;\n    inShow = tex.w >= 0.0;\n    inLife = tex2.w;\n}\n",n.shaderChunks.particleInputRgba8PS="//RG=X, BA=Y\n//RG=Z, BA=A\n//RGB=V, A=visMode\n//RGBA=life\n#define PI2 6.283185307179586\nuniform vec3 inBoundsSize;\nuniform vec3 inBoundsCenter;\nuniform float maxVel;\nfloat decodeFloatRG(vec2 rg) {\n    return rg.y*(1.0/255.0) + rg.x;\n}\nfloat decodeFloatRGBA( vec4 rgba ) {\n  return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}\nvoid readInput(float uv) {\n    vec4 tex0 = texture2D(particleTexIN, vec2(uv, 0.125));\n    vec4 tex1 = texture2D(particleTexIN, vec2(uv, 0.375));\n    vec4 tex2 = texture2D(particleTexIN, vec2(uv, 0.625));\n    vec4 tex3 = texture2D(particleTexIN, vec2(uv, 0.875));\n    inPos = vec3(decodeFloatRG(tex0.rg), decodeFloatRG(tex0.ba), decodeFloatRG(tex1.rg));\n    inPos = (inPos - vec3(0.5)) * inBoundsSize + inBoundsCenter;\n    inVel = tex2.xyz;\n    inVel = (inVel - vec3(0.5)) * maxVel;\n    inAngle = decodeFloatRG(tex1.ba) * PI2;\n    inShow = tex2.a > 0.5;\n    inLife = decodeFloatRGBA(tex3);\n    float maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n    float maxPosLife = lifetime+1.0;\n    inLife = inLife * (maxNegLife + maxPosLife) - maxNegLife;\n}\n",n.shaderChunks.particleOutputFloatPS="void writeOutput() {\n    if (gl_FragCoord.y<1.0) {\n        gl_FragColor = vec4(outPos, (outAngle + 1000.0) * visMode);\n    } else {\n        gl_FragColor = vec4(outVel, outLife);\n    }\n}\n",n.shaderChunks.particleOutputRgba8PS="uniform vec3 outBoundsMul;\nuniform vec3 outBoundsAdd;\nvec2 encodeFloatRG( float v ) {\n  vec2 enc = vec2(1.0, 255.0) * v;\n  enc = fract(enc);\n  enc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n  return enc;\n}\nvec4 encodeFloatRGBA( float v ) {\n  vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * v;\n  enc = fract(enc);\n  enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n  return enc;\n}\nvoid writeOutput() {\n    //outPos = (outPos - outBoundsCenter) / outBoundsSize + vec3(0.5);\n    outPos = outPos * outBoundsMul + outBoundsAdd;\n    outAngle = fract(outAngle / PI2);\n    outVel = (outVel / maxVel) + vec3(0.5); // TODO: mul\n    float maxNegLife = max(lifetime, (numParticles - 1.0) * (rate+rateDiv));\n    float maxPosLife = lifetime+1.0;\n    outLife = (outLife + maxNegLife) / (maxNegLife + maxPosLife);\n    if (gl_FragCoord.y < 1.0) {\n        gl_FragColor = vec4(encodeFloatRG(outPos.x), encodeFloatRG(outPos.y));\n    } else if (gl_FragCoord.y < 2.0) {\n        gl_FragColor = vec4(encodeFloatRG(outPos.z), encodeFloatRG(outAngle));\n    } else if (gl_FragCoord.y < 3.0) {\n        gl_FragColor = vec4(outVel, visMode*0.5+0.5);\n    } else {\n        gl_FragColor = encodeFloatRGBA(outLife);\n    }\n}\n",n.shaderChunks.particleUpdaterAABBPS="uniform mat3 spawnBounds;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n    return emitterPos + spawnBounds * (inBounds - vec3(0.5));\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n    localVelocity -= vec3(0, 0, initialVelocity);\n}\n",n.shaderChunks.particleUpdaterEndPS="\n    writeOutput();\n}\n",n.shaderChunks.particleUpdaterInitPS="varying vec2 vUv0;\nuniform sampler2D particleTexIN;\nuniform sampler2D internalTex0;\nuniform sampler2D internalTex1;\nuniform sampler2D internalTex2;\nuniform mat3 emitterMatrix;\nuniform vec3 emitterScale;\nuniform vec3 emitterPos, frameRandom, localVelocityDivMult, velocityDivMult;\nuniform float delta, rate, rateDiv, lifetime, numParticles, rotSpeedDivMult, seed;\nuniform float startAngle, startAngle2;\nuniform float initialVelocity;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\nfloat visMode;\nvec3 outPos;\nvec3 outVel;\nfloat outAngle;\nbool outShow;\nfloat outLife;\n",n.shaderChunks.particleUpdaterNoRespawnPS="    if (outLife >= lifetime) {\n        outLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n        visMode = -1.0;\n    }\n",n.shaderChunks.particleUpdaterOnStopPS="    visMode = outLife < 0.0? -1.0: visMode;\n",n.shaderChunks.particleUpdaterRespawnPS="    if (outLife >= lifetime) {\n        outLife -= max(lifetime, (numParticles - 1.0) * particleRate);\n        visMode = 1.0;\n    }\n    visMode = outLife < 0.0? 1.0: visMode;\n",n.shaderChunks.particleUpdaterSpherePS="uniform float spawnBoundsSphere;\nvec3 calcSpawnPosition(vec3 inBounds, float rndFactor) {\n    float rnd4 = fract(rndFactor * 1000.0);\n    return emitterPos + normalize(inBounds.xyz - vec3(0.5)) * rnd4 * spawnBoundsSphere;\n}\nvoid addInitialVelocity(inout vec3 localVelocity, vec3 inBounds) {\n    localVelocity += normalize(inBounds - vec3(0.5)) * initialVelocity;\n}\n",n.shaderChunks.particleUpdaterStartPS="float saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\nvec3 unpack3NFloats(float src) {\n    float r = fract(src);\n    float g = fract(src * 256.0);\n    float b = fract(src * 65536.0);\n    return vec3(r, g, b);\n}\nvec3 tex1Dlod_lerp(sampler2D tex, vec2 tc, out vec3 w) {\n    vec4 a = texture2D(tex, tc);\n    vec4 b = texture2D(tex, tc + graphSampleSize);\n    float c = fract(tc.x * graphNumSamples);\n    vec3 unpackedA = unpack3NFloats(a.w);\n    vec3 unpackedB = unpack3NFloats(b.w);\n    w = mix(unpackedA, unpackedB, c);\n    return mix(a.xyz, b.xyz, c);\n}\n#define HASHSCALE4 vec4(1031, .1030, .0973, .1099)\nvec4 hash41(float p) {\n    vec4 p4 = fract(vec4(p) * HASHSCALE4);\n    p4 += dot(p4, p4.wzxy+19.19);\n    return fract(vec4((p4.x + p4.y)*p4.z, (p4.x + p4.z)*p4.y, (p4.y + p4.z)*p4.w, (p4.z + p4.w)*p4.x));\n}\nvoid main(void)\n{\n    if (gl_FragCoord.x > numParticles) discard;\n    readInput(vUv0.x);\n    visMode = inShow? 1.0 : -1.0;\n    vec4 rndFactor = hash41(gl_FragCoord.x + seed);\n    float particleRate = rate + rateDiv * rndFactor.x;\n    outLife = inLife + delta;\n    float nlife = clamp(outLife / lifetime, 0.0, 1.0);\n    vec3 localVelocityDiv;\n    vec3 velocityDiv;\n    vec3 paramDiv;\n    vec3 localVelocity = tex1Dlod_lerp(internalTex0, vec2(nlife, 0), localVelocityDiv);\n    vec3 velocity =      tex1Dlod_lerp(internalTex1, vec2(nlife, 0), velocityDiv);\n    vec3 params =        tex1Dlod_lerp(internalTex2, vec2(nlife, 0), paramDiv);\n    float rotSpeed = params.x;\n    float rotSpeedDiv = paramDiv.y;\n    localVelocity +=    (localVelocityDiv * vec3(2.0) - vec3(1.0)) * localVelocityDivMult * rndFactor.xyz;\n    velocity +=         (velocityDiv * vec3(2.0) - vec3(1.0)) * velocityDivMult * rndFactor.xyz;\n    rotSpeed +=         (rotSpeedDiv * 2.0 - 1.0) * rotSpeedDivMult * rndFactor.y;\n    addInitialVelocity(localVelocity, rndFactor.xyz);\n    outVel = emitterMatrix * localVelocity.xyz + velocity.xyz * emitterScale;\n    outPos = inPos + outVel * delta;\n    outAngle = inAngle + rotSpeed * delta;\n    bool respawn = outLife <= 0.0 || outLife >= lifetime;\n    outPos = respawn? calcSpawnPosition(rndFactor.xyz, rndFactor.x) : outPos;\n    outAngle = respawn? mix(startAngle, startAngle2, rndFactor.x) : outAngle;\n    outVel = respawn? vec3(0.0) : outVel;\n",n.shaderChunks.particle_TBNVS="\n    mat3 rot3 = mat3(rotMatrix[0][0], rotMatrix[0][1], 0.0,        rotMatrix[1][0], rotMatrix[1][1], 0.0,        0.0, 0.0, 1.0);\n    ParticleMat = mat3(-matrix_viewInverse[0].xyz, -matrix_viewInverse[1].xyz, matrix_viewInverse[2].xyz) * rot3;\n",n.shaderChunks.particle_billboardVS="\n    quadXY = rotate(quadXY, inAngle, rotMatrix);\n    vec3 localPos = billboard(particlePos, quadXY);\n",n.shaderChunks.particle_blendAddPS="\n    rgb *= saturate(gammaCorrectInput(a));\n    if ((rgb.r + rgb.g + rgb.b) < 0.000001) discard;\n",n.shaderChunks.particle_blendMultiplyPS="\n    rgb = mix(vec3(1.0), rgb, vec3(a));\n    if (rgb.r + rgb.g + rgb.b > 2.99) discard;\n",n.shaderChunks.particle_blendNormalPS="\n    if (a < 0.01) discard;\n",n.shaderChunks.particle_cpuVS="attribute vec4 particle_vertexData;     // XYZ = world pos, W = life\nattribute vec4 particle_vertexData2;     // X = angle, Y = scale, Z = alpha, W = velocity.x\nattribute vec4 particle_vertexData3;     // XYZ = particle local pos, W = velocity.y\nattribute vec2 particle_vertexData4;     // X = velocity.z, W = particle ID\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\nuniform float numParticles;\nuniform float lifetime;\nuniform float stretch;\n//uniform float graphSampleSize;\n//uniform float graphNumSamples;\nuniform vec3 wrapBounds, emitterScale;\nuniform sampler2D texLifeAndSourcePosOUT;\nuniform sampler2D internalTex0;\nuniform sampler2D internalTex1;\nuniform sampler2D internalTex2;\nuniform vec3 emitterPos;\nvarying vec4 texCoordsAlphaLife;\nvec2 rotate(vec2 quadXY, float pRotation, out mat2 rotMatrix)\n{\n    float c = cos(pRotation);\n    float s = sin(pRotation);\n    //vec4 rotationMatrix = vec4(c, -s, s, c);\n    mat2 m = mat2(c, -s, s, c);\n    rotMatrix = m;\n    return m * quadXY;\n}\nvec3 billboard(vec3 InstanceCoords, vec2 quadXY)\n{\n    vec3 pos = -matrix_viewInverse[0].xyz * quadXY.x + -matrix_viewInverse[1].xyz * quadXY.y;\n    return pos;\n}\nvoid main(void)\n{\n    vec3 particlePos = particle_vertexData.xyz;\n    vec3 inPos = particlePos;\n    vec3 vertPos = particle_vertexData3.xyz;\n    vec3 inVel = vec3(particle_vertexData2.w, particle_vertexData3.w, particle_vertexData4.x);\n    vec2 velocityV = normalize((mat3(matrix_view) * inVel).xy); // should be removed by compiler if align/stretch is not used\n    vec2 quadXY = vertPos.xy;\n    texCoordsAlphaLife = vec4(quadXY * -0.5 + 0.5, particle_vertexData2.z, particle_vertexData.w);\n    mat2 rotMatrix;\n    float inAngle = particle_vertexData2.x;\n    vec3 particlePosMoved = vec3(0.0);\n    vec3 meshLocalPos = particle_vertexData3.xyz;\n",n.shaderChunks.particle_cpu_endVS="\n    localPos *= particle_vertexData2.y * emitterScale;\n    localPos += particlePos;\n    gl_Position = matrix_viewProjection * vec4(localPos, 1.0);\n",n.shaderChunks.particle_endPS="    rgb = addFog(rgb);\n    rgb = toneMap(rgb);\n    rgb = gammaCorrectOutput(rgb);\n    gl_FragColor = vec4(rgb, a);\n}\n",n.shaderChunks.particle_endVS="\n    localPos *= scale * emitterScale;\n    localPos += particlePos;\n    gl_Position = matrix_viewProjection * vec4(localPos.xyz, 1.0);\n",n.shaderChunks.particle_halflambertPS="\n    vec3 negNormal = normal*0.5+0.5;\n    vec3 posNormal = -normal*0.5+0.5;\n    negNormal *= negNormal;\n    posNormal *= posNormal;\n",n.shaderChunks.particle_initVS="attribute vec4 particle_vertexData; // XYZ = particle position, W = particle ID + random factor\nuniform mat4 matrix_viewProjection;\nuniform mat4 matrix_model;\nuniform mat3 matrix_normal;\nuniform mat4 matrix_viewInverse;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform float numParticles, numParticlesPot;\nuniform float graphSampleSize;\nuniform float graphNumSamples;\nuniform float stretch;\nuniform vec3 wrapBounds;\nuniform vec3 emitterScale, emitterPos;\nuniform float rate, rateDiv, lifetime, deltaRandomnessStatic, scaleDivMult, alphaDivMult, seed, delta;\nuniform sampler2D particleTexOUT, particleTexIN;\nuniform sampler2D internalTex0;\nuniform sampler2D internalTex1;\nuniform sampler2D internalTex2;\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params;\n#endif\nvarying vec4 texCoordsAlphaLife;\nvec3 inPos;\nvec3 inVel;\nfloat inAngle;\nbool inShow;\nfloat inLife;\n",n.shaderChunks.particle_lambertPS="\n    vec3 negNormal = max(normal, vec3(0.0));\n    vec3 posNormal = max(-normal, vec3(0.0));\n",n.shaderChunks.particle_lightingPS="\n    vec3 light = negNormal.x*lightCube[0] + posNormal.x*lightCube[1] +\n                        negNormal.y*lightCube[2] + posNormal.y*lightCube[3] +\n                        negNormal.z*lightCube[4] + posNormal.z*lightCube[5];\n    rgb *= light;\n",n.shaderChunks.particle_localShiftVS="    particlePos += emitterPos;\n",n.shaderChunks.particle_meshVS="\n    vec3 localPos = meshLocalPos;\n    localPos.xy = rotate(localPos.xy, inAngle, rotMatrix);\n    localPos.yz = rotate(localPos.yz, inAngle, rotMatrix);\n    billboard(particlePos, quadXY);\n",n.shaderChunks.particle_normalVS="\n    Normal = normalize(localPos + matrix_viewInverse[2].xyz);\n",n.shaderChunks.particle_normalMapPS="\n    vec3 normalMap         = normalize( texture2D(normalMap, texCoordsAlphaLife.xy).xyz * 2.0 - 1.0 );\n    vec3 normal = ParticleMat * normalMap;\n",n.shaderChunks.particle_pointAlongVS="    inAngle = atan(velocityV.x, velocityV.y); // not the fastest way, but easier to plug in; TODO: create rot matrix right from vectors\n",n.shaderChunks.particle_softPS="\n    float depth = getLinearScreenDepth();\n    float particleDepth = vDepth;\n    float depthDiff = saturate(abs(particleDepth - depth) * softening);\n    a *= depthDiff;\n",n.shaderChunks.particle_softVS="\n    vDepth = getLinearDepth(localPos);\n",n.shaderChunks.particle_stretchVS="    vec3 moveDir = inVel * stretch;\n    vec3 posPrev = inPos - moveDir;\n    posPrev += particlePosMoved;\n    vec2 centerToVertexV = normalize((mat3(matrix_view) * localPos).xy);\n    float interpolation = dot(-velocityV, centerToVertexV) * 0.5 + 0.5;\n    particlePos = mix(particlePos, posPrev, interpolation);\n",n.shaderChunks.particle_wrapVS="\n    vec3 origParticlePos = particlePos;\n    particlePos -= matrix_model[3].xyz;\n    particlePos = mod(particlePos, wrapBounds) - wrapBounds * 0.5;\n    particlePos += matrix_model[3].xyz;\n    particlePosMoved = particlePos - origParticlePos;\n",n.shaderChunks.precisionTestPS="void main(void) {\n    gl_FragColor = vec4(2147483648.0);\n}\n",n.shaderChunks.precisionTest2PS="uniform sampler2D source;\nvec4 packFloat(float depth) {\n    const vec4 bit_shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n    const vec4 bit_mask  = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n    vec4 res = mod(depth * bit_shift * vec4(255), vec4(256) ) / vec4(255);\n    res -= res.xxyz * bit_mask;\n    return res;\n}\nvoid main(void) {\n    float c = texture2D(source, vec2(0.0)).r;\n    float diff = abs(c - 2147483648.0) / 2147483648.0;\n    gl_FragColor = packFloat(diff);\n}\n",n.shaderChunks.prefilterCubemapPS="varying vec2 vUv0;\nuniform samplerCube source;\nuniform vec4 params;\nfloat saturate(float x) {\n    return clamp(x, 0.0, 1.0);\n}\nfloat rnd(vec2 uv) {\n    return fract(sin(dot(uv, vec2(12.9898, 78.233) * 2.0)) * 43758.5453);\n}\nconst float PI = 3.14159265358979;\nvec3 hemisphereSample_cos(vec2 uv, mat3 vecSpace, vec3 cubeDir, float gloss) { // cos + lerped cone size (better than just lerped)\n    float phi = uv.y * 2.0 * PI;\n    float cosTheta = sqrt(1.0 - uv.x);\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n    return normalize(mix(vecSpace * sampleDir, cubeDir, params.y));\n}\nvec3 hemisphereSample_phong(vec2 uv, mat3 vecSpace, vec3 cubeDir, float specPow) {\n    float phi = uv.y * 2.0 * PI;\n    float cosTheta = pow(1.0 - uv.x, 1.0 / (specPow + 1.0));\n    float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n    vec3 sampleDir = vec3(cos(phi) * sinTheta, sin(phi) * sinTheta, cosTheta);\n    return vecSpace * sampleDir;\n}\nmat3 matrixFromVector(vec3 n) { // frisvad\n    float a = 1.0 / (1.0 + n.z);\n    float b = -n.x * n.y * a;\n    vec3 b1 = vec3(1.0 - n.x * n.x * a, b, -n.x);\n    vec3 b2 = vec3(b, 1.0 - n.y * n.y * a, -n.y);\n    return mat3(b1, b2, n);\n}\nvec4 encodeRGBM(vec3 color) { // modified RGBM\n    vec4 encoded;\n    encoded.rgb = pow(color.rgb, vec3(0.5));\n    encoded.rgb *= 1.0 / 8.0;\n    encoded.a = saturate( max( max( encoded.r, encoded.g ), max( encoded.b, 1.0 / 255.0 ) ) );\n    encoded.a = ceil(encoded.a * 255.0) / 255.0;\n    encoded.rgb /= encoded.a;\n    return encoded;\n}\nvoid main(void) {\n    vec2 st = vUv0 * 2.0 - 1.0;\n    if (params.w==1.0 || params.w==3.0) {\n        st = 2.0 * floor(gl_FragCoord.xy) / (params.z - 1.0) - 1.0;\n    }\n    float face = params.x;\n    vec3 vec;\n    if (face==0.0) {\n        vec = vec3(1, -st.y, -st.x);\n    } else if (face==1.0) {\n        vec = vec3(-1, -st.y, st.x);\n    } else if (face==2.0) {\n        vec = vec3(st.x, 1, st.y);\n    } else if (face==3.0) {\n        vec = vec3(st.x, -1, -st.y);\n    } else if (face==4.0) {\n        vec = vec3(st.x, -st.y, 1);\n    } else {\n        vec = vec3(-st.x, -st.y, -1);\n    }\n    mat3 vecSpace = matrixFromVector(normalize(vec));\n    vec3 color = vec3(0.0);\n    const int samples = $NUMSAMPLES;\n    vec3 vect;\n    for(int i=0; i<samples; i++) {\n        float sini = sin(float(i));\n        float cosi = cos(float(i));\n        float rand = rnd(vec2(sini, cosi));\n        vect = hemisphereSample_$METHOD(vec2(float(i) / float(samples), rand), vecSpace, vec, params.y);\n        color += $textureCube(source, vect).rgb;\n    }\n    color /= float(samples);\n    gl_FragColor = params.w < 2.0? vec4(color, 1.0) : encodeRGBM(color);\n}\n",n.shaderChunks.reflDirPS="void getReflDir() {\n    dReflDirW = normalize(-reflect(dViewDirW, dNormalW));\n}\n",n.shaderChunks.reflectionCubePS="uniform samplerCube texture_cubeMap;\nuniform float material_reflectivity;\nvoid addReflection() {\n    vec3 lookupVec = fixSeams(cubeMapProject(dReflDirW));\n    lookupVec.x *= -1.0;\n    dReflection += vec4($textureCubeSAMPLE(texture_cubeMap, lookupVec).rgb, material_reflectivity);\n}\n",n.shaderChunks.reflectionDpAtlasPS="uniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvec2 getDpAtlasUv(vec2 uv, float mip) {\n    vec4 rect;\n    float sx = saturate(mip - 2.0);\n    rect.x = sx * 0.5;\n    float t = mip - rect.x * 6.0;\n    float i = 1.0 - rect.x;\n    rect.y = min(t * 0.5, 0.75) * i + rect.x;\n    float st = saturate(t);\n    rect.z = (1.0 - st * 0.5) * i;\n    rect.w = rect.z * 0.5;\n    float rcRectZ = 1.0 / rect.z;\n    float scaleFactor = 0.00390625 * rcRectZ; // 0.0078125 = (256 + 2) / 256 - 1, 0.00390625 same for 512\n    vec2 scale = vec2(scaleFactor, scaleFactor * 2.0);\n    uv = uv * (vec2(1.0) - scale) + scale * 0.5;\n    uv = uv * rect.zw + rect.xy;\n    return uv;\n}\nvoid addReflection() {\n    vec3 reflDir = normalize(cubeMapProject(dReflDirW));\n    // Convert vector to DP coords\n    bool up = reflDir.y > 0.0;\n    float scale = 0.90909090909090909090909090909091;// 1.0 / 1.1;\n    vec3 reflDirWarp = reflDir.xzx * vec3(-0.25, 0.5, 0.25);\n    float reflDirVer = abs(reflDir.y) + 1.0;\n    reflDirWarp /= reflDirVer;\n    reflDirWarp *= scale;\n    reflDirWarp = vec3(0.75, 0.5, 0.25) - reflDirWarp;\n    vec2 tc = up? reflDirWarp.xy : reflDirWarp.zy;\n    float bias = saturate(1.0 - dGlossiness) * 5.0; // multiply by max mip level\n    float mip = floor(bias);\n    vec3 tex1 = $texture2DSAMPLE(texture_sphereMap, getDpAtlasUv(tc, mip)).rgb;\n    mip = min(mip + 1.0, 5.0);\n    vec3 tex2 = $texture2DSAMPLE(texture_sphereMap, getDpAtlasUv(tc, mip)).rgb;\n    tex1 = mix(tex1, tex2, fract(bias));\n    tex1 = processEnvironment(tex1);\n    dReflection += vec4(tex1, material_reflectivity);\n}\n",n.shaderChunks.reflectionPrefilteredCubePS="uniform samplerCube texture_prefilteredCubeMap128;\nuniform samplerCube texture_prefilteredCubeMap64;\nuniform samplerCube texture_prefilteredCubeMap32;\nuniform samplerCube texture_prefilteredCubeMap16;\nuniform samplerCube texture_prefilteredCubeMap8;\n#ifndef PMREM4\n#define PMREM4\nuniform samplerCube texture_prefilteredCubeMap4;\n#endif\nuniform float material_reflectivity;\nvoid addReflection() {\n    // Unfortunately, WebGL doesn't allow us using textureCubeLod. Therefore bunch of nasty workarounds is required.\n    // We fix mip0 to 128x128, so code is rather static.\n    // Mips smaller than 4x4 aren't great even for diffuse. Don't forget that we don't have bilinear filtering between different faces.\n    float bias = saturate(1.0 - dGlossiness) * 5.0; // multiply by max mip level\n    int index1 = int(bias);\n    int index2 = int(min(bias + 1.0, 7.0));\n    vec3 fixedReflDir = fixSeams(cubeMapProject(dReflDirW), bias);\n    fixedReflDir.x *= -1.0;\n    vec4 cubes[6];\n    cubes[0] = textureCube(texture_prefilteredCubeMap128, fixedReflDir);\n    cubes[1] = textureCube(texture_prefilteredCubeMap64, fixedReflDir);\n    cubes[2] = textureCube(texture_prefilteredCubeMap32, fixedReflDir);\n    cubes[3] = textureCube(texture_prefilteredCubeMap16, fixedReflDir);\n    cubes[4] = textureCube(texture_prefilteredCubeMap8, fixedReflDir);\n    cubes[5] = textureCube(texture_prefilteredCubeMap4, fixedReflDir);\n    // Also we don't have dynamic indexing in PS, so...\n    vec4 cube[2];\n    for(int i = 0; i < 6; i++) {\n        if (i == index1) {\n            cube[0] = cubes[i];\n        }\n        if (i == index2) {\n            cube[1] = cubes[i];\n        }\n    }\n    // another variant\n    /*if (index1==0){ cube[0]=cubes[0];\n    }else if (index1==1){ cube[0]=cubes[1];\n    }else if (index1==2){ cube[0]=cubes[2];\n    }else if (index1==3){ cube[0]=cubes[3];\n    }else if (index1==4){ cube[0]=cubes[4];\n    }else if (index1==5){ cube[0]=cubes[5];}\n    if (index2==0){ cube[1]=cubes[0];\n    }else if (index2==1){ cube[1]=cubes[1];\n    }else if (index2==2){ cube[1]=cubes[2];\n    }else if (index2==3){ cube[1]=cubes[3];\n    }else if (index2==4){ cube[1]=cubes[4];\n    }else if (index2==5){ cube[1]=cubes[5];}*/\n    vec4 cubeFinal = mix(cube[0], cube[1], fract(bias));\n    vec3 refl = processEnvironment($DECODE(cubeFinal).rgb);\n    dReflection += vec4(refl, material_reflectivity);\n}\n",n.shaderChunks.reflectionPrefilteredCubeLodPS="\n#ifndef PMREM4\n#define PMREM4\n#extension GL_EXT_shader_texture_lod : enable\nuniform samplerCube texture_prefilteredCubeMap128;\n#endif\nuniform float material_reflectivity;\nvoid addReflection() {\n    float bias = saturate(1.0 - dGlossiness) * 5.0; // multiply by max mip level\n    vec3 fixedReflDir = fixSeams(cubeMapProject(dReflDirW), bias);\n    fixedReflDir.x *= -1.0;\n    vec3 refl = processEnvironment($DECODE( textureCubeLodEXT(texture_prefilteredCubeMap128, fixedReflDir, bias) ).rgb);\n    dReflection += vec4(refl, material_reflectivity);\n}\n",n.shaderChunks.reflectionSpherePS="#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvoid addReflection() {\n    vec3 reflDirV = (mat3(matrix_view) * dReflDirW).xyz;\n    float m = 2.0 * sqrt( dot(reflDirV.xy, reflDirV.xy) + (reflDirV.z+1.0)*(reflDirV.z+1.0) );\n    vec2 sphereMapUv = reflDirV.xy / m + 0.5;\n    dReflection += vec4($texture2DSAMPLE(texture_sphereMap, sphereMapUv).rgb, material_reflectivity);\n}\n",n.shaderChunks.reflectionSphereLowPS="uniform sampler2D texture_sphereMap;\nuniform float material_reflectivity;\nvoid addReflection() {\n    vec3 reflDirV = vNormalV;\n    vec2 sphereMapUv = reflDirV.xy * 0.5 + 0.5;\n    dReflection += vec4($texture2DSAMPLE(texture_sphereMap, sphereMapUv).rgb, material_reflectivity);\n}\n",
n.shaderChunks.refractionPS="uniform float material_refraction, material_refractionIndex;\nvec3 refract2(vec3 viewVec, vec3 Normal, float IOR) {\n    float vn = dot(viewVec, Normal);\n    float k = 1.0 - IOR * IOR * (1.0 - vn * vn);\n    vec3 refrVec = IOR * viewVec - (IOR * vn + sqrt(k)) * Normal;\n    return refrVec;\n}\nvoid addRefraction() {\n    // use same reflection code with refraction vector\n    vec3 tmp = dReflDirW;\n    vec4 tmp2 = dReflection;\n    dReflection = vec4(0.0);\n    dReflDirW = refract2(-dViewDirW, dNormalW, material_refractionIndex);\n    addReflection();\n    dDiffuseLight = mix(dDiffuseLight, dReflection.rgb * dAlbedo, material_refraction);\n    dReflDirW = tmp;\n    dReflection = tmp2;\n}\n",n.shaderChunks.rgbmPS="vec3 decodeRGBM(vec4 rgbm) {\n    vec3 color = (8.0 * rgbm.a) * rgbm.rgb;\n    return color * color;\n}\nvec3 texture2DRGBM(sampler2D tex, vec2 uv) {\n    return decodeRGBM(texture2D(tex, uv));\n}\nvec3 textureCubeRGBM(samplerCube tex, vec3 uvw) {\n    return decodeRGBM(textureCube(tex, uvw));\n}\n",n.shaderChunks.screenDepthPS="uniform sampler2D uDepthMap;\n#ifndef SCREENSIZE\n#define SCREENSIZE\nuniform vec4 uScreenSize;\n#endif\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\n#ifndef CAMERAPLANES\n#define CAMERAPLANES\nuniform vec4 camera_params; // 1 / camera_far,      camera_far,     (1 - f / n) / 2,        (1 + f / n) / 2\n#endif\n#ifdef GL2\n    float linearizeDepth(float z) {\n        z = z * 2.0 - 1.0;\n        return 1.0 / (camera_params.z * z + camera_params.w);\n    }\n#else\n    #ifndef UNPACKFLOAT\n    #define UNPACKFLOAT\n    float unpackFloat(vec4 rgbaDepth) {\n        const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n        return dot(rgbaDepth, bitShift);\n    }\n    #endif\n#endif\n// Retrieves rendered linear camera depth by UV\nfloat getLinearScreenDepth(vec2 uv) {\n    #ifdef GL2\n        return linearizeDepth(texture2D(uDepthMap, uv).r) * camera_params.y;\n    #else\n        return unpackFloat(texture2D(uDepthMap, uv)) * camera_params.y;\n    #endif\n}\n#ifndef VERTEXSHADER\n// Retrieves rendered linear camera depth under the current pixel\nfloat getLinearScreenDepth() {\n    vec2 uv = gl_FragCoord.xy * uScreenSize.zw;\n    return getLinearScreenDepth(uv);\n}\n#endif\n// Generates linear camera depth for the given world position\nfloat getLinearDepth(vec3 pos) {\n    return -(matrix_view * vec4(pos, 1.0)).z;\n}\n",n.shaderChunks.shadowCommonPS="void normalOffsetPointShadow(vec4 shadowParams) {\n    float distScale = length(dLightDirW);\n    vec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale; //0.02\n    vec3 dir = wPos - dLightPosW;\n    dLightDirW = dir;\n}\n",n.shaderChunks.shadowCoordPS="void _getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n    dShadowCoord = (shadowMatrix * vec4(wPos, 1.0)).xyz;\n    dShadowCoord.z = saturate(dShadowCoord.z) - 0.0001;\n    #ifdef SHADOWBIAS\n        dShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n    #endif\n}\nvoid _getShadowCoordPersp(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {\n    vec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n    projPos.xy /= projPos.w;\n    dShadowCoord.xy = projPos.xy;\n    dShadowCoord.z = length(dLightDirW) * shadowParams.w;\n    #ifdef SHADOWBIAS\n        dShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n    #endif\n}\nvoid getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams) {\n    _getShadowCoordOrtho(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPersp(mat4 shadowMatrix, vec4 shadowParams) {\n    _getShadowCoordPersp(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPerspNormalOffset(mat4 shadowMatrix, vec4 shadowParams) {\n    float distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW)); // fov?\n    vec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n    _getShadowCoordPersp(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordOrthoNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n    vec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0); //0.08\n    _getShadowCoordOrtho(shadowMatrix, shadowParams, wPos);\n}\n",n.shaderChunks.shadowCoordVS="void getLightDirPoint(vec3 lightPosW) {\n    vec3 lightDirW = vPositionW - lightPosW;\n    dLightDirNormW = normalize(lightDirW);\n    dLightPosW = lightPosW;\n}\nvoid _getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n    vec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n    vMainShadowUv = projPos;\n}\nvoid _getShadowCoordPersp(mat4 shadowMatrix, vec3 shadowParams, vec3 wPos) {\n    vec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n    vMainShadowUv = projPos;\n}\nvoid getShadowCoordOrtho(mat4 shadowMatrix, vec3 shadowParams) {\n    _getShadowCoordOrtho(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPersp(mat4 shadowMatrix, vec3 shadowParams) {\n    _getShadowCoordPersp(shadowMatrix, shadowParams, vPositionW);\n}\nvoid getShadowCoordPerspNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n    float distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW)); // fov?\n    vec3 wPos = vPositionW + dNormalW * shadowParams.y * clamp(1.0 - dot(dNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n    _getShadowCoordPersp(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordOrthoNormalOffset(mat4 shadowMatrix, vec3 shadowParams) {\n    vec3 wPos = vPositionW + dNormalW * shadowParams.y * clamp(1.0 - dot(dNormalW, -dLightDirNormW), 0.0, 1.0); //0.08\n    _getShadowCoordOrtho(shadowMatrix, shadowParams, wPos);\n}\n",n.shaderChunks.shadowCoordPerspZbufferPS="void _getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams, vec3 wPos) {\n    vec4 projPos = shadowMatrix * vec4(wPos, 1.0);\n    projPos.xyz /= projPos.w;\n    dShadowCoord = projPos.xyz;\n    // depth bias is already applied on render\n}\nvoid getShadowCoordPerspZbufferNormalOffset(mat4 shadowMatrix, vec4 shadowParams) {\n    float distScale = abs(dot(vPositionW - dLightPosW, dLightDirNormW)); // fov?\n    vec3 wPos = vPositionW + dVertexNormalW * shadowParams.y * clamp(1.0 - dot(dVertexNormalW, -dLightDirNormW), 0.0, 1.0) * distScale;\n    _getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, wPos);\n}\nvoid getShadowCoordPerspZbuffer(mat4 shadowMatrix, vec4 shadowParams) {\n    _getShadowCoordPerspZbuffer(shadowMatrix, shadowParams, vPositionW);\n}\n",n.shaderChunks.shadowEVSMPS="float VSM$(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n    vec3 moments = texture2D(tex, texCoords).xyz;\n    return calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n    return VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n    return VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n",n.shaderChunks.shadowEVSMnPS="float VSM$(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n    float pixelSize = 1.0 / resolution;\n    texCoords -= vec2(pixelSize);\n    vec3 s00 = texture2D(tex, texCoords).xyz;\n    vec3 s10 = texture2D(tex, texCoords + vec2(pixelSize, 0)).xyz;\n    vec3 s01 = texture2D(tex, texCoords + vec2(0, pixelSize)).xyz;\n    vec3 s11 = texture2D(tex, texCoords + vec2(pixelSize)).xyz;\n    vec2 fr = fract(texCoords * resolution);\n    vec3 h0 = mix(s00, s10, fr.x);\n    vec3 h1 = mix(s01, s11, fr.x);\n    vec3 moments = mix(h0, h1, fr.y);\n    return calculateEVSM(moments, Z, vsmBias, exponent);\n}\nfloat getShadowVSM$(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n    return VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\nfloat getShadowSpotVSM$(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n    return VSM$(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, exponent);\n}\n",n.shaderChunks.shadowStandardPS="vec3 lessThan2(vec3 a, vec3 b) {\n    return clamp((b - a)*1000.0, 0.0, 1.0); // softer version\n}\n#ifndef UNPACKFLOAT\n#define UNPACKFLOAT\nfloat unpackFloat(vec4 rgbaDepth) {\n    const vec4 bitShift = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0);\n    return dot(rgbaDepth, bitShift);\n}\n#endif\n// ----- Direct/Spot Sampling -----\n#ifdef GL2\n    float _getShadowPCF3x3(sampler2DShadow shadowMap, vec3 shadowParams) {\n        float z = dShadowCoord.z;\n        vec2 uv = dShadowCoord.xy * shadowParams.x; // 1 unit - 1 texel\n        float shadowMapSizeInv = 1.0 / shadowParams.x;\n        vec2 base_uv = floor(uv + 0.5);\n        float s = (uv.x + 0.5 - base_uv.x);\n        float t = (uv.y + 0.5 - base_uv.y);\n        base_uv -= vec2(0.5);\n        base_uv *= shadowMapSizeInv;\n        float sum = 0.0;\n        float uw0 = (3.0 - 2.0 * s);\n        float uw1 = (1.0 + 2.0 * s);\n        float u0 = (2.0 - s) / uw0 - 1.0;\n        float u1 = s / uw1 + 1.0;\n        float vw0 = (3.0 - 2.0 * t);\n        float vw1 = (1.0 + 2.0 * t);\n        float v0 = (2.0 - t) / vw0 - 1.0;\n        float v1 = t / vw1 + 1.0;\n        u0 = u0 * shadowMapSizeInv + base_uv.x;\n        v0 = v0 * shadowMapSizeInv + base_uv.y;\n        u1 = u1 * shadowMapSizeInv + base_uv.x;\n        v1 = v1 * shadowMapSizeInv + base_uv.y;\n        sum += uw0 * vw0 * texture(shadowMap, vec3(u0, v0, z));\n        sum += uw1 * vw0 * texture(shadowMap, vec3(u1, v0, z));\n        sum += uw0 * vw1 * texture(shadowMap, vec3(u0, v1, z));\n        sum += uw1 * vw1 * texture(shadowMap, vec3(u1, v1, z));\n        sum *= 1.0f / 16.0;\n        return sum;\n    }\n    float getShadowPCF3x3(sampler2DShadow shadowMap, vec3 shadowParams) {\n        return _getShadowPCF3x3(shadowMap, shadowParams);\n    }\n    float getShadowSpotPCF3x3(sampler2DShadow shadowMap, vec4 shadowParams) {\n        return _getShadowPCF3x3(shadowMap, shadowParams.xyz);\n    }\n#else\n    float _xgetShadowPCF3x3(mat3 depthKernel, sampler2D shadowMap, vec3 shadowParams) {\n        mat3 shadowKernel;\n        vec3 shadowCoord = dShadowCoord;\n        vec3 shadowZ = vec3(shadowCoord.z);\n        shadowKernel[0] = vec3(greaterThan(depthKernel[0], shadowZ));\n        shadowKernel[1] = vec3(greaterThan(depthKernel[1], shadowZ));\n        shadowKernel[2] = vec3(greaterThan(depthKernel[2], shadowZ));\n        vec2 fractionalCoord = fract( shadowCoord.xy * shadowParams.x );\n        shadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n        shadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n        vec4 shadowValues;\n        shadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n        shadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n        shadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n        shadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n        return dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n    }\n    float _getShadowPCF3x3(sampler2D shadowMap, vec3 shadowParams) {\n        vec3 shadowCoord = dShadowCoord;\n        float xoffset = 1.0 / shadowParams.x; // 1/shadow map width\n        float dx0 = -xoffset;\n        float dx1 = xoffset;\n        mat3 depthKernel;\n        depthKernel[0][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, dx0)));\n        depthKernel[0][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, 0.0)));\n        depthKernel[0][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx0, dx1)));\n        depthKernel[1][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(0.0, dx0)));\n        depthKernel[1][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy));\n        depthKernel[1][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(0.0, dx1)));\n        depthKernel[2][0] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, dx0)));\n        depthKernel[2][1] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, 0.0)));\n        depthKernel[2][2] = unpackFloat(texture2D(shadowMap, shadowCoord.xy + vec2(dx1, dx1)));\n        return _xgetShadowPCF3x3(depthKernel, shadowMap, shadowParams);\n    }\n    float getShadowPCF3x3(sampler2D shadowMap, vec3 shadowParams) {\n        return _getShadowPCF3x3(shadowMap, shadowParams);\n    }\n    float getShadowSpotPCF3x3(sampler2D shadowMap, vec4 shadowParams) {\n        return _getShadowPCF3x3(shadowMap, shadowParams.xyz);\n    }\n#endif\n// ----- Point Sampling -----\nfloat _getShadowPoint(samplerCube shadowMap, vec4 shadowParams, vec3 dir) {\n    vec3 tc = normalize(dir);\n    vec3 tcAbs = abs(tc);\n    vec4 dirX = vec4(1,0,0, tc.x);\n    vec4 dirY = vec4(0,1,0, tc.y);\n    float majorAxisLength = tc.z;\n    if ((tcAbs.x > tcAbs.y) && (tcAbs.x > tcAbs.z)) {\n        dirX = vec4(0,0,1, tc.z);\n        dirY = vec4(0,1,0, tc.y);\n        majorAxisLength = tc.x;\n    } else if ((tcAbs.y > tcAbs.x) && (tcAbs.y > tcAbs.z)) {\n        dirX = vec4(1,0,0, tc.x);\n        dirY = vec4(0,0,1, tc.z);\n        majorAxisLength = tc.y;\n    }\n    float shadowParamsInFaceSpace = ((1.0/shadowParams.x) * 2.0) * abs(majorAxisLength);\n    vec3 xoffset = (dirX.xyz * shadowParamsInFaceSpace);\n    vec3 yoffset = (dirY.xyz * shadowParamsInFaceSpace);\n    vec3 dx0 = -xoffset;\n    vec3 dy0 = -yoffset;\n    vec3 dx1 = xoffset;\n    vec3 dy1 = yoffset;\n    mat3 shadowKernel;\n    mat3 depthKernel;\n    depthKernel[0][0] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy0));\n    depthKernel[0][1] = unpackFloat(textureCube(shadowMap, tc + dx0));\n    depthKernel[0][2] = unpackFloat(textureCube(shadowMap, tc + dx0 + dy1));\n    depthKernel[1][0] = unpackFloat(textureCube(shadowMap, tc + dy0));\n    depthKernel[1][1] = unpackFloat(textureCube(shadowMap, tc));\n    depthKernel[1][2] = unpackFloat(textureCube(shadowMap, tc + dy1));\n    depthKernel[2][0] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy0));\n    depthKernel[2][1] = unpackFloat(textureCube(shadowMap, tc + dx1));\n    depthKernel[2][2] = unpackFloat(textureCube(shadowMap, tc + dx1 + dy1));\n    vec3 shadowZ = vec3(length(dir) * shadowParams.w + shadowParams.z);\n    shadowKernel[0] = vec3(lessThan2(depthKernel[0], shadowZ));\n    shadowKernel[1] = vec3(lessThan2(depthKernel[1], shadowZ));\n    shadowKernel[2] = vec3(lessThan2(depthKernel[2], shadowZ));\n    vec2 uv = (vec2(dirX.w, dirY.w) / abs(majorAxisLength)) * 0.5;\n    vec2 fractionalCoord = fract( uv * shadowParams.x );\n    shadowKernel[0] = mix(shadowKernel[0], shadowKernel[1], fractionalCoord.x);\n    shadowKernel[1] = mix(shadowKernel[1], shadowKernel[2], fractionalCoord.x);\n    vec4 shadowValues;\n    shadowValues.x = mix(shadowKernel[0][0], shadowKernel[0][1], fractionalCoord.y);\n    shadowValues.y = mix(shadowKernel[0][1], shadowKernel[0][2], fractionalCoord.y);\n    shadowValues.z = mix(shadowKernel[1][0], shadowKernel[1][1], fractionalCoord.y);\n    shadowValues.w = mix(shadowKernel[1][1], shadowKernel[1][2], fractionalCoord.y);\n    return 1.0 - dot( shadowValues, vec4( 1.0 ) ) * 0.25;\n}\nfloat getShadowPointPCF3x3(samplerCube shadowMap, vec4 shadowParams) {\n    return _getShadowPoint(shadowMap, shadowParams, dLightDirW);\n}\n",n.shaderChunks.shadowStandardGL2PS="float _getShadowPCF5x5(sampler2DShadow shadowMap, vec3 shadowParams) {\n    // http://the-witness.net/news/2013/09/shadow-mapping-summary-part-1/\n    float z = dShadowCoord.z;\n    vec2 uv = dShadowCoord.xy * shadowParams.x; // 1 unit - 1 texel\n    float shadowMapSizeInv = 1.0 / shadowParams.x;\n    vec2 base_uv = floor(uv + 0.5);\n    float s = (uv.x + 0.5 - base_uv.x);\n    float t = (uv.y + 0.5 - base_uv.y);\n    base_uv -= vec2(0.5);\n    base_uv *= shadowMapSizeInv;\n    float uw0 = (4.0 - 3.0 * s);\n    float uw1 = 7.0;\n    float uw2 = (1.0 + 3.0 * s);\n    float u0 = (3.0 - 2.0 * s) / uw0 - 2.0;\n    float u1 = (3.0 + s) / uw1;\n    float u2 = s / uw2 + 2.0;\n    float vw0 = (4.0 - 3.0 * t);\n    float vw1 = 7.0;\n    float vw2 = (1.0 + 3.0 * t);\n    float v0 = (3.0 - 2.0 * t) / vw0 - 2.0;\n    float v1 = (3.0 + t) / vw1;\n    float v2 = t / vw2 + 2.0;\n    float sum = 0.0;\n    u0 = u0 * shadowMapSizeInv + base_uv.x;\n    v0 = v0 * shadowMapSizeInv + base_uv.y;\n    u1 = u1 * shadowMapSizeInv + base_uv.x;\n    v1 = v1 * shadowMapSizeInv + base_uv.y;\n    u2 = u2 * shadowMapSizeInv + base_uv.x;\n    v2 = v2 * shadowMapSizeInv + base_uv.y;\n    sum += uw0 * vw0 * texture(shadowMap, vec3(u0, v0, z));\n    sum += uw1 * vw0 * texture(shadowMap, vec3(u1, v0, z));\n    sum += uw2 * vw0 * texture(shadowMap, vec3(u2, v0, z));\n    sum += uw0 * vw1 * texture(shadowMap, vec3(u0, v1, z));\n    sum += uw1 * vw1 * texture(shadowMap, vec3(u1, v1, z));\n    sum += uw2 * vw1 * texture(shadowMap, vec3(u2, v1, z));\n    sum += uw0 * vw2 * texture(shadowMap, vec3(u0, v2, z));\n    sum += uw1 * vw2 * texture(shadowMap, vec3(u1, v2, z));\n    sum += uw2 * vw2 * texture(shadowMap, vec3(u2, v2, z));\n    sum *= 1.0f / 144.0;\n    sum = gammaCorrectInput(sum); // gives softer gradient\n    sum = saturate(sum);\n    return sum;\n}\nfloat getShadowPCF5x5(sampler2DShadow shadowMap, vec3 shadowParams) {\n    return _getShadowPCF5x5(shadowMap, shadowParams);\n}\nfloat getShadowSpotPCF5x5(sampler2DShadow shadowMap, vec4 shadowParams) {\n    return _getShadowPCF5x5(shadowMap, shadowParams.xyz);\n}\n",n.shaderChunks.shadowStandardGL2VSPS="float getShadowPCF5x5VS(sampler2DShadow shadowMap, vec3 shadowParams) {\n    dShadowCoord = vMainShadowUv.xyz;\n    dShadowCoord.z = saturate(dShadowCoord.z) - 0.0001; // prevent going to dark after the far plane\n    return _getShadowPCF5x5(shadowMap, shadowParams);\n}\n",n.shaderChunks.shadowStandardVSPS="#ifdef GL2\n#define SHADOW_SAMPLERVS sampler2DShadow\n#else\n#define SHADOW_SAMPLERVS sampler2D\n#endif\nfloat getShadowPCF3x3VS(SHADOW_SAMPLERVS shadowMap, vec3 shadowParams) {\n    dShadowCoord = vMainShadowUv.xyz;\n    dShadowCoord.z = saturate(dShadowCoord.z) - 0.0001;\n    #ifdef SHADOWBIAS\n        dShadowCoord.z += getShadowBias(shadowParams.x, shadowParams.z);\n    #endif\n    return _getShadowPCF3x3(shadowMap, shadowParams);\n}\n",n.shaderChunks.shadowVSM8PS="float calculateVSM8(vec3 moments, float Z, float vsmBias) {\n    float VSMBias = vsmBias;//0.01 * 0.25;\n    float depthScale = VSMBias * Z;\n    float minVariance1 = depthScale * depthScale;\n    return chebyshevUpperBound(moments.xy, Z, minVariance1, 0.1);\n}\nfloat decodeFloatRG(vec2 rg) {\n    return rg.y*(1.0/255.0) + rg.x;\n}\nfloat VSM8(sampler2D tex, vec2 texCoords, float resolution, float Z, float vsmBias, float exponent) {\n    vec4 c = texture2D(tex, texCoords);\n    vec3 moments = vec3(decodeFloatRG(c.xy), decodeFloatRG(c.zw), 0.0);\n    return calculateVSM8(moments, Z, vsmBias);\n}\nfloat getShadowVSM8(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n    return VSM8(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, 0.0);\n}\nfloat getShadowSpotVSM8(sampler2D shadowMap, vec4 shadowParams, float exponent) {\n    return VSM8(shadowMap, dShadowCoord.xy, shadowParams.x, length(dLightDirW) * shadowParams.w + shadowParams.z, shadowParams.y, 0.0);\n}\n",n.shaderChunks.shadowVSMVSPS="float getShadowVSM$VS(sampler2D shadowMap, vec3 shadowParams, float exponent) {\n    dShadowCoord = vMainShadowUv.xyz;\n    dShadowCoord.z += shadowParams.z;\n    dShadowCoord.xyz /= vMainShadowUv.w;\n    dShadowCoord.z = min(dShadowCoord.z, 1.0);\n    return $VSM(shadowMap, dShadowCoord.xy, shadowParams.x, dShadowCoord.z, shadowParams.y, exponent);\n}\n",n.shaderChunks.shadowVSM_commonPS="float linstep(float a, float b, float v) {\n    return saturate((v - a) / (b - a));\n}\nfloat reduceLightBleeding(float pMax, float amount) {\n  // Remove the [0, amount] tail and linearly rescale (amount, 1].\n   return linstep(amount, 1.0, pMax);\n}\nfloat chebyshevUpperBound(vec2 moments, float mean, float minVariance, float lightBleedingReduction) {\n    // Compute variance\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, minVariance);\n    // Compute probabilistic upper bound\n    float d = mean - moments.x;\n    float pMax = variance / (variance + (d * d));\n    pMax = reduceLightBleeding(pMax, lightBleedingReduction);\n    // One-tailed Chebyshev\n    return (mean <= moments.x ? 1.0 : pMax);\n}\nfloat calculateEVSM(vec3 moments, float Z, float vsmBias, float exponent) {\n    Z = 2.0 * Z - 1.0;\n    float warpedDepth = exp(exponent * Z);\n    moments.xy += vec2(warpedDepth, warpedDepth*warpedDepth) * (1.0 - moments.z);\n    float VSMBias = vsmBias;//0.01 * 0.25;\n    float depthScale = VSMBias * exponent * warpedDepth;\n    float minVariance1 = depthScale * depthScale;\n    return chebyshevUpperBound(moments.xy, warpedDepth, minVariance1, 0.1);\n}\n",n.shaderChunks.skinBatchConstVS="attribute float vertex_boneIndices;\nuniform mat4 matrix_pose[BONE_LIMIT];\nmat4 getBoneMatrix(const in float i) {\n    mat4 bone = matrix_pose[int(i)];\n    return bone;\n}\n",n.shaderChunks.skinBatchTexVS="attribute float vertex_boneIndices;\nuniform sampler2D texture_poseMap;\nuniform vec2 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i) {\n    float j = i * 4.0;\n    float x = mod(j, float(texture_poseMapSize.x));\n    float y = floor(j / float(texture_poseMapSize.x));\n    float dx = 1.0 / float(texture_poseMapSize.x);\n    float dy = 1.0 / float(texture_poseMapSize.y);\n    y = dy * (y + 0.5);\n    vec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n    vec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n    vec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n    vec4 v4 = texture2D(texture_poseMap, vec2(dx * (x + 3.5), y));\n    mat4 bone = mat4(v1, v2, v3, v4);\n    return bone;\n}\n",n.shaderChunks.skinConstVS="attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform mat4 matrix_pose[BONE_LIMIT];\nmat4 getBoneMatrix(const in float i)\n{\n    mat4 bone = matrix_pose[int(i)];\n    return bone;\n}\n",n.shaderChunks.skinTexVS="attribute vec4 vertex_boneWeights;\nattribute vec4 vertex_boneIndices;\nuniform sampler2D texture_poseMap;\nuniform vec2 texture_poseMapSize;\nmat4 getBoneMatrix(const in float i)\n{\n    float j = i * 4.0;\n    float x = mod(j, float(texture_poseMapSize.x));\n    float y = floor(j / float(texture_poseMapSize.x));\n    float dx = 1.0 / float(texture_poseMapSize.x);\n    float dy = 1.0 / float(texture_poseMapSize.y);\n    y = dy * (y + 0.5);\n    vec4 v1 = texture2D(texture_poseMap, vec2(dx * (x + 0.5), y));\n    vec4 v2 = texture2D(texture_poseMap, vec2(dx * (x + 1.5), y));\n    vec4 v3 = texture2D(texture_poseMap, vec2(dx * (x + 2.5), y));\n    vec4 v4 = texture2D(texture_poseMap, vec2(dx * (x + 3.5), y));\n    mat4 bone = mat4(v1, v2, v3, v4);\n    return bone;\n}\n",n.shaderChunks.skyboxPS="varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvoid main(void) {\n    gl_FragColor = textureCube(texture_cubeMap, fixSeams(vViewDir));\n}\n",n.shaderChunks.skyboxVS="attribute vec3 aPosition;\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nuniform mat4 matrix_projection;\nvarying vec3 vViewDir;\nvoid main(void)\n{\n    mat4 view = matrix_view;\n    view[3][0] = view[3][1] = view[3][2] = 0.0;\n    gl_Position = matrix_projection * view * vec4(aPosition, 1.0);\n    // Force skybox to far Z, regardless of the clip planes on the camera\n    // Subtract a tiny fudge factor to ensure floating point errors don't\n    // still push pixels beyond far Z. See:\n    // http://www.opengl.org/discussion_boards/showthread.php/171867-skybox-problem\n    gl_Position.z = gl_Position.w - 0.00001;\n    vViewDir = aPosition;\n    vViewDir.x *= -1.0;\n}\n",n.shaderChunks.skyboxHDRPS="varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvoid main(void) {\n    vec3 color = processEnvironment($textureCubeSAMPLE(texture_cubeMap, fixSeamsStatic(vViewDir, $FIXCONST)).rgb);\n    color = toneMap(color);\n    color = gammaCorrectOutput(color);\n    gl_FragColor = vec4(color, 1.0);\n}\n",n.shaderChunks.skyboxPrefilteredCubePS="varying vec3 vViewDir;\nuniform samplerCube texture_cubeMap;\nvec3 fixSeamsStretch(vec3 vec, float mipmapIndex, float cubemapSize) {\n    float scale = 1.0 - exp2(mipmapIndex) / cubemapSize;\n    float M = max(max(abs(vec.x), abs(vec.y)), abs(vec.z));\n    if (abs(vec.x) != M) vec.x *= scale;\n    if (abs(vec.y) != M) vec.y *= scale;\n    if (abs(vec.z) != M) vec.z *= scale;\n    return vec;\n}\nvoid main(void) {\n    vec3 color = textureCubeRGBM(texture_cubeMap, fixSeamsStretch(vViewDir, 0.0, 128.0));\n    color = toneMap(color);\n    color = gammaCorrectOutput(color);\n    gl_FragColor = vec4(color, 1.0);\n}\n",n.shaderChunks.specularPS="#ifdef MAPCOLOR\nuniform vec3 material_specular;\n#endif\n#ifdef MAPTEXTURE\nuniform sampler2D texture_specularMap;\n#endif\nvoid getSpecularity() {\n    dSpecularity = vec3(1.0);\n    #ifdef MAPCOLOR\n        dSpecularity *= material_specular;\n    #endif\n    #ifdef MAPTEXTURE\n        dSpecularity *= texture2D(texture_specularMap, $UV).$CH;\n    #endif\n    #ifdef MAPVERTEX\n        dSpecularity *= saturate(vVertexColor.$VC);\n    #endif\n}\n",n.shaderChunks.specularAaNonePS="float antiAliasGlossiness(float power) {\n    return power;\n}\n",n.shaderChunks.specularAaToksvigPS="float antiAliasGlossiness(float power) {\n    float rlen = 1.0 / saturate(length(dNormalMap));\n    float toksvig = 1.0 / (1.0 + power * (rlen - 1.0));\n    return power * toksvig;\n}\n",n.shaderChunks.specularAaToksvigFloatPS="float antiAliasGlossiness(float power) {\n    float rlen = 1.0 / saturate(length(dNormalMap));\n    float toksvig = 1.0 / (1.0 + power * (rlen - 1.0));\n    return power * mix(1.0, toksvig, material_bumpiness);\n}\n",n.shaderChunks.spotPS="float getSpotEffect(vec3 lightSpotDirW, float lightInnerConeAngle, float lightOuterConeAngle) {\n    float cosAngle = dot(dLightDirNormW, lightSpotDirW);\n    return smoothstep(lightOuterConeAngle, lightInnerConeAngle, cosAngle);\n}\n",n.shaderChunks.startPS="\nvoid main(void) {\n    dDiffuseLight = vec3(0);\n    dSpecularLight = vec3(0);\n    dReflection = vec4(0);\n    dSpecularity = vec3(0);\n",n.shaderChunks.startVS="\nvoid main(void) {\n    gl_Position = getPosition();\n",n.shaderChunks.storeEVSMPS="float exponent = VSM_EXPONENT;\ndepth = 2.0 * depth - 1.0;\ndepth =  exp(exponent * depth);\ngl_FragColor = vec4(depth, depth*depth, 1.0, 1.0);\n",n.shaderChunks.tangentBinormalVS="\nvec3 getTangent() {\n    return normalize(dNormalMatrix * vertex_tangent.xyz);\n}\nvec3 getBinormal() {\n    return cross(vNormalW, vTangentW) * vertex_tangent.w;\n}\n",n.shaderChunks.tonemappingAcesPS="uniform float exposure;\nvec3 toneMap(vec3 color) {\n    float tA = 2.51;\n    float tB = 0.03;\n    float tC = 2.43;\n    float tD = 0.59;\n    float tE = 0.14;\n    vec3 x = color * exposure;\n    return (x*(tA*x+tB))/(x*(tC*x+tD)+tE);\n}\n",n.shaderChunks.tonemappingAces2PS="uniform float exposure;\n// ACES approximation by Stephen Hill\n// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\nconst mat3 ACESInputMat = mat3(\n    0.59719, 0.35458, 0.04823,\n    0.07600, 0.90834, 0.01566,\n    0.02840, 0.13383, 0.83777\n);\n// ODT_SAT => XYZ => D60_2_D65 => sRGB\nconst mat3 ACESOutputMat = mat3(\n     1.60475, -0.53108, -0.07367,\n    -0.10208,  1.10813, -0.00605,\n    -0.00327, -0.07276,  1.07602\n);\nvec3 RRTAndODTFit(vec3 v) {\n    vec3 a = v * (v + 0.0245786) - 0.000090537;\n    vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;\n    return a / b;\n}\nvec3 toneMap(vec3 color) {\n    color *= exposure;\n    color = color * ACESInputMat;\n    // Apply RRT and ODT\n    color = RRTAndODTFit(color);\n    color = color * ACESOutputMat;\n    // Clamp to [0, 1]\n    color = clamp(color, 0.0, 1.0);\n    return color;\n}\n",n.shaderChunks.tonemappingFilmicPS="const float A =  0.15;\nconst float B =  0.50;\nconst float C =  0.10;\nconst float D =  0.20;\nconst float E =  0.02;\nconst float F =  0.30;\nconst float W =  11.2;\nuniform float exposure;\nvec3 uncharted2Tonemap(vec3 x) {\n   return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\n}\nvec3 toneMap(vec3 color) {\n    color = uncharted2Tonemap(color * exposure);\n    vec3 whiteScale = 1.0 / uncharted2Tonemap(vec3(W,W,W));\n    color = color * whiteScale;\n    return color;\n}\n",n.shaderChunks.tonemappingHejlPS="uniform float exposure;\nvec3 toneMap(vec3 color) {\n    color *= exposure;\n    const float  A = 0.22, B = 0.3, C = .1, D = 0.2, E = .01, F = 0.3;\n    const float Scl = 1.25;\n    vec3 h = max( vec3(0.0), color - vec3(0.004) );\n    return (h*((Scl*A)*h+Scl*vec3(C*B,C*B,C*B))+Scl*vec3(D*E,D*E,D*E)) / (h*(A*h+vec3(B,B,B))+vec3(D*F,D*F,D*F)) - Scl*vec3(E/F,E/F,E/F);\n}\n",n.shaderChunks.tonemappingLinearPS="uniform float exposure;\nvec3 toneMap(vec3 color) {\n    return color * exposure;\n}\n",n.shaderChunks.tonemappingNonePS="vec3 toneMap(vec3 color) {\n    return color;\n}\n",n.shaderChunks.transformVS="#ifdef PIXELSNAP\n    uniform vec4 uScreenSize;\n#endif\n#ifdef NINESLICED\n    #ifndef NINESLICE\n    #define NINESLICE\n    uniform vec4 innerOffset;\n    uniform vec2 outerScale;\n    uniform vec4 atlasRect;\n    varying vec2 vTiledUv;\n    #endif\n#endif\nmat4 getModelMatrix() {\n    #ifdef DYNAMICBATCH\n        return getBoneMatrix(vertex_boneIndices);\n    #elif defined(SKIN)\n        return matrix_model * (getBoneMatrix(vertex_boneIndices.x) * vertex_boneWeights.x +\n               getBoneMatrix(vertex_boneIndices.y) * vertex_boneWeights.y +\n               getBoneMatrix(vertex_boneIndices.z) * vertex_boneWeights.z +\n               getBoneMatrix(vertex_boneIndices.w) * vertex_boneWeights.w);\n    #elif defined(INSTANCING)\n        return mat4(instance_line1, instance_line2, instance_line3, instance_line4);\n    #else\n        return matrix_model;\n    #endif\n}\nvec4 getPosition() {\n    dModelMatrix = getModelMatrix();\n    vec3 localPos = vertex_position;\n    #ifdef NINESLICED\n        // outer and inner vertices are at the same position, scale both\n        localPos.xz *= outerScale;\n        // offset inner vertices inside\n        // (original vertices must be in [-1;1] range)\n        vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n        vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n        localPos.xz += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n        vTiledUv = (localPos.xz - outerScale + innerOffset.xy) * -0.5 + 1.0; // uv = local pos - inner corner\n        localPos.xz *= -0.5; // move from -1;1 to -0.5;0.5\n        localPos = localPos.xzy;\n    #endif\n    vec4 posW = dModelMatrix * vec4(localPos, 1.0);\n    #ifdef SCREENSPACE\n        posW.zw = vec2(0.0, 1.0);\n    #endif\n    dPositionW = posW.xyz;\n    vec4 screenPos;\n    #ifdef UV1LAYOUT\n        screenPos = vec4(vertex_texCoord1.xy * 2.0 - 1.0, 0.5, 1);\n    #else\n        #ifdef SCREENSPACE\n            screenPos = posW;\n        #else\n            screenPos = matrix_viewProjection * posW;\n        #endif\n        #ifdef PIXELSNAP\n            // snap vertex to a pixel boundary\n            screenPos.xy = (screenPos.xy * 0.5) + 0.5;\n            screenPos.xy *= uScreenSize.xy;\n            screenPos.xy = floor(screenPos.xy);\n            screenPos.xy *= uScreenSize.zw;\n            screenPos.xy = (screenPos.xy * 2.0) - 1.0;\n        #endif\n    #endif\n    return screenPos;\n}\nvec3 getWorldPosition() {\n    return dPositionW;\n}\n",
n.shaderChunks.transformDeclVS="attribute vec3 vertex_position;\nuniform mat4 matrix_model;\nuniform mat4 matrix_viewProjection;\nvec3 dPositionW;\nmat4 dModelMatrix;\n",n.shaderChunks.uv0VS="\nvec2 getUv0() {\n    return vertex_texCoord0;\n}\n",n.shaderChunks.uv1VS="\nvec2 getUv1() {\n    return vertex_texCoord1;\n}\n",n.shaderChunks.uv9SliceVS="#ifndef NINESLICE\n#define NINESLICE\nuniform vec4 innerOffset;\nuniform vec2 outerScale;\nuniform vec4 atlasRect;\nvarying vec2 vTiledUv;\n#endif\nvarying vec2 vMask;\nvec2 getUv0() {\n    vec2 uv = vertex_position.xz;\n    // offset inner vertices inside\n    // (original vertices must be in [-1;1] range)\n    vec2 positiveUnitOffset = clamp(vertex_position.xz, vec2(0.0), vec2(1.0));\n    vec2 negativeUnitOffset = clamp(-vertex_position.xz, vec2(0.0), vec2(1.0));\n    uv += (-positiveUnitOffset * innerOffset.xy + negativeUnitOffset * innerOffset.zw) * vertex_texCoord0.xy;\n    uv = uv * -0.5 + 0.5;\n    uv = uv * atlasRect.zw + atlasRect.xy;\n    vMask = vertex_texCoord0.xy;\n    return uv;\n}\n",n.shaderChunks.viewDirPS="void getViewDir() {\n    dViewDirW = normalize(view_position - vPositionW);\n}\n",n.shaderChunks.viewNormalVS="\n#ifndef VIEWMATRIX\n#define VIEWMATRIX\nuniform mat4 matrix_view;\n#endif\nvec3 getViewNormal() {\n    return mat3(matrix_view) * vNormalW;\n}\n",n.programlib={gammaCode:function(e){return e===n.GAMMA_SRGB||e===n.GAMMA_SRGBFAST?n.shaderChunks.gamma2_2PS:e===n.GAMMA_SRGBHDR?"#define HDR\n"+n.shaderChunks.gamma2_2PS:n.shaderChunks.gamma1_0PS},tonemapCode:function(e){return e===n.TONEMAP_FILMIC?n.shaderChunks.tonemappingFilmicPS:e===n.TONEMAP_LINEAR?n.shaderChunks.tonemappingLinearPS:e===n.TONEMAP_HEJL?n.shaderChunks.tonemappingHejlPS:e===n.TONEMAP_ACES?n.shaderChunks.tonemappingAcesPS:e===n.TONEMAP_ACES2?n.shaderChunks.tonemappingAces2PS:n.shaderChunks.tonemappingNonePS},fogCode:function(e){return"linear"===e?n.shaderChunks.fogLinearPS:"exp"===e?n.shaderChunks.fogExpPS:"exp2"===e?n.shaderChunks.fogExp2PS:n.shaderChunks.fogNonePS},skinCode:function(e,t){return t||(t=n.shaderChunks),e.supportsBoneTextures?t.skinTexVS:"#define BONE_LIMIT "+e.getBoneLimit()+"\n"+t.skinConstVS},precisionCode:function(e){var t="precision "+e.precision+" float;\n";return e.webgl2&&(t+="#ifdef GL2\nprecision "+e.precision+" sampler2DShadow;\n#endif\n"),t},versionCode:function(e){return e.webgl2?"#version 300 es\n":""},dummyFragmentCode:function(){return"void main(void) {gl_FragColor = vec4(0.0);}"},begin:function(){return"void main(void)\n{\n"},end:function(){return"}\n"}},n.programlib.basic={generateKey:function(e,t){var i="basic";return t.fog&&(i+="_fog"),t.alphaTest&&(i+="_atst"),t.vertexColors&&(i+="_vcol"),t.diffuseMap&&(i+="_diff"),i+="_"+t.pass},createShaderDefinition:function(e,t){var i={vertex_position:n.SEMANTIC_POSITION};t.skin&&(i.vertex_boneWeights=n.SEMANTIC_BLENDWEIGHT,i.vertex_boneIndices=n.SEMANTIC_BLENDINDICES),t.vertexColors&&(i.vertex_color=n.SEMANTIC_COLOR),t.diffuseMap&&(i.vertex_texCoord0=n.SEMANTIC_TEXCOORD0);var r=n.shaderChunks,s="";s+=r.transformDeclVS,t.skin?(s+=n.programlib.skinCode(e),s+=r.transformSkinnedVS):s+=r.transformVS,t.vertexColors&&(s+="attribute vec4 vertex_color;\n",s+="varying vec4 vColor;\n"),t.diffuseMap&&(s+="attribute vec2 vertex_texCoord0;\n",s+="varying vec2 vUv0;\n"),t.pass===n.SHADER_DEPTH&&(s+="varying float vDepth;\n",s+="#ifndef VIEWMATRIX\n",s+="#define VIEWMATRIX\n",s+="uniform mat4 matrix_view;\n",s+="#endif\n",s+="#ifndef CAMERAPLANES\n",s+="#define CAMERAPLANES\n",s+="uniform vec4 camera_params;\n\n",s+="#endif\n"),s+=n.programlib.begin(),s+="   gl_Position = getPosition();\n",t.pass===n.SHADER_DEPTH&&(s+="    vDepth = -(matrix_view * vec4(getWorldPosition(),1.0)).z * camera_params.x;\n"),t.vertexColors&&(s+="    vColor = vertex_color;\n"),t.diffuseMap&&(s+="    vUv0 = vertex_texCoord0;\n"),s+=n.programlib.end();var a=s;s=n.programlib.precisionCode(e),s+=t.vertexColors?"varying vec4 vColor;\n":"uniform vec4 uColor;\n",t.diffuseMap&&(s+="varying vec2 vUv0;\n",s+="uniform sampler2D texture_diffuseMap;\n"),t.fog&&(s+=n.programlib.fogCode(t.fog)),t.alphatest&&(s+=r.alphaTestPS),t.pass===n.SHADER_DEPTH&&(s+="varying float vDepth;\n",s+=r.packDepthPS),s+=n.programlib.begin(),s+=t.vertexColors?"    gl_FragColor = vColor;\n":"    gl_FragColor = uColor;\n",t.diffuseMap&&(s+="    gl_FragColor *= texture2D(texture_diffuseMap, vUv0);\n"),t.alphatest&&(s+="   alphaTest(gl_FragColor.a);\n"),t.pass===n.SHADER_PICK||(t.pass===n.SHADER_DEPTH?s+="    gl_FragColor = packFloat(vDepth);\n":t.fog&&(s+="   glFragColor.rgb = addFog(gl_FragColor.rgb);\n")),s+=n.programlib.end();var o=s;return{attributes:i,vshader:a,fshader:o}}},n.programlib.particle={generateKey:function(e,t){var i="particle";for(var n in t)t.hasOwnProperty(n)&&(i+=t[n]);return i},_animTex:function(e,t){var i="";return i+=e.animTexLoop?t.particleAnimFrameLoopVS:t.particleAnimFrameClampVS,i+=t.particleAnimTexVS},createShaderDefinition:function(e,t){var i=n.shaderChunks,r="",s=n.programlib.precisionCode(e)+"\n";e.webgl2&&(r+="#define GL2\n",s+="#define GL2\n"),r+="#define VERTEXSHADER\n",t.animTex&&(r+="\nuniform vec4 animTexParams;\n"),2==t.normal&&(r+="\nvarying mat3 ParticleMat;\n"),1==t.normal&&(r+="\nvarying vec3 Normal;\n"),t.soft&&(r+="\nvarying float vDepth;\n"),t.useCpu?(t.soft>0&&(r+=i.screenDepthPS),r+=i.particle_cpuVS,t.localSpace&&(r+=i.particle_localShiftVS),t.animTex&&(r+=this._animTex(t,i)),t.alignToMotion&&(r+=i.particle_pointAlongVS),r+=t.mesh?i.particle_meshVS:i.particle_billboardVS,1==t.normal&&(r+=i.particle_normalVS),2==t.normal&&(r+=i.particle_TBNVS),t.stretch>0&&(r+=i.particle_stretchVS),r+=i.particle_cpu_endVS,t.soft>0&&(r+=i.particle_softVS)):(r+=i.particle_initVS,r+=t.pack8?i.particleInputRgba8PS:i.particleInputFloatPS,t.soft>0&&(r+=i.screenDepthPS),r+=i.particleVS,t.localSpace&&(r+=i.particle_localShiftVS),t.animTex&&(r+=this._animTex(t,i)),t.wrap&&(r+=i.particle_wrapVS),t.alignToMotion&&(r+=i.particle_pointAlongVS),r+=t.mesh?i.particle_meshVS:i.particle_billboardVS,1==t.normal&&(r+=i.particle_normalVS),2==t.normal&&(r+=i.particle_TBNVS),t.stretch>0&&(r+=i.particle_stretchVS),r+=i.particle_endVS,t.soft>0&&(r+=i.particle_softVS)),r+="}\n",t.normal>0&&(1==t.normal?s+="\nvarying vec3 Normal;\n":2==t.normal&&(s+="\nvarying mat3 ParticleMat;\n"),s+="\nuniform vec3 lightCube[6];\n"),t.soft&&(s+="\nvarying float vDepth;\n"),0===t.normal&&"none"===t.fog&&(t.srgb=!1),s+=n.programlib.gammaCode(t.gamma),s+=n.programlib.tonemapCode(t.toneMap),s+="linear"===t.fog?i.fogLinearPS:"exp"===t.fog?i.fogExpPS:"exp2"===t.fog?i.fogExp2PS:i.fogNonePS,2==t.normal&&(s+="\nuniform sampler2D normalMap;\n"),t.soft>0&&(s+=i.screenDepthPS),s+=i.particlePS,t.soft>0&&(s+=i.particle_softPS),1==t.normal&&(s+="\nvec3 normal = Normal;\n"),2==t.normal&&(s+=i.particle_normalMapPS),t.normal>0&&(s+=t.halflambert?i.particle_halflambertPS:i.particle_lambertPS),t.normal>0&&(s+=i.particle_lightingPS),t.blend==n.BLEND_NORMAL?s+=i.particle_blendNormalPS:t.blend==n.BLEND_ADDITIVE?s+=i.particle_blendAddPS:t.blend==n.BLEND_MULTIPLICATIVE&&(s+=i.particle_blendMultiplyPS),s+=i.particle_endPS;var a=n.shaderChunks.collectAttribs(r);return{attributes:a,vshader:r,fshader:s}}};var a=function(e,t){},o=function(e,t,i){return a(i,t),"\n#ifdef MAPFLOAT\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},h=function(e,t,i){return a(i,t),"\n#ifdef MAPCOLOR\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},l=function(e,t,i){return a(i,t),"\n#ifdef MAPTEXTURE\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},c=function(e,t,i){return a(i,t),"#undef MAPTEXTURECOLOR\n#ifdef MAPTEXTURE\n#ifdef MAPCOLOR\n#define MAPTEXTURECOLOR\n#endif\n#endif\n#ifdef MAPTEXTURECOLOR\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},d=function(e,t,i){return a(i,t),"#undef MAPTEXTUREFLOAT\n#ifdef MAPTEXTURE\n#ifdef MAPFLOAT\n#define MAPTEXTUREFLOAT\n#endif\n#endif\n#ifdef MAPTEXTUREFLOAT\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},u=function(e,t,i){return a(i,t),"\n#ifdef MAPVERTEX\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},f=function(e,t,i){return a(i,t),"#undef MAPVERTEXCOLOR\n#ifdef MAPVERTEX\n#ifdef MAPCOLOR\n#define MAPVERTEXCOLOR\n#endif\n#endif\n#ifdef MAPVERTEXCOLOR\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},p=function(e,t,i){return a(i,t),"#undef MAPVERTEXFLOAT\n#ifdef MAPVERTEX\n#ifdef MAPFLOAT\n#define MAPVERTEXFLOAT\n#endif\n#endif\n#ifdef MAPVERTEXFLOAT\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},_=function(e,t,i){return a(i,t),"\n#ifdef SKIN\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},m=function(e,t,i){return a(i,t),"\n#ifdef DYNAMICBATCH\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},A=function(e,t,i){return a(i,t),"\n#ifdef INSTANCING\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},v=function(e,t,i){return a(i,t),"\n#ifdef PIXELSNAP\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},y=function(e,t,i){return a(i,t),"\n#ifdef SCREENSPACE\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},g=function(e,t,i){return a(i,t),"#undef SCREENSPACEBATCH\n#ifdef SCREENSPACE\n#ifdef BATCH\n#define SCREENSPACEBATCH\n#endif\n#endif\n#ifdef SCREENSPACEBATCH\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"},b=function(e,t,i){return a(i,t),"\n#ifdef UV1LAYOUT\n"+e+"\n#else\n"+n.shaderChunks[t]+"\n#endif\n"};n.programlib.standard={_oldChunkToNew:{aoTexPS:{n:"aoPS",f:l},aoVertPS:{n:"aoPS",f:u},diffuseConstPS:{n:"diffusePS",f:h},diffuseTexPS:{n:"diffusePS",f:l},diffuseTexConstPS:{n:"diffusePS",f:c},diffuseVertPS:{n:"diffusePS",f:u},diffuseVertConstPS:{n:"diffusePS",f:f},emissiveConstPS:{n:"emissivePS",f:h},emissiveTexPS:{n:"emissivePS",f:l},emissiveTexConstPS:{n:"emissivePS",f:c},emissiveTexConstFloatPS:{n:"emissivePS",f:d},emissiveVertPS:{n:"emissivePS",f:u},emissiveVertConstPS:{n:"emissivePS",f:f},emissiveVertConstFloatPS:{n:"emissivePS",f:p},glossConstPS:{n:"glossPS",f:o},glossTexPS:{n:"glossPS",f:l},glossTexConstPS:{n:"glossPS",f:d},glossVertPS:{n:"glossPS",f:u},glossVertConstPS:{n:"glossPS",f:p},metalnessConstPS:{n:"metalnessPS",f:o},metalnessTexPS:{n:"metalnessPS",f:l},metalnessTexConstPS:{n:"metalnessPS",f:d},metalnessVertPS:{n:"metalnessPS",f:u},metalnessVertConstPS:{n:"metalnessPS",f:p},opacityConstPS:{n:"opacityPS",f:o},opacityTexPS:{n:"opacityPS",f:l},opacityTexConstPS:{n:"opacityPS",f:d},opacityVertPS:{n:"opacityPS",f:u},opacityVertConstPS:{n:"opacityPS",f:p},specularConstPS:{n:"specularPS",f:h},specularTexPS:{n:"specularPS",f:l},specularTexConstPS:{n:"specularPS",f:c},specularVertPS:{n:"specularPS",f:u},specularVertConstPS:{n:"specularPS",f:f},transformBatchSkinnedVS:{n:"transformVS",f:m},transformInstancedVS:{n:"transformVS",f:A},transformPixelSnapVS:{n:"transformVS",f:v},transformScreenSpaceVS:{n:"transformVS",f:y},transformScreenSpaceBatchSkinned:{n:"transformVS",f:g},transformSkinned:{n:"transformVS",f:_},transformUv1:{n:"transformVS",f:b}},generateKey:function(e,t){var i,r,s=[],a="standard";for(i in t)if(t.hasOwnProperty(i))if("chunks"===i)for(var o in t[i])t[i].hasOwnProperty(o)&&s.push(o+t.chunks[o]);else t[i]&&s.push(i);s.sort();for(i in s)s.hasOwnProperty(i)&&(a+=s[i]+t[s[i]]);if(t.lights)for(var h=0;h<t.lights.length;h++)r=t.lights[h],a+=r.key;return n.hashCode(a)},_correctChannel:function(e,t){if(n._matTex2D[e]>0){if(n._matTex2D[e]<t.length)return t.substring(0,n._matTex2D[e]);if(n._matTex2D[e]>t.length){for(var i=t,r=i.charAt(i.length-1),s=n._matTex2D[e]-i.length,a=0;a<s;a++)i+=r;return i}return t}},_setMapTransform:function(e,t,i,n){e[0]+="uniform vec4 texture_"+t+"MapTransform;\n";var r=i+100*n;return e[3][r]||(e[1]+="varying vec2 vUV"+n+"_"+i+";\n",e[2]+="   vUV"+n+"_"+i+" = uv"+n+" * texture_"+t+"MapTransform.xy + texture_"+t+"MapTransform.zw;\n",e[3][r]=!0),e},_uvSource:function(e,t){return 0===e?"vUv"+t:"vUV"+t+"_"+e},_addMapDef:function(e,t){var i="\n#undef "+e+"\n";return t&&(i+=" #define "+e+"\n"),i},_addMapDefs:function(e,t,i,n){var r="";return r+=this._addMapDef("MAPFLOAT",e),r+=this._addMapDef("MAPCOLOR",t),r+=this._addMapDef("MAPVERTEX",i),r+=this._addMapDef("MAPTEXTURE",n)},_addMap:function(e,t,i,n,r,s){var a=e+"Map",o=t[e+"Tint"],h=t[e+"VertexColor"],l=t[a];if(r||(r=i[e+"PS"]),l){var c=a+"Uv",d=a+"Transform",u=a+"Channel",f=this._uvSource(t[d],t[c])+n;if(r=r.replace(/\$UV/g,f).replace(/\$CH/g,t[u]),void 0!==s){var p=0===s?"texture2DSRGB":1===s?"texture2DRGBM":"texture2D";r=r.replace(/\$texture2DSAMPLE/g,p)}}if(h){var _=e+"VertexColorChannel";r=r.replace(/\$VC/g,t[_])}return r=this._addMapDefs(1===o,3===o,h,l)+r,r.replace(/\$/g,"")},_nonPointShadowMapProjection:function(e,t,i){return!t._normalOffsetBias||t._isVsm?t._type===n.LIGHTTYPE_SPOT?t._isPcf&&(e.webgl2||e.extStandardDerivatives)?"       getShadowCoordPerspZbuffer"+i:"       getShadowCoordPersp"+i:"       getShadowCoordOrtho"+i:t._type===n.LIGHTTYPE_SPOT?t._isPcf&&(e.webgl2||e.extStandardDerivatives)?"       getShadowCoordPerspZbufferNormalOffset"+i:"       getShadowCoordPerspNormalOffset"+i:"       getShadowCoordOrthoNormalOffset"+i},_addVaryingIfNeeded:function(e,t,i){return e.indexOf(i)>=0?"varying "+t+" "+i+";\n":""},createShaderDefinition:function(e,t){var i,r,s=t.lights.length>0;t.dirLightMap&&(s=!0,t.useSpecular=!0),t.shadingModel===n.SPECULAR_PHONG?(t.fresnelModel=0,t.specularAntialias=!1,t.prefilteredCubemap=!1,t.dpAtlas=!1,t.ambientSH=!1):t.fresnelModel=0===t.fresnelModel?n.FRESNEL_SCHLICK:t.fresnelModel;var a=(t.cubeMap||t.prefilteredCubemap&&t.useSpecular)&&!t.sphereMap&&!t.dpAtlas,o=t.sphereMap||a||t.dpAtlas,h=n.precalculatedTangents,l=t.useTexCubeLod;t.cubeMap&&(t.sphereMap=null),t.dpAtlas&&(t.prefilteredCubemap=null),t.useSpecular||(t.specularMap=t.glossMap=null);var c=s||o||t.ambientSH||t.prefilteredCubemap||t.heightMap,d=t.pass>=n.SHADER_SHADOW&&t.pass<=17;this.options=t;var u,f,p,_="",m="",A="",v=n.shaderChunks,y={vertex_position:n.SEMANTIC_POSITION};if(t.chunks){var g,b={};for(r in v)v.hasOwnProperty(r)&&(t.chunks[r]?(p=t.chunks[r],p.indexOf("vertex_normal")>=0&&(y.vertex_normal=n.SEMANTIC_NORMAL),p.indexOf("vertex_tangent")>=0&&(y.vertex_tangent=n.SEMANTIC_TANGENT),p.indexOf("vertex_texCoord0")>=0&&(y.vertex_texCoord0=n.SEMANTIC_TEXCOORD0),p.indexOf("vertex_texCoord1")>=0&&(y.vertex_texCoord1=n.SEMANTIC_TEXCOORD1),p.indexOf("vertex_color")>=0&&(y.vertex_color=n.SEMANTIC_COLOR),p.indexOf("vertex_boneWeights")>=0&&(y.vertex_boneWeights=n.SEMANTIC_BLENDWEIGHT),p.indexOf("vertex_boneIndices")>=0&&(y.vertex_boneIndices=n.SEMANTIC_BLENDINDICES),b[r]=p):b[r]=v[r]);for(r in t.chunks)g=this._oldChunkToNew[r],g&&(b[g.n]=g.f(t.chunks[r],g.n,r));v=b}_+=v.baseVS;var E=-1;if(!t.noShadow&&!t.twoSidedLighting){for(i=0;i<t.lights.length;i++)if(u=t.lights[i]._type,t.lights[i].castShadows&&u===n.LIGHTTYPE_DIRECTIONAL){_+="uniform mat4 light"+i+"_shadowMatrixVS;\n",_+="uniform vec3 light"+i+"_shadowParamsVS;\n",_+="uniform vec3 light"+i+(u===n.LIGHTTYPE_DIRECTIONAL?"_directionVS":"_positionVS")+";\n",E=i;break}E>=0&&(_+=v.shadowCoordVS)}m+="   vPositionW    = getWorldPosition();\n",t.pass===n.SHADER_DEPTH&&(_+="varying float vDepth;\n",_+="#ifndef VIEWMATRIX\n",_+="#define VIEWMATRIX\n",_+="uniform mat4 matrix_view;\n",_+="#endif\n",_+="#ifndef CAMERAPLANES\n",_+="#define CAMERAPLANES\n",_+="uniform vec4 camera_params;\n\n",_+="#endif\n",m+="    vDepth = -(matrix_view * vec4(vPositionW,1.0)).z * camera_params.x;\n"),t.useInstancing&&(y.instance_line1=n.SEMANTIC_TEXCOORD2,y.instance_line2=n.SEMANTIC_TEXCOORD3,y.instance_line3=n.SEMANTIC_TEXCOORD4,y.instance_line4=n.SEMANTIC_TEXCOORD5,_+=v.instancingVS),c&&(y.vertex_normal=n.SEMANTIC_NORMAL,m+="   vNormalW    = dNormalW = getNormal();\n",t.sphereMap&&e.fragmentUniformsCount<=16&&(_+=v.viewNormalVS,m+="   vNormalV    = getViewNormal();\n"),(t.heightMap||t.normalMap)&&h&&(y.vertex_tangent=n.SEMANTIC_TANGENT,_+=v.tangentBinormalVS,m+="   vTangentW   = getTangent();\n",m+="   vBinormalW  = getBinormal();\n"),E>=0&&(u=t.lights[E]._type,m+=u===n.LIGHTTYPE_DIRECTIONAL?"   dLightDirNormW = light"+E+"_directionVS;\n":"   getLightDirPoint(light"+E+"_positionVS);\n",f="(light"+E+"_shadowMatrixVS, light"+E+"_shadowParamsVS);\n",m+=this._nonPointShadowMapProjection(e,t.lights[E],f)));var T,S,w,C,M=[],P=[],I=2;for(r in n._matTex2D)if(S=r+"Map",t[r+"VertexColor"]&&(T=r+"VertexColorChannel",t[T]=this._correctChannel(r,t[T])),t[S]){T=S+"Channel",w=S+"Transform",C=S+"Uv",t[C]=Math.min(t[C],I-1),t[T]=this._correctChannel(r,t[T]);var R=t[C];M[R]=!0,P[R]=P[R]||t[S]&&!t[w]}for(t.forceUv1&&(M[1]=!0),i=0;i<I;i++)M[i]&&(y["vertex_texCoord"+i]=n["SEMANTIC_TEXCOORD"+i],_+=v["uv"+i+"VS"],m+="   vec2 uv"+i+" = getUv"+i+"();\n"),P[i]&&(m+="   vUv"+i+" = uv"+i+";\n");var x=[_,A,m,[]];for(r in n._matTex2D)S=r+"Map",t[S]&&(w=S+"Transform",t[w]&&(C=S+"Uv",this._setMapTransform(x,r,t[w],t[C])));_=x[0],A=x[1],m=x[2],t.vertexColors&&(y.vertex_color=n.SEMANTIC_COLOR,m+="   vVertexColor = vertex_color;\n"),t.skin?(y.vertex_boneWeights=n.SEMANTIC_BLENDWEIGHT,y.vertex_boneIndices=n.SEMANTIC_BLENDINDICES,_+=n.programlib.skinCode(e,v),_+="#define SKIN\n"):t.useInstancing&&(_+="#define INSTANCING\n"),t.screenSpace&&(_+="#define SCREENSPACE\n"),t.pixelSnap&&(_+="#define PIXELSNAP\n"),_+=v.transformVS,c&&(_+=v.normalVS),_+="\n",_+=v.startVS,_+=m,_+="}";var O=_,k=A;A="",A+=this._addVaryingIfNeeded(_,"vec4","vMainShadowUv"),A+=this._addVaryingIfNeeded(_,"vec4","vVertexColor"),A+=this._addVaryingIfNeeded(_,"vec3","vPositionW"),A+=this._addVaryingIfNeeded(_,"vec3","vNormalV"),A+=this._addVaryingIfNeeded(_,"vec3","vNormalW"),A+=this._addVaryingIfNeeded(_,"vec3","vTangentW"),A+=this._addVaryingIfNeeded(_,"vec3","vBinormalW"),A+=this._addVaryingIfNeeded(_,"vec2","vUv0"),A+=this._addVaryingIfNeeded(_,"vec2","vUv1"),A+=k,O=A+O;var D="";e.webgl2?(D=n.programlib.versionCode(e),v.extensionVS&&(D+=v.extensionVS+"\n"),O=D+v.gles3VS+O):(v.extensionVS&&(D=v.extensionVS+"\n"),O=D+O),t.forceFragmentPrecision&&"highp"!=t.forceFragmentPrecision&&"mediump"!==t.forceFragmentPrecision&&"lowp"!==t.forceFragmentPrecision&&(t.forceFragmentPrecision=null),t.forceFragmentPrecision&&("highp"===t.forceFragmentPrecision&&"highp"!==e.maxPrecision&&(t.forceFragmentPrecision="mediump"),"mediump"===t.forceFragmentPrecision&&"lowp"===e.maxPrecision&&(t.forceFragmentPrecision="lowp"));var L;if(_="",e.webgl2&&(_+=n.programlib.versionCode(e)),e.extStandardDerivatives&&!e.webgl2&&(_+="#extension GL_OES_standard_derivatives : enable\n\n"),v.extensionPS&&(_+=v.extensionPS+"\n"),e.webgl2&&(_+=v.gles3PS),_+=t.forceFragmentPrecision?"precision "+t.forceFragmentPrecision+" float;\n\n":n.programlib.precisionCode(e),t.pass===n.SHADER_PICK)return _+="uniform vec4 uColor;",_+=A,t.alphaTest&&(_+="float dAlpha;\n",_+=this._addMap("opacity",t,v,""),_+=v.alphaTestPS),_+=n.programlib.begin(),t.alphaTest&&(_+="   getOpacity();\n",_+="   alphaTest(dAlpha);\n"),_+="    gl_FragColor = uColor;\n",_+=n.programlib.end(),{attributes:y,vshader:O,fshader:_};if(t.pass===n.SHADER_DEPTH)return _+="varying float vDepth;\n",_+=A,_+=v.packDepthPS,t.alphaTest&&(_+="float dAlpha;\n",_+=this._addMap("opacity",t,v,""),_+=v.alphaTestPS),_+=n.programlib.begin(),t.alphaTest&&(_+="   getOpacity();\n",_+="   alphaTest(dAlpha);\n"),_+="    gl_FragColor = packFloat(vDepth);\n",_+=n.programlib.end(),{attributes:y,vshader:O,fshader:_};if(d){var N=t.pass-n.SHADER_SHADOW,F=5;u=Math.floor(N/F);var B=N-u*F;e.extStandardDerivatives&&!e.webgl2&&(_+="uniform vec2 polygonOffset;\n"),B===n.SHADOW_VSM32?_+=e.extTextureFloatHighPrecision?"#define VSM_EXPONENT 15.0\n\n":"#define VSM_EXPONENT 5.54\n\n":B===n.SHADOW_VSM16&&(_+="#define VSM_EXPONENT 5.54\n\n"),u!==n.LIGHTTYPE_DIRECTIONAL&&(_+="uniform vec3 view_position;\n",_+="uniform float light_radius;\n"),_+=A,t.alphaTest&&(_+="float dAlpha;\n",_+=this._addMap("opacity",t,v,""),_+=v.alphaTestPS),B!==n.SHADOW_PCF3||e.webgl2&&u!==n.LIGHTTYPE_POINT?B===n.SHADOW_VSM8&&(_+="vec2 encodeFloatRG( float v ) {\n",_+="    vec2 enc = vec2(1.0, 255.0) * v;\n",_+="    enc = fract(enc);\n",_+="    enc -= enc.yy * vec2(1.0/255.0, 1.0/255.0);\n",_+="    return enc;\n",_+="}\n\n"):_+=v.packDepthPS,_+=n.programlib.begin(),t.alphaTest&&(_+="   getOpacity();\n",_+="   alphaTest(dAlpha);\n");var V=B===n.SHADOW_VSM8||B===n.SHADOW_VSM16||B===n.SHADOW_VSM32;return _+=u===n.LIGHTTYPE_POINT||V&&u!==n.LIGHTTYPE_DIRECTIONAL?"   float depth = min(distance(view_position, vPositionW) / light_radius, 0.99999);\n":"   float depth = gl_FragCoord.z;\n",B!==n.SHADOW_PCF3||e.webgl2&&u!==n.LIGHTTYPE_POINT?_+=B===n.SHADOW_PCF3||B===n.SHADOW_PCF5?"   gl_FragColor = vec4(1.0);\n":B===n.SHADOW_VSM8?"   gl_FragColor = vec4(encodeFloatRG(depth), encodeFloatRG(depth*depth));\n":v.storeEVSMPS:e.extStandardDerivatives&&!e.webgl2?(_+="   float minValue = 2.3374370500153186e-10; //(1.0 / 255.0) / (256.0 * 256.0 * 256.0);\n",_+="   depth += polygonOffset.x * max(abs(dFdx(depth)), abs(dFdy(depth))) + minValue * polygonOffset.y;\n",_+="   gl_FragColor = packFloat(depth);\n"):_+="   gl_FragColor = packFloat(depth);\n",_+=n.programlib.end(),{attributes:y,vshader:O,fshader:_}}if(t.customFragmentShader)return L=_+t.customFragmentShader,{attributes:y,vshader:O,fshader:L,tag:n.SHADERTAG_MATERIAL};_+=A,_+=v.basePS;var U=_;_="";var G,W=0,z=[],H=!1,j=!1;for(i=0;i<t.lights.length;i++)G=t.lights[i],u=G._type,_+="uniform vec3 light"+i+"_color;\n",u===n.LIGHTTYPE_DIRECTIONAL?_+="uniform vec3 light"+i+"_direction;\n":(_+="uniform vec3 light"+i+"_position;\n",_+="uniform float light"+i+"_radius;\n",u===n.LIGHTTYPE_SPOT&&(_+="uniform vec3 light"+i+"_direction;\n",_+="uniform float light"+i+"_innerConeAngle;\n",_+="uniform float light"+i+"_outerConeAngle;\n")),G.castShadows&&!t.noShadow&&(_+="uniform mat4 light"+i+"_shadowMatrix;\n",_+=u!==n.LIGHTTYPE_DIRECTIONAL?"uniform vec4 light"+i+"_shadowParams;\n":"uniform vec3 light"+i+"_shadowParams;\n",_+=u===n.LIGHTTYPE_POINT?"uniform samplerCube light"+i+"_shadowMap;\n":G._isPcf&&e.webgl2?"uniform sampler2DShadow light"+i+"_shadowMap;\n":"uniform sampler2D light"+i+"_shadowMap;\n",W++,z[G._shadowType]=!0,G._isVsm&&(H=!0),G._isPcf&&(e.webgl2||e.extStandardDerivatives)&&u===n.LIGHTTYPE_SPOT&&(j=!0)),G._cookie&&(G._cookie._cubemap?u===n.LIGHTTYPE_POINT&&(_+="uniform samplerCube light"+i+"_cookie;\n",_+="uniform float light"+i+"_cookieIntensity;\n",G.castShadows&&!t.noShadow||(_+="uniform mat4 light"+i+"_shadowMatrix;\n")):u===n.LIGHTTYPE_SPOT&&(_+="uniform sampler2D light"+i+"_cookie;\n",_+="uniform float light"+i+"_cookieIntensity;\n",G.castShadows&&!t.noShadow||(_+="uniform mat4 light"+i+"_shadowMatrix;\n"),G._cookieTransform&&(_+="uniform vec4 light"+i+"_cookieMatrix;\n",_+="uniform vec2 light"+i+"_cookieOffset;\n")));_+="\n";var Y=t.heightMap?" + dUvOffset":"",X=t.fastTbn?v.TBNfastPS:v.TBNPS;if(c)if(t.normalMap&&h){_+=t.packedNormal?v.normalXYPS:v.normalXYZPS;var Z=this._uvSource(t.normalMapTransform,t.normalMapUv)+Y;_+=t.needsNormalFloat?(t.fastTbn?v.normalMapFloatTBNfastPS:v.normalMapFloatPS).replace(/\$UV/g,Z):v.normalMapPS.replace(/\$UV/g,Z),_+=X}else _+=v.normalVertexPS;_+=n.programlib.gammaCode(t.gamma),_+=n.programlib.tonemapCode(t.toneMap),_+=n.programlib.fogCode(t.fog),t.useRgbm&&(_+=v.rgbmPS),(a||t.prefilteredCubemap)&&(_+=t.fixSeams?v.fixCubemapSeamsStretchPS:v.fixCubemapSeamsNonePS),c&&(_+=t.cubeMapProjection>0?v.cubeMapProjectBoxPS:v.cubeMapProjectNonePS,_+=t.skyboxIntensity?v.envMultiplyPS:v.envConstPS),_+=this._addMap("diffuse",t,v,Y),(t.blendType!==n.BLEND_NONE||t.alphaTest||t.alphaToCoverage)&&(_+=this._addMap("opacity",t,v,Y)),_+=this._addMap("emissive",t,v,Y,null,t.emissiveFormat),t.useSpecular&&(s||o)&&(_+=t.specularAntialias&&t.normalMap?t.needsNormalFloat&&c?v.specularAaToksvigFloatPS:v.specularAaToksvigPS:v.specularAaNonePS,_+=this._addMap(t.useMetalness?"metalness":"specular",t,v,Y),_+=this._addMap("gloss",t,v,Y),t.fresnelModel>0&&(t.fresnelModel===n.FRESNEL_SIMPLE?_+=v.fresnelSimplePS:t.fresnelModel===n.FRESNEL_SCHLICK?_+=v.fresnelSchlickPS:t.fresnelModel===n.FRESNEL_COMPLEX&&(_+=v.fresnelComplexPS))),t.heightMap&&(t.normalMap||(_+=X),_+=this._addMap("height",t,v,"",v.parallaxPS));var K=t.aoMap||t.aoVertexColor;K&&(_+=this._addMap("ao",t,v,Y,t.aoVertexColor?v.aoVertPS:v.aoTexPS),t.occludeSpecular&&(_+=t.occludeSpecular===n.SPECOCC_AO?t.occludeSpecularFloat?v.aoSpecOccSimplePS:v.aoSpecOccConstSimplePS:t.occludeSpecularFloat?v.aoSpecOccPS:v.aoSpecOccConstPS));var Q=t.rgbmReflection?"decodeRGBM":t.hdrReflection?"":"gammaCorrectInput";if(t.sphereMap){var J=e.fragmentUniformsCount>16?v.reflectionSpherePS:v.reflectionSphereLowPS;J=J.replace(/\$texture2DSAMPLE/g,t.rgbmReflection?"texture2DRGBM":t.hdrReflection?"texture2D":"texture2DSRGB"),_+=J}else a?_+=t.prefilteredCubemap?l?v.reflectionPrefilteredCubeLodPS.replace(/\$DECODE/g,Q):v.reflectionPrefilteredCubePS.replace(/\$DECODE/g,Q):v.reflectionCubePS.replace(/\$textureCubeSAMPLE/g,t.rgbmReflection?"textureCubeRGBM":t.hdrReflection?"textureCube":"textureCubeSRGB"):t.dpAtlas&&(_+=v.reflectionDpAtlasPS.replace(/\$texture2DSAMPLE/g,t.rgbmReflection?"texture2DRGBM":t.hdrReflection?"texture2D":"texture2DSRGB"));(a||t.sphereMap||t.dpAtlas)&&t.refraction&&(_+=v.refractionPS),W>0&&(z[n.SHADOW_PCF3]&&(_+=v.shadowStandardPS),z[n.SHADOW_PCF5]&&(_+=v.shadowStandardGL2PS),H&&(_+=v.shadowVSM_commonPS,z[n.SHADOW_VSM8]&&(_+=v.shadowVSM8PS),z[n.SHADOW_VSM16]&&(_+=e.extTextureHalfFloatLinear?v.shadowEVSMPS.replace(/\$/g,"16"):v.shadowEVSMnPS.replace(/\$/g,"16")),z[n.SHADOW_VSM32]&&(_+=e.extTextureFloatLinear?v.shadowEVSMPS.replace(/\$/g,"32"):v.shadowEVSMnPS.replace(/\$/g,"32"))),e.webgl2||e.extStandardDerivatives||(_+=v.biasConstPS),_+=v.shadowCoordPS+v.shadowCommonPS,j&&(_+=v.shadowCoordPerspZbufferPS),E>=0&&(z[n.SHADOW_PCF3]&&(_+=v.shadowStandardVSPS),z[n.SHADOW_PCF5]&&(_+=v.shadowStandardGL2VSPS),H&&(z[n.SHADOW_VSM8]&&(_+=v.shadowVSMVSPS.replace(/\$VSM/g,"VSM8").replace(/\$/g,"8")),z[n.SHADOW_VSM16]&&(_+=v.shadowVSMVSPS.replace(/\$VSM/g,"VSM16").replace(/\$/g,"16")),z[n.SHADOW_VSM32]&&(_+=v.shadowVSMVSPS.replace(/\$VSM/g,"VSM32").replace(/\$/g,"32"))))),s&&(_+=v.lightDiffuseLambertPS);var q=!1;t.useSpecular?(s&&(_+=t.shadingModel===n.SPECULAR_PHONG?v.lightSpecularPhongPS:v.lightSpecularBlinnPS),t.sphereMap||a||t.dpAtlas||t.fresnelModel>0?_+=t.fresnelModel>0?t.conserveEnergy?v.combineDiffuseSpecularPS:v.combineDiffuseSpecularNoConservePS:v.combineDiffuseSpecularOldPS:t.diffuseMap?_+=v.combineDiffuseSpecularNoReflPS:(_+=v.combineDiffuseSpecularNoReflSeparateAmbientPS,q=!0)):_+=v.combineDiffusePS;var $=!0;if((t.lightMap||t.lightVertexColor)&&(_+=this._addMap("light",t,v,Y,t.dirLightMap?v.lightmapDirPS:v.lightmapSinglePS,t.lightMapFormat),$=t.lightMapWithoutAmbient),$){var ee=t.rgbmAmbient?"decodeRGBM":t.hdrAmbient?"":"gammaCorrectInput";_+=t.ambientSH?v.ambientSHPS:t.prefilteredCubemap?l?v.ambientPrefilteredCubeLodPS.replace(/\$DECODE/g,ee):v.ambientPrefilteredCubePS.replace(/\$DECODE/g,ee):v.ambientConstantPS}t.ambientTint&&!q&&(_+="uniform vec3 material_ambient;\n"),t.alphaTest&&(_+=v.alphaTestPS),t.msdf&&(_+=v.msdfPS),c&&(_+=v.viewDirPS,t.useSpecular&&(_+=v.reflDirPS));var te,ie=!1,ne=!1,re=!1,se=!1,ae=!1;_+=v.startPS,c&&(_+=t.twoSidedLighting?"   dVertexNormalW = gl_FrontFacing ? vNormalW : -vNormalW;\n":"   dVertexNormalW = vNormalW;\n",(t.heightMap||t.normalMap)&&(t.twoSidedLighting?(_+="   dTangentW = gl_FrontFacing ? vTangentW : -vTangentW;\n",_+="   dBinormalW = gl_FrontFacing ? vBinormalW : -vBinormalW;\n"):(_+="   dTangentW = vTangentW;\n",_+="   dBinormalW = vBinormalW;\n")));var oe=!1;if(t.blendType!==n.BLEND_NONE||t.alphaTest||t.alphaToCoverage?t.heightMap&&t.opacityMap?oe=!0:(_+="   getOpacity();\n",t.alphaTest&&(_+="   alphaTest(dAlpha);\n")):_+="   dAlpha = 1.0;\n",c&&(_+="   getViewDir();\n",(t.heightMap||t.normalMap)&&(_+="   getTBN();\n"),t.heightMap&&(_+="   getParallax();\n"),oe&&(_+="   getOpacity();\n",t.alphaTest&&(_+="   alphaTest(dAlpha);\n")),_+="   getNormal();\n",t.useSpecular&&(_+="   getReflDir();\n")),_+="   getAlbedo();\n",(s&&t.useSpecular||o)&&(_+="   getSpecularity();\n",_+="   getGlossiness();\n",t.fresnelModel>0&&(_+="   getFresnel();\n")),$&&(_+="   addAmbient();\n"),t.ambientTint&&!q&&(_+="   dDiffuseLight *= material_ambient;\n"),K&&!t.occludeDirect&&(_+="    applyAO();\n"),(t.lightMap||t.lightVertexColor)&&(_+="   addLightMap();\n"),s||o){for((a||t.sphereMap||t.dpAtlas)&&(_+="   addReflection();\n"),t.dirLightMap&&(_+="   addDirLightMap();\n"),i=0;i<t.lights.length;i++){if(G=t.lights[i],u=G._type,te=!1,u===n.LIGHTTYPE_DIRECTIONAL?(_+="   dLightDirNormW = light"+i+"_direction;\n",_+="   dAtten = 1.0;\n"):(G._cookie&&(u!==n.LIGHTTYPE_SPOT||G._cookie._cubemap?u===n.LIGHTTYPE_POINT&&G._cookie._cubemap&&(ae=!0,te=!0):(ae=!0,te=!0)),_+="   getLightDirPoint(light"+i+"_position);\n",ie=!0,te&&(_+=u===n.LIGHTTYPE_SPOT?"   dAtten3 = getCookie2D"+(G._cookieFalloff?"":"Clip")+(G._cookieTransform?"Xform":"")+"(light"+i+"_cookie, light"+i+"_shadowMatrix, light"+i+"_cookieIntensity"+(G._cookieTransform?", light"+i+"_cookieMatrix, light"+i+"_cookieOffset":"")+")."+G._cookieChannel+";\n":"   dAtten3 = getCookieCube(light"+i+"_cookie, light"+i+"_shadowMatrix, light"+i+"_cookieIntensity)."+G._cookieChannel+";\n"),G._falloffMode===n.LIGHTFALLOFF_LINEAR?(_+="   dAtten = getFalloffLinear(light"+i+"_radius);\n",ne=!0):(_+="   dAtten = getFalloffInvSquared(light"+i+"_radius);\n",re=!0),_+="   if (dAtten > 0.00001) {\n",u===n.LIGHTTYPE_SPOT&&(te&&!G._cookieFalloff||(_+="       dAtten *= getSpotEffect(light"+i+"_direction, light"+i+"_innerConeAngle, light"+i+"_outerConeAngle);\n",se=!0))),_+="       dAtten *= getLightDiffuse();\n",G.castShadows&&!t.noShadow){var he,le=null;G._shadowType===n.SHADOW_VSM8?(le="VSM8",he="0.0"):G._shadowType===n.SHADOW_VSM16?(le="VSM16",he="5.54"):G._shadowType===n.SHADOW_VSM32?(le="VSM32",he=e.extTextureFloatHighPrecision?"15.0":"5.54"):le=G._shadowType===n.SHADOW_PCF5?"PCF5x5":"PCF3x3",null!==le&&(u===n.LIGHTTYPE_POINT?(f="(light"+i+"_shadowMap, light"+i+"_shadowParams);\n",G._normalOffsetBias&&(_+="       normalOffsetPointShadow(light"+i+"_shadowParams);\n"),_+="       dAtten *= getShadowPoint"+le+f):(E===i?le+="VS":(f="(light"+i+"_shadowMatrix, light"+i+"_shadowParams);\n",_+=this._nonPointShadowMapProjection(e,t.lights[i],f)),u===n.LIGHTTYPE_SPOT&&(le="Spot"+le),_+="       dAtten *= getShadow"+le+"(light"+i+"_shadowMap, light"+i+"_shadowParams"+(G._isVsm?", "+he:"")+");\n"))}_+="       dDiffuseLight += dAtten * light"+i+"_color"+(te?" * dAtten3":"")+";\n",t.useSpecular&&(_+="       dAtten *= getLightSpecular();\n",_+="       dSpecularLight += dAtten * light"+i+"_color"+(te?" * dAtten3":"")+";\n"),u!==n.LIGHTTYPE_DIRECTIONAL&&(_+="   }\n"),_+="\n"}(a||t.sphereMap||t.dpAtlas)&&t.refraction&&(_+="   addRefraction();\n")}_+="\n",K&&(t.occludeDirect&&(_+="    applyAO();\n"),t.occludeSpecular&&(_+="    occludeSpecular();\n")),_+=v.endPS,_+=t.blendType===n.BLEND_NORMAL||t.blendType===n.BLEND_ADDITIVEALPHA||t.alphaToCoverage?v.outputAlphaPS:t.blendType===n.BLEND_PREMULTIPLIED?v.outputAlphaPremulPS:v.outputAlphaOpaquePS,t.msdf&&(_+="   gl_FragColor = applyMsdf(gl_FragColor);\n"),_+="\n",_+=n.programlib.end(),ie&&(_=v.lightDirPointPS+_),ne&&(_=v.falloffLinearPS+_),re&&(_=v.falloffInvSquaredPS+_),se&&(_=v.spotPS+_),ae&&(_=v.cookiePS+_);var ce="";return _.includes("dReflection")&&(ce+="vec4 dReflection;\n"),_.includes("dTBN")&&(ce+="mat3 dTBN;\n"),_.includes("dAlbedo")&&(ce+="vec3 dAlbedo;\n"),_.includes("dEmission")&&(ce+="vec3 dEmission;\n"),_.includes("dNormalW")&&(ce+="vec3 dNormalW;\n"),_.includes("dVertexNormalW")&&(ce+="vec3 dVertexNormalW;\n"),_.includes("dTangentW")&&(ce+="vec3 dTangentW;\n"),_.includes("dBinormalW")&&(ce+="vec3 dBinormalW;\n"),_.includes("dViewDirW")&&(ce+="vec3 dViewDirW;\n"),_.includes("dReflDirW")&&(ce+="vec3 dReflDirW;\n"),_.includes("dDiffuseLight")&&(ce+="vec3 dDiffuseLight;\n"),_.includes("dSpecularLight")&&(ce+="vec3 dSpecularLight;\n"),_.includes("dLightDirNormW")&&(ce+="vec3 dLightDirNormW;\n"),_.includes("dLightDirW")&&(ce+="vec3 dLightDirW;\n"),_.includes("dLightPosW")&&(ce+="vec3 dLightPosW;\n"),_.includes("dShadowCoord")&&(ce+="vec3 dShadowCoord;\n"),
_.includes("dNormalMap")&&(ce+="vec3 dNormalMap;\n"),_.includes("dSpecularity")&&(ce+="vec3 dSpecularity;\n"),_.includes("dUvOffset")&&(ce+="vec2 dUvOffset;\n"),_.includes("dGlossiness")&&(ce+="float dGlossiness;\n"),_.includes("dAlpha")&&(ce+="float dAlpha;\n"),_.includes("dAtten")&&(ce+="float dAtten;\n"),_.includes("dAtten3")&&(ce+="vec3 dAtten3;\n"),_.includes("dAo")&&(ce+="float dAo;\n"),_.includes("dMsdf")&&(ce+="vec4 dMsdf;\n"),_=U+ce+_,L=_,{attributes:y,vshader:O,fshader:L,tag:n.SHADERTAG_MATERIAL}}},n.programlib.skybox={generateKey:function(e,t){var i="skybox"+t.rgbm+" "+t.hdr+" "+t.fixSeams+t.toneMapping+t.gamma+t.useIntensity+t.mip;return i},createShaderDefinition:function(e,t){var i=n.shaderChunks,r=[128,64,16,8,4,2];return{attributes:{aPosition:n.SEMANTIC_POSITION},vshader:i.skyboxVS,fshader:n.programlib.precisionCode(e)+(t.mip?i.fixCubemapSeamsStretchPS:i.fixCubemapSeamsNonePS)+(t.useIntensity?i.envMultiplyPS:i.envConstPS)+n.programlib.gammaCode(t.gamma)+n.programlib.tonemapCode(t.toneMapping)+i.rgbmPS+i.skyboxHDRPS.replace(/\$textureCubeSAMPLE/g,t.rgbm?"textureCubeRGBM":t.hdr?"textureCube":"textureCubeSRGB").replace(/\$FIXCONST/g,1-1/r[t.mip]+"")}}},Object.assign(n,function(){function e(e){var t=new n.VertexFormat(e,[{semantic:n.SEMANTIC_POSITION,components:2,type:n.TYPE_FLOAT32}]),i=new n.VertexBuffer(e,t,4),r=new n.VertexIterator(i);return r.element[n.SEMANTIC_POSITION].set(-1,-1),r.next(),r.element[n.SEMANTIC_POSITION].set(1,-1),r.next(),r.element[n.SEMANTIC_POSITION].set(-1,1),r.next(),r.element[n.SEMANTIC_POSITION].set(1,1),r.end(),i}function t(e,t,r,s,a){e.setRenderTarget(t),e.updateBegin();var o=null!==t?t.width:e.width,h=null!==t?t.height:e.height,l=0,c=0;a&&(l=a.x*o,c=a.y*h,o*=a.z,h*=a.w),e.setViewport(l,c,o,h),e.setScissor(l,c,o,h);var d=e.getBlending(),u=e.getDepthTest(),f=e.getDepthWrite(),p=e.getCullMode(),_=e.writeRed,m=e.writeGreen,A=e.writeBlue,v=e.writeAlpha;e.setBlending(!1),e.setDepthTest(!1),e.setDepthWrite(!1),e.setCullMode(n.CULLFACE_BACK),e.setColorWrite(!0,!0,!0,!0),e.setVertexBuffer(r,0),e.setShader(s),e.draw(i),e.setBlending(d),e.setDepthTest(u),e.setDepthWrite(f),e.setCullMode(p),e.setColorWrite(_,m,A,v),e.updateEnd()}var i={type:n.PRIMITIVE_TRISTRIP,base:0,count:4,indexed:!1},r=function(e){this.device=e,this.shader=null,this.depthMap=null,this.vertexBuffer=n.createFullscreenQuad(e),this.needsDepthBuffer=!1};return Object.assign(r.prototype,{render:function(e,t,i){}}),{PostEffect:r,createFullscreenQuad:e,drawFullscreenQuad:t}}()),function(){var e={BLEND_SUBTRACTIVE:0,BLEND_ADDITIVE:1,BLEND_NORMAL:2,BLEND_NONE:3,BLEND_PREMULTIPLIED:4,BLEND_MULTIPLICATIVE:5,BLEND_ADDITIVEALPHA:6,BLEND_MULTIPLICATIVE2X:7,BLEND_SCREEN:8,BLEND_MIN:9,BLEND_MAX:10,FOG_NONE:"none",FOG_LINEAR:"linear",FOG_EXP:"exp",FOG_EXP2:"exp2",FRESNEL_NONE:0,FRESNEL_SCHLICK:2,LAYER_HUD:0,LAYER_GIZMO:1,LAYER_FX:2,LAYER_WORLD:15,LAYERID_WORLD:0,LAYERID_DEPTH:1,LAYERID_SKYBOX:2,LAYERID_IMMEDIATE:3,LAYERID_UI:4,LIGHTTYPE_DIRECTIONAL:0,LIGHTTYPE_POINT:1,LIGHTTYPE_SPOT:2,LIGHTFALLOFF_LINEAR:0,LIGHTFALLOFF_INVERSESQUARED:1,SHADOW_PCF3:0,SHADOW_DEPTH:0,SHADOW_VSM8:1,SHADOW_VSM16:2,SHADOW_VSM32:3,SHADOW_PCF5:4,BLUR_BOX:0,BLUR_GAUSSIAN:1,PARTICLESORT_NONE:0,PARTICLESORT_DISTANCE:1,PARTICLESORT_NEWER_FIRST:2,PARTICLESORT_OLDER_FIRST:3,PARTICLEMODE_GPU:0,PARTICLEMODE_CPU:1,EMITTERSHAPE_BOX:0,EMITTERSHAPE_SPHERE:1,PROJECTION_PERSPECTIVE:0,PROJECTION_ORTHOGRAPHIC:1,RENDERSTYLE_SOLID:0,RENDERSTYLE_WIREFRAME:1,RENDERSTYLE_POINTS:2,CUBEPROJ_NONE:0,CUBEPROJ_BOX:1,SPECULAR_PHONG:0,SPECULAR_BLINN:1,GAMMA_NONE:0,GAMMA_SRGB:1,GAMMA_SRGBFAST:2,GAMMA_SRGBHDR:3,TONEMAP_LINEAR:0,TONEMAP_FILMIC:1,TONEMAP_HEJL:2,TONEMAP_ACES:3,TONEMAP_ACES2:4,SPECOCC_NONE:0,SPECOCC_AO:1,SPECOCC_GLOSSDEPENDENT:2,SHADERDEF_NOSHADOW:1,SHADERDEF_SKIN:2,SHADERDEF_UV0:4,SHADERDEF_UV1:8,SHADERDEF_VCOLOR:16,SHADERDEF_INSTANCING:32,SHADERDEF_LM:64,SHADERDEF_DIRLM:128,SHADERDEF_SCREENSPACE:256,LINEBATCH_WORLD:0,LINEBATCH_OVERLAY:1,LINEBATCH_GIZMO:2,SHADOWUPDATE_NONE:0,SHADOWUPDATE_THISFRAME:1,SHADOWUPDATE_REALTIME:2,SORTKEY_FORWARD:0,SORTKEY_DEPTH:1,MASK_DYNAMIC:1,MASK_BAKED:2,MASK_LIGHTMAP:4,SHADER_FORWARD:0,SHADER_FORWARDHDR:1,SHADER_DEPTH:2,SHADER_SHADOW:3,SHADER_PICK:18,BAKE_COLOR:0,BAKE_COLORDIR:1,VIEW_CENTER:0,VIEW_LEFT:1,VIEW_RIGHT:2,SORTMODE_NONE:0,SORTMODE_MANUAL:1,SORTMODE_MATERIALMESH:2,SORTMODE_BACK2FRONT:3,SORTMODE_FRONT2BACK:4,COMPUPDATED_INSTANCES:1,COMPUPDATED_LIGHTS:2,COMPUPDATED_CAMERAS:4,COMPUPDATED_BLEND:8,ASPECT_AUTO:0,ASPECT_MANUAL:1,ORIENTATION_HORIZONTAL:0,ORIENTATION_VERTICAL:1};Object.assign(n,e),n.scene={},Object.assign(n.scene,e)}(),Object.assign(n,function(){var e=function(){this.root=null,this._gravity=new n.Vec3(0,(-9.8),0),this._layers=null,this._fog=n.FOG_NONE,this.fogColor=new n.Color(0,0,0),this.fogStart=1,this.fogEnd=1e3,this.fogDensity=0,this.ambientLight=new n.Color(0,0,0),this._gammaCorrection=n.GAMMA_NONE,this._toneMapping=0,this.exposure=1,this._skyboxPrefiltered=[null,null,null,null,null,null],this._skyboxCubeMap=null,this.skyboxModel=null,this._skyboxIntensity=1,this._skyboxMip=0,this.lightmapSizeMultiplier=1,this.lightmapMaxResolution=2048,this.lightmapMode=n.BAKE_COLORDIR,this._stats={meshInstances:0,lights:0,dynamicLights:0,bakedLights:0,lastStaticPrepareFullTime:0,lastStaticPrepareSearchTime:0,lastStaticPrepareWriteTime:0,lastStaticPrepareTriAabbTime:0,lastStaticPrepareCombineTime:0,updateShadersTime:0},this.updateShaders=!0,this.updateSkybox=!0,this._shaderVersion=0,this._statsUpdated=!1,this._models=[],n.events.attach(this)};return Object.defineProperty(e.prototype,"fog",{get:function(){return this._fog},set:function(e){e!==this._fog&&(this._fog=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"gammaCorrection",{get:function(){return this._gammaCorrection},set:function(e){e!==this._gammaCorrection&&(this._gammaCorrection=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"toneMapping",{get:function(){return this._toneMapping},set:function(e){e!==this._toneMapping&&(this._toneMapping=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skybox",{get:function(){return this._skyboxCubeMap},set:function(e){this._skyboxCubeMap=e,this._resetSkyboxModel(),this.updateShaders=!0}}),Object.defineProperty(e.prototype,"skyboxIntensity",{get:function(){return this._skyboxIntensity},set:function(e){this._skyboxIntensity=e,this._resetSkyboxModel(),this.updateShaders=!0}}),Object.defineProperty(e.prototype,"skyboxMip",{get:function(){return this._skyboxMip},set:function(e){this._skyboxMip=e,this._resetSkyboxModel(),this.updateShaders=!0}}),Object.defineProperty(e.prototype,"skyboxPrefiltered128",{get:function(){return this._skyboxPrefiltered[0]},set:function(e){this._skyboxPrefiltered[0]!==e&&(this._skyboxPrefiltered[0]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skyboxPrefiltered64",{get:function(){return this._skyboxPrefiltered[1]},set:function(e){this._skyboxPrefiltered[1]!==e&&(this._skyboxPrefiltered[1]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skyboxPrefiltered32",{get:function(){return this._skyboxPrefiltered[2]},set:function(e){this._skyboxPrefiltered[2]!==e&&(this._skyboxPrefiltered[2]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skyboxPrefiltered16",{get:function(){return this._skyboxPrefiltered[3]},set:function(e){this._skyboxPrefiltered[3]!==e&&(this._skyboxPrefiltered[3]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skyboxPrefiltered8",{get:function(){return this._skyboxPrefiltered[4]},set:function(e){this._skyboxPrefiltered[4]!==e&&(this._skyboxPrefiltered[4]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"skyboxPrefiltered4",{get:function(){return this._skyboxPrefiltered[5]},set:function(e){this._skyboxPrefiltered[5]!==e&&(this._skyboxPrefiltered[5]=e,this.updateShaders=!0)}}),Object.defineProperty(e.prototype,"drawCalls",{get:function(){var e=this.layers._meshInstances;return e.length||(this.layers._update(),e=this.layers._meshInstances),e},set:function(e){}}),Object.defineProperty(e.prototype,"layers",{get:function(){return this._layers},set:function(e){var t=this._layers;this._layers=e,this.fire("set:layers",t,e)}}),e.prototype.applySettings=function(e){this._gravity.set(e.physics.gravity[0],e.physics.gravity[1],e.physics.gravity[2]),this.ambientLight.set(e.render.global_ambient[0],e.render.global_ambient[1],e.render.global_ambient[2]),this._fog=e.render.fog,this.fogColor.set(e.render.fog_color[0],e.render.fog_color[1],e.render.fog_color[2]),this.fogStart=e.render.fog_start,this.fogEnd=e.render.fog_end,this.fogDensity=e.render.fog_density,this._gammaCorrection=e.render.gamma_correction,this._toneMapping=e.render.tonemapping,this.lightmapSizeMultiplier=e.render.lightmapSizeMultiplier,this.lightmapMaxResolution=e.render.lightmapMaxResolution,this.lightmapMode=e.render.lightmapMode,this.exposure=e.render.exposure,this._skyboxIntensity=void 0===e.render.skyboxIntensity?1:e.render.skyboxIntensity,this._skyboxMip=void 0===e.render.skyboxMip?0:e.render.skyboxMip,this._resetSkyboxModel(),this.updateShaders=!0},e.prototype._updateSkybox=function(e){if(this._skyboxCubeMap&&!this.skyboxModel){var t=new n.Material,i=this;t.updateShader=function(t,r,s,a,o){var h=e.getProgramLibrary(),l=h.getProgram("skybox",{rgbm:i._skyboxCubeMap.rgbm,hdr:i._skyboxCubeMap.rgbm||i._skyboxCubeMap.format===n.PIXELFORMAT_RGBA32F,useIntensity:1!==i.skyboxIntensity,mip:i._skyboxCubeMap.fixCubemapSeams?i.skyboxMip:0,fixSeams:i._skyboxCubeMap.fixCubemapSeams,gamma:o===n.SHADER_FORWARDHDR?i.gammaCorrection?n.GAMMA_SRGBHDR:n.GAMMA_NONE:i.gammaCorrection,toneMapping:o===n.SHADER_FORWARDHDR?n.TONEMAP_LINEAR:i.toneMapping});this.setShader(l)},t.updateShader();var r;if(this._skyboxCubeMap.fixCubemapSeams&&i._skyboxMip){var s=[null,"64","16","8","4"],a=this["skyboxPrefiltered"+s[i._skyboxMip]];a&&(r=a)}else r=this._skyboxCubeMap;t.setParameter("texture_cubeMap",r),t.cull=n.CULLFACE_NONE;var o=this.layers.getLayerById(n.LAYERID_SKYBOX);if(o){var h=new n.GraphNode,l=n.createBox(e),c=new n.MeshInstance(h,l,t);c.cull=!1,c._noDepthDrawGl1=!0;var d=new n.Model;d.graph=h,d.meshInstances=[c],this.skyboxModel=d,o.addMeshInstances(d.meshInstances),o.enabled=!0,this.skyLayer=o,this.fire("set:skybox",r)}}},e.prototype._resetSkyboxModel=function(){this.skyboxModel&&(this.skyLayer.removeMeshInstances(this.skyboxModel.meshInstances),this.skyLayer.enabled=!1),this.skyboxModel=null,this.updateSkybox=!0},e.prototype.setSkybox=function(e){var t;e||(e=[null,null,null,null,null,null,null]);var i=!1;if(this._skyboxCubeMap!==e[0]&&(i=!0),!i)for(t=0;t<6&&!i;t++)this._skyboxPrefiltered[t]!==e[t+1]&&(i=!0);if(i){for(t=0;t<6;t++)this._skyboxPrefiltered[t]=e[t+1];this.skybox=e[0]}},e.prototype.destroy=function(){this.skybox=null},e.prototype.addModel=function(e){if(!this.containsModel(e)){var t=this.layers.getLayerById(n.LAYERID_WORLD);t&&(t.addMeshInstances(e.meshInstances),this._models.push(e))}},e.prototype.addShadowCaster=function(e){var t=this.layers.getLayerById(n.LAYERID_WORLD);t&&t.addShadowCasters(e.meshInstances)},e.prototype.removeModel=function(e){var t=this._models.indexOf(e);if(t!==-1){var i=this.layers.getLayerById(n.LAYERID_WORLD);if(!i)return;i.removeMeshInstances(e.meshInstances),this._models.splice(t,1)}},e.prototype.removeShadowCasters=function(e){var t=this.layers.getLayerById(n.LAYERID_WORLD);t&&t.removeShadowCasters(e.meshInstances)},e.prototype.containsModel=function(e){return this._models.indexOf(e)>=0},e.prototype.getModels=function(e){return this._models},{Scene:e}}()),Object.assign(n,function(){function e(e,t,i){var r,s,a=e._nearClip,o=e._fov*Math.PI/180,h=e._aspect,l=e._projection;return s=l===n.PROJECTION_PERSPECTIVE?Math.tan(o/2)*a:e._orthoHeight,r=s*h,i[0].x=r,i[0].y=-s,i[0].z=-a,i[1].x=r,i[1].y=s,i[1].z=-a,i[2].x=-r,i[2].y=s,i[2].z=-a,i[3].x=-r,i[3].y=-s,i[3].z=-a,l===n.PROJECTION_PERSPECTIVE&&(s=Math.tan(o/2)*t,r=s*h),i[4].x=r,i[4].y=-s,i[4].z=-t,i[5].x=r,i[5].y=s,i[5].z=-t,i[6].x=-r,i[6].y=s,i[6].z=-t,i[7].x=-r,i[7].y=-s,i[7].z=-t,i}function t(e,t,i,n,r,s,a){re[0].x=re[1].x=re[2].x=re[3].x=t.x,re[1].y=re[3].y=re[7].y=re[5].y=t.y,re[2].z=re[3].z=re[6].z=re[7].z=t.z,re[4].x=re[5].x=re[6].x=re[7].x=i.x,re[0].y=re[2].y=re[4].y=re[6].y=i.y,re[0].z=re[1].z=re[4].z=re[5].z=i.z;for(var o,h=9999999999,l=-9999999999,c=0;c<8;++c)e.transformPoint(re[c],re[c]),o=re[c].z,o<h&&(h=o),o>l&&(l=o);return{min:h,max:l}}function i(e,t){return t===n.SHADOW_VSM32?n.PIXELFORMAT_RGBA32F:t===n.SHADOW_VSM16?n.PIXELFORMAT_RGBA16F:t===n.SHADOW_PCF5?n.PIXELFORMAT_DEPTH:t===n.SHADOW_PCF3&&e.webgl2?n.PIXELFORMAT_DEPTH:n.PIXELFORMAT_R8_G8_B8_A8}function r(e,t){return t!==n.SHADOW_PCF3||e.webgl2?t===n.SHADOW_VSM32?e.extTextureFloatLinear?n.FILTER_LINEAR:n.FILTER_NEAREST:t===n.SHADOW_VSM16?e.extTextureHalfFloatLinear?n.FILTER_LINEAR:n.FILTER_NEAREST:n.FILTER_LINEAR:n.FILTER_NEAREST}function s(e,t,s,a){var o=i(e,a),h=r(e,a),l=new n.Texture(e,{format:o,width:t,height:s,mipmaps:!1,minFilter:h,magFilter:h,addressU:n.ADDRESS_CLAMP_TO_EDGE,addressV:n.ADDRESS_CLAMP_TO_EDGE});return a===n.SHADOW_PCF5||a===n.SHADOW_PCF3&&e.webgl2?(l.compareOnRead=!0,l.compareFunc=n.FUNC_LESS,new n.RenderTarget({depthBuffer:l})):new n.RenderTarget({colorBuffer:l,depth:!0})}function a(e,t){for(var i,r=new n.Texture(e,{format:n.PIXELFORMAT_R8_G8_B8_A8,width:t,height:t,cubemap:!0,mipmaps:!1,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST,addressU:n.ADDRESS_CLAMP_TO_EDGE,addressV:n.ADDRESS_CLAMP_TO_EDGE}),s=[],a=0;a<6;a++)i=new n.RenderTarget({colorBuffer:r,face:a,depth:!0}),s.push(i);return s}function o(e,t){return Math.exp(-(e*e)/(2*t*t))}function h(e){e>te&&(e=te);var t,i,n,r,s=(e-1)/6;for(r=.5*(e-1),i=new Array(e),n=0,t=0;t<e;++t)i[t]=o(t-r,s),n+=i[t];for(t=0;t<e;++t)i[t]/=n;return i}function l(e,t,i){var r=n.CLEARFLAG_DEPTH,s=t===n.SHADOW_PCF5||t===n.SHADOW_PCF3&&e.webgl2;i===n.LIGHTTYPE_POINT&&(s=!1),s||(r|=n.CLEARFLAG_COLOR);var a=new n.Camera;return t>=n.SHADOW_VSM8&&t<=n.SHADOW_VSM32?(a.clearColor[0]=0,a.clearColor[1]=0,a.clearColor[2]=0,a.clearColor[3]=0):(a.clearColor[0]=1,a.clearColor[1]=1,a.clearColor[2]=1,a.clearColor[3]=1),a.clearDepth=1,a.clearFlags=r,a.clearStencil=null,a._node=new n.GraphNode,a}function c(e,t,i,r){r||(r=0);var a=1e4*r+t,o=I[i][a];return o||(o=s(e,t,t,i?i:n.SHADOW_PCF3),I[i][a]=o),o}function d(e,t){var i;t._type===n.LIGHTTYPE_POINT?(t._shadowType>n.SHADOW_PCF3&&(t._shadowType=n.SHADOW_PCF3),t._cacheShadowMap?(i=ee[t._shadowResolution],i||(i=a(e,t._shadowResolution),ee[t._shadowResolution]=i)):i=a(e,t._shadowResolution),t._shadowCamera.renderTarget=i[0],t._shadowCubeMap=i):(i=t._cacheShadowMap?c(e,t._shadowResolution,t._shadowType):s(e,t._shadowResolution,t._shadowResolution,t._shadowType),t._shadowCamera.renderTarget=i),t._isCachedShadowMap=t._cacheShadowMap}function u(e){var t=e.material,i=e.skinInstance?10:0,n=0;if(t.opacityMap){var r=t.opacityMapChannel;r&&(n=C[r])}return i+n}function f(e){this.device=e;var t=this.device;this._shadowDrawCalls=0,this._forwardDrawCalls=0,this._skinDrawCalls=0,this._camerasRendered=0,this._materialSwitches=0,this._shadowMapUpdates=0,this._shadowMapTime=0,this._depthMapTime=0,this._forwardTime=0,this._cullTime=0,this._sortTime=0,this._skinTime=0,this._morphTime=0,this._instancingTime=0;var i=t.getProgramLibrary();this.library=i,this.frontToBack=!1;var r=t.scope;this.projId=r.resolve("matrix_projection"),this.viewId=r.resolve("matrix_view"),this.viewId3=r.resolve("matrix_view3"),this.viewInvId=r.resolve("matrix_viewInverse"),this.viewProjId=r.resolve("matrix_viewProjection"),this.viewPosId=r.resolve("view_position"),this.nearClipId=r.resolve("camera_near"),this.farClipId=r.resolve("camera_far"),this.cameraParamsId=r.resolve("camera_params"),this.shadowMapLightRadiusId=r.resolve("light_radius"),this.fogColorId=r.resolve("fog_color"),this.fogStartId=r.resolve("fog_start"),this.fogEndId=r.resolve("fog_end"),this.fogDensityId=r.resolve("fog_density"),this.modelMatrixId=r.resolve("matrix_model"),this.normalMatrixId=r.resolve("matrix_normal"),this.poseMatrixId=r.resolve("matrix_pose[0]"),this.boneTextureId=r.resolve("texture_poseMap"),this.boneTextureSizeId=r.resolve("texture_poseMapSize"),this.alphaTestId=r.resolve("alpha_ref"),this.opacityMapId=r.resolve("texture_opacityMap"),this.ambientId=r.resolve("light_globalAmbient"),this.exposureId=r.resolve("exposure"),this.skyboxIntensityId=r.resolve("skyboxIntensity"),this.lightColorId=[],this.lightDirId=[],this.lightShadowMapId=[],this.lightShadowMatrixId=[],this.lightShadowParamsId=[],this.lightShadowMatrixVsId=[],this.lightShadowParamsVsId=[],this.lightDirVsId=[],this.lightRadiusId=[],this.lightPosId=[],this.lightInAngleId=[],this.lightOutAngleId=[],this.lightPosVsId=[],this.lightCookieId=[],this.lightCookieIntId=[],this.lightCookieMatrixId=[],this.lightCookieOffsetId=[],this.depthMapId=r.resolve("uDepthMap"),this.screenSizeId=r.resolve("uScreenSize"),this._screenSize=new n.Vec4,this.sourceId=r.resolve("source"),this.pixelOffsetId=r.resolve("pixelOffset"),this.weightId=r.resolve("weight[0]");var s=n.shaderChunks;this.blurVsmShaderCode=[s.blurVSMPS,"#define GAUSS\n"+s.blurVSMPS];var a="#define PACKED\n";this.blurPackedVsmShaderCode=[a+this.blurVsmShaderCode[0],a+this.blurVsmShaderCode[1]],this.blurVsmShader=[{},{}],this.blurPackedVsmShader=[{},{}],this.blurVsmWeights={},this.polygonOffsetId=r.resolve("polygonOffset"),this.polygonOffset=new Float32Array(2),this.fogColor=new Float32Array(3),this.ambientColor=new Float32Array(3)}function p(e,t){e.data[0]=t.data[0],e.data[1]=t.data[1],e.data[2]=t.data[2],e.data[3]=t.data[4],e.data[4]=t.data[5],e.data[5]=t.data[6],e.data[6]=t.data[8],e.data[7]=t.data[9],e.data[8]=t.data[10]}for(var _,m,A,v,y,g,b,E,T,S,w=(new n.Mat4).mul2((new n.Mat4).setTranslate(.5,.5,.5),(new n.Mat4).setScale(.5,.5,.5)),C={r:1,g:2,b:3,a:4},M=[(new n.Quat).setFromEulerAngles(0,90,180),(new n.Quat).setFromEulerAngles(0,-90,180),(new n.Quat).setFromEulerAngles(90,0,0),(new n.Quat).setFromEulerAngles(-90,0,0),(new n.Quat).setFromEulerAngles(0,180,180),(new n.Quat).setFromEulerAngles(0,0,180)],P=5,I=[{},{},{},{},{}],R=.01,x=new n.Vec2,O={x:1,y:1,z:0,w:0},k=new n.Mat4,D=new n.Mat4,L=new n.Mat4,N=new n.Mat4,F=new n.Mat4,B=new n.Mat3,V=new n.Mat4,U=new n.Mat4,G=new n.Mat4,W=new n.Mat4,z=new n.Mat4,H=new n.Vec3,j=new n.Vec3,Y=new n.Mat4,X=new n.Mat4,Z=new n.Mat4,K=new n.Mat4,Q=new n.Vec3,J={center:null,radius:0},q=new n.BoundingBox,$=[0,0],ee={},te=25,ie=[],ne=0;ne<8;ne++)ie.push(new n.Vec3);var re=[new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3];return Object.assign(f.prototype,{sortCompare:function(e,t){if(e.layer===t.layer){if(e.drawOrder&&t.drawOrder)return e.drawOrder-t.drawOrder;if(e.zdist&&t.zdist)return t.zdist-e.zdist;if(e.zdist2&&t.zdist2)return e.zdist2-t.zdist2}return t._key[n.SORTKEY_FORWARD]-e._key[n.SORTKEY_FORWARD]},sortCompareMesh:function(e,t){if(e.layer===t.layer){if(e.drawOrder&&t.drawOrder)return e.drawOrder-t.drawOrder;if(e.zdist&&t.zdist)return t.zdist-e.zdist}return T=e._key[n.SORTKEY_FORWARD],S=t._key[n.SORTKEY_FORWARD],T===S&&e.mesh&&t.mesh?t.mesh.id-e.mesh.id:S-T},depthSortCompare:function(e,t){return T=e._key[n.SORTKEY_DEPTH],S=t._key[n.SORTKEY_DEPTH],T===S&&e.mesh&&t.mesh?t.mesh.id-e.mesh.id:S-T},lightCompare:function(e,t){return e.key-t.key},_isVisible:function(e,t){return!!t.visible&&(v=t.aabb.center,t._aabb._radiusVer!==t._aabbVer&&(t._aabb._radius=t._aabb.halfExtents.length(),t._aabb._radiusVer=t._aabbVer),J.radius=t._aabb._radius,J.center=v,e.frustum.containsSphere(J))},getShadowCamera:function(e,t){var i,n=t._shadowCamera;return null===n?(n=t._shadowCamera=l(e,t._shadowType,t._type),d(e,t)):(i=n.renderTarget,i.width===t._shadowResolution&&i.height===t._shadowResolution||d(e,t)),n},updateCameraFrustum:function(e){if(e.vrDisplay&&e.vrDisplay.presenting){_=e.vrDisplay.combinedProj;var t=e._node.getParent();return t?F.copy(t.getWorldTransform()).mul(e.vrDisplay.combinedViewInv).invert():F.copy(e.vrDisplay.combinedView),N.copy(F).invert(),this.viewInvId.setValue(N.data),void e.frustum.update(_,F)}if(_=e.getProjectionMatrix(),e.overrideCalculateProjection&&e.calculateProjection(_,n.VIEW_CENTER),e.overrideCalculateTransform)e.calculateTransform(N,n.VIEW_CENTER);else{var i=e._node.getPosition(),r=e._node.getRotation();N.setTRS(i,r,n.Vec3.ONE),this.viewInvId.setValue(N.data)}F.copy(N).invert(),e.frustum.update(_,F)},setCamera:function(e,t,i,r){var s=e.vrDisplay;if(s&&s.presenting){if(m=s.leftProj,A=s.rightProj,_=s.combinedProj,e.overrideCalculateProjection&&(e.calculateProjection(m,n.VIEW_LEFT),e.calculateProjection(A,n.VIEW_RIGHT),e.calculateProjection(_,n.VIEW_CENTER)),e.overrideCalculateTransform)e.calculateTransform(U,n.VIEW_LEFT),e.calculateTransform(G,n.VIEW_RIGHT),e.calculateTransform(N,n.VIEW_CENTER),W.copy(U).invert(),z.copy(G).invert(),F.copy(N).invert();else{var a=e._node.getParent();if(a){var o=a.getWorldTransform();U.mul2(o,s.leftViewInv),G.mul2(o,s.rightViewInv),W.copy(U).invert(),z.copy(G).invert(),F.copy(a.getWorldTransform()).mul(s.combinedViewInv).invert()}else U.copy(s.leftViewInv),G.copy(s.rightViewInv),W.copy(s.leftView),z.copy(s.rightView),F.copy(s.combinedView)}p(Y,W),p(X,z),Z.mul2(m,W),K.mul2(A,z),H.data[0]=U.data[12],H.data[1]=U.data[13],H.data[2]=U.data[14],j.data[0]=G.data[12],j.data[1]=G.data[13],j.data[2]=G.data[14],e.frustum.update(_,F)}else{if(_=e.getProjectionMatrix(),e.overrideCalculateProjection&&e.calculateProjection(_,n.VIEW_CENTER),this.projId.setValue(_.data),e.overrideCalculateTransform)e.calculateTransform(N,n.VIEW_CENTER);else{var h=e._node.getPosition(),l=e._node.getRotation();N.setTRS(h,l,n.Vec3.ONE)}this.viewInvId.setValue(N.data),F.copy(N).invert(),this.viewId.setValue(F.data),p(B,F),this.viewId3.setValue(B.data),V.mul2(_,F),this.viewProjId.setValue(V.data),this.viewPosId.setValue(e._node.getPosition().data),e.frustum.update(_,F)}this.nearClipId.setValue(e._nearClip),this.farClipId.setValue(e._farClip),this.cameraParamsId.setValue(e._shaderParams.data);var c=this.device;c.setRenderTarget(t),c.updateBegin();var d=e.getRect(),u=t?t.width:c.width,f=t?t.height:c.height,v=Math.floor(d.x*u),y=Math.floor(d.y*f),g=Math.floor(d.width*u),b=Math.floor(d.height*f);c.setViewport(v,y,g,b),c.setScissor(v,y,g,b),i&&c.clear(e._clearOptions),d=e._scissorRect,v=Math.floor(d.x*u),y=Math.floor(d.y*f),g=Math.floor(d.width*u),b=Math.floor(d.height*f),c.setScissor(v,y,g,b),r&&c.setScissor(1,1,u-2,f-2)},dispatchGlobalLights:function(e){var t;if(this.mainLight=-1,this.ambientColor[0]=e.ambientLight.data[0],this.ambientColor[1]=e.ambientLight.data[1],this.ambientColor[2]=e.ambientLight.data[2],e.gammaCorrection)for(t=0;t<3;t++)this.ambientColor[t]=Math.pow(this.ambientColor[t],2.2);this.ambientId.setValue(this.ambientColor),this.exposureId.setValue(e.exposure),e.skyboxModel&&this.skyboxIntensityId.setValue(e.skyboxIntensity)},_resolveLight:function(e,t){var i="light"+t;this.lightColorId[t]=e.resolve(i+"_color"),this.lightDirId[t]=e.resolve(i+"_direction"),this.lightShadowMapId[t]=e.resolve(i+"_shadowMap"),this.lightShadowMatrixId[t]=e.resolve(i+"_shadowMatrix"),this.lightShadowParamsId[t]=e.resolve(i+"_shadowParams"),this.lightShadowMatrixVsId[t]=e.resolve(i+"_shadowMatrixVS"),this.lightShadowParamsVsId[t]=e.resolve(i+"_shadowParamsVS"),this.lightDirVsId[t]=e.resolve(i+"_directionVS"),this.lightRadiusId[t]=e.resolve(i+"_radius"),this.lightPosId[t]=e.resolve(i+"_position"),this.lightInAngleId[t]=e.resolve(i+"_innerConeAngle"),this.lightOutAngleId[t]=e.resolve(i+"_outerConeAngle"),this.lightPosVsId[t]=e.resolve(i+"_positionVS"),this.lightCookieId[t]=e.resolve(i+"_cookie"),this.lightCookieIntId[t]=e.resolve(i+"_cookieIntensity"),this.lightCookieMatrixId[t]=e.resolve(i+"_cookieMatrix"),this.lightCookieOffsetId[t]=e.resolve(i+"_cookieOffset")},dispatchDirectLights:function(e,t,i){var n,r,s,a=e.length,o=0;this.mainLight=-1;var h=this.device.scope;for(n=0;n<a;n++)if(e[n]._mask&i){if(r=e[n],s=r._node.getWorldTransform(),this.lightColorId[o]||this._resolveLight(h,o),this.lightColorId[o].setValue(t.gammaCorrection?r._linearFinalColor.data:r._finalColor.data),s.getY(r._direction).scale(-1),this.lightDirId[o].setValue(r._direction.normalize().data),r.castShadows){var l,c=r._isPcf&&this.device.webgl2?r._shadowCamera.renderTarget.depthBuffer:r._shadowCamera.renderTarget.colorBuffer;r._isVsm?l=-2e-4:(l=r.shadowBias/r._shadowCamera._farClip*100,!this.device.webgl2&&this.device.extStandardDerivatives&&(l*=-100));var d=r._isVsm?r.vsmBias/(r._shadowCamera._farClip/7):r._normalOffsetBias;this.lightShadowMapId[o].setValue(c),this.lightShadowMatrixId[o].setValue(r._shadowMatrix.data);var u=r._rendererParams;3!==u.length&&(u.length=3),u[0]=r._shadowResolution,u[1]=d,u[2]=l,this.lightShadowParamsId[o].setValue(u),this.mainLight<0&&(this.lightShadowMatrixVsId[o].setValue(r._shadowMatrix.data),this.lightShadowParamsVsId[o].setValue(u),this.lightDirVsId[o].setValue(r._direction.normalize().data),this.mainLight=n)}o++}return o},dispatchPointLight:function(e,t,i,n){var r=i._node.getWorldTransform();if(this.lightColorId[n]||this._resolveLight(t,n),this.lightRadiusId[n].setValue(i.attenuationEnd),this.lightColorId[n].setValue(e.gammaCorrection?i._linearFinalColor.data:i._finalColor.data),r.getTranslation(i._position),this.lightPosId[n].setValue(i._position.data),i.castShadows){var s=i._shadowCamera.renderTarget.colorBuffer;this.lightShadowMapId[n].setValue(s);var a=i._rendererParams;4!==a.length&&(a.length=4),a[0]=i._shadowResolution,a[1]=i._normalOffsetBias,a[2]=i.shadowBias,a[3]=1/i.attenuationEnd,this.lightShadowParamsId[n].setValue(a)}i._cookie&&(this.lightCookieId[n].setValue(i._cookie),this.lightShadowMatrixId[n].setValue(r.data),this.lightCookieIntId[n].setValue(i.cookieIntensity))},dispatchSpotLight:function(e,t,i,r){var s=i._node.getWorldTransform();if(this.lightColorId[r]||this._resolveLight(t,r),this.lightInAngleId[r].setValue(i._innerConeAngleCos),this.lightOutAngleId[r].setValue(i._outerConeAngleCos),this.lightRadiusId[r].setValue(i.attenuationEnd),this.lightColorId[r].setValue(e.gammaCorrection?i._linearFinalColor.data:i._finalColor.data),s.getTranslation(i._position),this.lightPosId[r].setValue(i._position.data),s.getY(i._direction).scale(-1),this.lightDirId[r].setValue(i._direction.normalize().data),i.castShadows){var a;i._isVsm?a=-2e-4:(a=20*i.shadowBias,!this.device.webgl2&&this.device.extStandardDerivatives&&(a*=-100));var o=i._isVsm?i.vsmBias/(i.attenuationEnd/7):i._normalOffsetBias,h=i._isPcf&&this.device.webgl2?i._shadowCamera.renderTarget.depthBuffer:i._shadowCamera.renderTarget.colorBuffer;this.lightShadowMapId[r].setValue(h),this.lightShadowMatrixId[r].setValue(i._shadowMatrix.data);var l=i._rendererParams;4!==l.length&&(l.length=4),l[0]=i._shadowResolution,l[1]=o,l[2]=a,l[3]=1/i.attenuationEnd,this.lightShadowParamsId[r].setValue(l)}if(i._cookie){if(this.lightCookieId[r].setValue(i._cookie),!i.castShadows){var c=this.getShadowCamera(this.device,i),d=c._node;d.setPosition(i._node.getPosition()),d.setRotation(i._node.getRotation()),d.rotateLocal(-90,0,0),c.projection=n.PROJECTION_PERSPECTIVE,c.aspectRatio=1,c.fov=2*i._outerConeAngle,k.setTRS(d.getPosition(),d.getRotation(),n.Vec3.ONE).invert(),D.mul2(c.getProjectionMatrix(),k),i._shadowMatrix.mul2(w,D)}this.lightShadowMatrixId[r].setValue(i._shadowMatrix.data),this.lightCookieIntId[r].setValue(i.cookieIntensity),i._cookieTransform&&(this.lightCookieMatrixId[r].setValue(i._cookieTransform.data),this.lightCookieOffsetId[r].setValue(i._cookieOffset.data))}},dispatchLocalLights:function(e,t,i,r,s){var a,o,h,l=e[n.LIGHTTYPE_POINT],c=e[n.LIGHTTYPE_SPOT],d=r,u=l.length,f=c.length,p=d,_=this.device.scope;for(a=0;a<u;a++)o=l[a],o._mask&i&&(o.isStatic||(this.dispatchPointLight(t,_,o,p),p++));var m=0;if(s)for(o=s[m];o&&o._type===n.LIGHTTYPE_POINT;)this.dispatchPointLight(t,_,o,p),p++,m++,o=s[m];for(a=0;a<f;a++)h=c[a],h._mask&i&&(h.isStatic||(this.dispatchSpotLight(t,_,h,p),p++));if(s)for(h=s[m];h&&h._type===n.LIGHTTYPE_SPOT;)this.dispatchSpotLight(t,_,h,p),p++,m++,h=s[m]},cull:function(e,t,i){var n,r,s,a=0,o=t.length,h=e.cullingMask||4294967295;if(!e.frustumCulling){for(n=0;n<o;n++)r=t[n],(r.visible||r.command)&&(r.mask&&0===(r.mask&h)||(i[a]=r,a++,r.visibleThisFrame=!0));return a}for(n=0;n<o;n++)if(r=t[n],r.command)i[a]=r,a++,r.visibleThisFrame=!0;else{if(!r.visible)continue;if(s=!0,r.mask&&0===(r.mask&h))continue;r.cull&&(s=this._isVisible(e,r)),s&&(i[a]=r,a++,r.visibleThisFrame=!0)}return a},cullLights:function(e,t){var i,r,s;for(i=0;i<t.length;i++)if(r=t[i],s=r._type,r.castShadows&&r._enabled&&r.shadowUpdateMode!==n.SHADOWUPDATE_NONE&&s!==n.LIGHTTYPE_DIRECTIONAL){if(r.getBoundingSphere(J),!e.frustum.containsSphere(J))continue;r.visibleThisFrame=!0}},updateCpuSkinMatrices:function(e){var t=e.length;if(0!==t){var i,n;for(i=0;i<t;i++)n=e[i].skinInstance,n&&(n.updateMatrices(e[i].node),n._dirty=!0)}},updateGpuSkinMatrices:function(e){var t,i,n=e.length;for(t=0;t<n;t++)e[t].visibleThisFrame&&(i=e[t].skinInstance,i&&i._dirty&&(i.updateMatrixPalette(),i._dirty=!1))},updateMorphedBounds:function(e){var t,i,n=e.length;for(t=0;t<n;t++)i=e[t].morphInstance,i&&i._dirty&&i.updateBounds(e[t].mesh)},updateMorphing:function(e){var t,i,n=e.length;for(t=0;t<n;t++)e[t].visibleThisFrame&&(i=e[t].morphInstance,i&&i._dirty&&(i.update(e[t].mesh),i._dirty=!1))},setBaseConstants:function(e,t){e.setCullMode(t.cull),t.opacityMap&&(this.opacityMapId.setValue(t.opacityMap),this.alphaTestId.setValue(t.alphaTest))},setSkinning:function(e,t,i){t.skinInstance&&(this._skinDrawCalls++,e.supportsBoneTextures?(y=t.skinInstance.boneTexture,this.boneTextureId.setValue(y),$[0]=y.width,$[1]=y.height,this.boneTextureSizeId.setValue($)):this.poseMatrixId.setValue(t.skinInstance.matrixPalette))},drawInstance:function(e,t,i,r,s){return g=t.instancingData,g?(this._instancedDrawCalls++,this._removedByInstancing+=g.count,e.setVertexBuffer(g._buffer,1,g.offset),e.draw(i.primitive[r],g.count),g._buffer===n._autoInstanceBuffer?(t.instancingData=null,g.count-1):void 0):(b=t.node.worldTransform,this.modelMatrixId.setValue(b.data),s&&(E=t.node.normalMatrix,t.node._dirtyNormal&&(b.invertTo3x3(E),E.transpose(),t.node._dirtyNormal=!1),this.normalMatrixId.setValue(E.data)),e.draw(i.primitive[r]),0)},drawInstance2:function(e,t,i,r){return g=t.instancingData,g?(this._instancedDrawCalls++,this._removedByInstancing+=g.count,e.setVertexBuffer(g._buffer,1,g.offset),e.draw(i.primitive[r],g.count),g._buffer===n._autoInstanceBuffer?(t.instancingData=null,g.count-1):void 0):(e.draw(i.primitive[r]),0)},renderShadows:function(e,t){var i,r,s,a,o,l,d,f,p,_,m,A,v,y,g,b,E,T,S,C,I,R,L=this.device,N=1<<n.SHADER_SHADOW;for(i=0;i<e.length;i++)if(s=e[i],o=s._type,s.castShadows&&s._enabled&&(s._shadowCamera||this.getShadowCamera(L,s),s.shadowUpdateMode!==n.SHADOWUPDATE_NONE&&s.visibleThisFrame)){if(l=this.getShadowCamera(L,s),d=l._node,f=0,p=1,o===n.LIGHTTYPE_DIRECTIONAL){if(s._visibleLength[t]<0)continue;E=s._visibleCameraSettings[t],d.setPosition(E.x,E.y,E.z),l.orthoHeight=E.orthoHeight,l.farClip=E.farClip,f=t}else o===n.LIGHTTYPE_SPOT?(this.viewPosId.setValue(d.getPosition().data),this.shadowMapLightRadiusId.setValue(s.attenuationEnd)):o===n.LIGHTTYPE_POINT&&(this.viewPosId.setValue(d.getPosition().data),this.shadowMapLightRadiusId.setValue(s.attenuationEnd),p=6);for(o!==n.LIGHTTYPE_POINT&&(k.setTRS(d.getPosition(),d.getRotation(),n.Vec3.ONE).invert(),D.mul2(l.getProjectionMatrix(),k),s._shadowMatrix.mul2(w,D)),L.webgl2?o===n.LIGHTTYPE_POINT?L.setDepthBias(!1):(L.setDepthBias(!0),L.setDepthBiasValues(s.shadowBias*-1e3,s.shadowBias*-1e3)):L.extStandardDerivatives&&(o===n.LIGHTTYPE_POINT?(this.polygonOffset[0]=0,this.polygonOffset[1]=0,this.polygonOffsetId.setValue(this.polygonOffset)):(this.polygonOffset[0]=s.shadowBias*-1e3,this.polygonOffset[1]=s.shadowBias*-1e3,this.polygonOffsetId.setValue(this.polygonOffset))),s.shadowUpdateMode===n.SHADOWUPDATE_THISFRAME&&(s.shadowUpdateMode=n.SHADOWUPDATE_NONE),
this._shadowMapUpdates+=p,L.setBlending(!1),L.setDepthWrite(!0),L.setDepthTest(!0),s._isPcf&&L.webgl2&&o!==n.LIGHTTYPE_POINT?L.setColorWrite(!1,!1,!1,!1):L.setColorWrite(!0,!0,!0,!0),f?p=f+1:f=0;f<p;){for(o===n.LIGHTTYPE_POINT&&(d.setRotation(M[f]),l.renderTarget=s._shadowCubeMap[f]),this.setCamera(l,l.renderTarget,!0,o!==n.LIGHTTYPE_POINT),T=s._visibleList[f],S=s._visibleLength[f],_=s._shadowType,m=_+o*P,r=0,A=S;r<A;r++){if(v=T[r],y=v.mesh,g=v.material,this.setBaseConstants(L,g),this.setSkinning(L,v,g),g.chunks){R=g.parameters;for(C in R)I=R[C],I.passFlags&N&&(I.scopeId||(I.scopeId=L.scope.resolve(C)),I.scopeId.setValue(I.data));R=v.parameters;for(C in R)I=R[C],I.passFlags&N&&(I.scopeId||(I.scopeId=L.scope.resolve(C)),I.scopeId.setValue(I.data))}a=v._shader[n.SHADER_SHADOW+m],a||(this.updateShader(v,v._shaderDefs,null,n.SHADER_SHADOW+m),a=v._shader[n.SHADER_SHADOW+m],v._key[n.SORTKEY_DEPTH]=u(v)),L.setShader(a),b=v.renderStyle,L.setVertexBuffer(v.morphInstance&&v.morphInstance._vertexBuffer?v.morphInstance._vertexBuffer:y.vertexBuffer,0),L.setIndexBuffer(y.indexBuffer[b]),r+=this.drawInstance(L,v,y,b),this._shadowDrawCalls++}f++,o===n.LIGHTTYPE_DIRECTIONAL&&(s._visibleLength[t]=-1)}if(s._isVsm){var F=s._vsmBlurSize;if(F>1){var B=l.renderTarget,V=c(L,s._shadowResolution,s._shadowType,1),U=s._shadowType===n.SHADOW_VSM8,G=s.vsmBlurMode,W=(U?this.blurPackedVsmShader:this.blurVsmShader)[G][F];if(!W){this.blurVsmWeights[F]=h(F);var z=n.shaderChunks.fullscreenQuadVS,H="#define SAMPLES "+F+"\n";H+=U?this.blurPackedVsmShaderCode[G]:this.blurVsmShaderCode[G];var j="blurVsm"+G+F+U;W=n.shaderChunks.createShaderFromCode(this.device,z,H,j),U?this.blurPackedVsmShader[G][F]=W:this.blurVsmShader[G][F]=W}O.z=s._shadowResolution-2,O.w=O.z,this.sourceId.setValue(B.colorBuffer),x.x=1/s._shadowResolution,x.y=0,this.pixelOffsetId.setValue(x.data),G===n.BLUR_GAUSSIAN&&this.weightId.setValue(this.blurVsmWeights[F]),n.drawQuadWithShader(L,V,W,null,O),this.sourceId.setValue(V.colorBuffer),x.y=x.x,x.x=0,this.pixelOffsetId.setValue(x.data),n.drawQuadWithShader(L,B,W,null,O)}}}L.webgl2?L.setDepthBias(!1):L.extStandardDerivatives&&(this.polygonOffset[0]=0,this.polygonOffset[1]=0,this.polygonOffsetId.setValue(this.polygonOffset))},updateShader:function(e,t,i,n,r){e.material._scene=this.scene,e.material.updateShader(this.device,this.scene,t,i,n,r),e._shader[n]=e.material.shader},renderForward:function(e,t,i,r,s,a,o,h){var l,c,d,u,f,p,_,v,y,g,b,E,T,S,w,C,M,P=this.device,I=this.scene,R=e.vrDisplay,x=1<<s,O=h?h._lightHash:0,k=null,D=.5*P.width;for(l=0;l<i;l++)if(c=t[l],!a||!c.mask||a&c.mask)if(c.command)c.command();else{if(d=c.mesh,u=c.material,f=c._shaderDefs,_=c.mask,this.setSkinning(P,c,u),u&&u===k&&f!==g&&(k=null),(c.isStatic||E)&&(k=null),u!==k){this._materialSwitches++,c._shader[s]&&c._shaderDefs===f&&c._lightHash===O||(c.isStatic?this.updateShader(c,f,c._staticLightList,s,r):(p=s+"_"+f+"_"+O,c._shader[s]=u.variants[p],c._shader[s]||(this.updateShader(c,f,null,s,r),u.variants[p]=c._shader[s])),c._shaderDefs=f,c._lightHash=O),P.setShader(c._shader[s]),w=u.parameters;for(T in w)S=w[T],S.passFlags&x&&(S.scopeId||(S.scopeId=P.scope.resolve(T)),S.scopeId.setValue(S.data));k&&_===b||(y=this.dispatchDirectLights(r[n.LIGHTTYPE_DIRECTIONAL],I,_),this.dispatchLocalLights(r,I,_,y,c._staticLightList)),this.alphaTestId.setValue(u.alphaTest),P.setBlending(u.blend),u.blend&&(u.separateAlphaBlend?(P.setBlendFunctionSeparate(u.blendSrc,u.blendDst,u.blendSrcAlpha,u.blendDstAlpha),P.setBlendEquationSeparate(u.blendEquation,u.blendAlphaEquation)):(P.setBlendFunction(u.blendSrc,u.blendDst),P.setBlendEquation(u.blendEquation))),P.setColorWrite(u.redWrite,u.greenWrite,u.blueWrite,u.alphaWrite),e._cullFaces?e._flipFaces?P.setCullMode(u.cull>0?u.cull===n.CULLFACE_FRONT?n.CULLFACE_BACK:n.CULLFACE_FRONT:0):P.setCullMode(u.cull):P.setCullMode(n.CULLFACE_NONE),P.setDepthWrite(u.depthWrite),P.setDepthTest(u.depthTest),P.setAlphaToCoverage(u.alphaToCoverage),u.depthBias||u.slopeDepthBias?(P.setDepthBias(!0),P.setDepthBiasValues(u.depthBias,u.slopeDepthBias)):P.setDepthBias(!1)}C=c.stencilFront||u.stencilFront,M=c.stencilBack||u.stencilBack,C||M?(P.setStencilTest(!0),C===M?(P.setStencilFunc(C.func,C.ref,C.readMask),P.setStencilOperation(C.fail,C.zfail,C.zpass,C.writeMask)):(C?(P.setStencilFuncFront(C.func,C.ref,C.readMask),P.setStencilOperationFront(C.fail,C.zfail,C.zpass,C.writeMask)):(P.setStencilFuncFront(n.FUNC_ALWAYS,0,255),P.setStencilOperationFront(n.STENCILOP_KEEP,n.STENCILOP_KEEP,n.STENCILOP_KEEPP,255)),M?(P.setStencilFuncBack(M.func,M.ref,M.readMask),P.setStencilOperationBack(M.fail,M.zfail,M.zpass,M.writeMask)):(P.setStencilFuncBack(n.FUNC_ALWAYS,0,255),P.setStencilOperationBack(n.STENCILOP_KEEP,n.STENCILOP_KEEP,n.STENCILOP_KEEP,255)))):P.setStencilTest(!1),w=c.parameters;for(T in w)S=w[T],S.passFlags&x&&(S.scopeId||(S.scopeId=P.scope.resolve(T)),S.scopeId.setValue(S.data));if(P.setVertexBuffer(c.morphInstance&&c.morphInstance._vertexBuffer?c.morphInstance._vertexBuffer:d.vertexBuffer,0),v=c.renderStyle,P.setIndexBuffer(d.indexBuffer[v]),o&&o(c,l),R&&R.presenting?(P.setViewport(0,0,D,P.height),this.projId.setValue(m.data),this.viewInvId.setValue(U.data),this.viewId.setValue(W.data),this.viewId3.setValue(Y.data),this.viewProjId.setValue(Z.data),this.viewPosId.setValue(H.data),l+=this.drawInstance(P,c,d,v,!0),this._forwardDrawCalls++,P.setViewport(D,0,D,P.height),this.projId.setValue(A.data),this.viewInvId.setValue(G.data),this.viewId.setValue(z.data),this.viewId3.setValue(X.data),this.viewProjId.setValue(K.data),this.viewPosId.setValue(j.data),l+=this.drawInstance2(P,c,d,v),this._forwardDrawCalls++):(l+=this.drawInstance(P,c,d,v,!0),this._forwardDrawCalls++),l<i-1&&t[l+1].material===u)for(T in w)S=u.parameters[T],S&&(S.scopeId||(S.scopeId=P.scope.resolve(T)),S.scopeId.setValue(S.data));k=u,g=f,b=_,E=c.isStatic}P.updateEnd()},setupInstancing:function(e){if(!n._instanceVertexFormat){var t=[{semantic:n.SEMANTIC_TEXCOORD2,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_TEXCOORD3,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_TEXCOORD4,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_TEXCOORD5,components:4,type:n.TYPE_FLOAT32}];n._instanceVertexFormat=new n.VertexFormat(e,t)}e.enableAutoInstancing&&(n._autoInstanceBuffer||(n._autoInstanceBuffer=new n.VertexBuffer(e,n._instanceVertexFormat,e.autoInstancingMaxObjects,n.BUFFER_DYNAMIC),n._autoInstanceBufferData=new Float32Array(n._autoInstanceBuffer.lock())))},revertStaticMeshes:function(e){var t,i,n,r=e,s=r.length,a=[];for(t=0;t<s;t++)i=r[t],i._staticSource?i._staticSource!==n&&(a.push(i._staticSource),n=i._staticSource):a.push(i);for(e.length=a.length,t=0;t<a.length;t++)e[t]=a[t]},prepareStaticMeshes:function(e,t){var i,r,s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T,S,w,C,M,P,I,R,x,O,k,D,L,N,F,B,V,U=this.device,G=(this.scene,e),W=G.length,z=[],H=new n.Vec3,j=new n.Vec3,Y=new n.BoundingBox,X=new n.Mat4,Z=[],K=[],Q=[],q=[];for(i=0;i<W;i++)if(l=G[i],l.isStatic){for(F=l.aabb,q.length=0,N=n.LIGHTTYPE_POINT;N<=n.LIGHTTYPE_SPOT;N++)for(r=0;r<t.length;r++)if(c=t[r],c._type===N&&c._enabled&&c._mask&l.mask&&c.isStatic){if(K[r]||(K[r]=new n.BoundingBox,c._node.getWorldTransform(),c.getBoundingSphere(J),K[r].center.copy(J.center),K[r].halfExtents.x=J.radius,K[r].halfExtents.y=J.radius,K[r].halfExtents.z=J.radius),!K[r].intersects(F))continue;q.push(r)}if(0===q.length){z.push(l);continue}for(d=l.mesh,O=d.vertexBuffer,x=d.indexBuffer[l.renderStyle],u=2===x.bytesPerIndex?new Uint16Array(x.lock()):new Uint32Array(x.lock()),p=d.primitive[l.renderStyle].count/3,v=d.primitive[l.renderStyle].base,_=O.format.elements,m=O.format.size/4,f=new Float32Array(O.storage),s=0;s<_.length;s++)_[s].name===n.SEMANTIC_POSITION&&(A=_[s].offset/4);for(Z.length=p,s=0;s<p;s++)Z[s]=0;for(R=!1,Q.length=6*p,s=0;s<p;s++){for(E=Number.MAX_VALUE,T=Number.MAX_VALUE,S=Number.MAX_VALUE,w=-Number.MAX_VALUE,C=-Number.MAX_VALUE,M=-Number.MAX_VALUE,a=0;a<3;a++)h=u[3*s+a+v],h=h*m+A,y=f[h],g=f[h+1],b=f[h+2],y<E&&(E=y),g<T&&(T=g),b<S&&(S=b),y>w&&(w=y),g>C&&(C=g),b>M&&(M=b);h=6*s,Q[h]=E,Q[h+1]=T,Q[h+2]=S,Q[h+3]=w,Q[h+4]=C,Q[h+5]=M}for(o=0;o<q.length;o++)for(r=q[o],c=t[r],X.copy(l.node.worldTransform).invert(),Y.setFromTransformedAabb(K[r],X),P=Y.getMin().data,I=Y.getMax().data,B=1<<o,s=0;s<p;s++)h=6*s,Q[h]<=I[0]&&Q[h+3]>=P[0]&&Q[h+1]<=I[1]&&Q[h+4]>=P[1]&&Q[h+2]<=I[2]&&Q[h+5]>=P[2]&&(Z[s]|=B,R=!0);if(R){for(k={},s=0;s<p;s++)r=3*s+v,D=Z[s],k[D]||(k[D]=[]),L=k[D],L.push(u[r]),L.push(u[r+1]),L.push(u[r+2]);for(D in k){L=k[D];var $=new n.IndexBuffer(U,x.format,L.length,x.usage),ee=2===$.bytesPerIndex?new Uint16Array($.lock()):new Uint32Array($.lock());for(ee.set(L),$.unlock(),E=Number.MAX_VALUE,T=Number.MAX_VALUE,S=Number.MAX_VALUE,w=-Number.MAX_VALUE,C=-Number.MAX_VALUE,M=-Number.MAX_VALUE,s=0;s<L.length;s++)h=L[s],y=f[h*m+A],g=f[h*m+A+1],b=f[h*m+A+2],y<E&&(E=y),g<T&&(T=g),b<S&&(S=b),y>w&&(w=y),g>C&&(C=g),b>M&&(M=b);H.set(E,T,S),j.set(w,C,M);var te=new n.BoundingBox;te.setMinMax(H,j);var ie=new n.Mesh;ie.vertexBuffer=O,ie.indexBuffer[0]=$,ie.primitive[0].type=n.PRIMITIVE_TRIANGLES,ie.primitive[0].base=0,ie.primitive[0].count=L.length,ie.primitive[0].indexed=!0,ie.aabb=te;var ne=new n.MeshInstance(l.node,ie,l.material);for(ne.isStatic=l.isStatic,ne.visible=l.visible,ne.layer=l.layer,ne.castShadow=l.castShadow,ne._receiveShadow=l._receiveShadow,ne.cull=l.cull,ne.pick=l.pick,ne.mask=l.mask,ne.parameters=l.parameters,ne._shaderDefs=l._shaderDefs,ne._staticSource=l,l._staticLightList?ne._staticLightList=l._staticLightList:ne._staticLightList=[],s=0;s<q.length;s++)B=1<<s,D&B&&(V=t[q[s]],ne._staticLightList.indexOf(V)<0&&ne._staticLightList.push(V));ne._staticLightList.sort(this.lightCompare),z.push(ne)}}else z.push(l)}else z.push(l);for(e.length=z.length,i=0;i<z.length;i++)e[i]=z[i]},updateShaders:function(e){var t,i=[];for(t=0;t<e.length;t++){var r=e[t];void 0!==r.material&&i.indexOf(r.material)===-1&&i.push(r.material)}for(t=0;t<i.length;t++){var s=i[t];s.updateShader!==n.Material.prototype.updateShader&&(s.clearVariants(),s.shader=null)}},beginFrame:function(e){var t=this.device,i=this.scene,r=e._meshInstances,s=e._lights;i.updateSkybox&&(i._updateSkybox(t),i.updateSkybox=!1),i.updateShaders&&(this.updateShaders(r),i.updateShaders=!1,i._shaderVersion++),this.updateCpuSkinMatrices(r),this.updateMorphedBounds(r);var a,o=r.length;for(a=0;a<o;a++)r[a].visibleThisFrame=!1;for(o=s.length,a=0;a<o;a++)s[a].visibleThisFrame=s[a]._type===n.LIGHTTYPE_DIRECTIONAL},beginLayers:function(e){var t,i,r,s=this.scene,a=e.layerList.length,o=this.scene._shaderVersion;for(i=0;i<a;i++)e.layerList[i]._postRenderCounter=0;var h;for(i=0;i<a;i++){for(t=e.layerList[i],t._shaderVersion=o,t._preRenderCalledForCameras=0,t._postRenderCalledForCameras=0,h=e.subLayerList[i],h?t._postRenderCounter|=2:t._postRenderCounter|=1,t._postRenderCounterMax=t._postRenderCounter,r=0;r<t.cameras.length;r++)t.instances.visibleOpaque[r]||(t.instances.visibleOpaque[r]=new n.VisibleInstanceList),t.instances.visibleTransparent[r]||(t.instances.visibleTransparent[r]=new n.VisibleInstanceList),t.instances.visibleOpaque[r].done=!1,t.instances.visibleTransparent[r].done=!1;t._needsStaticPrepare&&t._staticLightHash&&(t._staticPrepareDone&&(this.revertStaticMeshes(t.opaqueMeshInstances),this.revertStaticMeshes(t.transparentMeshInstances)),this.prepareStaticMeshes(t.opaqueMeshInstances,t._lights),this.prepareStaticMeshes(t.transparentMeshInstances,t._lights),e._dirty=!0,s.updateShaders=!0,t._needsStaticPrepare=!1,t._staticPrepareDone=!0)}},cullLocalShadowmap:function(e,t){var i,r,s,a,o,h,l,c,d,u,f,p;if(r=e._type,r!==n.LIGHTTYPE_DIRECTIONAL)for(e.visibleThisFrame=!0,s=this.getShadowCamera(this.device,e),s.projection=n.PROJECTION_PERSPECTIVE,s.nearClip=e.attenuationEnd/1e3,s.farClip=e.attenuationEnd,s.aspectRatio=1,r===n.LIGHTTYPE_SPOT?(s.fov=2*e._outerConeAngle,o=1):(s.fov=90,o=6),a=s._node,p=e._node,a.setPosition(p.getPosition()),r===n.LIGHTTYPE_SPOT&&(a.setRotation(p.getRotation()),a.rotateLocal(-90,0,0)),h=0;h<o;h++){for(r===n.LIGHTTYPE_POINT&&(a.setRotation(M[h]),s.renderTarget=e._shadowCubeMap[h]),this.updateCameraFrustum(s),d=e._visibleList[h],d||(d=e._visibleList[h]=[]),e._visibleLength[h]=0,u=0,i=0,l=t.length;i<l;i++)c=t[i],f=!0,c.cull&&(f=this._isVisible(s,c)),f&&(d[u]=c,u++,c.visibleThisFrame=!0);e._visibleLength[h]=u,d.length!==u&&(d.length=u),d.sort(this.depthSortCompare)}},cullDirectionalShadowmap:function(i,r,s,a){var o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T,S,w,C,M,P,I,x=this.device;for(i.visibleThisFrame=!0,h=this.getShadowCamera(x,i),l=h._node,c=i._node,l.setPosition(c.getPosition()),l.setRotation(c.getRotation()),l.rotateLocal(-90,0,0),e(s,i.shadowDistance||s._farClip,ie),d=Q.sub2(ie[0],ie[6]).length(),d=Math.max(d,Q.sub2(ie[4],ie[6]).length()),k.copy(l.getWorldTransform()).invert(),L.copy(k).mul(s._node.worldTransform),o=0;o<8;o++)L.transformPoint(ie[o],ie[o]);for(A=v=y=1e6,g=b=E=-1e6,o=0;o<8;o++)m=ie[o],m.x<A&&(A=m.x),m.x>g&&(g=m.x),m.y<v&&(v=m.y),m.y>b&&(b=m.y),m.z<y&&(y=m.z),m.z>E&&(E=m.z);for(p=d/i._shadowResolution,_=.5*(d-(g-A)),A=Math.floor((A-_)/p)*p,_=.5*(d-(b-v)),v=Math.floor((v-_)/p)*p,g=A+d,b=v+d,T=.5*(g+A),S=.5*(b+v),l.translateLocal(T,S,1e5),h.projection=n.PROJECTION_ORTHOGRAPHIC,h.nearClip=0,h.farClip=2e5,h.aspectRatio=1,h.orthoHeight=.5*d,this.updateCameraFrustum(h),P=!0,f=i._visibleList[a],f||(f=i._visibleList[a]=[]),u=i._visibleLength[a]=0,o=0,C=r.length;o<C;o++)M=r[o],w=!0,M.cull&&(w=this._isVisible(h,M)),w&&(f[u]=M,u++,M.visibleThisFrame=!0,I=M.aabb,P?(q.copy(I),P=!1):q.add(I));i._visibleLength[a]=u,f.length!==u&&(f.length=u),f.sort(this.depthSortCompare);var O=t(k,q.getMin(),q.getMax(),A,g,v,b);E=O.max,O.min>y&&(y=O.min),l.setPosition(c.getPosition()),l.translateLocal(T,S,E+R),h.farClip=E-y;var D=i._visibleCameraSettings[a];D||(D=i._visibleCameraSettings[a]={});var N=l.getPosition().data;D.x=N[0],D.y=N[1],D.z=N[2],D.orthoHeight=h.orthoHeight,D.farClip=h.farClip},gpuUpdate:function(e){this.updateGpuSkinMatrices(e),this.updateMorphing(e)},clearView:function(e,t,i){e=e.camera;var n=this.device;n.setRenderTarget(t),n.updateBegin(),n.setColorWrite(!0,!0,!0,!0),n.setDepthWrite(!0);var r=e.getRect(),s=t?t.width:n.width,a=t?t.height:n.height,o=Math.floor(r.x*s),h=Math.floor(r.y*a),l=Math.floor(r.width*s),c=Math.floor(r.height*a);n.setViewport(o,h,l,c),n.setScissor(o,h,l,c),n.clear(i?i:e._clearOptions)},setSceneConstants:function(){var e,t=this.device,i=this.scene;if(this.dispatchGlobalLights(i),i.fog!==n.FOG_NONE){if(this.fogColor[0]=i.fogColor.data[0],this.fogColor[1]=i.fogColor.data[1],this.fogColor[2]=i.fogColor.data[2],i.gammaCorrection)for(e=0;e<3;e++)this.fogColor[e]=Math.pow(this.fogColor[e],2.2);this.fogColorId.setValue(this.fogColor),i.fog===n.FOG_LINEAR?(this.fogStartId.setValue(i.fogStart),this.fogEndId.setValue(i.fogEnd)):this.fogDensityId.setValue(i.fogDensity)}this._screenSize.x=t.width,this._screenSize.y=t.height,this._screenSize.z=1/t.width,this._screenSize.w=1/t.height,this.screenSizeId.setValue(this._screenSize.data)},renderComposition:function(e){var t,i,r,s,a,o,h,l,c,d,u,f=this.device,p=e._renderedRt,_=e._renderedByCam,m=e._renderedLayer;this.beginLayers(e);var A=e._update();A&n.COMPUPDATED_LIGHTS&&(this.scene.updateShaders=!0),this.beginFrame(e),this.setSceneConstants();var v,y,g,b=0;for(i=0;i<e.layerList.length;i++)if(r=e.layerList[i],r.enabled&&e.subLayerEnabled[i])for(s=e.subLayerList[i],v=r.instances,a=r.cameras,o=0;o<a.length;o++)if(t=a[o]){for(t.frameBegin(r.renderTarget),y=s?r.transparentMeshInstances:r.opaqueMeshInstances,c=!1,d=!1,l=0;l<b;l++)if(_[l]===t&&(c=!0,m[l]===r)){d=!0;break}c||(this.updateCameraFrustum(t.camera),this._camerasRendered++),d||this.cullLights(t.camera,r._lights),c&&d||(_[b]=t,m[b]=r,b++),g=s?v.visibleTransparent[o]:v.visibleOpaque[o],g.done||(r.onPreCull&&r.onPreCull(o),g.length=this.cull(t.camera,y,g.list),g.done=!0,r.onPostCull&&r.onPostCull(o)),t.frameEnd()}var E,T;for(i=0;i<e._lights.length;i++)E=e._lights[i],E.visibleThisFrame&&E._type!==n.LIGHTTYPE_DIRECTIONAL&&E.castShadows&&E._enabled&&E.shadowUpdateMode!==n.SHADOWUPDATE_NONE&&(T=e._lightShadowCasters[i],this.cullLocalShadowmap(E,T));b=0;var S=-1;for(i=0;i<e._lights.length;i++)if(E=e._lights[i],E._type===n.LIGHTTYPE_DIRECTIONAL&&(S++,E.castShadows&&E._enabled&&E.shadowUpdateMode!==n.SHADOWUPDATE_NONE))for(T=e._lightShadowCasters[i],a=e._globalLightCameras[S],o=0;o<a.length;o++)this.cullDirectionalShadowmap(E,T,a[o].camera,e._globalLightCameraIds[S][o]);this.gpuUpdate(e._meshInstances),this.renderShadows(e._sortedLights[n.LIGHTTYPE_SPOT]),this.renderShadows(e._sortedLights[n.LIGHTTYPE_POINT]),b=0;var w;for(i=0;i<e._renderList.length;i++)if(r=e.layerList[e._renderList[i]],r.enabled&&e.subLayerEnabled[e._renderList[i]]){if(v=r.instances,s=e.subLayerList[e._renderList[i]],w=e._renderListCamera[i],t=r.cameras[w],t&&t.frameBegin(r.renderTarget),!s&&r.onPreRenderOpaque?r.onPreRenderOpaque(w):s&&r.onPreRenderTransparent&&r.onPreRenderTransparent(w),r._preRenderCalledForCameras&1<<w||(r.onPreRender&&r.onPreRender(w),r._preRenderCalledForCameras|=1<<w,r.overrideClear&&this.clearView(t,r.renderTarget,r._clearOptions)),t){for(h=r.renderTarget,u=!1,l=0;l<b;l++)if(p[l]===h&&_[l]===t){u=!0;break}u||(r.overrideClear||this.clearView(t,r.renderTarget),p[b]=h,_[b]=t,b++),this.renderShadows(r._sortedLights[n.LIGHTTYPE_DIRECTIONAL],w),r._sortVisible(s,t.node,w),g=s?v.visibleTransparent[w]:v.visibleOpaque[w],this.scene._activeCamera=t.camera,this.setCamera(t.camera,r.renderTarget),this.renderForward(t.camera,g.list,g.length,r._sortedLights,r.shaderPass,r.cullingMask,r.onDrawCall,r),f.setColorWrite(!0,!0,!0,!0),f.setStencilTest(!1),f.setAlphaToCoverage(!1),f.setDepthBias(!1),t.frameEnd()}!s&&r.onPostRenderOpaque?r.onPostRenderOpaque(w):s&&r.onPostRenderTransparent&&r.onPostRenderTransparent(w),!r.onPostRender||r._postRenderCalledForCameras&1<<w||(r._postRenderCounter&=~(s?2:1),0===r._postRenderCounter&&(r.onPostRender(w),r._postRenderCalledForCameras|=1<<w,r._postRenderCounter=r._postRenderCounterMax))}}}),{ForwardRenderer:f,gaussWeights:h}}()),Object.assign(n,function(){var e=new n.Mat4,t=new n.Vec3,i=new n.Quat,r=new n.Quat,s=new n.Vec3,a=new n.Vec3,o=function(e){this.name="string"==typeof e?e:"Untitled",this.tags=new n.Tags(this),this._labels={},this.localPosition=new n.Vec3(0,0,0),this.localRotation=new n.Quat(0,0,0,1),this.localScale=new n.Vec3(1,1,1),this.localEulerAngles=new n.Vec3(0,0,0),this.position=new n.Vec3(0,0,0),this.rotation=new n.Quat(0,0,0,1),this.eulerAngles=new n.Vec3(0,0,0),this.localTransform=new n.Mat4,this._dirtyLocal=!1,this._aabbVer=0,this.worldTransform=new n.Mat4,this._dirtyWorld=!1,this.normalMatrix=new n.Mat3,this._dirtyNormal=!0,this._right=new n.Vec3,this._up=new n.Vec3,this._forward=new n.Vec3,this._parent=null,this._children=[],this._graphDepth=0,this._enabled=!0,this._enabledInHierarchy=!1,this.scaleCompensation=!1};return Object.defineProperty(o.prototype,"right",{get:function(){return this.getWorldTransform().getX(this._right).normalize()}}),Object.defineProperty(o.prototype,"up",{get:function(){return this.getWorldTransform().getY(this._up).normalize()}}),Object.defineProperty(o.prototype,"forward",{get:function(){return this.getWorldTransform().getZ(this._forward).normalize().scale(-1)}}),Object.defineProperty(o.prototype,"enabled",{get:function(){return this._enabled&&this._enabledInHierarchy},set:function(e){this._enabled!==e&&(this._enabled=e,this._parent&&!this._parent.enabled||this._notifyHierarchyStateChanged(this,e))}}),Object.defineProperty(o.prototype,"parent",{get:function(){return this._parent}}),Object.defineProperty(o.prototype,"root",{get:function(){var e=this._parent;if(!e)return this;for(;e._parent;)e=e._parent;return e}}),Object.defineProperty(o.prototype,"children",{get:function(){return this._children}}),Object.defineProperty(o.prototype,"graphDepth",{get:function(){return this._graphDepth}}),Object.assign(o.prototype,{_notifyHierarchyStateChanged:function(e,t){e._onHierarchyStateChanged(t);for(var i=e._children,n=0,r=i.length;n<r;n++)i[n]._enabled&&this._notifyHierarchyStateChanged(i[n],t)},_onHierarchyStateChanged:function(e){this._enabledInHierarchy=e},_cloneInternal:function(e){e.name=this.name;for(var t=this.tags._list,i=0;i<t.length;i++)e.tags.add(t[i]);e._labels=Object.assign({},this._labels),e.localPosition.copy(this.localPosition),e.localRotation.copy(this.localRotation),e.localScale.copy(this.localScale),e.localEulerAngles.copy(this.localEulerAngles),e.position.copy(this.position),e.rotation.copy(this.rotation),e.eulerAngles.copy(this.eulerAngles),e.localTransform.copy(this.localTransform),e._dirtyLocal=this._dirtyLocal,e.worldTransform.copy(this.worldTransform),e._dirtyWorld=this._dirtyWorld,e._dirtyNormal=this._dirtyNormal,e._aabbVer=this._aabbVer+1,e._enabled=this._enabled,e.scaleCompensation=this.scaleCompensation,e._enabledInHierarchy=!1},clone:function(){var e=new n.GraphNode;return this._cloneInternal(e),e},find:function(e,t){var i,n,r=[],s=this._children.length;if(e instanceof Function){var a=e;for(i=0;i<s;i++)a(this._children[i])&&r.push(this._children[i]),n=this._children[i].find(a),n.length&&(r=r.concat(n))}else{var o;for(this[e]&&(o=this[e]instanceof Function?this[e]():this[e],o===t&&r.push(this)),i=0;i<s;++i)n=this._children[i].find(e,t),n.length&&(r=r.concat(n))}return r},findOne:function(e,t){var i,n=this._children.length,r=null;if(e instanceof Function){var s=e;if(r=s(this))return this;for(i=0;i<n;i++)if(r=this._children[i].findOne(s))return this._children[i]}else{var a;if(this[e]&&(a=this[e]instanceof Function?this[e]():this[e],a===t))return this;for(i=0;i<n;i++)if(r=this._children[i].findOne(e,t),null!==r)return r}return null},findByTag:function(){var e=this.tags._processArguments(arguments);return this._findByTag(e)},_findByTag:function(e){var t,i,n=[],r=this._children.length;for(t=0;t<r;t++)this._children[t].tags._has(e)&&n.push(this._children[t]),i=this._children[t]._findByTag(e),i.length&&(n=n.concat(i));return n},findByName:function(e){if(this.name===e)return this;for(var t=0;t<this._children.length;t++){var i=this._children[t].findByName(e);if(null!==i)return i}return null},findByPath:function(e){for(var t=e.split("/"),i=this,n=null,r=0,s=t.length;r<s&&i;r++){var a=t[r];n=null;for(var o=i._children,h=0,l=o.length;h<l;h++)if(o[h].name==a){n=o[h];break}i=n}return n},getPath:function(){var e=this._parent;if(e){for(var t=this.name,i="{0}/{1}";e&&e._parent;)t=n.string.format(i,e.name,t),e=e._parent;return t}return""},getRoot:function(){var e=this._parent;if(!e)return this;for(;e._parent;)e=e._parent;return e},getParent:function(){return this._parent},isDescendantOf:function(e){for(var t=this._parent;t;){if(t===e)return!0;t=t._parent}return!1},isAncestorOf:function(e){return e.isDescendantOf(this)},getChildren:function(){return this._children},getEulerAngles:function(){return this.getWorldTransform().getEulerAngles(this.eulerAngles),this.eulerAngles},getLocalEulerAngles:function(){return this.localRotation.getEulerAngles(this.localEulerAngles),this.localEulerAngles},getLocalPosition:function(){return this.localPosition},getLocalRotation:function(){return this.localRotation},getLocalScale:function(){return this.localScale},getLocalTransform:function(){return this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this.localTransform},getName:function(){return this.name},getPosition:function(){return this.getWorldTransform().getTranslation(this.position),this.position},getRotation:function(){return this.rotation.setFromMat4(this.getWorldTransform()),this.rotation},getWorldTransform:function(){return this._dirtyLocal||this._dirtyWorld?(this._parent&&this._parent.getWorldTransform(),this._sync(),this.worldTransform):this.worldTransform},reparent:function(e,t){var i=this._parent;i&&i.removeChild(this),e&&(t>=0?e.insertChild(this,t):e.addChild(this))},setLocalEulerAngles:function(e,t,i){e instanceof n.Vec3?this.localRotation.setFromEulerAngles(e.data[0],e.data[1],e.data[2]):this.localRotation.setFromEulerAngles(e,t,i),this._dirtyLocal||this._dirtify(!0)},setLocalPosition:function(e,t,i){e instanceof n.Vec3?this.localPosition.copy(e):this.localPosition.set(e,t,i),this._dirtyLocal||this._dirtify(!0)},setLocalRotation:function(e,t,i,r){e instanceof n.Quat?this.localRotation.copy(e):this.localRotation.set(e,t,i,r),this._dirtyLocal||this._dirtify(!0)},setLocalScale:function(e,t,i){e instanceof n.Vec3?this.localScale.copy(e):this.localScale.set(e,t,i),this._dirtyLocal||this._dirtify(!0)},setName:function(e){this.name=e},_dirtify:function(e){if(!(!e||e&&this._dirtyLocal)||!this._dirtyWorld){if(e&&(this._dirtyLocal=!0),!this._dirtyWorld){this._dirtyWorld=!0;for(var t=this._children.length;t--;)this._children[t]._dirtyWorld||this._children[t]._dirtify()}this._dirtyNormal=!0,this._aabbVer++}},setPosition:function(){var e=new n.Vec3,t=new n.Mat4;return function(i,r,s){i instanceof n.Vec3?e.copy(i):e.set(i,r,s),null===this._parent?this.localPosition.copy(e):(t.copy(this._parent.getWorldTransform()).invert(),t.transformPoint(e,this.localPosition)),this._dirtyLocal||this._dirtify(!0)}}(),setRotation:function(){var e=new n.Quat,t=new n.Quat;return function(i,r,s,a){if(i instanceof n.Quat?e.copy(i):e.set(i,r,s,a),null===this._parent)this.localRotation.copy(e);else{var o=this._parent.getRotation();t.copy(o).invert(),this.localRotation.copy(t).mul(e)}this._dirtyLocal||this._dirtify(!0)}}(),setEulerAngles:function(){var e=new n.Quat;return function(t,i,r){if(t instanceof n.Vec3?this.localRotation.setFromEulerAngles(t.data[0],t.data[1],t.data[2]):this.localRotation.setFromEulerAngles(t,i,r),null!==this._parent){var s=this._parent.getRotation();e.copy(s).invert(),this.localRotation.mul2(e,this.localRotation)}this._dirtyLocal||this._dirtify(!0)}}(),addChild:function(e){if(null!==e._parent)throw new Error("GraphNode is already parented");this._children.push(e),this._onInsertChild(e)},addChildAndSaveTransform:function(e){var t=e.getPosition(),i=e.getRotation(),r=e._parent;r&&r.removeChild(e),void 0===this.tmpMat4&&(this.tmpMat4=new n.Mat4,this.tmpQuat=new n.Quat),e.setPosition(this.tmpMat4.copy(this.worldTransform).invert().transformPoint(t)),e.setRotation(this.tmpQuat.copy(this.getRotation()).invert().mul(i)),this._children.push(e),this._onInsertChild(e)},insertChild:function(e,t){if(null!==e._parent)throw new Error("GraphNode is already parented");this._children.splice(t,0,e),this._onInsertChild(e)},_onInsertChild:function(e){e._parent=this;var t=e._enabled&&this.enabled;e._enabledInHierarchy!==t&&(e._enabledInHierarchy=t,e._notifyHierarchyStateChanged(e,t)),e._updateGraphDepth(),e._dirtify(),e.fire&&e.fire("insert",this),this.fire&&this.fire("childinsert",e)},_updateGraphDepth:function(){this._parent?this._graphDepth=this._parent._graphDepth+1:this._graphDepth=0;for(var e=0,t=this._children.length;e<t;e++)this._children[e]._updateGraphDepth()},removeChild:function(e){var t,i=this._children.length;for(t=0;t<i;++t)if(this._children[t]===e)return this._children.splice(t,1),e._parent=null,void(this.fire&&this.fire("childremove",e))},addLabel:function(e){this._labels[e]=!0},getLabels:function(){return Object.keys(this._labels)},hasLabel:function(e){return!!this._labels[e]},removeLabel:function(e){delete this._labels[e]},findByLabel:function(e,t){var i,n=this._children.length;for(t=t||[],this.hasLabel(e)&&t.push(this),i=0;i<n;++i)t=this._children[i].findByLabel(e,t);return t},_sync:function(){if(this._dirtyLocal&&(this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale),this._dirtyLocal=!1),this._dirtyWorld){if(null===this._parent)this.worldTransform.copy(this.localTransform);else if(this.scaleCompensation){var n,o=this._parent,h=this.localScale,l=o;if(l){for(;l&&l.scaleCompensation;)l=l._parent;l&&(l=l._parent,l&&(n=l.worldTransform.getScale(),s.mul2(n,this.localScale),h=s))}r.setFromMat4(o.worldTransform),i.mul2(r,this.localRotation);var c=o.worldTransform;o.scaleCompensation&&(a.mul2(n,o.getLocalScale()),e.setTRS(o.worldTransform.getTranslation(t),r,a),c=e),c.transformPoint(this.localPosition,t),this.worldTransform.setTRS(t,i,h)}else this.worldTransform.mul2(this._parent.worldTransform,this.localTransform);this._dirtyWorld=!1}},syncHierarchy:function(){if(this._enabled){(this._dirtyLocal||this._dirtyWorld)&&this._sync();for(var e=this._children,t=0,i=e.length;t<i;t++)e[t].syncHierarchy()}},lookAt:function(){var e=new n.Mat4,t=new n.Vec3,i=new n.Vec3,r=new n.Quat;return function(s,a,o,h,l,c){if(s instanceof n.Vec3)t.copy(s),a instanceof n.Vec3?i.copy(a):i.copy(n.Vec3.UP);else{if(void 0===o)return;t.set(s,a,o),void 0!==h?i.set(h,l,c):i.copy(n.Vec3.UP)}e.setLookAt(this.getPosition(),t,i),r.setFromMat4(e),this.setRotation(r)}}(),translate:function(){var e=new n.Vec3;return function(t,i,r){t instanceof n.Vec3?e.copy(t):e.set(t,i,r),e.add(this.getPosition()),this.setPosition(e)}}(),translateLocal:function(){var e=new n.Vec3;return function(t,i,r){t instanceof n.Vec3?e.copy(t):e.set(t,i,r),this.localRotation.transformVector(e,e),this.localPosition.add(e),this._dirtyLocal||this._dirtify(!0)}}(),rotate:function(){var e=new n.Quat,t=new n.Quat;return function(i,r,s){if(i instanceof n.Vec3?e.setFromEulerAngles(i.data[0],i.data[1],i.data[2]):e.setFromEulerAngles(i,r,s),null===this._parent)this.localRotation.mul2(e,this.localRotation);else{var a=this.getRotation(),o=this._parent.getRotation();t.copy(o).invert(),e.mul2(t,e),this.localRotation.mul2(e,a)}this._dirtyLocal||this._dirtify(!0)}}(),rotateLocal:function(){var e=new n.Quat;return function(t,i,r){t instanceof n.Vec3?e.setFromEulerAngles(t.data[0],t.data[1],t.data[2]):e.setFromEulerAngles(t,i,r),this.localRotation.mul(e),this._dirtyLocal||this._dirtify(!0)}}()}),{GraphNode:o}}()),Object.assign(n,function(){var e=new n.Vec3,t=new n.Vec3,i=new n.Vec3,r=new n.Mat4,s=function(){this._projection=n.PROJECTION_PERSPECTIVE,this._nearClip=.1,this._farClip=1e4,this._shaderParams=new n.Vec4,this._fov=45,this._orthoHeight=10,this._aspect=16/9,this._aspectRatioMode=n.ASPECT_AUTO,this._horizontalFov=!1,this.frustumCulling=!1,this.cullingMask=4294967295,this._renderDepthRequests=0,this._projMatDirty=!0,this._projMat=new n.Mat4,this._viewMat=new n.Mat4,this._viewProjMat=new n.Mat4,this.vrDisplay=null,this._rect={x:0,y:0,width:1,height:1},this._scissorRect={x:0,y:0,width:1,height:1},this.frustum=new n.Frustum(this._projMat,this._viewMat),this.renderTarget=null,this._depthTarget=null,this._clearOptions={color:[.5,.5,.5,1],depth:1,stencil:0,flags:n.CLEARFLAG_COLOR|n.CLEARFLAG_DEPTH|n.CLEARFLAG_STENCIL},this._node=null,this.calculateTransform=null,this.overrideCalculateTransform=!1,this.calculateProjection=null,this.overrideCalculateProjection=!1,this._cullFaces=!0,this._flipFaces=!1,this._component=null};return Object.assign(s.prototype,{clone:function(){var e=new n.Camera;return e.projection=this._projection,e.nearClip=this._nearClip,e.farClip=this._farClip,e._shaderParams=this._shaderParams.clone(),e.fov=this._fov,e.aspectRatio=this._aspect,e._aspectRatioMode=this._aspectRatioMode,e.renderTarget=this.renderTarget,e.setClearOptions(this.getClearOptions()),e.frustumCulling=this.frustumCulling,e.cullingMask=this.cullingMask,e},worldToScreen:function(e,t,i,r){void 0===r&&(r=new n.Vec3);var s=this.getProjectionMatrix(),a=this._node.getWorldTransform();this._viewMat.copy(a).invert(),this._viewProjMat.mul2(s,this._viewMat),this._viewProjMat.transformPoint(e,r);var o=e.data,h=this._viewProjMat.data,l=o[0]*h[3]+o[1]*h[7]+o[2]*h[11]+1*h[15];return r.x=.5*(r.x/l+1)*t,r.y=.5*(1-r.y/l)*i,r},screenToWorld:function(s,a,o,h,l,c){void 0===c&&(c=new n.Vec3);var d=this.getProjectionMatrix(),u=this._node.getWorldTransform();if(this._viewMat.copy(u).invert(),this._viewProjMat.mul2(d,this._viewMat),r.copy(this._viewProjMat).invert(),this._projection===n.PROJECTION_PERSPECTIVE){t.set(s/h*2-1,(l-a)/l*2-1,1),r.transformPoint(t,i);var f=t.x*r.data[3]+t.y*r.data[7]+t.z*r.data[11]+r.data[15];
i.scale(1/f);var p=o/this._farClip;c.lerp(this._node.getPosition(),i,p)}else{var _=this._farClip-this._nearClip;e.set(s/h,(l-a)/l,o/_),e.scale(2),e.sub(n.Vec3.ONE),r.transformPoint(e,c)}return c},getClearOptions:function(){return this._clearOptions},getProjectionMatrix:function(){if(this._projMatDirty){if(this._projection===n.PROJECTION_PERSPECTIVE)this._projMat.setPerspective(this._fov,this._aspect,this._nearClip,this._farClip,this._horizontalFov);else{var e=this._orthoHeight,t=e*this._aspect;this._projMat.setOrtho(-t,t,-e,e,this._nearClip,this._farClip)}var i=this._nearClip,r=this._farClip;this._shaderParams.x=1/r,this._shaderParams.y=r,this._shaderParams.z=(1-r/i)/2,this._shaderParams.w=(1+r/i)/2,this._projMatDirty=!1}return this._projMat},getRect:function(){return this._rect},setClearOptions:function(e){this._clearOptions.color[0]=e.color[0],this._clearOptions.color[1]=e.color[1],this._clearOptions.color[2]=e.color[2],this._clearOptions.color[3]=e.color[3],this._clearOptions.depth=e.depth,this._clearOptions.stencil=e.stencil,this._clearOptions.flags=e.flags},setRect:function(e,t,i,n){this._rect.x=e,this._rect.y=t,this._rect.width=i,this._rect.height=n},setScissorRect:function(e,t,i,n){this._scissorRect.x=e,this._scissorRect.y=t,this._scissorRect.width=i,this._scissorRect.height=n},requestDepthMap:function(){this._renderDepthRequests++},releaseDepthMap:function(){this._renderDepthRequests--}}),Object.defineProperty(s.prototype,"aspectRatio",{get:function(){return this._aspect},set:function(e){this._aspect!==e&&(this._aspect=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"projection",{get:function(){return this._projection},set:function(e){this._projection!==e&&(this._projection=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"nearClip",{get:function(){return this._nearClip},set:function(e){this._nearClip!==e&&(this._nearClip=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"farClip",{get:function(){return this._farClip},set:function(e){this._farClip!==e&&(this._farClip=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"fov",{get:function(){return this._fov},set:function(e){this._fov!==e&&(this._fov=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"horizontalFov",{get:function(){return this._horizontalFov},set:function(e){this._horizontalFov!==e&&(this._horizontalFov=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"orthoHeight",{get:function(){return this._orthoHeight},set:function(e){this._orthoHeight!==e&&(this._orthoHeight=e,this._projMatDirty=!0)}}),Object.defineProperty(s.prototype,"clearColor",{get:function(){return this._clearOptions.color},set:function(e){this._clearOptions.color[0]=e[0],this._clearOptions.color[1]=e[1],this._clearOptions.color[2]=e[2],this._clearOptions.color[3]=e[3]}}),Object.defineProperty(s.prototype,"clearDepth",{get:function(){return this._clearOptions.depth},set:function(e){this._clearOptions.depth=e}}),Object.defineProperty(s.prototype,"clearStencil",{get:function(){return this._clearOptions.stencil},set:function(e){this._clearOptions.stencil=e}}),Object.defineProperty(s.prototype,"clearFlags",{get:function(){return this._clearOptions.flags},set:function(e){this._clearOptions.flags=e}}),{Camera:s}}()),Object.assign(n,function(){var e=new n.Vec3,t=new n.Vec3,i=new n.Vec3,r={r:0,g:1,b:2,a:3},s=function(){this._type=n.LIGHTTYPE_DIRECTIONAL,this._color=new n.Color(.8,.8,.8),this._intensity=1,this._castShadows=!1,this._enabled=!1,this._mask=1,this.isStatic=!1,this.key=0,this.bakeDir=!0,this.attenuationStart=10,this.attenuationEnd=10,this._falloffMode=0,this._shadowType=n.SHADOW_PCF3,this._vsmBlurSize=11,this.vsmBlurMode=n.BLUR_GAUSSIAN,this.vsmBias=.0025,this._cookie=null,this.cookieIntensity=1,this._cookieFalloff=!0,this._cookieChannel="rgb",this._cookieTransform=null,this._cookieOffset=null,this._cookieTransformSet=!1,this._cookieOffsetSet=!1,this._innerConeAngle=40,this._outerConeAngle=45,this._finalColor=new n.Vec3(.8,.8,.8);var e=Math.pow(this._finalColor.data[0],2.2);this._linearFinalColor=new n.Vec3(e,e,e),this._position=new n.Vec3(0,0,0),this._direction=new n.Vec3(0,0,0),this._innerConeAngleCos=Math.cos(this._innerConeAngle*Math.PI/180),this._outerConeAngleCos=Math.cos(this._outerConeAngle*Math.PI/180),this._shadowCamera=null,this._shadowMatrix=new n.Mat4,this.shadowDistance=40,this._shadowResolution=1024,this.shadowBias=-5e-4,this._normalOffsetBias=0,this.shadowUpdateMode=n.SHADOWUPDATE_REALTIME,this._scene=null,this._node=null,this._rendererParams=[],this._isVsm=!1,this._isPcf=!0,this._cacheShadowMap=!1,this._isCachedShadowMap=!1,this._visibleLength=[0],this._visibleList=[[]],this._visibleCameraSettings=[]};return Object.assign(s.prototype,{destroy:function(){this._destroyShadowMap()},clone:function(){var e=new n.Light;return e.type=this._type,e.setColor(this._color),e.intensity=this._intensity,e.castShadows=this.castShadows,e.enabled=this._enabled,e.attenuationStart=this.attenuationStart,e.attenuationEnd=this.attenuationEnd,e.falloffMode=this._falloffMode,e.shadowType=this._shadowType,e.vsmBlurSize=this._vsmBlurSize,e.vsmBlurMode=this.vsmBlurMode,e.vsmBias=this.vsmBias,e.shadowUpdateMode=this.shadowUpdateMode,e.mask=this._mask,e.innerConeAngle=this._innerConeAngle,e.outerConeAngle=this._outerConeAngle,e.shadowBias=this.shadowBias,e.normalOffsetBias=this._normalOffsetBias,e.shadowResolution=this._shadowResolution,e.shadowDistance=this.shadowDistance,e},getColor:function(){return this._color},getBoundingSphere:function(r){if(this._type===n.LIGHTTYPE_SPOT){var s=this.attenuationEnd,a=this._outerConeAngle,o=Math.cos(a*n.math.DEG_TO_RAD),h=this._node;e.copy(h.up),e.scale(.5*-s*o),e.add(h.getPosition()),r.center=e,t.copy(h.up),t.scale(-s),i.copy(h.right),i.scale(Math.sin(a*n.math.DEG_TO_RAD)*s),t.add(i),r.radius=.5*t.length()}else this._type===n.LIGHTTYPE_POINT&&(r.center=this._node.getPosition(),r.radius=this.attenuationEnd)},getBoundingBox:function(e){if(this._type===n.LIGHTTYPE_SPOT){var t=this.attenuationEnd,i=this._outerConeAngle,r=this._node,s=Math.abs(Math.sin(i*n.math.DEG_TO_RAD)*t);e.center.set(0,.5*-t,0),e.halfExtents.set(s,.5*t,s),e.setFromTransformedAabb(e,r.getWorldTransform())}else this._type===n.LIGHTTYPE_POINT&&(e.center.copy(this._node.getPosition()),e.halfExtents.set(this.attenuationEnd,this.attenuationEnd,this.attenuationEnd))},setColor:function(){var e,t,i;1===arguments.length?(e=arguments[0].r,t=arguments[0].g,i=arguments[0].b):3===arguments.length&&(e=arguments[0],t=arguments[1],i=arguments[2]),this._color.set(e,t,i);var n=this._intensity;this._finalColor.set(e*n,t*n,i*n);for(var r=0;r<3;r++)n>=1?this._linearFinalColor.data[r]=Math.pow(this._finalColor.data[r]/n,2.2)*n:this._linearFinalColor.data[r]=Math.pow(this._finalColor.data[r],2.2)},_destroyShadowMap:function(){if(this._shadowCamera){if(!this._isCachedShadowMap){var e,t=this._shadowCamera.renderTarget;if(t)if(t.length)for(e=0;e<t.length;e++)t[e].colorBuffer&&t[e].colorBuffer.destroy(),t[e].destroy();else t.colorBuffer&&t.colorBuffer.destroy(),t.depthBuffer&&t.depthBuffer.destroy(),t.destroy()}this._shadowCamera.renderTarget=null,this._shadowCamera=null,this._shadowCubeMap=null,this.shadowUpdateMode===n.SHADOWUPDATE_NONE&&(this.shadowUpdateMode=n.SHADOWUPDATE_THISFRAME)}},updateShadow:function(){this.shadowUpdateMode!==n.SHADOWUPDATE_REALTIME&&(this.shadowUpdateMode=n.SHADOWUPDATE_THISFRAME)},updateKey:function(){var e=this._type<<29|(this._castShadows?1:0)<<28|this._shadowType<<25|this._falloffMode<<23|(0!==this._normalOffsetBias?1:0)<<22|(this._cookie?1:0)<<21|(this._cookieFalloff?1:0)<<20|r[this._cookieChannel.charAt(0)]<<18|(this._cookieTransform?1:0)<<12;3===this._cookieChannel.length&&(e|=r[this._cookieChannel.charAt(1)]<<16,e|=r[this._cookieChannel.charAt(2)]<<14),this.key=e}}),Object.defineProperty(s.prototype,"enabled",{get:function(){return this._type},set:function(e){this._type!==e&&(this._enabled=e,null!==this._scene&&(this._scene.updateShaders=!0))}}),Object.defineProperty(s.prototype,"type",{get:function(){return this._type},set:function(e){if(this._type!==e){this._type=e,this._destroyShadowMap(),null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey();var t=this._shadowType;this._shadowType=null,this.shadowType=t,null!==this._scene&&(this._scene.layers._dirtyLights=!0)}}}),Object.defineProperty(s.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,null!==this._scene&&(this._scene.updateShaders=!0))}}),Object.defineProperty(s.prototype,"shadowType",{get:function(){return this._shadowType},set:function(e){if(this._shadowType!==e){var t=n.Application.getApplication().graphicsDevice;this._type===n.LIGHTTYPE_POINT&&(e=n.SHADOW_PCF3),e!==n.SHADOW_PCF5||t.webgl2||(e=n.SHADOW_PCF3),e!==n.SHADOW_VSM32||t.extTextureFloatRenderable||(e=n.SHADOW_VSM16),e!==n.SHADOW_VSM16||t.extTextureHalfFloatRenderable||(e=n.SHADOW_VSM8),this._isVsm=e>=n.SHADOW_VSM8&&e<=n.SHADOW_VSM32,this._isPcf=e===n.SHADOW_PCF5||e===n.SHADOW_PCF3,this._shadowType=e,this._destroyShadowMap(),null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey()}}}),Object.defineProperty(s.prototype,"castShadows",{get:function(){return this._castShadows&&this._mask!==n.MASK_LIGHTMAP&&0!==this._mask},set:function(e){this._castShadows!==e&&(this._castShadows=e,null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey())}}),Object.defineProperty(s.prototype,"shadowResolution",{get:function(){return this._shadowResolution},set:function(e){if(this._shadowResolution!==e){var t=n.Application.getApplication().graphicsDevice;e=this._type===n.LIGHTTYPE_POINT?Math.min(e,t.maxCubeMapSize):Math.min(e,t.maxTextureSize),this._shadowResolution=e}}}),Object.defineProperty(s.prototype,"vsmBlurSize",{get:function(){return this._vsmBlurSize},set:function(e){this._vsmBlurSize!==e&&(e%2===0&&e++,this._vsmBlurSize=e)}}),Object.defineProperty(s.prototype,"normalOffsetBias",{get:function(){return this._normalOffsetBias},set:function(e){this._normalOffsetBias!==e&&((!this._normalOffsetBias&&e||this._normalOffsetBias&&!e)&&(null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey()),this._normalOffsetBias=e)}}),Object.defineProperty(s.prototype,"falloffMode",{get:function(){return this._falloffMode},set:function(e){this._falloffMode!==e&&(this._falloffMode=e,null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey())}}),Object.defineProperty(s.prototype,"innerConeAngle",{get:function(){return this._innerConeAngle},set:function(e){this._innerConeAngle!==e&&(this._innerConeAngle=e,this._innerConeAngleCos=Math.cos(e*Math.PI/180))}}),Object.defineProperty(s.prototype,"outerConeAngle",{get:function(){return this._outerConeAngle},set:function(e){this._outerConeAngle!==e&&(this._outerConeAngle=e,this._outerConeAngleCos=Math.cos(e*Math.PI/180))}}),Object.defineProperty(s.prototype,"intensity",{get:function(){return this._intensity},set:function(e){if(this._intensity!==e){this._intensity=e;var t=this._color.data,i=t[0],n=t[1],r=t[2],s=this._intensity;this._finalColor.set(i*s,n*s,r*s);for(var a=0;a<3;a++)s>=1?this._linearFinalColor.data[a]=Math.pow(this._finalColor.data[a]/s,2.2)*s:this._linearFinalColor.data[a]=Math.pow(this._finalColor.data[a],2.2)}}}),Object.defineProperty(s.prototype,"cookie",{get:function(){return this._cookie},set:function(e){this._cookie!==e&&(this._cookie=e,null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey())}}),Object.defineProperty(s.prototype,"cookieFalloff",{get:function(){return this._cookieFalloff},set:function(e){this._cookieFalloff!==e&&(this._cookieFalloff=e,null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey())}}),Object.defineProperty(s.prototype,"cookieChannel",{get:function(){return this._cookieChannel},set:function(e){if(this._cookieChannel!==e){if(e.length<3)for(var t=e.charAt(e.length-1),i=3-e.length,n=0;n<i;n++)e+=t;this._cookieChannel=e,null!==this._scene&&(this._scene.updateShaders=!0),this.updateKey()}}}),Object.defineProperty(s.prototype,"cookieTransform",{get:function(){return this._cookieTransform},set:function(e){if(this._cookieTransform!==e){var t=!(!this._cookieTransformSet&&!this._cookieOffsetSet),i=!(!e&&!this._cookieOffsetSet);t!==i&&null!==this._scene&&(this._scene.updateShaders=!0),this._cookieTransform=e,this._cookieTransformSet=!!e,e&&!this._cookieOffset&&(this.cookieOffset=new n.Vec2,this._cookieOffsetSet=!1),this.updateKey()}}}),Object.defineProperty(s.prototype,"cookieOffset",{get:function(){return this._cookieOffset},set:function(e){if(this._cookieOffset!==e){var t=!(!this._cookieTransformSet&&!this._cookieOffsetSet),i=!(!this._cookieTransformSet&&!e);t!==i&&null!==this._scene&&(this._scene.updateShaders=!0),i&&!e&&this._cookieOffset?this._cookieOffset.set(0,0):this._cookieOffset=e,this._cookieOffsetSet=!!e,e&&!this._cookieTransform&&(this.cookieTransform=new n.Vec4(1,1,0,0),this._cookieTransformSet=!1),this.updateKey()}}}),{Light:s}}()),Object.assign(n,function(){var e=0,t=function(){this.name="Untitled",this.id=e++,this._shader=null,this.variants={},this.parameters={},this.alphaTest=0,this.alphaToCoverage=!1,this.blend=!1,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ZERO,this.blendEquation=n.BLENDEQUATION_ADD,this.separateAlphaBlend=!1,this.blendSrcAlpha=n.BLENDMODE_ONE,this.blendDstAlpha=n.BLENDMODE_ZERO,this.blendAlphaEquation=n.BLENDEQUATION_ADD,this.cull=n.CULLFACE_BACK,this.depthTest=!0,this.depthWrite=!0,this.stencilFront=null,this.stencilBack=null,this.depthBias=0,this.slopeDepthBias=0,this.redWrite=!0,this.greenWrite=!0,this.blueWrite=!0,this.alphaWrite=!0,this.meshInstances=[],this._shaderVersion=0,this._scene=null,this._dirtyBlend=!1};return Object.defineProperty(t.prototype,"shader",{get:function(){return this._shader},set:function(e){this.setShader(e)}}),Object.defineProperty(t.prototype,"blendType",{get:function(){return this.blend||this.blendSrc!==n.BLENDMODE_ONE||this.blendDst!==n.BLENDMODE_ZERO||this.blendEquation!==n.BLENDEQUATION_ADD?this.blend&&this.blendSrc===n.BLENDMODE_SRC_ALPHA&&this.blendDst===n.BLENDMODE_ONE_MINUS_SRC_ALPHA&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_NORMAL:this.blend&&this.blendSrc===n.BLENDMODE_ONE&&this.blendDst===n.BLENDMODE_ONE&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_ADDITIVE:this.blend&&this.blendSrc===n.BLENDMODE_SRC_ALPHA&&this.blendDst===n.BLENDMODE_ONE&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_ADDITIVEALPHA:this.blend&&this.blendSrc===n.BLENDMODE_DST_COLOR&&this.blendDst===n.BLENDMODE_SRC_COLOR&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_MULTIPLICATIVE2X:this.blend&&this.blendSrc===n.BLENDMODE_ONE_MINUS_DST_COLOR&&this.blendDst===n.BLENDMODE_ONE&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_SCREEN:this.blend&&this.blendSrc===n.BLENDMODE_ONE&&this.blendDst===n.BLENDMODE_ONE&&this.blendEquation===n.BLENDEQUATION_MIN?n.BLEND_MIN:this.blend&&this.blendSrc===n.BLENDMODE_ONE&&this.blendDst===n.BLENDMODE_ONE&&this.blendEquation===n.BLENDEQUATION_MAX?n.BLEND_MAX:this.blend&&this.blendSrc===n.BLENDMODE_DST_COLOR&&this.blendDst===n.BLENDMODE_ZERO&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_MULTIPLICATIVE:this.blend&&this.blendSrc===n.BLENDMODE_ONE&&this.blendDst===n.BLENDMODE_ONE_MINUS_SRC_ALPHA&&this.blendEquation===n.BLENDEQUATION_ADD?n.BLEND_PREMULTIPLIED:n.BLEND_NORMAL:n.BLEND_NONE},set:function(e){var t=this.blend!==n.BLEND_NONE;switch(e){case n.BLEND_NONE:this.blend=!1,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ZERO,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_NORMAL:this.blend=!0,this.blendSrc=n.BLENDMODE_SRC_ALPHA,this.blendDst=n.BLENDMODE_ONE_MINUS_SRC_ALPHA,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_PREMULTIPLIED:this.blend=!0,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ONE_MINUS_SRC_ALPHA,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_ADDITIVE:this.blend=!0,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ONE,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_ADDITIVEALPHA:this.blend=!0,this.blendSrc=n.BLENDMODE_SRC_ALPHA,this.blendDst=n.BLENDMODE_ONE,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_MULTIPLICATIVE2X:this.blend=!0,this.blendSrc=n.BLENDMODE_DST_COLOR,this.blendDst=n.BLENDMODE_SRC_COLOR,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_SCREEN:this.blend=!0,this.blendSrc=n.BLENDMODE_ONE_MINUS_DST_COLOR,this.blendDst=n.BLENDMODE_ONE,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_MULTIPLICATIVE:this.blend=!0,this.blendSrc=n.BLENDMODE_DST_COLOR,this.blendDst=n.BLENDMODE_ZERO,this.blendEquation=n.BLENDEQUATION_ADD;break;case n.BLEND_MIN:this.blend=!0,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ONE,this.blendEquation=n.BLENDEQUATION_MIN;break;case n.BLEND_MAX:this.blend=!0,this.blendSrc=n.BLENDMODE_ONE,this.blendDst=n.BLENDMODE_ONE,this.blendEquation=n.BLENDEQUATION_MAX}t!==(this.blend!==n.BLEND_NONE)&&(this._scene?this._scene.layers._dirtyBlend=!0:this._dirtyBlend=!0),this._updateMeshInstanceKeys()}}),t.prototype._cloneInternal=function(t){t.name=this.name,t.id=e++,t.variants={},t.shader=this.shader,t.parameters={};for(var i in this.parameters)this.parameters.hasOwnProperty(i)&&(t.parameters[i]={scopeId:null,data:this.parameters[i].data,passFlags:this.parameters[i].passFlags});t.alphaTest=this.alphaTest,t.alphaToCoverage=this.alphaToCoverage,t.blend=this.blend,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.separateAlphaBlend=this.separateAlphaBlend,t.blendSrcAlpha=this.blendSrcAlpha,t.blendDstAlpha=this.blendDstAlpha,t.blendAlphaEquation=this.blendAlphaEquation,t.cull=this.cull,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.depthBias=this.depthBias,t.slopeDepthBias=this.slopeDepthBias,this.stencilFront&&(t.stencilFront=this.stencilFront.clone()),this.stencilBack&&(this.stencilFront===this.stencilBack?t.stencilBack=t.stencilFront:t.stencilBack=this.stencilBack.clone()),t.redWrite=this.redWrite,t.greenWrite=this.greenWrite,t.blueWrite=this.blueWrite,t.alphaWrite=this.alphaWrite,t.meshInstances=[]},t.prototype.clone=function(){var e=new n.Material;return this._cloneInternal(e),e},t.prototype._updateMeshInstanceKeys=function(){var e,t=this.meshInstances;for(e=0;e<t.length;e++)t[e].updateKey()},t.prototype.updateShader=function(e,t,i){},t.prototype.clearParameters=function(){this.parameters={}},t.prototype.getParameters=function(){return this.parameters},t.prototype.clearVariants=function(){var e;for(var t in this.variants)this.variants.hasOwnProperty(t)&&this.variants[t]._refCount--;this.variants={};for(var i,n=0;n<this.meshInstances.length;n++)for(e=this.meshInstances[n],i=0;i<e._shader.length;i++)e._shader[i]=null},t.prototype.getParameter=function(e){return this.parameters[e]},t.prototype.setParameter=function(e,t,i){if(void 0===i&&(i=-524285),void 0===t&&"object"==typeof e){var n=e;if(n.length){for(var r=0;r<n.length;r++)this.setParameter(n[r]);return}e=n.name,t=n.value}var s=this.parameters[e];s?(s.data=t,s.passFlags=i):this.parameters[e]={scopeId:null,data:t,passFlags:i}},t.prototype.deleteParameter=function(e){this.parameters[e]&&delete this.parameters[e]},t.prototype.setParameters=function(){for(var e in this.parameters){var t=this.parameters[e];t.scopeId.setValue(t.data)}},t.prototype.update=function(){throw Error("Not Implemented in base class")},t.prototype.init=function(e){throw Error("Not Implemented in base class")},t.prototype.getName=function(){return this.name},t.prototype.setName=function(e){this.name=e},t.prototype.getShader=function(){return this.shader},t.prototype.setShader=function(e){this._shader&&this._shader._refCount--,this._shader=e,e&&e._refCount++},t.prototype.destroy=function(){this.shader&&(this.shader._refCount--,this.shader._refCount<1&&this.shader.destroy());var e;for(var t in this.variants)if(this.variants.hasOwnProperty(t)){if(e=this.variants[t],e===this.shader)continue;e._refCount--,e._refCount<1&&e.destroy()}this.variants={},this.shader=null;for(var i,r,s=0;s<this.meshInstances.length;s++){for(i=this.meshInstances[s],r=0;r<i._shader.length;r++)i._shader[r]=null;i._material=null,this!==n.Scene.defaultMaterial&&(i.material=n.Scene.defaultMaterial)}},{Material:t}}()),Object.assign(n,function(){var e=function(){n.Material.call(this),this.color=new n.Color(1,1,1,1),this.colorMap=null,this.vertexColors=!1,this.update()};return e.prototype=Object.create(n.Material.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{clone:function(){var e=new n.BasicMaterial;return n.Material.prototype._cloneInternal.call(this,e),e.color.copy(this.color),e.colorMap=this.colorMap,e.vertexColors=this.vertexColors,e.update(),e},update:function(){this.clearParameters(),this.setParameter("uColor",this.color.data),this.colorMap&&this.setParameter("texture_diffuseMap",this.colorMap)},updateShader:function(e,t,i,n,r,s){var a={skin:!!this.meshInstances[0].skinInstance,vertexColors:this.vertexColors,diffuseMap:this.colorMap,pass:r},o=e.getProgramLibrary();this.shader=o.getProgram("basic",a)}}),{BasicMaterial:e}}()),Object.assign(n,function(){var e=function(){n.Material.call(this)};return e.prototype=Object.create(n.Material.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{clone:function(){var e=new n.DepthMaterial;return n.Material.prototype._cloneInternal.call(this,e),e.update(),e},update:function(){},updateShader:function(e){var t={skin:!!this.meshInstances[0].skinInstance},i=e.getProgramLibrary();this.shader=i.getProgram("depth",t)}}),{DepthMaterial:e}}()),Object.assign(n,function(){var e=function(){n.Material.call(this),this.reset(),this.update()};e.prototype=Object.create(n.Material.prototype),e.prototype.constructor=e;var t=function(e){return e.data instanceof n.Texture?e.data:null},i=function(e){return e.data instanceof n.Texture?e.data:null},r=function(e){return new n.Vec2(e.data[0],e.data[1])},s=function(e){var t,i;return t=e.data&&e.data.center?new n.Vec3(e.data.center[0],e.data.center[1],e.data.center[2]):new n.Vec3(0,0,0),i=e.data&&e.data.halfExtents?new n.Vec3(e.data.halfExtents[0],e.data.halfExtents[1],e.data.halfExtents[2]):new n.Vec3(.5,.5,.5),new n.BoundingBox(t,i)},a=function(e){return new n.Color(e.data[0],e.data[1],e.data[2])},o=[],h=[],l=[],c=[],d={},u=function(t,i,r,s,a){var h="_"+i+"Map",c=h+"Tiling",u=h+"Offset",f=h.substring(1)+"Transform",p=h+"Uv",_=h+"Channel",m="_"+i+"VertexColor",A="_"+i+"VertexColorChannel";if(t[h]=null,t[c]=new n.Vec2(1,1),t[u]=new n.Vec2(0,0),t[f]=null,t[p]=r,s>0){var v=a?a:s>1?"rgb":"g";t[_]=v,t[A]=v}t[m]=!1,n._matTex2D||(n._matTex2D=[]),n._matTex2D[i]=s,Object.defineProperty(e.prototype,h.substring(1),{get:function(){return this[h]},set:function(e){var t=this[h];!!t^!!e&&(this.dirtyShader=!0),t&&e&&(t.rgbm===e.rgbm&&t.fixCubemapSeams===e.fixCubemapSeams&&t.format===e.format||(this.dirtyShader=!0)),this[h]=e}});var y=c.substring(1),g=u.substring(1);Object.defineProperty(e.prototype,y,{get:function(){return this[c]},set:function(e){this.dirtyShader=!0,this[c]=e}}),d[y]=function(e,t,i){var n=e._updateMapTransform(i?e[f]:null,t,e[u]);return{name:"texture_"+f,value:n.data}},Object.defineProperty(e.prototype,g,{get:function(){return this[u]},set:function(e){this.dirtyShader=!0,this[u]=e}}),d[g]=function(e,t,i){var n=e._updateMapTransform(i?e[f]:null,e[c],t);return{name:"texture_"+f,value:n.data}},Object.defineProperty(e.prototype,p.substring(1),{get:function(){return this[p]},set:function(e){this[p]!==e&&(this.dirtyShader=!0),this[p]=e}}),Object.defineProperty(e.prototype,_.substring(1),{get:function(){return this[_]},set:function(e){this[_]!==e&&(this.dirtyShader=!0),this[_]=e}}),Object.defineProperty(e.prototype,m.substring(1),{get:function(){return this[m]},set:function(e){this.dirtyShader=!0,this[m]=e}}),Object.defineProperty(e.prototype,A.substring(1),{get:function(){return this[A]},set:function(e){this[A]!==e&&(this.dirtyShader=!0),this[A]=e}}),o.push(h.substring(1)),o.push(c.substring(1)),o.push(u.substring(1)),o.push(p.substring(1)),o.push(_.substring(1)),o.push(m.substring(1)),o.push(A.substring(1)),l.push(f)},f=[],p=function(t,i,r,s){var a="_"+i,h=i+"Uniform",l=i+"Intensity",u="_"+l;t[a]=r,t[h]=new Float32Array(3),Object.defineProperty(e.prototype,i,{get:function(){return this.dirtyColor=!0,this.dirtyShader=!0,this[a]},set:function(e){var t=this[a],i=0===t.data[0]&&0===t.data[1]&&0===t.data[2]||1===t.data[0]&&1===t.data[1]&&1===t.data[2],n=0===e.data[0]&&0===e.data[1]&&0===e.data[2]||1===e.data[0]&&1===e.data[1]&&1===e.data[2];i^n&&(this.dirtyShader=!0),this.dirtyColor=!0,this[a]=e}}),o.push(i),c.push(h),f.push(i),d[i]=function(e,t,r){var a=r?e[h]:new Float32Array(3),o=!1;if(e.useGammaTonemap){var l=e._scene||n.Application.getApplication().scene;o=l.gammaCorrection}for(var c=0;c<3;c++)o?a[c]=Math.pow(t.data[c],2.2):a[c]=t.data[c],s&&(a[c]*=e[u]);return{name:"material_"+i,value:a}},s&&(t[u]=1,Object.defineProperty(e.prototype,l,{get:function(){return this[u]},set:function(e){var t=this[u],i=0===t||1===t,n=0===e||1===e;i^n&&(this.dirtyShader=!0),this.dirtyColor=!0,this[u]=e}}),o.push(l),d[l]=function(e,t,r){var s=r?e[h]:new Float32Array(3),o=!1;if(e.useGammaTonemap){var l=e._scene||n.Application.getApplication().scene;o=l.gammaCorrection}for(var c=0;c<3;c++)o?s[c]=Math.pow(e[a].data[c],2.2):s[c]=e[a].data[c],s[c]*=e[u];return{name:"material_"+i,value:s}})},_=function(t,i,n,r){var s="_"+i;t[s]=n,Object.defineProperty(e.prototype,i,{get:function(){return this[s]},set:function(e){var t=this[s],i=0===t||1===t,n=0===e||1===e;i^n&&(this.dirtyShader=!0),this[s]=e}}),o.push(i),d[i]=void 0!==r?r:function(e,t,n){return{name:"material_"+i,value:t}}},m=function(t,i,n){var r="_"+i;t[r]=null,Object.defineProperty(e.prototype,i,{get:function(){return this[r]},set:function(e){var t=this[r];!!t^!!e&&(this.dirtyShader=!0),this[r]=e}}),o.push(i),d[i]=n},A=function(t,i,n){Object.defineProperty(e.prototype,n,{get:function(){return this[i]},set:function(e){this[i]=e}})},v=function(t){Object.defineProperty(e.prototype,"chunks",{get:function(){return this.dirtyShader=!0,this._chunks},set:function(e){this.dirtyShader=!0,this._chunks=e}}),o.push("chunks")},y=function(t,i,n){var r="_"+i;t[r]=n,Object.defineProperty(e.prototype,i,{get:function(){return this[r]},set:function(e){this[r]!==e&&(this.dirtyShader=!0),this[r]=e}}),o.push(i)},g=function(){};g.prototype.copy=function(e){for(var t in e)e.hasOwnProperty(t)&&"copy"!==t&&(this[t]=e[t])},Object.assign(e.prototype,{reset:function(){this.blendType=n.BLEND_NONE;var e;for(e=0;e<o.length;e++){var t=h[e];this[o[e]]=t&&t.clone?t.clone():t}for(e=0;e<l.length;e++)this[l[e]]=null;for(e=0;e<c.length;e++)this[c[e]]=new Float32Array(3);this._chunks=new g,this.cubeMapMinUniform=new Float32Array(3),this.cubeMapMaxUniform=new Float32Array(3)},clone:function(){var e=new n.StandardMaterial;n.Material.prototype._cloneInternal.call(this,e);for(var t,i=0;i<o.length;i++)t=o[i],void 0!==this[t]&&(this[t]&&this[t].copy?e[t]?e[t].copy(this[t]):e[t]=this[t].clone():e[t]=this[t]);return e.shader||e.update(),e},init:function(e){this.reset(),this.name=e.name,e.chunks&&this.chunks.copy(e.chunks);for(var n=0;n<e.parameters.length;n++){var o=e.parameters[n];"vec3"===o.type?this[o.name]=a(o):"vec2"===o.type?this[o.name]=r(o):"texture"===o.type?this[o.name]=t(o):"cubemap"===o.type?this[o.name]=i(o):"bumpMapFactor"===o.name?this.bumpiness=o.data:"boundingbox"===o.type?this[o.name]=s(o):this[o.name]=o.data}this.update()},_updateMapTransform:function(e,t,i){return e=e||new n.Vec4,e.set(t.x,t.y,i.x,i.y),1===e.x&&1===e.y&&0===e.z&&0===e.w?null:e},_collectLights:function(e,t,i,r,s){var a,o;for(o=0;o<t.length;o++)if(a=t[o],a._enabled&&a._mask&r){if(e!==n.LIGHTTYPE_DIRECTIONAL&&a.isStatic)continue;i.push(a)}if(s)for(o=0;o<s.length;o++)a=s[o],a._type===e&&i.push(a)},_setParameter:function(e,t){this.setParameter(e,t),this._propsSet.push(e)},_clearParameters:function(){for(var e=this._propsSet,t=0;t<e.length;t++)delete this.parameters[e[t]];this._propsSet=[]},_updateMap:function(e){var t=e+"Map";if(this[t]){this._setParameter("texture_"+t,this[t]);var i=t+"Transform";this[i]=this._updateMapTransform(this[i],this[t+"Tiling"],this[t+"Offset"]),this[i]&&this._setParameter("texture_"+i,this[i].data)}},getUniform:function(e,t,i){var n=d[e];return n?n(this,t,i):null},update:function(){this._clearParameters(),this._setParameter("material_ambient",this.ambientUniform),this.diffuseMap&&!this.diffuseTint||this._setParameter("material_diffuse",this.diffuseUniform),this.useMetalness?(!this.metalnessMap||this.metalness<1)&&this._setParameter("material_metalness",this.metalness):this.specularMap&&!this.specularTint||this._setParameter("material_specular",this.specularUniform),this._setParameter(this.getUniform("shininess",this.shininess,!0)),this.emissiveMap&&!this.emissiveTint||this._setParameter("material_emissive",this.emissiveUniform),this.emissiveMap&&this._setParameter("material_emissiveIntensity",this.emissiveIntensity),this.refraction>0&&(this._setParameter("material_refraction",this.refraction),this._setParameter("material_refractionIndex",this.refractionIndex)),this._setParameter("material_opacity",this.opacity),this.occludeSpecular&&this._setParameter("material_occludeSpecularIntensity",this.occludeSpecularIntensity),this.cubeMapProjection===n.CUBEPROJ_BOX&&this._setParameter(this.getUniform("cubeMapProjectionBox",this.cubeMapProjectionBox,!0));for(var e in n._matTex2D)this._updateMap(e);this.ambientSH&&this._setParameter("ambientSH[0]",this.ambientSH),this.normalMap&&this._setParameter("material_bumpiness",this.bumpiness),this.heightMap&&this._setParameter(this.getUniform("heightMapFactor",this.heightMapFactor,!0)),this.cubeMap&&this._setParameter("texture_cubeMap",this.cubeMap),this.prefilteredCubeMap128?this._setParameter("texture_prefilteredCubeMap128",this.prefilteredCubeMap128):this._scene&&this._scene._skyboxPrefiltered[0]&&this._setParameter("texture_prefilteredCubeMap128",this._scene._skyboxPrefiltered[0]),this.prefilteredCubeMap64?this._setParameter("texture_prefilteredCubeMap64",this.prefilteredCubeMap64):this._scene&&this._scene._skyboxPrefiltered[1]&&this._setParameter("texture_prefilteredCubeMap64",this._scene._skyboxPrefiltered[1]),this.prefilteredCubeMap32?this._setParameter("texture_prefilteredCubeMap32",this.prefilteredCubeMap32):this._scene&&this._scene._skyboxPrefiltered[2]&&this._setParameter("texture_prefilteredCubeMap32",this._scene._skyboxPrefiltered[2]),this.prefilteredCubeMap16?this._setParameter("texture_prefilteredCubeMap16",this.prefilteredCubeMap16):this._scene&&this._scene._skyboxPrefiltered[3]&&this._setParameter("texture_prefilteredCubeMap16",this._scene._skyboxPrefiltered[3]),this.prefilteredCubeMap8?this._setParameter("texture_prefilteredCubeMap8",this.prefilteredCubeMap8):this._scene&&this._scene._skyboxPrefiltered[4]&&this._setParameter("texture_prefilteredCubeMap8",this._scene._skyboxPrefiltered[4]),this.prefilteredCubeMap4?this._setParameter("texture_prefilteredCubeMap4",this.prefilteredCubeMap4):this._scene&&this._scene._skyboxPrefiltered[5]&&this._setParameter("texture_prefilteredCubeMap4",this._scene._skyboxPrefiltered[5]),this.sphereMap&&this._setParameter("texture_sphereMap",this.sphereMap),this.dpAtlas&&this._setParameter("texture_sphereMap",this.dpAtlas),this._setParameter("material_reflectivity",this.reflectivity),!this.dirtyShader&&this._scene||(this.shader=null,this.clearVariants()),this._processColor()},_processColor:function(){var e,t;if(this.dirtyColor&&(this._scene||!this.useGammaTonemap)){var i=!1;for(this.useGammaTonemap&&(i=this._scene.gammaCorrection),t=0;t<f.length;t++){var n=this["_"+f[t]],r=this[f[t]+"Uniform"];for(e=0;e<3;e++)i?r[e]=Math.pow(n.data[e],2.2):r[e]=n.data[e]}for(e=0;e<3;e++)this.emissiveUniform[e]*=this.emissiveIntensity;this.dirtyColor=!1}},_getMapTransformID:function(e,t){if(!e)return 0;this._mapXForms[t]||(this._mapXForms[t]=[]);var i,n,r;for(i=0;i<this._mapXForms[t].length;i++){
for(r=!0,n=0;n<e.data.length;n++)if(this._mapXForms[t][i][n]!=e.data[n]){r=!1;break}if(r)return i+1}var s=this._mapXForms[t].length;for(this._mapXForms[t][s]=[],n=0;n<e.data.length;n++)this._mapXForms[t][s][n]=e.data[n];return s+1},updateShader:function(e,t,i,r,s,a){!this._colorProcessed&&this._scene&&(this._colorProcessed=!0,this._processColor()),this._mapXForms=[];var o,h,l,c,d,u,f=e.useTexCubeLod,p=!e.extTextureLod;this.useSkybox&&(o=t._skyboxPrefiltered[0],h=t._skyboxPrefiltered[1],l=t._skyboxPrefiltered[2],c=t._skyboxPrefiltered[3],d=t._skyboxPrefiltered[4],u=t._skyboxPrefiltered[5]);var _=this.prefilteredCubeMap128||o,m=this.prefilteredCubeMap64||h,A=this.prefilteredCubeMap32||l,v=this.prefilteredCubeMap16||c,y=this.prefilteredCubeMap8||d,g=this.prefilteredCubeMap4||u;if(_){var b=_&&m&&A&&v&&y&&g;p&&b?(_.dpAtlas||(_.dpAtlas=n.generateDpAtlas(e,[_,m,A,v,y,g]),_.sh=n.shFromCubemap(v)),this.dpAtlas=_.dpAtlas,this.ambientSH=_.sh,this._setParameter("ambientSH[0]",this.ambientSH),this._setParameter("texture_sphereMap",this.dpAtlas)):f?_._levels.length<6?b?this._setParameter("texture_prefilteredCubeMap128",_):console.log("Can't use prefiltered cubemap: "+b+", "+f+", "+_._levels):this._setParameter("texture_prefilteredCubeMap128",_):b?(this._setParameter("texture_prefilteredCubeMap128",_),this._setParameter("texture_prefilteredCubeMap64",m),this._setParameter("texture_prefilteredCubeMap32",A),this._setParameter("texture_prefilteredCubeMap16",v),this._setParameter("texture_prefilteredCubeMap8",y),this._setParameter("texture_prefilteredCubeMap4",g)):console.log("Can't use prefiltered cubemap: "+b+", "+f+", "+_._levels)}var E=1===this.diffuse.data[0]&&1===this.diffuse.data[1]&&1===this.diffuse.data[2]||!this.diffuseTint&&(this.diffuseMap||this.diffuseVertexColor)?0:3,T=!1,S=!!(this.useMetalness||this.specularMap||this.sphereMap||this.cubeMap||this.dpAtlas);S=S||!!this.useMetalness||!(0===this.specular.data[0]&&0===this.specular.data[1]&&0===this.specular.data[2]),S&&(!this.specularTint&&(this.specularMap||this.specularVertexColor)||this.useMetalness||(T=1!==this.specular.data[0]||1!==this.specular.data[1]||1!==this.specular.data[2]));var w=!!_&&_.rgbm||!!this.cubeMap&&this.cubeMap.rgbm||!!this.dpAtlas&&this.dpAtlas.rgbm,C=!!_&&(_.rgbm||_.format===n.PIXELFORMAT_RGBA32F)||!!this.cubeMap&&(this.cubeMap.rgbm||this.cubeMap.format===n.PIXELFORMAT_RGBA32F)||!!this.dpAtlas&&(this.dpAtlas.rgbm||this.dpAtlas.format===n.PIXELFORMAT_RGBA32F),M=!(!_||this.cubeMap||this.sphereMap||this.dpAtlas)&&_.rgbm||!!this.cubeMap&&this.cubeMap.rgbm||!!this.sphereMap&&this.sphereMap.rgbm||!!this.dpAtlas&&this.dpAtlas.rgbm,P=!(!_||this.cubeMap||this.sphereMap||this.dpAtlas)&&(_.rgbm||_.format===n.PIXELFORMAT_RGBA32F)||!!this.cubeMap&&(this.cubeMap.rgbm||this.cubeMap.format===n.PIXELFORMAT_RGBA32F)||!!this.sphereMap&&(this.sphereMap.rgbm||this.sphereMap.format===n.PIXELFORMAT_RGBA32F)||!!this.dpAtlas&&(this.dpAtlas.rgbm||this.dpAtlas.format===n.PIXELFORMAT_RGBA32F),I=this.emissiveMap?0:3;I||(I=(1!==this.emissive.data[0]||1!==this.emissive.data[1]||1!==this.emissive.data[2]||1!==this.emissiveIntensity)&&this.emissiveTint,I=I?3:1!==this.emissiveIntensity?1:0);var R,x=s>n.SHADER_FORWARDHDR&&s<=n.SHADER_PICK;x?R={opacityTint:1!==this.opacity&&this.blendType!==n.BLEND_NONE,alphaTest:this.alphaTest>0,forceFragmentPrecision:this.forceFragmentPrecision,chunks:this.chunks,blendType:this.blendType,forceUv1:this.forceUv1,pass:s}:(R={fog:this.useFog?t.fog:"none",gamma:this.useGammaTonemap?t.gammaCorrection:n.GAMMA_NONE,toneMap:this.useGammaTonemap?t.toneMapping:-1,blendMapsWithColors:!0,ambientTint:this.ambientTint,diffuseTint:E,specularTint:T?3:0,metalnessTint:this.useMetalness&&this.metalness<1?1:0,glossTint:1,emissiveTint:I,opacityTint:1!==this.opacity&&this.blendType!==n.BLEND_NONE?1:0,alphaTest:this.alphaTest>0,alphaToCoverage:this.alphaToCoverage,needsNormalFloat:this.normalizeNormalMap,sphereMap:!!this.sphereMap,cubeMap:!!this.cubeMap,dpAtlas:!!this.dpAtlas,ambientSH:!!this.ambientSH,useSpecular:S,rgbmAmbient:w,rgbmReflection:M,hdrAmbient:C,hdrReflection:P,fixSeams:_?_.fixCubemapSeams:!!this.cubeMap&&this.cubeMap.fixCubemapSeams,prefilteredCubemap:!!_,emissiveFormat:this.emissiveMap?this.emissiveMap.rgbm?1:this.emissiveMap.format===n.PIXELFORMAT_RGBA32F?2:0:null,lightMapFormat:this.lightMap?this.lightMap.rgbm?1:this.lightMap.format===n.PIXELFORMAT_RGBA32F?2:0:null,useRgbm:M||w||(this.emissiveMap?this.emissiveMap.rgbm:0)||(this.lightMap?this.lightMap.rgbm:0),specularAntialias:this.specularAntialias,conserveEnergy:this.conserveEnergy,occludeSpecular:this.occludeSpecular,occludeSpecularFloat:1!==this.occludeSpecularIntensity,occludeDirect:this.occludeDirect,shadingModel:this.shadingModel,fresnelModel:this.fresnelModel,packedNormal:!!this.normalMap&&this.normalMap.format===n.PIXELFORMAT_DXT5,forceFragmentPrecision:this.forceFragmentPrecision,fastTbn:this.fastTbn,cubeMapProjection:this.cubeMapProjection,chunks:this.chunks,customFragmentShader:this.customFragmentShader,refraction:!!this.refraction,useMetalness:this.useMetalness,blendType:this.blendType,skyboxIntensity:_===o&&_&&1!==t.skyboxIntensity,forceUv1:this.forceUv1,useTexCubeLod:f,msdf:!!this.msdfMap,twoSidedLighting:this.twoSidedLighting,pixelSnap:this.pixelSnap,pass:s},s===n.SHADER_FORWARDHDR&&(R.gamma&&(R.gamma=n.GAMMA_SRGBHDR),R.toneMap=n.TONEMAP_LINEAR));var O=!1,k=!1,D=!1;i&&(x||(R.noShadow=0!==(i&n.SHADERDEF_NOSHADOW),0!==(i&n.SHADERDEF_LM)&&(R.lightMapFormat=1,R.lightMap=!0,R.lightMapChannel="rgb",R.lightMapUv=1,R.lightMapTransform=0,R.lightMapWithoutAmbient=!this.lightMap,R.useRgbm=!0,0!==(i&n.SHADERDEF_DIRLM)&&(R.dirLightMap=!0))),R.screenSpace=0!==(i&n.SHADERDEF_SCREENSPACE),R.skin=0!==(i&n.SHADERDEF_SKIN),R.useInstancing=0!==(i&n.SHADERDEF_INSTANCING),O=0!==(i&n.SHADERDEF_UV0),k=0!==(i&n.SHADERDEF_UV1),D=0!==(i&n.SHADERDEF_VCOLOR));var L;for(var N in n._matTex2D)if(L="opacity"===N,(!L||this.blendType!==n.BLEND_NONE||0!==this.alphaTest||this.alphaToCoverage)&&(!x||L)){var F,B=N+"Map",V=N+"VertexColor";if("height"!==N&&this[V]&&D&&(F=N+"VertexColorChannel",R[V]=this[V],R[F]=this[F],R.vertexColors=!0),this[B]){var U=B+"Uv",G=!0;if(0!==this[U]||O||(G=!1),1!==this[U]||k||(G=!1),G){R[B]=!!this[B];var W=B+"Transform";F=B+"Channel",R[W]=this._getMapTransformID(this[W],this[U]),R[F]=this[F],R[U]=this[U]}}}if(this._mapXForms=null,this.useLighting&&!x){var z=[],H=i?i>>16:1;a&&(this._collectLights(n.LIGHTTYPE_DIRECTIONAL,a[n.LIGHTTYPE_DIRECTIONAL],z,H),this._collectLights(n.LIGHTTYPE_POINT,a[n.LIGHTTYPE_POINT],z,H,r),this._collectLights(n.LIGHTTYPE_SPOT,a[n.LIGHTTYPE_SPOT],z,H,r)),R.lights=z}else R.lights=[];x||(R.aoMapUv=R.aoMapUv||this.aoUvSet,0===R.lights.length&&(R.noShadow=!1)),this.onUpdateShader&&(R=this.onUpdateShader(R));var j=e.getProgramLibrary();this.shader=j.getProgram("standard",R),i||(this.clearVariants(),this.variants[0]=this.shader),this.dirtyShader=!1}});var b=function(e){e.dirtyShader=!0,e.dirtyColor=!0,e._scene=null,e._colorProcessed=!1,p(e,"ambient",new n.Color(.7,.7,.7)),p(e,"diffuse",new n.Color(1,1,1)),p(e,"specular",new n.Color(0,0,0)),p(e,"emissive",new n.Color(0,0,0),!0),_(e,"shininess",25,function(e,t){var i;return i=e.shadingModel===n.SPECULAR_PHONG?Math.pow(2,.01*t*11):.01*t,{name:"material_shininess",value:i}}),_(e,"heightMapFactor",1,function(e,t){return{name:"material_heightMapFactor",value:.025*t}}),_(e,"opacity",1),_(e,"alphaTest",0),_(e,"bumpiness",1),_(e,"reflectivity",1),_(e,"occludeSpecularIntensity",1),_(e,"refraction",0),_(e,"refractionIndex",1/1.5),_(e,"metalness",1),_(e,"aoUvSet",0,null),m(e,"ambientSH",function(e,t,i){return{name:"ambientSH[0]",value:t}}),m(e,"cubeMapProjectionBox",function(e,t,i){var n=i?e.cubeMapMinUniform:new Float32Array(3),r=i?e.cubeMapMaxUniform:new Float32Array(3);return n[0]=t.center.x-t.halfExtents.x,n[1]=t.center.y-t.halfExtents.y,n[2]=t.center.z-t.halfExtents.z,r[0]=t.center.x+t.halfExtents.x,r[1]=t.center.y+t.halfExtents.y,r[2]=t.center.z+t.halfExtents.z,[{name:"envBoxMin",value:n},{name:"envBoxMax",value:r}]}),v(e),y(e,"ambientTint",!1),y(e,"diffuseTint",!1),y(e,"specularTint",!1),y(e,"emissiveTint",!1),y(e,"fastTbn",!1),y(e,"specularAntialias",!1),y(e,"useMetalness",!1),y(e,"occludeDirect",!1),y(e,"normalizeNormalMap",!0),y(e,"conserveEnergy",!0),y(e,"occludeSpecular",n.SPECOCC_AO),y(e,"shadingModel",n.SPECULAR_BLINN),y(e,"fresnelModel",n.FRESNEL_NONE),y(e,"cubeMapProjection",n.CUBEPROJ_NONE),y(e,"customFragmentShader",null),y(e,"forceFragmentPrecision",null),y(e,"useFog",!0),y(e,"useLighting",!0),y(e,"useGammaTonemap",!0),y(e,"useSkybox",!0),y(e,"forceUv1",!1),y(e,"pixelSnap",!1),y(e,"twoSidedLighting",!1),u(e,"diffuse",0,3),u(e,"specular",0,3),u(e,"emissive",0,3),u(e,"normal",0,-1),u(e,"metalness",0,1),u(e,"gloss",0,1),u(e,"opacity",0,1,"a"),u(e,"height",0,1),u(e,"ao",0,1),u(e,"light",1,3),u(e,"msdf",0,3),m(e,"cubeMap"),m(e,"sphereMap"),m(e,"dpAtlas"),m(e,"prefilteredCubeMap128"),m(e,"prefilteredCubeMap64"),m(e,"prefilteredCubeMap32"),m(e,"prefilteredCubeMap16"),m(e,"prefilteredCubeMap8"),m(e,"prefilteredCubeMap4"),A(e,"diffuseTint","diffuseMapTint"),A(e,"specularTint","specularMapTint"),A(e,"emissiveTint","emissiveMapTint"),A(e,"aoVertexColor","aoMapVertexColor"),A(e,"diffuseVertexColor","diffuseMapVertexColor"),A(e,"specularVertexColor","specularMapVertexColor"),A(e,"emissiveVertexColor","emissiveMapVertexColor"),A(e,"metalnessVertexColor","metalnessMapVertexColor"),A(e,"glossVertexColor","glossMapVertexColor"),A(e,"opacityVertexColor","opacityMapVertexColor"),A(e,"lightVertexColor","lightMapVertexColor");for(var t=0;t<o.length;t++)h[t]=e[o[t]];e._propsSet=[]};return b(e.prototype),{StandardMaterial:e}}()),Object.assign(n,function(){function e(e,t,i,r){return(15&e)<<27|(t===n.BLEND_NONE?1:0)<<26|(i?1:0)<<25|(33554431&r)<<0}var t=0,i=new n.BoundingBox,r=function(){this._refCount=0,this.id=t++,this.vertexBuffer=null,this.indexBuffer=[null],this.primitive=[{type:0,base:0,count:0}],this.skin=null,this.morph=null,this._aabb=new n.BoundingBox,this.boneAabb=null};Object.defineProperty(r.prototype,"aabb",{get:function(){return this.morph?this.morph.aabb:this._aabb},set:function(e){this.morph?(this._aabb=this.morph._baseAabb=e,this.morph._calculateAabb()):this._aabb=e}});var s=function(e,t,i){this._key=[0,0],this._shader=[null,null,null],this.isStatic=!1,this._staticLightList=null,this._staticSource=null,this.node=e,this._mesh=t,t._refCount++,this.material=i,this._shaderDefs=n.MASK_DYNAMIC<<16,this._shaderDefs|=t.vertexBuffer.format.hasUv0?n.SHADERDEF_UV0:0,this._shaderDefs|=t.vertexBuffer.format.hasUv1?n.SHADERDEF_UV1:0,this._shaderDefs|=t.vertexBuffer.format.hasColor?n.SHADERDEF_VCOLOR:0,this._lightHash=0,this.visible=!0,this.layer=n.LAYER_WORLD,this.renderStyle=n.RENDERSTYLE_SOLID,this.castShadow=!1,this._receiveShadow=!0,this._screenSpace=!1,this._noDepthDrawGl1=!1,this.cull=!0,this.pick=!0,this._updateAabb=!0,this._updateAabbFunc=null,this.updateKey(),this._skinInstance=null,this.morphInstance=null,this.instancingData=null,this.aabb=new n.BoundingBox,this._boneAabb=null,this._aabbVer=-1,this.drawOrder=0,this.visibleThisFrame=0,this.parameters={},this.stencilFront=null,this.stencilBack=null};Object.defineProperty(s.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh&&this._mesh._refCount--,this._mesh=e,e&&e._refCount++}}),Object.defineProperty(s.prototype,"aabb",{get:function(){var e;if(!this._updateAabb)return this._aabb;if(this._updateAabbFunc)return this._updateAabbFunc(this._aabb);if(this.skinInstance){var t,r,s=this.mesh.skin.boneNames.length;if(!this.mesh.boneAabb){this.mesh.boneAabb=[],this.mesh.boneUsed=[];var a,o,h,l,c,d,u,f=this.mesh.vertexBuffer.format.elements,p=this.mesh.vertexBuffer.numVertices,_=this.mesh.vertexBuffer.format.size;for(r=0;r<f.length;r++)f[r].name===n.SEMANTIC_POSITION?o=f[r].offset:f[r].name===n.SEMANTIC_BLENDINDICES?h=f[r].offset:f[r].name===n.SEMANTIC_BLENDWEIGHT&&(l=f[r].offset);var m,A,v,y,g,b=new Uint8Array(this.mesh.vertexBuffer.storage),E=new Float32Array(this.mesh.vertexBuffer.storage),T=o/4,S=l/4,w=_/4,C=[],M=[];for(t=this.mesh.boneUsed,r=0;r<s;r++)C[r]=new n.Vec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),M[r]=new n.Vec3((-Number.MAX_VALUE),(-Number.MAX_VALUE),(-Number.MAX_VALUE));for(c=0;c<p;c++)for(d=0;d<4;d++)E[c*w+S+d]>0&&(a=b[c*_+h+d],v=E[c*w+T],y=E[c*w+T+1],g=E[c*w+T+2],m=M[a],A=C[a],A.x>v&&(A.x=v),A.y>y&&(A.y=y),A.z>g&&(A.z=g),m.x<v&&(m.x=v),m.y<y&&(m.y=y),m.z<g&&(m.z=g),t[a]=!0);if(this.morphInstance){var P,I,R,x,O,k,D,L,N,F=this.morphInstance.morph._targets,B=new Float32Array(3*p),V=new Float32Array(3*p);for(c=0;c<p;c++)B[3*c]=V[3*c]=E[c*w+T],B[3*c+1]=V[3*c+1]=E[c*w+T+1],B[3*c+2]=V[3*c+2]=E[c*w+T+2];for(u=0;u<F.length;u++)for(k=F[u],D=k.indices,L=D.length,N=k.deltaPositions,d=0;d<L;d++)P=D[d],R=N[3*d],x=N[3*d+1],O=N[3*d+2],R<0?B[3*P]+=R:V[3*P]+=R,x<0?B[3*P+1]+=x:V[3*P+1]+=x,O<0?B[3*P+2]+=O:V[3*P+2]+=O;for(u=0;u<F.length;u++)for(k=F[u],D=k.indices,L=D.length,N=k.deltaPositions,d=0;d<L;d++)for(P=D[d],I=0;I<4;I++)E[P*w+S+I]>0&&(a=b[P*_+h+I],m=M[a],A=C[a],v=B[3*P],y=B[3*P+1],g=B[3*P+2],A.x>v&&(A.x=v),A.y>y&&(A.y=y),A.z>g&&(A.z=g),v=V[3*P],y=V[3*P+1],g=V[3*P+2],m.x<v&&(m.x=v),m.y<y&&(m.y=y),m.z<g&&(m.z=g))}for(r=0;r<s;r++)e=new n.BoundingBox,e.setMinMax(C[r],M[r]),this.mesh.boneAabb.push(e)}if(!this._boneAabb)for(this._boneAabb=[],r=0;r<this.mesh.boneAabb.length;r++)this._boneAabb[r]=new n.BoundingBox;for(t=this.mesh.boneUsed,r=0;r<this.mesh.boneAabb.length;r++)t[r]&&this._boneAabb[r].setFromTransformedAabb(this.mesh.boneAabb[r],this.skinInstance.matrices[r]);var U=this.node.getWorldTransform(),G=!0;for(r=0;r<this.mesh.boneAabb.length;r++)t[r]&&(G?(i.center.copy(this._boneAabb[r].center),i.halfExtents.copy(this._boneAabb[r].halfExtents),G=!1):i.add(this._boneAabb[r]));this._aabb.setFromTransformedAabb(i,U)}else this.node._aabbVer!==this._aabbVer&&(e=this.mesh?this.mesh.aabb:this._aabb,this.mesh||(e.center.set(0,0,0),e.halfExtents.set(0,0,0)),this._aabb.setFromTransformedAabb(e,this.node.getWorldTransform()),this._aabbVer=this.node._aabbVer);return this._aabb},set:function(e){this._aabb=e}}),Object.defineProperty(s.prototype,"material",{get:function(){return this._material},set:function(e){var t;for(t=0;t<this._shader.length;t++)this._shader[t]=null;if(this._material){var i=this._material.meshInstances;t=i.indexOf(this),t!==-1&&i.splice(t,1)}var r=!!this._material&&this._material.blendType!==n.BLEND_NONE,s=this._material;if(this._material=e,this._material&&(this._material.meshInstances.push(this),this.updateKey()),e&&e.blendType!==n.BLEND_NONE!==r){var a=e._scene;!a&&s&&s._scene&&(a=s._scene),a?a.layers._dirtyBlend=!0:e._dirtyBlend=!0}}}),Object.defineProperty(s.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e,this.updateKey()}}),Object.defineProperty(s.prototype,"receiveShadow",{get:function(){return this._receiveShadow},set:function(e){this._receiveShadow=e,this._shaderDefs=e?this._shaderDefs&~n.SHADERDEF_NOSHADOW:this._shaderDefs|n.SHADERDEF_NOSHADOW,this._shader[n.SHADER_FORWARD]=null,this._shader[n.SHADER_FORWARDHDR]=null}}),Object.defineProperty(s.prototype,"skinInstance",{get:function(){return this._skinInstance},set:function(e){this._skinInstance=e,this._shaderDefs=e?this._shaderDefs|n.SHADERDEF_SKIN:this._shaderDefs&~n.SHADERDEF_SKIN;for(var t=0;t<this._shader.length;t++)this._shader[t]=null}}),Object.defineProperty(s.prototype,"screenSpace",{get:function(){return this._screenSpace},set:function(e){this._screenSpace=e,this._shaderDefs=e?this._shaderDefs|n.SHADERDEF_SCREENSPACE:this._shaderDefs&~n.SHADERDEF_SCREENSPACE,this._shader[n.SHADER_FORWARD]=null}}),Object.defineProperty(s.prototype,"key",{get:function(){return this._key[n.SORTKEY_FORWARD]},set:function(e){this._key[n.SORTKEY_FORWARD]=e}}),Object.defineProperty(s.prototype,"mask",{get:function(){return this._shaderDefs>>16},set:function(e){var t=65535&this._shaderDefs;this._shaderDefs=t|e<<16,this._shader[n.SHADER_FORWARD]=null,this._shader[n.SHADER_FORWARDHDR]=null}}),Object.assign(s.prototype,{syncAabb:function(){},updateKey:function(){var t=this.material;this._key[n.SORTKEY_FORWARD]=e(this.layer,t.alphaToCoverage||t.alphaTest?n.BLEND_NORMAL:t.blendType,!1,t.id)},setParameter:n.Material.prototype.setParameter,setParameters:n.Material.prototype.setParameters,deleteParameter:n.Material.prototype.deleteParameter,getParameter:n.Material.prototype.getParameter,getParameters:n.Material.prototype.getParameters,clearParameters:n.Material.prototype.clearParameters});var a=function(t,i,r){this._key=[],this._key[n.SORTKEY_FORWARD]=e(t,i,!0,0),this.command=r};Object.defineProperty(a.prototype,"key",{get:function(){return this._key[n.SORTKEY_FORWARD]},set:function(e){this._key[n.SORTKEY_FORWARD]=e}});var o=function(e,t,i){i=i||16,this.buffer=new Float32Array(e*i),this.count=e,this.offset=0,this.usage=t?n.BUFFER_DYNAMIC:n.BUFFER_STATIC,this._buffer=null};return Object.assign(o.prototype,{update:function(){this._buffer&&this._buffer.setData(this.buffer)}}),{Command:a,Mesh:r,MeshInstance:s,InstancingData:o,_getDrawcallSortKey:e}}()),Object.assign(n,function(){var e=new n.Mat4,t=function(e,t,i){this.device=e,this.inverseBindPose=t,this.boneNames=i},i=function(e){this.skin=e,this._dirty=!0,this.bones=[];var t=e.inverseBindPose.length,i=e.device;if(i.supportsBoneTextures){var r;r=t>256?64:t>64?32:t>16?16:8,this.boneTexture=new n.Texture(i,{width:r,height:r,format:n.PIXELFORMAT_RGBA32F,mipmaps:!1,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),this.matrixPalette=this.boneTexture.lock()}else this.matrixPalette=new Float32Array(16*t);this.matrices=[];for(var s=0;s<t;s++)this.matrices[s]=new n.Mat4};return Object.assign(i.prototype,{updateMatrices:function(t){e.copy(t.getWorldTransform()).invert();for(var i=this.bones.length-1;i>=0;i--)this.matrices[i].mul2(e,this.bones[i].getWorldTransform()),this.matrices[i].mul2(this.matrices[i],this.skin.inverseBindPose[i])},updateMatrixPalette:function(){for(var e,t,i=this.matrixPalette,n=this.bones.length-1;n>=0;n--)e=this.matrices[n].data,t=16*n,i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2],i[t+3]=e[3],i[t+4]=e[4],i[t+5]=e[5],i[t+6]=e[6],i[t+7]=e[7],i[t+8]=e[8],i[t+9]=e[9],i[t+10]=e[10],i[t+11]=e[11],i[t+12]=e[12],i[t+13]=e[13],i[t+14]=e[14],i[t+15]=e[15];this.skin.device.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())}}),{Skin:t,SkinInstance:i}}()),Object.assign(n,function(){function e(){this.index=0,this.boneIndices=[0,0,0,0]}function t(){this.partition=0,this.vertexStart=0,this.vertexCount=0,this.indexStart=0,this.indexCount=0,this.boneIndices=[],this.vertices=[],this.indices=[],this.indexMap={}}function i(e){var t,i=e.vertices,n=e.skins,r=e.meshes,s=e.meshInstances;for(t=0;t<r.length;t++)r[t].vertices=i[r[t].vertices],void 0!==r[t].skin&&(r[t].skin=n[r[t].skin]);for(t=0;t<s.length;t++)s[t].mesh=r[s[t].mesh]}function n(e){var t,i=e.vertices,n=e.skins,r=e.meshes,s=e.meshInstances;for(t=0;t<r.length;t++)r[t].vertices=i.indexOf(r[t].vertices),void 0!==r[t].skin&&(r[t].skin=n.indexOf(r[t].skin));for(t=0;t<s.length;t++)s[t].mesh=r.indexOf(s[t].mesh)}function r(r,s,a){var o,h,l,c;i(r);var d,u=r.vertices,f=r.skins,p=r.meshes,_=r.meshInstances,m=function(t){var i=new e;return i.index=t,i};for(o=f.length-1;o>=0;o--)if(f[o].boneNames.length>a){var A=f.splice(o,1)[0],v=[];for(h=0;h<p.length;h++)p[h].skin===A&&v.push(p[h]);for(h=0;h<v.length;h++)c=p.indexOf(v[h]),c!==-1&&p.splice(c,1);if(0===v.length)throw new Error("partitionSkin: There should be at least one mesh that references a skin");var y=v[0].vertices;for(h=1;h<v.length;h++)if(v[h].vertices!==y)throw new Error("partitionSkin: All meshes that share a skin should also share the same vertex buffer");var g,b=[],E=[],T=[],S=0;for(h=0;h<v.length;h++){d=v[h];for(var w=d.indices,C=d.base;C<d.base+d.count;){c=w[C++],E[0]=m(c),T[0]=c,c=w[C++],E[1]=m(c),T[1]=c,c=w[C++],E[2]=m(c),T[2]=c;for(var M=!1,P=S;P<b.length;P++)if(g=b[P],g.addPrimitive(E,T,y,a)){M=!0;break}M||(g=new t,g.originalMesh=d,g.addPrimitive(E,T,y,a),b.push(g))}S=b.length}var I=[],R=[];for(h=0;h<b.length;h++)if(g=b[h],g.vertices.length&&g.indices.length){var x=I.length,O=g.vertices.length,k=R.length,D=g.indices.length;g.partition=h,g.vertexStart=x,g.vertexCount=O,g.indexStart=k,g.indexCount=D;var L,N;for(L=0,N=x;L<O;)I[N++]=g.vertices[L++];for(L=0,N=k;L<D;)R[N++]=g.indices[L++]+x}var F=[];for(h=0;h<b.length;h++){g=b[h];var B=[],V=[];for(l=0;l<g.boneIndices.length;l++)B.push(A.inverseBindMatrices[g.boneIndices[l]]),V.push(A.boneNames[g.boneIndices[l]]);var U={inverseBindMatrices:B,boneNames:V};F.push(U),f.push(U)}var G,W,z,H,j={};for(W in y)j[W]={components:y[W].components,data:[],type:y[W].type};for(W in y)if("blendIndices"===W){var Y=j[W].data;for(h=0;h<I.length;h++){var X=I[h].boneIndices;Y.push(X[0],X[1],X[2],X[3])}}else for(G=y[W],z=G.data,H=G.components,h=0;h<I.length;h++)for(c=I[h].index,l=0;l<H;l++)j[W].data.push(z[c*H+l]);for(u[u.indexOf(y)]=j,h=0;h<b.length;h++)for(g=b[h],d={aabb:{min:[0,0,0],max:[0,0,0]},vertices:j,skin:F[h],indices:R.splice(0,g.indexCount),type:"triangles",base:0,count:g.indexCount},p.push(d),l=_.length-1;l>=0;l--)_[l].mesh===g.originalMesh&&(_.push({mesh:d,node:_[l].node}),s&&s.push({material:s[l].material,path:s[l].path}));for(h=0;h<b.length;h++)for(g=b[h],l=_.length-1;l>=0;l--)_[l].mesh===g.originalMesh&&(_.splice(l,1),s&&s.splice(l,1))}n(r)}return Object.assign(t.prototype,{addVertex:function(e,t,i){var n=-1;if(void 0!==this.indexMap[t])n=this.indexMap[t],this.indices.push(n);else{for(var r=0;r<4;r++)if(0!==i.blendWeight.data[4*t+r]){var s=i.blendIndices.data[4*e.index+r];e.boneIndices[r]=this.getBoneRemap(s)}n=this.vertices.length,this.indices.push(n),this.vertices.push(e),this.indexMap[t]=n}},addPrimitive:function(e,t,i,n){var r,s,a=[],o=0,h=e.length;for(r=0;r<h;r++)for(var l=e[r],c=l.index,d=0;d<4;d++)if(i.blendWeight.data[4*c+d]>0){var u=i.blendIndices.data[4*c+d],f=!0;for(s=0;s<o;s++)if(a[s]==u){f=!1;break}if(f){a[o]=u;var p=this.getBoneRemap(u);o+=p===-1?1:0}}if(this.boneIndices.length+o>n)return!1;for(r=0;r<o;r++)this.boneIndices.push(a[r]);for(r=0;r<h;r++)this.addVertex(e[r],t[r],i);return!0},getBoneRemap:function(e){for(var t=0;t<this.boneIndices.length;t++)if(this.boneIndices[t]===e)return t;return-1}}),{partitionSkin:r}}()),Object.assign(n,function(){var e=new n.Vec3,t=new n.Vec3,i=function(e){if(e.indices)this.indices=e.indices;else{var t=e.deltaPositions;this.indices=[],this.indices.length=t.length;for(var i=0;i<t.length;i++)this.indices[i]=i}this.deltaPositions=e.deltaPositions,this.deltaNormals=e.deltaNormals,this.deltaTangents=e.deltaTangents,this.name=e.name,this.aabb=e.aabb},r=function(e){this.aabb=new n.BoundingBox,this._baseBuffer=null,this._baseAabb=null,this._targets=e,this._dirty=!0,this._aabbDirty=!0,this._baseData=null,this._offsetPF=0,this._offsetNF=0,this._offsetTF=0,this._vertSizeF=0};Object.assign(r.prototype,{_setBaseMesh:function(e){this._baseBuffer=e.vertexBuffer,this._baseAabb=e._aabb,this._baseData=new Float32Array(this._baseBuffer.storage);for(var t=-1,i=-1,r=-1,s=this._baseBuffer.format.elements,a=this._baseBuffer.format.size,o=0;o<s.length;o++)s[o].name===n.SEMANTIC_POSITION?t=s[o].offset:s[o].name===n.SEMANTIC_NORMAL?i=s[o].offset:s[o].name===n.SEMANTIC_TANGENT&&(r=s[o].offset);this._offsetPF=t/4,this._offsetNF=i/4,this._offsetTF=r/4,this._vertSizeF=a/4,this._dirty=!0},_calculateAabb:function(){if(this._baseBuffer){this.aabb.copy(this._baseAabb);var i,n,r,s,a,o,h,l,c,d=this._vertSizeF,u=this._offsetPF,f=this._baseData;for(n=0;n<this._targets.length;n++){if(s=this._targets[n],!s.aabb&&s.indices.length>0){for(s.aabb=this.aabb.clone(),e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i=s.indices.length,r=0;r<i;r++)a=s.indices[r],o=a*d+u,h=f[o]+s.deltaPositions[3*r],l=f[o+1]+s.deltaPositions[3*r+1],c=f[o+2]+s.deltaPositions[3*r+2],e.x>h&&(e.x=h),e.y>l&&(e.y=l),e.z>c&&(e.z=c),t.x<h&&(t.x=h),t.y<l&&(t.y=l),t.z<c&&(t.z=c);s.aabb.setMinMax(e,t)}s.aabb&&this.aabb.add(s.aabb)}this._aabbDirty=!1}},addTarget:function(e){this._targets.push(e),this._aabbDirty=!0},removeTarget:function(e){var t=this._targets.indexOf(e);t!==-1&&(this._targets.splice(t,1),this._aabbDirty=!0)},getTarget:function(e){return this._targets[e]}});var s=function(e){this.morph=e,this._vertexBuffer=null,this._vertexData=null,this._weights=[],this._dirty=!0};return Object.assign(s.prototype,{_setBaseMesh:function(e){this.destroy(),this._vertexBuffer=new n.VertexBuffer(this.morph._baseBuffer.device,this.morph._baseBuffer.format,this.morph._baseBuffer.numVertices,n.BUFFER_DYNAMIC,this.morph._baseBuffer.storage.slice(0)),this._vertexData=new Float32Array(this._vertexBuffer.storage),this._weights=[],this._weights.length=this.morph._targets.length;for(var t=0;t<this.morph._targets.length;t++)this._weights[t]=0;this._dirty=!0},destroy:function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._vertexBuffer=null)},getWeight:function(e){return this._weights[e]},setWeight:function(e,t){this._weights[e]=t,this._dirty=!0},updateBounds:function(e){this.morph._baseBuffer!==e.vertexBuffer&&this.morph._setBaseMesh(e),this._vertexData||this._setBaseMesh(e),this.morph._aabbDirty&&this.morph._calculateAabb()},update:function(e){this.morph._baseBuffer!==e.vertexBuffer&&this.morph._setBaseMesh(e),this._vertexData||this._setBaseMesh(e);var t,i,n,r,s,a,o,h,l=this.morph._targets,c=this._weights,d=this.morph._vertSizeF,u=this.morph._offsetPF,f=this.morph._offsetNF,p=this.morph._offsetTF,_=this._vertexData;_.set(this.morph._baseData);for(var m=0;m<l.length;m++)if(r=c[m],0!==r)for(n=l[m],t=n.indices.length,s=0;s<t;s++)o=3*s,i=n.indices[s],a=i*d+u,_[a]+=n.deltaPositions[o]*r,_[a+1]+=n.deltaPositions[o+1]*r,_[a+2]+=n.deltaPositions[o+2]*r,n.deltaNormals&&(a=i*d+f,_[a]+=n.deltaNormals[o]*r,_[a+1]+=n.deltaNormals[o+1]*r,_[a+2]+=n.deltaNormals[o+2]*r,n.deltaTangents&&(h=4*s,a=i*d+p,_[a]+=n.deltaTangents[h]*r,_[a+1]+=n.deltaTangents[h+1]*r,_[a+2]+=n.deltaTangents[h+2]*r,_[a+3]+=n.deltaTangents[h+3]*r,_[a+3]=_[a+3]>0?1:-1));this._vertexBuffer.unlock()}}),{MorphTarget:i,Morph:r,MorphInstance:s}}()),Object.assign(n,function(){var e=function(){this.graph=null,this.meshInstances=[],this.skinInstances=[],this.morphInstances=[],this.cameras=[],this.lights=[],this._shadersVersion=0};return Object.assign(e.prototype,{getGraph:function(){return this.graph},setGraph:function(e){this.graph=e},getCameras:function(){return this.cameras},setCameras:function(e){this.cameras=e},getLights:function(){return this.lights},setLights:function(e){this.lights=e},getMaterials:function(){var e,t=[];for(e=0;e<this.meshInstances.length;e++){var i=this.meshInstances[e];t.indexOf(i.material)===-1&&t.push(i.material)}return t},clone:function(){var e,t,i=[],r=[],s=function(e){var t=e.clone();i.push(e),r.push(t);for(var n=0;n<e._children.length;n++)t.addChild(s(e._children[n]));return t},a=s(this.graph),o=[],h=[],l=[];for(e=0;e<this.skinInstances.length;e++){var c=this.skinInstances[e].skin,d=new n.SkinInstance(c),u=[];for(t=0;t<c.boneNames.length;t++){var f=c.boneNames[t],p=a.findByName(f);u.push(p)}d.bones=u,h.push(d)}for(e=0;e<this.morphInstances.length;e++){var _=this.morphInstances[e].morph,m=new n.MorphInstance(_);l.push(m)}for(e=0;e<this.meshInstances.length;e++){var A=this.meshInstances[e],v=i.indexOf(A.node),y=new n.MeshInstance(r[v],A.mesh,A.material);if(A.skinInstance){var g=this.skinInstances.indexOf(A.skinInstance);y.skinInstance=h[g]}if(A.morphInstance){var b=this.morphInstances.indexOf(A.morphInstance);y.morphInstance=l[b]}o.push(y)}var E=new n.Model;return E.graph=a,E.meshInstances=o,E.skinInstances=h,E.morphInstances=l,E.getGraph().syncHierarchy(),E},destroy:function(){for(var e,t,i,n,r,s,a,o,h=this.meshInstances,l=0;l<h.length;l++){if(e=h[l],t=e.mesh,t&&(t._refCount--,t._refCount<1)){for(t.vertexBuffer&&(o=o||t.vertexBuffer.device,t.vertexBuffer.destroy(),t.vertexBuffer=null),a=0;a<t.indexBuffer.length;a++)o=o||t.indexBuffer.device,r=t.indexBuffer[a],r&&r.destroy();t.indexBuffer.length=0}i=e.skinInstance,i&&(s=i.boneTexture,s&&s.destroy()),e.skinInstance=null,n=e.morphInstance,n&&n.destroy(),e.morphInstance=null,e.material=null}},generateWireframe:function(){var e,t,i,r,s,a,o,h,l,c,d,u,f=[];for(e=0;e<this.meshInstances.length;e++)a=this.meshInstances[e].mesh,f.indexOf(a)===-1&&f.push(a);var p=[[0,1],[1,2],[2,0]];for(e=0;e<f.length;e++){a=f[e],o=a.primitive[n.RENDERSTYLE_SOLID].base,h=a.primitive[n.RENDERSTYLE_SOLID].count,l=a.indexBuffer[n.RENDERSTYLE_SOLID],d=new Uint16Array(l.lock());var _={},m=[];for(t=o;t<o+h;t+=3)for(i=0;i<3;i++){r=d[t+p[i][0]],s=d[t+p[i][1]];var A=r>s?s<<16|r:r<<16|s;void 0===_[A]&&(_[A]=0,m.push(r,s))}l.unlock(),c=new n.IndexBuffer(l.device,n.INDEXFORMAT_UINT16,m.length),u=new Uint16Array(c.lock()),u.set(m),c.unlock(),a.primitive[n.RENDERSTYLE_WIREFRAME]={type:n.PRIMITIVE_LINES,base:0,count:m.length,indexed:!0},a.indexBuffer[n.RENDERSTYLE_WIREFRAME]=c}}}),{Model:e}}()),Object.assign(n,function(){function e(e){return e-Math.floor(e)}function t(t){var i=e(t),n=e(255*t),r=e(65025*t),s=e(160581375*t);return i-=n/255,n-=r/255,r-=s/255,s-=s/255,[i,n,r,s]}function i(t){var i=e(t),n=e(255*t);return i-=n/255,n-=n/255,[i,n]}function r(e){return Math.max(Math.min(e,1),0)}function s(e,t){return e-t*Math.floor(e/t)}function a(e,t){void 0!==y[e]&&null!==y[e]?v[e]=y[e]:v[e]=t}function o(e,t,i){var n=255*e<<16|255*t<<8|255*i;return n/(1<<24)}function h(e,t){for(var i=e.length/3,n=new Array(4*i),r=0;r<i;r++)n[4*r]=e[3*r],n[4*r+1]=e[3*r+1],n[4*r+2]=e[3*r+2],n[4*r+3]=o(t[3*r],t[3*r+1],t[3*r+2]);return n}function l(e,t){for(var i=new Array(4*t.length),n=0;n<t.length;n++)i[4*n]=e[3*n],i[4*n+1]=e[3*n+1],i[4*n+2]=e[3*n+2],i[4*n+3]=t[n];return i}function c(e,t,i,n,r){for(var s=new Array(4*e.length),a=0;a<e.length;a++)s[4*a]=e[a],s[4*a+1]=t[a],s[4*a+2]=0,s[4*a+3]=o(i[a],n[a],r[a]);return s}function d(e){var t=Math.max(e.rate,e.rate2)*e.numParticles+e.lifetime;return Date.now()+1e3*t}function u(e,t){for(var i=new Float32Array(e.length),n=0;n<e.length;n++)i[n]=e[n]-t[n];return i}function f(e,t){var i,n,r=t.length,s=e.length/r;for(i=0;i<s;i++)for(n=0;n<r;n++){var a=Math.abs(e[i*r+n]);t[n]=Math.max(t[n],a)}}function p(e,t){var i,n,r=t.length,s=e.length/r;for(i=0;i<s;i++)for(n=0;n<r;n++)e[i*r+n]/=t[n],e[i*r+n]*=.5,e[i*r+n]+=.5}function _(e,t,i){var n=u(t,e);return f(n,i),p(n,i),n}function m(e,t){t.data[0]=e.data[0],t.data[1]=e.data[1],t.data[2]=e.data[2],t.data[3]=e.data[4],t.data[4]=e.data[5],t.data[5]=e.data[6],t.data[6]=e.data[8],t.data[7]=e.data[9],t.data[8]=e.data[10]}var A,v,y,g=[[-1,-1],[1,-1],[1,1],[-1,1]],b=function(e,t,i,r,s,a,o){s||(s=n.PIXELFORMAT_RGBA32F);var h=n.FILTER_NEAREST;o&&s===n.PIXELFORMAT_R8_G8_B8_A8&&(h=n.FILTER_LINEAR);var l=new n.Texture(e,{width:t,height:i,format:s,cubemap:!1,mipmaps:!1,minFilter:h,magFilter:h,addressU:n.ADDRESS_CLAMP_TO_EDGE,addressV:n.ADDRESS_CLAMP_TO_EDGE}),c=l.lock();if(s===n.PIXELFORMAT_R8_G8_B8_A8){for(var d=new Uint8Array(r.length),u=0;u<r.length;u++)d[u]=r[u]*a*255;r=d}return c.set(r),l.unlock(),l},E=new n.Curve([0,0,1,0]),T=new n.Curve([0,1,1,1]),S=new n.CurveSet([0,0,1,0],[0,0,1,0],[0,0,1,0]),w=new n.CurveSet([0,1,1,1],[0,1,1,1],[0,1,1,1]),C=2,M=4,P=new n.Vec3,I=new n.Vec3,R=new n.Vec3,x=new n.Vec3,O=new n.Vec3,k=new n.Vec3,D=new n.Vec3,L=new n.Vec3,N=new n.Vec3,F=new n.Mat4,B=new n.Mat3,V=new n.Mat3,U=1,G=new n.Mat4,W=new n.Vec3,z=new n.Vec3,H=new n.Vec3,j=new n.Vec3,Y=new n.Vec3,X=function(e,t){this.graphicsDevice=e;var i=e,s=32;if(this.precision=s,this._addTimeTime=0,!X.DEFAULT_PARAM_TEXTURE){var o,h,l,c,d,u,f=16,p=.5*f+.5,_=new Float32Array(f*f*4);for(h=0;h<f;h++)for(o=0;o<f;o++)l=o+1-p,c=h+1-p,u=r(1-r(Math.sqrt(l*l+c*c)/f)-.5),d=h*f+o,_[4*d]=1,_[4*d+1]=1,_[4*d+2]=1,_[4*d+3]=u;X.DEFAULT_PARAM_TEXTURE=b(i,f,f,_,n.PIXELFORMAT_R8_G8_B8_A8,1,!0),X.DEFAULT_PARAM_TEXTURE.minFilter=n.FILTER_LINEAR,X.DEFAULT_PARAM_TEXTURE.magFilter=n.FILTER_LINEAR}v=this,y=t,a("numParticles",1),
this.numParticles>e.maxTextureSize&&(console.warn("WARNING: can't create more than "+e.maxTextureSize+" particles on this device."),this.numParticles=e.maxTextureSize),a("rate",1),a("rate2",this.rate),a("lifetime",50),a("emitterExtents",new n.Vec3(0,0,0)),a("emitterRadius",0),a("emitterShape",n.EMITTERSHAPE_BOX),a("initialVelocity",1),a("wrap",!1),a("localSpace",!1),a("wrapBounds",null),a("colorMap",X.DEFAULT_PARAM_TEXTURE),a("normalMap",null),a("loop",!0),a("preWarm",!1),a("sort",n.PARTICLESORT_NONE),a("mode",n.PARTICLEMODE_GPU),a("scene",null),a("lighting",!1),a("halfLambert",!1),a("intensity",1),a("stretch",0),a("alignToMotion",!1),a("depthSoftening",0),a("mesh",null),a("depthWrite",!1),a("noFog",!1),a("blendType",n.BLEND_NORMAL),a("node",null),a("startAngle",0),a("startAngle2",this.startAngle),a("animTilesX",1),a("animTilesY",1),a("animNumFrames",1),a("animSpeed",1),a("animLoop",!0),this.frameRandom=new n.Vec3(0,0,0),a("colorGraph",w),a("colorGraph2",this.colorGraph),a("scaleGraph",T),a("scaleGraph2",this.scaleGraph),a("alphaGraph",T),a("alphaGraph2",this.alphaGraph),a("localVelocityGraph",S),a("localVelocityGraph2",this.localVelocityGraph),a("velocityGraph",S),a("velocityGraph2",this.velocityGraph),a("rotationSpeedGraph",E),a("rotationSpeedGraph2",this.rotationSpeedGraph),this.constantParticleTexIN=i.scope.resolve("particleTexIN"),this.constantParticleTexOUT=i.scope.resolve("particleTexOUT"),this.constantEmitterPos=i.scope.resolve("emitterPos"),this.constantEmitterScale=i.scope.resolve("emitterScale"),this.constantSpawnBounds=i.scope.resolve("spawnBounds"),this.constantSpawnBoundsSphere=i.scope.resolve("spawnBoundsSphere"),this.constantInitialVelocity=i.scope.resolve("initialVelocity"),this.constantFrameRandom=i.scope.resolve("frameRandom"),this.constantDelta=i.scope.resolve("delta"),this.constantRate=i.scope.resolve("rate"),this.constantRateDiv=i.scope.resolve("rateDiv"),this.constantLifetime=i.scope.resolve("lifetime"),this.constantLightCube=i.scope.resolve("lightCube[0]"),this.constantGraphSampleSize=i.scope.resolve("graphSampleSize"),this.constantGraphNumSamples=i.scope.resolve("graphNumSamples"),this.constantInternalTex0=i.scope.resolve("internalTex0"),this.constantInternalTex1=i.scope.resolve("internalTex1"),this.constantInternalTex2=i.scope.resolve("internalTex2"),this.constantEmitterMatrix=i.scope.resolve("emitterMatrix"),this.constantNumParticles=i.scope.resolve("numParticles"),this.constantNumParticlesPot=i.scope.resolve("numParticlesPot"),this.constantLocalVelocityDivMult=i.scope.resolve("localVelocityDivMult"),this.constantVelocityDivMult=i.scope.resolve("velocityDivMult"),this.constantRotSpeedDivMult=i.scope.resolve("rotSpeedDivMult"),this.constantSeed=i.scope.resolve("seed"),this.constantStartAngle=i.scope.resolve("startAngle"),this.constantStartAngle2=i.scope.resolve("startAngle2"),this.constantOutBoundsMul=i.scope.resolve("outBoundsMul"),this.constantOutBoundsAdd=i.scope.resolve("outBoundsAdd"),this.constantInBoundsSize=i.scope.resolve("inBoundsSize"),this.constantInBoundsCenter=i.scope.resolve("inBoundsCenter"),this.constantMaxVel=i.scope.resolve("maxVel"),this.lightCube=new Float32Array(18),this.lightCubeDir=new Array(6),this.lightCubeDir[0]=new n.Vec3((-1),0,0),this.lightCubeDir[1]=new n.Vec3(1,0,0),this.lightCubeDir[2]=new n.Vec3(0,(-1),0),this.lightCubeDir[3]=new n.Vec3(0,1,0),this.lightCubeDir[4]=new n.Vec3(0,0,(-1)),this.lightCubeDir[5]=new n.Vec3(0,0,1),this.animParams=new n.Vec4,this.internalTex0=null,this.internalTex1=null,this.internalTex2=null,this.internalTex3=null,this.vbToSort=null,this.vbOld=null,this.particleDistance=null,this.camera=null,this.swapTex=!1,this.useMesh=!0,this.useCpu=!1,this.pack8=!0,this.localBounds=new n.BoundingBox,this.worldBoundsNoTrail=new n.BoundingBox,this.worldBoundsTrail=[new n.BoundingBox,new n.BoundingBox],this.worldBounds=new n.BoundingBox,this.worldBoundsSize=new n.Vec3,this.prevWorldBoundsSize=new n.Vec3,this.prevWorldBoundsCenter=new n.Vec3,this.worldBoundsMul=new n.Vec3,this.worldBoundsAdd=new n.Vec3,this.timeToSwitchBounds=0,this.shaderParticleUpdateRespawn=null,this.shaderParticleUpdateNoRespawn=null,this.shaderParticleUpdateOnStop=null,this.numParticleVerts=0,this.numParticleIndices=0,this.material=null,this.meshInstance=null,this.seed=0,this.fixedTimeStep=1/60,this.maxSubSteps=10,this.simTime=0,this.simTimeTotal=0,this.beenReset=!1,this._layer=null,this.rebuild()};return Object.assign(X.prototype,{onChangeCamera:function(){this.regenShader(),this.resetMaterial()},calculateBoundsMad:function(){this.worldBoundsMul.x=1/this.worldBoundsSize.x,this.worldBoundsMul.y=1/this.worldBoundsSize.y,this.worldBoundsMul.z=1/this.worldBoundsSize.z,this.worldBoundsAdd.copy(this.worldBounds.center).mul(this.worldBoundsMul).scale(-1),this.worldBoundsAdd.x+=.5,this.worldBoundsAdd.y+=.5,this.worldBoundsAdd.z+=.5},calculateWorldBounds:function(){if(this.node){this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.worldBoundsNoTrail.setFromTransformedAabb(this.localBounds,this.node.getWorldTransform()),this.worldBoundsTrail[0].add(this.worldBoundsNoTrail);var e=this.simTimeTotal;if(e>this.timeToSwitchBounds){var t=this.worldBoundsTrail[0];this.worldBoundsTrail[0]=this.worldBoundsTrail[1],this.worldBoundsTrail[1]=t,this.worldBoundsTrail[0].copy(this.worldBoundsNoTrail),this.timeToSwitchBounds=e+this.lifetime}this.worldBounds.copy(this.worldBoundsTrail[0]),this.worldBounds.add(this.worldBoundsTrail[1]),this.worldBoundsSize.copy(this.worldBounds.halfExtents).scale(2),this.meshInstance.mesh.aabb=this.worldBounds,this.meshInstance._aabbVer=1-this.meshInstance._aabbVer,this.pack8&&this.calculateBoundsMad()}},calculateLocalBounds:function(){var e,t,i,r,s,a,o=Number.MAX_VALUE,h=Number.MAX_VALUE,l=Number.MAX_VALUE,c=-Number.MAX_VALUE,d=-Number.MAX_VALUE,u=-Number.MAX_VALUE,f=0,p=this.lifetime/this.precision,_=[this.qVelocity,this.qVelocity2,this.qLocalVelocity,this.qLocalVelocity2],m=[0,0,0,0],A=[0,0,0,0],v=[0,0,0,0];for(e=0;e<this.precision+1;e++){for(i=Math.min(e,this.precision-1),t=0;t<4;t++)r=_[t][3*i]*p+m[t],s=_[t][3*i+1]*p+A[t],a=_[t][3*i+2]*p+v[t],o>r&&(o=r),h>s&&(h=s),l>a&&(l=a),c<r&&(c=r),d<s&&(d=s),u<a&&(u=a),m[t]=r,A[t]=s,v[t]=a;f=Math.max(f,this.qScale[i])}this.emitterShape===n.EMITTERSHAPE_BOX?(r=.5*this.emitterExtents.x,s=.5*this.emitterExtents.y,a=.5*this.emitterExtents.z,c<r&&(c=r),d<s&&(d=s),u<a&&(u=a),r=-r,s=-s,a=-a,o>r&&(o=r),h>s&&(h=s),l>a&&(l=a)):(r=this.emitterRadius,s=this.emitterRadius,a=this.emitterRadius,c<r&&(c=r),d<s&&(d=s),u<a&&(u=a),r=-r,s=-s,a=-a,o>r&&(o=r),h>s&&(h=s),l>a&&(l=a)),j.x=o-f,j.y=h-f,j.z=l-f,Y.x=c+f,Y.y=d+f,Y.z=u+f,this.localBounds.setMinMax(j,Y)},rebuild:function(){var e,t=this.graphicsDevice;if(null===this.colorMap&&(this.colorMap=X.DEFAULT_PARAM_TEXTURE),this.spawnBounds=this.emitterShape===n.EMITTERSHAPE_BOX?this.emitterExtents:this.emitterRadius,this.useCpu=this.useCpu||this.sort>n.PARTICLESORT_NONE||t.maxVertexTextures<=1||t.fragmentUniformsCount<64||t.forceCpuParticles||!t.extTextureFloat,this.vertexBuffer=void 0,this.pack8=(this.pack8||!t.extTextureFloatRenderable)&&!this.useCpu,C=this.useCpu||this.pack8?4:2,this.useMesh=!1,this.mesh){var i=this.numParticles*this.mesh.vertexBuffer.numVertices;i>65535?console.warn("WARNING: particle system can't render mesh particles because numParticles * numVertices is more than 65k. Reverting to quad particles."):this.useMesh=!0}this.numParticlesPot=n.math.nextPowerOfTwo(this.numParticles),this.rebuildGraphs(),this.calculateLocalBounds(),this.node&&(this.worldBounds.setFromTransformedAabb(this.localBounds,this.node.getWorldTransform()),this.worldBoundsTrail[0].copy(this.worldBounds),this.worldBoundsTrail[1].copy(this.worldBounds),this.worldBoundsSize.copy(this.worldBounds.halfExtents).scale(2),this.prevWorldBoundsSize.copy(this.worldBoundsSize),this.prevWorldBoundsCenter.copy(this.worldBounds.center),this.pack8&&this.calculateBoundsMad()),this.vbToSort=new Array(this.numParticles),this.particleDistance=new Float32Array(this.numParticles),this.frameRandom.x=Math.random(),this.frameRandom.y=Math.random(),this.frameRandom.z=Math.random(),this.particleTex=new Float32Array(this.numParticlesPot*C*M);var r=null===this.node||this.localSpace?n.Vec3.ZERO:this.node.getPosition();for(this.emitterShape===n.EMITTERSHAPE_BOX&&(null===this.node?G.setTRS(n.Vec3.ZERO,n.Quat.IDENTITY,this.spawnBounds):G.setTRS(n.Vec3.ZERO,this.node.getRotation(),H.copy(this.spawnBounds).mul(this.node.localScale))),e=0;e<this.numParticles;e++)this.calcSpawnPosition(r,e),this.useCpu&&(this.particleTex[e*M+3+2*this.numParticlesPot*M]=1);for(this.particleTexStart=new Float32Array(this.numParticlesPot*C*M),e=0;e<this.particleTexStart.length;e++)this.particleTexStart[e]=this.particleTex[e];this.useCpu||(this.pack8?(this.particleTexIN=b(t,this.numParticlesPot,C,this.particleTex,n.PIXELFORMAT_R8_G8_B8_A8,1,!1),this.particleTexOUT=b(t,this.numParticlesPot,C,this.particleTex,n.PIXELFORMAT_R8_G8_B8_A8,1,!1),this.particleTexStart=b(t,this.numParticlesPot,C,this.particleTexStart,n.PIXELFORMAT_R8_G8_B8_A8,1,!1)):(this.particleTexIN=b(t,this.numParticlesPot,C,this.particleTex),this.particleTexOUT=b(t,this.numParticlesPot,C,this.particleTex),this.particleTexStart=b(t,this.numParticlesPot,C,this.particleTexStart)),this.rtParticleTexIN=new n.RenderTarget(t,this.particleTexIN,{depth:!1}),this.rtParticleTexOUT=new n.RenderTarget(t,this.particleTexOUT,{depth:!1}),this.swapTex=!1);var s=n.shaderChunks,a=s.particleUpdaterInitPS+(this.pack8?s.particleInputRgba8PS+s.particleOutputRgba8PS:s.particleInputFloatPS+s.particleOutputFloatPS)+(this.emitterShape===n.EMITTERSHAPE_BOX?s.particleUpdaterAABBPS:s.particleUpdaterSpherePS)+s.particleUpdaterStartPS,o=a+s.particleUpdaterRespawnPS+s.particleUpdaterEndPS,h=a+s.particleUpdaterNoRespawnPS+s.particleUpdaterEndPS,l=a+s.particleUpdaterOnStopPS+s.particleUpdaterEndPS;this.shaderParticleUpdateRespawn=s.createShaderFromCode(t,s.fullscreenQuadVS,o,"fsQuad0"+this.emitterShape+this.pack8),this.shaderParticleUpdateNoRespawn=s.createShaderFromCode(t,s.fullscreenQuadVS,h,"fsQuad1"+this.emitterShape+this.pack8),this.shaderParticleUpdateOnStop=s.createShaderFromCode(t,s.fullscreenQuadVS,l,"fsQuad2"+this.emitterShape+this.pack8),this.numParticleVerts=this.useMesh?this.mesh.vertexBuffer.numVertices:4,this.numParticleIndices=this.useMesh?this.mesh.indexBuffer[0].numIndices:6,this._allocate(this.numParticles);var c=new n.Mesh;c.vertexBuffer=this.vertexBuffer,c.indexBuffer[0]=this.indexBuffer,c.primitive[0].type=n.PRIMITIVE_TRIANGLES,c.primitive[0].base=0,c.primitive[0].count=this.numParticles*this.numParticleIndices,c.primitive[0].indexed=!0,this.material=new n.Material,this.material.cullMode=n.CULLFACE_NONE,this.material.alphaWrite=!1,this.material.blend=!0,this.material.blendType=this.blendType,this.material.depthWrite=this.depthWrite,this.material.emitter=this,this.regenShader(),this.resetMaterial(),this.meshInstance=new n.MeshInstance(this.node,c,this.material),this.meshInstance.pick=!1,this.meshInstance.updateKey(),this.meshInstance.cull=!0,this.meshInstance._noDepthDrawGl1=!0,this.meshInstance.aabb=this.worldBounds,this.meshInstance._updateAabb=!1,this._initializeTextures(),this.addTime(0),this.preWarm&&this.prewarm(this.lifetime),this.resetTime()},_isAnimated:function(){return this.animNumFrames>=1&&(this.animTilesX>1||this.animTilesY>1)&&(this.colorMap&&this.colorMap!==X.DEFAULT_PARAM_TEXTURE||this.normalMap)},calcSpawnPosition:function(e,r){var s=Math.random(),a=Math.random(),o=Math.random(),h=Math.random();this.useCpu&&(this.particleTex[r*M+0+2*this.numParticlesPot*M]=s,this.particleTex[r*M+1+2*this.numParticlesPot*M]=a,this.particleTex[r*M+2+2*this.numParticlesPot*M]=o),W.data[0]=s-.5,W.data[1]=a-.5,W.data[2]=o-.5,this.emitterShape===n.EMITTERSHAPE_BOX?z.copy(e).add(G.transformPoint(W)):(W.normalize(),z.copy(e).add(W.scale(h*this.spawnBounds)));var l,c;if(this.pack8){var d=(z.data[0]-this.worldBounds.center.data[0])/this.worldBoundsSize.data[0]+.5,u=(z.data[1]-this.worldBounds.center.data[1])/this.worldBoundsSize.data[1]+.5,f=(z.data[2]-this.worldBounds.center.data[2])/this.worldBoundsSize.data[2]+.5,p=n.math.lerp(this.startAngle*n.math.DEG_TO_RAD,this.startAngle2*n.math.DEG_TO_RAD,s);p=p%(2*Math.PI)/(2*Math.PI);var _=i(d);this.particleTex[r*M]=_[0],this.particleTex[r*M+1]=_[1];var m=i(u);this.particleTex[r*M+2]=m[0],this.particleTex[r*M+3]=m[1];var A=i(f);this.particleTex[r*M+0+this.numParticlesPot*M]=A[0],this.particleTex[r*M+1+this.numParticlesPot*M]=A[1];var v=i(p);this.particleTex[r*M+2+this.numParticlesPot*M]=v[0],this.particleTex[r*M+3+this.numParticlesPot*M]=v[1];var y=1;this.particleTex[r*M+3+this.numParticlesPot*M*2]=y,l=n.math.lerp(this.rate,this.rate2,s),c=-l*r;var g=Math.max(this.lifetime,(this.numParticles-1)*Math.max(this.rate,this.rate2)),b=this.lifetime+1;c=(c+g)/(g+b);var E=t(c);this.particleTex[r*M+0+this.numParticlesPot*M*3]=E[0],this.particleTex[r*M+1+this.numParticlesPot*M*3]=E[1],this.particleTex[r*M+2+this.numParticlesPot*M*3]=E[2],this.particleTex[r*M+3+this.numParticlesPot*M*3]=E[3]}else this.particleTex[r*M]=z.data[0],this.particleTex[r*M+1]=z.data[1],this.particleTex[r*M+2]=z.data[2],this.particleTex[r*M+3]=n.math.lerp(this.startAngle*n.math.DEG_TO_RAD,this.startAngle2*n.math.DEG_TO_RAD,s),l=n.math.lerp(this.rate,this.rate2,s),c=-l*r,this.particleTex[r*M+3+this.numParticlesPot*M]=c},rebuildGraphs:function(){var e,t=this.precision,i=this.graphicsDevice;for(this.qLocalVelocity=this.localVelocityGraph.quantize(t),this.qVelocity=this.velocityGraph.quantize(t),this.qColor=this.colorGraph.quantize(t),this.qRotSpeed=this.rotationSpeedGraph.quantize(t),this.qScale=this.scaleGraph.quantize(t),this.qAlpha=this.alphaGraph.quantize(t),this.qLocalVelocity2=this.localVelocityGraph2.quantize(t),this.qVelocity2=this.velocityGraph2.quantize(t),this.qColor2=this.colorGraph2.quantize(t),this.qRotSpeed2=this.rotationSpeedGraph2.quantize(t),this.qScale2=this.scaleGraph2.quantize(t),this.qAlpha2=this.alphaGraph2.quantize(t),e=0;e<t;e++)this.qRotSpeed[e]*=n.math.DEG_TO_RAD,this.qRotSpeed2[e]*=n.math.DEG_TO_RAD;if(this.localVelocityUMax=new n.Vec3(0,0,0),this.velocityUMax=new n.Vec3(0,0,0),this.colorUMax=new n.Vec3(0,0,0),this.rotSpeedUMax=[0],this.scaleUMax=[0],this.alphaUMax=[0],this.qLocalVelocityDiv=_(this.qLocalVelocity,this.qLocalVelocity2,this.localVelocityUMax.data),this.qVelocityDiv=_(this.qVelocity,this.qVelocity2,this.velocityUMax.data),this.qColorDiv=_(this.qColor,this.qColor2,this.colorUMax.data),this.qRotSpeedDiv=_(this.qRotSpeed,this.qRotSpeed2,this.rotSpeedUMax),this.qScaleDiv=_(this.qScale,this.qScale2,this.scaleUMax),this.qAlphaDiv=_(this.qAlpha,this.qAlpha2,this.alphaUMax),this.pack8){var r=[0,0,0];f(this.qVelocity,r);var s=[0,0,0];f(this.qVelocity2,s);var a=[0,0,0];f(this.qLocalVelocity,a);var o=[0,0,0];f(this.qLocalVelocity2,o);var d=Math.max(r[0],s[0]);d=Math.max(d,r[1]),d=Math.max(d,s[1]),d=Math.max(d,r[2]),d=Math.max(d,s[2]);var u=Math.max(a[0],o[0]);u=Math.max(u,a[1]),u=Math.max(u,o[1]),u=Math.max(u,a[2]),u=Math.max(u,o[2]),this.maxVel=d+u}this.useCpu||(this.internalTex0=b(i,t,1,h(this.qLocalVelocity,this.qLocalVelocityDiv)),this.internalTex1=b(i,t,1,h(this.qVelocity,this.qVelocityDiv)),this.internalTex2=b(i,t,1,c(this.qRotSpeed,this.qScale,this.qScaleDiv,this.qRotSpeedDiv,this.qAlphaDiv))),this.internalTex3=b(i,t,1,l(this.qColor,this.qAlpha),n.PIXELFORMAT_R8_G8_B8_A8,1,!0)},_initializeTextures:function(){this.colorMap&&(this.material.setParameter("colorMap",this.colorMap),this.lighting&&this.normalMap&&this.material.setParameter("normalMap",this.normalMap))},regenShader:function(){var e=this.graphicsDevice.getProgramLibrary(),t=null!==this.normalMap;this.normalOption=0,this.lighting&&(this.normalOption=t?2:1),this.material.updateShader=function(){this.emitter.scene&&this.emitter.camera!=this.emitter.scene._activeCamera&&(this.emitter.camera=this.emitter.scene._activeCamera,this.emitter.onChangeCamera());var t=e.getProgram("particle",{useCpu:this.emitter.useCpu,normal:this.emitter.normalOption,halflambert:this.emitter.halfLambert,stretch:this.emitter.stretch,alignToMotion:this.emitter.alignToMotion,soft:this.emitter.depthSoftening,mesh:this.emitter.useMesh,gamma:this.emitter.scene?this.emitter.scene.gammaCorrection:0,toneMap:this.emitter.scene?this.emitter.scene.toneMapping:0,fog:this.emitter.scene&&!this.emitter.noFog?this.emitter.scene.fog:"none",wrap:this.emitter.wrap&&this.emitter.wrapBounds,localSpace:this.emitter.localSpace,blend:this.blendType,animTex:this.emitter._isAnimated(),animTexLoop:this.emitter.animLoop,pack8:this.emitter.pack8});this.setShader(t)},this.material.updateShader()},resetMaterial:function(){var e=this.material;e.setParameter("stretch",this.stretch),this._isAnimated()&&e.setParameter("animTexParams",this.animParams.data),e.setParameter("colorMult",this.intensity),this.useCpu||(e.setParameter("internalTex0",this.internalTex0),e.setParameter("internalTex1",this.internalTex1),e.setParameter("internalTex2",this.internalTex2)),e.setParameter("internalTex3",this.internalTex3),e.setParameter("numParticles",this.numParticles),e.setParameter("numParticlesPot",this.numParticlesPot),e.setParameter("lifetime",this.lifetime),e.setParameter("rate",this.rate),e.setParameter("rateDiv",this.rate2-this.rate),e.setParameter("seed",this.seed),e.setParameter("scaleDivMult",this.scaleUMax[0]),e.setParameter("alphaDivMult",this.alphaUMax[0]),e.setParameter("graphNumSamples",this.precision),e.setParameter("graphSampleSize",1/this.precision),e.setParameter("emitterScale",n.Vec3.ONE.data),this.pack8&&(e.setParameter("inBoundsSize",this.worldBoundsSize.data),e.setParameter("inBoundsCenter",this.worldBounds.center.data),e.setParameter("maxVel",this.maxVel)),this.wrap&&this.wrapBounds&&e.setParameter("wrapBounds",this.wrapBounds.data),this.colorMap&&e.setParameter("colorMap",this.colorMap),this.lighting&&this.normalMap&&e.setParameter("normalMap",this.normalMap),this.depthSoftening>0&&e.setParameter("softening",1/(this.depthSoftening*this.depthSoftening*100)),this.stretch>0&&(e.cull=n.CULLFACE_NONE)},_allocate:function(e){var t,i,r,s=e*this.numParticleVerts,a=e*this.numParticleIndices;if(void 0===this.vertexBuffer||this.vertexBuffer.getNumVertices()!==s){this.useCpu?(t=[{semantic:n.SEMANTIC_ATTR0,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_ATTR1,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_ATTR2,components:4,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_ATTR3,components:2,type:n.TYPE_FLOAT32}],i=new n.VertexFormat(this.graphicsDevice,t),this.vertexBuffer=new n.VertexBuffer(this.graphicsDevice,i,s,n.BUFFER_DYNAMIC),this.indexBuffer=new n.IndexBuffer(this.graphicsDevice,n.INDEXFORMAT_UINT16,a)):(t=[{semantic:n.SEMANTIC_ATTR0,components:4,type:n.TYPE_FLOAT32}],i=new n.VertexFormat(this.graphicsDevice,t),this.vertexBuffer=new n.VertexBuffer(this.graphicsDevice,i,s,n.BUFFER_DYNAMIC),this.indexBuffer=new n.IndexBuffer(this.graphicsDevice,n.INDEXFORMAT_UINT16,a));var o,h,l=new Float32Array(this.vertexBuffer.lock());this.useMesh&&(o=new Float32Array(this.mesh.vertexBuffer.lock()),h=o.length/this.mesh.vertexBuffer.numVertices);var c;for(r=0;r<s;r++){if(c=Math.floor(r/this.numParticleVerts),this.useMesh){var d=r%this.numParticleVerts;l[4*r]=o[d*h],l[4*r+1]=o[d*h+1],l[4*r+2]=o[d*h+2]}else{var u=r%4;l[4*r]=g[u][0],l[4*r+1]=g[u][1],l[4*r+2]=0}l[4*r+3]=c}this.useCpu&&(this.vbCPU=new Float32Array(l),this.vbOld=new Float32Array(this.vbCPU.length)),this.vertexBuffer.unlock(),this.useMesh&&this.mesh.vertexBuffer.unlock();var f=0,p=new Uint16Array(this.indexBuffer.lock());for(this.useMesh&&(o=new Uint16Array(this.mesh.indexBuffer[0].lock())),r=0;r<e;r++)if(this.useMesh)for(var _=0;_<this.numParticleIndices;_++)p[r*this.numParticleIndices+_]=o[_]+r*this.numParticleVerts;else{var m=4*r;p[f++]=m,p[f++]=m+1,p[f++]=m+2,p[f++]=m,p[f++]=m+2,p[f++]=m+3}this.indexBuffer.unlock(),this.useMesh&&this.mesh.indexBuffer[0].unlock()}},reset:function(){if(this.beenReset=!0,this.seed=Math.random(),this.material.setParameter("seed",this.seed),this.useCpu)for(var e=0;e<this.particleTexStart.length;e++)this.particleTex[e]=this.particleTexStart[e];else this._initializeTextures();this.resetTime();var t=this.loop;this.loop=!0,this.addTime(0),this.loop=t,this.preWarm&&this.prewarm(this.lifetime)},prewarm:function(e){for(var t=e/this.lifetime,i=Math.min(Math.floor(t*this.precision),this.precision),n=e/i,r=0;r<i;r++)this.addTime(n)},resetTime:function(){this.endTime=d(this)},finishFrame:function(){this.useCpu&&this.vertexBuffer.unlock()},addTime:function(e,t){var i,a,o,h,l,c=this.graphicsDevice;if(this.simTimeTotal+=e,this.calculateWorldBounds(),this._isAnimated()){var d=this.animParams;d.x=1/this.animTilesX,d.y=1/this.animTilesY,d.z=this.animNumFrames*this.animSpeed,d.w=this.animNumFrames-1}this.scene&&this.camera!=this.scene._activeCamera&&(this.camera=this.scene._activeCamera,this.onChangeCamera()),this.emitterShape===n.EMITTERSHAPE_BOX&&(null===this.meshInstance.node?G.setTRS(n.Vec3.ZERO,n.Quat.IDENTITY,this.emitterExtents):G.setTRS(n.Vec3.ZERO,this.meshInstance.node.getRotation(),H.copy(this.emitterExtents).mul(this.meshInstance.node.localScale)));var u,f=null===this.meshInstance.node?n.Vec3.ONE.data:this.meshInstance.node.localScale.data;if(this.material.setParameter("emitterScale",f),this.localSpace&&this.meshInstance.node&&this.material.setParameter("emitterPos",this.meshInstance.node.getPosition().data),this.useCpu){var p=new Float32Array(this.vertexBuffer.lock());if(this.meshInstance.node){var _=this.meshInstance.node.worldTransform;for(l=0;l<12;l++)F.data[l]=_.data[l];A=this.meshInstance.node.localScale,U=Math.max(Math.max(A.x,A.y),A.z)}u=null===this.meshInstance.node||this.localSpace?n.Vec3.ZERO:this.meshInstance.node.getPosition();var v,y,g,b,E,T,S,w=this.camera?this.camera._node.getPosition():n.Vec3.ZERO,C=14,z=this.precision-1;for(h=0;h<this.numParticles;h++){var j=Math.floor(this.vbCPU[h*this.numParticleVerts*4+3]),Y=this.particleTex[j*M+0+2*this.numParticlesPot*M];O.data[0]=Y,O.data[1]=this.particleTex[j*M+1+2*this.numParticlesPot*M],O.data[2]=this.particleTex[j*M+2+2*this.numParticlesPot*M];var X=this.rate+(this.rate2-this.rate)*Y,Z=this.lifetime,K=this.particleTex[j*M+3+this.numParticlesPot*M]+e,Q=r(K/Z),J=0,q=0,$=0,ee=K>0&&K<Z;ee?(o=Q*z,v=Math.floor(o),y=Math.ceil(o),o%=1,i=this.qRotSpeed[v],a=this.qRotSpeed[y],g=i+(a-i)*o,i=this.qRotSpeed2[v],a=this.qRotSpeed2[y],b=i+(a-i)*o,i=this.qScale[v],a=this.qScale[y],J=i+(a-i)*o,i=this.qScale2[v],a=this.qScale2[y],E=i+(a-i)*o,i=this.qAlpha[v],a=this.qAlpha[y],T=i+(a-i)*o,i=this.qAlpha2[v],a=this.qAlpha2[y],S=i+(a-i)*o,v*=3,y*=3,i=this.qLocalVelocity[v],a=this.qLocalVelocity[y],I.data[0]=i+(a-i)*o,i=this.qLocalVelocity[v+1],a=this.qLocalVelocity[y+1],I.data[1]=i+(a-i)*o,i=this.qLocalVelocity[v+2],a=this.qLocalVelocity[y+2],I.data[2]=i+(a-i)*o,i=this.qLocalVelocity2[v],a=this.qLocalVelocity2[y],x.data[0]=i+(a-i)*o,i=this.qLocalVelocity2[v+1],a=this.qLocalVelocity2[y+1],x.data[1]=i+(a-i)*o,i=this.qLocalVelocity2[v+2],a=this.qLocalVelocity2[y+2],x.data[2]=i+(a-i)*o,i=this.qVelocity[v],a=this.qVelocity[y],P.data[0]=i+(a-i)*o,i=this.qVelocity[v+1],a=this.qVelocity[y+1],P.data[1]=i+(a-i)*o,i=this.qVelocity[v+2],a=this.qVelocity[y+2],P.data[2]=i+(a-i)*o,i=this.qVelocity2[v],a=this.qVelocity2[y],R.data[0]=i+(a-i)*o,i=this.qVelocity2[v+1],a=this.qVelocity2[y+1],R.data[1]=i+(a-i)*o,i=this.qVelocity2[v+2],a=this.qVelocity2[y+2],R.data[2]=i+(a-i)*o,I.data[0]+=(x.data[0]-I.data[0])*O.data[0],I.data[1]+=(x.data[1]-I.data[1])*O.data[1],I.data[2]+=(x.data[2]-I.data[2])*O.data[2],this.initialVelocity>0&&(this.emitterShape===n.EMITTERSHAPE_SPHERE?(W.copy(O).scale(2).sub(n.Vec3.ONE).normalize(),I.add(W.scale(this.initialVelocity))):I.add(n.Vec3.FORWARD.scale(this.initialVelocity))),P.data[0]+=(R.data[0]-P.data[0])*O.data[0],P.data[1]+=(R.data[1]-P.data[1])*O.data[1],P.data[2]+=(R.data[2]-P.data[2])*O.data[2],g+=(b-g)*O.data[1],J=(J+(E-J)*(1e4*Y%1))*U,q=(S-T)*(1e3*Y%1),this.meshInstance.node&&F.transformPoint(I,I),I.add(P.mul(A)),N.copy(I),k.data[0]=this.particleTex[j*M],k.data[1]=this.particleTex[j*M+1],k.data[2]=this.particleTex[j*M+2],D.copy(k).add(I.scale(e)),L.copy(D),this.particleTex[j*M]=L.data[0],this.particleTex[j*M+1]=L.data[1],this.particleTex[j*M+2]=L.data[2],this.particleTex[j*M+3]+=g*e,this.wrap&&this.wrapBounds&&(L.sub(u),L.data[0]=s(L.data[0],this.wrapBounds.data[0])-.5*this.wrapBounds.data[0],L.data[1]=s(L.data[1],this.wrapBounds.data[1])-.5*this.wrapBounds.data[1],L.data[2]=s(L.data[2],this.wrapBounds.data[2])-.5*this.wrapBounds.data[2],L.add(u)),this.sort>0&&(1===this.sort?(H.copy(L).sub(w),this.particleDistance[j]=-(H.data[0]*H.data[0]+H.data[1]*H.data[1]+H.data[2]*H.data[2])):2===this.sort?this.particleDistance[j]=K:3===this.sort&&(this.particleDistance[j]=-K))):this.calcSpawnPosition(u,j),t?K<0&&(this.particleTex[j*M+3+2*this.numParticlesPot*M]=-1):(K>=Z&&(K-=Math.max(Z,(this.numParticles-1)*X),this.particleTex[j*M+3+2*this.numParticlesPot*M]=this.loop?1:-1),K<0&&this.loop&&(this.particleTex[j*M+3+2*this.numParticlesPot*M]=1)),this.particleTex[j*M+3+2*this.numParticlesPot*M]<0&&(ee=!1),this.particleTex[j*M+3+this.numParticlesPot*M]=K;for(var te=0;te<this.numParticleVerts;te++){var ie=this.vbCPU[h*this.numParticleVerts*4+4*te],ne=this.vbCPU[h*this.numParticleVerts*4+4*te+1],re=this.vbCPU[h*this.numParticleVerts*4+4*te+2];ee||(ie=ne=re=0);var se=h*this.numParticleVerts*C+te*C;p[se]=L.data[0],p[se+1]=L.data[1],p[se+2]=L.data[2],p[se+3]=Q,p[se+4]=this.alignToMotion?$:this.particleTex[j*M+3],p[se+5]=J,p[se+6]=q,p[se+7]=N.data[0],p[se+8]=ie,p[se+9]=ne,p[se+10]=re,p[se+11]=N.data[1],p[se+12]=N.data[2]}}if(this.sort>n.PARTICLESORT_NONE&&this.camera){var ae=this.particleDistance;for(h=0;h<this.numParticles;h++)this.vbToSort[h]=[h,ae[Math.floor(this.vbCPU[h*this.numParticleVerts*4+3])]];for(this.vbOld.set(this.vbCPU),this.vbToSort.sort(function(e,t){return e[1]-t[1]}),h=0;h<this.numParticles;h++){var oe=this.vbToSort[h][0]*this.numParticleVerts*4,he=h*this.numParticleVerts*4;for(l=0;l<4*this.numParticleVerts;l++)this.vbCPU[he+l]=this.vbOld[oe+l]}}}else{if(c.setBlending(!1),c.setColorWrite(!0,!0,!0,!0),c.setCullMode(n.CULLFACE_NONE),c.setDepthTest(!1),c.setDepthWrite(!1),this.frameRandom.x=Math.random(),this.frameRandom.y=Math.random(),this.frameRandom.z=Math.random(),this.constantGraphSampleSize.setValue(1/this.precision),this.constantGraphNumSamples.setValue(this.precision),this.constantNumParticles.setValue(this.numParticles),this.constantNumParticlesPot.setValue(this.numParticlesPot),this.constantInternalTex0.setValue(this.internalTex0),this.constantInternalTex1.setValue(this.internalTex1),this.constantInternalTex2.setValue(this.internalTex2),this.pack8){this.constantOutBoundsMul.setValue(this.worldBoundsMul.data),this.constantOutBoundsAdd.setValue(this.worldBoundsAdd.data),this.constantInBoundsSize.setValue(this.prevWorldBoundsSize.data),this.constantInBoundsCenter.setValue(this.prevWorldBoundsCenter.data);var le=this.maxVel*Math.max(Math.max(f[0],f[1]),f[2]);le=Math.max(le,1),this.constantMaxVel.setValue(le)}u=null===this.meshInstance.node||this.localSpace?n.Vec3.ZERO.data:this.meshInstance.node.getPosition().data;var ce=null===this.meshInstance.node?n.Mat4.IDENTITY:this.meshInstance.node.getWorldTransform();this.emitterShape===n.EMITTERSHAPE_BOX?(m(G,B),this.constantSpawnBounds.setValue(B.data)):this.constantSpawnBoundsSphere.setValue(this.emitterRadius),this.constantInitialVelocity.setValue(this.initialVelocity),m(ce,V),this.constantEmitterPos.setValue(u),this.constantFrameRandom.setValue(this.frameRandom.data),this.constantDelta.setValue(e),this.constantRate.setValue(this.rate),this.constantRateDiv.setValue(this.rate2-this.rate),this.constantStartAngle.setValue(this.startAngle*n.math.DEG_TO_RAD),this.constantStartAngle2.setValue(this.startAngle2*n.math.DEG_TO_RAD),this.constantSeed.setValue(this.seed),this.constantLifetime.setValue(this.lifetime),this.constantEmitterScale.setValue(f),this.constantEmitterMatrix.setValue(V.data),this.constantLocalVelocityDivMult.setValue(this.localVelocityUMax.data),this.constantVelocityDivMult.setValue(this.velocityUMax.data),this.constantRotSpeedDivMult.setValue(this.rotSpeedUMax[0]);var de=this.swapTex?this.particleTexOUT:this.particleTexIN;de=this.beenReset?this.particleTexStart:de;var ue=this.swapTex?this.particleTexIN:this.particleTexOUT;this.constantParticleTexIN.setValue(de),t?n.drawQuadWithShader(c,this.swapTex?this.rtParticleTexIN:this.rtParticleTexOUT,this.shaderParticleUpdateOnStop):n.drawQuadWithShader(c,this.swapTex?this.rtParticleTexIN:this.rtParticleTexOUT,this.loop?this.shaderParticleUpdateRespawn:this.shaderParticleUpdateNoRespawn),this.constantParticleTexOUT.setValue(ue),this.material.setParameter("particleTexOUT",de),this.material.setParameter("particleTexIN",ue),this.beenReset=!1,this.swapTex=!this.swapTex,c.setDepthTest(!0),c.setDepthWrite(!0)}this.loop||Date.now()>this.endTime&&(this.onFinished&&this.onFinished(),this.meshInstance.visible=!1)},destroy:function(){this.particleTexIN&&this.particleTexIN.destroy(),this.particleTexOUT&&this.particleTexOUT.destroy(),!this.useCpu&&this.particleTexStart&&this.particleTexStart.destroy(),this.rtParticleTexIN&&this.rtParticleTexIN.destroy(),this.rtParticleTexOUT&&this.rtParticleTexOUT.destroy(),this.particleTexIN=null,this.particleTexOUT=null,this.particleTexStart=null,this.rtParticleTexIN=null,this.rtParticleTexOUT=null,this.shaderParticleUpdateRespawn=null,this.shaderParticleUpdateNoRespawn=null,this.shaderParticleUpdateOnStop=null}}),{ParticleEmitter:X}}()),Object.assign(n,function(){var e=!1,t=function(t,i,r){t instanceof n.GraphicsDevice&&(t=n.Application.getApplication(),e||(e=!0)),this.app=t,this.device=t.graphicsDevice;var s=this.device;this.library=s.getProgramLibrary(),this.pickColor=new Float32Array(4),this.pickColor[3]=1,this.scene=null,this.drawCalls=[],this.layer=null,this.layerComp=null,this.clearOptions={color:[1,1,1,1],depth:1,flags:n.CLEARFLAG_COLOR|n.CLEARFLAG_DEPTH};var a=this;this._clearDepthOptions={depth:1,flags:n.CLEARFLAG_DEPTH},this.clearDepthCommand=new n.Command(0,0,function(){s.clear(a._clearDepthOptions)}),this.resize(i,r),this._ignoreOpacityFor=null};return t.prototype.getSelection=function(e,t,i,n){var r=this.device;if("object"==typeof e){var s=e;e=s.x,t=s.y,i=s.width,n=s.height}else t=this.layer.renderTarget.height-(t+(n||1));i=i||1,n=n||1;var a=r.renderTarget;r.setRenderTarget(this.layer.renderTarget),r.updateBegin();var o=new Uint8Array(4*i*n);r.readPixels(e,t,i,n,o),r.updateEnd(),r.setRenderTarget(a);for(var h,l,c,d,u=[],f=this.layer.instances.visibleOpaque[0].list,p=0;p<i*n;p++)if(h=o[4*p+0],l=o[4*p+1],c=o[4*p+2],d=h<<16|l<<8|c,16777215!==d){var _=f[d];u.indexOf(_)===-1&&u.push(_)}return u},t.prototype.prepare=function(e,t,i){var r,s,a=this.device,o=this;e instanceof n.Camera&&(e=e._component),this.scene=t;var h=null,l=null;if(i instanceof n.Layer?h=i:l=i,!this.layer){var c=a.scope.resolve("uColor");this.layer=new n.Layer({name:"Picker",shaderPass:n.SHADER_PICK,opaqueSortMode:n.SORTMODE_NONE,onEnable:function(){if(!this.renderTarget){var e=new n.Texture(a,{format:n.PIXELFORMAT_R8_G8_B8_A8,width:o.width,height:o.height});e.minFilter=n.FILTER_NEAREST,e.magFilter=n.FILTER_NEAREST,e.addressU=n.ADDRESS_CLAMP_TO_EDGE,e.addressV=n.ADDRESS_CLAMP_TO_EDGE,this.renderTarget=new n.RenderTarget(a,e,{depth:!0})}},onDisable:function(){this.renderTarget&&(this.renderTarget._colorBuffer.destroy(),this.renderTarget.destroy(),this.renderTarget=null)},onDrawCall:function(e,t){o.pickColor[0]=(t>>16&255)/255,o.pickColor[1]=(t>>8&255)/255,o.pickColor[2]=(255&t)/255,c.setValue(o.pickColor),a.setBlending(!1)},onPreCull:function(){this.oldAspectMode=this.cameras[0].aspectRatioMode,this.oldAspect=this.cameras[0].aspectRatio,this.cameras[0].aspectRatioMode=n.ASPECT_MANUAL;var e=l?l:h?h.renderTarget:null;this.cameras[0].aspectRatio=this.cameras[0].calculateAspectRatio(e),
o.app.renderer.updateCameraFrustum(this.cameras[0].camera)},onPostCull:function(){this.cameras[0].aspectRatioMode=this.oldAspectMode,this.cameras[0].aspectRatio=this.oldAspect}}),this.layerComp=new n.LayerComposition,this.layerComp.pushOpaque(this.layer),this.meshInstances=this.layer.opaqueMeshInstances,this._instancesVersion=-1}var d,u,f;if(h){if(this._instancesVersion!==h._version){for(this.layer.clearMeshInstances(),d=h.instances.opaqueMeshInstances,u=d.length,s=0;s<u;s++)f=d[s],f.pick&&this.meshInstances.push(f);for(d=h.instances.transparentMeshInstances,u=d.length,s=0;s<u;s++)f=d[s],f.pick&&this.meshInstances.push(f);this._instancesVersion=h._version}}else{this.layer.clearMeshInstances();var p,_,m,A=t.layers.layerList,v=t.layers.subLayerEnabled,y=t.layers.subLayerList;for(r=0;r<A.length;r++)A[r].overrideClear&&A[r]._clearDepthBuffer&&(A[r]._pickerCleared=!1);for(r=0;r<A.length;r++)if(p=A[r],p.renderTarget===l&&p.enabled&&v[r]&&(_=p.cameras.indexOf(e),!(_<0)))for(p.overrideClear&&p._clearDepthBuffer&&!p._pickerCleared&&(this.meshInstances.push(this.clearDepthCommand),p._pickerCleared=!0),m=y[r],d=m?p.instances.transparentMeshInstances:p.instances.opaqueMeshInstances,u=d.length,s=0;s<u;s++)f=d[s],f.pick&&this.meshInstances.push(f)}this.layer.cameras[0]!==e&&(this.layer.clearCameras(),this.layer.addCamera(e)),this.onLayerPreRender(this.layer,h,l),this.app.renderer.renderComposition(this.layerComp),this.onLayerPostRender(this.layer)},t.prototype.onLayerPreRender=function(e,t,i){this.width===e.renderTarget.width&&this.height===e.renderTarget.height||(e.onDisable(),e.onEnable()),e.oldClear=e.cameras[0].camera._clearOptions,e.oldAspectMode=e.cameras[0].aspectRatioMode,e.oldAspect=e.cameras[0].aspectRatio,e.cameras[0].camera._clearOptions=this.clearOptions,e.cameras[0].aspectRatioMode=n.ASPECT_MANUAL;var r=i?i:t?t.renderTarget:null;e.cameras[0].aspectRatio=e.cameras[0].calculateAspectRatio(r)},t.prototype.onLayerPostRender=function(e){e.cameras[0].camera._clearOptions=e.oldClear,e.cameras[0].aspectRatioMode=e.oldAspectMode,e.cameras[0].aspectRatio=e.oldAspect},t.prototype.resize=function(e,t){this.width=e,this.height=t},Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this.layer.renderTarget}}),{Picker:t}}());var E=4/64,T=1-2*E;return n.calculateNormals=function(e,t){var i,r,s,a,o=t.length/3,h=e.length/3,l=new n.Vec3,c=new n.Vec3,d=new n.Vec3,u=new n.Vec3,f=new n.Vec3,p=new n.Vec3,_=[];for(a=0;a<e.length;a++)_[a]=0;for(a=0;a<o;a++)i=t[3*a],r=t[3*a+1],s=t[3*a+2],l.set(e[3*i],e[3*i+1],e[3*i+2]),c.set(e[3*r],e[3*r+1],e[3*r+2]),d.set(e[3*s],e[3*s+1],e[3*s+2]),u.sub2(c,l),f.sub2(d,l),p.cross(u,f).normalize(),_[3*i]+=p.x,_[3*i+1]+=p.y,_[3*i+2]+=p.z,_[3*r]+=p.x,_[3*r+1]+=p.y,_[3*r+2]+=p.z,_[3*s]+=p.x,_[3*s+1]+=p.y,_[3*s+2]+=p.z;for(a=0;a<h;a++){var m=_[3*a],A=_[3*a+1],v=_[3*a+2],y=1/Math.sqrt(m*m+A*A+v*v);_[3*a]*=y,_[3*a+1]*=y,_[3*a+2]*=y}return _},n.calculateTangents=function(e,t,i,r){var s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g=r.length/3,b=e.length/3,E=new n.Vec3,T=new n.Vec3,S=new n.Vec3,w=new n.Vec3,C=new n.Vec3,M=new n.Vec2,P=new n.Vec2,I=new n.Vec2,R=new Float32Array(3*b),x=new Float32Array(3*b),O=[],k=0;for(y=0;y<g;y++)s=r[3*y],a=r[3*y+1],o=r[3*y+2],S.set(e[3*s],e[3*s+1],e[3*s+2]),w.set(e[3*a],e[3*a+1],e[3*a+2]),C.set(e[3*o],e[3*o+1],e[3*o+2]),M.set(i[2*s],i[2*s+1]),P.set(i[2*a],i[2*a+1]),I.set(i[2*o],i[2*o+1]),h=w.x-S.x,l=C.x-S.x,c=w.y-S.y,d=C.y-S.y,u=w.z-S.z,f=C.z-S.z,p=P.x-M.x,_=I.x-M.x,m=P.y-M.y,A=I.y-M.y,k=p*A-_*m,0==k?(E.set(0,1,0),T.set(1,0,0)):(v=1/k,E.set((A*h-m*l)*v,(A*c-m*d)*v,(A*u-m*f)*v),T.set((p*l-_*h)*v,(p*d-_*c)*v,(p*f-_*u)*v)),R[3*s+0]+=E.x,R[3*s+1]+=E.y,R[3*s+2]+=E.z,R[3*a+0]+=E.x,R[3*a+1]+=E.y,R[3*a+2]+=E.z,R[3*o+0]+=E.x,R[3*o+1]+=E.y,R[3*o+2]+=E.z,x[3*s+0]+=T.x,x[3*s+1]+=T.y,x[3*s+2]+=T.z,x[3*a+0]+=T.x,x[3*a+1]+=T.y,x[3*a+2]+=T.z,x[3*o+0]+=T.x,x[3*o+1]+=T.y,x[3*o+2]+=T.z;m=new n.Vec3,A=new n.Vec3;var D=new n.Vec3,L=new n.Vec3;for(y=0;y<b;y++){D.set(t[3*y],t[3*y+1],t[3*y+2]),m.set(R[3*y],R[3*y+1],R[3*y+2]),A.set(x[3*y],x[3*y+1],x[3*y+2]);var N=D.dot(m);L.copy(D).scale(N),L.sub2(m,L).normalize(),O[4*y]=L.x,O[4*y+1]=L.y,O[4*y+2]=L.z,L.cross(D,m),O[4*y+3]=L.dot(A)<0?-1:1}return O},n.createMesh=function(e,t,i){var r=i&&void 0!==i.normals?i.normals:null,s=i&&void 0!==i.tangents?i.tangents:null,a=i&&void 0!==i.colors?i.colors:null,o=i&&void 0!==i.uvs?i.uvs:null,h=i&&void 0!==i.uvs1?i.uvs1:null,l=i&&void 0!==i.indices?i.indices:null,c=i&&void 0!==i.blendIndices?i.blendIndices:null,d=i&&void 0!==i.blendWeights?i.blendWeights:null,u=[{semantic:n.SEMANTIC_POSITION,components:3,type:n.TYPE_FLOAT32}];null!==r&&u.push({semantic:n.SEMANTIC_NORMAL,components:3,type:n.TYPE_FLOAT32}),null!==s&&u.push({semantic:n.SEMANTIC_TANGENT,components:4,type:n.TYPE_FLOAT32}),null!==a&&u.push({semantic:n.SEMANTIC_COLOR,components:4,type:n.TYPE_UINT8,normalize:!0}),null!==o&&u.push({semantic:n.SEMANTIC_TEXCOORD0,components:2,type:n.TYPE_FLOAT32}),null!==h&&u.push({semantic:n.SEMANTIC_TEXCOORD1,components:2,type:n.TYPE_FLOAT32}),null!==c&&u.push({semantic:n.SEMANTIC_BLENDINDICES,components:2,type:n.TYPE_UINT8}),null!==d&&u.push({semantic:n.SEMANTIC_BLENDWEIGHT,components:2,type:n.TYPE_FLOAT32});for(var f=new n.VertexFormat(e,u),p=t.length/3,_=new n.VertexBuffer(e,f,p),m=new n.VertexIterator(_),A=0;A<p;A++)m.element[n.SEMANTIC_POSITION].set(t[3*A],t[3*A+1],t[3*A+2]),null!==r&&m.element[n.SEMANTIC_NORMAL].set(r[3*A],r[3*A+1],r[3*A+2]),null!==s&&m.element[n.SEMANTIC_TANGENT].set(s[4*A],s[4*A+1],s[4*A+2],s[4*A+3]),null!==a&&m.element[n.SEMANTIC_COLOR].set(a[4*A],a[4*A+1],a[4*A+2],a[4*A+3]),null!==o&&m.element[n.SEMANTIC_TEXCOORD0].set(o[2*A],o[2*A+1]),null!==h&&m.element[n.SEMANTIC_TEXCOORD1].set(h[2*A],h[2*A+1]),null!==c&&m.element[n.SEMANTIC_BLENDINDICES].set(c[2*A],c[2*A+1]),null!==d&&m.element[n.SEMANTIC_BLENDWEIGHT].set(d[2*A],d[2*A+1]),m.next();m.end();var v=null,y=null!==l;if(y){v=new n.IndexBuffer(e,n.INDEXFORMAT_UINT16,l.length);var g=new Uint16Array(v.lock());g.set(l),v.unlock()}var b=new n.BoundingBox;b.compute(t);var E=new n.Mesh;return E.vertexBuffer=_,E.indexBuffer[0]=v,E.primitive[0].type=n.PRIMITIVE_TRIANGLES,E.primitive[0].base=0,E.primitive[0].count=y?l.length:p,E.primitive[0].indexed=y,E.aabb=b,E},n.createTorus=function(e,t){var i,r,s,a,o,h,l,c,d,u,f=t&&void 0!==t.tubeRadius?t.tubeRadius:.2,p=t&&void 0!==t.ringRadius?t.ringRadius:.3,_=t&&void 0!==t.segments?t.segments:30,m=t&&void 0!==t.sides?t.sides:20,A=[],v=[],y=[],g=[];for(i=0;i<=m;i++)for(r=0;r<=_;r++)if(s=Math.cos(2*Math.PI*r/_)*(p+f*Math.cos(2*Math.PI*i/m)),a=Math.sin(2*Math.PI*i/m)*f,o=Math.sin(2*Math.PI*r/_)*(p+f*Math.cos(2*Math.PI*i/m)),h=Math.cos(2*Math.PI*r/_)*Math.cos(2*Math.PI*i/m),l=Math.sin(2*Math.PI*i/m),c=Math.sin(2*Math.PI*r/_)*Math.cos(2*Math.PI*i/m),d=i/m,u=1-r/_,A.push(s,a,o),v.push(h,l,c),y.push(d,u),i<m&&r<_){var b,E,T,S;b=i*(_+1)+r,E=(i+1)*(_+1)+r,T=i*(_+1)+(r+1),S=(i+1)*(_+1)+(r+1),g.push(b,E,T),g.push(E,S,T)}var w={normals:v,uvs:y,indices:g};return n.precalculatedTangents&&(w.tangents=n.calculateTangents(A,v,y,g)),n.createMesh(e,A,w)},n._createConeData=function(e,t,i,r,s,a){var o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,S,w,C,M,P,I,R=new n.Vec3,x=new n.Vec3,O=new n.Vec3,k=[],D=[],L=[],N=[],F=[];if(i>0)for(o=0;o<=r;o++)for(h=0;h<=s;h++){A=h/s*2*Math.PI-Math.PI,y=Math.sin(A),v=Math.cos(A),_=new n.Vec3(y*e,-i/2,v*e),p=new n.Vec3(y*t,i/2,v*t),R.lerp(_,p,o/r),x.sub2(p,_).normalize(),m=new n.Vec3(v,0,(-y)),O.cross(m,x).normalize(),k.push(R.x,R.y,R.z),D.push(O.x,O.y,O.z),u=h/s,f=o/r,L.push(u,f);var B=f;f=u,u=B,u/=3,u=u*T+E,f=f*T+E,N.push(u,f),o<r&&h<s&&(w=o*(s+1)+h,C=o*(s+1)+(h+1),M=(o+1)*(s+1)+h,P=(o+1)*(s+1)+(h+1),F.push(w,C,M),F.push(C,P,M))}if(a){var V,U,G=Math.floor(s/2),W=s,z=i/2;for(V=0;V<=G;V++)for(A=V*Math.PI*.5/G,y=Math.sin(A),v=Math.cos(A),U=0;U<=W;U++)g=2*U*Math.PI/W-Math.PI/2,b=Math.sin(g),S=Math.cos(g),l=S*y,c=v,d=b*y,u=1-U/W,f=1-V/G,k.push(l*t,c*t+z,d*t),D.push(l,c,d),L.push(u,f),u/=3,f/=3,u=u*T+E,f=f*T+E,u+=1/3,N.push(u,f);for(I=(r+1)*(s+1),V=0;V<G;++V)for(U=0;U<W;++U)w=V*(W+1)+U,C=w+W+1,F.push(I+w+1,I+C,I+w),F.push(I+w+1,I+C+1,I+C);for(V=0;V<=G;V++)for(A=.5*Math.PI+V*Math.PI*.5/G,y=Math.sin(A),v=Math.cos(A),U=0;U<=W;U++)g=2*U*Math.PI/W-Math.PI/2,b=Math.sin(g),S=Math.cos(g),l=S*y,c=v,d=b*y,u=1-U/W,f=1-V/G,k.push(l*t,c*t-z,d*t),D.push(l,c,d),L.push(u,f),u/=3,f/=3,u=u*T+E,f=f*T+E,u+=2/3,N.push(u,f);for(I=(r+1)*(s+1)+(W+1)*(G+1),V=0;V<G;++V)for(U=0;U<W;++U)w=V*(W+1)+U,C=w+W+1,F.push(I+w+1,I+C,I+w),F.push(I+w+1,I+C+1,I+C)}else{if(I=(r+1)*(s+1),e>0)for(o=0;o<s;o++)A=o/s*2*Math.PI,l=Math.sin(A),c=-i/2,d=Math.cos(A),u=1-(l+1)/2,f=(d+1)/2,k.push(l*e,c,d*e),D.push(0,-1,0),L.push(u,f),u/=3,f/=3,u=u*T+E,f=f*T+E,u+=1/3,N.push(u,f),o>1&&F.push(I,I+o,I+o-1);if(I+=s,t>0)for(o=0;o<s;o++)A=o/s*2*Math.PI,l=Math.sin(A),c=i/2,d=Math.cos(A),u=1-(l+1)/2,f=(d+1)/2,k.push(l*t,c,d*t),D.push(0,1,0),L.push(u,f),u/=3,f/=3,u=u*T+E,f=f*T+E,u+=2/3,N.push(u,f),o>1&&F.push(I,I+o-1,I+o)}return{positions:k,normals:D,uvs:L,uvs1:N,indices:F}},n.createCylinder=function(e,t){var i=t&&(t.radius||t.baseRadius);i=void 0!==i?i:.5;var r=t&&void 0!==t.height?t.height:1,s=t&&void 0!==t.heightSegments?t.heightSegments:5,a=t&&void 0!==t.capSegments?t.capSegments:20,o=n._createConeData(i,i,r,s,a,!1);return n.precalculatedTangents&&(o.tangents=n.calculateTangents(o.positions,o.normals,o.uvs,o.indices)),n.createMesh(e,o.positions,o)},n.createCapsule=function(e,t){var i=t&&void 0!==t.radius?t.radius:.3,r=t&&void 0!==t.height?t.height:1,s=t&&void 0!==t.heightSegments?t.heightSegments:1,a=t&&void 0!==t.sides?t.sides:20,o=n._createConeData(i,i,r-2*i,s,a,!0);return n.precalculatedTangents&&(o.tangents=n.calculateTangents(o.positions,o.normals,o.uvs,o.indices)),n.createMesh(e,o.positions,o)},n.createCone=function(e,t){var i=t&&void 0!==t.baseRadius?t.baseRadius:.5,r=t&&void 0!==t.peakRadius?t.peakRadius:0,s=t&&void 0!==t.height?t.height:1,a=t&&void 0!==t.heightSegments?t.heightSegments:5,o=t&&void 0!==t.capSegments?t.capSegments:18,h=n._createConeData(i,r,s,a,o,!1);return n.precalculatedTangents&&(h.tangents=n.calculateTangents(h.positions,h.normals,h.uvs,h.indices)),n.createMesh(e,h.positions,h)},n.createSphere=function(e,t){var i,r,s,a,o,h,l,c,d,u,f,p,_,m,A,v=t&&void 0!==t.radius?t.radius:.5,y=t&&void 0!==t.latitudeBands?t.latitudeBands:16,g=t&&void 0!==t.longitudeBands?t.longitudeBands:16,b=[],E=[],T=[],S=[];for(r=0;r<=y;r++)for(s=r*Math.PI/y,a=Math.sin(s),o=Math.cos(s),i=0;i<=g;i++)h=2*i*Math.PI/g-Math.PI/2,l=Math.sin(h),c=Math.cos(h),f=c*a,p=o,_=l*a,m=1-i/g,A=1-r/y,b.push(f*v,p*v,_*v),E.push(f,p,_),T.push(m,A);for(r=0;r<y;++r)for(i=0;i<g;++i)d=r*(g+1)+i,u=d+g+1,S.push(d+1,u,d),S.push(d+1,u+1,u);var w={normals:E,uvs:T,uvs1:T,indices:S};return n.precalculatedTangents&&(w.tangents=n.calculateTangents(b,E,T,S)),n.createMesh(e,b,w)},n.createPlane=function(e,t){var i,r,s,a,o,h,l,c=t&&void 0!==t.halfExtents?t.halfExtents:new n.Vec2(.5,.5),d=t&&void 0!==t.widthSegments?t.widthSegments:5,u=t&&void 0!==t.lengthSegments?t.lengthSegments:5,f=[],p=[],_=[],m=[],A=0;for(i=0;i<=d;i++)for(r=0;r<=u;r++)s=-c.x+2*c.x*i/d,a=0,o=-(-c.y+2*c.y*r/u),h=i/d,l=r/u,f.push(s,a,o),p.push(0,1,0),_.push(h,l),i<d&&r<u&&(m.push(A+u+1,A+1,A),m.push(A+u+1,A+u+2,A+1)),A++;var v={normals:p,uvs:_,uvs1:_,indices:m};return n.precalculatedTangents&&(v.tangents=n.calculateTangents(f,p,_,m)),n.createMesh(e,f,v)},n.createBox=function(e,t){var i=t&&void 0!==t.halfExtents?t.halfExtents:new n.Vec3(.5,.5,.5),r=t&&void 0!==t.widthSegments?t.widthSegments:1,s=t&&void 0!==t.lengthSegments?t.lengthSegments:1,a=t&&void 0!==t.heightSegments?t.heightSegments:1,o=[new n.Vec3((-i.x),(-i.y),i.z),new n.Vec3(i.x,(-i.y),i.z),new n.Vec3(i.x,i.y,i.z),new n.Vec3((-i.x),i.y,i.z),new n.Vec3(i.x,(-i.y),(-i.z)),new n.Vec3((-i.x),(-i.y),(-i.z)),new n.Vec3((-i.x),i.y,(-i.z)),new n.Vec3(i.x,i.y,(-i.z))],h=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],l=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],c={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},d=[],u=[],f=[],p=[],_=[],m=0,A=function(e,t,i){var r,s,a,c;for(a=0;a<=t;a++)for(c=0;c<=i;c++){var A=new n.Vec3,v=new n.Vec3,y=new n.Vec3,g=new n.Vec3;A.lerp(o[h[e][0]],o[h[e][1]],a/t),v.lerp(o[h[e][0]],o[h[e][2]],c/i),y.sub2(v,o[h[e][0]]),g.add2(A,y),r=a/t,s=c/i,d.push(g.x,g.y,g.z),u.push(l[e][0],l[e][1],l[e][2]),f.push(r,s),r/=3,s/=3,r=r*T+E,s=s*T+E,r+=e%3/3,s+=Math.floor(e/3)/3,p.push(r,s),a<t&&c<i&&(_.push(m+i+1,m+1,m),_.push(m+i+1,m+i+2,m+1)),m++}};A(c.FRONT,r,a),A(c.BACK,r,a),A(c.TOP,r,s),A(c.BOTTOM,r,s),A(c.RIGHT,s,a),A(c.LEFT,s,a);var v={normals:u,uvs:f,uvs1:p,indices:_};return n.precalculatedTangents&&(v.tangents=n.calculateTangents(d,u,f,_)),n.createMesh(e,d,v)},n.Scene.defaultMaterial=new n.StandardMaterial,n.Scene.defaultMaterial.shadingModel=n.SPECULAR_BLINN,Object.assign(n,function(){function e(e,t){return e.drawOrder-t.drawOrder}function t(e,t){return o=e._key[n.SORTKEY_FORWARD],h=t._key[n.SORTKEY_FORWARD],o===h&&e.mesh&&t.mesh?t.mesh.id-e.mesh.id:h-o}function i(e,t){return t.zdist-e.zdist}function r(e,t){return e.zdist-t.zdist}function s(e,t){return e.priority-t.priority}function a(e,t){return t.key-e.key}var o,h,l,c,d=[null,e,t,i,r],u=0,f=function(){this.list=[],this.length=0,this.done=!1},p=function(){this.opaqueMeshInstances=[],this.transparentMeshInstances=[],this.shadowCasters=[],this.visibleOpaque=[],this.visibleTransparent=[]},_=function(e){void 0!==e.id?(this.id=e.id,u=Math.max(this.id+1,u)):this.id=u++,this.name=e.name,this._enabled=void 0===e.enabled||e.enabled,this._refCounter=this._enabled?1:0,this.opaqueSortMode=void 0===e.opaqueSortMode?n.SORTMODE_MATERIALMESH:e.opaqueSortMode,this.transparentSortMode=void 0===e.transparentSortMode?n.SORTMODE_BACK2FRONT:e.transparentSortMode,this.renderTarget=e.renderTarget,this.shaderPass=void 0===e.shaderPass?n.SHADER_FORWARD:e.shaderPass,this.passThrough=void 0!==e.passThrough&&e.passThrough,this.overrideClear=void 0!==e.overrideClear&&e.overrideClear,this._clearColor=new n.Color(0,0,0,1),e.clearColor&&this._clearColor.copy(e.clearColor),this._clearColorBuffer=void 0!==e.clearColorBuffer&&e.clearColorBuffer,this._clearDepthBuffer=void 0!==e.clearDepthBuffer&&e.clearDepthBuffer,this._clearStencilBuffer=void 0!==e.clearStencilBuffer&&e.clearStencilBuffer,this._clearOptions={color:this._clearColor.data,depth:1,stencil:0,flags:(this._clearColorBuffer?n.CLEARFLAG_COLOR:0)|(this._clearDepthBuffer?n.CLEARFLAG_DEPTH:0)|(this._clearStencilBuffer?n.CLEARFLAG_STENCIL:0)},this.onPreCull=e.onPreCull,this.onPreRender=e.onPreRender,this.onPreRenderOpaque=e.onPreRenderOpaque,this.onPreRenderTransparent=e.onPreRenderTransparent,this.onPostCull=e.onPostCull,this.onPostRender=e.onPostRender,this.onPostRenderOpaque=e.onPostRenderOpaque,this.onPostRenderTransparent=e.onPostRenderTransparent,this.onDrawCall=e.onDrawCall,this.onEnable=e.onEnable,this.onDisable=e.onDisable,this._enabled&&this.onEnable&&this.onEnable(),this.layerReference=e.layerReference,this.instances=e.layerReference?e.layerReference.instances:new p,this.cullingMask=e.cullingMask?e.cullingMask:4294967295,this.opaqueMeshInstances=this.instances.opaqueMeshInstances,this.transparentMeshInstances=this.instances.transparentMeshInstances,this.shadowCasters=this.instances.shadowCasters,this._lightComponents=[],this._lights=[],this._sortedLights=[[],[],[]],this.cameras=[],this._dirty=!1,this._dirtyLights=!1,this._dirtyCameras=!1,this._cameraHash=0,this._lightHash=0,this._staticLightHash=0,this._needsStaticPrepare=!0,this._staticPrepareDone=!1,this._shaderVersion=-1,this._version=0,this._lightCube=null};return Object.defineProperty(_.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,e?(this.incrementCounter(),this.onEnable&&this.onEnable()):(this.decrementCounter(),this.onDisable&&this.onDisable()))}}),Object.defineProperty(_.prototype,"clearColor",{get:function(){return this._clearColor},set:function(e){this._clearColor.copy(e)}}),_.prototype._updateClearFlags=function(){var e=0;this._clearColorBuffer&&(e|=n.CLEARFLAG_COLOR),this._clearDepthBuffer&&(e|=n.CLEARFLAG_DEPTH),this._clearStencilBuffer&&(e|=n.CLEARFLAG_STENCIL),this._clearOptions.flags=e},Object.defineProperty(_.prototype,"clearColorBuffer",{get:function(){return this._clearColorBuffer},set:function(e){this._clearColorBuffer=e,this._updateClearFlags()}}),Object.defineProperty(_.prototype,"clearDepthBuffer",{get:function(){return this._clearDepthBuffer},set:function(e){this._clearDepthBuffer=e,this._updateClearFlags()}}),Object.defineProperty(_.prototype,"clearStencilBuffer",{get:function(){return this._clearStencilBuffer},set:function(e){this._clearStencilBuffer=e,this._updateClearFlags()}}),_.prototype.incrementCounter=function(){0===this._refCounter&&(this._enabled=!0,this.onEnable&&this.onEnable()),this._refCounter++},_.prototype.decrementCounter=function(){if(1===this._refCounter)this._enabled=!1,this.onDisable&&this.onDisable();else if(0===this._refCounter)return;this._refCounter--},_.prototype.addMeshInstances=function(e,t){for(var i,r,s,a=this._shaderVersion,o=this.shadowCasters,h=0;h<e.length;h++)i=e[h],s=i.material,r=s.blendType===n.BLEND_NONE?this.opaqueMeshInstances:this.transparentMeshInstances,r.indexOf(i)<0&&r.push(i),!t&&i.castShadow&&o.indexOf(i)<0&&o.push(i),!this.passThrough&&a>=0&&s._shaderVersion!==a&&(s.updateShader!==n.Material.prototype.updateShader&&(s.clearVariants(),s.shader=null),s._shaderVersion=a);this.passThrough||(this._dirty=!0)},_.prototype.removeMeshInstances=function(e,t){var i,n,r,s,a,o,h,l=this.opaqueMeshInstances,c=this.transparentMeshInstances,d=this.shadowCasters;for(i=0;i<e.length;i++){for(r=e[i],s=-1,a=0,o=l.length,n=0;n<o;n++){if(h=l[n],h===r){s=n,a=1;break}if(h._staticSource===r)s<0&&(s=n),a++;else if(s>=0)break}for(s>=0&&l.splice(s,a),s=-1,a=0,o=c.length,n=0;n<o;n++){if(h=c[n],h===r){s=n,a=1;break}if(h._staticSource===r)s<0&&(s=n),a++;else if(s>=0)break}s>=0&&c.splice(s,a),t||(n=d.indexOf(r),n>=0&&d.splice(n,1))}this._dirty=!0},_.prototype.clearMeshInstances=function(e){(0!==this.opaqueMeshInstances.length||0!==this.transparentMeshInstances.length||!e&&0!==this.shadowCasters.length)&&(this.opaqueMeshInstances.length=0,this.transparentMeshInstances.length=0,e||(this.shadowCasters.length=0),this.passThrough||(this._dirty=!0))},_.prototype.addLight=function(e){this._lightComponents.indexOf(e)>=0||(this._lightComponents.push(e),this._lights.push(e.light),this._dirtyLights=!0,this._generateLightHash())},_.prototype.removeLight=function(e){var t=this._lightComponents.indexOf(e);t<0||(this._lightComponents.splice(t,1),t=this._lights.indexOf(e.light),this._lights.splice(t,1),this._dirtyLights=!0,this._generateLightHash())},_.prototype.clearLights=function(){this._lightComponents.length=0,this._lights.length=0,this._dirtyLights=!0},_.prototype.addShadowCasters=function(e){for(var t,i=this.shadowCasters,n=0;n<e.length;n++)t=e[n],t.castShadow&&i.indexOf(t)<0&&i.push(t);this._dirtyLights=!0},_.prototype.removeShadowCasters=function(e){for(var t,i=this.shadowCasters,n=0;n<e.length;n++)t=i.indexOf(e[n]),t>=0&&i.splice(t,1);this._dirtyLights=!0},_.prototype._generateLightHash=function(){if(this._lights.length>0){this._lights.sort(a);for(var e="",t="",i=0;i<this._lights.length;i++)this._lights[i].isStatic?t+=this._lights[i].key:e+=this._lights[i].key;0===e.length?this._lightHash=0:this._lightHash=n.hashCode(e),0===t.length?this._staticLightHash=0:this._staticLightHash=n.hashCode(t)}else this._lightHash=0,this._staticLightHash=0},_.prototype._generateCameraHash=function(){if(this.cameras.length>1){this.cameras.sort(s);for(var e="",t=0;t<this.cameras.length;t++)e+=this.cameras[t].entity._guid;this._cameraHash=n.hashCode(e)}else this._cameraHash=0;this._dirtyCameras=!0},_.prototype.addCamera=function(e){this.cameras.indexOf(e)>=0||(this.cameras.push(e),this._generateCameraHash())},_.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);t<0||(this.cameras.splice(t,1),this._generateCameraHash())},_.prototype.clearCameras=function(){this.cameras.length=0,this._cameraHash=0,this._dirtyCameras=!0},_.prototype._sortCameras=function(){this._generateCameraHash()},_.prototype._calculateSortDistances=function(e,t,i,r){var s,a,o,h,l,c;for(s=0;s<t;s++)a=e[s],a.command||a.layer<=n.scene.LAYER_FX||(o=a.aabb.center.data,h=o[0]-i[0],l=o[1]-i[1],c=o[2]-i[2],a.zdist=h*r[0]+l*r[1]+c*r[2])},_.prototype._sortVisible=function(e,t,i){var r=this.instances,s=e?this.transparentSortMode:this.opaqueSortMode;if(s!==n.SORTMODE_NONE){var a=e?r.visibleTransparent[i]:r.visibleOpaque[i];s!==n.SORTMODE_BACK2FRONT&&s!==n.SORTMODE_FRONT2BACK||(l=t.getPosition().data,c=t.forward.data,this._calculateSortDistances(a.list,a.length,l,c)),a.list.length!==a.length&&(a.list.length=a.length),a.list.sort(d[s])}},{Layer:_,InstanceList:p,VisibleInstanceList:f}}()),Object.assign(n,function(){var e=function(){this.layerList=[],this.subLayerList=[],this.subLayerEnabled=[],this._dirty=!1,this._dirtyBlend=!1,this._dirtyLights=!1,this._dirtyCameras=!1,this._meshInstances=[],this._lights=[],this.cameras=[],this._sortedLights=[[],[],[]],this._lightShadowCasters=[],this._globalLightCameras=[],this._globalLightCameraIds=[],this._renderedRt=[],this._renderedByCam=[],this._renderedLayer=[],this._renderList=[],this._renderListCamera=[],n.events.attach(this)};return e.prototype._sortLights=function(e){var t,i=e._lights;e._sortedLights[n.LIGHTTYPE_DIRECTIONAL].length=0,e._sortedLights[n.LIGHTTYPE_POINT].length=0,e._sortedLights[n.LIGHTTYPE_SPOT].length=0;for(var r=0;r<i.length;r++)t=i[r],t._enabled&&e._sortedLights[t._type].push(t)},e.prototype._update=function(){var e,t,i,r,s,a=this.layerList.length,o=0;if(!this._dirty||!this._dirtyLights||!this._dirtyCameras)for(e=0;e<a;e++)s=this.layerList[e],s._dirty&&(this._dirty=!0),s._dirtyLights&&(this._dirtyLights=!0),s._dirtyCameras&&(this._dirtyCameras=!0);var h;if(this._dirty){o|=n.COMPUPDATED_INSTANCES,this._meshInstances.length=0;var l;for(e=0;e<a;e++)if(s=this.layerList[e],!s.passThrough){for(h=s.opaqueMeshInstances,t=0;t<h.length;t++)l=h[t],this._meshInstances.indexOf(l)<0&&(this._meshInstances.push(l),l.material&&l.material._dirtyBlend&&(this._dirtyBlend=!0,l.material._dirtyBlend=!1));for(h=s.transparentMeshInstances,t=0;t<h.length;t++)l=h[t],this._meshInstances.indexOf(l)<0&&(this._meshInstances.push(l),l.material&&l.material._dirtyBlend&&(this._dirtyBlend=!0,l.material._dirtyBlend=!1))}for(e=0;e<a;e++)this.layerList[e]._dirty=!1,this.layerList[e]._version++}if(this._dirtyBlend){o|=n.COMPUPDATED_BLEND;var c,d,u,f;for(e=0;e<a;e++)if(s=this.layerList[e],!s.passThrough){for(c=s.opaqueMeshInstances,d=s.transparentMeshInstances,u=[],f=[],t=0;t<c.length;t++)c[t].material&&c[t].material.blendType!==n.BLEND_NONE?f.push(c[t]):u.push(c[t]);for(t=0;t<d.length;t++)d[t].material&&d[t].material.blendType!==n.BLEND_NONE?f.push(d[t]):u.push(d[t]);for(s.opaqueMeshInstances.length=u.length,t=0;t<u.length;t++)s.opaqueMeshInstances[t]=u[t];for(s.transparentMeshInstances.length=f.length,t=0;t<f.length;t++)s.transparentMeshInstances[t]=f[t]}this._dirtyBlend=!1}this._dirty=!1;var p,_,m;if(this._dirtyLights||o&n.COMPUPDATED_INSTANCES)for(o|=n.COMPUPDATED_LIGHTS,this._lights.length=0,this._lightShadowCasters.length=0,e=0;e<a;e++)for(s=this.layerList[e],h=s._lights,t=0;t<h.length;t++)m=h[t],_=this._lights.indexOf(m),_<0&&(this._lights.push(m),_=this._lights.length-1),p=this._lightShadowCasters[_],p||(this._lightShadowCasters[_]=p=[]);if(this._dirtyLights)for(this._sortLights(this),this._dirtyLights=!1,e=0;e<a;e++)s=this.layerList[e],this._sortLights(s),s._dirtyLights=!1;if(o)for(e=0;e<a;e++)for(s=this.layerList[e],h=s._lights,t=0;t<h.length;t++){m=h[t],_=this._lights.indexOf(m),p=this._lightShadowCasters[_];var A=s.shadowCasters;for(i=0;i<A.length;i++)p.indexOf(A[i])<0&&p.push(A[i])}if(o&n.COMPUPDATED_LIGHTS||this._dirtyCameras){this._globalLightCameras.length=0;var v=this._sortedLights[n.LIGHTTYPE_DIRECTIONAL];for(r=0;r<v.length;r++)for(m=v[r],this._globalLightCameras[r]=[],e=0;e<a;e++)if(s=this.layerList[e],!(s._sortedLights[n.LIGHTTYPE_DIRECTIONAL].indexOf(m)<0))for(i=0;i<s.cameras.length;i++)this._globalLightCameras[r].indexOf(s.cameras[i])>=0||this._globalLightCameras[r].push(s.cameras[i])}var y,g;if(this._dirtyCameras){for(o|=n.COMPUPDATED_CAMERAS,this.cameras.length=0,e=0;e<a;e++)for(s=this.layerList[e],t=0;t<s.cameras.length;t++)y=s.cameras[t],g=this.cameras.indexOf(y),g<0&&(g=this.cameras.length,this.cameras.push(y));this._renderList.length=0,this._renderListCamera.length=0;var b,E,T,S,w=0;for(e=0;e<a;e++)if(w)w--;else if(s=this.layerList[e],0!==s.cameras.length||s.isPostEffect)if(b=s._cameraHash,0===b)this._renderList.push(e),this._renderListCamera.push(0);else{for(T=1,t=e+1;t<a;t++){if(E=this.layerList[t]._cameraHash,b!==E){T=t-e-1;break}t===a-1&&(T=t-e)}if(1===T)for(S=0;S<s.cameras.length;S++)this._renderList.push(e),this._renderListCamera.push(S);else{for(S=0,S=0;S<s.cameras.length;S++)for(t=0;t<=T;t++)this._renderList.push(e+t),this._renderListCamera.push(S);w=T}}for(this._dirtyCameras=!1,e=0;e<a;e++)this.layerList[e]._dirtyCameras=!1}if(o&n.COMPUPDATED_LIGHTS||o&n.COMPUPDATED_CAMERAS)for(this._globalLightCameraIds.length=0,r=0;r<this._globalLightCameras.length;r++){for(h=[],e=0;e<this._globalLightCameras[r].length;e++)g=this.cameras.indexOf(this._globalLightCameras[r][e]),g<0||h.push(g);this._globalLightCameraIds.push(h)}return o},e.prototype._isLayerAdded=function(e){return this.layerList.indexOf(e)>=0},e.prototype._isSublayerAdded=function(e,t){for(var i=0;i<this.layerList.length;i++)if(this.layerList[i]===e&&this.subLayerList[i]===t)return!0;return!1},e.prototype.push=function(e){this._isLayerAdded(e)||(this.layerList.push(e),this.layerList.push(e),this.subLayerList.push(!1),this.subLayerList.push(!0),this.subLayerEnabled.push(!0),this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.insert=function(e,t){this._isLayerAdded(e)||(this.layerList.splice(t,0,e,e),this.subLayerList.splice(t,0,!1,!0),this.subLayerEnabled.splice(t,0,!0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.remove=function(e){for(var t=this.layerList.indexOf(e);t>=0;)this.layerList.splice(t,1),this.subLayerList.splice(t,1),this.subLayerEnabled.splice(t,1),t=this.layerList.indexOf(e),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("remove",e)},e.prototype.pushOpaque=function(e){this._isSublayerAdded(e,!1)||(this.layerList.push(e),this.subLayerList.push(!1),this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.insertOpaque=function(e,t){this._isSublayerAdded(e,!1)||(this.layerList.splice(t,0,e),this.subLayerList.splice(t,0,!1),this.subLayerEnabled.splice(t,0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.removeOpaque=function(e){for(var t=0;t<this.layerList.length;t++)if(this.layerList[t]===e&&!this.subLayerList[t])return this.layerList.splice(t,1),this.subLayerList.splice(t,1),this.subLayerEnabled.splice(t,1),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,void(this.layerList.indexOf(e)<0&&this.fire("remove",e))},e.prototype.pushTransparent=function(e){this._isSublayerAdded(e,!0)||(this.layerList.push(e),this.subLayerList.push(!0),this.subLayerEnabled.push(!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.insertTransparent=function(e,t){this._isSublayerAdded(e,!0)||(this.layerList.splice(t,0,e),this.subLayerList.splice(t,0,!0),this.subLayerEnabled.splice(t,0,!0),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,this.fire("add",e))},e.prototype.removeTransparent=function(e){for(var t=0;t<this.layerList.length;t++)if(this.layerList[t]===e&&this.subLayerList[t])return this.layerList.splice(t,1),this.subLayerList.splice(t,1),this.subLayerEnabled.splice(t,1),this._dirty=!0,this._dirtyLights=!0,this._dirtyCameras=!0,void(this.layerList.indexOf(e)<0&&this.fire("remove",e))},e.prototype._getSublayerIndex=function(e,t){var i=this.layerList.indexOf(e);if(i<0)return-1;if(this.subLayerList[i]!==t){if(i=this.layerList.indexOf(e,i+1),i<0)return-1;if(this.subLayerList[i]!==t)return-1}return i},e.prototype.getOpaqueIndex=function(e){return this._getSublayerIndex(e,!1)},e.prototype.getTransparentIndex=function(e){return this._getSublayerIndex(e,!0)},e.prototype.getLayerById=function(e){for(var t=0;t<this.layerList.length;t++)if(this.layerList[t].id===e)return this.layerList[t];return null},e.prototype.getLayerByName=function(e){for(var t=0;t<this.layerList.length;t++)if(this.layerList[t].name===e)return this.layerList[t];return null},{LayerComposition:e}}()),Object.assign(n,function(){n.SPRITE_RENDERMODE_SIMPLE=0,n.SPRITE_RENDERMODE_SLICED=1,n.SPRITE_RENDERMODE_TILED=2;var e=[0,0,1,0,0,1,0,0,1,0,0,1],t=[0,1,3,2,3,1],i=function(e,t){this._device=e,this._pixelsPerUnit=t&&void 0!==t.pixelsPerUnit?t.pixelsPerUnit:1,this._renderMode=t&&void 0!==t.renderMode?t.renderMode:n.SPRITE_RENDERMODE_SIMPLE,this._atlas=t&&void 0!==t.atlas?t.atlas:null,this._frameKeys=t&&void 0!==t.frameKeys?t.frameKeys:null,this._meshes=[],this._updatingProperties=!1,this._meshesDirty=!1,n.events.attach(this),this._atlas&&this._frameKeys&&this._createMeshes()};return i.prototype._createMeshes=function(){var e,t;for(e=0,t=this._meshes.length;e<t;e++){var i=this._meshes[e];if(i){i.vertexBuffer.destroy();for(var r=0,s=i.indexBuffer.length;r<s;r++)i.indexBuffer[r].destroy()}}var a=this._frameKeys.length;this._meshes=new Array(a);var o=this.renderMode===n.SPRITE_RENDERMODE_SLICED||this._renderMode===n.SPRITE_RENDERMODE_TILED?this._create9SliceMesh:this._createSimpleMesh;for(e=0;e<a;e++){var h=this._atlas.frames[this._frameKeys[e]];this._meshes[e]=h?o.call(this,h):null}this.fire("set:meshes")},i.prototype._createSimpleMesh=function(i){var r=i.rect,s=this._atlas.texture.width,a=this._atlas.texture.height,o=r.data[2]/this._pixelsPerUnit,h=r.data[3]/this._pixelsPerUnit,l=i.pivot.x,c=i.pivot.y,d=[-l*o,-c*h,0,(1-l)*o,-c*h,0,(1-l)*o,(1-c)*h,0,-l*o,(1-c)*h,0],u=r.data[0]/s,f=r.data[1]/a,p=(r.data[0]+r.data[2])/s,_=(r.data[1]+r.data[3])/a,m=[u,f,p,f,p,_,u,_],A=n.createMesh(this._device,d,{uvs:m,normals:e,indices:t});return A},i.prototype._create9SliceMesh=function(){var e,t,i,r,s,a,o,h=n.Vec2.ONE,l=3,c=3,d=[],u=[],f=[],p=[],_=0;for(e=0;e<=l;e++)for(a=0===e||e===l?0:1,t=0;t<=c;t++)i=-h.x+2*h.x*(e<=1?0:3)/l,r=0,s=-(-h.y+2*h.y*(t<=1?0:3)/c),o=0===t||t===c?0:1,d.push(-i,r,s),u.push(0,1,0),f.push(a,o),e<l&&t<c&&(p.push(_+c+1,_+1,_),p.push(_+c+1,_+c+2,_+1)),_++;var m={normals:u,uvs:f,indices:p};return n.createMesh(this._device,d,m)},i.prototype._onSetFrames=function(e){this._updatingProperties?this._meshesDirty=!0:this._createMeshes()},i.prototype._onFrameChanged=function(e,t){var i=this._frameKeys.indexOf(e);i<0||(t?this.renderMode===n.SPRITE_RENDERMODE_SIMPLE&&(this._meshes[i]=this._createSimpleMesh(t)):this._meshes[i]=null,this.fire("set:meshes"))},i.prototype._onFrameRemoved=function(e){var t=this._frameKeys.indexOf(e);t<0||(this._meshes[t]=null,this.fire("set:meshes"))},i.prototype.startUpdate=function(){this._updatingProperties=!0,this._meshesDirty=!1},i.prototype.endUpdate=function(){this._updatingProperties=!1,this._meshesDirty&&this._atlas&&this._frameKeys&&this._createMeshes(),this._meshesDirty=!1},i.prototype.destroy=function(){var e,t;for(e=0,t=this._meshes.length;e<t;e++){var i=this._meshes[e];if(i){i.vertexBuffer.destroy();for(var n=0,r=i.indexBuffer.length;n<r;n++)i.indexBuffer[n].destroy()}}this._meshes.length=0},Object.defineProperty(i.prototype,"frameKeys",{get:function(){return this._frameKeys},set:function(e){this._frameKeys=e,this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:frameKeys",e)}}),Object.defineProperty(i.prototype,"atlas",{get:function(){return this._atlas},set:function(e){e!==this._atlas&&(this._atlas&&(this._atlas.off("set:frames",this._onSetFrames,this),
this._atlas.off("set:frame",this._onFrameChanged,this),this._atlas.off("remove:frame",this._onFrameRemoved,this)),this._atlas=e,this._atlas&&this._frameKeys&&(this._atlas.on("set:frames",this._onSetFrames,this),this._atlas.on("set:frame",this._onFrameChanged,this),this._atlas.on("remove:frame",this._onFrameRemoved,this),this._updatingProperties?this._meshesDirty=!0:this._createMeshes()),this.fire("set:atlas",e))}}),Object.defineProperty(i.prototype,"pixelsPerUnit",{get:function(){return this._pixelsPerUnit},set:function(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,this.fire("set:pixelsPerUnit",e),this._atlas&&this._frameKeys&&this.renderMode===n.SPRITE_RENDERMODE_SIMPLE&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes()))}}),Object.defineProperty(i.prototype,"renderMode",{get:function(){return this._renderMode},set:function(e){if(this._renderMode!==e){var t=this._renderMode;this._renderMode=e,this.fire("set:renderMode",e),t!==n.SPRITE_RENDERMODE_SIMPLE&&e!==n.SPRITE_RENDERMODE_SIMPLE||this._atlas&&this._frameKeys&&(this._updatingProperties?this._meshesDirty=!0:this._createMeshes())}}}),Object.defineProperty(i.prototype,"meshes",{get:function(){return this._meshes}}),{Sprite:i}}()),Object.assign(n,function(){var e=function(){this._texture=null,this._frames=null,n.events.attach(this)};return e.prototype.setFrame=function(e,t){var i=this._frames[e];i?(i.rect.copy(t.rect),i.pivot.copy(t.pivot),i.border.copy(t.border)):(i={rect:t.rect.clone(),pivot:t.pivot.clone(),border:t.border.clone()},this._frames[e]=i),this.fire("set:frame",e.toString(),i)},e.prototype.removeFrame=function(e){var t=this._frames[e];t&&(delete this._frames[e],this.fire("remove:frame",e.toString(),t))},e.prototype.destroy=function(){this._texture&&this._texture.destroy()},Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this.fire("set:texture",e)}}),Object.defineProperty(e.prototype,"frames",{get:function(){return this._frames},set:function(e){this._frames=e,this.fire("set:frames",e)}}),{TextureAtlas:e}}()),Object.assign(n,function(){var e=function(e){this.func=void 0===e.func?n.FUNC_ALWAYS:e.func,this.ref=e.ref||0,this.readMask=void 0===e.readMask?255:e.readMask,this.writeMask=void 0===e.writeMask?255:e.writeMask,this.fail=e.fail||n.STENCILOP_KEEP,this.zfail=e.zfail||n.STENCILOP_KEEP,this.zpass=e.zpass||n.STENCILOP_KEEP};return e.prototype.clone=function(){var e=new n.StencilParameters({func:this.func,ref:this.ref,readMask:this.readMask,writeMask:this.writeMask,fail:this.fail,zfail:this.zfail,zpass:this.zpass});return e},{StencilParameters:e}}()),Object.assign(n,function(){var e=function(e,t,i,n){this.time=e,this.position=t,this.rotation=i,this.scale=n},t=function(){this._name="",this._keys=[]},i=function(){this.name="",this.duration=0,this._nodes=[],this._nodeDict={}};return i.prototype.getDuration=function(){return this.duration},i.prototype.getName=function(){return this.name},i.prototype.getNode=function(e){return this._nodeDict[e]},Object.defineProperty(i.prototype,"nodes",{get:function(){return this._nodes}}),i.prototype.getNodes=function(){return this._nodes},i.prototype.setDuration=function(e){this.duration=e},i.prototype.setName=function(e){this.name=e},i.prototype.addNode=function(e){this._nodes.push(e),this._nodeDict[e._name]=e},{Animation:i,Key:e,Node:t}}()),Object.assign(n,function(){function e(){this._written=!1,this._name="",this._keyFrames=[],this._quat=new n.Quat,this._pos=new n.Vec3,this._scale=new n.Vec3,this._targetNode=null}Object.assign(e.prototype,{getTarget:function(){return this._targetNode},setTarget:function(e){this._targetNode=e}});var t=function(t){function i(t){var r=new e;r._name=t.name,n._interpolatedKeys.push(r),n._interpolatedKeyDict[t.name]=r,n._currKeyIndices[t.name]=0;for(var s=0;s<t._children.length;s++)i(t._children[s])}this._animation=null,this._time=0,this.looping=!0,this._interpolatedKeys=[],this._interpolatedKeyDict={},this._currKeyIndices={},this.graph=null;var n=this;i(t)};return t.prototype.addTime=function(e){if(null!==this._animation){var t,i,n,r,s,a,o,h,l=this._animation._nodes,c=this._animation.duration;if(this._time===c&&!this.looping)return;if(this._time+=e,this._time>c)for(this._time=this.looping?0:c,t=0;t<l.length;t++)i=l[t],n=i._name,this._currKeyIndices[n]=0;else if(this._time<0)for(this._time=this.looping?c:0,t=0;t<l.length;t++)i=l[t],n=i._name,this._currKeyIndices[n]=i._keys.length-2;var d,u=e>=0?1:-1;for(t=0;t<l.length;t++){if(i=l[t],n=i._name,r=i._keys,s=this._interpolatedKeyDict[n],d=!1,1!==r.length)for(var f=this._currKeyIndices[n];f<r.length-1&&f>=0;f+=u)if(a=r[f],o=r[f+1],a.time<=this._time&&o.time>=this._time){h=(this._time-a.time)/(o.time-a.time),s._pos.lerp(a.position,o.position,h),s._quat.slerp(a.rotation,o.rotation,h),s._scale.lerp(a.scale,o.scale,h),s._written=!0,this._currKeyIndices[n]=f,d=!0;break}(1===r.length||!d&&0===this._time&&this.looping)&&(s._pos.copy(r[0].position),s._quat.copy(r[0].rotation),s._scale.copy(r[0].scale),s._written=!0)}}},t.prototype.blend=function(e,t,i){for(var n=this._interpolatedKeys.length,r=0;r<n;r++){var s=e._interpolatedKeys[r],a=t._interpolatedKeys[r],o=this._interpolatedKeys[r];s._written&&a._written?(o._quat.slerp(s._quat,t._interpolatedKeys[r]._quat,i),o._pos.lerp(s._pos,t._interpolatedKeys[r]._pos,i),o._scale.lerp(s._scale,a._scale,i),o._written=!0):s._written?(o._quat.copy(s._quat),o._pos.copy(s._pos),o._scale.copy(s._scale),o._written=!0):a._written&&(o._quat.copy(a._quat),o._pos.copy(a._pos),o._scale.copy(a._scale),o._written=!0)}},Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},set:function(e){this._animation=e,this.currentTime=0}}),t.prototype.getAnimation=function(){return this._animation},Object.defineProperty(t.prototype,"currentTime",{get:function(){return this._time},set:function(e){this._time=e;for(var t=this._interpolatedKeys.length,i=0;i<t;i++){var n=this._interpolatedKeys[i],r=n._name;this._currKeyIndices[r]=0}this.addTime(0),this.updateGraph()}}),t.prototype.getCurrentTime=function(){return this._time},t.prototype.setCurrentTime=function(e){this.currentTime=e},Object.defineProperty(t.prototype,"numNodes",{get:function(){return this._interpolatedKeys.length}}),t.prototype.getNumNodes=function(){return this._interpolatedKeys.length},t.prototype.setAnimation=function(e){this.animation=e},t.prototype.setGraph=function(e){var t;if(this.graph=e,e)for(t=0;t<this._interpolatedKeys.length;t++){var i=this._interpolatedKeys[t],n=e.findByName(i._name);this._interpolatedKeys[t].setTarget(n)}else for(t=0;t<this._interpolatedKeys.length;t++)this._interpolatedKeys[t].setTarget(null)},t.prototype.updateGraph=function(){if(this.graph)for(var e=0;e<this._interpolatedKeys.length;e++){var t=this._interpolatedKeys[e];if(t._written){var i=t.getTarget();i.localPosition.copy(t._pos),i.localRotation.copy(t._quat),i.localScale.copy(t._scale),i._dirtyLocal||i._dirtify(!0),t._written=!1}}},t.prototype.setLooping=function(e){this.looping=e},t.prototype.getLooping=function(){return this.looping},{Skeleton:t}}()),Object.assign(n,function(){function e(){return"undefined"!=typeof Audio}function t(){return!("undefined"==typeof AudioContext&&"undefined"==typeof webkitAudioContext)}var i=function(i){if(t()||i.forceWebAudioApi){if("undefined"!=typeof AudioContext?this.context=new AudioContext:"undefined"!=typeof webkitAudioContext&&(this.context=new webkitAudioContext),this.context){var r=this.context;if(n.platform.ios){var s=function(){var e=r.createBuffer(1,1,44100),t=r.createBufferSource();t.buffer=e,t.connect(r.destination),t.start(0),t.disconnect(),window.removeEventListener("touchend",s)};window.addEventListener("touchend",s)}}}else console.warn("No support for 3D audio found");e()||console.warn("No support for 2D audio found"),this.listener=new n.Listener(this),this._volume=1,this.suspended=!1,n.events.attach(this)};return i.hasAudio=e,i.hasAudioContext=t,Object.assign(i.prototype,{suspend:function(){this.suspended=!0,this.fire("suspend")},resume:function(){this.suspended=!1,this.fire("resume")},destroy:function(){this.fire("destroy"),this.context&&this.context.close&&(this.context.close(),this.context=null)},getListener:function(){return console.warn('DEPRECATED: getListener is deprecated. Get the "listener" field instead.'),this.listener},getVolume:function(){return console.warn('DEPRECATED: getVolume is deprecated. Get the "volume" property instead.'),this.volume},setVolume:function(e){console.warn('DEPRECATED: setVolume is deprecated. Set the "volume" property instead.'),this.volume=e},playSound:function(e,t){t=t||{};var i=null;return n.Channel&&(i=new n.Channel(this,e,t),i.play()),i},playSound3d:function(e,t,i){i=i||{};var r=null;return n.Channel3d&&(r=new n.Channel3d(this,e,i),r.setPosition(t),i.volume&&r.setVolume(i.volume),i.loop&&r.setLoop(i.loop),i.maxDistance&&r.setMaxDistance(i.maxDistance),i.minDistance&&r.setMinDistance(i.minDistance),i.rollOffFactor&&r.setRollOffFactor(i.rollOffFactor),i.distanceModel&&r.setDistanceModel(i.distanceModel),r.play()),r}}),Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(e){e=n.math.clamp(e,0,1),this._volume=e,this.fire("volumechange",e)}}),n.AudioManager=i,{SoundManager:i}}()),Object.assign(n,function(){var e=function(e){e instanceof Audio?this.audio=e:this.buffer=e};return Object.defineProperty(e.prototype,"duration",{get:function(){var e=0;return this.buffer?e=this.buffer.duration:this.audio&&(e=this.audio.duration),e||0}}),{Sound:e}}()),Object.assign(n,function(){var e=function(e){this.position=new n.Vec3,this.velocity=new n.Vec3,this.orientation=new n.Mat4,n.AudioManager.hasAudioContext()&&(this.listener=e.context.listener)};return Object.assign(e.prototype,{getPosition:function(){return this.position},setPosition:function(e){this.position.copy(e),this.listener&&this.listener.setPosition(e.x,e.y,e.z)},getVelocity:function(){return this.velocity},setVelocity:function(e){this.velocity.copy(e),this.listener&&this.listener.setPosition(e.x,e.y,e.z)},setOrientation:function(e){this.orientation.copy(e),this.listener&&this.listener.setOrientation(-e.data[8],-e.data[9],-e.data[10],e.data[4],e.data[5],e.data[6])},getOrientation:function(){return this.orientation}}),{Listener:e}}()),Object.assign(n,function(){var e,t=0,i=1,r=2,s=function(e,t){return e%t||0};return n.SoundManager.hasAudioContext()?(e=function(e,t,i){n.events.attach(this),i=i||{},this._volume=void 0!==i.volume?n.math.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._sound=t,this._state=r,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startedAt=0,this._startOffset=null,this._currentTime=0,this._currentOffset=0,this._playWhenLoaded=!0,this._manager=e,this._inputNode=null,this._connectorNode=null,this._firstNode=null,this._lastNode=null,this._initializeNodes(),this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,this._endedHandler=this._onEnded.bind(this),this.source=null},Object.assign(e.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this._inputNode=this.gain,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)},play:function(){this._state!==r&&this.stop(),this.source||this._createSource();var e=s(this._startOffset,this.duration);return e=s(this._startTime+e,this._sound.duration),this._startOffset=null,this._duration?this.source.start(0,e,this._duration):this.source.start(0,e),this._startedAt=this._manager.context.currentTime,this._currentTime=0,this._currentOffset=e,this._state=t,this._playWhenLoaded=!1,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0},pause:function(){return!(this._state!==t||!this.source)&&(this._updateCurrentTime(),this._state=i,this._suspendEndEvent=!0,this.source.stop(0),this.source=null,this._playWhenLoaded=!1,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){if(this._state!==i)return!1;this.source||this._createSource();var e=this.currentTime;return null!==this._startOffset&&(e=s(this._startOffset,this.duration),e=s(this._startTime+e,this._sound.duration),this._startOffset=null),this._duration?this.source.start(0,e,this._duration):this.source.start(0,e),this._state=t,this._startedAt=this._manager.context.currentTime,this._currentOffset=e,this.volume=this._volume,this.loop=this._loop,this.pitch=this._pitch,this._playWhenLoaded=!1,this._suspendInstanceEvents||this._onResume(),!0},stop:function(){return!(this._state===r||!this.source)&&(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._startedAt=0,this._currentTime=0,this._currentOffset=0,this._startOffset=null,this._playWhenLoaded=!1,this._suspendEndEvent=!0,this._state===t&&this.source.stop(0),this.source=null,this._state=r,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(e,t){if(!e)return void console.error("The firstNode must be a valid Audio Node");t||(t=e);var i=this._manager.context.destination;this._firstNode!==e&&(this._firstNode?this._connectorNode.disconnect(this._firstNode):this._connectorNode.disconnect(i),this._firstNode=e,this._connectorNode.connect(e)),this._lastNode!==t&&(this._lastNode&&this._lastNode.disconnect(i),this._lastNode=t,this._lastNode.connect(i))},clearExternalNodes:function(){var e=this._manager.context.destination;this._firstNode&&(this._connectorNode.disconnect(this._firstNode),this._firstNode=null),this._lastNode&&(this._lastNode.disconnect(e),this._lastNode=null),this._connectorNode.connect(e)},getExternalNodes:function(){return[this._firstNode,this._lastNode]},_createSource:function(){if(!this._sound)return null;var e=this._manager.context;return this._sound.buffer&&(this.source=e.createBufferSource(),this.source.buffer=this._sound.buffer,this.source.connect(this._inputNode),this.source.onended=this._endedHandler,this.source.loopStart=s(this._startTime,this.source.buffer.duration),this._duration&&(this.source.loopEnd=Math.max(this.source.loopStart,s(this._startTime+this._duration,this.source.buffer.duration)))),this.source},_updateCurrentTime:function(){this._currentTime=s((this._manager.context.currentTime-this._startedAt)*this.pitch+this._currentOffset,this.duration)},_onManagerDestroy:function(){this.source&&this.isPlaying&&(this.source.stop(0),this.source=null)}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){e=n.math.clamp(e,0,1),this._volume=e,this.gain&&(this.gain.gain.value=e*this._manager.volume)}}),Object.defineProperty(e.prototype,"pitch",{get:function(){return this._pitch},set:function(e){this._currentOffset=this.currentTime,this._startedAt=this._manager.context.currentTime,this._pitch=Math.max(Number(e)||0,.01),this.source&&(this.source.playbackRate.value=this._pitch)}}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=!!e,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._sound},set:function(e){this._sound=e,this.isStopped?this._createSource():this.stop()}}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:this.isPaused?this._currentTime:this.isStopped||!this.source?0:(this._updateCurrentTime(),this._currentTime)},set:function(e){if(!(e<0))if(this.isPlaying){this.stop();var t=this._suspendInstanceEvents;this._suspendInstanceEvents=!0,this._startOffset=e,this.play(),this._suspendInstanceEvents=t}else this._startOffset=e,this._currentTime=e}})):n.SoundManager.hasAudio()?(e=function(e,t,i){n.events.attach(this),i=i||{},this._volume=void 0!==i.volume?n.math.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._sound=t,this._state=r,this._suspended=!1,this._suspendEndEvent=!1,this._suspendInstanceEvents=!1,this._playWhenLoaded=!0,this._startTime=Math.max(0,Number(i.startTime)||0),this._duration=Math.max(0,Number(i.duration)||0),this._startOffset=null,this._isReady=!1,this._manager=e,this._loadedMetadataHandler=this._onLoadedMetadata.bind(this),this._timeUpdateHandler=this._onTimeUpdate.bind(this),this._endedHandler=this._onEnded.bind(this),this._onPlayCallback=i.onPlay,this._onPauseCallback=i.onPause,this._onResumeCallback=i.onResume,this._onStopCallback=i.onStop,this._onEndCallback=i.onEnd,this.source=null,this._createSource()},Object.assign(e.prototype,{play:function(){return this._state!==r&&this.stop(),!(!this.source&&!this._createSource())&&(this.volume=this._volume,this.pitch=this._pitch,this.loop=this._loop,this.source.play(),this._state=t,this._playWhenLoaded=!1,this._manager.on("volumechange",this._onManagerVolumeChange,this),this._manager.on("suspend",this._onManagerSuspend,this),this._manager.on("resume",this._onManagerResume,this),this._manager.on("destroy",this._onManagerDestroy,this),this._manager.suspended&&this._onManagerSuspend(),this._suspendInstanceEvents||this._onPlay(),!0)},pause:function(){return!(!this.source||this._state!==t)&&(this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=i,this._startOffset=null,this._suspendInstanceEvents||this._onPause(),!0)},resume:function(){return!(!this.source||this._state!==i)&&(this._state=t,this._playWhenLoaded=!1,this.source.paused&&(this.source.play(),this._suspendInstanceEvents||this._onResume()),!0)},stop:function(){return!(!this.source||this._state===r)&&(this._manager.off("volumechange",this._onManagerVolumeChange,this),this._manager.off("suspend",this._onManagerSuspend,this),this._manager.off("resume",this._onManagerResume,this),this._manager.off("destroy",this._onManagerDestroy,this),this._suspendEndEvent=!0,this.source.pause(),this._playWhenLoaded=!1,this._state=r,this._startOffset=null,this._suspendInstanceEvents||this._onStop(),!0)},setExternalNodes:function(){},clearExternalNodes:function(){},getExternalNodes:function(){return[null,null]},_onLoadedMetadata:function(){this.source.removeEventListener("loadedmetadata",this._loadedMetadataHandler),this._isReady=!0;var e=s(this._startOffset,this.duration);e=s(this._startTime+e,this._sound.duration),this._startOffset=null,this.source.currentTime=e},_createSource:function(){return this._sound&&this._sound.audio&&(this._isReady=!1,this.source=this._sound.audio.cloneNode(!0),this.source.addEventListener("loadedmetadata",this._loadedMetadataHandler),this.source.addEventListener("timeupdate",this._timeUpdateHandler),this.source.onended=this._endedHandler),this.source},_onTimeUpdate:function(){this._duration&&this.source.currentTime>s(this._startTime+this._duration,this.source.duration)&&(this.loop?this.source.currentTime=s(this._startTime,this.source.duration):(this.source.removeEventListener("timeupdate",this._timeUpdateHandler),this.source.pause(),this._onEnded()))},_onManagerDestroy:function(){this.source&&this.source.pause()}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){e=n.math.clamp(e,0,1),this._volume=e,this.source&&(this.source.volume=e*this._manager.volume)}}),Object.defineProperty(e.prototype,"pitch",{get:function(){return this._pitch},set:function(e){this._pitch=Math.max(Number(e)||0,.01),this.source&&(this.source.playbackRate=this._pitch)}}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=!!e,this.source&&(this.source.loop=this._loop)}}),Object.defineProperty(e.prototype,"sound",{get:function(){return this._sound},set:function(e){this.stop(),this._sound=e}}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return null!==this._startOffset?this._startOffset:this.isStopped||!this.source?0:this.source.currentTime-this._startTime},set:function(e){e<0||(this._startOffset=e,this.source&&this._isReady&&(this.source.currentTime=s(this._startTime+s(e,this.duration),this._sound.duration),this._startOffset=null))}})):e=function(){},Object.assign(e.prototype,{_onPlay:function(){this.fire("play"),this._onPlayCallback&&this._onPlayCallback(this)},_onPause:function(){this.fire("pause"),this._onPauseCallback&&this._onPauseCallback(this)},_onResume:function(){this.fire("resume"),this._onResumeCallback&&this._onResumeCallback(this)},_onStop:function(){this.fire("stop"),this._onStopCallback&&this._onStopCallback(this)},_onEnded:function(){return this._suspendEndEvent?void(this._suspendEndEvent=!1):(this.fire("end"),this._onEndCallback&&this._onEndCallback(this),void this.stop())},_onManagerVolumeChange:function(){this.volume=this._volume},_onManagerSuspend:function(){this.isPlaying&&!this._suspended&&(this._suspended=!0,this.pause())},_onManagerResume:function(){this._suspended&&(this._suspended=!1,this.resume())}}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},set:function(e){this._startTime=Math.max(0,Number(e)||0);var t=this.isPlaying;this.stop(),t&&this.play()}}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._sound?this._duration?s(this._duration,this._sound.duration):this._sound.duration:0},set:function(e){this._duration=Math.max(0,Number(e)||0);var t=this.isPlaying;this.stop(),t&&this.play()}}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._state===t}}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this._state===i}}),Object.defineProperty(e.prototype,"isStopped",{get:function(){return this._state===r}}),Object.defineProperty(e.prototype,"isSuspended",{get:function(){return this._suspended}}),{SoundInstance:e}}()),Object.assign(n,function(){var e,t=1e4;if(n.SoundManager.hasAudioContext())e=function(e,i,r){n.SoundInstance.call(this,e,i,r),r=r||{},this._position=new n.Vec3,r.position&&(this.position=r.position),this._velocity=new n.Vec3,r.velocity&&(this.velocity=r.velocity),this.maxDistance=void 0!==r.maxDistance?Number(r.maxDistance):t,this.refDistance=void 0!==r.refDistance?Number(r.refDistance):1,this.rollOffFactor=void 0!==r.rollOffFactor?Number(r.rollOffFactor):1,this.distanceModel=void 0!==r.distanceModel?r.distanceModel:n.DISTANCE_LINEAR},e.prototype=Object.create(n.SoundInstance.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{_initializeNodes:function(){this.gain=this._manager.context.createGain(),this.panner=this._manager.context.createPanner(),this.panner.connect(this.gain),this._inputNode=this.panner,this._connectorNode=this.gain,this._connectorNode.connect(this._manager.context.destination)}}),Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){this._position.copy(e),this.panner.setPosition(e.x,e.y,e.z)}}),Object.defineProperty(e.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity.copy(e),this.panner.setVelocity(e.x,e.y,e.z)}}),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this.panner.maxDistance},set:function(e){this.panner.maxDistance=e}}),Object.defineProperty(e.prototype,"refDistance",{get:function(){return this.panner.refDistance},set:function(e){this.panner.refDistance=e}}),Object.defineProperty(e.prototype,"rollOffFactor",{get:function(){return this.panner.rolloffFactor},set:function(e){this.panner.rolloffFactor=e}}),Object.defineProperty(e.prototype,"distanceModel",{get:function(){return this.panner.distanceModel},set:function(e){this.panner.distanceModel=e}});else if(n.SoundManager.hasAudio()){var i=new n.Vec3,r=function(e,t,r,s,a,o){i=i.sub2(e,t);var h=i.length();if(h<r)return 1;if(h>s)return 0;var l=0;return o===n.DISTANCE_LINEAR?l=1-a*(h-r)/(s-r):o===n.DISTANCE_INVERSE?l=r/(r+a*(h-r)):o===n.DISTANCE_EXPONENTIAL&&(l=Math.pow(h/r,-a)),n.math.clamp(l,0,1)};e=function(e,i,r){n.SoundInstance.call(this,e,i,r),r=r||{},this._position=new n.Vec3,r.position&&(this.position=r.position),this._velocity=new n.Vec3,r.velocity&&(this.velocity=r.velocity),this._maxDistance=void 0!==r.maxDistance?Number(r.maxDistance):t,this._refDistance=void 0!==r.refDistance?Number(r.refDistance):1,this._rollOffFactor=void 0!==r.rollOffFactor?Number(r.rollOffFactor):1,this._distanceModel=void 0!==r.distanceModel?r.distanceModel:n.DISTANCE_LINEAR},e.prototype=Object.create(n.SoundInstance.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){if(this._position.copy(e),this.source){var t=this._manager.listener,i=t.getPosition(),n=r(i,this._position,this.refDistance,this.maxDistance,this.rollOffFactor,this.distanceModel),s=this.volume;this.source.volume=s*n*this._manager.volume}}}),Object.defineProperty(e.prototype,"velocity",{get:function(){return this._velocity},set:function(e){this._velocity.copy(e)}}),Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._maxDistance},set:function(e){this._maxDistance=e}}),Object.defineProperty(e.prototype,"refDistance",{get:function(){return this._refDistance},set:function(e){this._refDistance=e}}),Object.defineProperty(e.prototype,"rollOffFactor",{get:function(){return this._rollOffFactor},set:function(e){this._rollOffFactor=e}}),Object.defineProperty(e.prototype,"distanceModel",{get:function(){return this._distanceModel},set:function(e){this._distanceModel=e}})}else e=function(){};return{SoundInstance3d:e}}()),Object.assign(n,function(){var e;return n.AudioManager.hasAudioContext()?(e=function(e,t,i){i=i||{},this.volume=void 0===i.volume?1:i.volume,this.loop=void 0!==i.loop&&i.loop,this.pitch=void 0===i.pitch?1:i.pitch,this.sound=t,this.paused=!1,this.suspended=!1,this.startTime=0,this.startOffset=0,this.manager=e,this.source=null;var n=e.context;this.gain=n.createGain()},Object.assign(e.prototype,{play:function(){if(this.source)throw new Error("Call stop() before calling play()");this._createSource(),this.source&&(this.startTime=this.manager.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.manager.on("volumechange",this.onManagerVolumeChange,this),this.manager.on("suspend",this.onManagerSuspend,this),this.manager.on("resume",this.onManagerResume,this),this.manager.suspended&&this.onManagerSuspend())},pause:function(){this.source&&(this.paused=!0,this.startOffset+=this.manager.context.currentTime-this.startTime,this.source.stop(0),this.source=null)},unpause:function(){return this.source||!this.paused?void console.warn("Call pause() before unpausing."):(this._createSource(),void(this.source&&(this.startTime=this.manager.context.currentTime,this.source.start(0,this.startOffset%this.source.buffer.duration),this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.paused=!1)))},stop:function(){this.source&&(this.source.stop(0),this.source=null),this.manager.off("volumechange",this.onManagerVolumeChange,this),this.manager.off("suspend",this.onManagerSuspend,this),this.manager.off("resume",this.onManagerResume,this)},setLoop:function(e){this.loop=e,this.source&&(this.source.loop=e)},setVolume:function(e){e=n.math.clamp(e,0,1),this.volume=e,this.gain&&(this.gain.gain.value=e*this.manager.volume)},setPitch:function(e){this.pitch=e,this.source&&(this.source.playbackRate.value=e)},isPlaying:function(){return!this.paused&&this.source.playbackState===this.source.PLAYING_STATE},getDuration:function(){return this.source?this.source.buffer.duration:0},_createSource:function(){var e=this.manager.context;this.sound.buffer&&(this.source=e.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.gain),this.gain.connect(e.destination),this.loop||(this.source.onended=this.pause.bind(this)))}})):n.AudioManager.hasAudio()?(e=function(e,t,i){this.volume=i.volume||1,this.loop=i.loop||!1,this.sound=t,this.pitch=void 0!==i.pitch?i.pitch:1,this.paused=!1,this.suspended=!1,this.manager=e,t.audio&&(this.source=t.audio.cloneNode(!1),this.source.pause())},Object.assign(e.prototype,{play:function(){this.source&&(this.paused=!1,this.setVolume(this.volume),this.setLoop(this.loop),this.setPitch(this.pitch),this.source.play()),this.manager.on("volumechange",this.onManagerVolumeChange,this),this.manager.on("suspend",this.onManagerSuspend,this),this.manager.on("resume",this.onManagerResume,this),this.manager.suspended&&this.onManagerSuspend()},pause:function(){this.source&&(this.paused=!0,this.source.pause())},unpause:function(){this.source&&(this.paused=!1,this.source.play())},stop:function(){this.source&&this.source.pause(),this.manager.off("volumechange",this.onManagerVolumeChange,this),this.manager.off("suspend",this.onManagerSuspend,this),this.manager.off("resume",this.onManagerResume,this)},setVolume:function(e){e=n.math.clamp(e,0,1),this.volume=e,this.source&&(this.source.volume=e*this.manager.volume)},setLoop:function(e){this.loop=e,this.source&&(this.source.loop=e)},setPitch:function(e){this.pitch=e,this.source&&(this.source.playbackRate=e)},getDuration:function(){return this.source&&!isNaN(this.source.duration)?this.source.duration:0},isPlaying:function(){return!this.source.paused}})):e=function(){},Object.assign(e.prototype,{getVolume:function(){return this.volume},getLoop:function(){return this.loop},getPitch:function(){return this.pitch},onManagerVolumeChange:function(){this.setVolume(this.getVolume())},onManagerSuspend:function(){this.isPlaying()&&!this.suspended&&(this.suspended=!0,this.pause())},onManagerResume:function(){this.suspended&&(this.suspended=!1,this.unpause())}}),{Channel:e}}()),Object.assign(n,function(){var e,t=1e4;if(n.AudioManager.hasAudioContext())e=function(e,t,i){n.Channel.call(this,e,t,i),this.position=new n.Vec3,this.velocity=new n.Vec3;var r=e.context;this.panner=r.createPanner()},e.prototype=Object.create(n.Channel.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{getPosition:function(){return this.position},setPosition:function(e){this.position.copy(e),this.panner.setPosition(e.x,e.y,e.z)},getVelocity:function(){return this.velocity},setVelocity:function(e){this.velocity.copy(e),this.panner.setVelocity(e.x,e.y,e.z)},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},getMinDistance:function(){return this.panner.refDistance},setMinDistance:function(e){this.panner.refDistance=e},getRollOffFactor:function(){return this.panner.rolloffFactor},setRollOffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.pannel.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},_createSource:function(){var e=this.manager.context;this.source=e.createBufferSource(),this.source.buffer=this.sound.buffer,this.source.connect(this.panner),this.panner.connect(this.gain),this.gain.connect(e.destination),this.loop||(this.source.onended=this.pause.bind(this))}});else if(n.AudioManager.hasAudio()){var i=new n.Vec3,r=function(e,t,r,s,a,o){i=i.sub2(e,t);var h=i.length();if(h<r)return 1;if(h>s)return 0;var l=0;return o===n.DISTANCE_LINEAR?l=1-a*(h-r)/(s-r):o===n.DISTANCE_INVERSE?l=r/(r+a*(h-r)):o===n.DISTANCE_EXPONENTIAL&&(l=Math.pow(h/r,-a)),n.math.clamp(l,0,1);
};e=function(e,i){n.Channel.call(this,e,i),this.position=new n.Vec3,this.velocity=new n.Vec3,this.maxDistance=t,this.minDistance=1,this.rollOffFactor=1,this.distanceModel=n.DISTANCE_INVERSE},e.prototype=Object.create(n.Channel.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{getPosition:function(){return this.position},setPosition:function(e){if(this.position.copy(e),this.source){var t=this.manager.listener,i=t.getPosition(),n=r(i,this.position,this.minDistance,this.maxDistance,this.rollOffFactor,this.distanceModel),s=this.getVolume();this.source.volume=s*n}},getVelocity:function(){return this.velocity},setVelocity:function(e){this.velocity.copy(e)},getMaxDistance:function(){return this.maxDistance},setMaxDistance:function(e){this.maxDistance=e},getMinDistance:function(){return this.minDistance},setMinDistance:function(e){this.minDistance=e},getRollOffFactor:function(){return this.rollOffFactor},setRollOffFactor:function(e){this.rollOffFactor=e},getDistanceModel:function(){return this.distanceModel},setDistanceModel:function(e){this.distanceModel=e}})}else e=function(){};return{Channel3d:e}}()),function(){var e={ACTION_MOUSE:"mouse",ACTION_KEYBOARD:"keyboard",ACTION_GAMEPAD:"gamepad",AXIS_MOUSE_X:"mousex",AXIS_MOUSE_Y:"mousey",AXIS_PAD_L_X:"padlx",AXIS_PAD_L_Y:"padly",AXIS_PAD_R_X:"padrx",AXIS_PAD_R_Y:"padry",AXIS_KEY:"key",EVENT_KEYDOWN:"keydown",EVENT_KEYUP:"keyup",EVENT_MOUSEDOWN:"mousedown",EVENT_MOUSEMOVE:"mousemove",EVENT_MOUSEUP:"mouseup",EVENT_MOUSEWHEEL:"mousewheel",EVENT_TOUCHSTART:"touchstart",EVENT_TOUCHEND:"touchend",EVENT_TOUCHMOVE:"touchmove",EVENT_TOUCHCANCEL:"touchcancel",KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ENTER:13,KEY_SHIFT:16,KEY_CONTROL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINT_SCREEN:44,KEY_INSERT:45,KEY_DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_SEMICOLON:59,KEY_EQUAL:61,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_WINDOWS:91,KEY_CONTEXT_MENU:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_MULTIPLY:106,KEY_ADD:107,KEY_SEPARATOR:108,KEY_SUBTRACT:109,KEY_DECIMAL:110,KEY_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_COMMA:188,KEY_PERIOD:190,KEY_SLASH:191,KEY_OPEN_BRACKET:219,KEY_BACK_SLASH:220,KEY_CLOSE_BRACKET:221,KEY_META:224,MOUSEBUTTON_NONE:-1,MOUSEBUTTON_LEFT:0,MOUSEBUTTON_MIDDLE:1,MOUSEBUTTON_RIGHT:2,PAD_1:0,PAD_2:1,PAD_3:2,PAD_4:3,PAD_FACE_1:0,PAD_FACE_2:1,PAD_FACE_3:2,PAD_FACE_4:3,PAD_L_SHOULDER_1:4,PAD_R_SHOULDER_1:5,PAD_L_SHOULDER_2:6,PAD_R_SHOULDER_2:7,PAD_SELECT:8,PAD_START:9,PAD_L_STICK_BUTTON:10,PAD_R_STICK_BUTTON:11,PAD_UP:12,PAD_DOWN:13,PAD_LEFT:14,PAD_RIGHT:15,PAD_VENDOR:16,PAD_L_STICK_X:0,PAD_L_STICK_Y:1,PAD_R_STICK_X:2,PAD_R_STICK_Y:3};Object.assign(n,e),n.input={},Object.assign(n.input,e)}(),Object.assign(n,function(){var e=function(t,i){var r={x:0,y:0};if(i){if(i instanceof e)throw Error("Expected MouseEvent");r=t._getTargetCoords(i)}else i={};if(r)this.x=r.x,this.y=r.y;else{if(!n.Mouse.isPointerLocked())return;this.x=0,this.y=0}i.detail?this.wheel=-1*i.detail:i.wheelDelta?this.wheel=i.wheelDelta/120:this.wheel=0,n.Mouse.isPointerLocked()?(this.dx=i.movementX||i.webkitMovementX||i.mozMovementX||0,this.dy=i.movementY||i.webkitMovementY||i.mozMovementY||0):(this.dx=this.x-t._lastX,this.dy=this.y-t._lastY),"mousedown"===i.type||"mouseup"===i.type?this.button=i.button:this.button=n.MOUSEBUTTON_NONE,this.buttons=t._buttons.slice(0),this.element=i.target,this.ctrlKey=i.ctrlKey||!1,this.altKey=i.altKey||!1,this.shiftKey=i.shiftKey||!1,this.metaKey=i.metaKey||!1,this.event=i},t=function(e){this._lastX=0,this._lastY=0,this._buttons=[!1,!1,!1],this._lastbuttons=[!1,!1,!1],this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._contextMenuHandler=function(e){e.preventDefault()},this._target=null,this._attached=!1,this.attach(e),n.events.attach(this)};return t.isPointerLocked=function(){return!!(document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement)},Object.assign(t.prototype,{attach:function(e){this._target=e,this._attached||(this._attached=!0,window.addEventListener("mouseup",this._upHandler,!1),window.addEventListener("mousedown",this._downHandler,!1),window.addEventListener("mousemove",this._moveHandler,!1),window.addEventListener("mousewheel",this._wheelHandler,!1),window.addEventListener("DOMMouseScroll",this._wheelHandler,!1))},detach:function(){this._attached&&(this._attached=!1,window.removeEventListener("mouseup",this._upHandler),window.removeEventListener("mousedown",this._downHandler),window.removeEventListener("mousemove",this._moveHandler),window.removeEventListener("mousewheel",this._wheelHandler),window.removeEventListener("DOMMouseScroll",this._wheelHandler))},disableContextMenu:function(){this._target&&this._target.addEventListener("contextmenu",this._contextMenuHandler)},enableContextMenu:function(){this._target&&this._target.removeEventListener("contextmenu",this._contextMenuHandler)},enablePointerLock:function(e,t){if(!document.body.requestPointerLock)return void(t&&t());var i=function(){e(),document.removeEventListener("pointerlockchange",i)},n=function(){t(),document.removeEventListener("pointerlockerror",n)};e&&document.addEventListener("pointerlockchange",i,!1),t&&document.addEventListener("pointerlockerror",n,!1),document.body.requestPointerLock()},disablePointerLock:function(e){if(document.exitPointerLock){var t=function(){e(),document.removeEventListener("pointerlockchange",t)};e&&document.addEventListener("pointerlockchange",t,!1),document.exitPointerLock()}},update:function(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2]},isPressed:function(e){return this._buttons[e]},wasPressed:function(e){return this._buttons[e]&&!this._lastbuttons[e]},wasReleased:function(e){return!this._buttons[e]&&this._lastbuttons[e]},_handleUp:function(t){this._buttons[t.button]=!1;var i=new e(this,t);i.event&&this.fire(n.EVENT_MOUSEUP,i)},_handleDown:function(t){this._buttons[t.button]=!0;var i=new e(this,t);i.event&&this.fire(n.EVENT_MOUSEDOWN,i)},_handleMove:function(t){var i=new e(this,t);i.event&&(this.fire(n.EVENT_MOUSEMOVE,i),this._lastX=i.x,this._lastY=i.y)},_handleWheel:function(t){var i=new e(this,t);i.event&&this.fire(n.EVENT_MOUSEWHEEL,i)},_getTargetCoords:function(e){var t=this._target.getBoundingClientRect(),i=Math.floor(t.left),n=Math.floor(t.top);return e.clientX<i||e.clientX>=i+this._target.clientWidth||e.clientY<n||e.clientY>=n+this._target.clientHeight?null:{x:e.clientX-i,y:e.clientY-n}}}),{Mouse:t,MouseEvent:e}}()),Object.assign(n,function(){function e(e){return r.key=e.keyCode,r.element=e.target,r.event=e,r}function t(e){return"string"==typeof e?e.toUpperCase().charCodeAt(0):e}var i=function(e,t){t?(this.key=t.keyCode,this.element=t.target,this.event=t):(this.key=null,this.element=null,this.event=null)},r=new i,s={9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",27:"Escape",37:"Left",38:"Up",39:"Right",40:"Down",46:"Delete",91:"Win"},a=function(e,t){t=t||{},this._element=null,this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this._keyPressHandler=this._handleKeyPress.bind(this),n.events.attach(this),this._keymap={},this._lastmap={},e&&this.attach(e),this.preventDefault=t.preventDefault||!1,this.stopPropagation=t.stopPropagation||!1};return a.prototype.attach=function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keypress",this._keyPressHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)},a.prototype.detach=function(){this._element.removeEventListener("keydown",this._keyDownHandler),this._element.removeEventListener("keypress",this._keyPressHandler),this._element.removeEventListener("keyup",this._keyUpHandler),this._element=null},a.prototype.toKeyIdentifier=function(e){e=t(e);var i,n,r,a=s[e.toString()];if(a)return a;for(n=e.toString(16).toUpperCase(),r=n.length,i=0;i<4-r;i++)n="0"+n;return"U+"+n},a.prototype._handleKeyDown=function(t){var i=t.keyCode||t.charCode;if(void 0!==i){var n=this.toKeyIdentifier(i);this._keymap[n]=!0,this.fire("keydown",e(t)),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()}},a.prototype._handleKeyUp=function(t){var i=t.keyCode||t.charCode;if(void 0!==i){var n=this.toKeyIdentifier(i);delete this._keymap[n],this.fire("keyup",e(t)),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()}},a.prototype._handleKeyPress=function(t){this.fire("keypress",e(t)),this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},a.prototype.update=function(){var e;for(e in this._lastmap)delete this._lastmap[e];for(e in this._keymap)this._keymap.hasOwnProperty(e)&&(this._lastmap[e]=this._keymap[e])},a.prototype.isPressed=function(e){var i=t(e),n=this.toKeyIdentifier(i);return!!this._keymap[n]},a.prototype.wasPressed=function(e){var i=t(e),n=this.toKeyIdentifier(i);return!!this._keymap[n]&&!this._lastmap[n]},a.prototype.wasReleased=function(e){var i=t(e),n=this.toKeyIdentifier(i);return!this._keymap[n]&&!!this._lastmap[n]},{Keyboard:a,KeyboardEvent:i}}()),Object.assign(n,function(){var e=function(){this.gamepadsSupported=!!navigator.getGamepads||!!navigator.webkitGetGamepads,this.current=[],this.previous=[],this.deadZone=.25},t={DEFAULT:{buttons:["PAD_FACE_1","PAD_FACE_2","PAD_FACE_3","PAD_FACE_4","PAD_L_SHOULDER_1","PAD_R_SHOULDER_1","PAD_L_SHOULDER_2","PAD_R_SHOULDER_2","PAD_SELECT","PAD_START","PAD_L_STICK_BUTTON","PAD_R_STICK_BUTTON","PAD_UP","PAD_DOWN","PAD_LEFT","PAD_RIGHT","PAD_VENDOR"],axes:["PAD_L_STICK_X","PAD_L_STICK_Y","PAD_R_STICK_X","PAD_R_STICK_Y"]},PS3:{buttons:["PAD_FACE_1","PAD_FACE_2","PAD_FACE_4","PAD_FACE_3","PAD_L_SHOULDER_1","PAD_R_SHOULDER_1","PAD_L_SHOULDER_2","PAD_R_SHOULDER_2","PAD_SELECT","PAD_START","PAD_L_STICK_BUTTON","PAD_R_STICK_BUTTON","PAD_UP","PAD_DOWN","PAD_LEFT","PAD_RIGHT","PAD_VENDOR"],axes:["PAD_L_STICK_X","PAD_L_STICK_Y","PAD_R_STICK_X","PAD_R_STICK_Y"]}},i={"Product: 0268":"PS3"};return Object.assign(e.prototype,{update:function(){var e,t,i,n,r;for(e=0,i=this.current.length;e<i;e++)for(n=this.current[e].pad.buttons,r=n.length,t=0;t<r;t++)void 0===this.previous[e]&&(this.previous[e]=[]),this.previous[e][t]=n[t].pressed;var s=this.poll();for(e=0,i=s.length;e<i;e++)this.current[e]=s[e]},poll:function(){var e=[];if(this.gamepadsSupported){var t,i=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads(),n=i.length;for(t=0;t<n;t++)i[t]&&e.push({map:this.getMap(i[t]),pad:i[t]})}return e},getMap:function(e){for(var n in i)if(e.id.indexOf(n)>=0)return t[i[n]];return t.DEFAULT},isPressed:function(e,t){if(!this.current[e])return!1;var i=this.current[e].map.buttons[t];return this.current[e].pad.buttons[n[i]].pressed},wasPressed:function(e,t){if(!this.current[e])return!1;var i=this.current[e].map.buttons[t],r=n[i];return this.current[e].pad.buttons[r].pressed&&!this.previous[e][r]},getAxis:function(e,t){if(!this.current[e])return!1;var i=this.current[e].map.axes[t],r=this.current[e].pad.axes[n[i]];return Math.abs(r)<this.deadZone&&(r=0),r}}),{GamePads:e}}()),Object.assign(n,function(){var e=function(e){var t=n.getTouchTargetCoords(e);this.id=e.identifier,this.x=t.x,this.y=t.y,this.target=e.target,this.touch=e},t=function(t,i){if(this.element=i.target,this.event=i,this.touches=[],this.changedTouches=[],i){var n,r=i.touches.length;for(n=0;n<r;n++)this.touches.push(new e(i.touches[n]));for(r=i.changedTouches.length,n=0;n<r;n++)this.changedTouches.push(new e(i.changedTouches[n]))}};Object.assign(t.prototype,{getTouchById:function(e,t){var i,n=t.length;for(i=0;i<n;i++)if(t[i].id===e)return t[i];return null}});var i=function(e){this._startHandler=this._handleTouchStart.bind(this),this._endHandler=this._handleTouchEnd.bind(this),this._moveHandler=this._handleTouchMove.bind(this),this._cancelHandler=this._handleTouchCancel.bind(this),this.attach(e),n.events.attach(this)};return Object.assign(i.prototype,{attach:function(e){this._element&&this.detach(),this._element=e,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)},detach:function(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1)),this._element=null},_handleTouchStart:function(e){this.fire("touchstart",new t(this,e))},_handleTouchEnd:function(e){this.fire("touchend",new t(this,e))},_handleTouchMove:function(e){e.preventDefault(),this.fire("touchmove",new t(this,e))},_handleTouchCancel:function(e){this.fire("touchcancel",new t(this,e))}}),{getTouchTargetCoords:function(e){for(var t=0,i=0,n=e.target;!(n instanceof HTMLElement);)n=n.parentNode;var r=n;do t+=r.offsetLeft-r.scrollLeft,i+=r.offsetTop-r.scrollTop,r=r.offsetParent;while(r);return{x:e.pageX-t,y:e.pageY-i}},TouchDevice:i,TouchEvent:t}}()),Object.assign(n,function(){var e=function(e,t){t=t||{},this._keyboard=t.keyboard||null,this._mouse=t.mouse||null,this._gamepads=t.gamepads||null,this._element=null,this._actions={},this._axes={},this._axesValues={},e&&this.attach(e)};return e.prototype.attach=function(e){this._element=e,this._keyboard&&this._keyboard.attach(e),this._mouse&&this._mouse.attach(e)},e.prototype.detach=function(){this._keyboard&&this._keyboard.detach(),this._mouse&&this._mouse.detach(),this._element=null},e.prototype.disableContextMenu=function(){this._mouse||this._enableMouse(),this._mouse.disableContextMenu()},e.prototype.enableContextMenu=function(){this._mouse||this._enableMouse(),this._mouse.enableContextMenu()},e.prototype.update=function(e){this._keyboard&&this._keyboard.update(e),this._mouse&&this._mouse.update(e),this._gamepads&&this._gamepads.update(e),this._axesValues={};for(var t in this._axes)this._axesValues[t]=[]},e.prototype.registerKeys=function(e,t){if(this._keyboard||this._enableKeyboard(),this._actions[e])throw new Error(n.string.format("Action: {0} already registered",e));if(void 0===t)throw new Error("Invalid button");t.length||(t=[t]),this._actions[e]?this._actions[e].push({type:n.ACTION_KEYBOARD,keys:t}):this._actions[e]=[{type:n.ACTION_KEYBOARD,keys:t}]},e.prototype.registerMouse=function(e,t){if(this._mouse||this._enableMouse(),void 0===t)throw new Error("Invalid button");this._actions[e]?this._actions[e].push({type:n.ACTION_MOUSE,button:t}):this._actions[e]=[{type:n.ACTION_MOUSE,button:-t}]},e.prototype.registerPadButton=function(e,t,i){if(void 0===i)throw new Error("Invalid button");this._actions[e]?this._actions[e].push({type:n.ACTION_GAMEPAD,button:i,pad:t}):this._actions[e]=[{type:n.ACTION_GAMEPAD,button:i,pad:t}]},e.prototype.registerAxis=function(e){var t=e.name;this._axes[t]||(this._axes[t]=[]);var i=this._axes[t].push(t);e=e||{},e.pad=e.pad||n.PAD_1;var r=function(r,s,a,o){switch(s){case"mousex":r._mouse.on(n.EVENT_MOUSEMOVE,function(e){r._axesValues[t][i]=e.dx/10});break;case"mousey":r._mouse.on(n.EVENT_MOUSEMOVE,function(e){r._axesValues[t][i]=e.dy/10});break;case"key":r._axes[t].push(function(){return r._keyboard.isPressed(o)?a:0});break;case"padrx":r._axes[t].push(function(){return r._gamepads.getAxis(e.pad,n.PAD_R_STICK_X)});break;case"padry":r._axes[t].push(function(){return r._gamepads.getAxis(e.pad,n.PAD_R_STICK_Y)});break;case"padlx":r._axes[t].push(function(){return r._gamepads.getAxis(e.pad,n.PAD_L_STICK_X)});break;case"padly":r._axes[t].push(function(){return r._gamepads.getAxis(e.pad,n.PAD_L_STICK_Y)});break;default:throw new Error("Unknown axis")}};r(this,e.positive,1,e.positiveKey),(e.negativeKey||e.negative!==e.positive)&&r(this,e.negative,-1,e.negativeKey)},e.prototype.isPressed=function(e){if(!this._actions[e])return!1;var t,i=0,r=this._actions[e].length;for(i=0;i<r;++i)switch(t=this._actions[e][i],t.type){case n.ACTION_KEYBOARD:if(this._keyboard){var s,a=t.keys.length;for(s=0;s<a;s++)if(this._keyboard.isPressed(t.keys[s]))return!0}break;case n.ACTION_MOUSE:if(this._mouse&&this._mouse.isPressed(t.button))return!0;break;case n.ACTION_GAMEPAD:if(this._gamepads&&this._gamepads.isPressed(t.pad,t.button))return!0}return!1},e.prototype.wasPressed=function(e){if(!this._actions[e])return!1;var t=0,i=this._actions[e].length;for(t=0;t<i;++t){var r=this._actions[e][t];switch(r.type){case n.ACTION_KEYBOARD:if(this._keyboard){var s,a=r.keys.length;for(s=0;s<a;s++)if(this._keyboard.wasPressed(r.keys[s]))return!0}break;case n.ACTION_MOUSE:if(this._mouse&&this._mouse.wasPressed(r.button))return!0;break;case n.ACTION_GAMEPAD:if(this._gamepads&&this._gamepads.wasPressed(r.pad,r.button))return!0}}return!1},e.prototype.getAxis=function(e){var t=0;if(this._axes[e]){var i,r=this._axes[e].length;for(i=0;i<r;i++)if("function"===n.type(this._axes[e][i])){var s=this._axes[e][i]();Math.abs(s)>Math.abs(t)&&(t=s)}else this._axesValues[e]&&Math.abs(this._axesValues[e][i])>Math.abs(t)&&(t=this._axesValues[e][i])}return t},e.prototype._enableMouse=function(){if(this._mouse=new n.Mouse,!this._element)throw new Error("Controller must be attached to an Element");this._mouse.attach(this._element)},e.prototype._enableKeyboard=function(){if(this._keyboard=new n.Keyboard,!this._element)throw new Error("Controller must be attached to an Element");this._keyboard.attach(this._element)},{Controller:e}}()),Object.assign(n,function(){var e,t,i=new n.Vec3,r=new n.Vec3,s=new n.Vec3,a=new n.Vec3,o=new n.Vec3,h=new n.Vec3,l=new n.Vec3,c=new n.Vec3,d=new n.Vec3,u=new n.Vec2,f=new n.Vec3,p=new n.Vec3,_=new n.Vec3,m=new n.Vec3,A=new n.Vec3,v=new n.Vec3,y=new n.Vec3,g=new n.Vec3,b=new n.Vec4,E=function(e,t,i){return d.cross(e,t).dot(i)},T=function(e,t,i){s.sub2(t,e),a.sub2(i[0],e),o.sub2(i[1],e),h.sub2(i[2],e),c.cross(h,s);var n=a.dot(c);if(n>=0){if(-o.dot(c)<0)return!1;if(E(s,o,a)<0)return!1}else{if(l.sub2(i[3],e),l.dot(c)<0)return!1;if(E(s,a,l)<0)return!1}return!(s.sub2(i[0],i[2]).lengthSq()<1e-8)&&!(s.sub2(i[1],i[3]).lengthSq()<1e-8)},S=function(e,t,i){this.event=e,this.element=t,this.camera=i,this._stopPropagation=!1};Object.assign(S.prototype,{stopPropagation:function(){this._stopPropagation=!0,this.event.stopImmediatePropagation(),this.event.stopPropagation()}});var w=function(e,t,i,r,s,a,o){S.call(this,e,t,i),this.x=r,this.y=s,this.ctrlKey=e.ctrlKey||!1,this.altKey=e.altKey||!1,this.shiftKey=e.shiftKey||!1,this.metaKey=e.metaKey||!1,this.button=e.button,n.Mouse.isPointerLocked()?(this.dx=e.movementX||e.webkitMovementX||e.mozMovementX||0,this.dy=e.movementY||e.webkitMovementY||e.mozMovementY||0):(this.dx=r-a,this.dy=s-o),e.detail?this.wheel=-1*e.detail:e.wheelDelta?this.wheel=e.wheelDelta/120:this.wheel=0};w.prototype=Object.create(S.prototype),w.prototype.constructor=w;var C=function(e,t,i,n,r,s){S.call(this,e,t,i),this.touches=e.touches,this.changedTouches=e.changedTouches,this.x=n,this.y=r};C.prototype=Object.create(S.prototype),C.prototype.constructor=C;var M=function(e){this._app=null,this._attached=!1,this._target=null,this._enabled=!0,this._lastX=0,this._lastY=0,this._upHandler=this._handleUp.bind(this),this._downHandler=this._handleDown.bind(this),this._moveHandler=this._handleMove.bind(this),this._wheelHandler=this._handleWheel.bind(this),this._touchstartHandler=this._handleTouchStart.bind(this),this._touchendHandler=this._handleTouchEnd.bind(this),this._touchcancelHandler=this._touchendHandler,this._touchmoveHandler=this._handleTouchMove.bind(this),this._elements=[],this._hoveredElement=null,this._pressedElement=null,this._touchedElements={},this._touchesForWhichTouchLeaveHasFired={},"ontouchstart"in window&&(this._clickedEntities={}),this.attach(e)};return Object.assign(M.prototype,{attach:function(e){this._attached&&(this._attached=!1,this.detach()),this._target=e,this._attached=!0,window.addEventListener("mouseup",this._upHandler,{passive:!0}),window.addEventListener("mousedown",this._downHandler,{passive:!0}),window.addEventListener("mousemove",this._moveHandler,{passive:!0}),window.addEventListener("mousewheel",this._wheelHandler,{passive:!0}),window.addEventListener("DOMMouseScroll",this._wheelHandler,{passive:!0}),"ontouchstart"in window&&(this._target.addEventListener("touchstart",this._touchstartHandler,{passive:!0}),this._target.addEventListener("touchend",this._touchendHandler,!1),this._target.addEventListener("touchmove",this._touchmoveHandler,!1),this._target.addEventListener("touchcancel",this._touchcancelHandler,{passive:!0}))},detach:function(){this._attached&&(this._attached=!1,window.removeEventListener("mouseup",this._upHandler,!1),window.removeEventListener("mousedown",this._downHandler,!1),window.removeEventListener("mousemove",this._moveHandler,!1),window.removeEventListener("mousewheel",this._wheelHandler,!1),window.removeEventListener("DOMMouseScroll",this._wheelHandler,!1),this._target.removeEventListener("touchstart",this._touchstartHandler,!1),this._target.removeEventListener("touchend",this._touchendHandler,!1),this._target.removeEventListener("touchmove",this._touchmoveHandler,!1),this._target.removeEventListener("touchcancel",this._touchcancelHandler,!1),this._target=null)},addElement:function(e){this._elements.indexOf(e)===-1&&this._elements.push(e)},removeElement:function(e){var t=this._elements.indexOf(e);t!==-1&&this._elements.splice(t,1)},_handleUp:function(t){this._enabled&&(n.Mouse.isPointerLocked()||(this._calcMouseCoords(t),null!==e&&this._onElementMouseEvent(t)))},_handleDown:function(t){this._enabled&&(n.Mouse.isPointerLocked()||(this._calcMouseCoords(t),null!==e&&this._onElementMouseEvent(t)))},_handleMove:function(i){this._enabled&&(this._calcMouseCoords(i),null!==e&&(this._onElementMouseEvent(i),this._lastX=e,this._lastY=t))},_handleWheel:function(t){this._enabled&&(this._calcMouseCoords(t),null!==e&&this._onElementMouseEvent(t))},_determineTouchedElements:function(e){var t,i,n,r={},s=this.app.systems.camera.cameras;for(t=s.length-1;t>=0;t--){var a=s[t],o=0;for(i=0,n=e.changedTouches.length;i<n;i++)if(r[e.changedTouches[i].identifier])o++;else{var h=this._calcTouchCoords(e.changedTouches[i]),l=this._getTargetElement(a,h.x,h.y);l&&(o++,r[e.changedTouches[i].identifier]={element:l,camera:a,x:h.x,y:h.y})}if(o===n)break}return r},_handleTouchStart:function(e){if(this._enabled){for(var t=this._determineTouchedElements(e),i=0,n=e.changedTouches.length;i<n;i++){var r=e.changedTouches[i],s=t[r.identifier],a=this._touchedElements[r.identifier];!s||a&&s.element===a.element||(this._fireEvent(e.type,new C(e,s.element,s.camera,s.x,s.y,this)),this._touchesForWhichTouchLeaveHasFired[r.identifier]=!1)}for(var o in t)this._touchedElements[o]=t[o]}},_handleTouchEnd:function(e){if(this._enabled){var t=this.app.systems.camera.cameras;for(var i in this._clickedEntities)delete this._clickedEntities[i];for(var n=0,r=e.changedTouches.length;n<r;n++){var s=e.changedTouches[n],a=this._touchedElements[s.identifier];if(a){var o=a.element,h=a.camera,l=a.x,c=a.y;if(delete this._touchedElements[s.identifier],delete this._touchesForWhichTouchLeaveHasFired[s.identifier],this._fireEvent(e.type,new C(e,o,h,l,c,this)),0===e.touches.length)for(var d=this._calcTouchCoords(s),u=t.length-1;u>=0;u--){var f=this._getTargetElement(t[u],d.x,d.y);f===o&&(this._clickedEntities[o.entity.getGuid()]||(this._fireEvent("click",new C(e,o,h,l,c,this)),this._clickedEntities[o.entity.getGuid()]=!0))}}}}},_handleTouchMove:function(e){if(this._enabled){e.preventDefault();for(var t=this._determineTouchedElements(e),i=0,n=e.changedTouches.length;i<n;i++){var r=e.changedTouches[i],s=t[r.identifier],a=this._touchedElements[r.identifier];if(a){var o=this._calcTouchCoords(r);s&&s.element===a.element||this._touchesForWhichTouchLeaveHasFired[r.identifier]||(this._fireEvent("touchleave",new C(e,a.element,a.camera,o.x,o.y,this)),this._touchesForWhichTouchLeaveHasFired[r.identifier]=!0),this._fireEvent("touchmove",new C(e,a.element,a.camera,o.x,o.y,this))}}}},_onElementMouseEvent:function(i){var r,s=this._hoveredElement;this._hoveredElement=null;for(var a,o=this.app.systems.camera.cameras,h=o.length-1;h>=0&&(a=o[h],!(r=this._getTargetElement(a,e,t)));h--);r&&(this._fireEvent(i.type,new w(i,r,a,e,t,this._lastX,this._lastY)),this._hoveredElement=r,i.type===n.EVENT_MOUSEDOWN&&(this._pressedElement=r)),s!==this._hoveredElement&&(s&&this._fireEvent("mouseleave",new w(i,s,a,e,t,this._lastX,this._lastY)),this._hoveredElement&&this._fireEvent("mouseenter",new w(i,this._hoveredElement,a,e,t,this._lastX,this._lastY))),i.type===n.EVENT_MOUSEUP&&this._pressedElement&&(this._pressedElement===this._hoveredElement?(this._pressedElement=null,this._clickedEntities&&this._clickedEntities[this._hoveredElement.entity.getGuid()]||this._fireEvent("click",new w(i,this._hoveredElement,a,e,t,this._lastX,this._lastY))):this._pressedElement=null)},_fireEvent:function(e,t){for(var i=t.element;;){if(i.fire(e,t),t._stopPropagation)break;if(!i.entity.parent)break;if(i=i.entity.parent.element,!i)break}},_calcMouseCoords:function(i){var n=this._target.getBoundingClientRect(),r=Math.floor(n.left),s=Math.floor(n.top);i.clientX<r||i.clientX>=r+this._target.clientWidth||i.clientY<s||i.clientY>=s+this._target.clientHeight?(e=null,t=null):(e=i.clientX-r,t=i.clientY-s)},_calcTouchCoords:function(e){for(var t=0,i=0,n=e.target;!(n instanceof HTMLElement);)n=n.parentNode;var r=n;do t+=r.offsetLeft-r.scrollLeft,i+=r.offsetTop-r.scrollTop,r=r.offsetParent;while(r);return{x:e.pageX-t,y:e.pageY-i}},_sortElements:function(e,t){return e.screen&&!t.screen?-1:!e.screen&&t.screen?1:e.screen||t.screen?e.screen.screen.screenSpace&&!t.screen.screen.screenSpace?-1:t.screen.screen.screenSpace&&!e.screen.screen.screenSpace?1:t.drawOrder-e.drawOrder:0},_getTargetElement:function(e,t,i){var n=null;this._elements.sort(this._sortElements);for(var r=0,s=this._elements.length;r<s;r++){var a=this._elements[r];if(a.screen&&a.screen.screen.screenSpace){if(this._checkElement2d(t,i,a,e)){n=a;break}}else if(this._checkElement3d(t,i,a,e)){n=a;break}}return n},_buildHitCorners:function(e,t,i,n){var r=t,s=e.entity&&e.entity.button;if(s){var a=e.entity.button.hitPadding||b;f.copy(e.entity.up),p.copy(f).scale(-1),m.copy(e.entity.right),_.copy(m).scale(-1),f.scale(a.data[3]*n),p.scale(a.data[1]*n),m.scale(a.data[2]*i),_.scale(a.data[0]*i),A.copy(r[0]).add(p).add(_),v.copy(r[1]).add(p).add(m),y.copy(r[2]).add(f).add(m),g.copy(r[3]).add(f).add(_),r=[A,v,y,g]}return r},_calculateScaleToScreen:function(e){var t=e.entity,i=e.screen.screen.scale;for(u.set(i,i);t&&!t.screen;)u.mul(t.getLocalScale()),t=t.parent;return u},_checkElement2d:function(e,t,n,s){var a=this.app.graphicsDevice.width,o=this.app.graphicsDevice.height,h=s.rect.z*a,l=s.rect.w*o,c=s.rect.x*a,d=c+h,u=(1-s.rect.y)*o,f=u-l,p=e*a/this._target.clientWidth,_=t*o/this._target.clientHeight;if(p>=c&&p<=d&&_<=u&&_>=f){p=a*(p-c)/h,_=o*(_-f)/l,_=o-_;var m=this._calculateScaleToScreen(n),A=this._buildHitCorners(n,n.screenCorners,m.x,m.y);if(i.set(p,_,1),r.set(p,_,-1),T(i,r,A))return!0}return!1},_checkElement3d:function(e,t,n,s){var a=this._target.clientWidth,o=this._target.clientHeight,h=s.rect.z*a,l=s.rect.w*o,c=s.rect.x*a,d=c+h,u=(1-s.rect.y)*o,f=u-l,p=e,_=t;if(e>=c&&e<=d&&t<=u&&_>=f){p=a*(p-c)/h,_=o*(_-f)/l;var m=n.entity.getWorldTransform().getScale(),A=this._buildHitCorners(n,n.worldCorners,m.x,m.y),v=i,y=r;if(s.screenToWorld(p,_,s.nearClip,v),s.screenToWorld(p,_,s.farClip,y),T(v,y,A))return!0}return!1}}),Object.defineProperty(M.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e}}),Object.defineProperty(M.prototype,"app",{get:function(){return this._app||n.app},set:function(e){this._app=e}}),{ElementInput:M,ElementInputEvent:S,ElementMouseEvent:w,ElementTouchEvent:C}}()),Object.assign(n,function(){var e=function(t){n.events.attach(this);var i=this;this.isSupported=e.isSupported,this.usesPolyfill=e.usesPolyfill,window.InitializeWebVRPolyfill&&window.InitializeWebVRPolyfill(),this._index={},this.displays=[],this.display=null,this._app=t,this._onDisplayConnect=this._onDisplayConnect.bind(this),this._onDisplayDisconnect=this._onDisplayDisconnect.bind(this),i._attach(),this._getDisplays(function(e,t){if(e)i.fire("error",e);else{for(var n=0;n<t.length;n++)i._addDisplay(t[n]);i.fire("ready",i.displays)}})};return e.isSupported=!!navigator.getVRDisplays,e.usesPolyfill=!!window.InitializeWebVRPolyfill,Object.assign(e.prototype,{_attach:function(){window.addEventListener("vrdisplayconnect",this._onDisplayConnect),window.addEventListener("vrdisplaydisconnect",this._onDisplayDisconnect)},_detach:function(){window.removeEventListener("vrdisplayconnect",this._onDisplayConnect),window.removeEventListener("vrdisplaydisconnect",this._onDisplayDisconnect)},destroy:function(){this._detach()},poll:function(){var e=this.displays.length;if(e)for(var t=0;t<e;t++)this.displays[t]._camera&&this.displays[t].poll()},_getDisplays:function(e){navigator.getVRDisplays?navigator.getVRDisplays().then(function(t){e&&e(null,t)}):e&&e(new Error("WebVR not supported"))},_addDisplay:function(e){if(!this._index[e.displayId]){var t=new n.VrDisplay(this._app,e);this._index[t.id]=t,this.displays.push(t),this.display||(this.display=t),this.fire("displayconnect",t)}},_onDisplayConnect:function(e){e.detail&&e.detail.display?this._addDisplay(e.detail.display):this._addDisplay(e.display)},_onDisplayDisconnect:function(e){var t;t=e.detail&&e.detail.display?e.detail.display.displayId:e.display.displayId;var i=this._index[t];if(i){i.destroy(),delete this._index[i.id];var n=this.displays.indexOf(i);this.displays.splice(n,1),this.display===i&&(this.displays.length?this.display=this.displays[0]:this.display=null),this.fire("displaydisconnect",i)}}}),{VrManager:e}}()),Object.assign(n,function(){var e=function(e,t){var i=this;this._app=e,this._device=e.graphicsDevice,this.id=t.displayId,this._frameData=null,window.VRFrameData&&(this._frameData=new window.VRFrameData),this.display=t,this._camera=null,this.sitToStandInv=new n.Mat4,this.leftView=new n.Mat4,this.leftProj=new n.Mat4,this.leftViewInv=new n.Mat4,this.leftPos=new n.Vec3,this.rightView=new n.Mat4,this.rightProj=new n.Mat4,this.rightViewInv=new n.Mat4,this.rightPos=new n.Vec3,this.combinedPos=new n.Vec3,this.combinedView=new n.Mat4,this.combinedProj=new n.Mat4,this.combinedViewInv=new n.Mat4,this.combinedFov=0,this.combinedAspect=0,this.presenting=!1,i._presentChange=function(e){var t;if(t=e.display?e.display:e.detail&&e.detail.display?e.detail.display:e.detail&&e.detail.vrdisplay?e.detail.vrdisplay:i.display,t===i.display){if(i.presenting=i.display&&i.display.isPresenting,i.presenting){var r=i.display.getEyeParameters("left"),s=i.display.getEyeParameters("right"),a=2*Math.max(r.renderWidth,s.renderWidth),o=Math.max(r.renderHeight,s.renderHeight);i._app.graphicsDevice.setResolution(a,o),i._app._allowResize=!1}else i._app.setCanvasResolution(n.RESOLUTION_AUTO),i._app._allowResize=!0;i.fire("beforepresentchange",i),i.fire("presentchange",i)}},window.addEventListener("vrdisplaypresentchange",i._presentChange,!1),
n.events.attach(this)};return Object.assign(e.prototype,{destroy:function(){window.removeEventListener("vrdisplaypresentchange",self._presentChange),this._camera&&(this._camera.vrDisplay=null),this._camera=null},poll:function(){if(this.display){this.display.getFrameData(this._frameData),this.leftProj.data=this._frameData.leftProjectionMatrix,this.rightProj.data=this._frameData.rightProjectionMatrix;var e=this.display.stageParameters;e?(this.sitToStandInv.set(e.sittingToStandingTransform).invert(),this.combinedView.set(this._frameData.leftViewMatrix),this.leftView.mul2(this.combinedView,this.sitToStandInv),this.combinedView.set(this._frameData.rightViewMatrix),this.rightView.mul2(this.combinedView,this.sitToStandInv)):(this.leftView.set(this._frameData.leftViewMatrix),this.rightView.set(this._frameData.rightViewMatrix));var t=this.leftProj.data[3]+this.leftProj.data[0],i=this.leftProj.data[11]+this.leftProj.data[8],r=1/Math.sqrt(t*t+i*i);t*=r,i*=r;var s=-Math.atan2(i,t);t=this.rightProj.data[3]+this.rightProj.data[0],i=this.rightProj.data[11]+this.rightProj.data[8],r=1/Math.sqrt(t*t+i*i),t*=r,i*=r,s=Math.max(s,-Math.atan2(i,t)),s*=2,this.combinedFov=s;var a=this.rightProj.data[5]/this.rightProj.data[0];this.combinedAspect=a;var o=this.combinedView;o.copy(this.leftView),o.invert(),this.leftViewInv.copy(o);var h=this.combinedPos.data;h[0]=this.leftPos.data[0]=o.data[12],h[1]=this.leftPos.data[1]=o.data[13],h[2]=this.leftPos.data[2]=o.data[14],o.copy(this.rightView),o.invert(),this.rightViewInv.copy(o);var l=h[0]-o.data[12],c=h[1]-o.data[13],d=h[2]-o.data[14],u=Math.sqrt(l*l+c*c+d*d);this.rightPos.data[0]=o.data[12],this.rightPos.data[1]=o.data[13],this.rightPos.data[2]=o.data[14],h[0]+=o.data[12],h[1]+=o.data[13],h[2]+=o.data[14],h[0]*=.5,h[1]*=.5,h[2]*=.5;var f=.5*Math.PI,p=.5*s,_=Math.PI-(f+p),m=.5*u*Math.sin(_),A=o.data[8],v=o.data[9],y=o.data[10];o.data[12]=h[0]+A*m,o.data[13]=h[1]+v*m,o.data[14]=h[2]+y*m,this.combinedViewInv.copy(o),o.invert(),this.combinedProj.setPerspective(s*n.math.RAD_TO_DEG,a,this.display.depthNear+m,this.display.depthFar+m,!0)}},requestPresent:function(e){return this.display?this.presenting?void(e&&e(new Error("VrDisplay already presenting"))):void this.display.requestPresent([{source:this._device.canvas}]).then(function(){e&&e()},function(t){e&&e(t)}):void(e&&e(new Error("No VrDisplay to requestPresent")))},exitPresent:function(e){return this.display||e&&e(new Error("No VrDisplay to exitPresent")),this.presenting?void this.display.exitPresent().then(function(){e&&e()},function(){e&&e(new Error("exitPresent failed"))}):void(e&&e(new Error("VrDisplay not presenting")))},requestAnimationFrame:function(e){this.display&&this.display.requestAnimationFrame(e)},submitFrame:function(){this.display&&this.display.submitFrame()},reset:function(){this.display&&this.display.resetPose()},setClipPlanes:function(e,t){this.display&&(this.display.depthNear=e,this.display.depthFar=t)},getFrameData:function(){if(this.display)return this._frameData}}),Object.defineProperty(e.prototype,"capabilities",{get:function(){return this.display?this.display.capabilities:{}}}),{VrDisplay:e}}()),Object.assign(n,function(){var e=function(){};return e.ContentType={FORM_URLENCODED:"application/x-www-form-urlencoded",GIF:"image/gif",JPEG:"image/jpeg",DDS:"image/dds",JSON:"application/json",PNG:"image/png",TEXT:"text/plain",XML:"application/xml",WAV:"audio/x-wav",OGG:"audio/ogg",MP3:"audio/mpeg",MP4:"audio/mp4",AAC:"audio/aac",BIN:"application/octet-stream"},e.ResponseType={TEXT:"text",ARRAY_BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document"},e.binaryExtensions=[".model",".wav",".ogg",".mp3",".mp4",".m4a",".aac",".dds"],Object.assign(e.prototype,{ContentType:e.ContentType,ResponseType:e.ResponseType,binaryExtensions:e.binaryExtensions,get:function(e,t,i){return"function"==typeof t&&(i=t,t={}),this.request("GET",e,t,i)},post:function(e,t,i,n){return"function"==typeof i&&(n=i,i={}),i.postdata=t,this.request("POST",e,i,n)},put:function(e,t,i,n){return"function"==typeof i&&(n=i,i={}),i.postdata=t,this.request("PUT",e,i,n)},del:function(e,t,i){return"function"==typeof t&&(i=t,t={}),this.request("DELETE",e,t,i)},request:function(t,i,r,s){var a,o,h,l,c,d=!1;if("function"==typeof r&&(s=r,r={}),r.callback=s,null==r.async&&(r.async=!0),null==r.headers&&(r.headers={}),null!=r.postdata)if(r.postdata instanceof Document)l=r.postdata;else if(r.postdata instanceof FormData)l=r.postdata;else if(r.postdata instanceof Object){var u=r.headers["Content-Type"];switch(void 0===u&&(r.headers["Content-Type"]=e.ContentType.FORM_URLENCODED,u=r.headers["Content-Type"]),u){case e.ContentType.FORM_URLENCODED:l="";var f=!0;for(var p in r.postdata)r.postdata.hasOwnProperty(p)&&(f?f=!1:l+="&",l+=escape(p)+"="+escape(r.postdata[p]));break;default:case e.ContentType.JSON:null==u&&(r.headers["Content-Type"]=e.ContentType.JSON),l=JSON.stringify(r.postdata)}}else l=r.postdata;c||(c=new XMLHttpRequest),r.cache===!1&&(h=n.time.now(),a=new n.URI(i),a.query?a.query=a.query+"&ts="+h:a.query="ts="+h,i=a.toString()),r.query&&(a=new n.URI(i),o=n.extend(a.getQuery(),r.query),a.setQuery(o),i=a.toString()),c.open(t,i,r.async),c.withCredentials=void 0!==r.withCredentials&&r.withCredentials,c.responseType=r.responseType||this._guessResponseType(i);for(var _ in r.headers)r.headers.hasOwnProperty(_)&&c.setRequestHeader(_,r.headers[_]);c.onreadystatechange=function(){this._onReadyStateChange(t,i,r,c)}.bind(this),c.onerror=function(){this._onError(t,i,r,c),d=!0}.bind(this);try{c.send(l)}catch(m){d||r.error(c.status,c,m)}return c},_guessResponseType:function(t){var i=new n.URI(t),r=n.path.getExtension(i.path);return e.binaryExtensions.indexOf(r)>=0?e.ResponseType.ARRAY_BUFFER:".xml"===r?e.ResponseType.DOCUMENT:e.ResponseType.TEXT},_isBinaryContentType:function(t){var i=[e.ContentType.MP4,e.ContentType.WAV,e.ContentType.OGG,e.ContentType.MP3,e.ContentType.BIN,e.ContentType.DDS];return i.indexOf(t)>=0},_onReadyStateChange:function(e,t,i,n){if(4===n.readyState)switch(n.status){case 0:"/"!=t[0]&&this._onSuccess(e,t,i,n);break;case 200:case 201:case 206:case 304:this._onSuccess(e,t,i,n);break;default:this._onError(e,t,i,n)}},_onSuccess:function(t,i,s,a){var o,h,l,c;h=a.getResponseHeader("Content-Type"),h&&(c=h.split(";"),l=c[0].trim()),l===this.ContentType.JSON||i.split("?")[0].endsWith(".json")?o=JSON.parse(a.responseText):this._isBinaryContentType(l)?o=a.response:a.responseType===e.ResponseType.ARRAY_BUFFER?(r(n.string.format("responseType: {0} being served with Content-Type: {1}",e.ResponseType.ARRAY_BUFFER,l)),o=a.response):o=a.responseType===e.ResponseType.DOCUMENT||l===this.ContentType.XML?a.responseXML:a.responseText,s.callback(null,o)},_onError:function(e,t,i,n){i.callback(n.status,null)}}),{Http:e,http:new e}}()),Object.assign(n,function(){var e=function(e){n.events.attach(this),this.app=e,this._scripts={},this._list=[]};return e.prototype.add=function(e){var t=this;return this._scripts.hasOwnProperty(e.__name)?(setTimeout(function(){if(e.prototype.swap){var i=t._scripts[e.__name],n=t._list.indexOf(i);t._list[n]=e,t._scripts[e.__name]=e,t.fire("swap",e.__name,e),t.fire("swap:"+e.__name,e)}else console.warn("script registry already has '"+e.__name+"' script, define 'swap' method for new script type to enable code hot swapping")}),!1):(this._scripts[e.__name]=e,this._list.push(e),this.fire("add",e.__name,e),this.fire("add:"+e.__name,e),setTimeout(function(){if(t._scripts.hasOwnProperty(e.__name)){var i,n,r,s=t.app.systems.script._components,a=[],o=[];for(i=0;i<s.length;i++)s[i]._scriptsIndex[e.__name]&&s[i]._scriptsIndex[e.__name].awaiting&&(s[i]._scriptsData&&s[i]._scriptsData[e.__name]&&(r=s[i]._scriptsData[e.__name].attributes),n=s[i].create(e.__name,{preloading:!0,ind:s[i]._scriptsIndex[e.__name].ind,attributes:r}),n&&a.push(n));for(i=0;i<a.length;i++)a[i].__initializeAttributes();for(i=0;i<a.length;i++)a[i].enabled&&(a[i]._initialized=!0,o.push(a[i]),a[i].initialize&&a[i].initialize());for(i=0;i<o.length;i++)o[i].enabled&&!o[i]._postInitialized&&(o[i]._postInitialized=!0,o[i].postInitialize&&o[i].postInitialize())}}),!0)},e.prototype.remove=function(e){if("function"==typeof e&&(e=e.__name),!this._scripts.hasOwnProperty(e))return!1;var t=this._scripts[e];delete this._scripts[e];var i=this._list.indexOf(t);return this._list.splice(i,1),this.fire("remove",e,t),this.fire("remove:"+e,t),!0},e.prototype.get=function(e){return this._scripts[e]||null},e.prototype.has=function(e){return this._scripts.hasOwnProperty(e)},e.prototype.list=function(){return this._list},{ScriptRegistry:e}}()),Object.assign(n,function(){var e=function(e,t,i,r){var s;switch(t.type){case"boolean":return!!i;case"number":if("number"==typeof i)return i;if("string"==typeof i){var a=parseInt(i,10);return isNaN(a)?null:a}return"boolean"==typeof i?0+i:null;case"json":if("object"==typeof i)return i;try{return JSON.parse(i)}catch(o){return null}case"asset":return i instanceof n.Asset?i:"number"==typeof i?e.assets.get(i)||null:"string"==typeof i?e.assets.get(parseInt(i,10))||null:null;case"entity":return i instanceof n.GraphNode?i:"string"==typeof i?e.root.findByGuid(i):null;case"rgb":case"rgba":if(i instanceof n.Color)return r instanceof n.Color?(r.copy(i),r):i.clone();if(i instanceof Array&&i.length>=3&&i.length<=4){for(s=0;s<i.length;s++)if("number"!=typeof i[s])return null;for(r||(r=new n.Color),s=0;s<4;s++)r.data[s]=4===s&&3===i.length?1:i[s];return r}return"string"==typeof i&&/#([0-9abcdef]{2}){3,4}/i.test(i)?(r||(r=new n.Color),r.fromString(i),r):null;case"vec2":case"vec3":case"vec4":var h=parseInt(t.type.slice(3),10);if(i instanceof n["Vec"+h])return r instanceof n["Vec"+h]?(r.copy(i),r):i.clone();if(i instanceof Array&&i.length===h){for(s=0;s<i.length;s++)if("number"!=typeof i[s])return null;for(r||(r=new n["Vec"+h]),s=0;s<h;s++)r.data[s]=i[s];return r}return null;case"curve":if(i){var l;if(i instanceof n.Curve||i instanceof n.CurveSet)l=i.clone();else{var c=i.keys[0]instanceof Array?n.CurveSet:n.Curve;l=new c(i.keys),l.type=i.type}return l}}return i},t=function(e){this.scriptType=e,this.index={}};t.prototype.add=function(t,i){this.index[t]||n.createScript.reservedAttributes[t]||(this.index[t]=i,Object.defineProperty(this.scriptType.prototype,t,{get:function(){return this.__attributes[t]},set:function(n){var r=this.__attributes[t];if(i.array){if(this.__attributes[t]=[],n){var s,a;for(s=0,a=n.length;s<a;s++)this.__attributes[t].push(e(this.app,i,n[s],r?r[s]:null))}}else this.__attributes[t]=e(this.app,i,n,r);this.fire("attr",t,this.__attributes[t],r),this.fire("attr:"+t,this.__attributes[t],r)}}))},t.prototype.remove=function(e){return!!this.index[e]&&(delete this.index[e],delete this.scriptType.prototype[e],!0)},t.prototype.has=function(e){return!!this.index[e]},t.prototype.get=function(e){return this.index[e]||null};var i=function(e,r){if(n.script.legacy)return null;if(i.reservedScripts[e])throw new Error("script name: '"+e+"' is reserved, please change script name");var s=function(e){n.events.attach(this),this.app=e.app,this.entity=e.entity,this._enabled="boolean"!=typeof e.enabled||e.enabled,this._enabledOld=this.enabled,this.__destroyed=!1,this.__attributes={},this.__attributesRaw=e.attributes||null,this.__scriptType=s};s.__name=e,s.attributes=new t(s),s.prototype.__initializeAttributes=function(e){if(e||this.__attributesRaw){for(var t in s.attributes.index)this.__attributesRaw&&this.__attributesRaw.hasOwnProperty(t)?this[t]=this.__attributesRaw[t]:this.__attributes.hasOwnProperty(t)||(s.attributes.index[t].hasOwnProperty("default")?this[t]=s.attributes.index[t]["default"]:this[t]=null);this.__attributesRaw=null}},s.extend=function(e){for(var t in e)e.hasOwnProperty(t)&&(s.prototype[t]=e[t])},Object.defineProperty(s.prototype,"enabled",{get:function(){return this._enabled&&!this._destroyed&&this.entity.script.enabled&&this.entity.enabled},set:function(e){this._enabled=!!e,this.enabled!==this._enabledOld&&(this._enabledOld=this.enabled,this.fire(this.enabled?"enable":"disable"),this.fire("state",this.enabled),!this._initialized&&this.enabled&&(this._initialized=!0,this.__initializeAttributes(!0),this.initialize&&this.entity.script._scriptMethod(this,n.ScriptComponent.scriptMethods.initialize)),this._initialized&&!this._postInitialized&&this.enabled&&!this.entity.script._beingEnabled&&(this._postInitialized=!0,this.postInitialize&&this.entity.script._scriptMethod(this,n.ScriptComponent.scriptMethods.postInitialize)))}});var a=r?r.scripts:n.Application.getApplication().scripts;return a.add(s),n.ScriptHandler._push(s),s};i.reservedScripts=["system","entity","create","destroy","swap","move","scripts","_scripts","_scriptsIndex","_scriptsData","enabled","_oldState","onEnable","onDisable","onPostStateChange","_onSetEnabled","_checkState","_onBeforeRemove","_onInitializeAttributes","_onInitialize","_onPostInitialize","_onUpdate","_onPostUpdate","_callbacks","has","on","off","fire","once","hasEvent"];var r,s={};for(r=0;r<i.reservedScripts.length;r++)s[i.reservedScripts[r]]=1;i.reservedScripts=s,i.reservedAttributes=["app","entity","enabled","_enabled","_enabledOld","_destroyed","__attributes","__attributesRaw","__scriptType","_callbacks","has","on","off","fire","once","hasEvent"];var a={};for(r=0;r<i.reservedAttributes.length;r++)a[i.reservedAttributes[r]]=1;return i.reservedAttributes=a,{createScript:i}}()),n.script=function(){var e=!1,t=!1,i={app:null,create:function(t,i){if(e){var r=i(n.script.app);r._pcScriptName=t,n.ScriptHandler._push(r),this.fire("created",t,i)}},attribute:function(e,t,i,n){},createLoadingScreen:function(e){if(!t){t=!0;var i=n.Application.getApplication();e(i)}}};return Object.defineProperty(i,"legacy",{get:function(){return e},set:function(t){e=t}}),n.events.attach(i),i}(),Object.assign(n,function(){var e=function(t,i){i=i||{},n.log.open(),n.events.attach(this),e._applications[t.id]=this,e._currentApplication=this,this._time=0,this.timeScale=1,this.maxDeltaTime=.1,this.autoRender=!0,this.renderNextFrame=!1,this._librariesLoaded=!1,this._fillMode=n.FILLMODE_KEEP_ASPECT,this._resolutionMode=n.RESOLUTION_FIXED,this._allowResize=!0,this.context=this,this.graphicsDevice=new n.GraphicsDevice(t,i.graphicsDeviceOptions),this.stats=new n.ApplicationStats(this.graphicsDevice),this.systems=new n.ComponentSystemRegistry,this._audioManager=new n.SoundManager(i),this.loader=new n.ResourceLoader,this.scene=new n.Scene,this.root=new n.Entity(this),this.root._enabledInHierarchy=!0,this._enableList=[],this._enableList.size=0,this.assets=new n.AssetRegistry(this.loader),i.assetPrefix&&(this.assets.prefix=i.assetPrefix),this.scriptsOrder=i.scriptsOrder||[],this.scripts=new n.ScriptRegistry(this),this._sceneRegistry=new n.SceneRegistry(this);var s=this;this.defaultLayerWorld=new n.Layer({name:"World",id:n.LAYERID_WORLD}),this.graphicsDevice.webgl2?(this.defaultLayerDepth=new n.Layer({enabled:!1,name:"Depth",id:n.LAYERID_DEPTH,onEnable:function(){if(!this.renderTarget){var e=new n.Texture(s.graphicsDevice,{format:n.PIXELFORMAT_DEPTHSTENCIL,width:s.graphicsDevice.width,height:s.graphicsDevice.height});e.minFilter=n.FILTER_NEAREST,e.magFilter=n.FILTER_NEAREST,e.addressU=n.ADDRESS_CLAMP_TO_EDGE,e.addressV=n.ADDRESS_CLAMP_TO_EDGE,this.renderTarget=new n.RenderTarget({colorBuffer:null,depthBuffer:e,autoResolve:!1}),s.graphicsDevice.scope.resolve("uDepthMap").setValue(e)}},onDisable:function(){this.renderTarget&&(this.renderTarget._depthBuffer.destroy(),this.renderTarget.destroy(),this.renderTarget=null)},onPreRenderOpaque:function(e){var t=s.graphicsDevice.gl;this.srcFbo=t.getParameter(t.FRAMEBUFFER_BINDING),this.renderTarget&&this.renderTarget.width===s.graphicsDevice.width&&this.renderTarget.height===s.graphicsDevice.height||(this.onDisable(),this.onEnable()),this.oldClear=this.cameras[e].camera._clearOptions,this.cameras[e].camera._clearOptions=this.depthClearOptions},onPostRenderOpaque:function(e){if(this.renderTarget){this.cameras[e].camera._clearOptions=this.oldClear;var t=s.graphicsDevice.gl;s.graphicsDevice.setRenderTarget(this.renderTarget),s.graphicsDevice.updateBegin(),t.bindFramebuffer(t.READ_FRAMEBUFFER,this.srcFbo),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.renderTarget._glFrameBuffer),t.blitFramebuffer(0,0,this.renderTarget.width,this.renderTarget.height,0,0,this.renderTarget.width,this.renderTarget.height,t.DEPTH_BUFFER_BIT,t.NEAREST)}}}),this.defaultLayerDepth.depthClearOptions={flags:0}):(this.defaultLayerDepth=new n.Layer({enabled:!1,name:"Depth",id:n.LAYERID_DEPTH,shaderPass:n.SHADER_DEPTH,onEnable:function(){if(!this.renderTarget){var e=new n.Texture(s.graphicsDevice,{format:n.PIXELFORMAT_R8_G8_B8_A8,width:s.graphicsDevice.width,height:s.graphicsDevice.height});e.minFilter=n.FILTER_NEAREST,e.magFilter=n.FILTER_NEAREST,e.addressU=n.ADDRESS_CLAMP_TO_EDGE,e.addressV=n.ADDRESS_CLAMP_TO_EDGE,this.renderTarget=new n.RenderTarget(s.graphicsDevice,e,{depth:!0,stencil:s.graphicsDevice.supportsStencil}),s.graphicsDevice.scope.resolve("uDepthMap").setValue(e)}},onDisable:function(){this.renderTarget&&(this.renderTarget._colorBuffer.destroy(),this.renderTarget.destroy(),this.renderTarget=null)},onPostCull:function(e){for(var t,i,n,r,a,o,h,l=this.instances.visibleOpaque[e],c=l.list,d=0,u=s.scene.layers.layerList,f=s.scene.layers.subLayerEnabled,p=s.scene.layers.subLayerList,_=s.defaultLayerWorld.renderTarget,m=this.cameras[e],A=0;A<u.length&&(t=u[A],t!==this);A++)if(t.renderTarget===_&&t.enabled&&f[A]&&(r=t.cameras.indexOf(m),!(r<0)))for(h=p[A],n=h?t.instances.visibleTransparent[r]:t.instances.visibleOpaque[r],a=n.length,n=n.list,i=0;i<a;i++)o=n[i],o.material&&o.material.depthWrite&&!o._noDepthDrawGl1&&(c[d]=o,d++);l.length=d},onPreRenderOpaque:function(e){this.renderTarget&&this.renderTarget.width===s.graphicsDevice.width&&this.renderTarget.height===s.graphicsDevice.height||(this.onDisable(),this.onEnable()),this.oldClear=this.cameras[e].camera._clearOptions,this.cameras[e].camera._clearOptions=this.rgbaDepthClearOptions},onDrawCall:function(){s.graphicsDevice.setColorWrite(!0,!0,!0,!0)},onPostRenderOpaque:function(e){this.renderTarget&&(this.cameras[e].camera._clearOptions=this.oldClear)}}),this.defaultLayerDepth.rgbaDepthClearOptions={color:[254/255,254/255,254/255,254/255],depth:1,flags:n.CLEARFLAG_COLOR|n.CLEARFLAG_DEPTH}),this.defaultLayerSkybox=new n.Layer({enabled:!1,name:"Skybox",id:n.LAYERID_SKYBOX,opaqueSortMode:n.SORTMODE_NONE}),this.defaultLayerUi=new n.Layer({enabled:!0,name:"UI",id:n.LAYERID_UI,transparentSortMode:n.SORTMODE_MANUAL,passThrough:!0}),this.defaultLayerImmediate=new n.Layer({enabled:!0,name:"Immediate",id:n.LAYERID_IMMEDIATE,opaqueSortMode:n.SORTMODE_NONE,passThrough:!0}),this.defaultLayerComposition=new n.LayerComposition,this.defaultLayerComposition.pushOpaque(this.defaultLayerWorld),this.defaultLayerComposition.pushOpaque(this.defaultLayerDepth),this.defaultLayerComposition.pushOpaque(this.defaultLayerSkybox),this.defaultLayerComposition.pushTransparent(this.defaultLayerWorld),this.defaultLayerComposition.pushOpaque(this.defaultLayerImmediate),this.defaultLayerComposition.pushTransparent(this.defaultLayerImmediate),this.defaultLayerComposition.pushTransparent(this.defaultLayerUi),this.scene.layers=this.defaultLayerComposition,this._immediateLayer=this.defaultLayerImmediate,this.scene.on("set:layers",function(e,t){for(var i,r=t.layerList,a=0;a<r.length;a++)switch(i=r[a],i.id){case n.LAYERID_DEPTH:i.onEnable=s.defaultLayerDepth.onEnable,i.onDisable=s.defaultLayerDepth.onDisable,i.onPreRenderOpaque=s.defaultLayerDepth.onPreRenderOpaque,i.onPostRenderOpaque=s.defaultLayerDepth.onPostRenderOpaque,i.depthClearOptions=s.defaultLayerDepth.depthClearOptions,i.rgbaDepthClearOptions=s.defaultLayerDepth.rgbaDepthClearOptions,i.shaderPass=s.defaultLayerDepth.shaderPass,i.onPostCull=s.defaultLayerDepth.onPostCull,i.onDrawCall=s.defaultLayerDepth.onDrawCall;break;case n.LAYERID_UI:i.passThrough=s.defaultLayerUi.passThrough;break;case n.LAYERID_IMMEDIATE:i.passThrough=s.defaultLayerImmediate.passThrough}}),this.renderer=new n.ForwardRenderer(this.graphicsDevice),this.renderer.scene=this.scene,this.lightmapper=new n.Lightmapper(this.graphicsDevice,this.root,this.scene,this.renderer,this.assets),this.once("prerender",this._firstBake,this),this.batcher=new n.BatchManager(this.graphicsDevice,this.root,this.scene),this.once("prerender",this._firstBatch,this),this.keyboard=i.keyboard||null,this.mouse=i.mouse||null,this.touch=i.touch||null,this.gamepads=i.gamepads||null,this.elementInput=i.elementInput||null,this.elementInput&&(this.elementInput.app=this),this.vr=null,i.vr&&this._onVrChange(i.vr),this._inTools=!1,this._skyboxLast=0,this._scriptPrefix=i.scriptPrefix||"",this.loader.addHandler("animation",new n.AnimationHandler),this.loader.addHandler("model",new n.ModelHandler(this.graphicsDevice)),this.loader.addHandler("material",new n.MaterialHandler(this)),this.loader.addHandler("texture",new n.TextureHandler(this.graphicsDevice,this.assets,this.loader)),this.loader.addHandler("text",new n.TextHandler),this.loader.addHandler("json",new n.JsonHandler),this.loader.addHandler("audio",new n.AudioHandler(this._audioManager)),this.loader.addHandler("script",new n.ScriptHandler(this)),this.loader.addHandler("scene",new n.SceneHandler(this)),this.loader.addHandler("cubemap",new n.CubemapHandler(this.graphicsDevice,this.assets,this.loader)),this.loader.addHandler("html",new n.HtmlHandler),this.loader.addHandler("css",new n.CssHandler),this.loader.addHandler("shader",new n.ShaderHandler),this.loader.addHandler("hierarchy",new n.HierarchyHandler(this)),this.loader.addHandler("scenesettings",new n.SceneSettingsHandler(this)),this.loader.addHandler("folder",new n.FolderHandler),this.loader.addHandler("font",new n.FontHandler(this.loader)),this.loader.addHandler("binary",new n.BinaryHandler),this.loader.addHandler("textureatlas",new n.TextureAtlasHandler(this.loader)),this.loader.addHandler("sprite",new n.SpriteHandler(this.assets,this.graphicsDevice)),new n.RigidBodyComponentSystem(this),new n.CollisionComponentSystem(this),new n.AnimationComponentSystem(this),new n.ModelComponentSystem(this),new n.CameraComponentSystem(this),new n.LightComponentSystem(this),n.script.legacy?new n.ScriptLegacyComponentSystem(this):new n.ScriptComponentSystem(this),new n.AudioSourceComponentSystem(this,this._audioManager),new n.SoundComponentSystem(this,this._audioManager),new n.AudioListenerComponentSystem(this,this._audioManager),new n.ParticleSystemComponentSystem(this),new n.ScreenComponentSystem(this),new n.ElementComponentSystem(this),new n.ButtonComponentSystem(this),new n.ScrollViewComponentSystem(this),new n.ScrollbarComponentSystem(this),new n.SpriteComponentSystem(this),new n.LayoutGroupComponentSystem(this),new n.LayoutChildComponentSystem(this),new n.ZoneComponentSystem(this),this._visibilityChangeHandler=this.onVisibilityChange.bind(this),void 0!==document.hidden?(this._hiddenAttr="hidden",document.addEventListener("visibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.mozHidden?(this._hiddenAttr="mozHidden",document.addEventListener("mozvisibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.msHidden?(this._hiddenAttr="msHidden",document.addEventListener("msvisibilitychange",this._visibilityChangeHandler,!1)):void 0!==document.webkitHidden&&(this._hiddenAttr="webkitHidden",document.addEventListener("webkitvisibilitychange",this._visibilityChangeHandler,!1)),this.tick=r(this)};e._currentApplication=null,e._applications={},e.getApplication=function(t){return t?e._applications[t]:e._currentApplication};var t=function(e){this.length=e,this.count=0,this.inc=function(){this.count++},this.done=function(){return this.count===this.length}};Object.assign(e.prototype,{configure:function(e,t){var i=this;n.http.get(e,function(e,n){if(e)return void t(e);var r=n.application_properties,s=n.scenes,a=n.assets;i._parseApplicationProperties(r,function(e){i._onVrChange(r.vr),i._parseScenes(s),i._parseAssets(a),t(e?e:null)})})},preload:function(e){var i=this;i.fire("preload:start");var n,r=this.assets.list({preload:!0}),s=new t(r.length),a=!1,o=function(){i.graphicsDevice&&!a&&s.done()&&(a=!0,i.fire("preload:end"),e())},h=r.length,l=function(){return s.count};if(s.length){var c=function(e){s.inc(),i.fire("preload:progress",l()/h),s.done()&&o()},d=function(e,t){s.inc(),i.fire("preload:progress",l()/h),s.done()&&o()};for(n=0;n<r.length;n++)r[n].loaded?(s.inc(),i.fire("preload:progress",l()/h),s.done()&&o()):(r[n].once("load",c),r[n].once("error",d),this.assets.load(r[n]))}else o()},getSceneUrl:function(e){var t=this._sceneRegistry.find(e);return t?t.url:null},loadSceneHierarchy:function(e,t){this._sceneRegistry.loadSceneHierarchy(e,t)},loadSceneSettings:function(e,t){this._sceneRegistry.loadSceneSettings(e,t)},loadScene:function(e,t){this._sceneRegistry.loadScene(e,t)},_preloadScripts:function(e,i){if(!n.script.legacy)return void i();var r=this;r.systems.script.preloading=!0;var s,a=this._getScriptReferences(e),o=0,h=a.length,l=new t(h),c=/^http(s)?:\/\//;if(h){var d=function(e,t){e&&console.error(e),l.inc(),l.done()&&(r.systems.script.preloading=!1,i())};for(o=0;o<h;o++)s=a[o],!c.test(s.toLowerCase())&&r._scriptPrefix&&(s=n.path.join(r._scriptPrefix,a[o])),this.loader.load(s,"script",d)}else r.systems.script.preloading=!1,i()},_parseApplicationProperties:function(e,t){var i,r;if(e.useDevicePixelRatio||(e.useDevicePixelRatio=e.use_device_pixel_ratio),e.resolutionMode||(e.resolutionMode=e.resolution_mode),e.fillMode||(e.fillMode=e.fill_mode),e.vrPolyfillUrl||(e.vrPolyfillUrl=e.vr_polyfill_url),this._width=e.width,this._height=e.height,e.useDevicePixelRatio&&(this.graphicsDevice.maxPixelRatio=window.devicePixelRatio),this.setCanvasResolution(e.resolutionMode,this._width,this._height),this.setCanvasFillMode(e.fillMode,this._width,this._height),e.vr&&e.vrPolyfillUrl&&(n.VrManager.isSupported&&!n.platform.android||e.libraries.push(e.vrPolyfillUrl)),e.layers&&e.layerOrder){var s=new n.LayerComposition,a={};for(var o in e.layers){var h=e.layers[o];h.id=parseInt(o,10),h.enabled=h.id!==n.LAYERID_DEPTH,a[o]=new n.Layer(h)}for(i=0,r=e.layerOrder.length;i<r;i++){var l=e.layerOrder[i],c=a[l.layer];c&&(l.transparent?s.pushTransparent(c):s.pushOpaque(c),s.subLayerEnabled[i]=l.enabled)}this.scene.layers=s}if(e.batchGroups)for(i=0,r=e.batchGroups.length;i<r;i++){var d=e.batchGroups[i];this.batcher.addGroup(d.name,d.dynamic,d.maxAabbSize,d.id,d.layers)}this._loadLibraries(e.libraries,t)},_loadLibraries:function(e,t){var i=e.length,r=i,s=this,a=/^http(s)?:\/\//;if(i)for(var o=function(e,i){r--,e?t(e):0===r&&(s.onLibrariesLoaded(),t(null))},h=0;h<i;++h){var l=e[h];!a.test(l.toLowerCase())&&s._scriptPrefix&&(l=n.path.join(s._scriptPrefix,l)),this.loader.load(l,"script",o)}else t(null)},_parseScenes:function(e){if(e)for(var t=0;t<e.length;t++)this._sceneRegistry.add(e[t].name,e[t].url)},_parseAssets:function(e){var t,i,r=[],s={};if(n.script.legacy)for(i in e)r.push(e[i]);else{for(t=0;t<this.scriptsOrder.length;t++)i=this.scriptsOrder[t],e[i]&&(s[i]=!0,r.push(e[i]));for(i in e)s[i]||r.push(e[i])}for(t=0;t<r.length;t++){var a=r[t],o=new n.Asset(a.name,a.type,a.file,a.data);o.id=parseInt(a.id,10),o.preload=!!a.preload&&a.preload,o.tags.add(a.tags),this.assets.add(o)}},_getScriptReferences:function(e){var t,i,n=[];e.settings.priority_scripts&&(n=e.settings.priority_scripts);var r=[],s={};for(t=0;t<n.length;t++)r.push(n[t]),s[n[t]]=!0;var a=e.entities;for(i in a)if(a[i].components.script){var o=a[i].components.script.scripts;for(t=0;t<o.length;t++)s[o[t].url]||(r.push(o[t].url),s[o[t].url]=!0)}return r},start:function(){this.fire("start",{timestamp:n.now(),target:this}),this._librariesLoaded||this.onLibrariesLoaded(),n.ComponentSystem.initialize(this.root),this.fire("initialize"),n.ComponentSystem.postInitialize(this.root),this.fire("postinitialize"),this.tick()},update:function(e){this.graphicsDevice.updateClientRect(),this.vr&&this.vr.poll(),n.script.legacy&&n.ComponentSystem.fixedUpdate(1/60,this._inTools),n.ComponentSystem.update(e,this._inTools),n.ComponentSystem.postUpdate(e,this._inTools),this.fire("update",e),this.controller&&this.controller.update(e),this.mouse&&this.mouse.update(e),this.keyboard&&this.keyboard.update(e),this.gamepads&&this.gamepads.update(e)},render:function(){this.fire("prerender"),this.root.syncHierarchy(),this.batcher.updateAll(),n._skipRenderCounter=0,this.renderer.renderComposition(this.scene.layers),this.fire("postrender")},_fillFrameStats:function(e,t,i){var r=this.stats.frame;r.dt=t,r.ms=i,e>r._timeToCountFrames?(r.fps=r._fpsAccum,r._fpsAccum=0,r._timeToCountFrames=e+1e3):r._fpsAccum++,r.cameras=this.renderer._camerasRendered,r.materials=this.renderer._materialSwitches,r.shaders=this.graphicsDevice._shaderSwitchesPerFrame,r.shadowMapUpdates=this.renderer._shadowMapUpdates,r.shadowMapTime=this.renderer._shadowMapTime,r.depthMapTime=this.renderer._depthMapTime,r.forwardTime=this.renderer._forwardTime;var s=this.graphicsDevice._primsPerFrame;r.triangles=s[n.PRIMITIVE_TRIANGLES]/3+Math.max(s[n.PRIMITIVE_TRISTRIP]-2,0)+Math.max(s[n.PRIMITIVE_TRIFAN]-2,0),r.cullTime=this.renderer._cullTime,r.sortTime=this.renderer._sortTime,r.skinTime=this.renderer._skinTime,r.morphTime=this.renderer._morphTime,r.instancingTime=this.renderer._instancingTime,r.otherPrimitives=0;for(var a=0;a<s.length;a++)a<n.PRIMITIVE_TRIANGLES&&(r.otherPrimitives+=s[a]),s[a]=0;this.renderer._camerasRendered=0,this.renderer._materialSwitches=0,this.renderer._shadowMapUpdates=0,this.graphicsDevice._shaderSwitchesPerFrame=0,this.renderer._cullTime=0,this.renderer._sortTime=0,this.renderer._skinTime=0,this.renderer._morphTime=0,this.renderer._instancingTime=0,this.renderer._shadowMapTime=0,this.renderer._depthMapTime=0,this.renderer._forwardTime=0,r=this.stats.drawCalls,r.forward=this.renderer._forwardDrawCalls,r.depth=0,r.shadow=this.renderer._shadowDrawCalls,r.skinned=this.renderer._skinDrawCalls,r.immediate=0,r.instanced=0,r.removedByInstancing=0,r.total=this.graphicsDevice._drawCallsPerFrame,r.misc=r.total-(r.forward+r.shadow),this.renderer._depthDrawCalls=0,this.renderer._shadowDrawCalls=0,this.renderer._forwardDrawCalls=0,this.renderer._skinDrawCalls=0,this.renderer._immediateRendered=0,this.renderer._instancedDrawCalls=0,this.renderer._removedByInstancing=0,this.graphicsDevice._drawCallsPerFrame=0,this.stats.misc.renderTargetCreationTime=this.graphicsDevice.renderTargetCreationTime,r=this.stats.particles,r.updatesPerFrame=r._updatesPerFrame,r.frameTime=r._frameTime,r._updatesPerFrame=0,r._frameTime=0},setCanvasFillMode:function(e,t,i){this._fillMode=e,this.resizeCanvas(t,i)},setCanvasResolution:function(e,t,i){this._resolutionMode=e,e===n.RESOLUTION_AUTO&&void 0===t&&(t=this.graphicsDevice.canvas.clientWidth,i=this.graphicsDevice.canvas.clientHeight),this.graphicsDevice.resizeCanvas(t,i)},isFullscreen:function(){return!!document.fullscreenElement},enableFullscreen:function(e,t,i){e=e||this.graphicsDevice.canvas;var n=function(){t(),document.removeEventListener("fullscreenchange",n)},r=function(){i(),document.removeEventListener("fullscreenerror",r)};t&&document.addEventListener("fullscreenchange",n,!1),i&&document.addEventListener("fullscreenerror",r,!1),e.requestFullscreen?e.requestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i()},disableFullscreen:function(e){var t=function(){e(),document.removeEventListener("fullscreenchange",t)};e&&document.addEventListener("fullscreenchange",t,!1),document.exitFullscreen()},isHidden:function(){return document[this._hiddenAttr]},onVisibilityChange:function(){this.isHidden()?this._audioManager.suspend():this._audioManager.resume()},resizeCanvas:function(e,t){if(this._allowResize){var i=window.innerWidth,r=window.innerHeight;if(navigator.isCocoonJS)e=i,t=r,this.graphicsDevice.resizeCanvas(e,t);else{if(this._fillMode===n.FILLMODE_KEEP_ASPECT){var s=this.graphicsDevice.canvas.width/this.graphicsDevice.canvas.height,a=i/r;s>a?(e=i,t=e/s):(t=r,e=t*s)}else this._fillMode===n.FILLMODE_FILL_WINDOW&&(e=i,
t=r);this.graphicsDevice.canvas.style.width=e+"px",this.graphicsDevice.canvas.style.height=t+"px",this._resolutionMode===n.RESOLUTION_AUTO&&this.setCanvasResolution(n.RESOLUTION_AUTO)}return{width:e,height:t}}},onLibrariesLoaded:function(){this._librariesLoaded=!0,this.systems.rigidbody.onLibraryLoaded(),this.systems.collision.onLibraryLoaded()},applySceneSettings:function(e){var t;if(this.systems.rigidbody&&"undefined"!=typeof Ammo){var i=e.physics.gravity;this.systems.rigidbody.setGravity(i[0],i[1],i[2])}this.scene.applySettings(e),e.render.hasOwnProperty("skybox")&&(e.render.skybox?(t=this.assets.get(e.render.skybox),t?this.setSkybox(t):this.assets.once("add:"+e.render.skybox,this.setSkybox,this)):this.setSkybox(null))},setSkybox:function(e){if(e){if(this._skyboxLast===e.id)return void(0!==this.scene.skyboxMip||e.loadFaces?this._onSkyboxChange(e):this._skyboxLoad(e));this._skyboxLast&&(this.assets.off("add:"+this._skyboxLast,this.setSkybox,this),this.assets.off("load:"+this._skyboxLast,this._onSkyboxChange,this),this.assets.off("remove:"+this._skyboxLast,this._skyboxRemove,this)),this._skyboxLast=e.id,this.assets.on("load:"+e.id,this._onSkyboxChange,this),this.assets.once("remove:"+e.id,this._skyboxRemove,this),e.resource&&this.scene.setSkybox(e.resources),this._skyboxLoad(e)}else{if(!this._skyboxLast)return;this._skyboxRemove({id:this._skyboxLast})}},_onVrChange:function(e){e?this.vr||(this.vr=new n.VrManager(this)):this.vr&&(this.vr.destroy(),this.vr=null)},_onSkyboxChange:function(e){this.scene.setSkybox(e.resources)},_skyboxLoad:function(e){0===this.scene.skyboxMip&&(e.loadFaces=!0),this.assets.load(e),this._onSkyboxChange(e)},_skyboxRemove:function(e){this._skyboxLast&&(this.assets.off("add:"+e.id,this.setSkybox,this),this.assets.off("load:"+e.id,this._onSkyboxChange,this),this.assets.off("remove:"+e.id,this._skyboxRemove,this),this.scene.setSkybox(null),this._skyboxLast=null)},_firstBake:function(){this.lightmapper.bake(null,this.scene.lightmapMode)},_firstBatch:function(){this.scene._needsStaticPrepare&&(this.renderer.prepareStaticMeshes(this.graphicsDevice,this.scene),this.scene._needsStaticPrepare=!1),this.batcher.generate()},destroy:function(){e._applications[this.graphicsDevice.canvas.id]=null,e._currentApplication===this&&(e._currentApplication=null),this.off("librariesloaded"),document.removeEventListener("visibilitychange",this._visibilityChangeHandler),document.removeEventListener("mozvisibilitychange",this._visibilityChangeHandler),document.removeEventListener("msvisibilitychange",this._visibilityChangeHandler),document.removeEventListener("webkitvisibilitychange",this._visibilityChangeHandler),this.root.destroy(),this.root=null,this.mouse&&(this.mouse.off("mouseup"),this.mouse.off("mousedown"),this.mouse.off("mousewheel"),this.mouse.off("mousemove"),this.mouse.detach(),this.mouse=null),this.keyboard&&(this.keyboard.off("keydown"),this.keyboard.off("keyup"),this.keyboard.off("keypress"),this.keyboard.detach(),this.keyboard=null),this.touch&&(this.touch.off("touchstart"),this.touch.off("touchend"),this.touch.off("touchmove"),this.touch.off("touchcancel"),this.touch.detach(),this.touch=null),this.elementInput&&(this.elementInput.detach(),this.elementInput=null),this.controller&&(this.controller=null),n.ComponentSystem.destroy();for(var t=this.assets.list(),i=0;i<t.length;i++)t[i].unload();this.loader.destroy(),this.loader=null,this.scene=null,this.systems=[],this.context=null,this.graphicsDevice.clearShaderCache(),this.graphicsDevice.destroy(),this.graphicsDevice.destroyed=!0,this.graphicsDevice=null,this.renderer=null,this.tick=null,this._audioManager&&(this._audioManager.destroy(),this._audioManager=null),n.http=new n.Http,n.ParticleEmitter.DEFAULT_PARAM_TEXTURE=null,n.destroyPostEffectQuad()}});var i={},r=function(t){var r=t;return function(t){if(r.graphicsDevice){e._currentApplication=r,n.app=r;var s=t||n.now(),a=s-(r._time||s),o=a/1e3;o=n.math.clamp(o,0,r.maxDeltaTime),o*=r.timeScale,r._time=s,r.vr&&r.vr.display?r.vr.display.requestAnimationFrame(r.tick):window.requestAnimationFrame(r.tick),r.graphicsDevice.contextLost||(r.update(o),(r.autoRender||r.renderNextFrame)&&(r.render(),r.renderNextFrame=!1),i.timestamp=n.now(),i.target=r,r.fire("frameend",i),r.fire("frameEnd",i),r.vr&&r.vr.display&&r.vr.display.presenting&&r.vr.display.submitFrame())}}};return{FILLMODE_NONE:"NONE",FILLMODE_FILL_WINDOW:"FILL_WINDOW",FILLMODE_KEEP_ASPECT:"KEEP_ASPECT",RESOLUTION_AUTO:"AUTO",RESOLUTION_FIXED:"FIXED",Application:e}}()),n.ApplicationStats=function(e){this.frame={fps:0,ms:0,dt:0,updateStart:0,updateTime:0,renderStart:0,renderTime:0,physicsStart:0,physicsTime:0,cullTime:0,sortTime:0,skinTime:0,morphTime:0,instancingTime:0,triangles:0,otherPrimitives:0,shaders:0,materials:0,cameras:0,shadowMapUpdates:0,shadowMapTime:0,depthMapTime:0,forwardTime:0,_timeToCountFrames:0,_fpsAccum:0},this.drawCalls={forward:0,depth:0,shadow:0,immediate:0,misc:0,total:0,skinned:0,instanced:0,removedByInstancing:0},this.misc={renderTargetCreationTime:0},this.particles={updatesPerFrame:0,_updatesPerFrame:0,frameTime:0,_frameTime:0},this.vram=e._vram,this.shaders=e._shaderStats,Object.defineProperty(this.vram,"totalUsed",{get:function(){return this.tex+this.vb+this.ib}}),Object.defineProperty(this,"scene",{get:function(){return n.Application._currentApplication.scene._stats}}),Object.defineProperty(this,"lightmapper",{get:function(){return n.Application._currentApplication.lightmapper._stats}}),Object.defineProperty(this,"batcher",{get:function(){return n.Application._currentApplication.batcher._stats}}),n.events.attach(this)},Object.assign(n,function(){var e=function(e,t){this.name=e,this.url=t},t=function(e){this._app=e,this._list=[],this._index={},this._urlIndex={}};return t.prototype.list=function(){return this._list},t.prototype.add=function(e,t){if(this._index.hasOwnProperty(e))return!1;var i=new n.SceneRegistryItem(e,t),r=this._list.push(i);return this._index[i.name]=r-1,this._urlIndex[i.url]=r-1,!0},t.prototype.find=function(e){return this._index.hasOwnProperty(e)?this._list[this._index[e]]:null},t.prototype.findByUrl=function(e){return this._urlIndex.hasOwnProperty(e)?this._list[this._urlIndex[e]]:null},t.prototype.remove=function(e){if(this._index.hasOwnProperty(e)){var t=this._index[e],i=this._list[t];for(delete this._urlIndex[i.url],delete this._index[e],this._list.splice(t,1),t=0;t<this._list.length;t++)i=this._list[t],this._index[i.name]=t,this._urlIndex[i.url]=t}},t.prototype.loadSceneHierarchy=function(e,t){var i=this,r=this._app.loader.getHandler("hierarchy");this._app.assets&&this._app.assets.prefix&&!n.ABSOLUTE_URL.test(e)&&(e=n.path.join(this._app.assets.prefix,e)),r.load(e,function(s,a){if(s)return void(t&&t(s));var o=function(){i._app.systems.script.preloading=!0;var o=r.open(e,a);i._app.systems.script.preloading=!1,i._app.loader.clearCache(e,"hierarchy"),i._app.root.addChild(o),n.ComponentSystem.initialize(o),n.ComponentSystem.postInitialize(o),t&&t(s,o)};i._app._preloadScripts(a,o)})},t.prototype.loadSceneSettings=function(e,t){var i=this;this._app.assets&&this._app.assets.prefix&&!n.ABSOLUTE_URL.test(e)&&(e=n.path.join(this._app.assets.prefix,e)),this._app.loader.load(e,"scenesettings",function(e,n){e?t&&t(e):(i._app.applySceneSettings(n),t&&t(null))})},t.prototype.loadScene=function(e,t){var i=this,r=this._app.loader.getHandler("scene");this._app.assets&&this._app.assets.prefix&&!n.ABSOLUTE_URL.test(e)&&(e=n.path.join(this._app.assets.prefix,e)),r.load(e,function(n,s){if(n)t&&t(n);else{var a=function(){i._app.systems.script.preloading=!0;var n=r.open(e,s);i._app.systems.script.preloading=!1,i._app.loader.clearCache(e,"scene"),i._app.loader.patch({resource:n,type:"scene"},i._app.assets),i._app.root.addChild(n.root),i._app.systems.rigidbody&&"undefined"!=typeof Ammo&&i._app.systems.rigidbody.setGravity(n._gravity.x,n._gravity.y,n._gravity.z),t&&t(null,n)};i._app._preloadScripts(s,a)}})},{SceneRegistry:t,SceneRegistryItem:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{add:function(e,t){if(this[e])throw new Error(n.string.format("ComponentSystem name '{0}' already registered or not allowed",e));this[e]=t,t.name=e},remove:function(e){if(!this[e])throw new Error(n.string.format("No ComponentSystem named '{0}' registered",e));delete this[e]},list:function(){var e=Object.keys(this),t=1,i={collisionrect:.5,collisioncircle:.5};return e.sort(function(e,n){var r=i[e]||t,s=i[n]||t;return r<s?-1:r>s?1:0}),e.map(function(e){return this[e]},this)},getComponentSystemOrder:function(){var e,t=Object.keys(this);return e=t.indexOf("collisionrect"),t.splice(e,1),t.unshift("collisionrect"),e=t.indexOf("collisioncircle"),t.splice(e,1),t.unshift("collisioncircle"),t}}),{ComponentSystemRegistry:e}}()),Object.assign(n,function(){function e(e,t){if(!e)return e;switch(e=e&&e.data?e.data:e,t){case"rgb":return new n.Color(e[0],e[1],e[2]);case"rgba":return new n.Color(e[0],e[1],e[2],e[3]);case"vec2":return new n.Vec2(e[0],e[1]);case"vec3":return new n.Vec3(e[0],e[1],e[2]);case"vec4":return new n.Vec4(e[0],e[1],e[2],e[3]);case"boolean":case"number":case"string":return e;case"entity":return e;default:throw new Error("Could not convert unhandled type: "+t)}}var t=function(e){this.app=e,this.dataStore={},this.schema=[],n.events.attach(this)};return Object.assign(t,{initialize:function(e){t.fire("initialize",e)},postInitialize:function(e){t.fire("postInitialize",e)},update:function(e,i){i?t.fire("toolsUpdate",e):t.fire("update",e)},fixedUpdate:function(e,i){t.fire("fixedUpdate",e)},postUpdate:function(e,i){t.fire("postUpdate",e)}}),t.prototype={get store(){return this.dataStore},addComponent:function(e,t){var i=new this.ComponentType(this,e),n=new this.DataType;return t=t||{},this.dataStore[e._guid]={entity:e,data:n},e[this.id]=i,e.c[this.id]=i,this.initializeComponentData(i,t,[]),this.fire("add",e,i),i},removeComponent:function(e){var t=this.dataStore[e._guid],i=e.c[this.id];this.fire("beforeremove",e,i),delete this.dataStore[e._guid],delete e[this.id],delete e.c[this.id],this.fire("remove",e,t.data)},cloneComponent:function(e,t){var i=this.dataStore[e._guid];return this.addComponent(t,i.data)},initializeComponentData:function(t,i,n){i=i||{},n.forEach(function(n){var r,s;"object"==typeof n?(r=n.name,s=n.type):r=n;var a=i[r];void 0!==a?(void 0!==s&&(a=e(a,s)),t[r]=a):t[r]=t.data[r]},this),t.enabled&&t.entity.enabled&&t.onEnable()},getPropertiesOfType:function(e){var t=[],i=this.schema||[];return i.forEach(function(i){i&&"object"==typeof i&&i.type===e&&t.push(i)}),t}},n.events.attach(t),t.destroy=function(){t.off("initialize"),t.off("postInitialize"),t.off("toolsUpdate"),t.off("update"),t.off("fixedUpdate"),t.off("postUpdate")},{ComponentSystem:t}}()),Object.assign(n,function(){var e=function(e,t){this.system=e,this.entity=t,n.events.attach(this),this.system.schema&&!this._accessorsBuilt&&this.buildAccessors(this.system.schema),this.on("set",function(e,t,i){this.fire("set_"+e,e,t,i)}),this.on("set_enabled",this.onSetEnabled,this)};return e._buildAccessors=function(e,t){t.forEach(function(t){var i="object"==typeof t?t.name:t;Object.defineProperty(e,i,{get:function(){return this.data[i]},set:function(e){var t=this.data,n=t[i];t[i]=e,this.fire("set",i,n,e)},configurable:!0})}),e._accessorsBuilt=!0},e.prototype={get data(){var e=this.system.store[this.entity._guid];return e?e.data:null},buildAccessors:function(t){e._buildAccessors(this,t)},onSetEnabled:function(e,t,i){t!==i&&this.entity.enabled&&(i?this.onEnable():this.onDisable())},onEnable:function(){},onDisable:function(){},onPostStateChange:function(){}},{Component:e}}()),Object.assign(n,function(){var e=function(){};return{ComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.animationsIndex={},this.on("set_animations",this.onSetAnimations,this),this.on("set_assets",this.onSetAssets,this),this.on("set_loop",this.onSetLoop,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{play:function(e,t){if(!this.data.animations[e])return void console.error(n.string.format("Trying to play animation '{0}' which doesn't exist",e));if(this.enabled&&this.entity.enabled){t=t||0;var i=this.data;i.prevAnim=i.currAnim,i.currAnim=e,i.model&&(i.blending=t>0&&i.prevAnim,i.blending?(i.blendTime=t,i.blendTimeRemaining=t,i.fromSkel.animation=i.animations[i.prevAnim],i.fromSkel.addTime(i.skeleton._time),i.toSkel.animation=i.animations[i.currAnim]):i.skeleton.animation=i.animations[i.currAnim]),i.playing=!0}},getAnimation:function(e){return this.data.animations[e]},setModel:function(e){var t=this.data;if(e){var i=e.getGraph();t.fromSkel=new n.Skeleton(i),t.toSkel=new n.Skeleton(i),t.skeleton=new n.Skeleton(i),t.skeleton.looping=t.loop,t.skeleton.setGraph(i)}t.model=e,t.animations&&t.currAnim&&t.animations[t.currAnim]&&this.play(t.currAnim)},loadAnimationAssets:function(e){if(e&&e.length){var t,i=this,n=this.system.app.assets,r=e.length,s=function(e){i.animations[e.name]=e.resource,i.animationsIndex[e.id]=e.name,i.animations=i.animations},a=function(e){e.off("change",i.onAssetChanged,i),e.on("change",i.onAssetChanged,i),e.off("remove",i.onAssetRemoved,i),e.on("remove",i.onAssetRemoved,i),e.resource?s(e):(e.once("load",s,i),i.enabled&&i.entity.enabled&&n.load(e))};for(t=0;t<r;t++){var o=n.get(e[t]);o?a(o):n.on("add:"+e[t],a)}}},onAssetChanged:function(e,t,i,n){"resource"===t&&(i?(this.animations[e.name]=i,this.animationsIndex[e.id]=e.name,this.data.currAnim===e.name&&this.data.playing&&this.data.enabled&&this.entity.enabled&&this.play(e.name,0)):(delete this.animations[e.name],delete this.animationsIndex[e.id]))},onAssetRemoved:function(e){e.off("remove",this.onAssetRemoved,this),this.animations&&this.animations[e.name]&&(delete this.animations[e.name],delete this.animationsIndex[e.id],this.data.currAnim===e.name&&this._stopCurrentAnimation())},_stopCurrentAnimation:function(){this.data.currAnim=null,this.data.playing=!1,this.data.skeleton&&(this.data.skeleton.currentTime=0,this.data.skeleton.animation=null)},onSetAnimations:function(e,t,i){var n=this.data,r=this.entity.model;if(r){var s=r.model;s&&s!==n.model&&this.entity.animation.setModel(s)}if(!n.currAnim&&n.activate&&n.enabled&&this.entity.enabled)for(var a in n.animations){this.play(a,0);break}},onSetAssets:function(e,t,i){if(t&&t.length)for(var r=0;r<t.length;r++)if(t[r]){var s=this.system.app.assets.get(t[r]);if(s){s.off("change",this.onAssetChanged,this),s.off("remove",this.onAssetRemoved,this);var a=this.animationsIndex[s.id];this.data.currAnim===a&&this._stopCurrentAnimation(),delete this.animations[a],delete this.animationsIndex[s.id]}}var o=i.map(function(e){return e instanceof n.Asset?e.id:e});this.loadAnimationAssets(o)},onSetLoop:function(e,t,i){this.data.skeleton&&(this.data.skeleton.looping=this.data.loop)},onSetCurrentTime:function(e,t,i){this.data.skeleton.currentTime=i,this.data.skeleton.addTime(0),this.data.skeleton.updateGraph()},onEnable:function(){n.Component.prototype.onEnable.call(this);var e=this.data.assets,t=this.system.app.assets;if(e)for(var i=0,r=e.length;i<r;i++){var s=e[i];s instanceof n.Asset||(s=t.get(s)),s&&!s.resource&&t.load(s)}if(this.data.activate&&!this.data.currAnim)for(var a in this.data.animations){this.play(a,0);break}},onBeforeRemove:function(){for(var e=0;e<this.assets.length;e++){var t=this.system.app.assets.get(this.assets[e]);t&&(t.off("change",this.onAssetChanged,this),t.off("remove",this.onAssetRemoved,this))}delete this.data.animation,delete this.data.skeleton,delete this.data.fromSkel,delete this.data.toSkel}}),Object.defineProperties(e.prototype,{currentTime:{get:function(){return this.data.skeleton._time},set:function(e){this.data.skeleton.currentTime=e,this.data.skeleton.addTime(0),this.data.skeleton.updateGraph()}},duration:{get:function(){return this.data.animations[this.data.currAnim].duration}}}),{AnimationComponent:e}}()),Object.assign(n,function(){var e=["enabled","assets","speed","loop","activate","animations","skeleton","model","prevAnim","currAnim","fromSkel","toSkel","blending","blendTimeRemaining","playing"],t=function(t){n.ComponentSystem.call(this,t),this.id="animation",this.description="Specifies the animation assets that can run on the model specified by the Entity's model Component.",t.systems.add(this.id,this),this.ComponentType=n.AnimationComponent,this.DataType=n.AnimationComponentData,this.schema=e,this.on("beforeremove",this.onBeforeRemove,this),this.on("update",this.onUpdate,this),n.ComponentSystem.on("update",this.onUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.AnimationComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){i=["activate","enabled","loop","speed","assets"],n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},cloneComponent:function(e,t){var i;this.addComponent(t,{}),t.animation.data.assets=n.extend([],e.animation.assets),t.animation.data.speed=e.animation.speed,t.animation.data.loop=e.animation.loop,t.animation.data.activate=e.animation.activate,t.animation.data.enabled=e.animation.enabled;var r={},s=e.animation.animations;for(i in s)s.hasOwnProperty(i)&&(r[i]=s[i]);t.animation.animations=r;var a={},o=e.animation.animationsIndex;for(i in o)o.hasOwnProperty(i)&&(a[i]=o[i]);t.animation.animationsIndex=a},onBeforeRemove:function(e,t){t.onBeforeRemove()},onUpdate:function(e){var t=this.store;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r=n.data;if(r.enabled&&r.playing&&n.entity.enabled){var s=r.skeleton;if(null!==s&&null!==r.model){if(r.blending){r.blendTimeRemaining-=e,r.blendTimeRemaining<0&&(r.blendTimeRemaining=0);var a=1-r.blendTimeRemaining/r.blendTime;s.blend(r.fromSkel,r.toSkel,a)}else{var o=e*r.speed;s.addTime(o),s._time!==s._animation.duration||r.loop||(r.playing=!1)}r.blending&&0===r.blendTimeRemaining&&(r.blending=!1,s.animation=r.toSkel._animation),s.updateGraph()}}}}}),{AnimationComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.assets=[],this.speed=1,this.loop=!0,this.activate=!0,this.enabled=!0,this.animations={},this.skeleton=null,this.model=null,this.prevAnim=null,this.currAnim=null,this.fromSkel=null,this.toSkel=null,this.blending=!1,this.blendTime=0,this.blendTimeRemaining=0,this.playing=!1};return{AnimationComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_type",this.onSetType,this),this.on("set_asset",this.onSetAsset,this),this.on("set_castShadows",this.onSetCastShadows,this),this.on("set_receiveShadows",this.onSetReceiveShadows,this),this.on("set_castShadowsLightmap",this.onSetCastShadowsLightmap,this),this.on("set_lightmapped",this.onSetLightmapped,this),this.on("set_lightmapSizeMultiplier",this.onSetLightmapSizeMultiplier,this),this.on("set_isStatic",this.onSetIsStatic,this),this.on("set_model",this.onSetModel,this),this.on("set_material",this.onSetMaterial,this),this.on("set_mapping",this.onSetMapping,this),this.on("set_layers",this.onSetLayers,this),this.on("set_batchGroupId",this.onSetBatchGroupId,this),Object.defineProperty(this,"materialAsset",{set:this.setMaterialAsset.bind(this),get:this.getMaterialAsset.bind(this)}),this._assetOld=0,this._materialEvents=null,this._dirtyModelAsset=!1,this._dirtyMaterialAsset=!1,this._clonedModel=!1};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{setVisible:function(e){console.warn("WARNING: setVisible: Function is deprecated. Set enabled property instead."),this.enabled=e},_onAssetLoad:function(e){e.resource&&(this._onModelLoaded(e.resource.clone()),this._clonedModel=!0)},addModelToLayers:function(){for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&e.addMeshInstances(this.meshInstances)},removeModelFromLayers:function(e){for(var t,i=0;i<this.layers.length;i++)t=this.system.app.scene.layers.getLayerById(this.layers[i]),t&&t.removeMeshInstances(e.meshInstances)},_onAssetUnload:function(e){this.model&&(this.removeModelFromLayers(this.model),this.model=null)},_onAssetChange:function(e,t,i,n){"data"===t&&(this.mapping=this.data.mapping)},_onAssetRemove:function(e){this.asset===e.id&&(this.asset=null)},_setModelAsset:function(e){if(this._assetOld!==e){var t=this.system.app.assets,i=null!==e?t.get(e):null;this._dirtyModelAsset=!0,this._onModelAsset(i||null),i||null===e||t.once("add:"+e,this._onModelAsset,this)}},_onModelAsset:function(e){var t=this.system.app.assets;if(this._assetOld){t.off("add:"+this._assetOld,this._onModelAsset,this);var i=t.get(this._assetOld);i&&(i.off("load",this._onAssetLoad,this),i.off("unload",this._onAssetUnload,this),i.off("change",this._onAssetChange,this),i.off("remove",this._onAssetRemove,this))}this._assetOld=e?e.id:0,e?(e.on("load",this._onAssetLoad,this),e.on("unload",this._onAssetUnload,this),e.on("change",this._onAssetChange,this),e.on("remove",this._onAssetRemove,this),e.resource?(this._dirtyModelAsset=!1,this._onModelLoaded(e.resource.clone()),this._clonedModel=!0):this.enabled&&this.entity.enabled&&(this._dirtyModelAsset=!1,t.load(e))):this._dirtyModelAsset=!1},remove:function(){this._onModelAsset(null)},_onModelLoaded:function(e){"asset"===this.data.type&&(this.model=e)},onSetType:function(e,t,i){var r=this.data;if(i){var s=null;if(this._area=null,"asset"===i)null!==this.data.asset?this._setModelAsset(this.data.asset):this.model=null;else{switch(i){case"box":s=this.system.box,this._area={x:2,y:2,z:2,uv:2/3};break;case"capsule":s=this.system.capsule,this._area={x:2*Math.PI,y:Math.PI,z:2*Math.PI,uv:1/3+1/3/3*2};break;case"sphere":s=this.system.sphere,this._area={x:Math.PI,y:Math.PI,z:Math.PI,uv:1};break;case"cone":s=this.system.cone,this._area={x:2.54,y:2.54,z:2.54,uv:1/3+1/3/3};break;case"cylinder":s=this.system.cylinder,this._area={x:Math.PI,y:1.58,z:Math.PI,uv:1/3+1/3/3*2};break;case"plane":s=this.system.plane,this._area={x:0,y:1,z:0,uv:1};break;default:throw new Error("Invalid model type: "+i)}var a=new n.GraphNode,o=new n.Model;o.graph=a,o.meshInstances=[new n.MeshInstance(a,s,r.material)],this.system._inTools&&o.generateWireframe(),this.model=o,this.asset=null}}},onSetAsset:function(e,t,i){var r=null;"asset"===this.data.type&&(null!==i?(r=i,i instanceof n.Asset&&(this.data.asset=i.id,r=i.id)):this.model=null),null===r&&(this.data.asset=null),this._setModelAsset(r)},onSetCastShadows:function(e,t,i){var n,r,s=this.data.model;if(s){var a=this.layers,o=this.system.app.scene;if(t&&!i)for(r=0;r<a.length;r++)n=this.system.app.scene.layers.getLayerById(this.layers[r]),n&&n.removeShadowCasters(s.meshInstances);var h=s.meshInstances;for(r=0;r<h.length;r++)h[r].castShadow=i;if(!t&&i)for(r=0;r<a.length;r++)n=o.layers.getLayerById(a[r]),n&&n.addShadowCasters(s.meshInstances)}},onSetCastShadowsLightmap:function(e,t,i){},onSetLightmapped:function(e,t,i){var r,s,a;if(this.data.model){var o=this.data.model.meshInstances;if(i)for(r=0;r<o.length;r++)s=o[r],a=s.mask,s.mask=(a|n.MASK_BAKED)&~(n.MASK_DYNAMIC|n.MASK_LIGHTMAP);else for(r=0;r<o.length;r++)s=o[r],s.deleteParameter("texture_lightMap"),s.deleteParameter("texture_dirLightMap"),s._shaderDefs&=~n.SHADERDEF_LM,a=s.mask,s.mask=(a|n.MASK_DYNAMIC)&~(n.MASK_BAKED|n.MASK_LIGHTMAP)}},onSetLightmapSizeMultiplier:function(e,t,i){this.data.lightmapSizeMultiplier=i},onSetIsStatic:function(e,t,i){var n,r;if(this.data.model){var s=this.data.model.meshInstances;for(n=0;n<s.length;n++)r=s[n],r.isStatic=i}},onSetLayers:function(e,t,i){if(this.meshInstances){var n,r;for(n=0;n<t.length;n++)r=this.system.app.scene.layers.getLayerById(t[n]),r&&r.removeMeshInstances(this.meshInstances);if(this.enabled&&this.entity.enabled)for(n=0;n<i.length;n++)r=this.system.app.scene.layers.getLayerById(i[n]),r&&r.addMeshInstances(this.meshInstances)}},onLayersChanged:function(e,t){this.addModelToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)},onLayerAdded:function(e){var t=this.layers.indexOf(e.id);t<0||e.addMeshInstances(this.meshInstances)},onLayerRemoved:function(e){var t=this.layers.indexOf(e.id);t<0||e.removeMeshInstances(this.meshInstances)},onSetBatchGroupId:function(e,t,i){t>=0&&this.system.app.batcher.markGroupDirty(t),i>=0&&this.system.app.batcher.markGroupDirty(i),i<0&&t>=0&&this.enabled&&this.entity.enabled&&this.addModelToLayers()},onSetModel:function(e,t,i){if(t&&(this.removeModelFromLayers(t),this.entity.removeChild(t.getGraph()),delete t._entity,this._clonedModel&&(t.destroy(),this._clonedModel=!1)),i){for(var n=this.data,r=i.meshInstances,s=0;s<r.length;s++)r[s].castShadow=n.castShadows,r[s].receiveShadow=n.receiveShadows;this.lightmapped=n.lightmapped,this.isStatic=n.isStatic,this.entity.addChild(i.graph),this.enabled&&this.entity.enabled&&this.addModelToLayers(),i._entity=this.entity,this.entity.animation&&this.entity.animation.setModel(i),"asset"===this.data.type?this.mapping=this.data.mapping:this._unsetMaterialEvents()}else this._unsetMaterialEvents()},_onMaterialAssetRemove:function(e){var t=this.system.app.assets,i=isNaN(e)?e.id:e;e&&isNaN(e)&&e.resource===this.material&&(this.material=n.ModelHandler.DEFAULT_MATERIAL),t.off("add:"+i,this._onMaterialAssetAdd,this),t.off("load:"+i,this._onMaterialAssetLoad,this),t.off("unload:"+i,this._onMaterialAssetUnload,this),t.off("remove:"+i,this._onMaterialAssetRemove,this)},_onMaterialAssetAdd:function(e){var t=this.system.app.assets;e.resource?(this.material=e.resource,this._dirtyMaterialAsset=!1):this.enabled&&this.entity.enabled&&(this._dirtyMaterialAsset=!1,t.load(e))},_onMaterialAssetLoad:function(e){var t=this.system.app.assets;e.resource?(this.material=e.resource,this._dirtyMaterialAsset=!1):this.enabled&&this.entity.enabled&&(this._dirtyMaterialAsset=!1,t.load(e))},_onMaterialAssetUnload:function(e){e&&isNaN(e)&&e.resource===this.material&&(this.material=n.ModelHandler.DEFAULT_MATERIAL)},setMaterialAsset:function(e){this._dirtyMaterialAsset=!0;var t="number"!=typeof e&&e?e.id:e,i=this.system.app.assets,r=this;if(this.data.materialAsset!==t&&(this.data.materialAsset&&this._onMaterialAssetRemove(this.data.materialAsset),t&&(i.on("load:"+t,this._onMaterialAssetLoad,this),i.on("unload:"+t,this._onMaterialAssetUnload,this),i.on("remove:"+t,this._onMaterialAssetRemove,this))),void 0!==t&&null!==t){var s=i.get(t);s&&this._onMaterialAssetLoad(s),i.once("add:"+t,this._onMaterialAssetAdd,this)}else null===t&&(r.material=n.ModelHandler.DEFAULT_MATERIAL,r._dirtyMaterialAsset=!1);var a=this.data.materialAsset;this.data.materialAsset=t,this.fire("set","materialAsset",a,t)},getMaterialAsset:function(){return this.system.app.assets.get(this.data.materialAsset)},onSetMaterial:function(e,t,i){if(i!==t&&(this.data.material=i,this.data.model&&"asset"!==this.data.type))for(var n=this.data.model.meshInstances,r=0;r<n.length;r++)n[r].material=i},onSetMapping:function(e,t,i){if("asset"===this.data.type&&this.data.model){this._unsetMaterialEvents(),i||(i={});for(var r=this.data.model.meshInstances,s=this.asset?this.system.app.assets.get(this.asset):null,a=s?s.data.mapping:null,o=0,h=r.length;o<h;o++)if(void 0!==i[o])i[o]?this._loadAndSetMeshInstanceMaterial(i[o],r[o],o):r[o].material=n.ModelHandler.DEFAULT_MATERIAL;else if(a)if(a[o]&&(a[o].material||a[o].path)){var l=a[o].material||a[o].path;this._loadAndSetMeshInstanceMaterial(l,r[o],o)}else r[o].material=n.ModelHandler.DEFAULT_MATERIAL}},_setMaterialEvent:function(e,t,i,n){var r=t+":"+i;this.system.app.assets.on(r,n,this),this._materialEvents||(this._materialEvents=[]),this._materialEvents[e]||(this._materialEvents[e]={}),this._materialEvents[e][r]={id:i,handler:n}},_unsetMaterialEvents:function(){var e=this.system.app.assets,t=this._materialEvents;if(t){for(var i=0,n=t.length;i<n;i++)if(t[i]){var r=t[i];for(var s in r)e.off(s,r[s].handler,this)}this._materialEvents=null}},_getAssetByIdOrPath:function(e){var t=null,i=isNaN(parseInt(e,10));if(i){if(this.asset){var n=this._getMaterialAssetUrl(e);n&&(t=this.system.app.assets.getByUrl(n))}}else t=this.system.app.assets.get(e);return t},_getMaterialAssetUrl:function(e){if(!this.asset)return null;var t=this.system.app.assets.get(this.asset);if(!t)return null;var i=t.getFileUrl(),r=n.path.getDirectory(i);return n.path.join(r,e)},_loadAndSetMeshInstanceMaterial:function(e,t,i){var r=this,s=this.system.app.assets,a=this._getAssetByIdOrPath(e);if(a){var o=function(e){e.resource?(t.material=e.resource,r._setMaterialEvent(i,"remove",e.id,function(){t.material=n.ModelHandler.DEFAULT_MATERIAL})):(r._setMaterialEvent(i,"load",e.id,function(e){t.material=e.resource,r._setMaterialEvent(i,"remove",e.id,function(){t.material=n.ModelHandler.DEFAULT_MATERIAL})}),r.enabled&&r.entity.enabled&&s.load(e))};if(a)o(a);else{t.material=n.ModelHandler.DEFAULT_MATERIAL;var h=isNaN(parseInt(e,10));r._setMaterialEvent(i,h?"add:url":"add",e,o)}}},onSetReceiveShadows:function(e,t,i){if(void 0!==i){var n=this.data;if(n.model)for(var r=n.model.meshInstances,s=0;s<r.length;s++)r[s].receiveShadow=i}},onEnable:function(){n.Component.prototype.onEnable.call(this),this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this));var e,t=this.data.model,i="asset"===this.data.type;if(t)this.addModelToLayers();else if(i&&this._dirtyModelAsset){if(e=this.data.asset,!e)return;e=this.system.app.assets.get(e),e&&this._onModelAsset(e)}if(this._dirtyMaterialAsset){var r=this.data.materialAsset;r&&(r=this.system.app.assets.get(r),r&&!r.resource&&this._onMaterialAssetLoad(r))}if(i){var s=this.data.mapping;if(s)for(var a in s)s[a]&&(e=this._getAssetByIdOrPath(s[a]),e&&!e.resource&&this.system.app.assets.load(e))}},onDisable:function(){n.Component.prototype.onDisable.call(this),this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.batchGroupId>=0&&this.system.app.batcher.markGroupDirty(this.batchGroupId);var e=this.data.model;e&&this.removeModelFromLayers(this.model)},hide:function(){var e=this.data.model;if(e){var t,i,n=e.meshInstances;for(t=0,i=n.length;t<i;t++)n[t].visible=!1}},show:function(){var e=this.data.model;if(e){var t,i,n=e.meshInstances;for(t=0,i=n.length;t<i;t++)n[t].visible=!0}}}),Object.defineProperty(e.prototype,"meshInstances",{get:function(){return this.model?this.model.meshInstances:null},set:function(e){this.model&&(this.model.meshInstances=e)}}),{ModelComponent:e}}()),Object.assign(n,function(){var e=["enabled","type","asset","materialAsset","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","isStatic","material","model","layers","batchGroupId","mapping"],t=function(t){n.ComponentSystem.call(this,t),this.id="model",this.description="Renders a 3D model at the location of the Entity.",t.systems.add(this.id,this),this.ComponentType=n.ModelComponent,this.DataType=n.ModelComponentData,this.schema=e;var i=t.graphicsDevice;this.box=n.createBox(i,{halfExtents:new n.Vec3(.5,.5,.5)}),this.capsule=n.createCapsule(i,{radius:.5,height:2}),this.sphere=n.createSphere(i,{radius:.5}),this.cone=n.createCone(i,{baseRadius:.5,peakRadius:0,height:1}),this.cylinder=n.createCylinder(i,{radius:.5,height:1}),this.plane=n.createPlane(i,{halfExtents:new n.Vec2(.5,.5),widthSegments:1,lengthSegments:1}),this.defaultMaterial=new n.StandardMaterial,this.on("beforeremove",this.onRemove,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ModelComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){
i=["enabled","material","materialAsset","asset","castShadows","receiveShadows","castShadowsLightmap","lightmapped","lightmapSizeMultiplier","type","mapping","layers","isStatic","batchGroupId"];for(var r,s={},a=0;a<i.length;a++)r=i[a],s[r]=t[r];s.material=this.defaultMaterial,null!==s.batchGroupId&&void 0!==s.batchGroupId||(s.batchGroupId=-1),s.layers&&"array"===n.type(s.layers)&&(s.layers=s.layers.slice(0)),n.ComponentSystem.prototype.initializeComponentData.call(this,e,s,i)},removeComponent:function(e){var t=e.model.data;e.model.asset=null,"asset"!==t.type&&t.model&&(e.model.removeModelFromLayers(e.model.model),e.removeChild(t.model.getGraph()),t.model=null),n.ComponentSystem.prototype.removeComponent.call(this,e)},cloneComponent:function(e,t){var i={type:e.model.type,asset:e.model.asset,castShadows:e.model.castShadows,receiveShadows:e.model.receiveShadows,castShadowsLightmap:e.model.castShadowsLightmap,lightmapped:e.model.lightmapped,lightmapSizeMultiplier:e.model.lightmapSizeMultiplier,isStatic:e.model.isStatic,enabled:e.model.enabled,layers:e.model.layers,batchGroupId:e.model.batchGroupId,mapping:n.extend({},e.model.mapping)},r=e.model.materialAsset;r instanceof n.Asset||null==r||(r=this.app.assets.get(r));var s=e.model.material;s&&s!==n.ModelHandler.DEFAULT_MATERIAL&&r&&s!==r.resource||(i.materialAsset=r);var a=this.addComponent(t,i);if(e.model.model&&"asset"===e.model.type&&!e.model.asset&&(a.model=e.model.model.clone(),a._clonedModel=!0),i.materialAsset||(a.material=s),e.model.model)for(var o=e.model.model.meshInstances,h=a.model.meshInstances,l=0;l<o.length;l++)h[l].mask=o[l].mask,h[l].material=o[l].material,h[l].layer=o[l].layer,h[l].receiveShadow=o[l].receiveShadow},onRemove:function(e,t){e.model.materialAsset=null,t.remove()}}),{ModelComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0,this.type="asset",this.asset=null,this.castShadows=!0,this.receiveShadows=!0,this.materialAsset=null,this.mapping=null,this.castShadowsLightmap=!0,this.lightmapped=!1,this.lightmapSizeMultiplier=1,this.isStatic=!1,this.layers=[n.LAYERID_WORLD],this.batchGroupId=-1,this.material=null,this.model=null};return{ModelComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_aspectRatioMode",this.onSetAspectRatioMode,this),this.on("set_aspectRatio",this.onSetAspectRatio,this),this.on("set_camera",this.onSetCamera,this),this.on("set_clearColor",this.onSetClearColor,this),this.on("set_fov",this.onSetFov,this),this.on("set_orthoHeight",this.onSetOrthoHeight,this),this.on("set_nearClip",this.onSetNearClip,this),this.on("set_farClip",this.onSetFarClip,this),this.on("set_projection",this.onSetProjection,this),this.on("set_priority",this.onSetPriority,this),this.on("set_clearColorBuffer",this.updateClearFlags,this),this.on("set_clearDepthBuffer",this.updateClearFlags,this),this.on("set_clearStencilBuffer",this.updateClearFlags,this),this.on("set_renderTarget",this.onSetRenderTarget,this),this.on("set_rect",this.onSetRect,this),this.on("set_scissorRect",this.onSetScissorRect,this),this.on("set_horizontalFov",this.onSetHorizontalFov,this),this.on("set_frustumCulling",this.onSetFrustumCulling,this),this.on("set_calculateTransform",this.onSetCalculateTransform,this),this.on("set_calculateProjection",this.onSetCalculateProjection,this),this.on("set_cullFaces",this.onSetCullFaces,this),this.on("set_flipFaces",this.onSetFlipFaces,this),this.on("set_layers",this.onSetLayers,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"projectionMatrix",{get:function(){return this.data.camera.getProjectionMatrix()}}),Object.defineProperty(e.prototype,"viewMatrix",{get:function(){var e=this.data.camera._node.getWorldTransform();return e.clone().invert()}}),Object.defineProperty(e.prototype,"frustum",{get:function(){return this.data.camera.frustum}}),Object.defineProperty(e.prototype,"vrDisplay",{get:function(){return this.data.camera.vrDisplay},set:function(e){this.data.camera.vrDisplay=e,e&&(e._camera=this.data.camera)}}),Object.defineProperty(e.prototype,"node",{get:function(){return this.data.camera._node}}),Object.assign(e.prototype,{screenToWorld:function(e,t,i,n){var r=this.system.app.graphicsDevice;return this.data.camera.screenToWorld(e,t,i,r.clientRect.width,r.clientRect.height,n)},worldToScreen:function(e,t){var i=this.system.app.graphicsDevice;return this.data.camera.worldToScreen(e,i.clientRect.width,i.clientRect.height,t)},onSetAspectRatioMode:function(e,t,i){this.data.camera.aspectRatioMode=i},onSetAspectRatio:function(e,t,i){this.data.camera.aspectRatio=i},onSetCamera:function(e,t,i){t&&(t._node=null),i._node=this.entity},onSetClearColor:function(e,t,i){this.data.camera.clearColor[0]=i.data[0],this.data.camera.clearColor[1]=i.data[1],this.data.camera.clearColor[2]=i.data[2],this.data.camera.clearColor[3]=i.data[3]},onSetFov:function(e,t,i){this.data.camera.fov=i},onSetOrthoHeight:function(e,t,i){this.data.camera.orthoHeight=i},onSetNearClip:function(e,t,i){this.data.camera.nearClip=i},onSetFarClip:function(e,t,i){this.data.camera.farClip=i},onSetHorizontalFov:function(e,t,i){this.data.camera.horizontalFov=i},onSetFrustumCulling:function(e,t,i){this.data.camera.frustumCulling=i},onSetCalculateTransform:function(e,t,i){this._calculateTransform=i,this.camera.overrideCalculateTransform=!!i},onSetCalculateProjection:function(e,t,i){this._calculateProjection=i,this.camera._projMatDirty=!0,this.camera.overrideCalculateProjection=!!i},onSetCullFaces:function(e,t,i){this.camera._cullFaces=i},onSetFlipFaces:function(e,t,i){this.camera._flipFaces=i},onSetProjection:function(e,t,i){this.data.camera.projection=i},onSetPriority:function(e,t,i){for(var n,r=0;r<this.layers.length;r++)n=this.system.app.scene.layers.getLayerById(this.layers[r]),n&&n._sortCameras()},onSetLayers:function(e,t,i){var n,r;for(n=0;n<t.length;n++)r=this.system.app.scene.layers.getLayerById(t[n]),r&&r.removeCamera(this);if(this.enabled&&this.entity.enabled)for(n=0;n<i.length;n++)r=this.system.app.scene.layers.getLayerById(i[n]),r&&r.addCamera(this)},addCameraToLayers:function(){for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&e.addCamera(this)},removeCameraFromLayers:function(){for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&e.removeCamera(this)},onLayersChanged:function(e,t){this.addCameraToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)},onLayerAdded:function(e){var t=this.layers.indexOf(e.id);t<0||e.addCamera(this)},onLayerRemoved:function(e){var t=this.layers.indexOf(e.id);t<0||e.removeCamera(this)},updateClearFlags:function(){var e=0;this.clearColorBuffer&&(e|=n.CLEARFLAG_COLOR),this.clearDepthBuffer&&(e|=n.CLEARFLAG_DEPTH),this.clearStencilBuffer&&(e|=n.CLEARFLAG_STENCIL),this.data.camera.clearFlags=e},onSetRenderTarget:function(e,t,i){this.data.camera.renderTarget=i},onSetRect:function(e,t,i){this.data.camera.setRect(i.data[0],i.data[1],i.data[2],i.data[3])},onSetScissorRect:function(e,t,i){this.data.camera.setScissorRect(i.data[0],i.data[1],i.data[2],i.data[3])},onEnable:function(){n.Component.prototype.onEnable.call(this),this.system.addCamera(this),this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addCameraToLayers(),this.postEffects.enable()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.postEffects.disable(),this.removeCameraFromLayers(),this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.system.removeCamera(this)},calculateAspectRatio:function(e){var t=e?e:this.system.app.graphicsDevice,i=this.rect;return t.width*i.z/(t.height*i.w)},frameBegin:function(e){this.aspectRatioMode===n.ASPECT_AUTO&&(this.aspectRatio=this.calculateAspectRatio(e)),this.data.isRendering=!0},frameEnd:function(){this.data.isRendering=!1},enterVr:function(e,t){if(e instanceof Function&&!t&&(t=e,e=null),!this.system.app.vr)return void t("VrManager not created. Enable VR in project settings.");if(e||(e=this.system.app.vr.display),e){var i=this;e.capabilities.canPresent?e.requestPresent(function(n){n||(i.vrDisplay=e,i.vrDisplay.once("beforepresentchange",function(e){e.presenting||(i.vrDisplay=null)})),t(n)}):(i.vrDisplay=e,t())}else t("No pc.VrDisplay to present")},exitVr:function(e){if(this.vrDisplay)if(this.vrDisplay.capabilities.canPresent){var t=this.vrDisplay;this.vrDisplay=null,t.exitPresent(e)}else this.vrDisplay=null,e();else e("Not presenting VR")}}),{CameraComponent:e}}()),Object.assign(n,function(){var e=["enabled","clearColorBuffer","clearColor","clearDepthBuffer","clearStencilBuffer","frustumCulling","projection","fov","orthoHeight","nearClip","farClip","priority","rect","scissorRect","camera","aspectRatio","aspectRatioMode","horizontalFov","model","renderTarget","calculateTransform","calculateProjection","cullFaces","flipFaces","layers"],t=function(t){n.ComponentSystem.call(this,t),this.id="camera",this.description="Renders the scene from the location of the Entity.",t.systems.add(this.id,this),this.ComponentType=n.CameraComponent,this.DataType=n.CameraComponentData,this.schema=e,this.cameras=[],this.on("beforeremove",this.onBeforeRemove,this),this.on("remove",this.onRemove,this),n.ComponentSystem.on("update",this.onUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.CameraComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){i=["postEffects","enabled","model","camera","aspectRatio","aspectRatioMode","horizontalFov","renderTarget","clearColor","fov","orthoHeight","nearClip","farClip","projection","priority","clearColorBuffer","clearDepthBuffer","clearStencilBuffer","frustumCulling","rect","scissorRect","calculateTransform","calculateProjection","cullFaces","flipFaces","layers"];var r={};if(i.forEach(function(e){r[e]=t[e]}),r.layers&&"array"===n.type(r.layers)&&(r.layers=r.layers.slice(0)),r.clearColor&&"array"===n.type(r.clearColor)){var s=r.clearColor;r.clearColor=new n.Color(s[0],s[1],s[2],s[3])}if(r.rect&&"array"===n.type(r.rect)){var a=r.rect;r.rect=new n.Vec4(a[0],a[1],a[2],a[3])}if(r.scissorRect&&"array"===n.type(r.scissorRect)){var o=r.scissorRect;r.scissorRect=new n.Vec4(o[0],o[1],o[2],o[3])}r.activate&&(console.warn("WARNING: activate: Property is deprecated. Set enabled property instead."),r.enabled=r.activate),r.camera=new n.Camera,r._node=e.entity,r.camera._component=e;var h=e;r.camera.calculateTransform=function(e,t){return h._calculateTransform?h._calculateTransform(e,t):null},r.camera.calculateProjection=function(e,t){return h._calculateProjection?h._calculateProjection(e,t):null},r.postEffects=new n.PostEffectQueue(this.app,e),n.ComponentSystem.prototype.initializeComponentData.call(this,e,r,i)},onBeforeRemove:function(e,t){this.removeCamera(t)},onRemove:function(e,t){t.camera=null},onUpdate:function(e){var t,i,n,r,s=this.store;if(this.app.vr)for(var a in s)t=s[a],i=t.data,n=i.camera,r=n.vrDisplay,i.enabled&&t.entity.enabled&&r&&(r.setClipPlanes(n._nearClip,n._farClip),n._node&&(n._node.localTransform.copy(r.combinedViewInv),n._node._dirtyLocal=!1,n._node._dirtify()))},addCamera:function(e){this.cameras.push(e),this.sortCamerasByPriority()},removeCamera:function(e){var t=this.cameras.indexOf(e);t>=0&&(this.cameras.splice(t,1),this.sortCamerasByPriority())},sortCamerasByPriority:function(){this.cameras.sort(function(e,t){return e.priority-t.priority})}}),{CameraComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.clearColor=new n.Color(.722,.722,.722,1),this.clearColorBuffer=!0,this.clearDepthBuffer=!0,this.clearStencilBuffer=!0,this.nearClip=.1,this.farClip=1e3,this.fov=45,this.orthoHeight=100,this.projection=n.PROJECTION_PERSPECTIVE,this.priority=0,this.rect=new n.Vec4(0,0,1,1),this.scissorRect=new n.Vec4(0,0,1,1),this.enabled=!0,this.frustumCulling=!1,this.cullFaces=!0,this.flipFaces=!1,this.layers=[n.LAYERID_WORLD,n.LAYERID_DEPTH,n.LAYERID_SKYBOX,n.LAYERID_UI,n.LAYERID_IMMEDIATE],this.camera=null,this.aspectRatio=16/9,this.aspectRatioMode=n.ASPECT_AUTO,this.renderTarget=null,this.postEffects=null,this.isRendering=!1,this.calculateTransform=null,this.calculateProjection=null};return{CameraComponentData:e}}()),Object.assign(n,function(){function e(e,t){var i=this;this.app=e,this.camera=t,this.effects=[],this.enabled=!1,this.depthTarget=null,this.renderTargetScale=1,this.resizeTimeout=null,this.resizeLast=0,this._resizeTimeoutCallback=function(){i.resizeRenderTargets()},t.on("set_rect",this.onCameraRectChanged,this)}return Object.assign(e.prototype,{_createOffscreenTarget:function(e,t){var i=this.camera.rect,r=Math.floor(i.z*this.app.graphicsDevice.width*this.renderTargetScale),s=Math.floor(i.w*this.app.graphicsDevice.height*this.renderTargetScale),a=this.app.graphicsDevice,o=t?a.getHdrFormat():n.PIXELFORMAT_R8_G8_B8_A8,h=new n.Texture(a,{format:o,width:r,height:s});return h.minFilter=n.FILTER_NEAREST,h.magFilter=n.FILTER_NEAREST,h.addressU=n.ADDRESS_CLAMP_TO_EDGE,h.addressV=n.ADDRESS_CLAMP_TO_EDGE,new n.RenderTarget(this.app.graphicsDevice,h,{depth:e})},_resizeOffscreenTarget:function(e){var t=this.camera.rect,i=Math.floor(t.z*this.app.graphicsDevice.width*this.renderTargetScale),r=Math.floor(t.w*this.app.graphicsDevice.height*this.renderTargetScale),s=this.app.graphicsDevice,a=e.colorBuffer.format;e._colorBuffer.destroy();var o=new n.Texture(s,{format:a,width:i,height:r});o.minFilter=n.FILTER_NEAREST,o.magFilter=n.FILTER_NEAREST,o.addressU=n.ADDRESS_CLAMP_TO_EDGE,o.addressV=n.ADDRESS_CLAMP_TO_EDGE,e._colorBuffer=o,e.destroy()},setRenderTargetScale:function(e){this.renderTargetScale=e,this.resizeRenderTargets()},addEffect:function(e){var t=0===this.effects.length,i=this.effects,r={effect:e,inputTarget:this._createOffscreenTarget(t,e.hdr),outputTarget:null};if(!this.layer){this.layer=new n.Layer({opaqueSortMode:n.SORTMODE_NONE,transparentSortMode:n.SORTMODE_NONE,passThrough:!0,name:"PostEffectQueue",renderTarget:this.camera.renderTarget,clear:!1,onPostRender:function(){for(var e=0;e<this._commandList.length;e++)this._commandList[e]()}});var s,a=this.app.scene.layers.layerList,o=0,h=a.length-1;for(s=h;s>=0;s--)if(a[s].id===n.LAYERID_UI){h=s-1,a[s].overrideClear=!0,a[s].clearColorBuffer=!1,a[s].clearDepthBuffer=this.camera.clearDepthBuffer,a[s].clearStencilBuffer=this.camera.clearStencilBuffer;break}for(s=h;s>=0;s--)a[s].cameras.indexOf(this.camera)>=0&&(0===o&&(o=s+1),a[s].renderTarget=r.inputTarget);this.app.scene.layers.insertOpaque(this.layer,o),this.layer._commandList=[],this.layer.isPostEffect=!0}i.push(r);var l=i.length;l>1&&(i[l-2].outputTarget=r.inputTarget),this.enable()},removeEffect:function(e){for(var t=-1,i=0,n=this.effects.length;i<n;i++)if(this.effects[i].effect===e){t=i;break}t>=0&&(t>0?this.effects[t-1].outputTarget=t+1<this.effects.length?this.effects[t+1].inputTarget:null:this.effects.length>1&&(this.effects[1].inputTarget._depth||(this.effects[1].inputTarget.destroy(),this.effects[1].inputTarget=this._createOffscreenTarget(!0,this.effects[1].hdr)),this.camera.renderTarget=this.effects[1].inputTarget),this.effects[t].inputTarget.destroy(),this.effects.splice(t,1)),this.enabled&&e.needsDepthBuffer&&this.camera.releaseDepthMap(),0===this.effects.length&&this.disable()},requestDepthMap:function(){for(var e=0,t=this.effects.length;e<t;e++){var i=this.effects[e].effect;i.needsDepthBuffer&&this.camera.camera.requestDepthMap()}},releaseDepthMap:function(){for(var e=0,t=this.effects.length;e<t;e++){var i=this.effects[e].effect;i.needsDepthBuffer&&this.camera.releaseDepthMap()}},destroy:function(){for(var e=0,t=this.effects.length;e<t;e++)this.effects[e].inputTarget.destroy();this.effects.length=0,this.disable()},enable:function(){if(!this.enabled&&this.effects.length){this.enabled=!0;var e=this;this.requestDepthMap(),this.app.graphicsDevice.on("resizecanvas",this._onCanvasResized,this),this.command=function(){if(e.enabled){var t=null,i=e.effects.length;if(i){e.layer.renderTarget=e.effects[0].inputTarget;for(var n=0;n<i;n++){var r=e.effects[n];n===i-1&&(t=e.camera.rect),r.effect.render(r.inputTarget,r.outputTarget,t)}}}},this.layer._commandList.push(this.command)}},disable:function(){if(this.enabled){this.enabled=!1,this.app.graphicsDevice.off("resizecanvas",this._onCanvasResized,this),this.camera.renderTarget=null,this.releaseDepthMap();var e=this.layer._commandList.indexOf(this.command);e>=0&&this.layer._commandList.splice(e,1)}},_onCanvasResized:function(e,t){var i=this.camera.rect,r=this.app.graphicsDevice;this.camera.camera.aspectRatio=r.width*i.z/(r.height*i.w),this.resizeTimeout||(n.now()-this.resizeLast>100?this.resizeRenderTargets():this.resizeTimeout=setTimeout(this._resizeTimeoutCallback,100))},resizeRenderTargets:function(){this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.resizeLast=n.now();for(var e=this.camera.rect,t=Math.floor(e.z*this.app.graphicsDevice.width*this.renderTargetScale),i=Math.floor(e.w*this.app.graphicsDevice.height*this.renderTargetScale),r=this.effects,s=0,a=r.length;s<a;s++){var o=r[s];o.inputTarget.width===t&&o.inputTarget.height===i||this._resizeOffscreenTarget(o.inputTarget)}},onCameraRectChanged:function(e,t,i){this.enabled&&this.resizeRenderTargets()}}),{PostEffectQueue:e}}()),Object.assign(n,function(){function e(e,c){this.app=e,this.srcRenderTarget=c.srcRenderTarget,this.hdr=c.hdr,this.blending=c.blending,this.shader=c.shader,this.setup=c.setup;var d=this,u=e.graphicsDevice;if(this.layer=new n.Layer({opaqueSortMode:n.SORTMODE_NONE,transparentSortMode:n.SORTMODE_NONE,passThrough:!0,name:c.name,onPostRender:function(){if(d.srcRenderTarget?(s.x=d.srcRenderTarget.width,s.y=d.srcRenderTarget.height,s.z=1/d.srcRenderTarget.width,s.w=1/d.srcRenderTarget.height):(s.x=u.width,s.y=u.height,s.z=1/u.width,s.w=1/u.height),t.setValue(s.data),this._postEffectCombined&&this._postEffectCombined<0)return void(d.setup&&d.setup(u,d,s,null,this.renderTarget));var a;a=this._postEffectCombinedSrc?this._postEffectCombinedSrc:d.srcRenderTarget?d.srcRenderTarget:i[this._backbufferRtId],a._samples>1&&a.resolve(!0,!1);var o=a._colorBuffer;o.magFilter=(this._postEffectCombinedShader?this._postEffectCombinedBilinear:this.postEffectBilinear)?n.FILTER_LINEAR:n.FILTER_NEAREST,r.setValue(o),d.setup&&d.setup(u,d,s,a,this.renderTarget);var h=this._postEffectCombinedShader?this._postEffectCombinedShader:this.shader;if(h&&n.drawQuadWithShader(u,this.renderTarget,h,null,null,d.blending),!d.srcRenderTarget)for(var l=e.scene.layers.layerList,c=0;c<l.length&&l[c]!==d.layer;c++)l[c].renderTarget!==i[0]&&l[c].renderTarget!==i[1]||(l[c].renderTarget=null)}}),this.layer._generateCameraHash(),this.layer.isPostEffect=!0,this.layer.unmodifiedUvs=c.unmodifiedUvs,this.layer.postEffectBilinear=c.bilinear,this.layer.postEffect=this,this.layer.shader=c.shader,this.layer.renderTarget=c.destRenderTarget,!r){r=u.scope.resolve("uColorBuffer"),t=u.scope.resolve("uScreenSize");for(var f=u.supportsMsaa?4:1,p=0;p<2;p++)i[p]=new n.RenderTarget({depth:!0,stencil:u.supportsStencil,samples:f,autoResolve:!1}),i[p].name="backbuffer"+p;e.on("prerender",function(){var t,r,s=e.scene.layers.layerList,c=0,d=0;o=!1,h=!1,l=!1;var f=n.PIXELFORMAT_R8_G8_B8_A8;if(e.scene.layers._dirty){var p,_,m=0,M=!1;for(t=0;t<s.length;t++)if(M=!1,s[t].isPostEffect&&(0===m||s[t].unmodifiedUvs&&s[t].shader&&!P(s,a,m,s[t].shader))?(a[m]=t,m++,t===s.length-1&&(M=!0)):m>0&&(M=!0),M){if(m>1){var R,x="post_";for(r=0;r<m;r++)R=s[a[r]],x+=R.name?R.name:R.id,r<m-1&&(x+="_");var O=u.programLib._cache[x];if(!O){var k,D="vec4 shaderOutput;\n",L="void main() {\n",N=[];for(r=0;r<m;r++){if(k=s[a[r]].shader.definition.fshader+"\n",k=k.replace(A,"//").replace(v,"//").replace(y,"//").replace(g,"shaderOutput"),r>0&&(k=k.replace(b,"//").replace(E,"//").replace(T,"shaderOutput;//")),k=k.replace(S,"void main"+r),p=I(k,N))for(_=0;_<p.length;_++)k=k.replace(new RegExp("\\b"+p[_]+"\\b","g"),p[_]+"NNNN"+r);D+=k,L+="main"+r+"();\n"}L+="gl_FragColor = shaderOutput;\n}\n",O=n.shaderChunks.createShaderFromCode(u,n.shaderChunks.fullscreenQuadVS,D+L,x)}for(r=0;r<m;r++)s[a[r]]._postEffectCombined=r===m-1?1:-1;s[a[m-1]]._postEffectCombinedShader=O,s[a[m-1]]._postEffectCombinedBilinear=s[a[0]].postEffectBilinear,s[a[m-1]]._postEffectCombinedSrc=s[a[0]].postEffect.srcRenderTarget}a[0]=t,m=1}}for(t=0;t<s.length;t++){if(s[t].isPostEffect&&(!s[t].postEffect.srcRenderTarget&&!s[t]._postEffectCombined||!s[t].postEffect._postEffectCombinedSrc&&s[t]._postEffectCombined>=0)){for(r=t-1;r>=c;r--)s[r].renderTarget||(s[r].renderTarget=i[d]);s[t]._backbufferRtId=d,c=t,o=!0,1===d&&(h=!0),s[t].postEffect.hdr&&(f=u.webgl2&&u.extTextureFloatRenderable?n.PIXELFORMAT_111110F:u.extTextureHalfFloatLinear&&u.extTextureHalfFloatRenderable?n.PIXELFORMAT_RGBA16F:n.PIXELFORMAT_R8_G8_B8_A8),s[t].postEffect.shader&&!s[t].renderTarget&&(d=1-d)}else s[t].isPostEffect||s[t].renderTarget||!o||(s[t].renderTarget=i[d]);s[t].isPostEffect&&!s[t].renderTarget&&(l=!0)}o&&(i[0].colorBuffer?i[0].width===u.width&&i[0].height===u.height&&i[0]._colorBuffer._format===f||(C(0),w(0,u,f)):w(0,u,f)),h&&(i[1].colorBuffer?i[1].width===u.width&&i[1].height===u.height&&i[1]._colorBuffer._format===f||(C(1),w(1,u,f)):w(1,u,f))},this),e.on("postrender",function(){var t=e.graphicsDevice;if(o&&!l){for(var n,r=e.scene.layers.layerList,s=r.length-1;s>=0&&(n=r[s].renderTarget,n!==i[0]&&n!==i[1]);s--);n&&(n._samples>1&&n.resolve(!0,!1),t.copyRenderTarget(n,null,!0,!1))}},this)}}var t,i=[null,null],r=null,s=new n.Vec4,a=[],o=!1,h=!1,l=!1,c=/uniform[ \t\n\r]+\S+[ \t\n\r]+\S+[ \t\n\r]*\;/g,d=/\S+[ \t\n\r]*\;/,u=/[ \t\n\r]*\;/,f=/(float|int|bool|vec2|vec3|vec4|struct)([ \t\n\r]+[^\;]+[ \t\n\r]*\,*)+\;/g,p=/(float|int|bool|vec2|vec3|vec4|struct|\,|\;|\{|\})/g,_=/(uniform|varying|in|out)[ \t\n\r]+(float|int|bool|vec2|vec3|vec4|struct)([ \t\n\r]+[^\;]+[ \t\n\r]*\,*)+\;/g,m=/(float|int|bool|vec2|vec3|vec4|struct|uniform|varying|in|out|\,|\;|\{|\})/g,A=/#version/g,v=/out highp vec4 pc_fragColor;/g,y=/#define gl_FragColor/g,g=/gl_FragColor/g,b=/uniform[ \t\n\r]+sampler2D[ \t\n\r]+uColorBuffer;/g,E=/(varying|in)[ \t\n\r]+vec2[ \t\n\r]+vUv0;/g,T=/(texture2D|texture)[ \t\n\r]*\([ \t\n\r]*uColorBuffer/g,S=/void[ \t\n\r]+main/g,w=function(e,t,r){var s=new n.Texture(t,{format:r,width:t.width,height:t.height});s.minFilter=n.FILTER_NEAREST,s.magFilter=n.FILTER_NEAREST,s.addressU=n.ADDRESS_CLAMP_TO_EDGE,s.addressV=n.ADDRESS_CLAMP_TO_EDGE,i[e]._colorBuffer=s},C=function(e){i[e].colorBuffer.destroy(),i[e].destroy()},M=function(e){for(var t,i,n,r=e.match(c)||[],s=[],a=0;a<r.length;a++)t=r[a].search(d),i=r[a].search(u),n=r[a].substr(t,i-t),"uColorBuffer"!==n&&s.push(n);return s},P=function(e,t,i,n){var r=M(n.definition.fshader);if(0===r.length)return!1;var s,a,o,h,l;for(s=0;s<i;s++)for(a=0;a<r.length;a++)for(l=r[a],h=M(e[t[s]].shader.definition.fshader),o=0;o<h.length;o++)if(h[o]===l)return!0;return!1},I=function(e,t){var i,n,r,s=e.length,a=0,o=0,h=0,l=0,c="";for(n=0;n<s;n++)i=e.charAt(n),"{"===i?(0===h&&(a=n),h++):"}"===i&&(1===h&&(o=n,c+=e.substr(l,a-l+1),l=o),h--);c+=e.substr(l,e.length-l+1);var d,u,A=null,v=c.match(f)||[];for(n=0;n<v.length;n++)for(d=v[n].split(","),r=0;r<d.length;r++)u=d[r].replace(p,"").trim(),t.indexOf(u)>=0?(A||(A=[]),A.push(u)):t.push(u);var y,g=c.match(_)||[];for(n=0;n<g.length;n++)for(d=g[n].split(","),r=0;r<d.length;r++)u=d[r].replace(m,"").trim(),y=t.indexOf(u),y>=0&&t.splice(y,1);return A};return e.prototype.addToComposition=function(e){this.app.scene.layers.insertTransparent(this.layer,e)},{PostEffectPass:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this._cookieAsset=null,this._cookieAssetId=null,this._cookieAssetAdd=!1,this._cookieMatrix=null};e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e;var t=[],i=[],r=function(n,r,s,a){var o=e.prototype;t.push(n),i.push(r),Object.defineProperty(o,n,{get:function(){return this.data[n]},set:function(e){var t=this.data,i=t[n];(a||i!==e)&&(t[n]=e,s&&s.call(this,e,i))},configurable:!0})},s=function(){r("enabled",!0,function(e,t){this.onSetEnabled(null,t,e)}),r("light",null),r("type","directional",function(e,t){this.system.changeType(this,t,e),this.refreshProperties()}),r("color",new n.Color(1,1,1),function(e,t){this.light.setColor(e)},!0),r("intensity",1,function(e,t){this.light.intensity=e}),r("castShadows",!1,function(e,t){this.light.castShadows=e}),r("shadowDistance",40,function(e,t){this.light.shadowDistance=e}),r("shadowResolution",1024,function(e,t){this.light.shadowResolution=e}),r("shadowBias",.05,function(e,t){this.light.shadowBias=-.01*e}),r("normalOffsetBias",0,function(e,t){this.light.normalOffsetBias=e}),r("range",10,function(e,t){this.light.attenuationEnd=e}),r("innerConeAngle",40,function(e,t){this.light.innerConeAngle=e}),r("outerConeAngle",45,function(e,t){this.light.outerConeAngle=e}),r("falloffMode",n.LIGHTFALLOFF_LINEAR,function(e,t){this.light.falloffMode=e}),r("shadowType",n.SHADOW_PCF3,function(e,t){this.light.shadowType=e}),r("vsmBlurSize",11,function(e,t){this.light.vsmBlurSize=e}),r("vsmBlurMode",n.BLUR_GAUSSIAN,function(e,t){this.light.vsmBlurMode=e}),r("vsmBias",.0025,function(e,t){this.light.vsmBias=e}),r("cookieAsset",null,function(e,t){if(!this._cookieAssetId||!(e instanceof n.Asset&&e.id===this._cookieAssetId||e===this._cookieAssetId))if(this.onCookieAssetRemove(),this._cookieAssetId=null,e instanceof n.Asset)this.data.cookieAsset=e.id,this._cookieAssetId=e.id,this.onCookieAssetAdd(e);else if("number"==typeof e){this._cookieAssetId=e;var i=this.system.app.assets.get(e);i?this.onCookieAssetAdd(i):(this._cookieAssetAdd=!0,this.system.app.assets.on("add:"+this._cookieAssetId,this.onCookieAssetAdd,this))}}),r("cookie",null,function(e,t){this.light.cookie=e}),r("cookieIntensity",1,function(e,t){this.light.cookieIntensity=e}),r("cookieFalloff",!0,function(e,t){this.light.cookieFalloff=e}),r("cookieChannel","rgb",function(e,t){this.light.cookieChannel=e}),r("cookieAngle",0,function(e,t){if(0!==e||null!==this.cookieScale){this._cookieMatrix||(this._cookieMatrix=new n.Vec4);var i=1,r=1;this.cookieScale&&(i=this.cookieScale.x,r=this.cookieScale.y);var s=Math.cos(e*n.math.DEG_TO_RAD),a=Math.sin(e*n.math.DEG_TO_RAD);this._cookieMatrix.set(s/i,-a/i,a/r,s/r),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null}),r("cookieScale",null,function(e,t){if(null!==e||0!==this.cookieAngle){this._cookieMatrix||(this._cookieMatrix=new n.Vec4);var i=e.x,r=e.y,s=Math.cos(this.cookieAngle*n.math.DEG_TO_RAD),a=Math.sin(this.cookieAngle*n.math.DEG_TO_RAD);this._cookieMatrix.set(s/i,-a/i,a/r,s/r),this.light.cookieTransform=this._cookieMatrix}else this.light.cookieTransform=null},!0),r("cookieOffset",null,function(e,t){this.light.cookieOffset=e},!0),r("shadowUpdateMode",n.SHADOWUPDATE_REALTIME,function(e,t){this.light.shadowUpdateMode=e}),r("mask",1,function(e,t){this.light.mask=e}),r("affectDynamic",!0,function(e,t){e?this.light.mask|=n.MASK_DYNAMIC:this.light.mask&=~n.MASK_DYNAMIC,this.light.mask=this.light._mask}),r("affectLightmapped",!1,function(e,t){e?(this.light.mask|=n.MASK_BAKED,this.bake&&(this.light.mask&=~n.MASK_LIGHTMAP)):(this.light.mask&=~n.MASK_BAKED,this.bake&&(this.light.mask|=n.MASK_LIGHTMAP)),this.light.mask=this.light._mask}),r("bake",!1,function(e,t){e?(this.light.mask|=n.MASK_LIGHTMAP,this.affectLightmapped&&(this.light.mask&=~n.MASK_BAKED)):(this.light.mask&=~n.MASK_LIGHTMAP,this.affectLightmapped&&(this.light.mask|=n.MASK_BAKED)),this.light.mask=this.light._mask}),r("bakeDir",!0,function(e,t){this.light.bakeDir=e}),r("isStatic",!1,function(e,t){this.light.isStatic=e}),r("layers",[n.LAYERID_WORLD],function(e,t){var i,n;for(i=0;i<t.length;i++)n=this.system.app.scene.layers.getLayerById(t[i]),n&&n.removeLight(this);for(i=0;i<e.length;i++)n=this.system.app.scene.layers.getLayerById(e[i]),n&&this.enabled&&this.entity.enabled&&n.addLight(this)})};return s(),Object.defineProperty(e.prototype,"enable",{get:function(){return console.warn("WARNING: enable: Property is deprecated. Query enabled property instead."),this.enabled},set:function(e){console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),this.enabled=e}}),Object.assign(e.prototype,{addLightToLayers:function(){for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&e.addLight(this)},removeLightFromLayers:function(){for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&e.removeLight(this)},onLayersChanged:function(e,t){this.enabled&&this.entity.enabled&&this.addLightToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)},onLayerAdded:function(e){var t=this.layers.indexOf(e.id);t<0||this.enabled&&this.entity.enabled&&e.addLight(this)},onLayerRemoved:function(e){var t=this.layers.indexOf(e.id);t<0||e.removeLight(this)},refreshProperties:function(){for(var e,i=0;i<t.length;i++)e=t[i],this[e]=this[e];this.enabled&&this.entity.enabled&&this.onEnable()},updateShadow:function(){this.light.updateShadow()},onCookieAssetSet:function(){var e=!1;"cubemap"!==this._cookieAsset.type||this._cookieAsset.loadFaces||(this._cookieAsset.loadFaces=!0,e=!0),this._cookieAsset.resource&&!e||this.system.app.assets.load(this._cookieAsset),this._cookieAsset.resource&&this.onCookieAssetLoad()},onCookieAssetAdd:function(e){this._cookieAssetId===e.id&&(this._cookieAsset=e,this.light._enabled&&this.onCookieAssetSet(),this._cookieAsset.on("load",this.onCookieAssetLoad,this),this._cookieAsset.on("remove",this.onCookieAssetRemove,this))},onCookieAssetLoad:function(){this._cookieAsset&&this._cookieAsset.resource&&(this.cookie=this._cookieAsset.resource)},onCookieAssetRemove:function(){this._cookieAssetId&&(this._cookieAssetAdd&&(this.system.app.assets.off("add:"+this._cookieAssetId,this.onCookieAssetAdd,this),this._cookieAssetAdd=!1),this._cookieAsset&&(this._cookieAsset.off("load",this.onCookieAssetLoad,this),this._cookieAsset.off("remove",this.onCookieAssetRemove,this),this._cookieAsset=null),this.cookie=null)},onEnable:function(){n.Component.prototype.onEnable.call(this),this.light.enabled=!0,this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&this.addLightToLayers(),this._cookieAsset&&!this.cookie&&this.onCookieAssetSet()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.light.enabled=!1,this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.removeLightFromLayers()}}),{LightComponent:e,_lightProps:t,_lightPropsDefault:i}}()),Object.assign(n,function(){var e={directional:n.LIGHTTYPE_DIRECTIONAL,point:n.LIGHTTYPE_POINT,spot:n.LIGHTTYPE_SPOT},t=function(e){n.ComponentSystem.call(this,e),this.id="light",this.description="Enables the Entity to emit light.",e.systems.add(this.id,this),this.ComponentType=n.LightComponent,this.DataType=n.LightComponentData};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,
Object.assign(t.prototype,{initializeComponentData:function(t,i){for(var r,s={},a=n._lightProps,o=0;o<a.length;o++)r=a[o],s[r]=i[r];s.type||(s.type=t.data.type),t.data.type=s.type,s.layers&&"array"===n.type(s.layers)&&(s.layers=s.layers.slice(0)),s.color&&"array"===n.type(s.color)&&(s.color=new n.Color(s.color[0],s.color[1],s.color[2])),s.cookieOffset&&s.cookieOffset instanceof Array&&(s.cookieOffset=new n.Vec2(s.cookieOffset[0],s.cookieOffset[1])),s.cookieScale&&s.cookieScale instanceof Array&&(s.cookieScale=new n.Vec2(s.cookieScale[0],s.cookieScale[1])),s.enable&&(console.warn("WARNING: enable: Property is deprecated. Set enabled property instead."),s.enabled=s.enable);var h=new n.Light;h.type=e[s.type],h._node=t.entity,h._scene=this.app.scene,t.data.light=h,n.ComponentSystem.prototype.initializeComponentData.call(this,t,s,a)},removeComponent:function(e){var t=e.light.data;t.light.destroy(),n.ComponentSystem.prototype.removeComponent.call(this,e)},cloneComponent:function(e,t){for(var i,r=e.light,s=[],a=n._lightProps,o=0;o<a.length;o++)i=a[o],"light"!==i&&(r[i]&&r[i].clone?s[i]=r[i].clone():s[i]=r[i]);this.addComponent(t,s)},changeType:function(t,i,n){i!==n&&(t.light.type=e[n])}}),{LightComponentSystem:t}}()),Object.assign(n,function(){var e=function(){for(var e,t=n._lightProps,i=n._lightPropsDefault,r=0;r<t.length;r++)e=i[r],e&&e.clone?this[t[r]]=e.clone():this[t[r]]=e};return{LightComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this._scripts=[],this._scriptsIndex={},this._destroyedScripts=[],this._destroyed=!1,this._scriptsData=null,this._oldState=!0,this._beingEnabled=!1,this._isLoopingThroughScripts=!1,this.on("set_enabled",this._onSetEnabled,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,e.scriptMethods={initialize:"initialize",postInitialize:"postInitialize",update:"update",postUpdate:"postUpdate",swap:"swap"},Object.assign(e.prototype,{onEnable:function(){n.Component.prototype.onEnable.call(this),this._beingEnabled=!0,this._checkState(),this.entity._beingEnabled||this.onPostStateChange(),this._beingEnabled=!1},onDisable:function(){n.Component.prototype.onDisable.call(this),this._checkState()},onPostStateChange:function(){for(var t,i=this._beginLooping(),n=0,r=this.scripts.length;n<r;n++)t=this.scripts[n],t._initialized&&!t._postInitialized&&t.enabled&&(t._postInitialized=!0,t.postInitialize&&this._scriptMethod(t,e.scriptMethods.postInitialize));this._endLooping(i)},_beginLooping:function(){var e=this._isLoopingThroughScripts;return this._isLoopingThroughScripts=!0,e},_endLooping:function(e){this._isLoopingThroughScripts=e,this._isLoopingThroughScripts||this._removeDestroyedScripts()},_onSetEnabled:function(e,t,i){this._beingEnabled=!0,this._checkState(),this._beingEnabled=!1},_checkState:function(){var e=this.enabled&&this.entity.enabled;if(e!==this._oldState){this._oldState=e,this.fire(e?"enable":"disable"),this.fire("state",e);for(var t,i=this._beginLooping(),n=0,r=this.scripts.length;n<r;n++)t=this.scripts[n],t.enabled=t._enabled;this._endLooping(i)}},_onBeforeRemove:function(){this.fire("remove");for(var e=this._beginLooping(),t=0;t<this.scripts.length;t++){var i=this.scripts[t];i&&this.destroy(i.__scriptType.__name)}this._endLooping(e)},_removeDestroyedScripts:function(){var e=this._destroyedScripts.length;if(e){for(var t=0;t<e;t++){var i=this._scripts.indexOf(this._destroyedScripts[t]);i>=0&&this._scripts.splice(i,1)}this._destroyedScripts.length=0}},_onInitializeAttributes:function(){for(var e=0,t=this.scripts.length;e<t;e++)this.scripts[e].__initializeAttributes()},_scriptMethod:function(e,t,i){try{e[t](i)}catch(n){e.enabled=!1,e._callbacks&&e._callbacks.error||(console.warn('unhandled exception while calling "'+t+'" for "'+e.__scriptType.__name+'" script: ',n),console.error(n)),e.fire("error",n,t),this.fire("error",e,n,t)}},_onInitialize:function(){for(var t,i=this._scripts,n=this._beginLooping(),r=0,s=i.length;r<s;r++)t=i[r],!t._initialized&&t.enabled&&(t._initialized=!0,t.initialize&&this._scriptMethod(t,e.scriptMethods.initialize));this._endLooping(n)},_onPostInitialize:function(){this.onPostStateChange()},_onUpdate:function(t){for(var i,n=this._scripts,r=this._beginLooping(),s=0,a=n.length;s<a;s++)i=n[s],i.update&&i.enabled&&this._scriptMethod(i,e.scriptMethods.update,t);this._endLooping(r)},_onPostUpdate:function(t){var i,n,r,s=this._beginLooping(),a=this._scripts;for(i=0,n=a.length;i<n;i++)r=a[i],r.postUpdate&&r.enabled&&this._scriptMethod(r,e.scriptMethods.postUpdate,t);this._endLooping(s)},has:function(e){var t=e;return"string"==typeof t&&(t=this.system.app.scripts.get(t)),!!this._scriptsIndex[t.__name]},create:function(t,i){var n=this;i=i||{};var r=t,s=t;if("string"==typeof r?r=this.system.app.scripts.get(r):r&&(s=r.__name),r){if(!this._scriptsIndex[r.__name]||!this._scriptsIndex[r.__name].instance){var a=new r({app:this.system.app,entity:this.entity,enabled:!i.hasOwnProperty("enabled")||i.enabled,attributes:i.attributes||null}),o=-1;return"number"==typeof i.ind&&i.ind!==-1&&this._scripts.length>i.ind&&(o=i.ind),o===-1?this._scripts.push(a):this._scripts.splice(o,0,a),this._scriptsIndex[r.__name]={instance:a,onSwap:function(){n.swap(r.__name)}},this[r.__name]=a,i.preloading||a.__initializeAttributes(),this.fire("create",r.__name,a),this.fire("create:"+r.__name,a),this.system.app.scripts.on("swap:"+r.__name,this._scriptsIndex[r.__name].onSwap),i.preloading||(a.enabled&&!a._initialized&&(a._initialized=!0,a.initialize&&this._scriptMethod(a,e.scriptMethods.initialize)),a.enabled&&!a._postInitialized&&(a._postInitialized=!0,a.postInitialize&&this._scriptMethod(a,e.scriptMethods.postInitialize))),a}console.warn("script '"+s+"' is already added to entity '"+this.entity.name+"'")}else this._scriptsIndex[s]={awaiting:!0,ind:this._scripts.length},console.warn("script '"+s+"' is not found, awaiting it to be added to registry");return null},destroy:function(e){var t=e,i=e;"string"==typeof i&&(i=this.system.app.scripts.get(i),i&&(t=i.__name));var n=this._scriptsIndex[t];if(delete this._scriptsIndex[t],!n)return!1;if(n.instance&&!n.instance._destroyed)if(n.instance.enabled=!1,n.instance._destroyed=!0,this._isLoopingThroughScripts)this._destroyedScripts.push(n.instance);else{var r=this._scripts.indexOf(n.instance);this._scripts.splice(r,1)}return this.system.app.scripts.off("swap:"+t,n.onSwap),delete this[t],this.fire("destroy",t,n.instance||null),this.fire("destroy:"+t,n.instance||null),n.instance&&n.instance.fire("destroy"),!0},swap:function(t){var i=t;"string"==typeof i&&(i=this.system.app.scripts.get(i));var n=this._scriptsIndex[i.__name];if(!n||!n.instance)return!1;var r=n.instance,s=this._scripts.indexOf(r),a=new i({app:this.system.app,entity:this.entity,enabled:r.enabled,attributes:r.__attributes});return!!a.swap&&(a.__initializeAttributes(),this._scripts[s]=a,this._scriptsIndex[i.__name].instance=a,this[i.__name]=a,this._scriptMethod(a,e.scriptMethods.swap,r),this.fire("swap",i.__name,a),this.fire("swap:"+i.__name,a),!0)},move:function(e,t){if(t>=this._scripts.length)return!1;var i=e;"string"!=typeof i&&(i=e.__name);var n=this._scriptsIndex[i];if(!n||!n.instance)return!1;var r=this._scripts.indexOf(n.instance);return r!==-1&&r!==t&&(this._scripts.splice(t,0,this._scripts.splice(r,1)[0]),this.fire("move",i,n.instance,t,r),this.fire("move:"+i,n.instance,t,r),!0)}}),Object.defineProperty(e.prototype,"scripts",{get:function(){return this._scripts},set:function(e){this._scriptsData=e;for(var t in e)if(e.hasOwnProperty(t)){var i=this._scriptsIndex[t];if(i){if("boolean"==typeof e[t].enabled&&(i.enabled=!!e[t].enabled),"object"==typeof e[t].attributes)for(var r in e[t].attributes)if(!n.createScript.reservedAttributes[r]){if(!i.__attributes.hasOwnProperty(r)){var s=this.system.app.scripts.get(t);s&&s.attributes.add(r,{})}i[r]=e[t].attributes[r]}}else console.log(this.order)}}}),{ScriptComponent:e}}()),Object.assign(n,function(){var e=["enabled"],t=function(t){n.ComponentSystem.call(this,t),this.id="script",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ScriptComponent,this.DataType=n.ScriptComponentData,this.schema=e,this._components=[],this._destroyedComponents=[],this._isLoopingThroughComponents=!1,this.preloading=!0,this.on("beforeremove",this._onBeforeRemove,this),n.ComponentSystem.on("initialize",this._onInitialize,this),n.ComponentSystem.on("postInitialize",this._onPostInitialize,this),n.ComponentSystem.on("update",this._onUpdate,this),n.ComponentSystem.on("postUpdate",this._onPostUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ScriptComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){if(this._components.push(e),e.enabled=!t.hasOwnProperty("enabled")||!!t.enabled,t.hasOwnProperty("order")&&t.hasOwnProperty("scripts")){e._scriptsData=t.scripts;for(var n=0;n<t.order.length;n++)e.create(t.order[n],{enabled:t.scripts[t.order[n]].enabled,attributes:t.scripts[t.order[n]].attributes,preloading:this.preloading})}},cloneComponent:function(e,t){var i,n,r=[],s={};for(i=0;i<e.script._scripts.length;i++){var a=e.script._scripts[i],o=a.__scriptType.__name;r.push(o);var h={};for(n in a.__attributes)h[n]=a.__attributes[n];s[o]={enabled:a._enabled,attributes:h}}for(n in e.script._scriptsIndex)n.awayting&&r.splice(n.ind,0,n);var l={enabled:e.script.enabled,order:r,scripts:s};return this.addComponent(t,l)},_callComponentMethod:function(e,t){for(var i=this._beginLooping(),n=0;n<this._components.length;n++)!this._components[n]._destroyed&&this._components[n].entity.enabled&&this._components[n].enabled&&this._components[n][e](t);this._endLooping(i)},_beginLooping:function(){var e=this._isLoopingThroughComponents;return this._isLoopingThroughComponents=!0,e},_endLooping:function(e){if(this._isLoopingThroughComponents=e,!this._isLoopingThroughComponents){var t=this._destroyedComponents.length;if(t){for(var i=0;i<t;i++){var n=this._components.indexOf(this._destroyedComponents[i]);n>=0&&this._components.splice(n,1)}this._destroyedComponents.length=0}}},_onInitialize:function(){this.preloading=!1;for(var e=0;e<this._components.length;e++)this._components[e]._onInitializeAttributes();this._callComponentMethod("_onInitialize")},_onPostInitialize:function(){this._callComponentMethod("_onPostInitialize")},_onUpdate:function(e){this._callComponentMethod("_onUpdate",e)},_onPostUpdate:function(e){this._callComponentMethod("_onPostUpdate",e)},_onBeforeRemove:function(e,t){var i=this._components.indexOf(t);i!==-1&&(t._onBeforeRemove(),this._isLoopingThroughComponents?(t._destroyed=!0,this._destroyedComponents.push(t)):this._components.splice(i,1))}}),{ScriptComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ScriptComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_scripts",this.onSetScripts,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{send:function(e,t){console.warn("DEPRECATED: ScriptLegacyComponent.send() is deprecated and will be removed soon. Please use: http://developer.playcanvas.com/user-manual/scripting/communication/");var i,r=n.makeArray(arguments).slice(2),s=this.entity.script.instances;if(s&&s[e]&&(i=s[e].instance[t]))return i.apply(s[e].instance,r)},onEnable:function(){n.Component.prototype.onEnable.call(this),this.data.areScriptsLoaded&&!this.system.preloading&&(this.data.initialized?this.system._enableScriptComponent(this):this.system._initializeScriptComponent(this),this.data.postInitialized||this.system._postInitializeScriptComponent(this))},onDisable:function(){n.Component.prototype.onDisable.call(this),this.system._disableScriptComponent(this)},onSetScripts:function(e,t,i){if(!this.system._inTools||this.runInTools){if(this._updateScriptAttributes(t,i))return;this.enabled&&this.system._disableScriptComponent(this),this.system._destroyScriptComponent(this),this.data.areScriptsLoaded=!1;var n=i,r=n.map(function(e){return e.url});if(this._loadFromCache(r))return;this._loadScripts(r)}},_updateScriptAttributes:function(e,t){var i=!0;if(e.length!==t.length)i=!1;else{var n,r=t.length;for(n=0;n<r;n++)if(e[n].url!==t[n].url){i=!1;break}}if(i)for(var s in this.instances)this.instances.hasOwnProperty(s)&&this.system._updateAccessors(this.entity,this.instances[s]);return i},_loadFromCache:function(e){var t,i,r=[],s=this.system.app._scriptPrefix||"",a=/^http(s)?:\/\//i;for(t=0,i=e.length;t<i;t++){var o=e[t];a.test(o)||(o=n.path.join(s,o));var h=this.system.app.loader.getFromCache(o,"script");if(!h)return!1;r.push(h)}for(t=0,i=r.length;t<i;t++){var l=r[t];if(l!==!0&&l&&this.entity.script&&!this.entity.script.instances[l._pcScriptName]){var c=new l(this.entity);this.system._preRegisterInstance(this.entity,e[t],l._pcScriptName,c)}}return this.data&&(this.data.areScriptsLoaded=!0),this.system.preloading||(this.system.onInitialize(this.entity),this.system.onPostInitialize(this.entity)),!0},_loadScripts:function(e){var t=e.length,i=this.system.app._scriptPrefix||"";e.forEach(function(e){var r=null,s=null;e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")?(s=e,r=e):(s=e,r=n.path.join(i,e)),this.system.app.loader.load(r,"script",function(e,i){if(t--,e)console.error(e);else if(i&&this.entity.script&&!this.entity.script.instances[i._pcScriptName]){var n=new i(this.entity);this.system._preRegisterInstance(this.entity,s,i._pcScriptName,n)}0===t&&(this.data.areScriptsLoaded=!0,this.system.preloading||(this.system.onInitialize(this.entity),this.system.onPostInitialize(this.entity)))}.bind(this))}.bind(this))}}),{ScriptLegacyComponent:e}}()),Object.assign(n,function(){var e=["enabled","scripts","instances","runInTools"],t="initialize",i="postInitialize",r="update",s="postUpdate",a="fixedUpdate",o="toolsUpdate",h="onEnable",l="onDisable",c=function(h){n.ComponentSystem.call(this,h),this.id="script",this.description="Allows the Entity to run JavaScript fragments to implement custom behavior.",h.systems.add(this.id,this),this.ComponentType=n.ScriptLegacyComponent,this.DataType=n.ScriptLegacyComponentData,this.schema=e,this.preloading=!1,this.instancesWithUpdate=[],this.instancesWithFixedUpdate=[],this.instancesWithPostUpdate=[],this.instancesWithToolsUpdate=[],this.on("beforeremove",this.onBeforeRemove,this),n.ComponentSystem.on(t,this.onInitialize,this),n.ComponentSystem.on(i,this.onPostInitialize,this),n.ComponentSystem.on(r,this.onUpdate,this),n.ComponentSystem.on(a,this.onFixedUpdate,this),n.ComponentSystem.on(s,this.onPostUpdate,this),n.ComponentSystem.on(o,this.onToolsUpdate,this)};return c.prototype=Object.create(n.ComponentSystem.prototype),c.prototype.constructor=c,n.Component._buildAccessors(n.ScriptLegacyComponent.prototype,e),Object.assign(c.prototype,{initializeComponentData:function(e,t,i){i=["runInTools","enabled","scripts"],t.scripts&&t.scripts.length&&t.scripts.forEach(function(e){if(e.attributes&&"array"===n.type(e.attributes)){for(var t={},i=0;i<e.attributes.length;i++)t[e.attributes[i].name]=e.attributes[i];e.attributes=t}}),n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},cloneComponent:function(e,t){for(var i=this.dataStore[e._guid],r={runInTools:i.data.runInTools,scripts:[],enabled:i.data.enabled},s=i.data.scripts,a=0,o=s.length;a<o;a++){var h=s[a].attributes;h&&delete s[a].attributes,r.scripts.push(n.extend({},s[a])),h&&(r.scripts[a].attributes=this._cloneAttributes(h),s[a].attributes=h)}return this.addComponent(t,r)},onBeforeRemove:function(e,t){t.enabled&&this._disableScriptComponent(t),this._destroyScriptComponent(t)},onInitialize:function(e){if(this._registerInstances(e),e.enabled){e.script&&e.script.enabled&&this._initializeScriptComponent(e.script);var t,i=e._children,r=i.length;for(t=0;t<r;t++)i[t]instanceof n.Entity&&this.onInitialize(i[t])}},onPostInitialize:function(e){if(e.enabled){e.script&&e.script.enabled&&this._postInitializeScriptComponent(e.script);var t,i=e._children,r=i.length;for(t=0;t<r;t++)i[t]instanceof n.Entity&&this.onPostInitialize(i[t])}},_callInstancesMethod:function(e,t){var i=e.data.instances;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n].instance;r[t]&&r[t]()}},_initializeScriptComponent:function(e){this._callInstancesMethod(e,t),e.data.initialized=!0,e.enabled&&e.entity.enabled&&this._enableScriptComponent(e)},_enableScriptComponent:function(e){this._callInstancesMethod(e,h)},_disableScriptComponent:function(e){this._callInstancesMethod(e,l)},_destroyScriptComponent:function(e){var t,i=e.data.instances;for(var n in i)if(i.hasOwnProperty(n)){var r=i[n].instance;r.destroy&&r.destroy(),r.update&&(t=this.instancesWithUpdate.indexOf(r),t>=0&&this.instancesWithUpdate.splice(t,1)),r.fixedUpdate&&(t=this.instancesWithFixedUpdate.indexOf(r),t>=0&&this.instancesWithFixedUpdate.splice(t,1)),r.postUpdate&&(t=this.instancesWithPostUpdate.indexOf(r),t>=0&&this.instancesWithPostUpdate.splice(t,1)),r.toolsUpdate&&(t=this.instancesWithToolsUpdate.indexOf(r),t>=0&&this.instancesWithToolsUpdate.splice(t,1)),e.instances[n].instance===e[n]&&delete e[n],delete e.instances[n]}},_postInitializeScriptComponent:function(e){this._callInstancesMethod(e,i),e.data.postInitialized=!0},_updateInstances:function(e,t,i){for(var n,r=0,s=t.length;r<s;r++)n=t[r],n&&n.entity&&n.entity.enabled&&n.entity.script.enabled&&n[e](i)},onUpdate:function(e){this._updateInstances(r,this.instancesWithUpdate,e)},onFixedUpdate:function(e){this._updateInstances(a,this.instancesWithFixedUpdate,e)},onPostUpdate:function(e){this._updateInstances(s,this.instancesWithPostUpdate,e)},onToolsUpdate:function(e){this._updateInstances(o,this.instancesWithToolsUpdate,e)},broadcast:function(e,t){console.warn("DEPRECATED: ScriptLegacyComponentSystem.broadcast() is deprecated and will be removed soon. Please use: http://developer.playcanvas.com/user-manual/scripting/communication/");var i,r,s,a=n.makeArray(arguments).slice(2),o=this.store;for(i in o)o.hasOwnProperty(i)&&(r=o[i].data,r.instances[e]&&(s=r.instances[e].instance[t],s&&s.apply(r.instances[e].instance,a)))},_preRegisterInstance:function(e,t,i,r){if(e.script){if(e.script.data._instances=e.script.data._instances||{},e.script.data._instances[i])throw Error(n.string.format("Script name collision '{0}'. Scripts from '{1}' and '{2}' {{3}}",i,t,e.script.data._instances[i].url,e._guid));e.script.data._instances[i]={url:t,name:i,instance:r}}},_registerInstances:function(e){var t,i,r;if(e.script&&e.script.data._instances){e.script.instances=e.script.data._instances;for(r in e.script.instances){if(t=e.script.instances[r],i=t.instance,n.events.attach(i),i.update&&this.instancesWithUpdate.push(i),i.fixedUpdate&&this.instancesWithFixedUpdate.push(i),i.postUpdate&&this.instancesWithPostUpdate.push(i),i.toolsUpdate&&this.instancesWithToolsUpdate.push(i),e.script.scripts&&this._createAccessors(e,t),e.script[r])throw Error(n.string.format("Script with name '{0}' is already attached to Script Component",r));e.script[r]=i}delete e.script.data._instances}var s,a=e._children,o=a.length;for(s=0;s<o;s++)a[s]instanceof n.Entity&&this._registerInstances(a[s])},_cloneAttributes:function(e){var t={};for(var i in e)if(e.hasOwnProperty(i))if("entity"!==e[i].type)t[i]=n.extend({},e[i]);else{var r=e[i].value;delete e[i].value,t[i]=n.extend({},e[i]),t[i].value=r,e[i].value=r}return t},_createAccessors:function(e,t){var i,n=this,r=e.script.scripts.length,s=t.url;for(i=0;i<r;i++){var a=e.script.scripts[i];if(a.url===s){var o=a.attributes;if(a.name&&o){for(var h in o)o.hasOwnProperty(h)&&n._createAccessor(o[h],t);e.script.data.attributes[a.name]=n._cloneAttributes(o)}break}}},_createAccessor:function(e,t){var i=this;e={name:e.name,value:e.value,type:e.type},i._convertAttributeValue(e),Object.defineProperty(t.instance,e.name,{get:function(){return e.value},set:function(n){var r=e.value;e.value=n,i._convertAttributeValue(e),t.instance.fire("set",e.name,r,e.value)},configurable:!0})},_updateAccessors:function(e,t){var i,n,r,s,a,o,h,l,c=this,d=e.script.scripts.length,u=t.url;for(i=0;i<d;i++)if(r=e.script,s=r.scripts[i],s.url===u){if(a=s.name,o=s.attributes,a){if(o)for(n in o)o.hasOwnProperty(n)&&c._createAccessor(o[n],t);if(h=r.data.attributes[a])for(n in h)l=h[n],n in o?o[n].value!==l.value&&t.instance.onAttributeChanged&&t.instance.onAttributeChanged(l.name,l.value,o[n].value):delete t.instance[l.name];o?r.data.attributes[a]=c._cloneAttributes(o):delete r.data.attributes[a]}break}},_convertAttributeValue:function(e){if("rgb"===e.type||"rgba"===e.type)"array"===n.type(e.value)&&(e.value=3===e.value.length?new n.Color(e.value[0],e.value[1],e.value[2]):new n.Color(e.value[0],e.value[1],e.value[2],e.value[3]));else if("vec2"===e.type)"array"===n.type(e.value)&&(e.value=new n.Vec2(e.value[0],e.value[1]));else if("vec3"===e.type||"vector"===e.type)"array"===n.type(e.value)&&(e.value=new n.Vec3(e.value[0],e.value[1],e.value[2]));else if("vec4"===e.type)"array"===n.type(e.value)&&(e.value=new n.Vec4(e.value[0],e.value[1],e.value[2],e.value[3]));else if("entity"===e.type)null!==e.value&&"string"==typeof e.value&&(e.value=this.app.root.findByGuid(e.value));else if("curve"===e.type||"colorcurve"===e.type){var t=e.value.keys[0]instanceof Array?n.CurveSet:n.Curve;e.value=new t(e.value.keys),e.value.type=e.value.type}}}),{ScriptLegacyComponentSystem:c}}()),Object.assign(n,function(){var e=function(){this.scripts=[],this.enabled=!0,this.instances={},this._instances={},this.runInTools=!1,this.attributes={},this.initialized=!1,this.postInitialized=!1,this.areScriptsLoaded=!1};return{ScriptLegacyComponentData:e}}()),Object.assign(n,{DISTANCE_LINEAR:"linear",DISTANCE_INVERSE:"inverse",DISTANCE_EXPONENTIAL:"exponential"}),Object.assign(n,function(){var e={volume:0,pitch:0,loop:!1,startTime:0,duration:0,position:new n.Vec3,maxDistance:0,refDistance:0,rollOffFactor:0,distanceModel:0,onPlay:null,onPause:null,onResume:null,onStop:null,onEnd:null},t=function(e,t,i){i=i||{},this._component=e,this._assets=e.system.app.assets,this._manager=e.system.manager,this._name=t||"Untitled",this._volume=void 0!==i.volume?n.math.clamp(Number(i.volume)||0,0,1):1,this._pitch=void 0!==i.pitch?Math.max(.01,Number(i.pitch)||0):1,this._loop=!(void 0===i.loop||!i.loop),this._duration=i.duration>0?i.duration:null,this._startTime=Math.max(0,Number(i.startTime)||0),this._overlap=!!i.overlap,this._autoPlay=!!i.autoPlay,this._firstNode=null,this._lastNode=null,this._asset=i.asset,this._asset instanceof n.Asset&&(this._asset=this._asset.id),this._onInstancePlayHandler=this._onInstancePlay.bind(this),this._onInstancePauseHandler=this._onInstancePause.bind(this),this._onInstanceResumeHandler=this._onInstanceResume.bind(this),this._onInstanceStopHandler=this._onInstanceStop.bind(this),this._onInstanceEndHandler=this._onInstanceEnd.bind(this),this.instances=[],n.events.attach(this)};return Object.assign(t.prototype,{play:function(){this.overlap||!this.isPlaying&&!this.isPaused||this.stop();var e=this._createInstance();if(this.instances.push(e),this.isLoaded)e.play();else{var t=function(t){var i=e._playWhenLoaded;e.sound=t,i&&e.play()};this.off("load",t),this.once("load",t),this.load()}return e},pause:function(){for(var e=!1,t=this.instances,i=0,n=t.length;i<n;i++)t[i].pause()&&(e=!0);return e},resume:function(){for(var e=!1,t=this.instances,i=0,n=t.length;i<n;i++)t[i].resume()&&(e=!0);return e},stop:function(){for(var e=!1,t=this.instances,i=0,n=t.length;i<n;i++)t[i].stop()&&(e=!0);return t.length=0,e},load:function(){if(this._hasAsset()){var e=this._assets.get(this._asset);return e?(e.off("remove",this._onAssetRemoved,this),e.on("remove",this._onAssetRemoved,this),e.resource?void this.fire("load",e.resource):(e.off("load",this._onAssetLoad,this),e.once("load",this._onAssetLoad,this),void this._assets.load(e))):(this._assets.off("add:"+this._asset,this._onAssetAdd,this),void this._assets.once("add:"+this._asset,this._onAssetAdd,this))}},setExternalNodes:function(e,t){if(!e)return void console.error("The firstNode must have a valid AudioNode");if(t||(t=e),this._firstNode=e,this._lastNode=t,!this._overlap)for(var i=this.instances,n=0,r=i.length;n<r;n++)i[n].setExternalNodes(e,t)},clearExternalNodes:function(){if(this._firstNode=null,this._lastNode=null,!this._overlap)for(var e=this.instances,t=0,i=e.length;t<i;t++)e[t].clearExternalNodes()},getExternalNodes:function(){return[this._firstNode,this._lastNode]},_hasAsset:function(){return null!=this._asset},_createInstance:function(){var t=null,i=this._component,r=null;if(this._hasAsset()){var s=this._assets.get(this._asset);s&&(r=s.resource)}var a=e;return a.volume=this._volume*i.volume,a.pitch=this._pitch*i.pitch,a.loop=this._loop,a.startTime=this._startTime,a.duration=this._duration,a.onPlay=this._onInstancePlayHandler,a.onPause=this._onInstancePauseHandler,a.onResume=this._onInstanceResumeHandler,a.onStop=this._onInstanceStopHandler,a.onEnd=this._onInstanceEndHandler,i.positional?(a.position.copy(i.entity.getPosition()),a.maxDistance=i.maxDistance,a.refDistance=i.refDistance,a.rollOffFactor=i.rollOffFactor,a.distanceModel=i.distanceModel,t=new n.SoundInstance3d(this._manager,r,a)):t=new n.SoundInstance(this._manager,r,a),this._firstNode&&t.setExternalNodes(this._firstNode,this._lastNode),t},_onInstancePlay:function(e){this.fire("play",e),this._component.fire("play",this,e)},_onInstancePause:function(e){this.fire("pause",e),this._component.fire("pause",this,e)},_onInstanceResume:function(e){this.fire("resume",e),this._component.fire("resume",this,e)},_onInstanceStop:function(e){this.fire("stop",e),this._component.fire("stop",this,e)},_onInstanceEnd:function(e){var t=this.instances.indexOf(e);t!==-1&&this.instances.splice(t,1),this.fire("end",e),this._component.fire("end",this,e)},_onAssetAdd:function(e){this.load()},_onAssetLoad:function(e){this.load()},_onAssetRemoved:function(e){e.off("remove",this._onAssetRemoved,this),this._assets.off("add:"+e.id,this._onAssetAdd,this),this.stop()},updatePosition:function(e){for(var t=this.instances,i=0,n=t.length;i<n;i++)t[i].position=e}}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){if(this._volume=n.math.clamp(Number(e)||0,0,1),!this._overlap)for(var t=this.instances,i=0,r=t.length;i<r;i++)t[i].volume=this._volume*this._component.volume}}),Object.defineProperty(t.prototype,"pitch",{get:function(){return this._pitch},set:function(e){if(this._pitch=Math.max(Number(e)||0,.01),!this._overlap)for(var t=this.instances,i=0,n=t.length;i<n;i++)t[i].pitch=this.pitch*this._component.pitch}}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=!!e;for(var t=this.instances,i=0,n=t.length;i<n;i++)t[i].loop=this._loop}}),Object.defineProperty(t.prototype,"autoPlay",{get:function(){return this._autoPlay},set:function(e){this._autoPlay=!!e}}),Object.defineProperty(t.prototype,"overlap",{get:function(){return this._overlap},set:function(e){this._overlap=!!e}}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._startTime},set:function(e){if(this._startTime=Math.max(0,Number(e)||0),!this._overlap)for(var t=this.instances,i=0,n=t.length;i<n;i++)t[i].startTime=this._startTime}}),Object.defineProperty(t.prototype,"duration",{get:function(){var e=0;if(this._hasAsset()){var t=this._assets.get(this._asset);e=t.resource?t.resource.duration:0}return null!=this._duration?this._duration%(e||1):e},set:function(e){if(this._duration=Math.max(0,Number(e)||0)||null,!this._overlap)for(var t=this.instances,i=0,n=t.length;i<n;i++)t[i].duration=this._duration}}),Object.defineProperty(t.prototype,"asset",{get:function(){return this._asset},set:function(e){var t=this._asset;if(t){this._assets.off("add:"+t,this._onAssetAdd,this);var i=this._assets.get(t);i&&i.off("remove",this._onAssetRemoved,this)}this._asset=e,this._asset instanceof n.Asset&&(this._asset=this._asset.id),this._hasAsset()&&this._component.enabled&&this._component.entity.enabled&&this.load()}}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){if(this._hasAsset()){var e=this._assets.get(this._asset);if(e)return!!e.resource}return!1}}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){for(var e=this.instances,t=0,i=e.length;t<i;t++)if(e[t].isPlaying)return!0;return!1}}),Object.defineProperty(t.prototype,"isPaused",{get:function(){var e=this.instances,t=e.length;if(0===t)return!1;for(var i=0;i<t;i++)if(!e[i].isPaused)return!1;return!0}}),Object.defineProperty(t.prototype,"isStopped",{get:function(){for(var e=this.instances,t=0,i=e.length;t<i;t++)if(!e[t].isStopped)return!1;return!0}}),{SoundSlot:t}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_slots",this.onSetSlots,this),this.on("set_volume",this.onSetVolume,this),this.on("set_pitch",this.onSetPitch,this),this.on("set_refDistance",this.onSetRefDistance,this),this.on("set_maxDistance",this.onSetMaxDistance,this),this.on("set_rollOffFactor",this.onSetRollOffFactor,this),this.on("set_distanceModel",this.onSetDistanceModel,this),this.on("set_positional",this.onSetPositional,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{onSetSlots:function(e,t,i){var r;if(t)for(r in t)t[r].stop();var s={};for(r in i)i[r]instanceof n.SoundSlot?s[i[r].name]=i[r]:i[r].name&&(s[i[r].name]=new n.SoundSlot(this,i[r].name,i[r]));this.data.slots=s,this.enabled&&this.entity.enabled&&this.onEnable()},onSetVolume:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].volume=s.volume*i}},onSetPitch:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].pitch=s.pitch*i}},onSetRefDistance:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].refDistance=i}},onSetMaxDistance:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].maxDistance=i}},onSetRollOffFactor:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].rollOffFactor=i}},onSetDistanceModel:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++)a[o].distanceModel=i}},onSetPositional:function(e,t,i){var n=this.data.slots;for(var r in n){var s=n[r];if(!s.overlap)for(var a=s.instances,o=0,h=a.length;o<h;o++){var l=a[o].isPlaying||a[o].isSuspended,c=a[o].currentTime;l&&a[o].stop(),a[o]=s._createInstance(),l&&(a[o].play(),a[o].currentTime=c)}}},onEnable:function(){if(n.Component.prototype.onEnable.call(this),!this.system._inTools){var e=this.data.slots,t=this.data.playingBeforeDisable;for(var i in e){var r=e[i];r.autoPlay&&r.isStopped?r.play():t[i]?r.resume():r.isLoaded||r.load()}}},onDisable:function(){n.Component.prototype.onDisable.call(this);var e=this.data.slots,t={};for(var i in e)e[i].overlap||e[i].isPlaying&&(e[i].pause(),t[i]=!0);this.data.playingBeforeDisable=t},addSlot:function(e,t){var i=this.data.slots;if(i[e])return r("A sound slot with name "+e+" already exists on Entity "+this.entity.getPath()),null;var s=new n.SoundSlot(this,e,t);return i[e]=s,s.autoPlay&&this.enabled&&this.entity.enabled&&s.play(),s},removeSlot:function(e){var t=this.data.slots;t[e]&&(t[e].stop(),delete t[e])},slot:function(e){return this.data.slots[e]},play:function(e){if(!this.enabled||!this.entity.enabled)return null;var t=this.slots[e];return t?t.play():(r("Trying to play sound slot with name "+e+" which does not exist"),null)},pause:function(e){var t,i=this.data.slots;
if(e){if(t=i[e],!t)return void r("Trying to pause sound slot with name "+e+" which does not exist");t.pause()}else for(var n in i)i[n].pause()},resume:function(e){var t,i=this.data.slots;if(e){if(t=i[e],!t)return void r("Trying to resume sound slot with name "+e+" which does not exist");t.isPaused&&t.resume()}else for(var n in i)i[n].resume()},stop:function(e){var t,i=this.data.slots;if(e){if(t=i[e],!t)return void r("Trying to stop sound slot with name "+e+" which does not exist");t.stop()}else for(var n in i)i[n].stop()}}),{SoundComponent:e}}()),Object.assign(n,function(){var e=["enabled","volume","pitch","positional","refDistance","maxDistance","rollOffFactor","distanceModel","slots"],t=function(t,i){n.ComponentSystem.call(this,t),this.id="sound",this.description="Allows an Entity to play sounds",t.systems.add(this.id,this),this.ComponentType=n.SoundComponent,this.DataType=n.SoundComponentData,this.schema=e,this.manager=i,n.ComponentSystem.on("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.SoundComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){i=["volume","pitch","positional","refDistance","maxDistance","rollOffFactor","distanceModel","slots","enabled"],n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},cloneComponent:function(e,t){var i,r=e.sound.data,s={};for(i in r)r.hasOwnProperty(i)&&(s[i]=r[i]);s.slots={};for(i in r.slots){var a=r.slots[i];a instanceof n.SoundSlot?s.slots[i]={name:a.name,volume:a.volume,pitch:a.pitch,loop:a.loop,duration:a.duration,startTime:a.startTime,overlap:a.overlap,autoPlay:a.autoPlay,asset:a.asset}:s.slots[i]=a}return s.playingBeforeDisable={},this.addComponent(t,s)},onUpdate:function(e){var t=this.store;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i],r=n.entity,s=n.data;if(s.enabled&&r.enabled&&s.positional){var a=r.getPosition(),o=s.slots;for(var h in o)o[h].updatePosition(a)}}},onBeforeRemove:function(e,t){var i=t.slots;for(var n in i)i[n].overlap||i[n].stop()}}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.manager.volume},set:function(e){this.manager.volume=e}}),Object.defineProperty(t.prototype,"context",{get:function(){return n.SoundManager.hasAudioContext()?this.manager.context:(console.warn("WARNING: Audio context is not supported on this browser"),null)}}),{SoundComponentSystem:t}}()),n.SoundComponentData=function(){this.enabled=!0,this.volume=1,this.pitch=1,this.positional=!0,this.refDistance=1,this.maxDistance=1e4,this.rollOffFactor=1,this.distanceModel=n.DISTANCE_LINEAR,this.slots={},this.playingBeforeDisable={}},Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_assets",this.onSetAssets,this),this.on("set_loop",this.onSetLoop,this),this.on("set_volume",this.onSetVolume,this),this.on("set_pitch",this.onSetPitch,this),this.on("set_minDistance",this.onSetMinDistance,this),this.on("set_maxDistance",this.onSetMaxDistance,this),this.on("set_rollOffFactor",this.onSetRollOffFactor,this),this.on("set_distanceModel",this.onSetDistanceModel,this),this.on("set_3d",this.onSet3d,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{play:function(e){if(this.enabled&&this.entity.enabled){this.channel&&this.stop();var t,i=this.data;if(i.sources[e])if(i["3d"]){var n=this.entity.getPosition();t=this.system.manager.playSound3d(i.sources[e],n,i),i.currentSource=e,i.channel=t}else t=this.system.manager.playSound(i.sources[e],i),i.currentSource=e,i.channel=t}},pause:function(){this.channel&&this.channel.pause()},unpause:function(){this.channel&&this.channel.paused&&this.channel.unpause()},stop:function(){this.channel&&(this.channel.stop(),this.channel=null)},onSetAssets:function(e,t,i){var r,s=[],a=i.length;if(t&&t.length)for(r=0;r<t.length;r++)if(t[r]){var o=this.system.app.assets.get(t[r]);o&&(o.off("change",this.onAssetChanged,this),o.off("remove",this.onAssetRemoved,this),this.currentSource===o.name&&this.stop())}if(a)for(r=0;r<a;r++)t.indexOf(i[r])<0&&(i[r]instanceof n.Asset?s.push(i[r].id):s.push(i[r]));!this.system._inTools&&s.length&&this.loadAudioSourceAssets(s)},onAssetChanged:function(e,t,i,n){if("resource"===t){var r=this.data.sources;r&&(this.data.sources[e.name]=i,this.data.currentSource===e.name&&this.channel&&(this.channel.paused?(this.play(e.name),this.pause()):this.play(e.name)))}},onAssetRemoved:function(e){e.off("remove",this.onAssetRemoved,this),this.data.sources[e.name]&&(delete this.data.sources[e.name],this.data.currentSource===e.name&&(this.stop(),this.data.currentSource=null))},onSetLoop:function(e,t,i){t!=i&&this.channel&&this.channel.setLoop(i)},onSetVolume:function(e,t,i){t!=i&&this.channel&&this.channel.setVolume(i)},onSetPitch:function(e,t,i){t!=i&&this.channel&&this.channel.setPitch(i)},onSetMaxDistance:function(e,t,i){t!=i&&this.channel instanceof n.Channel3d&&this.channel.setMaxDistance(i)},onSetMinDistance:function(e,t,i){t!=i&&this.channel instanceof n.Channel3d&&this.channel.setMinDistance(i)},onSetRollOffFactor:function(e,t,i){t!=i&&this.channel instanceof n.Channel3d&&this.channel.setRollOffFactor(i)},onSetDistanceModel:function(e,t,i){t!==i&&this.channel instanceof n.Channel3d&&this.channel.setDistanceModel(i)},onSet3d:function(e,t,i){if(t!==i&&this.system.initialized&&this.currentSource){var n=!1,r=!1;this.channel&&(n=this.channel.paused,r=this.channel.suspended),this.play(this.currentSource),this.channel&&(this.channel.paused=n,this.channel.suspended=r)}},onEnable:function(){n.Component.prototype.onEnable.call(this);var e=this.data.assets;if(e)for(var t=this.system.app.assets,i=0,r=e.length;i<r;i++){var s=e[i];s instanceof n.Asset||(s=t.get(s)),s&&!s.resource&&t.load(s)}this.system.initialized&&(this.data.activate&&!this.channel?this.play(this.currentSource):this.unpause())},onDisable:function(){n.Component.prototype.onDisable.call(this),this.pause()},loadAudioSourceAssets:function(e){var t=this,i=e.map(function(e){return this.system.app.assets.get(e)},this),n={},r=null,s=i.length,a=function(e){s--},o=function(){this.data.sources=n,this.data.currentSource=r,this.enabled&&this.activate&&r&&this.onEnable()}.bind(this);i.forEach(function(i,h){i?(r=r||i.name,i.off("change",this.onAssetChanged,this),i.on("change",this.onAssetChanged,this),i.off("remove",this.onAssetRemoved,this),i.on("remove",this.onAssetRemoved,this),i.off("error",a,this),i.on("error",a,this),i.ready(function(e){n[e.name]=e.resource,s--,0===s&&o()}),!i.resource&&t.enabled&&t.entity.enabled&&this.system.app.assets.load(i)):(s--,0===s&&o(),this.system.app.assets.on("add:"+e[h],function(e){e.ready(function(e){t.data.sources[e.name]=e.resource}),e.resource||t.system.app.assets.load(e)}))},this)}}),{AudioSourceComponent:e}}()),Object.assign(n,function(){var e=["enabled","assets","volume","pitch","loop","activate","3d","minDistance","maxDistance","rollOffFactor","distanceModel","sources","currentSource","channel"],t=function(t,i){n.ComponentSystem.call(this,t),this.id="audiosource",this.description="Specifies audio assets that can be played at the position of the Entity.",t.systems.add(this.id,this),this.ComponentType=n.AudioSourceComponent,this.DataType=n.AudioSourceComponentData,this.schema=e,this.manager=i,this.initialized=!1,n.ComponentSystem.on("initialize",this.onInitialize,this),n.ComponentSystem.on("update",this.onUpdate,this),this.on("remove",this.onRemove,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.AudioSourceComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){i=["activate","volume","pitch","loop","3d","minDistance","maxDistance","rollOffFactor","distanceModel","enabled","assets"],n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i),e.paused=!(e.enabled&&e.activate)},onInitialize:function(e){e.audiosource&&e.enabled&&e.audiosource.enabled&&e.audiosource.activate&&e.audiosource.play(e.audiosource.currentSource);var t,i=e._children,r=i.length;for(t=0;t<r;t++)i[t]instanceof n.Entity&&this.onInitialize(i[t]);this.initialized=!0},onUpdate:function(e){var t=this.store;for(var i in t)if(t.hasOwnProperty(i)){var r=t[i],s=r.entity,a=r.data;if(a.enabled&&s.enabled&&a.channel instanceof n.Channel3d){var o=s.getPosition();a.channel.setPosition(o)}}},onRemove:function(e,t){t.channel&&(t.channel.stop(),t.channel=null)},setVolume:function(e){this.manager.setVolume(e)}}),{AudioSourceComponentSystem:t}}()),n.AudioSourceComponentData=function(){this.enabled=!0,this.assets=[],this.activate=!0,this.volume=1,this.pitch=1,this.loop=!1,this["3d"]=!0,this.minDistance=1,this.maxDistance=1e4,this.rollOffFactor=1,this.distanceModel=n.DISTANCE_INVERSE,this.paused=!0,this.sources={},this.currentSource=null,this.channel=null},Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{setCurrentListener:function(){if(this.enabled&&this.entity.audiolistener&&this.entity.enabled){this.system.current=this.entity;var e=this.system.current.getPosition();this.system.manager.listener.setPosition(e)}},onEnable:function(){n.Component.prototype.onEnable.call(this),this.setCurrentListener()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.system.current===this.entity&&(this.system.current=null)}}),{AudioListenerComponent:e}}()),Object.assign(n,function(){var e=["enabled"],t=function(t,i){n.ComponentSystem.call(this,t),this.id="audiolistener",this.description="Specifies the location of the listener for 3D audio playback.",t.systems.add(this.id,this),this.ComponentType=n.AudioListenerComponent,this.DataType=n.AudioListenerComponentData,this.schema=e,this.manager=i,this.current=null,n.ComponentSystem.on("update",this.onUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.AudioListenerComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){i=["enabled"],n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},onUpdate:function(e){if(this.current){var t=this.current.getPosition();this.manager.listener.setPosition(t);var i=this.current.getWorldTransform();this.manager.listener.setOrientation(i)}}}),{AudioListenerComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{AudioListenerComponentData:e}}()),Object.assign(n,{BODYTYPE_STATIC:"static",BODYTYPE_DYNAMIC:"dynamic",BODYTYPE_KINEMATIC:"kinematic",BODYFLAG_STATIC_OBJECT:1,BODYFLAG_KINEMATIC_OBJECT:2,BODYFLAG_NORESPONSE_OBJECT:4,BODYSTATE_ACTIVE_TAG:1,BODYSTATE_ISLAND_SLEEPING:2,BODYSTATE_WANTS_DEACTIVATION:3,BODYSTATE_DISABLE_DEACTIVATION:4,BODYSTATE_DISABLE_SIMULATION:5,BODYGROUP_NONE:0,BODYGROUP_DEFAULT:1,BODYGROUP_DYNAMIC:1,BODYGROUP_STATIC:2,BODYGROUP_KINEMATIC:4,BODYGROUP_ENGINE_1:8,BODYGROUP_TRIGGER:16,BODYGROUP_ENGINE_2:32,BODYGROUP_ENGINE_3:64,BODYGROUP_USER_1:128,BODYGROUP_USER_2:256,BODYGROUP_USER_3:512,BODYGROUP_USER_4:1024,BODYGROUP_USER_5:2048,BODYGROUP_USER_6:4096,BODYGROUP_USER_7:8192,BODYGROUP_USER_8:16384,BODYMASK_NONE:0,BODYMASK_ALL:65535,BODYMASK_STATIC:2,BODYMASK_NOT_STATIC:65533,BODYMASK_NOT_STATIC_KINEMATIC:65529}),Object.assign(n,function(){var e,t,i,r,s,a=function(a,o){n.Component.call(this,a,o),"undefined"==typeof Ammo||e||(e=new Ammo.btTransform,t=new Ammo.btVector3,i=new Ammo.btVector3,r=new Ammo.btQuaternion,s=new Ammo.btVector3(0,0,0)),this.on("set_mass",this.onSetMass,this),this.on("set_linearDamping",this.onSetLinearDamping,this),this.on("set_angularDamping",this.onSetAngularDamping,this),this.on("set_linearFactor",this.onSetLinearFactor,this),this.on("set_angularFactor",this.onSetAngularFactor,this),this.on("set_friction",this.onSetFriction,this),this.on("set_restitution",this.onSetRestitution,this),this.on("set_type",this.onSetType,this),this.on("set_group",this.onSetGroupOrMask,this),this.on("set_mask",this.onSetGroupOrMask,this),this.on("set_body",this.onSetBody,this),this._displacement=new n.Vec3(0,0,0),this._linearVelocity=new n.Vec3(0,0,0),this._angularVelocity=new n.Vec3(0,0,0)};return a.prototype=Object.create(n.Component.prototype),a.prototype.constructor=a,Object.defineProperty(a.prototype,"bodyType",{get:function(){return console.warn("WARNING: bodyType: Function is deprecated. Query type property instead."),this.type},set:function(e){console.warn("WARNING: bodyType: Function is deprecated. Set type property instead."),this.type=e}}),Object.defineProperty(a.prototype,"linearVelocity",{get:function(){if(!this.isKinematic()&&this.body){var e=this.body.getLinearVelocity();this._linearVelocity.set(e.x(),e.y(),e.z())}return this._linearVelocity},set:function(e){this.activate(),this.isKinematic()||this.body&&(t.setValue(e.x,e.y,e.z),this.body.setLinearVelocity(t)),this._linearVelocity.copy(e)}}),Object.defineProperty(a.prototype,"angularVelocity",{get:function(){if(!this.isKinematic()&&this.body){var e=this.body.getAngularVelocity();this._angularVelocity.set(e.x(),e.y(),e.z())}return this._angularVelocity},set:function(e){this.activate(),this.isKinematic()||this.body&&(t.setValue(e.x,e.y,e.z),this.body.setAngularVelocity(t)),this._angularVelocity.copy(e)}}),Object.assign(a.prototype,{createBody:function(){var e,i=this.entity;if(i.collision&&(e=i.collision.shape,i.trigger&&(i.trigger.destroy(),delete i.trigger)),e){this.body&&(this.system.removeBody(this.body),Ammo.destroy(this.body));var s=this.isStaticOrKinematic(),a=s?0:this.mass,o=new Ammo.btVector3(0,0,0);s||e.calculateLocalInertia(a,o);var h=i.getPosition(),l=i.getRotation();r.setValue(l.x,l.y,l.z,l.w);var c=new Ammo.btTransform;c.setIdentity(),c.getOrigin().setValue(h.x,h.y,h.z),c.setRotation(r);var d=new Ammo.btDefaultMotionState(c),u=new Ammo.btRigidBodyConstructionInfo(a,d,e,o),f=new Ammo.btRigidBody(u);f.setRestitution(this.restitution),f.setFriction(this.friction),f.setDamping(this.linearDamping,this.angularDamping);var p;p=this.linearFactor,t.setValue(p.x,p.y,p.z),f.setLinearFactor(t),p=this.angularFactor,t.setValue(p.x,p.y,p.z),f.setAngularFactor(t),f.entity=i,this.isKinematic()&&(f.setCollisionFlags(f.getCollisionFlags()|n.BODYFLAG_KINEMATIC_OBJECT),f.setActivationState(n.BODYSTATE_DISABLE_DEACTIVATION)),i.rigidbody.body=f,this.enabled&&this.entity.enabled&&this.enableSimulation()}},isActive:function(){return!!this.body&&this.body.isActive()},activate:function(){this.body&&this.body.activate()},enableSimulation:function(){if(this.entity.collision&&this.entity.collision.enabled&&!this.data.simulationEnabled){var e=this.body;e&&(this.system.addBody(e,this.group,this.mask),this.isKinematic()?(e.forceActivationState(n.BODYSTATE_DISABLE_DEACTIVATION),e.activate()):(e.forceActivationState(n.BODYFLAG_ACTIVE_TAG),this.syncEntityToBody()),this.data.simulationEnabled=!0)}},disableSimulation:function(){var e=this.body;e&&this.data.simulationEnabled&&(this.system.removeBody(e),e.forceActivationState(n.BODYSTATE_DISABLE_SIMULATION),this.data.simulationEnabled=!1)},applyForce:function(){var e,n,r,a,o,h;switch(arguments.length){case 1:e=arguments[0].x,n=arguments[0].y,r=arguments[0].z;break;case 2:e=arguments[0].x,n=arguments[0].y,r=arguments[0].z,a=arguments[1].x,o=arguments[1].y,h=arguments[1].z;break;case 3:e=arguments[0],n=arguments[1],r=arguments[2];break;case 6:e=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3],o=arguments[4],h=arguments[5]}var l=this.body;l&&(l.activate(),t.setValue(e,n,r),void 0!==a?(i.setValue(a,o,h),l.applyForce(t,i)):l.applyForce(t,s))},applyTorque:function(){var e,i,n;switch(arguments.length){case 1:e=arguments[0].x,i=arguments[0].y,n=arguments[0].z;break;case 3:e=arguments[0],i=arguments[1],n=arguments[2];break;default:return}var r=this.body;r&&(r.activate(),t.setValue(e,i,n),r.applyTorque(t))},applyImpulse:function(){var e,n,r,a,o,h;switch(arguments.length){case 1:e=arguments[0].x,n=arguments[0].y,r=arguments[0].z;break;case 2:e=arguments[0].x,n=arguments[0].y,r=arguments[0].z,a=arguments[1].x,o=arguments[1].y,h=arguments[1].z;break;case 3:e=arguments[0],n=arguments[1],r=arguments[2];break;case 6:e=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3],o=arguments[4],h=arguments[5];break;default:return}var l=this.body;l&&(l.activate(),t.setValue(e,n,r),void 0!==a?(i.setValue(a,o,h),l.applyImpulse(t,i)):l.applyImpulse(t,s))},applyTorqueImpulse:function(){var e,i,n;switch(arguments.length){case 1:e=arguments[0].x,i=arguments[0].y,n=arguments[0].z;break;case 3:e=arguments[0],i=arguments[1],n=arguments[2];break;default:return}var r=this.body;r&&(r.activate(),t.setValue(e,i,n),r.applyTorqueImpulse(t))},isStatic:function(){return this.type===n.BODYTYPE_STATIC},isStaticOrKinematic:function(){return this.type===n.BODYTYPE_STATIC||this.type===n.BODYTYPE_KINEMATIC},isKinematic:function(){return this.type===n.BODYTYPE_KINEMATIC},syncEntityToBody:function(){var e=this.body;if(e){var t=this.entity.getPosition(),i=this.entity.getRotation(),n=e.getWorldTransform();if(n.getOrigin().setValue(t.x,t.y,t.z),r.setValue(i.x,i.y,i.z,i.w),n.setRotation(r),this.isKinematic()){var s=this.body.getMotionState();s&&s.setWorldTransform(n)}e.activate()}},syncBodyToEntity:function(){var t=this.body;if(t.isActive()){var i=t.getMotionState();if(i){i.getWorldTransform(e);var n=e.getOrigin(),r=e.getRotation();this.entity.setPosition(n.x(),n.y(),n.z()),this.entity.setRotation(r.x(),r.y(),r.z(),r.w())}}},teleport:function(){arguments.length<3?(arguments[0]&&this.entity.setPosition(arguments[0]),arguments[1]&&(arguments[1]instanceof n.Quat?this.entity.setRotation(arguments[1]):this.entity.setEulerAngles(arguments[1]))):(6===arguments.length&&this.entity.setEulerAngles(arguments[3],arguments[4],arguments[5]),this.entity.setPosition(arguments[0],arguments[1],arguments[2])),this.syncEntityToBody()},_updateKinematic:function(t){if(this._displacement.copy(this._linearVelocity).scale(t),this.entity.translate(this._displacement),this._displacement.copy(this._angularVelocity).scale(t),this.entity.rotate(this._displacement.x,this._displacement.y,this._displacement.z),this.body.getMotionState()){var i=this.entity.getPosition(),n=this.entity.getRotation();e.getOrigin().setValue(i.x,i.y,i.z),r.setValue(n.x,n.y,n.z,n.w),e.setRotation(r),this.body.getMotionState().setWorldTransform(e)}},onEnable:function(){n.Component.prototype.onEnable.call(this),this.body||this.createBody(),this.enableSimulation()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.disableSimulation()},onSetMass:function(e,t,i){var n=this.data.body;if(n){var r=this.enabled&&this.entity.enabled;r&&this.disableSimulation();var s=i,a=new Ammo.btVector3(0,0,0);n.getCollisionShape().calculateLocalInertia(s,a),n.setMassProps(s,a),n.updateInertiaTensor(),r&&this.enableSimulation()}},onSetLinearDamping:function(e,t,i){var n=this.data.body;n&&n.setDamping(i,this.data.angularDamping)},onSetAngularDamping:function(e,t,i){var n=this.data.body;n&&n.setDamping(this.data.linearDamping,i)},onSetLinearFactor:function(e,i,n){var r=this.data.body;r&&(t.setValue(n.x,n.y,n.z),r.setLinearFactor(t))},onSetAngularFactor:function(e,i,n){var r=this.data.body;r&&(t.setValue(n.x,n.y,n.z),r.setAngularFactor(t))},onSetFriction:function(e,t,i){var n=this.data.body;n&&n.setFriction(i)},onSetRestitution:function(e,t,i){var n=this.data.body;n&&n.setRestitution(i)},onSetType:function(e,t,i){i!==t&&(this.disableSimulation(),i===n.BODYTYPE_DYNAMIC?(this.data.group=n.BODYGROUP_DYNAMIC,this.data.mask=n.BODYMASK_ALL):i===n.BODYTYPE_KINEMATIC?(this.data.group=n.BODYGROUP_KINEMATIC,this.data.mask=n.BODYMASK_ALL):(this.data.group=n.BODYGROUP_STATIC,this.data.mask=n.BODYMASK_NOT_STATIC),this.createBody())},onSetGroupOrMask:function(e,t,i){if(i!==t){var n=this.enabled&&this.entity.enabled;n&&(this.disableSimulation(),this.enableSimulation())}},onSetBody:function(e,t,i){this.body&&this.data.simulationEnabled&&this.body.activate()}}),{RigidBodyComponent:a}}()),Object.assign(n,function(){var e,t,i={},r={},s=!1,a=function(e,t,i){this.entity=e,this.point=t,this.normal=i},o=function(e,t,i){0===arguments.length?(this.a=null,this.b=null,this.localPointA=new n.Vec3,this.localPointB=new n.Vec3,this.pointA=new n.Vec3,this.pointB=new n.Vec3,this.normal=new n.Vec3):(this.a=e,this.b=t,this.localPointA=i.localPoint,this.localPointB=i.localPointOther,this.pointA=i.point,this.pointB=i.pointOther,this.normal=i.normal)},h=function(e,t,i,r,s){0===arguments.length?(this.localPoint=new n.Vec3,this.localPointOther=new n.Vec3,this.point=new n.Vec3,this.pointOther=new n.Vec3,this.normal=new n.Vec3):(this.localPoint=e,this.localPointOther=t,this.point=i,this.pointOther=r,this.normal=s)},l=function(e,t){this.other=e,this.contacts=t},c=["enabled","type","mass","linearDamping","angularDamping","linearFactor","angularFactor","friction","restitution","group","mask","body"],d=function(e){n.ComponentSystem.call(this,e),this.id="rigidbody",this.description="Adds the entity to the scene's physical simulation.",e.systems.add(this.id,this),this._stats=e.stats.frame,this.ComponentType=n.RigidBodyComponent,this.DataType=n.RigidBodyComponentData,this.contactPointPool=new n.AllocatePool(h,1),this.contactResultPool=new n.AllocatePool(l,1),this.singleContactResultPool=new n.AllocatePool(o,1),this.schema=c,this.maxSubSteps=10,this.fixedTimeStep=1/60,this.on("remove",this.onRemove,this)};return d.prototype=Object.create(n.ComponentSystem.prototype),d.prototype.constructor=d,n.Component._buildAccessors(n.RigidBodyComponent.prototype,c),Object.assign(d.prototype,{onLibraryLoaded:function(){if("undefined"!=typeof Ammo){var i=new Ammo.btDefaultCollisionConfiguration,r=new Ammo.btCollisionDispatcher(i),s=new Ammo.btDbvtBroadphase,a=new Ammo.btSequentialImpulseConstraintSolver;this.dynamicsWorld=new Ammo.btDiscreteDynamicsWorld(r,s,a,i),this._ammoGravity=new Ammo.btVector3(0,(-9.82),0),this.dynamicsWorld.setGravity(this._ammoGravity),e=new Ammo.btVector3,t=new Ammo.btVector3,n.ComponentSystem.on("update",this.onUpdate,this)}else n.ComponentSystem.off("update",this.onUpdate,this)},initializeComponentData:function(e,t,i){i=["enabled","mass","linearDamping","angularDamping","linearFactor","angularFactor","friction","restitution","type","group","mask"];var r={};i.forEach(function(e){r[e]=t[e]}),t.bodyType&&(r.type=t.bodyType,console.warn("WARNING: rigidbody.bodyType: Property is deprecated. Use type instead.")),r.linearFactor&&"array"===n.type(r.linearFactor)&&(r.linearFactor=new n.Vec3(r.linearFactor[0],r.linearFactor[1],r.linearFactor[2])),r.angularFactor&&"array"===n.type(r.angularFactor)&&(r.angularFactor=new n.Vec3(r.angularFactor[0],r.angularFactor[1],r.angularFactor[2])),n.ComponentSystem.prototype.initializeComponentData.call(this,e,r,i)},cloneComponent:function(e,t){var i={enabled:e.rigidbody.enabled,mass:e.rigidbody.mass,linearDamping:e.rigidbody.linearDamping,angularDamping:e.rigidbody.angularDamping,linearFactor:[e.rigidbody.linearFactor.x,e.rigidbody.linearFactor.y,e.rigidbody.linearFactor.z],angularFactor:[e.rigidbody.angularFactor.x,e.rigidbody.angularFactor.y,e.rigidbody.angularFactor.z],friction:e.rigidbody.friction,restitution:e.rigidbody.restitution,type:e.rigidbody.type,group:e.rigidbody.group,mask:e.rigidbody.mask};this.addComponent(t,i)},onRemove:function(e,t){t.body&&(this.removeBody(t.body),Ammo.destroy(t.body)),t.body=null},addBody:function(e,t,i){return void 0!==t&&void 0!==i?this.dynamicsWorld.addRigidBody(e,t,i):this.dynamicsWorld.addRigidBody(e),e},removeBody:function(e){this.dynamicsWorld.removeRigidBody(e)},addConstraint:function(e){return this.dynamicsWorld.addConstraint(e),e},removeConstraint:function(e){this.dynamicsWorld.removeConstraint(e)},setGravity:function(){var e,t,i;1===arguments.length?(e=arguments[0].x,t=arguments[0].y,i=arguments[0].z):(e=arguments[0],t=arguments[1],i=arguments[2]),this._ammoGravity.setValue(e,t,i),this.dynamicsWorld.setGravity(this._ammoGravity)},raycastFirst:function(i,r){var o=null;e.setValue(i.x,i.y,i.z),t.setValue(r.x,r.y,r.z);var h=new Ammo.ClosestRayResultCallback(e,t);if(this.dynamicsWorld.rayTest(e,t,h),h.hasHit()){var l=h.get_m_collisionObject(),c=Ammo.castObject(l,Ammo.btRigidBody);if(c){var d=h.get_m_hitPointWorld(),u=h.get_m_hitNormalWorld();if(o=new a(c.entity,new n.Vec3(d.x(),d.y(),d.z()),new n.Vec3(u.x(),u.y(),u.z())),arguments.length>2){var f=arguments[2];f(o),s||(console.warn("[DEPRECATED]: pc.RigidBodyComponentSystem#rayCastFirst no longer requires a callback. The result of the raycast is returned by the function instead."),s=!0)}}}return Ammo.destroy(h),o},_storeCollision:function(e,t){var n=!1,s=e._guid;return i[s]=i[s]||{others:[],entity:e},i[s].others.indexOf(t)<0&&(i[s].others.push(t),n=!0),r[s]=r[s]||{others:[],entity:e},r[s].others.push(t),n},_createContactPointFromAmmo:function(e){var t=this.contactPointPool.allocate();return t.localPoint.set(e.get_m_localPointA().x(),e.get_m_localPointA().y(),e.get_m_localPointA().z()),t.localPointOther.set(e.get_m_localPointB().x(),e.get_m_localPointB().y(),e.get_m_localPointB().z()),t.point.set(e.getPositionWorldOnA().x(),e.getPositionWorldOnA().y(),e.getPositionWorldOnA().z()),t.pointOther.set(e.getPositionWorldOnB().x(),e.getPositionWorldOnB().y(),e.getPositionWorldOnB().z()),t.normal.set(e.get_m_normalWorldOnB().x(),e.get_m_normalWorldOnB().y(),e.get_m_normalWorldOnB().z()),t},_createReverseContactPointFromAmmo:function(e){var t=this.contactPointPool.allocate();return t.localPointOther.set(e.get_m_localPointA().x(),e.get_m_localPointA().y(),e.get_m_localPointA().z()),t.localPoint.set(e.get_m_localPointB().x(),e.get_m_localPointB().y(),e.get_m_localPointB().z()),t.pointOther.set(e.getPositionWorldOnA().x(),e.getPositionWorldOnA().y(),e.getPositionWorldOnA().z()),t.point.set(e.getPositionWorldOnB().x(),e.getPositionWorldOnB().y(),e.getPositionWorldOnB().z()),t.normal.set(e.get_m_normalWorldOnB().x(),e.get_m_normalWorldOnB().y(),e.get_m_normalWorldOnB().z()),t},_createSingleContactResult:function(e,t,i){var n=this.singleContactResultPool.allocate();return n.a=e,n.b=t,n.localPointA=i.localPoint,n.localPointB=i.localPointOther,n.pointA=i.point,n.pointB=i.pointOther,n.normal=i.normal,n},_createContactResult:function(e,t){var i=this.contactResultPool.allocate();return i.other=e,i.contacts=t,i},_cleanOldCollisions:function(){for(var e in i)if(i.hasOwnProperty(e)){for(var t=i[e].entity,n=t.collision,s=i[e].others,a=s.length,o=a;o--;){var h=s[o];(!r[e]||r[e].others.indexOf(h)<0)&&(s.splice(o,1),n&&h.collision&&(t.rigidbody&&h.rigidbody?n.fire("collisionend",h):t.trigger&&n.fire("triggerleave",h)))}0===s.length&&delete i[e]}},onUpdate:function(e){this.dynamicsWorld.stepSimulation(e,this.maxSubSteps,this.fixedTimeStep);var t=this.store;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i].entity,a=t[i].data;a.body&&a.body.isActive()&&a.enabled&&s.enabled&&(a.type===n.BODYTYPE_DYNAMIC?s.rigidbody.syncBodyToEntity():a.type===n.BODYTYPE_KINEMATIC&&s.rigidbody._updateKinematic(e))}var o,h,l=this.dynamicsWorld.getDispatcher(),c=l.getNumManifolds();for(r={},o=0;o<c;o++){var d=l.getManifoldByIndexInternal(o),u=d.getBody0(),f=d.getBody1(),p=Ammo.castObject(u,Ammo.btRigidBody),_=Ammo.castObject(f,Ammo.btRigidBody),m=p.entity,A=_.entity;if(m&&A){var v,y,g,b=u.getCollisionFlags(),E=f.getCollisionFlags(),T=d.getNumContacts(),S=[],w=[];if(T>0)if(b&n.BODYFLAG_NORESPONSE_OBJECT||E&n.BODYFLAG_NORESPONSE_OBJECT)y=!!m.collision&&(m.collision.hasEvent("triggerenter")||m.collision.hasEvent("triggerleave")),g=!!A.collision&&(A.collision.hasEvent("triggerenter")||A.collision.hasEvent("triggerleave")),y&&(v=this._storeCollision(m,A),v&&(!m.collision||E&n.BODYFLAG_NORESPONSE_OBJECT||m.collision.fire("triggerenter",A))),g&&(v=this._storeCollision(A,m),v&&(!A.collision||b&n.BODYFLAG_NORESPONSE_OBJECT||A.collision.fire("triggerenter",m)));else{y=!!m.collision&&(m.collision.hasEvent("collisionstart")||m.collision.hasEvent("collisionend")||m.collision.hasEvent("contact")),g=!!A.collision&&(A.collision.hasEvent("collisionstart")||A.collision.hasEvent("collisionend")||A.collision.hasEvent("contact"));var C=this.hasEvent("contact");if(C||y||g){for(h=0;h<T;h++){var M=d.getContactPoint(h),P=this._createContactPointFromAmmo(M),I=null;if((y||g)&&(I=this._createReverseContactPointFromAmmo(M),S.push(P),w.push(I)),C){var R=this._createSingleContactResult(m,A,P);this.fire("contact",R)}}if(y){var x=this._createContactResult(A,S);m.collision&&m.collision.fire("contact",x),v=this._storeCollision(m,A),v&&m.collision&&m.collision.fire("collisionstart",x)}if(g){var O=this._createContactResult(m,w);A.collision&&A.collision.fire("contact",O),v=this._storeCollision(A,m),v&&A.collision&&A.collision.fire("collisionstart",O)}}}}}this._cleanOldCollisions(),this.contactPointPool.freeAll(),this.contactResultPool.freeAll(),this.singleContactResultPool.freeAll()}}),{RIGIDBODY_TYPE_STATIC:"static",RIGIDBODY_TYPE_DYNAMIC:"dynamic",RIGIDBODY_TYPE_KINEMATIC:"kinematic",RIGIDBODY_CF_STATIC_OBJECT:1,RIGIDBODY_CF_KINEMATIC_OBJECT:2,RIGIDBODY_CF_NORESPONSE_OBJECT:4,RIGIDBODY_ACTIVE_TAG:1,RIGIDBODY_ISLAND_SLEEPING:2,RIGIDBODY_WANTS_DEACTIVATION:3,RIGIDBODY_DISABLE_DEACTIVATION:4,RIGIDBODY_DISABLE_SIMULATION:5,RigidBodyComponentSystem:d}}()),Object.assign(n,function(){var e=function(){this.enabled=!0,this.mass=1,this.linearDamping=0,this.angularDamping=0,this.linearFactor=new n.Vec3(1,1,1),this.angularFactor=new n.Vec3(1,1,1),this.friction=.5,this.restitution=0,this.type=n.BODYTYPE_STATIC,this.group=n.BODYGROUP_STATIC,this.mask=n.BODYMASK_NOT_STATIC,this.body=null,this.simulationEnabled=!1};return{RigidBodyComponentData:e}}()),Object.assign(n,function(){var e,t,i=function(i,n,r){this.entity=n.entity,this.component=n,this.app=i,"undefined"!=typeof Ammo&&(e=new Ammo.btVector3,t=new Ammo.btQuaternion),this.initialize(r)};return Object.assign(i.prototype,{initialize:function(i){var r=this.entity,s=i.shape;if(s&&"undefined"!=typeof Ammo){r.trigger&&r.trigger.destroy();var a=1,o=new Ammo.btVector3(0,0,0);s.calculateLocalInertia(a,o);var h=r.getPosition(),l=r.getRotation();t.setValue(l.x,l.y,l.z,l.w);var c=new Ammo.btTransform;c.setIdentity(),c.getOrigin().setValue(h.x,h.y,h.z),c.setRotation(t);var d=new Ammo.btDefaultMotionState(c),u=new Ammo.btRigidBodyConstructionInfo(a,d,s,o),f=new Ammo.btRigidBody(u);this.body=f,f.setRestitution(0),f.setFriction(0),f.setDamping(0,0),e.setValue(0,0,0),f.setLinearFactor(e),f.setAngularFactor(e),f.setCollisionFlags(f.getCollisionFlags()|n.BODYFLAG_NORESPONSE_OBJECT),f.entity=r,this.component.enabled&&r.enabled&&this.enable()}},destroy:function(){this.body&&this.app.systems.rigidbody.removeBody(this.body)},syncEntityToBody:function(){var e=this.body;if(e){var i=this.entity.getPosition(),n=this.entity.getRotation(),r=e.getWorldTransform();r.getOrigin().setValue(i.x,i.y,i.z),t.setValue(n.x,n.y,n.z,n.w),r.setRotation(t),e.activate()}},enable:function(){var e=this.body;e&&(this.app.systems.rigidbody.addBody(e,n.BODYGROUP_TRIGGER,n.BODYMASK_NOT_STATIC^n.BODYGROUP_TRIGGER),e.forceActivationState(n.BODYSTATE_ACTIVE_TAG),e.activate(),this.syncEntityToBody())},disable:function(){var e=this.body;e&&(this.app.systems.rigidbody.removeBody(e),e.forceActivationState(n.BODYSTATE_DISABLE_SIMULATION))}}),{Trigger:i}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this.on("set_type",this.onSetType,this),this.on("set_halfExtents",this.onSetHalfExtents,this),this.on("set_radius",this.onSetRadius,this),this.on("set_height",this.onSetHeight,this),this.on("set_axis",this.onSetAxis,this),this.on("set_asset",this.onSetAsset,this),this.on("set_model",this.onSetModel,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{onSetType:function(e,t,i){t!==i&&this.system.changeType(this,t,i);
},onSetHalfExtents:function(e,t,i){this.data.initialized&&"box"===this.data.type&&this.system.recreatePhysicalShapes(this)},onSetRadius:function(e,t,i){!this.data.initialized||"sphere"!==this.data.type&&"capsule"!==this.data.type&&"cylinder"!==this.data.type||this.system.recreatePhysicalShapes(this)},onSetHeight:function(e,t,i){!this.data.initialized||"capsule"!==this.data.type&&"cylinder"!==this.data.type||this.system.recreatePhysicalShapes(this)},onSetAxis:function(e,t,i){!this.data.initialized||"capsule"!==this.data.type&&"cylinder"!==this.data.type||this.system.recreatePhysicalShapes(this)},onSetAsset:function(e,t,i){var r,s=this.system.app.assets;t&&(r=s.get(t),r&&r.off("remove",this.onAssetRemoved,this)),i&&(i instanceof n.Asset&&(this.data.asset=i.id),r=s.get(this.data.asset),r&&(r.off("remove",this.onAssetRemoved,this),r.on("remove",this.onAssetRemoved,this))),this.data.initialized&&"mesh"===this.data.type&&(i||(this.data.model=null),this.system.recreatePhysicalShapes(this))},onSetModel:function(e,t,i){this.data.initialized&&"mesh"===this.data.type&&this.system.implementations.mesh.doRecreatePhysicalShape(this)},onAssetRemoved:function(e){e.off("remove",this.onAssetRemoved,this),this.data.asset===e.id&&(this.asset=null)},onEnable:function(){if(n.Component.prototype.onEnable.call(this),"mesh"===this.data.type&&this.data.asset&&this.data.initialized){var e=this.system.app.assets.get(this.data.asset);if(e&&(!e.resource||!this.data.shape))return void this.system.recreatePhysicalShapes(this)}this.entity.trigger?this.entity.trigger.enable():this.entity.rigidbody&&this.entity.rigidbody.enabled&&this.entity.rigidbody.enableSimulation()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.entity.trigger?this.entity.trigger.disable():this.entity.rigidbody&&this.entity.rigidbody.disableSimulation()}}),{CollisionComponent:e}}()),Object.assign(n,function(){var e=["enabled","type","halfExtents","radius","axis","height","asset","shape","model"],t=function(e){this.system=e};Object.assign(t.prototype,{beforeInitialize:function(e,t){t.shape=this.createPhysicalShape(e.entity,t),t.model=new n.Model,t.model.graph=new n.GraphNode},afterInitialize:function(e,t){this.recreatePhysicalShapes(e),e.data.initialized=!0},reset:function(e,t){this.beforeInitialize(e,t),this.afterInitialize(e,t)},recreatePhysicalShapes:function(e){var t=e.entity,i=e.data;"undefined"!=typeof Ammo&&(i.shape=this.createPhysicalShape(e.entity,i),t.rigidbody?(t.rigidbody.disableSimulation(),t.rigidbody.createBody()):t.trigger?t.trigger.initialize(i):t.trigger=new n.Trigger(this.system.app,e,i))},createPhysicalShape:function(e,t){},updateTransform:function(e,t,i,n){e.entity.trigger&&e.entity.trigger.syncEntityToBody()},remove:function(e,t){var i=this.system.app;e.rigidbody&&e.rigidbody.body&&(i.systems.rigidbody.removeBody(e.rigidbody.body),e.rigidbody.disableSimulation()),e.trigger&&(e.trigger.destroy(),delete e.trigger),i.scene.containsModel(t.model)&&(i.root.removeChild(t.model.graph),i.scene.removeModel(t.model))},clone:function(e,t){var i=this.system.dataStore[e._guid],n={enabled:i.data.enabled,type:i.data.type,halfExtents:[i.data.halfExtents.x,i.data.halfExtents.y,i.data.halfExtents.z],radius:i.data.radius,axis:i.data.axis,height:i.data.height,asset:i.data.asset,model:i.data.model};return this.system.addComponent(t,n)}});var i=function(e){t.call(this,e)};i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.assign(i.prototype,{createPhysicalShape:function(e,t){if("undefined"!=typeof Ammo){var i=t.halfExtents,n=new Ammo.btVector3(i?i.x:.5,i?i.y:.5,i?i.z:.5);return new Ammo.btBoxShape(n)}}});var r=function(e){t.call(this,e)};r.prototype=Object.create(t.prototype),r.prototype.constructor=r,Object.assign(r.prototype,{createPhysicalShape:function(e,t){if("undefined"!=typeof Ammo)return new Ammo.btSphereShape(t.radius)}});var s=function(e){t.call(this,e)};s.prototype=Object.create(t.prototype),s.prototype.constructor=s,Object.assign(s.prototype,{createPhysicalShape:function(e,t){var i=null,n=void 0!==t.axis?t.axis:1,r=t.radius||.5,s=Math.max((t.height||2)-2*r,0);if("undefined"!=typeof Ammo)switch(n){case 0:i=new Ammo.btCapsuleShapeX(r,s);break;case 1:i=new Ammo.btCapsuleShape(r,s);break;case 2:i=new Ammo.btCapsuleShapeZ(r,s)}return i}});var a=function(e){t.call(this,e)};a.prototype=Object.create(t.prototype),a.prototype.constructor=a,Object.assign(a.prototype,{createPhysicalShape:function(e,t){var i=null,n=null,r=void 0!==t.axis?t.axis:1,s=void 0!==t.radius?t.radius:.5,a=void 0!==t.height?t.height:1;if("undefined"!=typeof Ammo)switch(r){case 0:i=new Ammo.btVector3(.5*a,s,s),n=new Ammo.btCylinderShapeX(i);break;case 1:i=new Ammo.btVector3(s,.5*a,s),n=new Ammo.btCylinderShape(i);break;case 2:i=new Ammo.btVector3(s,s,.5*a),n=new Ammo.btCylinderShapeZ(i)}return n}});var o=function(e){t.call(this,e)};o.prototype=Object.create(t.prototype),o.prototype.constructor=o,Object.assign(o.prototype,{beforeInitialize:function(e,t){},createPhysicalShape:function(e,t){if("undefined"!=typeof Ammo&&t.model){var i,r,s=t.model,a=new Ammo.btCompoundShape;for(i=0;i<s.meshInstances.length;i++){var o,h=s.meshInstances[i],l=h.mesh,c=l.indexBuffer[n.RENDERSTYLE_SOLID],d=l.vertexBuffer,u=d.getFormat(),f=u.size/4;for(r=0;r<u.elements.length;r++){var p=u.elements[r];p.name===n.SEMANTIC_POSITION&&(o=new Float32Array(d.lock(),p.offset))}var _,m,A,v=new Uint16Array(c.lock()),y=l.primitive[0].count/3,g=new Ammo.btVector3,b=new Ammo.btVector3,E=new Ammo.btVector3,T=l.primitive[0].base,S=new Ammo.btTriangleMesh;for(r=0;r<y;r++)_=v[T+3*r]*f,m=v[T+3*r+1]*f,A=v[T+3*r+2]*f,g.setValue(o[_],o[_+1],o[_+2]),b.setValue(o[m],o[m+1],o[m+2]),E.setValue(o[A],o[A+1],o[A+2]),S.addTriangle(g,b,E,!0);var w=!0,C=new Ammo.btBvhTriangleMeshShape(S,w),M=h.node.getWorldTransform(),P=M.getScale();C.setLocalScaling(new Ammo.btVector3(P.x,P.y,P.z));var I=h.node.getPosition(),R=h.node.getRotation(),x=new Ammo.btTransform;x.setIdentity(),x.getOrigin().setValue(I.x,I.y,I.z);var O=new Ammo.btQuaternion;O.setValue(R.x,R.y,R.z,R.w),x.setRotation(O),a.addChildShape(x,C)}var k=e.getWorldTransform(),D=k.getScale(),L=new Ammo.btVector3;return L.setValue(D.x,D.y,D.z),a.setLocalScaling(L),a}},recreatePhysicalShapes:function(e){var t=e.data;null!==t.asset&&e.enabled&&e.entity.enabled?this.loadModelAsset(e):this.doRecreatePhysicalShape(e)},loadModelAsset:function(e){var t=this,i=e.data.asset,n=e.data,r=this.system.app.assets,s=r.get(i);s?(s.ready(function(i){n.model=i.resource,t.doRecreatePhysicalShape(e)}),r.load(s)):r.once("add:"+i,function(i){i.ready(function(i){n.model=i.resource,t.doRecreatePhysicalShape(e)}),r.load(i)})},doRecreatePhysicalShape:function(e){var t=e.entity,i=e.data;i.model?(i.shape&&Ammo.destroy(i.shape),i.shape=this.createPhysicalShape(t,i),t.rigidbody?t.rigidbody.createBody():t.trigger?t.trigger.initialize(i):t.trigger=new n.Trigger(this.system.app,e,i)):this.remove(t,i)},updateTransform:function(e,t,i,r){if(e.shape){var s=e.entity.getWorldTransform(),a=s.getScale(),o=e.shape.getLocalScaling();a.x===o.x()&&a.y===o.y()&&a.z===o.z()||this.doRecreatePhysicalShape(e)}n.CollisionSystemImpl.prototype.updateTransform.call(this,e,t,i,r)}});var h=function(t){n.ComponentSystem.call(this,t),this.id="collision",this.description="Specifies a collision volume.",t.systems.add(this.id,this),this.ComponentType=n.CollisionComponent,this.DataType=n.CollisionComponentData,this.schema=e,this.implementations={},this.on("remove",this.onRemove,this),n.ComponentSystem.on("update",this.onUpdate,this)};return h.prototype=Object.create(n.ComponentSystem.prototype),h.prototype.constructor=h,n.Component._buildAccessors(n.CollisionComponent.prototype,e),Object.assign(h.prototype,{onLibraryLoaded:function(){"undefined"!=typeof Ammo||n.ComponentSystem.off("update",this.onUpdate,this)},initializeComponentData:function(e,t,i){var r,s={};i=["type","halfExtents","radius","axis","height","shape","model","asset","enabled"],i.forEach(function(e){s[e]=t[e]}),t.hasOwnProperty("asset")?(r=i.indexOf("model"),r!==-1&&i.splice(r,1)):t.hasOwnProperty("model")&&(r=i.indexOf("asset"),r!==-1&&i.splice(r,1)),s.type||(s.type=e.data.type),e.data.type=s.type,s.halfExtents&&"array"===n.type(s.halfExtents)&&(s.halfExtents=new n.Vec3(s.halfExtents[0],s.halfExtents[1],s.halfExtents[2]));var a=this._createImplementation(s.type);a.beforeInitialize(e,s),n.ComponentSystem.prototype.initializeComponentData.call(this.system,e,s,i),a.afterInitialize(e,s)},_createImplementation:function(e){if(void 0===this.implementations[e]){var t;switch(e){case"box":t=new i(this);break;case"sphere":t=new r(this);break;case"capsule":t=new s(this);break;case"cylinder":t=new a(this);break;case"mesh":t=new o(this)}this.implementations[e]=t}return this.implementations[e]},_getImplementation:function(e){return this.implementations[e.collision.data.type]},cloneComponent:function(e,t){return this._getImplementation(e).clone(e,t)},onRemove:function(e,t){this.implementations[t.type].remove(e,t)},onUpdate:function(e){var t,i,n,r=this.store;for(t in r)i=r[t].entity,n=r[t].data,n.enabled&&i.enabled&&!i.rigidbody&&i.trigger&&i.trigger.syncEntityToBody()},onTransformChanged:function(e,t,i,n){this.implementations[e.data.type].updateTransform(e,t,i,n)},changeType:function(e,t,i){this.implementations[t].remove(e.entity,e.data),this._createImplementation(i).reset(e,e.data)},recreatePhysicalShapes:function(e){this.implementations[e.data.type].recreatePhysicalShapes(e)}}),{CollisionComponentSystem:h}}()),Object.assign(n,function(){var e=function(){this.enabled=!0,this.type="box",this.halfExtents=new n.Vec3(.5,.5,.5),this.radius=.5,this.axis=1,this.height=2,this.asset=null,this.shape=null,this.model=null,this.initialized=!1};return{CollisionComponentData:e}}()),Object.assign(n,function(){var e,t=["emitterExtents","emitterRadius","loop","initialVelocity","animSpeed","normalMap"],i=["numParticles","lifetime","rate","rate2","startAngle","startAngle2","lighting","halfLambert","intensity","wrap","wrapBounds","depthWrite","noFog","sort","stretch","alignToMotion","preWarm","emitterShape","animTilesX","animTilesY","animFrames","animLoop","colorMap","localSpace"],r=["scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","velocityGraph","velocityGraph2","localVelocityGraph","localVelocityGraph2","rotationSpeedGraph","rotationSpeedGraph2"],s=["colorMapAsset","normalMapAsset","mesh"],a=function(e,s){n.Component.call(this,e,s),this.on("set_colorMapAsset",this.onSetColorMapAsset,this),this.on("set_normalMapAsset",this.onSetNormalMapAsset,this),this.on("set_mesh",this.onSetMesh,this),this.on("set_loop",this.onSetLoop,this),this.on("set_blendType",this.onSetBlendType,this),this.on("set_depthSoftening",this.onSetDepthSoftening,this),this.on("set_layers",this.onSetLayers,this),t.forEach(function(e){this.on("set_"+e,this.onSetSimpleProperty,this)}.bind(this)),i.forEach(function(e){this.on("set_"+e,this.onSetComplexProperty,this)}.bind(this)),r.forEach(function(e){this.on("set_"+e,this.onSetGraphProperty,this)}.bind(this)),this._requestedDepth=!1};return a.prototype=Object.create(n.Component.prototype),a.prototype.constructor=a,Object.assign(a.prototype,{addModelToLayers:function(){if(this.data.model)for(var e,t=0;t<this.layers.length;t++)e=this.system.app.scene.layers.getLayerById(this.layers[t]),e&&(e.addMeshInstances(this.data.model.meshInstances),this.emitter._layer=e)},removeModelFromLayers:function(e){if(this.data.model)for(var t,i=0;i<this.layers.length;i++)t=this.system.app.scene.layers.getLayerById(this.layers[i]),t&&t.removeMeshInstances(this.data.model.meshInstances)},onSetLayers:function(e,t,i){if(this.data.model){var n,r;for(n=0;n<t.length;n++)r=this.system.app.scene.layers.getLayerById(t[n]),r&&r.removeMeshInstances(this.data.model.meshInstances);if(this.enabled&&this.entity.enabled)for(n=0;n<i.length;n++)r=this.system.app.scene.layers.getLayerById(i[n]),r&&r.addMeshInstances(this.data.model.meshInstances)}},onLayersChanged:function(e,t){this.addModelToLayers(),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)},onLayerAdded:function(e){if(this.data.model){var t=this.layers.indexOf(e.id);t<0||e.addMeshInstances(this.data.model.meshInstances)}},onLayerRemoved:function(e){if(this.data.model){var t=this.layers.indexOf(e.id);t<0||e.removeMeshInstances(this.data.model.meshInstances)}},onSetColorMapAsset:function(e,t,i){var r,s=this,a=this.system.app.assets;t&&(r=a.get(t),r&&r.off("remove",this.onColorMapRemoved,this)),i?(i instanceof n.Asset&&(this.data.colorMapAsset=i.id,i=i.id),r=a.get(i),r?(r.on("remove",this.onColorMapRemoved,this),r.ready(function(e){s.colorMap=e.resource}),s.enabled&&s.entity.enabled&&a.load(r)):a.once("add:"+i,function(e){e.on("remove",this.onColorMapRemoved,this),e.ready(function(e){s.colorMap=e.resource}),s.enabled&&s.entity.enabled&&a.load(e)})):this.colorMap=null},onColorMapRemoved:function(e){e.off("remove",this.onColorMapRemoved,this),this.colorMapAsset=null},onSetNormalMapAsset:function(e,t,i){var r,s=this,a=this.system.app.assets;t&&(r=a.get(t),r&&r.off("remove",this.onNormalMapRemoved,this)),i?(i instanceof n.Asset&&(this.data.normalMapAsset=i.id,i=i.id),r=a.get(i),r?(r.on("remove",this.onNormalMapRemoved,this),r.ready(function(e){s.normalMap=e.resource}),s.enabled&&s.entity.enabled&&a.load(r)):a.once("add:"+i,function(e){e.on("remove",this.onNormalMapRemoved,this),e.ready(function(e){s.normalMap=e.resource}),s.enabled&&s.entity.enabled&&a.load(e)})):this.normalMap=null},onNormalMapRemoved:function(e){e.off("remove",this.onNormalMapRemoved,this),this.normalMapAsset=null},onSetMesh:function(e,t,i){var r,s=this,a=this.system.app.assets;t&&"number"==typeof t&&(r=a.get(t),r&&r.off("remove",this.onMeshRemoved,this)),i?(i instanceof n.Asset&&(this.data.mesh=i.id,i=i.id),"number"==typeof i?(r=a.get(i),r?(r.on("remove",this.onMeshRemoved,this),r.ready(function(e){s._onMeshChanged(e.resource)}),s.enabled&&s.entity.enabled&&a.load(r)):a.once("add:"+i,function(e){e.on("remove",this.onMeshRemoved,this),e.ready(function(e){s._onMeshChanged(e.resource)}),s.enabled&&s.entity.enabled&&a.load(e)})):this._onMeshChanged(i)):this._onMeshChanged(null)},_onMeshChanged:function(e){!e||e instanceof n.Mesh||(e=e.meshInstances[0]?e.meshInstances[0].mesh:null),this.data.mesh=e,this.emitter&&(this.emitter.mesh=e,this.emitter.resetMaterial(),this.rebuild())},onMeshRemoved:function(e){e.off("remove",this.onMeshRemoved,this),this.mesh=null},onSetLoop:function(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.resetTime())},onSetBlendType:function(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.material.blendType=i,this.emitter.resetMaterial(),this.rebuild())},_requestDepth:function(){this._requestedDepth||(e||(e=this.system.app.scene.layers.getLayerById(n.LAYERID_DEPTH)),e&&(e.incrementCounter(),this._requestedDepth=!0))},_releaseDepth:function(){this._requestedDepth&&e&&(e.decrementCounter(),this._requestedDepth=!1)},onSetDepthSoftening:function(e,t,i){t!==i&&(i?(this.enabled&&this.entity.enabled&&this._requestDepth(),this.emitter&&(this.emitter[e]=i)):(this.enabled&&this.entity.enabled&&this._releaseDepth(),this.emitter&&(this.emitter[e]=i)),this.emitter&&(this.reset(),this.emitter.resetMaterial(),this.rebuild()))},onSetSimpleProperty:function(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.resetMaterial())},onSetComplexProperty:function(e,t,i){this.emitter&&(this.emitter[e]=i,this.reset(),this.emitter.resetMaterial(),this.rebuild())},onSetGraphProperty:function(e,t,i){this.emitter&&(this.emitter[e]=i,this.emitter.rebuildGraphs(),this.emitter.resetMaterial())},onEnable:function(){for(var e=this.data,t=0,i=s.length;t<i;t++){var r=e[s[t]];if(r){if(!(r instanceof n.Asset)){var a=parseInt(r,10);if(!(a>=0))continue;r=this.system.app.assets.get(r)}r&&!r.resource&&this.system.app.assets.load(r)}}if(!this.emitter){var o=e.mesh;o instanceof n.Mesh||(o=null),this.emitter=new n.ParticleEmitter(this.system.app.graphicsDevice,{numParticles:e.numParticles,emitterExtents:e.emitterExtents,emitterRadius:e.emitterRadius,emitterShape:e.emitterShape,initialVelocity:e.initialVelocity,wrap:e.wrap,localSpace:e.localSpace,wrapBounds:e.wrapBounds,lifetime:e.lifetime,rate:e.rate,rate2:e.rate2,animTilesX:e.animTilesX,animTilesY:e.animTilesY,animNumFrames:e.animNumFrames,animSpeed:e.animSpeed,animLoop:e.animLoop,startAngle:e.startAngle,startAngle2:e.startAngle2,scaleGraph:e.scaleGraph,scaleGraph2:e.scaleGraph2,colorGraph:e.colorGraph,colorGraph2:e.colorGraph2,alphaGraph:e.alphaGraph,alphaGraph2:e.alphaGraph2,localVelocityGraph:e.localVelocityGraph,localVelocityGraph2:e.localVelocityGraph2,velocityGraph:e.velocityGraph,velocityGraph2:e.velocityGraph2,rotationSpeedGraph:e.rotationSpeedGraph,rotationSpeedGraph2:e.rotationSpeedGraph2,colorMap:e.colorMap,normalMap:e.normalMap,loop:e.loop,preWarm:e.preWarm,sort:e.sort,stretch:e.stretch,alignToMotion:e.alignToMotion,lighting:e.lighting,halfLambert:e.halfLambert,intensity:e.intensity,depthSoftening:e.depthSoftening,scene:this.system.app.scene,mesh:o,depthWrite:e.depthWrite,noFog:e.noFog,node:this.entity,blendType:e.blendType}),this.emitter.meshInstance.node=this.entity,this.psys=new n.Model,this.psys.graph=this.entity,this.psys.emitter=this.emitter,this.psys.meshInstances=[this.emitter.meshInstance],e.model=this.psys,this.emitter.psys=this.psys,e.autoPlay||(this.pause(),this.emitter.meshInstance.visible=!1)}e.model&&this.emitter.colorMap&&this.addModelToLayers(),this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.enabled&&this.entity.enabled&&e.depthSoftening&&this._requestDepth(),n.Component.prototype.onEnable.call(this)},onDisable:function(){n.Component.prototype.onDisable.call(this),this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this.data.model&&(this.removeModelFromLayers(),this.data.depthSoftening&&this._releaseDepth())},reset:function(){this.emitter&&this.emitter.reset()},stop:function(){this.emitter&&(this.emitter.loop=!1,this.emitter.resetTime(),this.emitter.addTime(0,!0))},pause:function(){this.data.paused=!0},unpause:function(){this.data.paused=!1},play:function(){this.data.paused=!1,this.emitter&&(this.emitter.meshInstance.visible=!0,this.emitter.loop=this.data.loop,this.emitter.resetTime())},isPlaying:function(){return!this.data.paused&&(!(!this.emitter||!this.emitter.loop)||Date.now()<=this.emitter.endTime)},rebuild:function(){var e=this.enabled;this.enabled=!1,this.emitter&&(this.emitter.rebuild(),this.emitter.meshInstance.node=this.entity,this.data.model.meshInstances=[this.emitter.meshInstance]),this.enabled=e}}),{ParticleSystemComponent:a}}()),Object.assign(n,function(){var e=["enabled","autoPlay","numParticles","lifetime","rate","rate2","startAngle","startAngle2","loop","preWarm","lighting","halfLambert","intensity","depthWrite","noFog","depthSoftening","sort","blendType","stretch","alignToMotion","emitterShape","emitterExtents","emitterRadius","initialVelocity","wrap","wrapBounds","localSpace","colorMapAsset","normalMapAsset","mesh","localVelocityGraph","localVelocityGraph2","velocityGraph","velocityGraph2","rotationSpeedGraph","rotationSpeedGraph2","scaleGraph","scaleGraph2","colorGraph","colorGraph2","alphaGraph","alphaGraph2","colorMap","normalMap","animTilesX","animTilesY","animNumFrames","animSpeed","animLoop","layers"],t=function(t){n.ComponentSystem.call(this,t),this.id="particlesystem",this.description="Updates and renders particle system in the scene.",t.systems.add(this.id,this),this.ComponentType=n.ParticleSystemComponent,this.DataType=n.ParticleSystemComponentData,this.schema=e,this.propertyTypes={emitterExtents:"vec3",wrapBounds:"vec3",localVelocityGraph:"curveset",localVelocityGraph2:"curveset",velocityGraph:"curveset",velocityGraph2:"curveset",colorGraph:"curveset",colorGraph2:"curveset",alphaGraph:"curve",alphaGraph2:"curve",rotationSpeedGraph:"curve",rotationSpeedGraph2:"curve",scaleGraph:"curve",scaleGraph2:"curve"},this.on("beforeremove",this.onRemove,this),n.ComponentSystem.on("update",this.onUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ParticleSystemComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){var r={};i=[];var s,a=this.propertyTypes;for(var o in t)t.hasOwnProperty(o)&&(i.push(o),r[o]=t[o]),"vec3"===a[o]?"array"===n.type(r[o])&&(r[o]=new n.Vec3(r[o][0],r[o][1],r[o][2])):"curve"===a[o]?r[o]instanceof n.Curve||(s=r[o].type,r[o]=new n.Curve(r[o].keys),r[o].type=s):"curveset"===a[o]&&(r[o]instanceof n.CurveSet||(s=r[o].type,r[o]=new n.CurveSet(r[o].keys),r[o].type=s)),r.layers&&"array"===n.type(r.layers)&&(r.layers=r.layers.slice(0));n.ComponentSystem.prototype.initializeComponentData.call(this,e,r,i)},cloneComponent:function(e,t){for(var i=e.particlesystem.data,r=this.schema,s={},a=0,o=r.length;a<o;a++){var h=r[a],l=i[h];l instanceof n.Vec3||l instanceof n.Curve||l instanceof n.CurveSet?(l=l.clone(),s[h]=l):"layers"===h?s.layers=i.layers.slice(0):null!==l&&void 0!==l&&(s[h]=l)}return this.addComponent(t,s)},onUpdate:function(e){var t,i,r,s,a=this.store,o=this.app.stats.particles;for(var h in a)if(a.hasOwnProperty(h)){s=a[h];var l=s.entity,c=s.data;if(c.enabled&&l.enabled){var d=c.model.emitter;if(!d.meshInstance.visible)continue;if(d.lighting){var u,f,p=c.layers;for(i=0;i<p.length;i++)if(u=this.app.scene.layers.getLayerById(p[i])){for(u._lightCube||(u._lightCube=new Float32Array(18)),f=u._lightCube,i=0;i<6;i++)f[3*i]=this.app.scene.ambientLight.data[0],f[3*i+1]=this.app.scene.ambientLight.data[1],f[3*i+2]=this.app.scene.ambientLight.data[2];var _=u._sortedLights[n.LIGHTTYPE_DIRECTIONAL];for(r=0;r<_.length;r++)for(s=0;s<6;s++){var m=Math.max(d.lightCubeDir[s].dot(_[r]._direction),0)*_[r]._intensity;f[3*s]+=_[r]._color.data[0]*m,f[3*s+1]+=_[r]._color.data[1]*m,f[3*s+2]+=_[r]._color.data[2]*m}}d.constantLightCube.setValue(f)}if(!c.paused){if(d.simTime+=e,t=0,d.simTime>d.fixedTimeStep&&(t=Math.floor(d.simTime/d.fixedTimeStep),d.simTime-=t*d.fixedTimeStep),t){for(t=Math.min(t,d.maxSubSteps),i=0;i<t;i++)d.addTime(d.fixedTimeStep);o._updatesPerFrame+=t,o._frameTime+=d._addTimeTime,d._addTimeTime=0}d.finishFrame()}}}},onRemove:function(e,t){var i=t.data;i.model&&(e.removeChild(i.model.getGraph()),i.model=null),t.emitter&&(t.emitter.destroy(),t.emitter=null)}}),{ParticleSystemComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.numParticles=1,this.rate=1,this.rate2=null,this.startAngle=0,this.startAngle2=null,this.lifetime=50,this.emitterExtents=new n.Vec3,this.emitterRadius=0,this.emitterShape=n.EMITTERSHAPE_BOX,this.initialVelocity=0,this.wrapBounds=new n.Vec3,this.localSpace=!1,this.colorMap=null,this.colorMapAsset=null,this.normalMap=null,this.normalMapAsset=null,this.loop=!0,this.preWarm=!1,this.sort=0,this.mode=n.PARTICLEMODE_GPU,this.scene=null,this.lighting=!1,this.halfLambert=!1,this.intensity=1,this.stretch=0,this.alignToMotion=!1,this.depthSoftening=0,this.mesh=null,this.depthWrite=!1,this.noFog=!1,this.animTilesX=1,this.animTilesY=1,this.animNumFrames=1,this.animSpeed=1,this.animLoop=!0,this.scaleGraph=null,this.scaleGraph2=null,this.colorGraph=null,this.colorGraph2=null,this.alphaGraph=null,this.alphaGraph2=null,this.localVelocityGraph=null,this.localVelocityGraph2=null,this.velocityGraph=null,this.velocityGraph2=null,this.rotationSpeedGraph=null,this.rotationSpeedGraph2=null,this.blendType=n.BLEND_NORMAL,this.model=null,this.enabled=!0,this.paused=!1,this.autoPlay=!0,this.layers=[n.LAYERID_WORLD]};return{ParticleSystemComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){this._component=e,this._frame=0,this._sprite=null,this._spriteAsset=null,this.spriteAsset=t.spriteAsset,this.name=t.name,this.fps=t.fps||0,this.loop=t.loop||!1,this._playing=!1,this._paused=!1,this._time=0,n.events.attach(this)};return Object.assign(e.prototype,{_onSpriteAssetAdded:function(e){this._component.system.app.assets.off("add:"+e.id,this._onSpriteAssetAdded,this),this._spriteAsset===e.id&&this._bindSpriteAsset(e)},_bindSpriteAsset:function(e){e.on("load",this._onSpriteAssetLoad,this),e.on("remove",this._onSpriteAssetRemove,this),e.resource?this._onSpriteAssetLoad(e):this._component.system.app.assets.load(e)},_onSpriteAssetLoad:function(e){if(e.resource)if(e.resource.atlas)this.sprite=e.resource;else{var t=e.data.textureAtlasAsset,i=this._component.system.app.assets;i.off("load:"+t,this._onTextureAtlasLoad,this),i.once("load:"+t,this._onTextureAtlasLoad,this)}else this.sprite=null},_onTextureAtlasLoad:function(e){var t=this._spriteAsset;t instanceof n.Asset?this._onSpriteAssetLoad(t):this._onSpriteAssetLoad(this._component.system.app.assets.get(t))},_onSpriteAssetRemove:function(e){this.sprite=null},_onSpriteMeshesChange:function(){this._component.currentClip===this&&this._component._showFrame(this.frame)},_onSpritePpuChanged:function(){this._component.currentClip===this&&this.sprite.renderMode!==n.SPRITE_RENDERMODE_SIMPLE&&this._component._showFrame(this.frame)},_update:function(e){if(0!==this.fps&&this._playing&&!this._paused&&this._sprite){var t=this.fps<0?-1:1,i=this._time+e*this._component.speed*t,n=this.duration,r=i>n||i<0;this._setTime(i);var s=this.frame;s=this._sprite?Math.floor(this._sprite.frameKeys.length*this._time/n):0,s!==this._frame&&this._setFrame(s),r&&(this.loop?(this.fire("loop"),this._component.fire("loop",this)):(this._playing=!1,this._paused=!1,this.fire("end"),this._component.fire("end",this)))}},_setTime:function(e){this._time=e;var t=this.duration;this._time<0?this.loop?this._time=this._time%t+t:this._time=0:this._time>t&&(this.loop?this._time=this._time%t:this._time=t)},_setFrame:function(e){this._sprite?this._frame=n.math.clamp(e,0,this._sprite.frameKeys.length-1):this._frame=e,this._component.currentClip===this&&this._component._showFrame(this._frame)},_destroy:function(){this._sprite&&(this._sprite=null),this._spriteAsset&&(this._spriteAsset=null)},play:function(){this._playing||(this._playing=!0,this._paused=!1,this.frame=0,this.fire("play"),this._component.fire("play",this))},pause:function(){this._playing&&!this._paused&&(this._paused=!0,this.fire("pause"),this._component.fire("pause",this))},resume:function(){this._paused&&(this._paused=!1,this.fire("resume"),this._component.fire("resume",this))},stop:function(){this._playing&&(this._playing=!1,this._paused=!1,this._time=0,this.frame=0,this.fire("stop"),this._component.fire("stop",this))}}),Object.defineProperty(e.prototype,"spriteAsset",{get:function(){return this._spriteAsset},set:function(e){var t=this._component.system.app.assets,i=e;if(e instanceof n.Asset&&(i=e.id),this._spriteAsset!==i){if(this._spriteAsset){var r=t.get(this._spriteAsset);if(r){r.off("load",this._onSpriteAssetLoad,this),r.off("remove",this._onSpriteAssetRemove,this);var s=r.data&&r.data.textureAtlasAsset;s&&t.off("load:"+s,this._onTextureAtlasLoad,this)}}if(this._spriteAsset=i,this._spriteAsset){var a=t.get(this._spriteAsset);a?this._bindSpriteAsset(a):(this.sprite=null,t.on("add:"+this._spriteAsset,this._onSpriteAssetAdded,this))}else this.sprite=null}}}),Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},set:function(e){if(this._sprite&&(this._sprite.off("set:meshes",this._onSpriteMeshesChange,this),this._sprite.off("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.off("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.off("set:texture",this._onSpriteMeshesChange,this)),this._sprite=e,this._sprite&&(this._sprite.on("set:meshes",this._onSpriteMeshesChange,this),this._sprite.on("set:pixelsPerUnit",this._onSpritePpuChanged,this),this._sprite.on("set:atlas",this._onSpriteMeshesChange,this),this._sprite.atlas&&this._sprite.atlas.on("set:texture",this._onSpriteMeshesChange,this)),this._component.currentClip===this){var t;e&&e.atlas?(e.atlas.texture&&(t=this._component._meshInstance,t&&(t.setParameter("texture_emissiveMap",e.atlas.texture),t.setParameter("texture_opacityMap",e.atlas.texture)),this._component.enabled&&this._component.entity.enabled&&this._component._showModel()),this.time&&this.fps?this.time=this.time:this.frame=this.frame):(t=this._component._meshInstance,t&&(t.deleteParameter("texture_emissiveMap"),t.deleteParameter("texture_opacityMap")),this._component._hideModel())}}}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(e){this._setFrame(e);var t=this.fps||Number.MIN_VALUE;this._setTime(this._frame/t)}}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._playing}}),Object.defineProperty(e.prototype,"isPaused",{get:function(){return this._paused}}),Object.defineProperty(e.prototype,"duration",{get:function(){if(this._sprite){var e=this.fps||Number.MIN_VALUE;return this._sprite.frameKeys.length/Math.abs(e)}return 0}}),Object.defineProperty(e.prototype,"time",{get:function(){return this._time},set:function(e){this._setTime(e),this._sprite?this.frame=Math.min(this._sprite.frameKeys.length-1,Math.floor(this._time*Math.abs(this.fps))):this.frame=0}}),{SpriteAnimationClip:e}}()),Object.assign(n,function(){n.SPRITETYPE_SIMPLE="simple",n.SPRITETYPE_ANIMATED="animated";var e="texture_emissiveMap",t="texture_opacityMap",i="material_emissive",s="material_opacity",a="innerOffset",o="outerScale",h="atlasRect",l=function(e,t){n.Component.call(this,e,t),this._type=n.SPRITETYPE_SIMPLE,this._material=e.defaultMaterial,this._color=new n.Color(1,1,1,1),this._speed=1,this._flipX=!1,this._flipY=!1,this._width=1,this._height=1,this._drawOrder=0,this._layers=[n.LAYERID_WORLD],this._outerScale=new n.Vec2(1,1),this._innerOffset=new n.Vec4,this._atlasRect=new n.Vec4,this._batchGroupId=-1,this._batchGroup=null,this._node=new n.GraphNode,this._model=new n.Model,this._model.graph=this._node,this._meshInstance=null,t.addChild(this._model.graph),this._model._entity=t,this._updateAabbFunc=this._updateAabb.bind(this),this._addedModel=!1,this._autoPlayClip=null,this._clips={},this._defaultClip=new n.SpriteAnimationClip(this,{name:this.entity.name,fps:0,loop:!1,spriteAsset:null}),this._currentClip=this._defaultClip};return l.prototype=Object.create(n.Component.prototype),l.prototype.constructor=l,Object.assign(l.prototype,{onEnable:function(){n.Component.prototype.onEnable.call(this),this.system.app.scene.on("set:layers",this._onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this._onLayerAdded,this),this.system.app.scene.layers.on("remove",this._onLayerRemoved,this)),this._showModel(),this._autoPlayClip&&this._tryAutoPlay()},onDisable:function(){n.Component.prototype.onDisable.call(this),this.system.app.scene.off("set:layers",this._onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this._onLayerAdded,this),this.system.app.scene.layers.off("remove",this._onLayerRemoved,this)),this.stop(),this._hideModel(),this._batchGroupId>=0&&this.system.app.batcher.markGroupDirty(this.batchGroupId)},onDestroy:function(){this._currentClip=null,this._defaultClip&&(this._defaultClip._destroy(),this._defaultClip=null);for(var e in this._clips)this._clips[e]._destroy();this._clips=null,this._hideModel(),this._model=null,this._node&&(this._node.parent&&this._node.parent.removeChild(this._node),this._node=null),this._meshInstance&&(this._meshInstance.material=null,this._meshInstance.mesh=null,this._meshInstance=null)},_showModel:function(){if(!this._addedModel&&this._meshInstance){var e,t,i=[this._meshInstance];for(e=0,t=this._layers.length;e<t;e++){
var n=this.system.app.scene.layers.getLayerById(this._layers[e]);n&&n.addMeshInstances(i)}this._addedModel=!0}},_hideModel:function(){if(this._addedModel&&this._meshInstance){var e,t,i=[this._meshInstance];for(e=0,t=this._layers.length;e<t;e++){var n=this.system.app.scene.layers.getLayerById(this._layers[e]);n&&n.removeMeshInstances(i)}this._addedModel=!1}},_showFrame:function(r){if(this.sprite){var o=this.sprite.meshes[r];if(!o)return void(this._meshInstance&&(this._meshInstance.mesh=null,this._meshInstance.visible=!1));var l=this.system.defaultMaterial;if(this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED?l=this.system.default9SlicedMaterialSlicedMode:this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED&&(l=this.system.default9SlicedMaterialTiledMode),this._meshInstance||(this._meshInstance=new n.MeshInstance(this._node,o,this._material),this._meshInstance.castShadow=!1,this._meshInstance.receiveShadow=!1,this._meshInstance.drawOrder=this._drawOrder,this._model.meshInstances.push(this._meshInstance),this._meshInstance.setParameter(i,this._color.data3),this._meshInstance.setParameter(s,this._color.data[3]),this.enabled&&this.entity.enabled&&this._showModel()),this._meshInstance.material!==l&&(this._meshInstance.material=l),this._meshInstance.mesh!==o&&(this._meshInstance.mesh=o,this._meshInstance.visible=!0,this._meshInstance._aabbVer=-1),this.sprite.atlas&&this.sprite.atlas.texture?(this._meshInstance.setParameter(e,this.sprite.atlas.texture),this._meshInstance.setParameter(t,this.sprite.atlas.texture)):(this._meshInstance.deleteParameter(e),this._meshInstance.deleteParameter(t)),!this.sprite.atlas||this.sprite.renderMode!==n.SPRITE_RENDERMODE_SLICED&&this.sprite.renderMode!==n.SPRITE_RENDERMODE_TILED)this._meshInstance._updateAabbFunc=null;else{this._meshInstance._updateAabbFunc=this._updateAabbFunc;var c=this.sprite.atlas.frames[this.sprite.frameKeys[r]];if(c){var d=2/c.rect.z,u=2/c.rect.w;this._innerOffset.set(c.border.x*d,c.border.y*u,c.border.z*d,c.border.w*u);var f=this.sprite.atlas.texture;this._atlasRect.set(c.rect.x/f.width,c.rect.y/f.height,c.rect.z/f.width,c.rect.w/f.height)}else this._innerOffset.set(0,0,0,0);this._meshInstance.setParameter(a,this._innerOffset.data),this._meshInstance.setParameter(h,this._atlasRect.data)}this._updateTransform()}},_updateTransform:function(){var e=this.flipX?-1:1,t=this.flipY?-1:1,i=0,r=0;if(this.sprite&&(this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED||this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED)){var s=1,a=1;if(this.sprite.atlas){var h=this.sprite.atlas.frames[this.sprite.frameKeys[this.frame]];h&&(s=h.rect.z,a=h.rect.w,i=(.5-h.pivot.x)*this._width,r=(.5-h.pivot.y)*this._height)}var l=s/this.sprite.pixelsPerUnit,c=a/this.sprite.pixelsPerUnit;this._outerScale.set(Math.max(this._width,this._innerOffset.x*l),Math.max(this._height,this._innerOffset.y*c)),e*=l,t*=c,this._outerScale.x/=l,this._outerScale.y/=c,e*=n.math.clamp(this._width/(this._innerOffset.x*l),1e-4,1),t*=n.math.clamp(this._height/(this._innerOffset.y*c),1e-4,1),this._meshInstance&&this._meshInstance.setParameter(o,this._outerScale.data,4294967295)}this._node.setLocalScale(e,t,1),this._node.setLocalPosition(i,r,0)},_updateAabb:function(e){return e.center.set(0,0,0),e.halfExtents.set(.5*this._outerScale.x,.5*this._outerScale.y,.001),e.setFromTransformedAabb(e,this._node.getWorldTransform()),e},_tryAutoPlay:function(){if(this._autoPlayClip&&this.type===n.SPRITETYPE_ANIMATED){var e=this._clips[this._autoPlayClip];!e||e.isPlaying||this._currentClip&&this._currentClip.isPlaying||this.enabled&&this.entity.enabled&&this.play(e.name)}},_onLayersChanged:function(e,t){e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this),this.enabled&&this.entity.enabled&&this._showModel()},_onLayerAdded:function(e){var t=this.layers.indexOf(e.id);t<0||this._addedModel&&this.enabled&&this.entity.enabled&&this._meshInstance&&e.addMeshInstances([this._meshInstance])},_onLayerRemoved:function(e){if(this._meshInstance){var t=this.layers.indexOf(e.id);t<0||e.removeMeshInstances([this._meshInstance])}},addClip:function(e){var t=new n.SpriteAnimationClip(this,{name:e.name,fps:e.fps,loop:e.loop,spriteAsset:e.spriteAsset});return this._clips[e.name]=t,t.name&&t.name===this._autoPlayClip&&this._tryAutoPlay(),t},removeClip:function(e){delete this._clips[e]},clip:function(e){return this._clips[e]},play:function(e){var t=this._clips[e],i=this._currentClip;return i&&i!==t&&(i._playing=!1),this._currentClip=t,this._currentClip?(this._currentClip=t,this._currentClip.play()):r("Trying to play sprite animation "+e+" which does not exist."),t},pause:function(){this._currentClip!==this._defaultClip&&this._currentClip.isPlaying&&this._currentClip.pause()},resume:function(){this._currentClip!==this._defaultClip&&this._currentClip.isPaused&&this._currentClip.resume()},stop:function(){this._currentClip!==this._defaultClip&&this._currentClip.stop()}}),Object.defineProperty(l.prototype,"type",{get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this._type===n.SPRITETYPE_SIMPLE?(this.stop(),this._currentClip=this._defaultClip,this.enabled&&this.entity.enabled&&(this._currentClip.frame=this.frame,this._currentClip.sprite?this._showModel():this._hideModel())):this._type===n.SPRITETYPE_ANIMATED&&(this.stop(),this._autoPlayClip&&this._tryAutoPlay(),this._currentClip&&this._currentClip.isPlaying&&this.enabled&&this.entity.enabled?this._showModel():this._hideModel()))}}),Object.defineProperty(l.prototype,"frame",{get:function(){return this._currentClip.frame},set:function(e){this._currentClip.frame=e}}),Object.defineProperty(l.prototype,"spriteAsset",{get:function(){return this._defaultClip._spriteAsset},set:function(e){this._defaultClip.spriteAsset=e}}),Object.defineProperty(l.prototype,"sprite",{get:function(){return this._currentClip.sprite},set:function(e){this._currentClip.sprite=e}}),Object.defineProperty(l.prototype,"material",{get:function(){return this._material},set:function(e){this._material=e,this._meshInstance&&(this._meshInstance.material=e)}}),Object.defineProperty(l.prototype,"color",{get:function(){return this._color},set:function(e){this._color.data[0]=e.data[0],this._color.data[1]=e.data[1],this._color.data[2]=e.data[2],this._meshInstance&&this._meshInstance.setParameter(i,this._color.data3)}}),Object.defineProperty(l.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(e){this._color.data[3]=e,this._meshInstance&&this._meshInstance.setParameter(s,e)}}),Object.defineProperty(l.prototype,"clips",{get:function(){return this._clips},set:function(e){var t,i;if(e){for(t in this._clips){var n=!1;for(i in e)if(e[i].name===t){n=!0,this._clips[t].fps=e[i].fps,this._clips[t].loop=e[i].loop,e[i].hasOwnProperty("sprite")?this._clips[t].sprite=e[i].sprite:e[i].hasOwnProperty("spriteAsset")&&(this._clips[t].spriteAsset=e[i].spriteAsset);break}n||this.removeClip(t)}for(i in e)this._clips[e[i].name]||this.addClip(e[i]);this._autoPlayClip&&this._tryAutoPlay(),this._currentClip&&this._currentClip.sprite||this._hideModel()}else for(t in this._clips)this.removeClip(t)}}),Object.defineProperty(l.prototype,"currentClip",{get:function(){return this._currentClip}}),Object.defineProperty(l.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e}}),Object.defineProperty(l.prototype,"flipX",{get:function(){return this._flipX},set:function(e){this._flipX!==e&&(this._flipX=e,this._updateTransform())}}),Object.defineProperty(l.prototype,"flipY",{get:function(){return this._flipY},set:function(e){this._flipY!==e&&(this._flipY=e,this._updateTransform())}}),Object.defineProperty(l.prototype,"width",{get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._outerScale.x=this._width,!this.sprite||this.sprite.renderMode!==n.SPRITE_RENDERMODE_TILED&&this.sprite.renderMode!==n.SPRITE_RENDERMODE_SLICED||this._updateTransform())}}),Object.defineProperty(l.prototype,"height",{get:function(){return this._height},set:function(e){e!==this._height&&(this._height=e,this._outerScale.y=this.height,!this.sprite||this.sprite.renderMode!==n.SPRITE_RENDERMODE_TILED&&this.sprite.renderMode!==n.SPRITE_RENDERMODE_SLICED||this._updateTransform())}}),Object.defineProperty(l.prototype,"batchGroupId",{get:function(){return this._batchGroupId},set:function(e){if(this._batchGroupId!==e){var t=this._batchGroupId;this._batchGroupId=e,t>=0&&this.system.app.batcher.markGroupDirty(t),this._batchGroupId>=0?this.system.app.batcher.markGroupDirty(this._batchGroupId):t>=0&&this._currentClip&&this._currentClip.sprite&&this.enabled&&this.entity.enabled&&this._showModel()}}}),Object.defineProperty(l.prototype,"autoPlayClip",{get:function(){return this._autoPlayClip},set:function(e){this._autoPlayClip=e instanceof n.SpriteAnimationClip?e.name:e,this._tryAutoPlay()}}),Object.defineProperty(l.prototype,"drawOrder",{get:function(){return this._drawOrder},set:function(e){this._drawOrder=e,this._meshInstance&&(this._meshInstance.drawOrder=e)}}),Object.defineProperty(l.prototype,"layers",{get:function(){return this._layers},set:function(e){this._addedModel&&this._hideModel(),this._layers=e,this._meshInstance&&this.enabled&&this.entity.enabled&&this._showModel()}}),{SpriteComponent:l}}()),Object.assign(n,function(){var e=["enabled"],t=!1,i=["varying vec2 vMask;","varying vec2 vTiledUv;","uniform vec4 innerOffset;","uniform vec2 outerScale;","uniform vec4 atlasRect;","vec2 nineSlicedUv;"].join("\n"),r=["vec2 tileMask = step(vMask, vec2(0.99999));","vec2 clampedUv = mix(innerOffset.xy*0.5, vec2(1.0) - innerOffset.zw*0.5, fract(vTiledUv));","clampedUv = clampedUv * atlasRect.zw + atlasRect.xy;","nineSlicedUv = vUv0 * tileMask + clampedUv * (vec2(1.0) - tileMask);"].join("\n"),s=function(t){n.ComponentSystem.call(this,t),this.id="sprite",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.SpriteComponent,this.DataType=n.SpriteComponentData,this.schema=e,this._defaultTexture=new n.Texture(t.graphicsDevice,{width:1,height:1,format:n.PIXELFORMAT_R8_G8_B8_A8});var s=this._defaultTexture.lock(),a=new Uint8Array(4);a[0]=255,a[1]=255,a[2]=255,a[3]=255,s.set(a),this._defaultTexture.unlock(),this.defaultMaterial=new n.StandardMaterial,this.defaultMaterial.diffuse=new n.Color(0,0,0,1),this.defaultMaterial.emissive=new n.Color(.5,.5,.5,1),this.defaultMaterial.emissiveMap=this._defaultTexture,this.defaultMaterial.emissiveMapTint=!0,this.defaultMaterial.opacityMap=this._defaultTexture,this.defaultMaterial.opacityMapChannel="a",this.defaultMaterial.opacityTint=!0,this.defaultMaterial.opacity=0,this.defaultMaterial.useLighting=!1,this.defaultMaterial.useGammaTonemap=!1,this.defaultMaterial.useFog=!1,this.defaultMaterial.useSkybox=!1,this.defaultMaterial.blendType=n.BLEND_PREMULTIPLIED,this.defaultMaterial.depthWrite=!1,this.defaultMaterial.pixelSnap=!1,this.defaultMaterial.cull=n.CULLFACE_NONE,this.defaultMaterial.update(),this.default9SlicedMaterialSlicedMode=this.defaultMaterial.clone(),this.default9SlicedMaterialSlicedMode.chunks.basePS=n.shaderChunks.basePS+i,this.default9SlicedMaterialSlicedMode.chunks.startPS=n.shaderChunks.startPS+"nineSlicedUv = vUv0;\n",this.default9SlicedMaterialSlicedMode.chunks.emissivePS=n.shaderChunks.emissivePS.replace("$UV","nineSlicedUv"),this.default9SlicedMaterialSlicedMode.chunks.opacityPS=n.shaderChunks.opacityPS.replace("$UV","nineSlicedUv"),this.default9SlicedMaterialSlicedMode.chunks.transformVS="#define NINESLICED\n"+n.shaderChunks.transformVS,this.default9SlicedMaterialSlicedMode.chunks.uv0VS=n.shaderChunks.uv9SliceVS,this.default9SlicedMaterialSlicedMode.update(),this.default9SlicedMaterialTiledMode=this.defaultMaterial.clone(),this.default9SlicedMaterialTiledMode.chunks.basePS=n.shaderChunks.basePS+"#define NINESLICETILED\n"+i,this.default9SlicedMaterialTiledMode.chunks.startPS=n.shaderChunks.startPS+r,this.default9SlicedMaterialTiledMode.chunks.emissivePS=n.shaderChunks.emissivePS.replace("$UV","nineSlicedUv, -1000.0"),this.default9SlicedMaterialTiledMode.chunks.opacityPS=n.shaderChunks.opacityPS.replace("$UV","nineSlicedUv, -1000.0"),this.default9SlicedMaterialTiledMode.chunks.transformVS="#define NINESLICED\n"+n.shaderChunks.transformVS,this.default9SlicedMaterialTiledMode.chunks.uv0VS=n.shaderChunks.uv9SliceVS,this.default9SlicedMaterialTiledMode.update(),n.ComponentSystem.on("update",this.onUpdate,this),this.on("beforeremove",this.onBeforeRemove,this)};return s.prototype=Object.create(n.ComponentSystem.prototype),s.prototype.constructor=s,n.Component._buildAccessors(n.SpriteComponent.prototype,e),Object.assign(s.prototype,{initializeComponentData:function(e,i,r){if(void 0!==i.enabled&&(e.enabled=i.enabled),e.type=i.type,i.layers&&"array"===n.type(i.layers)&&(e.layers=i.layers.slice(0)),void 0!==i.drawOrder&&(e.drawOrder=i.drawOrder),void 0!==i.color&&(i.color instanceof n.Color?e.color.set(i.color.data[0],i.color.data[1],i.color.data[2],void 0!==i.opacity?i.opacity:1):e.color.set(i.color[0],i.color[1],i.color[2],void 0!==i.opacity?i.opacity:1),e.color=e.color),void 0!==i.opacity&&(e.opacity=i.opacity),void 0!==i.flipX&&(e.flipX=i.flipX),void 0!==i.flipY&&(e.flipY=i.flipY),void 0!==i.width&&(e.width=i.width),void 0!==i.height&&(e.height=i.height),void 0!==i.spriteAsset&&(e.spriteAsset=i.spriteAsset),i.sprite&&(e.sprite=i.sprite),void 0!==i.frame&&(e.frame=i.frame),i.clips)for(var s in i.clips)e.addClip(i.clips[s]);void 0!==i.speed&&(e.speed=i.speed),i.autoPlayClip&&(e.autoPlayClip=i.autoPlayClip),e.batchGroupId=void 0===i.batchGroupId||null===i.batchGroupId?-1:i.batchGroupId,n.ComponentSystem.prototype.initializeComponentData.call(this,e,i,r),t||(console.warn("The Sprite component is in beta and might change without notice."),t=!0)},cloneComponent:function(e,t){var i=e.sprite;return this.addComponent(t,{enabled:i.enabled,type:i.type,spriteAsset:i.spriteAsset,sprite:i.sprite,frame:i.frame,color:i.color.clone(),opacity:i.opacity,flipX:i.flipX,flipY:i.flipY,speed:i.speed,clips:i.clips,batchGroupId:i.batchGroupId})},onUpdate:function(e){var t=this.store;for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(n.data.enabled&&n.entity.enabled){var r=n.entity.sprite;r._currentClip&&r._currentClip._update(e)}}},onBeforeRemove:function(e,t){t.onDestroy()}}),{SpriteComponentSystem:s}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{SpriteComponentData:e}}()),Object.assign(n,function(){n.SCALEMODE_NONE="none",n.SCALEMODE_BLEND="blend";var e=function(e,t){n.Component.call(this,e,t),this._resolution=new n.Vec2(640,320),this._referenceResolution=new n.Vec2(640,320),this._scaleMode=n.SCALEMODE_NONE,this.scale=1,this._scaleBlend=.5,this._screenSpace=!1,this._screenMatrix=new n.Mat4,e.app.graphicsDevice.on("resizecanvas",this._onResize,this)};e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e;var t=new n.Mat4;return Object.assign(e.prototype,{syncDrawOrder:function(){var e=1,t=function(i){i.element&&(i.element.drawOrder=e++);for(var n=i.getChildren(),r=0;r<n.length;r++)t(n[r])};t(this.entity)},_calcProjectionMatrix:function(){var e,i,n,r,s=1,a=-1,o=this._resolution.x/this.scale,h=this._resolution.y/this.scale;e=0,i=o,n=-h,r=0,this._screenMatrix.setOrtho(e,i,n,r,s,a),this._screenSpace||(t.setScale(.5*o,.5*h,1),this._screenMatrix.mul2(t,this._screenMatrix))},_updateScale:function(){this.scale=this._calcScale(this._resolution,this.referenceResolution)},_calcScale:function(e,t){var i=Math.log2(e.x/t.x),n=Math.log2(e.y/t.y);return Math.pow(2,i*(1-this._scaleBlend)+n*this._scaleBlend)},_onResize:function(e,t){this._screenSpace&&(this._resolution.set(e,t),this.resolution=this._resolution)},onRemove:function(){this.system.app.graphicsDevice.off("resizecanvas",this._onResize,this),this.fire("remove")}}),Object.defineProperty(e.prototype,"resolution",{set:function(e){this._screenSpace?this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height):this._resolution.set(e.x,e.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtify(!0),this.fire("set:resolution",this._resolution)},get:function(){return this._resolution}}),Object.defineProperty(e.prototype,"referenceResolution",{set:function(e){this._referenceResolution.set(e.x,e.y),this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtify(!0),this.fire("set:referenceresolution",this._resolution)},get:function(){return this._scaleMode===n.SCALEMODE_NONE?this._resolution:this._referenceResolution}}),Object.defineProperty(e.prototype,"screenSpace",{set:function(e){this._screenSpace=e,this._screenSpace&&this._resolution.set(this.system.app.graphicsDevice.width,this.system.app.graphicsDevice.height),this.resolution=this._resolution,this.entity._dirtyLocal||this.entity._dirtify(!0),this.fire("set:screenspace",this._screenSpace)},get:function(){return this._screenSpace}}),Object.defineProperty(e.prototype,"scaleMode",{set:function(e){e!==n.SCALEMODE_NONE&&e!==n.SCALEMODE_BLEND&&(e=n.SCALEMODE_NONE),this._screenSpace||e===n.SCALEMODE_NONE||(e=n.SCALEMODE_NONE),this._scaleMode=e,this.resolution=this._resolution,this.fire("set:scalemode",this._scaleMode)},get:function(){return this._scaleMode}}),Object.defineProperty(e.prototype,"scaleBlend",{set:function(e){this._scaleBlend=e,this._updateScale(),this._calcProjectionMatrix(),this.entity._dirtyLocal||this.entity._dirtify(!0),this.fire("set:scaleblend",this._scaleBlend)},get:function(){return this._scaleBlend}}),{ScreenComponent:e}}()),Object.assign(n,function(){var e=["enabled"],t=function(t){n.ComponentSystem.call(this,t),this.id="screen",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ScreenComponent,this.DataType=n.ScreenComponentData,this.schema=e,this.windowResolution=new n.Vec2,this.app.graphicsDevice.on("resizecanvas",this._onResize,this),n.ComponentSystem.on("update",this._onUpdate,this),this.on("beforeremove",this.onRemoveComponent,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ScreenComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){void 0!==t.screenSpace&&(e.screenSpace=t.screenSpace),void 0!==t.scaleMode&&(e.scaleMode=t.scaleMode),void 0!==t.scaleBlend&&(e.scaleBlend=t.scaleBlend),void 0!==t.resolution&&(t.resolution instanceof n.Vec2?e._resolution.copy(t.resolution):e._resolution.set(t.resolution[0],t.resolution[1]),e.resolution=e._resolution),void 0!==t.referenceResolution&&(t.referenceResolution instanceof n.Vec2?e._referenceResolution.copy(t.referenceResolution):e._referenceResolution.set(t.referenceResolution[0],t.referenceResolution[1]),e.referenceResolution=e._referenceResolution),n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},_onUpdate:function(e){var t=this.store;for(var i in t)t[i].entity.screen.update&&t[i].entity.screen.update(e)},_onResize:function(e,t){this.windowResolution.x=e,this.windowResolution.y=t},cloneComponent:function(e,t){var i=e.screen;return this.addComponent(t,{enabled:i.enabled,screenSpace:i.screenSpace,scaleMode:i.scaleMode,resolution:i.resolution.clone(),referenceResolution:i.referenceResolution.clone()})},onRemoveComponent:function(e,t){t.onRemove()}}),{ScreenComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ScreenComponentData:e}}()),Object.assign(n,function(){var e=[],t=!1;n.ELEMENTTYPE_GROUP="group",n.ELEMENTTYPE_IMAGE="image",n.ELEMENTTYPE_TEXT="text";var i=new n.Vec3,r=new n.Vec3,s=new n.Mat4,a=new n.Mat4,o=new n.Mat4,h=new n.Mat4,l=function(e,t){n.Component.call(this,e,t),this._anchor=new n.Vec4,this._localAnchor=new n.Vec4,this._pivot=new n.Vec2,this._width=this._calculatedWidth=32,this._height=this._calculatedHeight=32,this._margin=new n.Vec4(0,0,(-32),(-32)),this._modelTransform=new n.Mat4,this._screenToWorld=new n.Mat4,this._anchorTransform=new n.Mat4,this._anchorDirty=!0,this._parentWorldTransform=new n.Mat4,this._screenTransform=new n.Mat4,this._screenCorners=[new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3],this._canvasCorners=[new n.Vec2,new n.Vec2,new n.Vec2,new n.Vec2],this._worldCorners=[new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3],this._cornersDirty=!0,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this.entity.on("insert",this._onInsert,this),this._patch(),this.screen=null,this._type=n.ELEMENTTYPE_GROUP,this._image=null,this._text=null,this._group=null,this._useInput=!1,this._layers=[n.LAYERID_UI],this._addedModel=null,this._batchGroupId=-1};l.prototype=Object.create(n.Component.prototype),l.prototype.constructor=l,Object.assign(l.prototype,{_patch:function(){this.entity._sync=this._sync,this.entity.setPosition=this._setPosition,this.entity.setLocalPosition=this._setLocalPosition},_unpatch:function(){this.entity._sync=n.Entity.prototype._sync,this.entity.setPosition=n.Entity.prototype.setPosition,this.entity.setLocalPosition=n.Entity.prototype.setLocalPosition},_setPosition:function(){var e=new n.Vec3,t=new n.Mat4;return function(i,r,s){return this.element.screen?(i instanceof n.Vec3?e.copy(i):e.set(i,r,s),this.getWorldTransform(),t.copy(this.element._screenToWorld).invert(),t.transformPoint(e,this.localPosition),void(this._dirtyLocal||this._dirtify(!0))):n.Entity.prototype.setPosition.call(this,i,r,s)}}(),_setLocalPosition:function(e,t,i){e instanceof n.Vec3?this.localPosition.copy(e):this.localPosition.set(e,t,i);var r=this.element,s=this.localPosition.data,a=r._pivot.data;r._margin.data[0]=s[0]-r._calculatedWidth*a[0],r._margin.data[2]=r._localAnchor.data[2]-r._localAnchor.data[0]-r._calculatedWidth-r._margin.data[0],r._margin.data[1]=s[1]-r._calculatedHeight*a[1],r._margin.data[3]=r._localAnchor.data[3]-r._localAnchor.data[1]-r._calculatedHeight-r._margin.data[1],this._dirtyLocal||this._dirtify(!0)},_sync:function(){var e=this.element,t=e.screen;if(t){if(e._anchorDirty){var h=0,l=0,c=0,d=1;if(this._parent&&this._parent.element)h=this._parent.element.calculatedWidth,l=this._parent.element.calculatedHeight,c=this._parent.element.pivot.x,d=this._parent.element.pivot.y;else{var u=t.screen.resolution;h=u.x/t.screen.scale,l=u.y/t.screen.scale}e._anchorTransform.setTranslate(h*(e.anchor.x-c),-(l*(d-e.anchor.y)),0),e._anchorDirty=!1,e._calculateLocalAnchors()}e._sizeDirty&&e._calculateSize()}if(this._dirtyLocal){this.localTransform.setTRS(this.localPosition,this.localRotation,this.localScale);var f=this.localPosition.data,p=e._pivot.data;e._margin.data[0]=f[0]-e._calculatedWidth*p[0],e._margin.data[2]=e._localAnchor.data[2]-e._localAnchor.data[0]-e._calculatedWidth-e._margin.data[0],e._margin.data[1]=f[1]-e._calculatedHeight*p[1],e._margin.data[3]=e._localAnchor.data[3]-e._localAnchor.data[1]-e._calculatedHeight-e._margin.data[1],this._dirtyLocal=!1}if(!t)return this._dirtyWorld&&(e._cornersDirty=!0,e._canvasCornersDirty=!0,e._worldCornersDirty=!0),n.Entity.prototype._sync.call(this);if(this._dirtyWorld){if(null===this._parent)this.worldTransform.copy(this.localTransform);else if(this._parent.element?e._screenToWorld.mul2(this._parent.element._modelTransform,e._anchorTransform):e._screenToWorld.copy(e._anchorTransform),e._modelTransform.mul2(e._screenToWorld,this.localTransform),t){e._screenToWorld.mul2(t.screen._screenMatrix,e._screenToWorld),t.screen.screenSpace||e._screenToWorld.mul2(t.worldTransform,e._screenToWorld),this.worldTransform.mul2(e._screenToWorld,this.localTransform);var _=e._parentWorldTransform;_.setIdentity();var m=this._parent;m&&m.element&&m!==t&&(s.setTRS(n.Vec3.ZERO,m.getLocalRotation(),m.getLocalScale()),_.mul2(m.element._parentWorldTransform,s));var A=i;A.set(0,0,this.localPosition.z);var v=r;v.set(e._absLeft+e._pivot.x*e.calculatedWidth,e._absBottom+e._pivot.y*e.calculatedHeight,0),s.setTranslate(-v.x,-v.y,-v.z),a.setTRS(A,this.getLocalRotation(),this.getLocalScale()),o.setTranslate(v.x,v.y,v.z),e._screenTransform.mul2(e._parentWorldTransform,o).mul(a).mul(s),e._cornersDirty=!0,e._canvasCornersDirty=!0,e._worldCornersDirty=!0}else this.worldTransform.copy(e._modelTransform);this._dirtyWorld=!1}},_onInsert:function(e){var t=this._parseUpToScreen();this.entity._dirtify(),this._updateScreen(t.screen),this._dirtifyMask()},_dirtifyMask:function(){for(var e=this.entity;e;){var i=e.getParent();if((null===i||i.screen)&&e.element){this.system._prerender&&this.system._prerender.length||(this.system._prerender=[],this.system.app.once("prerender",this._onPrerender,this),t&&console.log("register prerender"));var n=this.system._prerender.indexOf(this.entity);n>=0&&this.system._prerender.splice(n,1);var r=this.system._prerender.indexOf(e);r<0&&this.system._prerender.push(e),t&&console.log("set prerender root to: "+e.name)}e=i}},_onPrerender:function(){for(var e=0,i=0;i<this.system._prerender.length;i++){var n=this.system._prerender[i];t&&console.log("prerender from: "+n.name),n.element&&(e=n.element.syncMask(e)+1)}this.system._prerender.length=0},_updateScreen:function(e){this.screen&&this.screen!==e&&(this.screen.screen.off("set:resolution",this._onScreenResize,this),this.screen.screen.off("set:referenceresolution",this._onScreenResize,this),this.screen.screen.off("set:scaleblend",this._onScreenResize,this),this.screen.screen.off("set:screenspace",this._onScreenSpaceChange,this),this.screen.screen.off("remove",this._onScreenRemove,this)),this.screen=e,this.screen&&(this.screen.screen.on("set:resolution",this._onScreenResize,this),this.screen.screen.on("set:referenceresolution",this._onScreenResize,this),this.screen.screen.on("set:scaleblend",this._onScreenResize,this),this.screen.screen.on("set:screenspace",this._onScreenSpaceChange,this),this.screen.screen.on("remove",this._onScreenRemove,this)),this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("set:screen",this.screen),this._anchorDirty=!0;for(var t=this.entity.getChildren(),i=0,n=t.length;i<n;i++)t[i].element&&t[i].element._updateScreen(e);this.screen&&this.screen.screen.syncDrawOrder()},syncMask:function(e){var t=this._parseUpToScreen();return this._updateMask(t.mask,e)},_setMaskedBy:function(e){var i,r,s,a=this._image||this._text;if(a)if(e){var o=e.element._image._maskRef;t&&console.log("masking: "+this.entity.name+" with "+o);var h=new n.StencilParameters({ref:o,func:n.FUNC_EQUAL});for(i=0,s=a._model.meshInstances.length;i<s;i++)r=a._model.meshInstances[i],r.stencilFront=r.stencilBack=h;a._maskedBy=e}else{for(t&&console.log("no masking on: "+this.entity.name),i=0,s=a._model.meshInstances.length;i<s;i++)r=a._model.meshInstances[i],r.stencilFront=r.stencilBack=null;a._maskedBy=null}},_getMaskDepth:function(){for(var e=1,t=this.entity;t;)t=t.getParent(),t&&t.element&&t.element.mask&&e++;return e},_updateMask:function(e,i){var r,s,a,o;if(i||(i=1),e)for(this._setMaskedBy(e),this.mask&&(t&&console.log("masking: "+this.entity.name+" with "+i),a=new n.StencilParameters({ref:i++,func:n.FUNC_EQUAL,zpass:n.STENCILOP_INCREMENT}),this._image._meshInstance.stencilFront=a,this._image._meshInstance.stencilBack=a,this._image._maskRef=i,t&&console.log("masking from: "+this.entity.name+" with "+i),e=this.entity),o=this.entity.getChildren(),r=0,s=o.length;r<s;r++)o[r].element&&o[r].element._updateMask(e,i);else for(this._setMaskedBy(null),this.mask&&(a=new n.StencilParameters({func:n.FUNC_ALWAYS,zpass:n.STENCILOP_REPLACE,ref:i}),this._image._meshInstance.stencilFront=a,this._image._meshInstance.stencilBack=a,this._image._maskRef=i,t&&console.log("masking from: "+this.entity.name+" with "+i),e=this.entity),o=this.entity.getChildren(),r=0,s=o.length;r<s;r++)o[r].element&&o[r].element._updateMask(e,i);return i},_parseUpToScreen:function(){for(var e={screen:null,mask:null},t=this.entity._parent;t&&!t.screen;)t.element&&t.element.mask&&(e.mask||(e.mask=t)),t=t.parent;return t&&t.screen&&(e.screen=t),e},_onScreenResize:function(e){this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY),this.fire("screen:set:resolution",e)},_onScreenSpaceChange:function(){this.fire("screen:set:screenspace",this.screen.screen.screenSpace)},_onScreenRemove:function(){this._updateScreen(null)},_calculateLocalAnchors:function(){var e=1e3,t=1e3,i=this.entity._parent;if(i&&i.element)e=i.element.calculatedWidth,t=i.element.calculatedHeight;else if(this.screen){var n=this.screen.screen.resolution,r=this.screen.screen.scale;e=n.x/r,t=n.y/r}this._localAnchor.set(this._anchor.x*e,this._anchor.y*t,this._anchor.z*e,this._anchor.w*t)},getOffsetPosition:function(e,t){var i=this.entity.getLocalPosition().clone();return i.x+=e,i.y+=t,this._screenToWorld.transformPoint(i,i),i},onLayersChanged:function(e,t){this.addModelToLayers(this._image?this._image._model:this._text._model),e.off("add",this.onLayerAdded,this),e.off("remove",this.onLayerRemoved,this),t.on("add",this.onLayerAdded,this),t.on("remove",this.onLayerRemoved,this)},onLayerAdded:function(e){var t=this.layers.indexOf(e.id);t<0||(this._image?e.addMeshInstances(this._image._model.meshInstances):this._text&&e.addMeshInstances(this._text._model.meshInstances))},onLayerRemoved:function(e){var t=this.layers.indexOf(e.id);t<0||(this._image?e.removeMeshInstances(this._image._model.meshInstances):this._text&&e.removeMeshInstances(this._text._model.meshInstances))},onEnable:function(){if(n.Component.prototype.onEnable.call(this),this._image&&this._image.onEnable(),this._text&&this._text.onEnable(),this._group&&this._group.onEnable(),this.useInput&&this.system.app.elementInput&&this.system.app.elementInput.addElement(this),this.mask){var t=this._getMaskDepth();1===t&&(this._topMask=!0,e.indexOf(this)<0&&e.push(this))}this.system.app.scene.on("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.on("add",this.onLayerAdded,this),this.system.app.scene.layers.on("remove",this.onLayerRemoved,this)),this.fire("enableelement")},onDisable:function(){if(n.Component.prototype.onDisable.call(this),this.system.app.scene.off("set:layers",this.onLayersChanged,this),this.system.app.scene.layers&&(this.system.app.scene.layers.off("add",this.onLayerAdded,this),this.system.app.scene.layers.off("remove",this.onLayerRemoved,this)),this._image&&this._image.onDisable(),this._text&&this._text.onDisable(),this._group&&this._group.onDisable(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this._topMask){var t=e.indexOf(this);t>=0&&e.splice(t,1),this._topMask=!1}this._batchGroupId>=0&&this.system.app.batcher.markGroupDirty(this.batchGroupId),this.fire("disableelement")},onRemove:function(){if(this.entity.off("insert",this._onInsert,this),this._unpatch(),this._image&&this._image.destroy(),this._text&&this._text.destroy(),this.system.app.elementInput&&this.useInput&&this.system.app.elementInput.removeElement(this),this._topMask){var t=e.indexOf(this);t>=0&&e.splice(t,1),this._topMask=!1}},_calculateSize:function(e,t){if(this.entity._parent||this.screen){this._calculateLocalAnchors();var i=this._absRight-this._absLeft,n=this._absTop-this._absBottom;e?this._setWidth(i):this._setCalculatedWidth(i,!1),t?this._setHeight(n):this._setCalculatedHeight(n,!1);var r=this.entity.getLocalPosition();r.x=this._margin.data[0]+this._calculatedWidth*this._pivot.data[0],r.y=this._margin.data[1]+this._calculatedHeight*this._pivot.data[1],this.entity.setLocalPosition(r),this._sizeDirty=!1}},_setWidth:function(e){this._width=e,this._setCalculatedWidth(e,!1),this.fire("set:width",this._width)},_setHeight:function(e){this._height=e,this._setCalculatedHeight(e,!1),this.fire("set:height",this._height)},_setCalculatedWidth:function(e,t){var i=Math.abs(e-this._calculatedWidth)>1e-4;if(this._calculatedWidth=e,t){var n=this.entity.getLocalPosition().data,r=this._pivot.data;this._margin.data[0]=n[0]-this._calculatedWidth*r[0],this._margin.data[2]=this._localAnchor.data[2]-this._localAnchor.data[0]-this._calculatedWidth-this._margin.data[0];
}this._flagChildrenAsDirty(),this.fire("set:calculatedWidth",this._calculatedWidth),i&&this.fire("resize",this._calculatedWidth,this._calculatedHeight)},_setCalculatedHeight:function(e,t){var i=Math.abs(e-this._calculatedHeight)>1e-4;if(this._calculatedHeight=e,t){var n=this.entity.getLocalPosition().data,r=this._pivot.data;this._margin.data[1]=n[1]-this._calculatedHeight*r[1],this._margin.data[3]=this._localAnchor.data[3]-this._localAnchor.data[1]-this._calculatedHeight-this._margin.data[1]}this._flagChildrenAsDirty(),this.fire("set:calculatedHeight",this._calculatedHeight),i&&this.fire("resize",this._calculatedWidth,this._calculatedHeight)},_flagChildrenAsDirty:function(){var e,t,i=this.entity._children;for(e=0,t=i.length;e<t;e++)i[e].element&&(i[e].element._anchorDirty=!0,i[e].element._sizeDirty=!0)},addModelToLayers:function(e){var t;this._addedModel=e;for(var i=0;i<this.layers.length;i++)t=this.system.app.scene.layers.getLayerById(this.layers[i]),t&&t.addMeshInstances(e.meshInstances)},removeModelFromLayers:function(e){var t;this._addedModel=null;for(var i=0;i<this.layers.length;i++)t=this.system.app.scene.layers.getLayerById(this.layers[i]),t&&t.removeMeshInstances(e.meshInstances)}}),Object.defineProperty(l.prototype,"type",{get:function(){return this._type},set:function(e){e!==this._type&&(this._type=e,this._image&&(this._image.destroy(),this._image=null),this._text&&(this._text.destroy(),this._text=null),e===n.ELEMENTTYPE_IMAGE?this._image=new n.ImageElement(this):e===n.ELEMENTTYPE_TEXT&&(this._text=new n.TextElement(this)))}}),Object.defineProperty(l.prototype,"layers",{get:function(){return this._layers},set:function(e){var t,i;if(this._addedModel)for(t=0;t<this._layers.length;t++)i=this.system.app.scene.layers.getLayerById(this._layers[t]),i&&i.removeMeshInstances(this._addedModel.meshInstances);if(this._layers=e,this.enabled&&this.entity.enabled&&this._addedModel)for(t=0;t<this._layers.length;t++)i=this.system.app.scene.layers.getLayerById(this._layers[t]),i&&i.addMeshInstances(this._addedModel.meshInstances)}}),Object.defineProperty(l.prototype,"drawOrder",{get:function(){return this._drawOrder},set:function(e){this._drawOrder=e,this.fire("set:draworder",this._drawOrder)}}),Object.defineProperty(l.prototype,"_absLeft",{get:function(){return this._localAnchor.data[0]+this._margin.data[0]}}),Object.defineProperty(l.prototype,"_absRight",{get:function(){return this._localAnchor.data[2]-this._margin.data[2]}}),Object.defineProperty(l.prototype,"_absTop",{get:function(){return this._localAnchor.data[3]-this._margin.data[3]}}),Object.defineProperty(l.prototype,"_absBottom",{get:function(){return this._localAnchor.data[1]+this._margin.data[1]}}),Object.defineProperty(l.prototype,"margin",{get:function(){return this._margin},set:function(e){this._margin.copy(e),this._calculateSize(!0,!0),this.fire("set:margin",this._margin)}}),Object.defineProperty(l.prototype,"left",{get:function(){return this._margin.data[0]},set:function(e){this._margin.data[0]=e;var t=this.entity.getLocalPosition(),i=this._absRight,n=this._localAnchor.data[0]+e;this._setWidth(i-n),t.x=e+this._calculatedWidth*this._pivot.data[0],this.entity.setLocalPosition(t)}}),Object.defineProperty(l.prototype,"right",{get:function(){return this._margin.data[2]},set:function(e){this._margin.data[2]=e;var t=this.entity.getLocalPosition(),i=this._absLeft,n=this._localAnchor.data[2]-e;this._setWidth(n-i),t.x=this._localAnchor.data[2]-this._localAnchor.data[0]-e-this._calculatedWidth*(1-this._pivot.data[0]),this.entity.setLocalPosition(t)}}),Object.defineProperty(l.prototype,"top",{get:function(){return this._margin.data[3]},set:function(e){this._margin.data[3]=e;var t=this.entity.getLocalPosition(),i=this._absBottom,n=this._localAnchor.data[3]-e;this._setHeight(n-i),t.y=this._localAnchor.data[3]-this._localAnchor.data[1]-e-this._calculatedHeight*(1-this._pivot.data[1]),this.entity.setLocalPosition(t)}}),Object.defineProperty(l.prototype,"bottom",{get:function(){return this._margin.data[1]},set:function(e){this._margin.data[1]=e;var t=this.entity.getLocalPosition(),i=this._absTop,n=this._localAnchor.data[1]+e;this._setHeight(i-n),t.y=e+this._calculatedHeight*this._pivot.data[1],this.entity.setLocalPosition(t)}}),Object.defineProperty(l.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this._setCalculatedWidth(e,!0),this.fire("set:width",this._width)}}),Object.defineProperty(l.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e,this._setCalculatedHeight(e,!0),this.fire("set:height",this._height)}}),Object.defineProperty(l.prototype,"calculatedWidth",{get:function(){return this._calculatedWidth},set:function(e){this._setCalculatedWidth(e,!0)}}),Object.defineProperty(l.prototype,"calculatedHeight",{get:function(){return this._calculatedHeight},set:function(e){this._setCalculatedHeight(e,!0)}}),Object.defineProperty(l.prototype,"pivot",{get:function(){return this._pivot},set:function(e){var t=this._pivot.x,i=this._pivot.y;e instanceof n.Vec2?this._pivot.set(e.x,e.y):this._pivot.set(e[0],e[1]);var r=this._margin.data[0]+this._margin.data[2],s=this._pivot.x-t;this._margin.data[0]+=r*s,this._margin.data[2]-=r*s;var a=this._margin.data[1]+this._margin.data[3],o=this._pivot.y-i;this._margin.data[1]+=a*o,this._margin.data[3]-=a*o,this._anchorDirty=!0,this._cornersDirty=!0,this._worldCornersDirty=!0,this._calculateSize(),this.fire("set:pivot",this._pivot)}}),Object.defineProperty(l.prototype,"anchor",{get:function(){return this._anchor},set:function(e){e instanceof n.Vec4?this._anchor.set(e.x,e.y,e.z,e.w):this._anchor.set(e[0],e[1],e[2],e[3]),this.entity._parent||this.screen?this._calculateSize(this._hasSplitAnchorsX,this._hasSplitAnchorsY):this._calculateLocalAnchors(),this._anchorDirty=!0,this.entity._dirtyLocal||this.entity._dirtify(!0),this.fire("set:anchor",this._anchor)}}),Object.defineProperty(l.prototype,"_hasSplitAnchorsX",{get:function(){return Math.abs(this._anchor.data[0]-this._anchor.data[2])>.001}}),Object.defineProperty(l.prototype,"_hasSplitAnchorsY",{get:function(){return Math.abs(this._anchor.data[1]-this._anchor.data[3])>.001}}),Object.defineProperty(l.prototype,"screenCorners",{get:function(){if(!this._cornersDirty||!this.screen)return this._screenCorners;var e=this.entity.parent&&this.entity.parent.element&&this.entity.parent.element.screenCorners[0];this._screenCorners[0].set(this._absLeft,this._absBottom,0),this._screenCorners[1].set(this._absRight,this._absBottom,0),this._screenCorners[2].set(this._absRight,this._absTop,0),this._screenCorners[3].set(this._absLeft,this._absTop,0);for(var t=this.screen.screen.screenSpace,i=0;i<4;i++)this._screenTransform.transformPoint(this._screenCorners[i],this._screenCorners[i]),t&&this._screenCorners[i].scale(this.screen.screen.scale),e&&this._screenCorners[i].add(e);return this._cornersDirty=!1,this._canvasCornersDirty=!0,this._worldCornersDirty=!0,this._screenCorners}}),Object.defineProperty(l.prototype,"canvasCorners",{get:function(){if(!this._canvasCornersDirty||!this.screen||!this.screen.screen.screenSpace)return this._canvasCorners;for(var e=this.system.app.graphicsDevice,t=this.screenCorners,i=e.canvas.clientWidth/e.width,n=e.canvas.clientHeight/e.height,r=0;r<4;r++)this._canvasCorners[r].set(t[r].x*i,(e.height-t[r].y)*n);return this._canvasCornersDirty=!1,this._canvasCorners}}),Object.defineProperty(l.prototype,"worldCorners",{get:function(){if(!this._worldCornersDirty)return this._worldCorners;if(this.screen){var e=this.screenCorners;if(!this.screen.screen.screenSpace){s.copy(this.screen.screen._screenMatrix),s.data[13]=-s.data[13],s.mul2(this.screen.getWorldTransform(),s);for(var t=0;t<4;t++)s.transformPoint(e[t],this._worldCorners[t])}}else{var r=this.entity.getLocalPosition();s.setTranslate(-r.x,-r.y,-r.z),a.setTRS(n.Vec3.ZERO,this.entity.getLocalRotation(),this.entity.getLocalScale()),o.setTranslate(r.x,r.y,r.z),h.copy(this.entity.parent.getWorldTransform()),h.mul(o).mul(a).mul(s),i.set(r.x-this.pivot.x*this.calculatedWidth,r.y-this.pivot.y*this.calculatedHeight,r.z),h.transformPoint(i,this._worldCorners[0]),i.set(r.x+(1-this.pivot.x)*this.calculatedWidth,r.y-this.pivot.y*this.calculatedHeight,r.z),h.transformPoint(i,this._worldCorners[1]),i.set(r.x+(1-this.pivot.x)*this.calculatedWidth,r.y+(1-this.pivot.y)*this.calculatedHeight,r.z),h.transformPoint(i,this._worldCorners[2]),i.set(r.x-this.pivot.x*this.calculatedWidth,r.y+(1-this.pivot.y)*this.calculatedHeight,r.z),h.transformPoint(i,this._worldCorners[3])}return this._worldCornersDirty=!1,this._worldCorners}}),Object.defineProperty(l.prototype,"textWidth",{get:function(){return this._text?this._text.width:0}}),Object.defineProperty(l.prototype,"textHeight",{get:function(){return this._text?this._text.height:0}}),Object.defineProperty(l.prototype,"useInput",{get:function(){return this._useInput},set:function(e){this._useInput!==e&&(this._useInput=e,this.system.app.elementInput&&(e?this.enabled&&this.entity.enabled&&this.system.app.elementInput.addElement(this):this.system.app.elementInput.removeElement(this)),this.fire("set:useInput",e))}}),Object.defineProperty(l.prototype,"batchGroupId",{get:function(){return this._batchGroupId},set:function(e){this._batchGroupId!==e&&(this._batchGroupId>=0&&this.system.app.batcher.markGroupDirty(this._batchGroupId),e>=0&&this.system.app.batcher.markGroupDirty(e),e<0&&this._batchGroupId>=0&&this.enabled&&this.entity.enabled&&(this._image._model?this.addModelToLayers(this._image._model):this._text._model&&this.addModelToLayers(this._text._model)),this._batchGroupId=e)}});var c=function(e){Object.defineProperty(l.prototype,e,{get:function(){return this._text?this._text[e]:this._image?this._image[e]:null},set:function(t){this._text?this._text[e]=t:this._image&&(this._image[e]=t)}})};return c("fontSize"),c("color"),c("font"),c("fontAsset"),c("spacing"),c("lineHeight"),c("wrapLines"),c("lines"),c("alignment"),c("autoWidth"),c("autoHeight"),c("text"),c("texture"),c("textureAsset"),c("material"),c("materialAsset"),c("sprite"),c("spriteAsset"),c("spriteFrame"),c("pixelsPerUnit"),c("opacity"),c("rect"),c("mask"),{ElementComponent:l}}()),Object.assign(n,function(){var e=["enabled"],t=["varying vec2 vMask;","varying vec2 vTiledUv;","uniform vec4 innerOffset;","uniform vec2 outerScale;","uniform vec4 atlasRect;","vec2 nineSlicedUv;"].join("\n"),i=["vec2 tileMask = step(vMask, vec2(0.99999));","vec2 clampedUv = mix(innerOffset.xy*0.5, vec2(1.0) - innerOffset.zw*0.5, fract(vTiledUv));","clampedUv = clampedUv * atlasRect.zw + atlasRect.xy;","nineSlicedUv = vUv0 * tileMask + clampedUv * (vec2(1.0) - tileMask);"].join("\n"),r=function(r){n.ComponentSystem.call(this,r),this.id="element",this.app=r,r.systems.add(this.id,this),this.ComponentType=n.ElementComponent,this.DataType=n.ElementComponentData,this.schema=e,this._defaultTexture=new n.Texture(r.graphicsDevice,{width:1,height:1,format:n.PIXELFORMAT_R8_G8_B8_A8});var s=this._defaultTexture.lock(),a=new Uint8Array(4);a[0]=255,a[1]=255,a[2]=255,a[3]=255,s.set(a),this._defaultTexture.unlock(),this._maskMaterials={},this.defaultImageMaterial=new n.StandardMaterial,this.defaultImageMaterial.diffuse.set(0,0,0),this.defaultImageMaterial.emissive.set(.5,.5,.5),this.defaultImageMaterial.emissiveMap=this._defaultTexture,this.defaultImageMaterial.emissiveTint=!0,this.defaultImageMaterial.opacityMap=this._defaultTexture,this.defaultImageMaterial.opacityMapChannel="a",this.defaultImageMaterial.opacityTint=!0,this.defaultImageMaterial.opacity=0,this.defaultImageMaterial.useLighting=!1,this.defaultImageMaterial.useGammaTonemap=!1,this.defaultImageMaterial.useFog=!1,this.defaultImageMaterial.useSkybox=!1,this.defaultImageMaterial.blendType=n.BLEND_PREMULTIPLIED,this.defaultImageMaterial.depthWrite=!1,this.defaultImageMaterial.update(),this.defaultImageMaskMaterial=this.defaultImageMaterial.clone(),this.defaultImageMaskMaterial.alphaTest=1,this.defaultImageMaskMaterial.redWrite=!1,this.defaultImageMaskMaterial.greenWrite=!1,this.defaultImageMaskMaterial.blueWrite=!1,this.defaultImageMaskMaterial.alphaWrite=!1,this.defaultImageMaskMaterial.update(),this.defaultImage9SlicedMaterial=this.defaultImageMaterial.clone(),this.defaultImage9SlicedMaterial.chunks.basePS=n.shaderChunks.basePS+t,this.defaultImage9SlicedMaterial.chunks.startPS=n.shaderChunks.startPS+"nineSlicedUv = vUv0;\n",this.defaultImage9SlicedMaterial.chunks.emissivePS=n.shaderChunks.emissivePS.replace("$UV","nineSlicedUv"),this.defaultImage9SlicedMaterial.chunks.opacityPS=n.shaderChunks.opacityPS.replace("$UV","nineSlicedUv"),this.defaultImage9SlicedMaterial.chunks.transformVS="#define NINESLICED\n"+n.shaderChunks.transformVS,this.defaultImage9SlicedMaterial.chunks.uv0VS=n.shaderChunks.uv9SliceVS,this.defaultImage9SlicedMaterial.update(),this.defaultImage9TiledMaterial=this.defaultImage9SlicedMaterial.clone(),this.defaultImage9TiledMaterial.chunks.basePS=n.shaderChunks.basePS+"#define NINESLICETILED\n"+t,this.defaultImage9TiledMaterial.chunks.startPS=n.shaderChunks.startPS+i,this.defaultImage9TiledMaterial.chunks.emissivePS=n.shaderChunks.emissivePS.replace("$UV","nineSlicedUv, -1000.0"),this.defaultImage9TiledMaterial.chunks.opacityPS=n.shaderChunks.opacityPS.replace("$UV","nineSlicedUv, -1000.0"),this.defaultImage9TiledMaterial.update(),this.defaultImage9SlicedMaskMaterial=this.defaultImage9SlicedMaterial.clone(),this.defaultImage9SlicedMaskMaterial.alphaTest=1,this.defaultImage9SlicedMaskMaterial.redWrite=!1,this.defaultImage9SlicedMaskMaterial.greenWrite=!1,this.defaultImage9SlicedMaskMaterial.blueWrite=!1,this.defaultImage9SlicedMaskMaterial.alphaWrite=!1,this.defaultImage9SlicedMaskMaterial.update(),this.defaultImage9TiledMaskMaterial=this.defaultImage9TiledMaterial.clone(),this.defaultImage9TiledMaskMaterial.alphaTest=1,this.defaultImage9TiledMaskMaterial.redWrite=!1,this.defaultImage9TiledMaskMaterial.greenWrite=!1,this.defaultImage9TiledMaskMaterial.blueWrite=!1,this.defaultImage9TiledMaskMaterial.alphaWrite=!1,this.defaultImage9TiledMaskMaterial.update(),this.defaultScreenSpaceImageMaterial=this.defaultImageMaterial.clone(),this.defaultScreenSpaceImageMaterial.depthTest=!1,this.defaultScreenSpaceImageMaterial.update(),this.defaultScreenSpaceImage9SlicedMaterial=this.defaultImage9SlicedMaterial.clone(),this.defaultScreenSpaceImage9SlicedMaterial.depthTest=!1,this.defaultScreenSpaceImage9SlicedMaterial.update(),this.defaultScreenSpaceImage9TiledMaterial=this.defaultScreenSpaceImage9SlicedMaterial.clone(),this.defaultScreenSpaceImage9TiledMaterial.chunks.basePS=n.shaderChunks.basePS+"#define NINESLICETILED\n"+t,this.defaultScreenSpaceImage9TiledMaterial.chunks.startPS=n.shaderChunks.startPS+i,this.defaultScreenSpaceImage9TiledMaterial.chunks.emissivePS=n.shaderChunks.emissivePS.replace("$UV","nineSlicedUv, -1000.0"),this.defaultScreenSpaceImage9TiledMaterial.chunks.opacityPS=n.shaderChunks.opacityPS.replace("$UV","nineSlicedUv, -1000.0"),this.defaultScreenSpaceImage9TiledMaterial.update(),this.defaultScreenSpaceImageMask9SlicedMaterial=this.defaultScreenSpaceImage9SlicedMaterial.clone(),this.defaultScreenSpaceImageMask9SlicedMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9SlicedMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9SlicedMaterial.update(),this.defaultScreenSpaceImageMask9TiledMaterial=this.defaultScreenSpaceImage9TiledMaterial.clone(),this.defaultScreenSpaceImageMask9TiledMaterial.alphaTest=1,this.defaultScreenSpaceImageMask9TiledMaterial.redWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.greenWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.blueWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMask9TiledMaterial.update(),this.defaultScreenSpaceImageMaskMaterial=this.defaultScreenSpaceImageMaterial.clone(),this.defaultScreenSpaceImageMaskMaterial.alphaTest=1,this.defaultScreenSpaceImageMaskMaterial.redWrite=!1,this.defaultScreenSpaceImageMaskMaterial.greenWrite=!1,this.defaultScreenSpaceImageMaskMaterial.blueWrite=!1,this.defaultScreenSpaceImageMaskMaterial.alphaWrite=!1,this.defaultScreenSpaceImageMaskMaterial.update(),this.defaultTextMaterial=new n.StandardMaterial,this.defaultTextMaterial.msdfMap=this._defaultTexture,this.defaultTextMaterial.useLighting=!1,this.defaultTextMaterial.useGammaTonemap=!1,this.defaultTextMaterial.useFog=!1,this.defaultTextMaterial.useSkybox=!1,this.defaultTextMaterial.diffuse.set(0,0,0),this.defaultTextMaterial.emissive.set(1,1,1),this.defaultTextMaterial.opacity=.5,this.defaultTextMaterial.blendType=n.BLEND_PREMULTIPLIED,this.defaultTextMaterial.depthWrite=!1,this.defaultTextMaterial.update(),this.defaultScreenSpaceTextMaterial=this.defaultTextMaterial.clone(),this.defaultScreenSpaceTextMaterial.depthTest=!1,this.defaultScreenSpaceTextMaterial.update(),this.defaultImageMaterials=[this.defaultImageMaterial,this.defaultImageMaskMaterial,this.defaultImage9SlicedMaterial,this.defaultImage9TiledMaterial,this.defaultImage9SlicedMaskMaterial,this.defaultImage9TiledMaskMaterial,this.defaultScreenSpaceImageMaterial,this.defaultScreenSpaceImage9SlicedMaterial,this.defaultScreenSpaceImage9TiledMaterial,this.defaultScreenSpaceImageMask9SlicedMaterial,this.defaultScreenSpaceImageMask9TiledMaterial,this.defaultScreenSpaceImageMaskMaterial],this.on("beforeremove",this.onRemoveComponent,this)};return r.prototype=Object.create(n.ComponentSystem.prototype),r.prototype.constructor=r,n.Component._buildAccessors(n.ElementComponent.prototype,e),Object.assign(r.prototype,{initializeComponentData:function(e,t,i){void 0!==t.anchor&&(t.anchor instanceof n.Vec4?e.anchor.copy(t.anchor):e.anchor.set(t.anchor[0],t.anchor[1],t.anchor[2],t.anchor[3])),void 0!==t.pivot&&(t.pivot instanceof n.Vec2?e.pivot.copy(t.pivot):e.pivot.set(t.pivot[0],t.pivot[1]));var r=Math.abs(e.anchor.x-e.anchor.z)>.001,s=Math.abs(e.anchor.y-e.anchor.w)>.001,a=!1;void 0!==t.margin&&(t.margin instanceof n.Vec4?e.margin.copy(t.margin):e._margin.set(t.margin[0],t.margin[1],t.margin[2],t.margin[3]),a=!0),void 0!==t.left&&(e._margin.x=t.left,a=!0),void 0!==t.bottom&&(e._margin.y=t.bottom,a=!0),void 0!==t.right&&(e._margin.z=t.right,a=!0),void 0!==t.top&&(e._margin.w=t.top,a=!0),a&&(e.margin=e._margin);var o=!1;if(void 0===t.width||r?r&&(o=!0):e.width=t.width,void 0===t.height||s?s&&(o=!0):e.height=t.height,o&&(e.anchor=e.anchor),void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.useInput&&(e.useInput=t.useInput),e.batchGroupId=void 0===t.batchGroupId||null===t.batchGroupId?-1:t.batchGroupId,t.layers&&"array"===n.type(t.layers)&&(e.layers=t.layers.slice(0)),e.type=t.type,e.type===n.ELEMENTTYPE_IMAGE){if(void 0!==t.rect&&(t.rect instanceof n.Vec4?e.rect.copy(t.rect):e.rect.set(t.rect[0],t.rect[1],t.rect[2],t.rect[3])),void 0!==t.color)t.color instanceof n.Color?e.color.set(t.color.data[0],t.color.data[1],t.color.data[2],void 0!==t.opacity?t.opacity:1):e.color.set(t.color[0],t.color[1],t.color[2],void 0!==t.opacity?t.opacity:1),e.color=e.color;else{var h=t.opacity||1;e.color.set(1,1,1,h),e.color=e.color}void 0!==t.opacity?e.opacity=t.opacity:e.opacity=1,void 0!==t.textureAsset&&(e.textureAsset=t.textureAsset),t.texture&&(e.texture=t.texture),void 0!==t.spriteAsset&&(e.spriteAsset=t.spriteAsset),t.sprite&&(e.sprite=t.sprite),void 0!==t.spriteFrame&&(e.spriteFrame=t.spriteFrame),void 0!==t.pixelsPerUnit&&null!==t.pixelsPerUnit&&(e.pixelsPerUnit=t.pixelsPerUnit),void 0!==t.materialAsset&&(e.materialAsset=t.materialAsset),t.material&&(e.material=t.material),void 0!==t.mask&&(e.mask=t.mask)}else e.type===n.ELEMENTTYPE_TEXT&&(void 0!==t.autoWidth&&(e.autoWidth=t.autoWidth),void 0!==t.autoHeight&&(e.autoHeight=t.autoHeight),void 0!==t.text&&(e.text=t.text),void 0!==t.color&&(t.color instanceof n.Color?e.color.set(t.color.data[0],t.color.data[1],t.color.data[2],void 0!==t.opacity?t.opacity:1):e.color.set(t.color[0],t.color[1],t.color[2],void 0!==t.opacity?t.opacity:1),e.color=e.color),void 0!==t.opacity&&(e.opacity=t.opacity),void 0!==t.spacing&&(e.spacing=t.spacing),void 0!==t.fontSize&&(e.fontSize=t.fontSize,t.lineHeight||(e.lineHeight=t.fontSize)),void 0!==t.lineHeight&&(e.lineHeight=t.lineHeight),void 0!==t.wrapLines&&(e.wrapLines=t.wrapLines),void 0!==t.fontAsset&&(e.fontAsset=t.fontAsset),void 0!==t.font&&(e.font=t.font),void 0!==t.alignment&&(e.alignment=t.alignment));var l=e._parseUpToScreen();l.screen&&e._updateScreen(l.screen),n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},onRemoveComponent:function(e,t){t.onRemove()},cloneComponent:function(e,t){var i=e.element;return this.addComponent(t,{enabled:i.enabled,width:i.width,height:i.height,anchor:i.anchor.clone(),pivot:i.pivot.clone(),margin:i.margin.clone(),alignment:i.alignment&&i.alignment.clone()||i.alignment,autoWidth:i.autoWidth,autoHeight:i.autoHeight,type:i.type,rect:i.rect&&i.rect.clone()||i.rect,materialAsset:i.materialAsset,material:i.material,color:i.color&&i.color.clone()||i.color,opacity:i.opacity,textureAsset:i.textureAsset,texture:i.texture,spriteAsset:i.spriteAsset,sprite:i.sprite,spriteFrame:i.spriteFrame,pixelsPerUnit:i.pixelsPerUnit,text:i.text,spacing:i.spacing,lineHeight:i.lineHeight,wrapLines:i.wrapLines,layers:i.layers,fontSize:i.fontSize,fontAsset:i.fontAsset,font:i.font,useInput:i.useInput,batchGroupId:i.batchGroupId,mask:i.mask})}}),{ElementComponentSystem:r}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ElementComponentData:e}}()),Object.assign(n,function(){var e=function(e){this._element=e,this._entity=e.entity,this._system=e.system,this._textureAsset=null,this._texture=null,this._materialAsset=null,this._material=null,this._spriteAsset=null,this._sprite=null,this._spriteFrame=0,this._pixelsPerUnit=null,this._rect=new n.Vec4(0,0,1,1),this._color=new n.Color(1,1,1,1),this._mask=!1,this._maskRef=0,this._positions=[],this._normals=[],this._uvs=[],this._indices=[],this._outerScale=new n.Vec2,this._innerOffset=new n.Vec4,this._atlasRect=new n.Vec4,this._defaultMesh=this._createMesh(),this._mesh=this._defaultMesh,this._node=new n.GraphNode,this._model=new n.Model,this._model.graph=this._node,this._meshInstance=new n.MeshInstance(this._node,this._mesh,this._material),this._meshInstance.castShadow=!1,this._meshInstance.receiveShadow=!1,this._model.meshInstances.push(this._meshInstance),this._drawOrder=0,this._updateAabbFunc=this._updateAabb.bind(this),this._entity.addChild(this._model.graph),this._model._entity=this._entity,this._onScreenChange(this._element.screen),this._element.on("resize",this._onParentResizeOrPivotChange,this),this._element.on("set:pivot",this._onParentResizeOrPivotChange,this),this._element.on("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.on("set:screen",this._onScreenChange,this),this._element.on("set:draworder",this._onDrawOrderChange,this),this._element.on("screen:set:resolution",this._onResolutionChange,this)};return Object.assign(e.prototype,{destroy:function(){this._model&&(this._element.removeModelFromLayers(this._model),this._meshInstance.mesh=this._defaultMesh,this._model.destroy(),this._model=null),this._element.off("resize",this._onParentResizeOrPivotChange,this),this._element.off("set:pivot",this._onParentResizeOrPivotChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("screen:set:resolution",this._onResolutionChange,this);var e,t=this._system.app;e=this._textureAsset?t.assets.get(this._textureAsset):null,e&&(e.off("load",this._onTextureLoad,this),e.off("change",this._onTextureChange,this),e.off("remove",this._onTextureRemove,this)),e=this._spriteAsset?t.assets.get(this._spriteAsset):null,e&&(e.off("load",this._onSpriteAssetLoad,this),e.off("change",this._onSpriteAssetChange,this),e.off("remove",this._onSpriteAssetRemove,this)),e=this._materialAsset?t.assets.get(this._materialAsset):null,e&&(e.off("load",this._onMaterialLoad,this),e.off("change",this._onMaterialChange,this),e.off("remove",this._onMaterialRemove,this))},_onResolutionChange:function(e){},_onParentResizeOrPivotChange:function(){this._mesh&&this._updateMesh(this._mesh)},_onScreenSpaceChange:function(e){this._updateMaterial(e)},_onScreenChange:function(e){e?this._updateMaterial(e.screen.screenSpace):this._updateMaterial(!1)},_onDrawOrderChange:function(e){this._drawOrder=e,this._meshInstance&&(this._meshInstance.drawOrder=e)},_hasUserMaterial:function(){return!!this._materialAsset||!!this._material&&this._system.defaultImageMaterials.indexOf(this._material)===-1},_use9Slicing:function(){return this.sprite&&(this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED||this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED)},_updateMaterial:function(e){e?(this._hasUserMaterial()||(this._mask?this.sprite?this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED?this._material=this._system.defaultScreenSpaceImageMask9SlicedMaterial:this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED?this._material=this._system.defaultScreenSpaceImageMask9TiledMaterial:this._material=this._system.defaultScreenSpaceImageMaskMaterial:this._material=this._system.defaultScreenSpaceImageMaskMaterial:this.sprite?this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED?this._material=this._system.defaultScreenSpaceImage9SlicedMaterial:this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED?this._material=this._system.defaultScreenSpaceImage9TiledMaterial:this._material=this._system.defaultScreenSpaceImageMaterial:this._material=this._system.defaultScreenSpaceImageMaterial),this._meshInstance&&(this._meshInstance.cull=!1)):(this._hasUserMaterial()||(this._mask?this.sprite?this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED?this._material=this._system.defaultImage9SlicedMaskMaterial:this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED?this._material=this._system.defaultImage9TiledMaskMaterial:this._material=this._system.defaultImageMaskMaterial:this._material=this._system.defaultImageMaskMaterial:this.sprite?this.sprite.renderMode===n.SPRITE_RENDERMODE_SLICED?this._material=this._system.defaultImage9SlicedMaterial:this.sprite.renderMode===n.SPRITE_RENDERMODE_TILED?this._material=this._system.defaultImage9TiledMaterial:this._material=this._system.defaultImageMaterial:this._material=this._system.defaultImageMaterial),this._meshInstance&&(this._meshInstance.cull=!0)),this._meshInstance&&(this._meshInstance.material=this._material,this._meshInstance.screenSpace=e,this._meshInstance.layer=e?n.scene.LAYER_HUD:n.scene.LAYER_WORLD)},_createMesh:function(){var e=this._element.calculatedWidth,t=this._element.calculatedHeight;this._positions[0]=0,this._positions[1]=0,this._positions[2]=0,this._positions[3]=e,this._positions[4]=0,this._positions[5]=0,this._positions[6]=e,this._positions[7]=t,this._positions[8]=0,this._positions[9]=0,this._positions[10]=t,this._positions[11]=0;for(var i=0;i<12;i+=3)this._normals[i]=0,this._normals[i+1]=0,this._normals[i+2]=1;this._uvs[0]=this._rect.data[0],this._uvs[1]=this._rect.data[1],this._uvs[2]=this._rect.data[0]+this._rect.data[2],this._uvs[3]=this._rect.data[1],this._uvs[4]=this._rect.data[0]+this._rect.data[2],this._uvs[5]=this._rect.data[1]+this._rect.data[3],this._uvs[6]=this._rect.data[0],this._uvs[7]=this._rect.data[1]+this._rect.data[3],this._indices[0]=0,this._indices[1]=1,this._indices[2]=3,this._indices[3]=2,this._indices[4]=3,this._indices[5]=1;var r=n.createMesh(this._system.app.graphicsDevice,this._positions,{uvs:this._uvs,normals:this._normals,indices:this._indices});return this._updateMesh(r),r},_updateMesh:function(e){var t,i=this._element.calculatedWidth,r=this._element.calculatedHeight;if(this._element.screen?this._updateMaterial(this._element.screen.screen.screenSpace):this._updateMaterial(),this._meshInstance&&(this._meshInstance._aabbVer=-1),!this.sprite||this.sprite.renderMode!==n.SPRITE_RENDERMODE_SLICED&&this.sprite.renderMode!==n.SPRITE_RENDERMODE_TILED){this._positions[0]=0,this._positions[1]=0,this._positions[2]=0,this._positions[3]=i,this._positions[4]=0,this._positions[5]=0,this._positions[6]=i,this._positions[7]=r,this._positions[8]=0,this._positions[9]=0,this._positions[10]=r,this._positions[11]=0;var s=this._element.pivot.data[0],a=this._element.pivot.data[1];for(t=0;t<this._positions.length;t+=3)this._positions[t]-=s*i,this._positions[t+1]-=a*r;i=1,r=1;var o=this._rect;if(this._sprite&&this._sprite.frameKeys[this._spriteFrame]&&this._sprite.atlas){var h=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]];h&&(o=h.rect,i=this._sprite.atlas.texture.width,r=this._sprite.atlas.texture.height)}this._uvs[0]=o.data[0]/i,this._uvs[1]=o.data[1]/r,this._uvs[2]=(o.data[0]+o.data[2])/i,this._uvs[3]=o.data[1]/r,this._uvs[4]=(o.data[0]+o.data[2])/i,this._uvs[5]=(o.data[1]+o.data[3])/r,this._uvs[6]=o.data[0]/i,this._uvs[7]=(o.data[1]+o.data[3])/r;var l=e.vertexBuffer,c=new n.VertexIterator(l),d=4;for(t=0;t<d;t++)c.element[n.SEMANTIC_POSITION].set(this._positions[3*t+0],this._positions[3*t+1],this._positions[3*t+2]),c.element[n.SEMANTIC_NORMAL].set(this._normals[3*t+0],this._normals[3*t+1],this._normals[3*t+2]),c.element[n.SEMANTIC_TEXCOORD0].set(this._uvs[2*t+0],this._uvs[2*t+1]),c.next();c.end(),e.aabb.compute(this._positions),this._node&&(this._node.setLocalScale(1,1,1),this._node.setLocalPosition(0,0,0)),this._meshInstance&&(this._meshInstance._updateAabbFunc=null)}else{var u=this._sprite.atlas.frames[this._sprite.frameKeys[this._spriteFrame]],f=2/u.rect.z,p=2/u.rect.w;this._innerOffset.set(u.border.x*f,u.border.y*p,u.border.z*f,u.border.w*p);var _=this.sprite.atlas.texture;this._atlasRect.set(u.rect.x/_.width,u.rect.y/_.height,u.rect.z/_.width,u.rect.w/_.height);var m=null!==this._pixelsPerUnit?this._pixelsPerUnit:this.sprite.pixelsPerUnit,A=u.rect.z/m,v=u.rect.w/m;this._outerScale.set(Math.max(i,this._innerOffset.x*A),Math.max(r,this._innerOffset.y*v));var y=A,g=v;this._outerScale.x/=A,this._outerScale.y/=v,y*=n.math.clamp(i/(this._innerOffset.x*A),1e-4,1),g*=n.math.clamp(r/(this._innerOffset.y*v),1e-4,1),this._meshInstance&&(this._meshInstance.setParameter("innerOffset",this._innerOffset.data),this._meshInstance.setParameter("atlasRect",this._atlasRect.data),this._meshInstance.setParameter("outerScale",this._outerScale.data,4294967295),this._meshInstance._updateAabbFunc=this._updateAabbFunc),this._node&&(this._node.setLocalScale(y,g,1),this._node.setLocalPosition((.5-this._element.pivot.x)*i,(.5-this._element.pivot.y)*r,0))}},_updateAabb:function(e){return e.center.set(0,0,0),e.halfExtents.set(.5*this._outerScale.x,.5*this._outerScale.y,.001),e.setFromTransformedAabb(e,this._node.getWorldTransform()),e},_getHigherMask:function(){for(var e=this._entity;e;)if(e=e.getParent(),e&&e.element&&e.element.mask)return e;return null},_toggleMask:function(){this._element._dirtifyMask();var e=!!this._element.screen&&this._element.screen.screen.screenSpace;this._updateMaterial(e)},_onMaterialLoad:function(e){this.material=e.resource},_onMaterialAdded:function(e){this._system.app.assets.off("add:"+e.id,this._onMaterialAdded,this),this._materialAsset===e.id&&this._bindMaterialAsset(e)},_bindMaterialAsset:function(e){e.on("load",this._onMaterialLoad,this),e.on("change",this._onMaterialChange,this),e.on("remove",this._onMaterialRemove,this),e.resource?this._onMaterialLoad(e):this._system.app.assets.load(e)},_onMaterialChange:function(){},_onMaterialRemove:function(){},_onTextureAdded:function(e){this._system.app.assets.off("add:"+e.id,this._onTextureAdded,this),this._textureAsset===e.id&&this._bindTextureAsset(e)},_bindTextureAsset:function(e){e.on("load",this._onTextureLoad,this),e.on("change",this._onTextureChange,this),e.on("remove",this._onTextureRemove,this),e.resource?this._onTextureLoad(e):this._system.app.assets.load(e);
},_onTextureLoad:function(e){this.texture=e.resource},_onTextureChange:function(e){},_onTextureRemove:function(e){},_onSpriteAssetAdded:function(e){this._system.app.assets.off("add:"+e.id,this._onSpriteAssetAdded,this),this._spriteAsset===e.id&&this._bindSpriteAsset(e)},_bindSpriteAsset:function(e){e.on("load",this._onSpriteAssetLoad,this),e.on("change",this._onSpriteAssetChange,this),e.on("remove",this._onSpriteAssetRemove,this),e.resource?this._onSpriteAssetLoad(e):this._system.app.assets.load(e)},_onSpriteAssetLoad:function(e){if(e.resource)if(e.resource.atlas)this.sprite=e.resource;else{var t=e.data.textureAtlasAsset,i=this._system.app.assets;i.off("load:"+t,this._onTextureAtlasLoad,this),i.once("load:"+t,this._onTextureAtlasLoad,this)}else this.sprite=null},_onSpriteMeshesChange:function(){this.spriteFrame=this.spriteFrame},_onSpritePpuChange:function(){this.sprite.renderMode!==n.SPRITE_RENDERMODE_SIMPLE&&null===this._pixelsPerUnit&&(this.spriteFrame=this.spriteFrame)},_onAtlasTextureChange:function(){this.sprite&&this.sprite.atlas&&this.sprite.atlas.texture?(this._meshInstance.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._meshInstance.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._meshInstance.deleteParameter("texture_emissiveMap"),this._meshInstance.deleteParameter("texture_opacityMap"))},_onTextureAtlasLoad:function(e){var t=this._spriteAsset;t instanceof n.Asset?this._onSpriteAssetLoad(t):this._onSpriteAssetLoad(this._system.app.assets.get(t))},_onSpriteAssetChange:function(e){this._onSpriteAssetLoad(e)},_onSpriteAssetRemove:function(e){},onEnable:function(){this._model&&this._element.addModelToLayers(this._model)},onDisable:function(){this._model&&this._element.removeModelFromLayers(this._model)}}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color.data[0]=e.data[0],this._color.data[1]=e.data[1],this._color.data[2]=e.data[2],this._meshInstance&&this._meshInstance.setParameter("material_emissive",this._color.data3),this._element&&this._element.fire("set:color",this._color)}}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(e){this._color.data[3]=e,this._meshInstance.setParameter("material_opacity",e),this._element&&this._element.fire("set:opacity",this._color.data[3])}}),Object.defineProperty(e.prototype,"rect",{get:function(){return this._rect},set:function(e){e instanceof n.Vec4?this._rect.set(e.x,e.y,e.z,e.w):this._rect.set(e[0],e[1],e[2],e[3]),this._mesh&&this._updateMesh(this._mesh)}}),Object.defineProperty(e.prototype,"material",{get:function(){return this._material},set:function(e){if(!e){var t=!!this._element.screen&&this._element.screen.screen.screenSpace;e=t?this._system.defaultScreenSpaceImageMaterial:this._system.defaultImageMaterial,e=this._mask?this._system.defaultScreenSpaceImageMaskMaterial:this._system.defaultImageMaskMaterial}this._material=e,e&&(this._meshInstance.material=e,this._hasUserMaterial()?(this._meshInstance.deleteParameter("material_opacity"),this._meshInstance.deleteParameter("material_emissive")):(this._meshInstance.setParameter("material_emissive",this._color.data3),this._meshInstance.setParameter("material_opacity",this._color.data[3])))}}),Object.defineProperty(e.prototype,"materialAsset",{get:function(){return this._materialAsset},set:function(e){var t=this._system.app.assets,i=e;if(e instanceof n.Asset&&(i=e.id),this._materialAsset!==i){if(this._materialAsset){var r=t.get(this._materialAsset);r&&(r.off("load",this._onMaterialLoad,this),r.off("change",this._onMaterialChange,this),r.off("remove",this._onMaterialRemove,this))}if(this._materialAsset=i,this._materialAsset){var s=t.get(this._materialAsset);s?this._bindMaterialAsset(s):(this.material=null,t.on("add:"+this._materialAsset,this._onMaterialAdded,this))}else this.material=null}}}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,e?(this._meshInstance.setParameter("texture_emissiveMap",this._texture),this._meshInstance.setParameter("texture_opacityMap",this._texture),this._meshInstance.setParameter("material_emissive",this._color.data3),this._meshInstance.setParameter("material_opacity",this._color.data[3])):(this._meshInstance.deleteParameter("texture_emissiveMap"),this._meshInstance.deleteParameter("texture_opacityMap"))}}),Object.defineProperty(e.prototype,"textureAsset",{get:function(){return this._textureAsset},set:function(e){var t=this._system.app.assets,i=e;if(e instanceof n.Asset&&(i=e.id),this._textureAsset!==i){if(this._textureAsset){var r=t.get(this._textureAsset);r&&(r.off("load",this._onTextureLoad,this),r.off("change",this._onTextureChange,this),r.off("remove",this._onTextureRemove,this))}if(this._textureAsset=i,this._textureAsset){var s=t.get(this._textureAsset);s?this._bindTextureAsset(s):(this.texture=null,t.on("add:"+this._textureAsset,this._onTextureAdded,this))}else this.texture=null}}}),Object.defineProperty(e.prototype,"spriteAsset",{get:function(){return this._spriteAsset},set:function(e){var t=this._system.app.assets,i=e;if(e instanceof n.Asset&&(i=e.id),this._spriteAsset!==i){if(this._spriteAsset){var r=t.get(this._spriteAsset);r&&(r.off("load",this._onSpriteAssetLoad,this),r.off("change",this._onSpriteAssetChange,this),r.off("remove",this._onSpriteAssetRemove,this))}if(this._spriteAsset=i,this._spriteAsset){var s=t.get(this._spriteAsset);s?this._bindSpriteAsset(s):(this.sprite=null,t.on("add:"+this._spriteAsset,this._onSpriteAssetAdded,this))}else this.sprite=null;this._element&&this._element.fire("set:spriteAsset",i)}}}),Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},set:function(e){this._sprite&&(this._sprite.off("set:meshes",this._onSpriteMeshesChange,this),this._sprite.off("set:pixelsPerUnit",this._onSpritePpuChange,this),this._sprite.off("set:atlas",this._onAtlasTextureChange,this),this._sprite.atlas&&this._sprite.atlas.off("set:texture",this._onAtlasTextureChange,this)),this._sprite=e,this._sprite&&(this._sprite.on("set:meshes",this._onSpriteMeshesChange,this),this._sprite.on("set:pixelsPerUnit",this._onSpritePpuChange,this),this._sprite.on("set:atlas",this._onAtlasTextureChange,this),this._sprite.atlas&&this._sprite.atlas.on("set:texture",this._onAtlasTextureChange,this)),this._meshInstance&&(this._sprite&&this._sprite.atlas&&this._sprite.atlas.texture?(this._meshInstance.setParameter("texture_emissiveMap",this._sprite.atlas.texture),this._meshInstance.setParameter("texture_opacityMap",this._sprite.atlas.texture)):(this._meshInstance.deleteParameter("texture_emissiveMap"),this._meshInstance.deleteParameter("texture_opacityMap"))),this.spriteFrame=this.spriteFrame}}),Object.defineProperty(e.prototype,"spriteFrame",{get:function(){return this._spriteFrame},set:function(e){this._sprite?this._spriteFrame=n.math.clamp(e,0,this._sprite.frameKeys.length-1):this._spriteFrame=e;var t=!1,i=null;this._sprite&&this._sprite.atlas&&(i=this._sprite.meshes[this.spriteFrame],t=this._sprite.renderMode===n.SPRITE_RENDERMODE_SLICED||this._sprite.renderMode===n.SPRITE_RENDERMODE_TILED),this.mesh=t?i:this._defaultMesh,this.mesh&&this._updateMesh(this.mesh),this._element&&this._element.fire("set:spriteFrame",e)}}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh=e,this._meshInstance&&(this._meshInstance.mesh=this._mesh,this._meshInstance.visible=!!this._mesh,this._meshInstance._aabbVer=-1,this._mesh===this._defaultMesh?this._meshInstance._updateAabbFunc=null:this._meshInstance._updateAabbFunc=this._updateAabbFunc)}}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._toggleMask())}}),Object.defineProperty(e.prototype,"pixelsPerUnit",{get:function(){return this._pixelsPerUnit},set:function(e){this._pixelsPerUnit!==e&&(this._pixelsPerUnit=e,!this._sprite||this._sprite.renderMode!==n.SPRITE_RENDERMODE_SLICED&&this._sprite.renderMode!==n.SPRITE_RENDERMODE_TILED||(this.spriteFrame=this.spriteFrame))}}),{ImageElement:e}}()),Object.assign(n,function(){var e=function(e){this._element=e,this._system=e.system,this._entity=e.entity,this._text="",this._fontAsset=null,this._font=null,this._color=new n.Color(1,1,1,1),this._spacing=1,this._fontSize=32,this._lineHeight=32,this._wrapLines=!1,this._drawOrder=0,this._alignment=new n.Vec2(.5,.5),this._autoWidth=!0,this._autoHeight=!0,this.width=0,this.height=0,this._node=new n.GraphNode,this._model=new n.Model,this._model.graph=this._node,this._entity.addChild(this._node),this._meshInfo=[],this._material=null,this._noResize=!1,this._currentMaterialType=null,this._maskedMaterialSrc=null,this._onScreenChange(this._element.screen),e.on("resize",this._onParentResize,this),this._element.on("set:screen",this._onScreenChange,this),e.on("screen:set:screenspace",this._onScreenSpaceChange,this),e.on("set:draworder",this._onDrawOrderChange,this),e.on("set:pivot",this._onPivotChange,this)},t=/^[\r\n]$/,i=/^[ \t]$/,r=/^[ \t\-]$/;return Object.assign(e.prototype,{destroy:function(){this._model&&(this._element.removeModelFromLayers(this._model),this._model.destroy(),this._model=null),this._element.off("resize",this._onParentResize,this),this._element.off("set:screen",this._onScreenChange,this),this._element.off("screen:set:screenspace",this._onScreenSpaceChange,this),this._element.off("set:draworder",this._onDrawOrderChange,this),this._element.off("set:pivot",this._onPivotChange,this)},_onParentResize:function(e,t){this._noResize||this._font&&this._updateText(this._text)},_onScreenChange:function(e){e?this._updateMaterial(e.screen.screenSpace):this._updateMaterial(!1)},_onScreenSpaceChange:function(e){this._updateMaterial(e)},_onDrawOrderChange:function(e){if(this._drawOrder=e,this._model){var t,i;for(t=0,i=this._model.meshInstances.length;t<i;t++)this._model.meshInstances[t].drawOrder=e}},_onPivotChange:function(e){this._font&&this._updateText()},_updateText:function(e){var t,i;void 0===e&&(e=this._text);var r=e.length;0===r&&(r=1,e=" ");var s={};for(t=0;t<r;t++){var a=e.charCodeAt(t),o=this._font.data.chars[a];if(o){var h=o.map;s[h]||(s[h]=0),s[h]++}}var l=!1,c=this._element.screen&&this._element.screen.screen.screenSpace;for(t=0,i=this._meshInfo.length;t<i;t++){var d=s[t]||0,u=this._meshInfo[t];if(u.count!==d){if(l||(this._element.removeModelFromLayers(this._model),l=!0),u.count=d,u.positions.length=u.normals.length=3*d*4,u.indices.length=3*d*2,u.uvs.length=2*d*4,u.meshInstance&&this._removeMeshInstance(u.meshInstance),0===d){u.meshInstance=null;continue}for(var f=0;f<d;f++)u.indices[3*f*2+0]=4*f,u.indices[3*f*2+1]=4*f+1,u.indices[3*f*2+2]=4*f+3,u.indices[3*f*2+3]=4*f+2,u.indices[3*f*2+4]=4*f+3,u.indices[3*f*2+5]=4*f+1,u.normals[4*f*3+0]=0,u.normals[4*f*3+1]=0,u.normals[4*f*3+2]=-1,u.normals[4*f*3+3]=0,u.normals[4*f*3+4]=0,u.normals[4*f*3+5]=-1,u.normals[4*f*3+6]=0,u.normals[4*f*3+7]=0,u.normals[4*f*3+8]=-1,u.normals[4*f*3+9]=0,u.normals[4*f*3+10]=0,u.normals[4*f*3+11]=-1;var p=n.createMesh(this._system.app.graphicsDevice,u.positions,{uvs:u.uvs,normals:u.normals,indices:u.indices}),_=new n.MeshInstance(this._node,p,this._material);_.castShadow=!1,_.receiveShadow=!1,_.drawOrder=this._drawOrder,c&&(_.cull=!1),_.screenSpace=c,_.setParameter("texture_msdfMap",this._font.textures[t]),_.setParameter("material_emissive",this._color.data3),_.setParameter("material_opacity",this._color.data[3]),_.setParameter("font_sdfIntensity",this._font.intensity),_.setParameter("font_pxrange",this._getPxRange(this._font)),_.setParameter("font_textureWidth",this._font.data.info.maps[t].width),u.meshInstance=_,this._model.meshInstances.push(_)}}this._maskedBy&&this._element._setMaskedBy(this._maskedBy),l&&this._element.enabled&&this._entity.enabled&&this._element.addModelToLayers(this._model),this._updateMeshes(e)},_removeMeshInstance:function(e){var t,i,n=e.mesh;if(n&&(n.vertexBuffer&&n.vertexBuffer.destroy(),n.indexBuffer))for(t=0,i=n.indexBuffer.length;t<i;t++)n.indexBuffer[t].destroy();var r=this._model.meshInstances.indexOf(e);r!==-1&&this._model.meshInstances.splice(r,1)},_setMaterial:function(e){var t,i;if(this._material=e,this._model)for(t=0,i=this._model.meshInstances.length;t<i;t++){var n=this._model.meshInstances[t];n.material=e}},_updateMaterial:function(e){var t;if(e?(this._material=this._system.defaultScreenSpaceTextMaterial,t=!1):(this._material=this._system.defaultTextMaterial,t=!0),this._model)for(var i=0,n=this._model.meshInstances.length;i<n;i++){var r=this._model.meshInstances[i];r.cull=t,r.material=this._material,r.screenSpace=e}},_updateMeshes:function(e){function s(t,i){o._lineWidths.push(i),o._lineContents.push(e.substring(m,t)),l=0,d-=o._lineHeight,f++,A=0,v=0,p=0,m=t}var a=this._font.data,o=this;this.width=0,this.height=0,this._lineWidths=[],this._lineContents=[];var h=e.length,l=0,c=0,d=0,u=0,f=1,p=0,_=0,m=0,A=0,v=0,y=Math.abs(this._element.anchor.x-this._element.anchor.z)>=1e-4,g=this._element.calculatedWidth;(this.autoWidth&&!y||!this._wrapLines)&&(g=Number.POSITIVE_INFINITY);var b,E,T,S,w,C=0,M=0,P=1,I=32;for(E in a.chars)T=a.chars[E],P=T.height/I*this._fontSize/T.height,T.bounds&&(C=Math.min(C,T.bounds[1]*P),M=Math.max(M,T.bounds[3]*P));for(S=0;S<this._meshInfo.length;S++)this._meshInfo[S].quad=0,this._meshInfo[S].lines={};for(S=0;S<h;S++){b=e.charAt(S),E=e.charCodeAt(S);var R=0,x=0,O=0,k=1,D=0,L=0;if(T=a.chars[E],T&&T.scale){var N=(T.width+T.height)/2;P=N/I*this._fontSize/N,k=N/I*this._fontSize/T.scale,O=T.xadvance*P,R=T.xoffset*P,x=T.yoffset*P,T.bounds?(L=(T.bounds[2]-T.bounds[0])*P,D=T.bounds[0]*P):(L=R,D=0)}else O=1,R=0,x=0,k=this._fontSize;var F=t.test(b),B=r.test(b),V=i.test(b);if(F)s(S,c),_=S+1,m=S+1;else{var U=this._meshInfo[T&&T.map||0],G=l+L+D;if(G>=g&&v>0&&!V){if(0!==A){var W=Math.max(S-_,0);S-=W+1,U.lines[f-1]-=W,U.quad-=W,s(_,p);continue}_=S,s(S,c)}w=U.quad,U.lines[f-1]=w,U.positions[4*w*3+0]=l-R,U.positions[4*w*3+1]=d-x,U.positions[4*w*3+2]=u,U.positions[4*w*3+3]=l-R+k,U.positions[4*w*3+4]=d-x,U.positions[4*w*3+5]=u,U.positions[4*w*3+6]=l-R+k,U.positions[4*w*3+7]=d-x+k,U.positions[4*w*3+8]=u,U.positions[4*w*3+9]=l-R,U.positions[4*w*3+10]=d-x+k,U.positions[4*w*3+11]=u,this.width=Math.max(this.width,l+L+D),this.height=Math.max(this.height,M-(d+C)),l+=this._spacing*O,V||F||(c=l),B&&(A++,p=c,_=S+1),v++;var z=this._getUv(E);U.uvs[4*w*2+0]=z[0],U.uvs[4*w*2+1]=z[1],U.uvs[4*w*2+2]=z[2],U.uvs[4*w*2+3]=z[1],U.uvs[4*w*2+4]=z[2],U.uvs[4*w*2+5]=z[3],U.uvs[4*w*2+6]=z[0],U.uvs[4*w*2+7]=z[3],U.quad++}}m<h&&s(h,l),this._noResize=!0,this.autoWidth=this._autoWidth,this.autoHeight=this._autoHeight,this._noResize=!1;var H=this._element.pivot.data[0],j=this._element.pivot.data[1],Y=this._alignment.x,X=this._alignment.y;for(S=0;S<this._meshInfo.length;S++)if(0!==this._meshInfo[S].count){var Z=0;for(var K in this._meshInfo[S].lines){var Q=this._meshInfo[S].lines[K],J=-H*this._element.calculatedWidth+Y*(this._element.calculatedWidth-this._lineWidths[parseInt(K,10)]),q=(1-j)*this._element.calculatedHeight-M-(1-X)*(this._element.calculatedHeight-this.height);for(w=Z;w<=Q;w++)this._meshInfo[S].positions[4*w*3]+=J,this._meshInfo[S].positions[4*w*3+3]+=J,this._meshInfo[S].positions[4*w*3+6]+=J,this._meshInfo[S].positions[4*w*3+9]+=J,this._meshInfo[S].positions[4*w*3+1]+=q,this._meshInfo[S].positions[4*w*3+4]+=q,this._meshInfo[S].positions[4*w*3+7]+=q,this._meshInfo[S].positions[4*w*3+10]+=q;Z=Q+1}for(var $=4*this._meshInfo[S].quad,ee=new n.VertexIterator(this._meshInfo[S].meshInstance.mesh.vertexBuffer),te=0;te<$;te++)ee.element[n.SEMANTIC_POSITION].set(this._meshInfo[S].positions[3*te+0],this._meshInfo[S].positions[3*te+1],this._meshInfo[S].positions[3*te+2]),ee.element[n.SEMANTIC_TEXCOORD0].set(this._meshInfo[S].uvs[2*te+0],this._meshInfo[S].uvs[2*te+1]),ee.next();ee.end(),this._meshInfo[S].meshInstance.mesh.aabb.compute(this._meshInfo[S].positions),this._meshInfo[S].meshInstance._aabbVer=-1}},_onFontAdded:function(e){this._system.app.assets.off("add:"+e.id,this._onFontAdded,this),e.id===this._fontAsset&&this._bindFont(e)},_bindFont:function(e){e.on("load",this._onFontLoad,this),e.on("change",this._onFontChange,this),e.on("remove",this._onFontRemove,this),e.resource?this._onFontLoad(e):this._system.app.assets.load(e)},_onFontLoad:function(e){this.font!==e.resource&&(this.font=e.resource)},_onFontChange:function(e,t,i,n){if("data"===t){this._font.data=i;for(var r=this._font.data.info.maps.length,s=0;s<r;s++)if(this._meshInfo[s]){var a=this._meshInfo[s].meshInstance;a&&(a.setParameter("font_sdfIntensity",this._font.intensity),a.setParameter("font_pxrange",this._getPxRange(this._font)),a.setParameter("font_textureWidth",this._font.data.info.maps[s].width))}}},_onFontRemove:function(e){},_getPxRange:function(e){for(var t=Object.keys(this._font.data.chars),i=0;i<t.length;i++){var n=this._font.data.chars[t[i]];if(n.scale&&n.range)return n.scale*n.range}return 2},_getUv:function(e){var t=this._font.data;if(!t.chars[e])return t.chars[32]?this._getUv(32):[0,0,1,1];var i=t.chars[e].map,n=t.info.maps[i].width,r=t.info.maps[i].height,s=t.chars[e].x,a=t.chars[e].y,o=s,h=a,l=s+t.chars[e].width,c=a-t.chars[e].height,d=1-t.chars[e].height/r;return[o/n,d-h/r,l/n,d-c/r]},onEnable:function(){this._model&&this._element.addModelToLayers(this._model)},onDisable:function(){this._model&&this._element.removeModelFromLayers(this._model)}}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(e){var t=e.toString();this._text!==t&&(this._font&&this._updateText(t),this._text=t)}}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){if(this._color.data[0]=e.data[0],this._color.data[1]=e.data[1],this._color.data[2]=e.data[2],this._model)for(var t=0,i=this._model.meshInstances.length;t<i;t++){var n=this._model.meshInstances[t];n.setParameter("material_emissive",this._color.data3)}}}),Object.defineProperty(e.prototype,"opacity",{get:function(){return this._color.data[3]},set:function(e){if(this._color.data[3]=e,this._model)for(var t=0,i=this._model.meshInstances.length;t<i;t++){var n=this._model.meshInstances[t];n.setParameter("material_opacity",e)}}}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){var t=this._lineHeight;this._lineHeight=e,t!==e&&this._font&&this._updateText()}}),Object.defineProperty(e.prototype,"wrapLines",{get:function(){return this._wrapLines},set:function(e){var t=this._wrapLines;this._wrapLines=e,t!==e&&this._font&&this._updateText()}}),Object.defineProperty(e.prototype,"lines",{get:function(){return this._lineContents}}),Object.defineProperty(e.prototype,"spacing",{get:function(){return this._spacing},set:function(e){var t=this._spacing;this._spacing=e,t!==e&&this._font&&this._updateText()}}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){var t=this._fontSize;this._fontSize=e,t!==e&&this._font&&this._updateText()}}),Object.defineProperty(e.prototype,"fontAsset",{get function(){return this._fontAsset},set:function(e){var t=this._system.app.assets,i=e;if(e instanceof n.Asset&&(i=e.id),this._fontAsset!==i){if(this._fontAsset){var r=t.get(this._fontAsset);r&&(r.off("load",this._onFontLoad,this),r.off("change",this._onFontChange,this),r.off("remove",this._onFontRemove,this))}if(this._fontAsset=i,this._fontAsset){var s=t.get(this._fontAsset);s?this._bindFont(s):t.on("add:"+this._fontAsset,this._onFontAdded,this)}}}}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(e){var t,i;if(this._font=e,e){for(t=0,i=this._font.textures.length;t<i;t++)if(this._meshInfo[t]){var n=this._meshInfo[t].meshInstance;n&&(n.setParameter("font_sdfIntensity",this._font.intensity),n.setParameter("font_pxrange",this._getPxRange(this._font)),n.setParameter("font_textureWidth",this._font.data.info.maps[t].width),n.setParameter("texture_msdfMap",this._font.textures[t]))}else this._meshInfo[t]={count:0,quad:0,lines:{},positions:[],normals:[],uvs:[],indices:[],meshInstance:null};var r=!1;for(t=this._font.textures.length;t<this._meshInfo.length;t++)this._meshInfo[t].meshInstance&&(r||(this._element.removeModelFromLayers(this._model),r=!0),this._removeMeshInstance(this._meshInfo[t].meshInstance));this._meshInfo.length>this._font.textures.length&&(this._meshInfo.length=this._font.textures.length),this._updateText()}}}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this._alignment},set:function(e){e instanceof n.Vec2?this._alignment.set(e.x,e.y):this._alignment.set(e[0],e[1]),this._font&&this._updateText()}}),Object.defineProperty(e.prototype,"autoWidth",{get:function(){return this._autoWidth},set:function(e){this._autoWidth=e,e&&Math.abs(this._element.anchor.x-this._element.anchor.z)<1e-4&&(this._element.width=this.width)}}),Object.defineProperty(e.prototype,"autoHeight",{get:function(){return this._autoHeight},set:function(e){this._autoHeight=e,e&&Math.abs(this._element.anchor.y-this._element.anchor.w)<1e-4&&(this._element.height=this.height)}}),{TextElement:e}}()),Object.assign(n,function(){var e=new n.Vec2,t=new n.Vec3,i=new n.Vec3,r=new n.Vec3,s=new n.Vec3,a=new n.Vec3,o=new n.Quat,h={x:"y",y:"x"},l=function(e,t){if(!(e&&e instanceof n.ElementComponent))throw new Error("Element was null or not an ElementComponent");if(t&&"x"!==t&&"y"!==t)throw new Error("Unrecognized axis: "+t);this._element=e,this._app=e.system.app,this._axis=t||null,this._enabled=!0,this._dragScale=new n.Vec3,this._dragStartMousePosition=new n.Vec3,this._dragStartHandlePosition=new n.Vec3,this._deltaMousePosition=new n.Vec3,this._deltaHandlePosition=new n.Vec3,this._isDragging=!1,n.events.attach(this),this._toggleLifecycleListeners("on")};return Object.assign(l.prototype,{_toggleLifecycleListeners:function(e){this._element[e]("mousedown",this._onMouseDownOrTouchStart,this),this._element[e]("touchstart",this._onMouseDownOrTouchStart,this)},_toggleDragListeners:function(e){var t="on"===e,i=t?"addEventListener":"removeEventListener";this._hasDragListeners&&t||(this._handleMouseUpOrTouchEnd||(this._handleMouseUpOrTouchEnd=this._onMouseUpOrTouchEnd.bind(this)),this._app.mouse[e]("mousemove",this._onMove,this),window[i]("mouseup",this._handleMouseUpOrTouchEnd,!1),"ontouchstart"in window&&(this._app.touch[e]("touchmove",this._onMove,this),window[i]("touchend",this._handleMouseUpOrTouchEnd,!1),window[i]("touchcancel",this._handleMouseUpOrTouchEnd,!1)),this._hasDragListeners=t)},_onMouseDownOrTouchStart:function(e){if(this._element&&!this._isDragging&&this.enabled){this._dragCamera=e.camera,this._calculateDragScale();var t=this._screenToLocal(e);t&&(this._toggleDragListeners("on"),this._isDragging=!0,this._dragStartMousePosition.copy(t),this._dragStartHandlePosition.copy(this._element.entity.getLocalPosition()),this.fire("drag:start"))}},_onMouseUpOrTouchEnd:function(){this._isDragging&&(this._isDragging=!1,this._toggleDragListeners("off"),this.fire("drag:end"))},_screenToLocal:function(e){this._determineInputPosition(e),this._chooseRayOriginAndDirection(),s.copy(this._element.entity.getPosition()),a.copy(this._element.entity.forward).scale(-1);var t=a.dot(r);if(Math.abs(t)>0){var n=s.sub(i),h=n.dot(a)/t,l=i.add(r.scale(h));return o.copy(this._element.entity.getRotation()).invert().transformVector(l,l),l.mul(this._dragScale),l}return null},_determineInputPosition:function(t){"undefined"!=typeof t.x&&"undefined"!=typeof t.y?(e.x=t.x,e.y=t.y):t.changedTouches?(e.x=t.changedTouches[0].x,e.y=t.changedTouches[0].y):console.warn("Could not determine position from input event")},_chooseRayOriginAndDirection:function(){this._element.screen&&this._element.screen.screen.screenSpace?(i.set(e.x,-e.y,0),r.set(0,0,-1)):(t.copy(this._dragCamera.screenToWorld(e.x,e.y,1)),i.copy(this._dragCamera.entity.getPosition()),r.copy(t).sub(i).normalize())},_calculateDragScale:function(){var e=this._element.entity.parent,t=this._element.screen&&this._element.screen.screen,i=t&&t.screenSpace,n=i?t.scale:1,r=this._dragScale;for(r.set(n,n,n);e&&(r.mul(e.getLocalScale()),e=e.parent,!i||!e.screen););r.data[0]=1/r.data[0],r.data[1]=1/r.data[1],r.data[2]=1/r.data[2]},_onMove:function(e){if(this._element&&this._isDragging&&this.enabled&&this._element.enabled&&this._element.entity.enabled){var t=this._screenToLocal(e);if(this._dragStartMousePosition&&t){if(this._deltaMousePosition.copy(t).sub(this._dragStartMousePosition),this._deltaHandlePosition.copy(this._dragStartHandlePosition).add(this._deltaMousePosition),this._axis){var i=this._element.entity.getLocalPosition(),n=h[this._axis];this._deltaHandlePosition[n]=i[n]}this._element.entity.setLocalPosition(this._deltaHandlePosition),this.fire("drag:move",this._deltaHandlePosition)}}},destroy:function(){this._toggleLifecycleListeners("off"),this._toggleDragListeners("off")}}),Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e}}),Object.defineProperty(l.prototype,"isDragging",{get:function(){return this._isDragging}}),{ElementDragHelper:l}}()),Object.assign(n,{BUTTON_TRANSITION_MODE_TINT:0,BUTTON_TRANSITION_MODE_SPRITE_CHANGE:1}),Object.assign(n,function(){function e(e){return new n.Color(e.r,e.g,e.b)}var t={DEFAULT:"DEFAULT",HOVER:"HOVER",PRESSED:"PRESSED",INACTIVE:"INACTIVE"},i={};i[t.DEFAULT]="_defaultTint",i[t.HOVER]="hoverTint",i[t.PRESSED]="pressedTint",i[t.INACTIVE]="inactiveTint";var r={};r[t.DEFAULT]="_defaultSpriteAsset",r[t.HOVER]="hoverSpriteAsset",r[t.PRESSED]="pressedSpriteAsset",r[t.INACTIVE]="inactiveSpriteAsset";var s={};s[t.DEFAULT]="_defaultSpriteFrame",s[t.HOVER]="hoverSpriteFrame",s[t.PRESSED]="pressedSpriteFrame",s[t.INACTIVE]="inactiveSpriteFrame";var a=function(e,i){n.Component.call(this,e,i),this._visualState=t.DEFAULT,this._isHovering=!1,this._isPressed=!1,this._defaultTint=new n.Color(1,1,1,1),this._defaultSpriteAsset=null,this._defaultSpriteFrame=0,this._imageReference=new n.EntityReference(this,"imageEntity",{"element#gain":this._onImageElementGain,"element#lose":this._onImageElementLose,"element#set:color":this._onSetColor,"element#set:opacity":this._onSetOpacity,"element#set:spriteAsset":this._onSetSpriteAsset,"element#set:spriteFrame":this._onSetSpriteFrame}),this._toggleLifecycleListeners("on",e)};return a.prototype=Object.create(n.Component.prototype),a.prototype.constructor=a,Object.assign(a.prototype,{_toggleLifecycleListeners:function(e,t){this[e]("set_active",this._onSetActive,this),this[e]("set_transitionMode",this._onSetTransitionMode,this),this[e]("set_hoverTint",this._onSetTransitionValue,this),this[e]("set_pressedTint",this._onSetTransitionValue,this),this[e]("set_inactiveTint",this._onSetTransitionValue,this),this[e]("set_hoverSpriteAsset",this._onSetTransitionValue,this),this[e]("set_hoverSpriteFrame",this._onSetTransitionValue,this),this[e]("set_pressedSpriteAsset",this._onSetTransitionValue,this),this[e]("set_pressedSpriteFrame",this._onSetTransitionValue,this),this[e]("set_inactiveSpriteAsset",this._onSetTransitionValue,this),this[e]("set_inactiveSpriteFrame",this._onSetTransitionValue,this),n.ComponentSystem[e]("update",this._onUpdate,this),t.app.systems.element[e]("add",this._onElementComponentAdd,this),t.app.systems.element[e]("beforeremove",this._onElementComponentRemove,this)},_onSetActive:function(e,t,i){t!==i&&this._updateVisualState()},_onSetTransitionMode:function(e,t,i){t!==i&&(this._cancelTween(),this._resetToDefaultVisualState(t),this._forceReapplyVisualState())},_onSetTransitionValue:function(e,t,i){t!==i&&this._forceReapplyVisualState()},_onElementComponentRemove:function(e){this.entity===e&&this._toggleHitElementListeners("off")},_onElementComponentAdd:function(e){this.entity===e&&this._toggleHitElementListeners("on")},_onImageElementLose:function(){this._cancelTween(),this._resetToDefaultVisualState(this.transitionMode)},_onImageElementGain:function(){this._storeDefaultVisualState(),this._forceReapplyVisualState()},_toggleHitElementListeners:function(e){if(this.entity.element){var t="on"===e;if(t&&this._hasHitElementListeners)return;this.entity.element[e]("mouseenter",this._onMouseEnter,this),this.entity.element[e]("mouseleave",this._onMouseLeave,this),this.entity.element[e]("mousedown",this._onMouseDown,this),this.entity.element[e]("mouseup",this._onMouseUp,this),this.entity.element[e]("touchstart",this._onTouchStart,this),this.entity.element[e]("touchend",this._onTouchEnd,this),this.entity.element[e]("touchleave",this._onTouchLeave,this),this.entity.element[e]("touchcancel",this._onTouchCancel,this),this.entity.element[e]("click",this._onClick,this),this._hasHitElementListeners=t}},_storeDefaultVisualState:function(){this._imageReference.hasComponent("element")&&(this._storeDefaultColor(this._imageReference.entity.element.color),this._storeDefaultOpacity(this._imageReference.entity.element.opacity),this._storeDefaultSpriteAsset(this._imageReference.entity.element.spriteAsset),this._storeDefaultSpriteFrame(this._imageReference.entity.element.spriteFrame))},_storeDefaultColor:function(e){this._defaultTint.r=e.r,this._defaultTint.g=e.g,this._defaultTint.b=e.b},_storeDefaultOpacity:function(e){this._defaultTint.a=e},_storeDefaultSpriteAsset:function(e){this._defaultSpriteAsset=e},_storeDefaultSpriteFrame:function(e){this._defaultSpriteFrame=e},_onSetColor:function(e){this._isApplyingTint||(this._storeDefaultColor(e),this._forceReapplyVisualState())},_onSetOpacity:function(e){this._isApplyingTint||(this._storeDefaultOpacity(e),this._forceReapplyVisualState())},_onSetSpriteAsset:function(e){this._isApplyingSprite||(this._storeDefaultSpriteAsset(e),this._forceReapplyVisualState())},_onSetSpriteFrame:function(e){this._isApplyingSprite||(this._storeDefaultSpriteFrame(e),this._forceReapplyVisualState())},_onMouseEnter:function(e){this._isHovering=!0,this._updateVisualState(),this.fire("mouseenter",e)},_onMouseLeave:function(e){this._isHovering=!1,this._isPressed=!1,this._updateVisualState(),this.fire("mouseleave",e)},_onMouseDown:function(e){this._isPressed=!0,this._updateVisualState(),this.fire("mousedown",e)},_onMouseUp:function(e){this._isPressed=!1,this._updateVisualState(),this.fire("mouseup",e)},_onTouchStart:function(e){this._isPressed=!0,this._updateVisualState(),this.fire("touchstart",e)},_onTouchEnd:function(e){e.event.preventDefault(),this._isPressed=!1,this._updateVisualState(),this.fire("touchend",e)},_onTouchLeave:function(e){this._isPressed=!1,this._updateVisualState(),this.fire("touchleave",e)},_onTouchCancel:function(e){this._isPressed=!1,this._updateVisualState(),this.fire("touchcancel",e)},_onClick:function(e){this.fire("click",e)},_updateVisualState:function(e){var a=this._visualState,o=this._determineVisualState();if((a!==o||e)&&this.enabled)switch(this._visualState=o,a===t.HOVER&&this.fire("hoverend"),a===t.PRESSED&&this.fire("pressedend"),o===t.HOVER&&this.fire("hoverstart"),o===t.PRESSED&&this.fire("pressedstart"),this.transitionMode){case n.BUTTON_TRANSITION_MODE_TINT:var h=i[this._visualState],l=this[h];this._applyTint(l);break;case n.BUTTON_TRANSITION_MODE_SPRITE_CHANGE:var c=r[this._visualState],d=s[this._visualState],u=this[c],f=this[d];this._applySprite(u,f)}},_forceReapplyVisualState:function(){this._updateVisualState(!0)},_resetToDefaultVisualState:function(e){if(this._imageReference.hasComponent("element"))switch(e){case n.BUTTON_TRANSITION_MODE_TINT:this._cancelTween(),this._applyTintImmediately(this._defaultTint);break;case n.BUTTON_TRANSITION_MODE_SPRITE_CHANGE:this._applySprite(this._defaultSpriteAsset,this._defaultSpriteFrame)}},_determineVisualState:function(){return this.active?this._isPressed?t.PRESSED:this._isHovering?t.HOVER:t.DEFAULT:t.INACTIVE},_applySprite:function(e,t){t=t||0,this._imageReference.hasComponent("element")&&(this._isApplyingSprite=!0,this._imageReference.entity.element.spriteAsset=e,this._imageReference.entity.element.spriteFrame=t,
this._isApplyingSprite=!1)},_applyTint:function(e){this._cancelTween(),0===this.fadeDuration?this._applyTintImmediately(e):this._applyTintWithTween(e)},_applyTintImmediately:function(t){this._imageReference.hasComponent("element")&&t&&(this._isApplyingTint=!0,this._imageReference.entity.element.color=e(t),this._imageReference.entity.element.opacity=t.a,this._isApplyingTint=!1)},_applyTintWithTween:function(e){if(this._imageReference.hasComponent("element")&&e){var t=this._imageReference.entity.element.color,i=this._imageReference.entity.element.opacity;this._tweenInfo={startTime:n.now(),from:new n.Color(t.r,t.g,t.b,i),to:e.clone(),lerpVec:new n.Vec4}}},_updateTintTween:function(){var e=n.now()-this._tweenInfo.startTime,t=0===this.fadeDuration?1:e/this.fadeDuration;t=n.math.clamp(t,0,1),Math.abs(t-1)>1e-5?(this._tweenInfo.lerpVec.lerp(this._tweenInfo.from,this._tweenInfo.to,t),this._applyTintImmediately(new n.Color(this._tweenInfo.lerpVec.data))):(this._applyTintImmediately(this._tweenInfo.to),this._cancelTween())},_cancelTween:function(){delete this._tweenInfo},_onUpdate:function(){this._tweenInfo&&this._updateTintTween()},onEnable:function(){this._toggleHitElementListeners("on"),this._forceReapplyVisualState()},onDisable:function(){this._toggleHitElementListeners("off"),this._resetToDefaultVisualState(this.transitionMode)},onRemove:function(){this._toggleLifecycleListeners("off",this.system),this.onDisable()}}),{ButtonComponent:a}}()),Object.assign(n,function(){var e=["enabled","active",{name:"imageEntity",type:"entity"},{name:"hitPadding",type:"vec4"},"transitionMode",{name:"hoverTint",type:"rgba"},{name:"pressedTint",type:"rgba"},{name:"inactiveTint",type:"rgba"},"fadeDuration","hoverSpriteAsset","hoverSpriteFrame","pressedSpriteAsset","pressedSpriteFrame","inactiveSpriteAsset","inactiveSpriteFrame"],t=function(t){n.ComponentSystem.call(this,t),this.id="button",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ButtonComponent,this.DataType=n.ButtonComponentData,this.schema=e,this.on("beforeremove",this._onRemoveComponent,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ButtonComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(t,i,r){n.ComponentSystem.prototype.initializeComponentData.call(this,t,i,e)},_onRemoveComponent:function(e,t){t.onRemove()}}),{ButtonComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0,this.active=!0,this.imageEntity=null,this.hitPadding=new n.Vec4,this.transitionMode=n.BUTTON_TRANSITION_MODE_TINT,this.hoverTint=new n.Color(.75,.75,.75),this.pressedTint=new n.Color(.5,.5,.5),this.inactiveTint=new n.Color(.25,.25,.25),this.fadeDuration=0,this.hoverSpriteAsset=null,this.hoverSpriteFrame=0,this.pressedSpriteAsset=null,this.pressedSpriteFrame=0,this.inactiveSpriteAsset=null,this.inactiveSpriteFrame=0};return{ButtonComponentData:e}}()),Object.assign(n,{SCROLL_MODE_CLAMP:0,SCROLL_MODE_BOUNCE:1,SCROLL_MODE_INFINITE:2,SCROLLBAR_VISIBILITY_SHOW_ALWAYS:0,SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED:1}),Object.assign(n,function(){var e=new n.Vec2,t=function(e,t){n.Component.call(this,e,t),this._viewportReference=new n.EntityReference(this,"viewportEntity",{"element#gain":this._onViewportElementGain,"element#resize":this._onSetContentOrViewportSize}),this._contentReference=new n.EntityReference(this,"contentEntity",{"element#gain":this._onContentElementGain,"element#lose":this._onContentElementLose,"element#resize":this._onSetContentOrViewportSize}),this._scrollbarUpdateFlags={},this._scrollbarReferences={},this._scrollbarReferences[n.ORIENTATION_HORIZONTAL]=new n.EntityReference(this,"horizontalScrollbarEntity",{"scrollbar#set:value":this._onSetHorizontalScrollbarValue,"scrollbar#gain":this._onHorizontalScrollbarGain}),this._scrollbarReferences[n.ORIENTATION_VERTICAL]=new n.EntityReference(this,"verticalScrollbarEntity",{"scrollbar#set:value":this._onSetVerticalScrollbarValue,"scrollbar#gain":this._onVerticalScrollbarGain}),this._scroll=new n.Vec2,this._velocity=new n.Vec3,this._toggleLifecycleListeners("on",e),this._toggleElementListeners("on")};return t.prototype=Object.create(n.Component.prototype),t.prototype.constructor=t,Object.assign(t.prototype,{_toggleLifecycleListeners:function(e,t){this[e]("set_horizontal",this._onSetHorizontalScrollingEnabled,this),this[e]("set_vertical",this._onSetVerticalScrollingEnabled,this),n.ComponentSystem[e]("update",this._onUpdate,this),t.app.systems.element[e]("add",this._onElementComponentAdd,this),t.app.systems.element[e]("beforeremove",this._onElementComponentRemove,this)},_toggleElementListeners:function(e){if(this.entity.element){if("on"===e&&this._hasElementListeners)return;this.entity.element[e]("resize",this._onSetContentOrViewportSize,this),this._hasElementListeners="on"===e}},_onElementComponentAdd:function(e){this.entity===e&&this._toggleElementListeners("on")},_onElementComponentRemove:function(e){this.entity===e&&this._toggleElementListeners("off")},_onViewportElementGain:function(){this._syncAll()},_onContentElementGain:function(){this._destroyDragHelper(),this._contentDragHelper=new n.ElementDragHelper(this._contentReference.entity.element),this._contentDragHelper.on("drag:end",this._onContentDragEnd,this),this._contentDragHelper.on("drag:move",this._onContentDragMove,this),this._syncAll()},_onContentElementLose:function(){this._destroyDragHelper()},_onContentDragEnd:function(){this._prevContentDragPosition=null},_onContentDragMove:function(e){this._contentReference.entity&&this.enabled&&this.entity.enabled&&(this._setScrollFromContentPosition(e),this._setVelocityFromContentPositionDelta(e))},_onSetContentOrViewportSize:function(){this._syncAll()},_onSetHorizontalScrollbarValue:function(e){!this._scrollbarUpdateFlags[n.ORIENTATION_HORIZONTAL]&&this.enabled&&this.entity.enabled&&(this._velocity.set(0,0,0),this._onSetScroll(e,null))},_onSetVerticalScrollbarValue:function(e){!this._scrollbarUpdateFlags[n.ORIENTATION_VERTICAL]&&this.enabled&&this.entity.enabled&&(this._velocity.set(0,0,0),this._onSetScroll(null,e))},_onSetHorizontalScrollingEnabled:function(){this._syncScrollbarEnabledState(n.ORIENTATION_HORIZONTAL)},_onSetVerticalScrollingEnabled:function(){this._syncScrollbarEnabledState(n.ORIENTATION_VERTICAL)},_onHorizontalScrollbarGain:function(){this._syncScrollbarEnabledState(n.ORIENTATION_HORIZONTAL),this._syncScrollbarPosition(n.ORIENTATION_HORIZONTAL)},_onVerticalScrollbarGain:function(){this._syncScrollbarEnabledState(n.ORIENTATION_VERTICAL),this._syncScrollbarPosition(n.ORIENTATION_VERTICAL)},_onSetScroll:function(e,t){var i=!1;i|=this._updateAxis(e,"x",n.ORIENTATION_HORIZONTAL),i|=this._updateAxis(t,"y",n.ORIENTATION_VERTICAL),i&&this.fire("set:scroll",this._scroll)},_updateAxis:function(e,t,i){var n=null!==e&&Math.abs(e-this._scroll[t])>1e-5;return n&&(this._scroll[t]=this._determineNewScrollValue(e,t,i),this._syncContentPosition(i),this._syncScrollbarPosition(i)),n},_determineNewScrollValue:function(e,t,i){if(!this._getScrollingEnabled(i))return this._scroll[t];switch(this.scrollMode){case n.SCROLL_MODE_CLAMP:return n.math.clamp(e,0,this._getMaxScrollValue(i));case n.SCROLL_MODE_BOUNCE:return this._setVelocityFromOvershoot(e,t,i),e;case n.SCROLL_MODE_INFINITE:return e;default:return console.warn("Unhandled scroll mode:"+this.scrollMode),e}},_syncAll:function(){this._syncContentPosition(n.ORIENTATION_HORIZONTAL),this._syncContentPosition(n.ORIENTATION_VERTICAL),this._syncScrollbarPosition(n.ORIENTATION_HORIZONTAL),this._syncScrollbarPosition(n.ORIENTATION_VERTICAL),this._syncScrollbarEnabledState(n.ORIENTATION_HORIZONTAL),this._syncScrollbarEnabledState(n.ORIENTATION_VERTICAL)},_syncContentPosition:function(e){var t=this._getAxis(e),i=this._getSign(e),n=this._contentReference.entity;if(n){var r=this._scroll[t]*this._getMaxOffset(e),s=n.getLocalPosition();s[t]=r*i,n.setLocalPosition(s)}},_syncScrollbarPosition:function(e){var t=this._getAxis(e),i=this._scrollbarReferences[e].entity;i&&i.scrollbar&&(this._scrollbarUpdateFlags[e]=!0,i.scrollbar.value=this._scroll[t],i.scrollbar.handleSize=this._getScrollbarHandleSize(t,e),this._scrollbarUpdateFlags[e]=!1)},_syncScrollbarEnabledState:function(e){var t=this._scrollbarReferences[e].entity;if(t){var i=this._getScrollingEnabled(e),r=this._getScrollbarVisibility(e);switch(r){case n.SCROLLBAR_VISIBILITY_SHOW_ALWAYS:return void(t.enabled=i);case n.SCROLLBAR_VISIBILITY_SHOW_WHEN_REQUIRED:return void(t.enabled=i&&this._contentIsLargerThanViewport(e));default:console.warn("Unhandled scrollbar visibility:"+r),t.enabled=i}}},_contentIsLargerThanViewport:function(e){return this._getContentSize(e)>this._getViewportSize(e)},_contentPositionToScrollValue:function(t){return e.set(t.x/this._getMaxOffset(n.ORIENTATION_HORIZONTAL),t.y/-this._getMaxOffset(n.ORIENTATION_VERTICAL))},_getMaxOffset:function(e){var t=this._getViewportSize(e),i=this._getContentSize(e);return i<t?-this._getViewportSize(e):t-i},_getMaxScrollValue:function(e){return this._contentIsLargerThanViewport(e)?1:0},_getScrollbarHandleSize:function(e,t){var i=this._getViewportSize(t),n=this._getContentSize(t);if(Math.abs(n)<.001)return 1;var r=Math.min(i/n,1),s=this._toOvershoot(this._scroll[e],t);return 0===s?r:r/(1+Math.abs(s))},_getViewportSize:function(e){return this._getSize(e,this._viewportReference)},_getContentSize:function(e){return this._getSize(e,this._contentReference)},_getSize:function(e,t){return t.entity&&t.entity.element?t.entity.element[this._getCalculatedDimension(e)]:0},_getScrollingEnabled:function(e){return e===n.ORIENTATION_HORIZONTAL?this.horizontal:e===n.ORIENTATION_VERTICAL?this.vertical:void console.warn("Unrecognized orientation: "+e)},_getScrollbarVisibility:function(e){return e===n.ORIENTATION_HORIZONTAL?this.horizontalScrollbarVisibility:e===n.ORIENTATION_VERTICAL?this.verticalScrollbarVisibility:void console.warn("Unrecognized orientation: "+e)},_getSign:function(e){return e===n.ORIENTATION_HORIZONTAL?1:-1},_getAxis:function(e){return e===n.ORIENTATION_HORIZONTAL?"x":"y"},_getCalculatedDimension:function(e){return e===n.ORIENTATION_HORIZONTAL?"calculatedWidth":"calculatedHeight"},_destroyDragHelper:function(){this._contentDragHelper&&this._contentDragHelper.destroy()},_onUpdate:function(){this._contentReference.entity&&this.enabled&&this.entity.enabled&&(this._updateVelocity(),this._syncScrollbarEnabledState(n.ORIENTATION_HORIZONTAL),this._syncScrollbarEnabledState(n.ORIENTATION_VERTICAL))},_updateVelocity:function(){if(!this._isDragging()&&(this.scrollMode===n.SCROLL_MODE_BOUNCE&&(this._hasOvershoot("x",n.ORIENTATION_HORIZONTAL)&&this._setVelocityFromOvershoot(this.scroll.x,"x",n.ORIENTATION_HORIZONTAL),this._hasOvershoot("y",n.ORIENTATION_VERTICAL)&&this._setVelocityFromOvershoot(this.scroll.y,"y",n.ORIENTATION_VERTICAL)),this._velocity.data[0]*=1-this.friction,this._velocity.data[1]*=1-this.friction,Math.abs(this._velocity.x)>1e-4||Math.abs(this._velocity.y)>1e-4)){var e=this._contentReference.entity.getLocalPosition();e.x+=this._velocity.data[0],e.y+=this._velocity.data[1],this._contentReference.entity.setLocalPosition(e),this._setScrollFromContentPosition(e)}},_hasOvershoot:function(e,t){return Math.abs(this._toOvershoot(this.scroll[e],t))>.001},_toOvershoot:function(e,t){var i=this._getMaxScrollValue(t);return e<0?e:e>i?e-i:0},_setVelocityFromOvershoot:function(e,t,i){var n=this._toOvershoot(e,i),r=n*this._getMaxOffset(i)*this._getSign(i);Math.abs(r)>0&&(this._velocity[t]=-r/(50*this.bounceAmount+1))},_setVelocityFromContentPositionDelta:function(e){this._prevContentDragPosition?(this._velocity.sub2(e,this._prevContentDragPosition),this._prevContentDragPosition.copy(e)):(this._velocity.set(0,0,0),this._prevContentDragPosition=e.clone())},_setScrollFromContentPosition:function(e){var t=this._contentPositionToScrollValue(e);this._onSetScroll(t.x,t.y)},_isDragging:function(){return this._contentDragHelper&&this._contentDragHelper.isDragging},_setScrollbarComponentsEnabled:function(e){this._scrollbarReferences[n.ORIENTATION_HORIZONTAL].hasComponent("scrollbar")&&(this._scrollbarReferences[n.ORIENTATION_HORIZONTAL].entity.scrollbar.enabled=e),this._scrollbarReferences[n.ORIENTATION_VERTICAL].hasComponent("scrollbar")&&(this._scrollbarReferences[n.ORIENTATION_VERTICAL].entity.scrollbar.enabled=e)},_setContentDraggingEnabled:function(e){this._contentDragHelper&&(this._contentDragHelper.enabled=e)},onEnable:function(){this._setScrollbarComponentsEnabled(!0),this._setContentDraggingEnabled(!0),this._syncAll()},onDisable:function(){this._setScrollbarComponentsEnabled(!1),this._setContentDraggingEnabled(!1)},onRemove:function(){this._toggleLifecycleListeners("off",this.system),this._toggleElementListeners("off"),this._destroyDragHelper()}}),Object.defineProperty(t.prototype,"scroll",{get:function(){return this._scroll},set:function(e){this._onSetScroll(e.x,e.y)}}),{ScrollViewComponent:t}}()),Object.assign(n,function(){var e=[{name:"enabled",type:"boolean"},{name:"horizontal",type:"boolean"},{name:"vertical",type:"boolean"},{name:"scrollMode",type:"number"},{name:"bounceAmount",type:"number"},{name:"friction",type:"number"},{name:"horizontalScrollbarVisibility",type:"number"},{name:"verticalScrollbarVisibility",type:"number"},{name:"viewportEntity",type:"entity"},{name:"contentEntity",type:"entity"},{name:"horizontalScrollbarEntity",type:"entity"},{name:"verticalScrollbarEntity",type:"entity"}],t=function(t){n.ComponentSystem.call(this,t),this.id="scrollview",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ScrollViewComponent,this.DataType=n.ScrollViewComponentData,this.schema=e,this.on("beforeremove",this._onRemoveComponent,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ScrollViewComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(t,i,r){n.ComponentSystem.prototype.initializeComponentData.call(this,t,i,e)},_onRemoveComponent:function(e,t){t.onRemove()}}),{ScrollViewComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ScrollViewComponentData:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this._app=e.app,this._handleReference=new n.EntityReference(this,"handleEntity",{"element#gain":this._onHandleElementGain,"element#lose":this._onHandleElementLose,"element#set:anchor":this._onSetHandleAlignment,"element#set:margin":this._onSetHandleAlignment,"element#set:pivot":this._onSetHandleAlignment}),this._toggleLifecycleListeners("on")};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{_toggleLifecycleListeners:function(e){this[e]("set_value",this._onSetValue,this),this[e]("set_handleSize",this._onSetHandleSize,this),this[e]("set_orientation",this._onSetOrientation,this)},_onHandleElementGain:function(){this._destroyDragHelper(),this._handleDragHelper=new n.ElementDragHelper(this._handleReference.entity.element,this._getAxis()),this._handleDragHelper.on("drag:move",this._onHandleDrag,this),this._updateHandlePositionAndSize()},_onHandleElementLose:function(){this._destroyDragHelper()},_onHandleDrag:function(e){this._handleReference.entity&&this.enabled&&this.entity.enabled&&(this.value=this._handlePositionToScrollValue(e[this._getAxis()]))},_onSetValue:function(e,t,i){Math.abs(i-t)>1e-5&&(this.data.value=n.math.clamp(i,0,1),this._updateHandlePositionAndSize(),this.fire("set:value",this.data.value))},_onSetHandleSize:function(e,t,i){Math.abs(i-t)>1e-5&&(this.data.handleSize=n.math.clamp(i,0,1),this._updateHandlePositionAndSize())},_onSetHandleAlignment:function(){this._updateHandlePositionAndSize()},_onSetOrientation:function(e,t,i){i!==t&&this._handleReference.hasComponent("element")&&(this._handleReference.entity.element[this._getOppositeDimension()]=0)},_updateHandlePositionAndSize:function(){var e=this._handleReference.entity,t=e&&e.element;if(e){var i=e.getLocalPosition();i[this._getAxis()]=this._getHandlePosition(),this._handleReference.entity.setLocalPosition(i)}t&&(t[this._getDimension()]=this._getHandleLength())},_handlePositionToScrollValue:function(e){return e*this._getSign()/this._getUsableTrackLength()},_scrollValueToHandlePosition:function(e){return e*this._getSign()*this._getUsableTrackLength()},_getUsableTrackLength:function(){return Math.max(this._getTrackLength()-this._getHandleLength(),.001)},_getTrackLength:function(){return this.entity.element?this.orientation===n.ORIENTATION_HORIZONTAL?this.entity.element.calculatedWidth:this.entity.element.calculatedHeight:0},_getHandleLength:function(){return this._getTrackLength()*this.handleSize},_getHandlePosition:function(){return this._scrollValueToHandlePosition(this.value)},_getSign:function(){return this.orientation===n.ORIENTATION_HORIZONTAL?1:-1},_getAxis:function(){return this.orientation===n.ORIENTATION_HORIZONTAL?"x":"y"},_getDimension:function(){return this.orientation===n.ORIENTATION_HORIZONTAL?"width":"height"},_getOppositeDimension:function(){return this.orientation===n.ORIENTATION_HORIZONTAL?"height":"width"},_destroyDragHelper:function(){this._handleDragHelper&&this._handleDragHelper.destroy()},_setHandleDraggingEnabled:function(e){this._handleDragHelper&&(this._handleDragHelper.enabled=e)},onEnable:function(){this._setHandleDraggingEnabled(!0)},onDisable:function(){this._setHandleDraggingEnabled(!1)},onRemove:function(){this._destroyDragHelper(),this._toggleLifecycleListeners("off")}}),{ScrollbarComponent:e}}()),Object.assign(n,function(){var e=[{name:"enabled",type:"boolean"},{name:"orientation",type:"number"},{name:"value",type:"number"},{name:"handleSize",type:"number"},{name:"handleEntity",type:"entity"}],t=function(t){n.ComponentSystem.call(this,t),this.id="scrollbar",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ScrollbarComponent,this.DataType=n.ScrollbarComponentData,this.schema=e,this.on("beforeremove",this._onRemoveComponent,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ScrollbarComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(t,i,r){n.ComponentSystem.prototype.initializeComponentData.call(this,t,i,e)},_onRemoveComponent:function(e,t){t.onRemove()}}),{ScrollbarComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ScrollbarComponentData:e}}()),Object.assign(n,{FITTING_NONE:0,FITTING_STRETCH:1,FITTING_SHRINK:2,FITTING_BOTH:3}),Object.assign(n,function(){function e(e){return e.element}function t(e){return e.enabled&&e.element&&e.element.enabled}function i(e){var t="_"+e;Object.defineProperty(r.prototype,e,{get:function(){return this[t]},set:function(e){this[t]!==e&&(this[t]=e,this._scheduleReflow())}})}var r=function(e,t){n.Component.call(this,e,t),this._orientation=n.ORIENTATION_HORIZONTAL,this._reverseX=!1,this._reverseY=!0,this._alignment=new n.Vec2(0,1),this._padding=new n.Vec4,this._spacing=new n.Vec2,this._widthFitting=n.FITTING_NONE,this._heightFitting=n.FITTING_NONE,this._wrap=!1,this._layoutCalculator=new n.LayoutCalculator,this._listenForReflowEvents(this.entity,"on"),this.entity.children.forEach(function(e){this._listenForReflowEvents(e,"on")}.bind(this)),this.entity.on("childinsert",this._onChildInsert,this),this.entity.on("childremove",this._onChildRemove,this),e.app.systems.element.on("add",this._onElementOrLayoutComponentAdd,this),e.app.systems.element.on("beforeremove",this._onElementOrLayoutComponentRemove,this),e.app.systems.layoutchild.on("add",this._onElementOrLayoutComponentAdd,this),e.app.systems.layoutchild.on("beforeremove",this._onElementOrLayoutComponentRemove,this)};return r.prototype=Object.create(n.Component.prototype),r.prototype.constructor=r,Object.assign(r.prototype,{_isSelfOrChild:function(e){return e===this.entity||this.entity.children.indexOf(e)!==-1},_listenForReflowEvents:function(e,t){e.element&&(e.element[t]("enableelement",this._scheduleReflow,this),e.element[t]("disableelement",this._scheduleReflow,this),e.element[t]("resize",this._scheduleReflow,this),e.element[t]("set:pivot",this._scheduleReflow,this)),e.layoutchild&&(e.layoutchild[t]("set_enabled",this._scheduleReflow,this),e.layoutchild[t]("resize",this._scheduleReflow,this))},_onElementOrLayoutComponentAdd:function(e){this._isSelfOrChild(e)&&(this._listenForReflowEvents(e,"on"),this._scheduleReflow())},_onElementOrLayoutComponentRemove:function(e){this._isSelfOrChild(e)&&(this._listenForReflowEvents(e,"off"),this._scheduleReflow())},_onChildInsert:function(e){this._listenForReflowEvents(e,"on"),this._scheduleReflow()},_onChildRemove:function(e){this._listenForReflowEvents(e,"off"),this._scheduleReflow()},_scheduleReflow:function(){this.enabled&&this.entity&&this.entity.enabled&&!this._isPerformingReflow&&this.system.scheduleReflow(this)},reflow:function(){var i=e(this.entity),r=this.entity.children.filter(t).map(e);if(i&&0!==r.length){var s=Math.max(i.calculatedWidth,0),a=Math.max(i.calculatedHeight,0),o={orientation:this._orientation,reverseX:this._reverseX,reverseY:this._reverseY,alignment:this._alignment,padding:this._padding,spacing:this._spacing,widthFitting:this._widthFitting,heightFitting:this._heightFitting,wrap:this._wrap,containerSize:new n.Vec2(s,a)};this._isPerformingReflow=!0;var h=this._layoutCalculator.calculateLayout(r,o);this._isPerformingReflow=!1,this.fire("reflow",h)}},onEnable:function(){this._scheduleReflow()},onRemove:function(){this.entity.off("childinsert",this._onChildInsert,this),this.entity.off("childremove",this._onChildRemove,this),this._listenForReflowEvents(this.entity,"off"),this.entity.children.forEach(function(e){this._listenForReflowEvents(e,"off")}.bind(this)),this.system.app.systems.element.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.element.off("beforeremove",this._onElementOrLayoutComponentRemove,this),this.system.app.systems.layoutchild.off("add",this._onElementOrLayoutComponentAdd,this),this.system.app.systems.layoutchild.off("beforeremove",this._onElementOrLayoutComponentRemove,this)}}),i("orientation"),i("reverseX"),i("reverseY"),i("alignment"),i("padding"),i("spacing"),i("widthFitting"),i("heightFitting"),i("wrap"),{LayoutGroupComponent:r}}()),Object.assign(n,function(){var e=["enabled"],t=function(t){n.ComponentSystem.call(this,t),this.id="layoutgroup",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.LayoutGroupComponent,this.DataType=n.LayoutGroupComponentData,this.schema=e,this._reflowQueue=[],this.on("beforeremove",this._onRemoveComponent,this),n.ComponentSystem.on("postUpdate",this._onPostUpdate,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.LayoutGroupComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.orientation&&(e.orientation=t.orientation),void 0!==t.reverseX&&(e.reverseX=t.reverseX),void 0!==t.reverseY&&(e.reverseY=t.reverseY),void 0!==t.alignment&&(t.alignment instanceof n.Vec2?e.alignment.copy(t.alignment):e.alignment.set(t.alignment[0],t.alignment[1]),e.alignment=e.alignment),void 0!==t.padding&&(t.padding instanceof n.Vec4?e.padding.copy(t.padding):e.padding.set(t.padding[0],t.padding[1],t.padding[2],t.padding[3]),e.padding=e.padding),void 0!==t.spacing&&(t.spacing instanceof n.Vec2?e.spacing.copy(t.spacing):e.spacing.set(t.spacing[0],t.spacing[1]),e.spacing=e.spacing),void 0!==t.widthFitting&&(e.widthFitting=t.widthFitting),void 0!==t.heightFitting&&(e.heightFitting=t.heightFitting),void 0!==t.wrap&&(e.wrap=t.wrap),n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},cloneComponent:function(e,t){var i=e.layoutgroup;return this.addComponent(t,{enabled:i.enabled,orientation:i.orientation,reverseX:i.reverseX,reverseY:i.reverseY,alignment:i.alignment,padding:i.padding,spacing:i.spacing,widthFitting:i.widthFitting,heightFitting:i.heightFitting,wrap:i.wrap})},scheduleReflow:function(e){this._reflowQueue.indexOf(e)===-1&&this._reflowQueue.push(e)},_onPostUpdate:function(){this._processReflowQueue()},_processReflowQueue:function(){if(0!==this._reflowQueue.length){for(this._reflowQueue.sort(function(e,t){return e.entity.graphDepth<t.entity.graphDepth});this._reflowQueue.length>0;)this._reflowQueue[0].reflow(),this._reflowQueue.shift();this._reflowQueue=[]}},_onRemoveComponent:function(e,t){t.onRemove()}}),{LayoutGroupComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{LayoutGroupComponentData:e}}()),Object.assign(n,function(){function e(){}function t(e){function t(e,t){return-t[F.size]*e.pivot[F.axis]}function h(e,t){return-t[B.size]*e.pivot[B.axis]}function l(e,t){return t[F.size]*(1-e.pivot[F.axis])}function c(e,t){e=e.filter(d),N=t,o.x=N.containerSize.x-N.padding.data[0]-N.padding.data[2],o.y=N.containerSize.y-N.padding.data[1]-N.padding.data[3],u(e);var i=p(f(e)),n=m(i,_(i)),r=E(i,n);return T(i,n,r),S(i,n,r),w(i,n,r)}function d(e){var t=e.entity.layoutchild;return!t||!t.enabled||!t.excludeFromLayout}function u(e){for(var t=0;t<e.length;++t){var i=e[t],n=i.anchor.data;0===n[0]&&0===n[1]&&0===n[2]&&0===n[3]||(i.anchor=[0,0,0,0])}}function f(e){if(!N.wrap)return[e];for(var t=[[]],i=C(e),r=0,s=N[F.fitting]===n.FITTING_SHRINK,a=0;a<e.length;++a){t[t.length-1].length>0&&(r+=N.spacing[F.axis]);var h=i[a][F.size];r+=h,!s&&r>o[F.axis]&&0!==t[t.length-1].length&&(r=h,t.push([])),t[t.length-1].push(e[a]),s&&r>o[F.axis]&&a!==e.length-1&&(r=0,t.push([]))}return t}function p(e){var t=N.orientation===n.ORIENTATION_HORIZONTAL&&N.reverseX||N.orientation===n.ORIENTATION_VERTICAL&&N.reverseY,i=N.orientation===n.ORIENTATION_HORIZONTAL&&N.reverseY||N.orientation===n.ORIENTATION_VERTICAL&&N.reverseX;if(t)for(var r=0;r<e.length;++r)t&&e[r].reverse();return i&&e.reverse(),e}function _(e){for(var t=[],i=0;i<e.length;++i){var n=e[i],r=C(n),s=v(r,F),h=A(N[F.fitting],s,o[F.axis]);h===a.APPLY_STRETCHING?y(r,s,F):h===a.APPLY_SHRINKING&&g(r,s,F),t.push(r)}return t}function m(e,t){var i,n,r,s=[],h=[];for(n=0;n<e.length;++n){for(r=e[n],r.largestElement=null,r.largestSize={width:Number.NEGATIVE_INFINITY,height:Number.NEGATIVE_INFINITY},i=0;i<r.length;++i){var l=t[n][i];l[B.size]>r.largestSize[B.size]&&(r.largestElement=r[i],r.largestSize=l)}s.push(r.largestElement),h.push(r.largestSize)}var c=v(h,B),d=A(N[B.fitting],c,o[B.axis]);for(d===a.APPLY_STRETCHING?y(h,c,B):d===a.APPLY_SHRINKING&&g(h,c,B),n=0;n<e.length;++n)for(r=e[n],i=0;i<r.length;++i){var u=t[n][i],f=u[B.size],p=1===e.length?o[B.axis]:r.largestSize[B.size],_=A(N[B.fitting],f,p);_===a.APPLY_STRETCHING?u[B.size]=Math.min(p,u[B.maxSize]):_===a.APPLY_SHRINKING&&(u[B.size]=Math.max(p,u[B.minSize]))}return t}function A(e,t,i){switch(e){case n.FITTING_NONE:return a.NONE;case n.FITTING_STRETCH:return t<i?a.APPLY_STRETCHING:a.NONE;case n.FITTING_SHRINK:return t>=i?a.APPLY_SHRINKING:a.NONE;case n.FITTING_BOTH:return t<i?a.APPLY_STRETCHING:t>=i?a.APPLY_SHRINKING:a.NONE;default:throw new Error("Unrecognized fitting mode: "+e)}}function v(e,t){var i=I(e,t.size),n=(e.length-1)*N.spacing[t.axis];return i+n}function y(e,t,i){for(var n=O(e,i.maxSize),r=R(e,i.fittingProportion),s=L(r,n),a=o[i.axis]-t,h=0;h<e.length;++h){var l=n[h],c=b(l,a,r,s),d=e[l][i.size]+c,u=e[l][i.maxSize],f=Math.min(d,u);e[l][i.size]=f;var p=Math.max(d-f,0),_=c-p;a-=_}}function g(e,t,i){for(var n=O(e,i.minSize,!0),r=R(e,i.fittingProportion),s=x(r),a=L(s,n),h=t-o[i.axis],l=0;l<e.length;++l){var c=n[l],d=b(c,h,s,a),u=e[c][i.size]-d,f=e[c][i.minSize],p=Math.max(u,f);e[c][i.size]=p;var _=Math.max(p-u,0),m=d-_;h-=m}}function b(e,t,i,n){var r=i[e],s=n[e];return Math.abs(r)<1e-5&&Math.abs(s)<1e-5?t:t*r/s}function E(e,i){var n={};n[F.axis]=0,n[B.axis]=0,e[F.size]=Number.NEGATIVE_INFINITY;for(var r=[],s=0;s<e.length;++s){var a=e[s];if(0===a.length)return;for(var o=[],c=i[s],d=0;d<a.length;++d){var u=a[d],f=c[d];n[B.axis]-=h(u,f),n[F.axis]-=t(u,f),o[d]={},o[d][F.axis]=n[F.axis],o[d][B.axis]=n[B.axis],n[B.axis]+=h(u,f),n[F.axis]+=l(u,f)+N.spacing[F.axis]}a[F.size]=n[F.axis]-N.spacing[F.axis],a[B.size]=a.largestSize[B.size],e[F.size]=Math.max(e[F.size],a[F.size]),n[F.axis]=0,n[B.axis]+=a[B.size]+N.spacing[B.axis],r.push(o)}return e[B.size]=n[B.axis]-N.spacing[B.axis],r}function T(e,t,i){for(var n=N.alignment[F.axis],r=N.alignment[B.axis],s=N.padding[F.axis],a=N.padding[B.axis],h=0;h<e.length;++h)for(var l=e[h],c=t[h],d=i[h],u=(o[F.axis]-l[F.size])*n+s,f=(o[B.axis]-e[B.size])*r+a,p=0;p<l.length;++p){var _=(l[B.size]-c[p][B.size])*N.alignment[B.axis];d[p][F.axis]+=u,d[p][B.axis]+=f+_}}function S(e,t,i){for(var r=0;r<e.length;++r)for(var s=e[r],a=t[r],o=i[r],h=0;h<s.length;++h){var l=s[h];l[F.calculatedSize]=a[h][F.size],l[B.calculatedSize]=a[h][B.size],N.orientation===n.ORIENTATION_HORIZONTAL?l.entity.setLocalPosition(o[h][F.axis],o[h][B.axis],l.entity.getLocalPosition().z):l.entity.setLocalPosition(o[h][B.axis],o[h][F.axis],l.entity.getLocalPosition().z)}}function w(e){var t=e.width,i=e.height,r=(o.x-t)*N.alignment.x+N.padding.x,s=(o.y-i)*N.alignment.y+N.padding.y;return{bounds:new n.Vec4(r,s,t,i)}}function C(e){for(var t=[],i=0;i<e.length;++i){var n=e[i],r=Math.max(M(n,"minWidth"),0),s=Math.max(M(n,"minHeight"),0),a=Math.max(M(n,"maxWidth"),r),o=Math.max(M(n,"maxHeight"),s),h=P(M(n,"width"),r,a),l=P(M(n,"height"),s,o),c=M(n,"fitWidthProportion"),d=M(n,"fitHeightProportion");t.push({minWidth:r,minHeight:s,maxWidth:a,maxHeight:o,width:h,height:l,fitWidthProportion:c,fitHeightProportion:d})}return t}function M(e,t){var i=e.entity.layoutchild;return i&&i.enabled&&void 0!==i[t]&&null!==i[t]?i[t]:void 0!==e[t]?e[t]:s[t]}function P(e,t,i){return Math.min(Math.max(e,t),i)}function I(e,t){return e.reduce(function(e,i){return e+i[t]},0)}function R(e,t){var i,n=I(e,t),r=[],s=e.length;if(0===n)for(i=0;i<s;++i)r.push(1/s);else for(i=0;i<s;++i)r.push(e[i][t]/n);return r}function x(e){if(1===e.length)return[1];for(var t=[],i=e.length,n=0;n<i;++n)t.push((1-e[n])/(i-1));return t}function O(e,t,i){return e.forEach(k),e.slice().sort(function(e,n){return i?n[t]-e[t]:e[t]-n[t]}).map(D)}function k(e,t){e.index=t}function D(e){return e.index}function L(e,t){var i=[];i[t[e.length-1]]=e[t[e.length-1]];for(var n=e.length-2;n>=0;--n)i[t[n]]=i[t[n+1]]+e[t[n]];return i}var N,F=i[e],B=i[r[e]];return c}var i={};i[n.ORIENTATION_HORIZONTAL]={axis:"x",size:"width",calculatedSize:"calculatedWidth",minSize:"minWidth",maxSize:"maxWidth",fitting:"widthFitting",fittingProportion:"fitWidthProportion"},i[n.ORIENTATION_VERTICAL]={axis:"y",size:"height",calculatedSize:"calculatedHeight",minSize:"minHeight",maxSize:"maxHeight",fitting:"heightFitting",fittingProportion:"fitHeightProportion"};var r={};r[n.ORIENTATION_HORIZONTAL]=n.ORIENTATION_VERTICAL,r[n.ORIENTATION_VERTICAL]=n.ORIENTATION_HORIZONTAL;var s={minWidth:0,minHeight:0,maxWidth:Number.POSITIVE_INFINITY,maxHeight:Number.POSITIVE_INFINITY,width:null,height:null,fitWidthProportion:0,fitHeightProportion:0},a={NONE:"NONE",APPLY_STRETCHING:"APPLY_STRETCHING",APPLY_SHRINKING:"APPLY_SHRINKING"},o=new n.Vec2,h={};return h[n.ORIENTATION_HORIZONTAL]=t(n.ORIENTATION_HORIZONTAL),h[n.ORIENTATION_VERTICAL]=t(n.ORIENTATION_VERTICAL),Object.assign(e.prototype,{calculateLayout:function(e,t){var i=h[t.orientation];if(i)return i(e,t);throw new Error("Unrecognized orientation value: "+t.orientation)}}),{LayoutCalculator:e}}()),Object.assign(n,function(){function e(e){var i="_"+e;Object.defineProperty(t.prototype,e,{get:function(){return this[i]},set:function(e){this[i]!==e&&(this[i]=e,this.fire("resize"))}})}var t=function(e,t){n.Component.call(this,e,t),this._minWidth=0,this._minHeight=0,this._maxWidth=null,this._maxHeight=null,this._fitWidthProportion=0,this._fitHeightProportion=0,this._excludeFromLayout=!1};return t.prototype=Object.create(n.Component.prototype),t.prototype.constructor=t,
e("minWidth"),e("minHeight"),e("maxWidth"),e("maxHeight"),e("fitWidthProportion"),e("fitHeightProportion"),e("excludeFromLayout"),{LayoutChildComponent:t}}()),Object.assign(n,function(){var e=["enabled"],t=function(t){n.ComponentSystem.call(this,t),this.id="layoutchild",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.LayoutChildComponent,this.DataType=n.LayoutChildComponentData,this.schema=e};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.LayoutChildComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.minWidth&&(e.minWidth=t.minWidth),void 0!==t.minHeight&&(e.minHeight=t.minHeight),void 0!==t.maxWidth&&(e.maxWidth=t.maxWidth),void 0!==t.maxHeight&&(e.maxHeight=t.maxHeight),void 0!==t.fitWidthProportion&&(e.fitWidthProportion=t.fitWidthProportion),void 0!==t.fitHeightProportion&&(e.fitHeightProportion=t.fitHeightProportion),void 0!==t.excludeFromLayout&&(e.excludeFromLayout=t.excludeFromLayout),n.ComponentSystem.prototype.initializeComponentData.call(this,e,t,i)},cloneComponent:function(e,t){var i=e.layoutchild;return this.addComponent(t,{enabled:i.enabled,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,fitWidthProportion:i.fitWidthProportion,fitHeightProportion:i.fitHeightProportion,excludeFromLayout:i.excludeFromLayout})}}),{LayoutChildComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{LayoutChildComponentData:e}}()),Object.assign(n,function(){n.FONT_MSDF="msdf";var e=function(e,t){this.type=n.FONT_MSDF,this.em=1,this.textures=e,this.intensity=0,this._data=null,this.data=t};return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){if(this._data=e,e&&(void 0!==this._data.intensity&&(this.intensity=this._data.intensity),this._data.info||(this._data.info={}),(!this._data.version||this._data.version<2)&&(this._data.info.maps=[{width:this._data.info.width,height:this._data.info.height}],this._data.chars)))for(var t in this._data.chars)this._data.chars[t].map=0}}),{FONT_MSDF:n.FONT_MSDF,Font:e}}()),Object.assign(n,function(){var e=function(e,t){n.Component.call(this,e,t),this._oldState=!0,this._size=new n.Vec3,this.on("set_enabled",this._onSetEnabled,this)};return e.prototype=Object.create(n.Component.prototype),e.prototype.constructor=e,Object.assign(e.prototype,{onEnable:function(){n.Component.prototype.onEnable.call(this),this._checkState()},onDisable:function(){n.Component.prototype.onDisable.call(this),this._checkState()},_onSetEnabled:function(e,t,i){this._checkState()},_checkState:function(){var e=this.enabled&&this.entity.enabled;e!==this._oldState&&(this._oldState=e,this.fire("enable"),this.fire("state",this.enabled))},_onBeforeRemove:function(){this.fire("remove")}}),Object.defineProperty(e.prototype,"size",{set:function(e){e instanceof n.Vec3?this._size.copy(e):e instanceof Array&&e.length>=3&&this.size.set(e[0],e[1],e[2])},get:function(){return this._size}}),{ZoneComponent:e}}()),Object.assign(n,function(){var e=["enabled"],t=function(t){n.ComponentSystem.call(this,t),this.id="zone",this.app=t,t.systems.add(this.id,this),this.ComponentType=n.ZoneComponent,this.DataType=n.ZoneComponentData,this.schema=e,this.on("beforeremove",this._onBeforeRemove,this)};return t.prototype=Object.create(n.ComponentSystem.prototype),t.prototype.constructor=t,n.Component._buildAccessors(n.ZoneComponent.prototype,e),Object.assign(t.prototype,{initializeComponentData:function(e,t,i){e.enabled=!t.hasOwnProperty("enabled")||!!t.enabled,t.size&&(t.size instanceof n.Vec3?e.size.copy(t.size):t.size instanceof Array&&t.size.length>=3&&e.size.set(t.size[0],t.size[1],t.size[2]))},cloneComponent:function(e,t){var i={size:e.zone.size};return this.addComponent(t,i)},_onBeforeRemove:function(e,t){t._onBeforeRemove()}}),{ZoneComponentSystem:t}}()),Object.assign(n,function(){var e=function(){this.enabled=!0};return{ZoneComponentData:e}}()),Object.assign(n,function(){function e(t,i,r,s){if(i instanceof n.Entity){var a=i.c;Object.keys(a).forEach(function(e){var i=a[e],n=i.system.getPropertiesOfType("entity");n.forEach(function(n){var a=n.name,o=i[a],h=!!t.findByGuid(o);if(h){var l=s[o];l?r.c[e][a]=l:console.warn("Could not find corresponding entity id when resolving duplicated entity references")}})});var o=i.children.filter(function(e){return e instanceof n.Entity}),h=r.children.filter(function(e){return e instanceof n.Entity});o.forEach(function(i,n){e(t,i,h[n],s)})}}var t=function(e,t){n.GraphNode.call(this,e),e instanceof n.Application&&(t=e),this._guid=n.guid.create(),this._batchHandle=null,this.c={},this._app=t,t||(this._app=n.Application.getApplication(),this._app||console.error("Couldn't find current application")),n.events.attach(this)};return t.prototype=Object.create(n.GraphNode.prototype),t.prototype.constructor=t,t.prototype.addComponent=function(e,t){var i=this._app.systems[e];return i?this.c[e]?null:i.addComponent(this,t):null},t.prototype.removeComponent=function(e){var t=this._app.systems[e];t&&this.c[e]&&t.removeComponent(this)},t.prototype.getGuid=function(){return this._guid},t.prototype.setGuid=function(e){this._guid=e},t.prototype._notifyHierarchyStateChanged=function(e,t){var i=!1;e===this&&0===this._app._enableList.length&&(i=!0),e._beingEnabled=!0,e._onHierarchyStateChanged(t),e._onHierarchyStatePostChanged&&this._app._enableList.push(e);var n,r,s=e._children;for(n=0,r=s.length;n<r;n++)s[n]._enabled&&this._notifyHierarchyStateChanged(s[n],t);if(e._beingEnabled=!1,i){for(n=0,r=this._app._enableList.length;n<r;n++)this._app._enableList[n]._onHierarchyStatePostChanged();this._app._enableList.length=0}},t.prototype._onHierarchyStateChanged=function(e){n.GraphNode.prototype._onHierarchyStateChanged.call(this,e);var t,i=this.c;for(var r in i)i.hasOwnProperty(r)&&(t=i[r],t.enabled&&(e?t.onEnable():t.onDisable()))},t.prototype._onHierarchyStatePostChanged=function(){var e=this.c;for(var t in e)e.hasOwnProperty(t)&&e[t].onPostStateChange()},t.prototype.setRequest=function(e){this._request=e},t.prototype.getRequest=function(){return this._request},t.prototype.findByGuid=function(e){if(this._guid===e)return this;for(var t=0;t<this._children.length;t++)if(this._children[t].findByGuid){var i=this._children[t].findByGuid(e);if(null!==i)return i}return null},t.prototype.destroy=function(){var e;for(e in this.c)this.c[e].enabled=!1;for(e in this.c)this.c[e].system.removeComponent(this);this._parent&&this._parent.removeChild(this);for(var t=this._children,i=t.shift();i;)i instanceof n.Entity&&i.destroy(),i._parent=null,i=t.shift();this.fire("destroy",this),this._callbacks&&(this._callbacks=null),this._callbackActive&&(this._callbackActive=null)},t.prototype.clone=function(){var t={},i=this._cloneRecursively(t);return t[this.getGuid()]=i.getGuid(),e(this,this,i,t),i},t.prototype._cloneRecursively=function(e){var t,i=new n.Entity(this._app);n.GraphNode.prototype._cloneInternal.call(this,i);for(t in this.c){var r=this.c[t];r.system.cloneComponent(this,i)}var s;for(s=0;s<this._children.length;s++){var a=this._children[s];if(a instanceof n.Entity){var o=a._cloneRecursively(e);i.addChild(o),e[a.getGuid()]=o.getGuid()}}return i},{Entity:t}}()),Object.assign(n,function(){function e(e,t,i){if(!(e&&e instanceof n.Component))throw new Error("The parentComponent argument is required and must be a Component");if(!t||"string"!=typeof t)throw new Error("The propertyName argument is required and must be a string");if(i&&"object"!=typeof i)throw new Error("If provided, the eventConfig argument must be an object");this._parentComponent=e,this._entityPropertyName=t,this._entity=null,this._app=e.system.app,this._configureEventListeners(i||{},{"entity#destroy":this._onEntityDestroy}),this._toggleLifecycleListeners("on")}return Object.assign(e.prototype,{_configureEventListeners:function(e,t){var i=this._parseEventListenerConfig(e,"external",this._parentComponent),n=this._parseEventListenerConfig(t,"internal",this);this._eventListenerConfigs=i.concat(n),this._listenerStatusFlags={},this._gainListeners={},this._loseListeners={}},_parseEventListenerConfig:function(e,t,i){return Object.keys(e).map(function(n,r){var s=n.split("#"),a=s[0],o=s[1],h=e[n];if(2!==s.length||"string"!=typeof a||0===a.length||"string"!=typeof o||0===o.length)throw new Error("Invalid event listener description: `"+n+"`");if("function"!=typeof h)throw new Error("Invalid or missing callback for event listener `"+n+"`");return{id:t+"_"+r+"_"+n,sourceName:a,eventName:o,callback:h,scope:i}},this)},_toggleLifecycleListeners:function(e){this._parentComponent[e]("set_"+this._entityPropertyName,this._onSetEntity,this),this._parentComponent.system[e]("beforeremove",this._onParentComponentRemove,this),n.ComponentSystem[e]("postInitialize",this._onPostInitialize,this),this._app.on("tools:sceneloaded",this._onSceneLoaded,this);for(var t=[],i=0;i<this._eventListenerConfigs.length;++i){var r=this._eventListenerConfigs[i],s=this._app.systems[r.sourceName];s&&(t.indexOf(s)===-1&&t.push(s),s&&"gain"===r.eventName&&(this._gainListeners[r.sourceName]=r),s&&"lose"===r.eventName&&(this._loseListeners[r.sourceName]=r))}for(var a=0;a<t.length;++a)t[a][e]("add",this._onComponentAdd,this),t[a][e]("beforeremove",this._onComponentRemove,this)},_onSetEntity:function(e,t,i){if(i instanceof n.Entity)this._updateEntityReference();else{if(null!==i&&void 0!==i&&"string"!=typeof i)return void console.warn("Entity field `"+this._entityPropertyName+"` was set to unexpected type '"+typeof i+"'");t!==i&&this._updateEntityReference()}},_onPostInitialize:function(){this._updateEntityReference()},_onSceneLoaded:function(){this._updateEntityReference()},_updateEntityReference:function(){var e,t=this._parentComponent.data[this._entityPropertyName];t instanceof n.Entity?(e=t,t=e.getGuid(),this._parentComponent.data[this._entityPropertyName]=t):e=t?this._parentComponent.system.app.root.findByGuid(t):null;var i=this._entity!==e;i&&(this._entity&&this._onBeforeEntityChange(),this._entity=e,this._entity&&this._onAfterEntityChange())},_onBeforeEntityChange:function(){this._toggleEntityListeners("off"),this._callAllGainOrLoseListeners(this._loseListeners)},_onAfterEntityChange:function(){this._toggleEntityListeners("on"),this._callAllGainOrLoseListeners(this._gainListeners)},_onComponentAdd:function(e,t){var i=t.system.name;e===this._entity&&(this._callGainOrLoseListener(i,this._gainListeners),this._toggleComponentListeners("on",i))},_onComponentRemove:function(e,t){var i=t.system.name;e===this._entity&&(this._callGainOrLoseListener(i,this._loseListeners),this._toggleComponentListeners("off",i,!0))},_callAllGainOrLoseListeners:function(e){for(var t in this._entity.c)this._callGainOrLoseListener(t,e)},_callGainOrLoseListener:function(e,t){if(this._entity.c.hasOwnProperty(e)&&t[e]){var i=t[e];i.callback.call(i.scope)}},_toggleEntityListeners:function(e,t){if(this._entity)for(var i=0;i<this._eventListenerConfigs.length;++i)this._safeToggleListener(e,this._eventListenerConfigs[i],t)},_toggleComponentListeners:function(e,t,i){for(var n=0;n<this._eventListenerConfigs.length;++n){var r=this._eventListenerConfigs[n];r.sourceName===t&&this._safeToggleListener(e,r,i)}},_safeToggleListener:function(e,t,i){var n="on"===e;if(!n||!this._listenerStatusFlags[t.id]){var r=this._getEventSource(t.sourceName,i);r&&(r[e](t.eventName,t.callback,t.scope),this._listenerStatusFlags[t.id]=n)}},_getEventSource:function(e,t){if("entity"===e)return this._entity;var i=this._entity[e];return i?i:(t||console.warn("Entity has no component with name "+e),null)},_onEntityDestroy:function(e){this._entity===e&&(this._toggleEntityListeners("off",!0),this._entity=null)},_onParentComponentRemove:function(e,t){t===this._parentComponent&&(this._toggleLifecycleListeners("off"),this._toggleEntityListeners("off",!0))},hasComponent:function(e){return!(!this._entity||!this._entity.c)&&!!this._entity.c[e]}}),Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity}}),{EntityReference:e}}()),Object.assign(n,function(){var e=function(){this._handlers={},this._requests={},this._cache={}};return Object.assign(e.prototype,{addHandler:function(e,t){this._handlers[e]=t,t._loader=this},removeHandler:function(e){delete this._handlers[e]},getHandler:function(e){return this._handlers[e]},load:function(e,t,i,n){var r=this._handlers[t];if(!r){var s="No handler for asset type: "+t;return void i(s)}var a=e+t;void 0!==this._cache[a]?i(null,this._cache[a]):this._requests[a]?this._requests[a].push(i):(this._requests[a]=[i],r.load(e,function(t,i,s){if(this._requests[a]){var o,h=this._requests[a].length;if(t)for(o=0;o<h;o++)this._requests[a][o](t);else{var l=r.open(e,i,n);for(this._cache[a]=l,o=0;o<h;o++)this._requests[a][o](null,l,s)}delete this._requests[a]}}.bind(this),n))},open:function(e,t){var i=this._handlers[e];return i?i.open(null,t):(console.warn("No resource handler found for: "+e),t)},patch:function(e,t){var i=this._handlers[e.type];return i?void(i.patch&&i.patch(e,t)):void console.warn("No resource handler found for: "+e.type)},clearCache:function(e,t){delete this._cache[e+t]},getFromCache:function(e,t){if(this._cache[e+t])return this._cache[e+t]},destroy:function(){this._handlers={},this._requests={},this._cache={}}}),{ResourceLoader:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading animation resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return this["_parseAnimationV"+t.animation.version](t)},_parseAnimationV3:function(e){var t=e.animation,i=new n.Animation;i.setName(t.name),i.duration=t.duration;for(var r=0;r<t.nodes.length;r++){var s=new n.Node,a=t.nodes[r];s._name=a.name;for(var o=0;o<a.keys.length;o++){var h=a.keys[o],l=h.time,c=h.pos,d=h.rot,u=h.scale,f=new n.Vec3(c[0],c[1],c[2]),p=(new n.Quat).setFromEulerAngles(d[0],d[1],d[2]),_=new n.Vec3(u[0],u[1],u[2]),m=new n.Key(l,f,p,_);s._keys.push(m)}i.addNode(s)}return i},_parseAnimationV4:function(e){var t=e.animation,i=new n.Animation;i.setName(t.name),i.duration=t.duration;for(var r=0;r<t.nodes.length;r++){var s=new n.Node,a=t.nodes[r];s._name=a.name;for(var o=a.defaults.p,h=a.defaults.r,l=a.defaults.s,c=0;c<a.keys.length;c++){var d=a.keys[c],u=d.t,f=o?o:d.p,p=h?h:d.r,_=l?l:d.s,m=new n.Vec3(f[0],f[1],f[2]),A=(new n.Quat).setFromEulerAngles(p[0],p[1],p[2]),v=new n.Vec3(_[0],_[1],_[2]),y=new n.Key(u,m,A,v);s._keys.push(y)}i.addNode(s)}return i}}),{AnimationHandler:e}}()),Object.assign(n,function(){var e=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var i=e.indexOf("Trident/");if(i>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}return!1}(),t=function(e){this.manager=e};return Object.assign(t.prototype,{_isSupported:function(e){var t={".ogg":"audio/ogg",".mp3":"audio/mpeg",".wav":"audio/x-wav",".mp4a":"audio/mp4",".m4a":"audio/mp4",".mp4":"audio/mp4",".aac":"audio/aac"},i=n.path.getExtension(e);return!!t[i]},load:function(e,t){var i=function(e){t(null,new n.Sound(e))},r=function(i){i=i||"Error loading audio url: "+e,console.warn(i),t(i)};if(this._createSound){if(!this._isSupported(e))return void r(n.string.format("Audio format for {0} not supported",e));this._createSound(e,i,r)}else r(null)},open:function(e,t){return t}}),n.SoundManager.hasAudioContext()?t.prototype._createSound=function(e,t,i){var r=this.manager;return r.context?void n.http.get(e,function(e,n){return e?void i(e):void r.context.decodeAudioData(n,t,i)}):void i("Audio manager has no audio context")}:n.SoundManager.hasAudio()&&(t.prototype._createSound=function(t,i,n){var r=null;try{r=new Audio}catch(s){return void n("No support for Audio element")}e&&document.body.appendChild(r);var a=function(){r.removeEventListener("canplaythrough",a),e&&document.body.removeChild(r),i(r)};r.onerror=function(){r.onerror=null,e&&document.body.removeChild(r),n()},r.addEventListener("canplaythrough",a),r.src=t}),{AudioHandler:t}}()),Object.assign(n,function(){var e=function(e,t,i){this._device=e,this._assets=t,this._loader=i};return Object.assign(e.prototype,{load:function(e,t){},open:function(e,t){},patch:function(e,t){var i=this,r=!1;if(e.resources[0]||(e.resources[0]=new n.Texture(this._device,{format:n.PIXELFORMAT_R8_G8_B8_A8,cubemap:!0,mipmaps:!0,fixCubemapSeams:!!e._dds}),r=!0),e.file){if(e.file&&!e._dds){var s=e.getFileUrl();t._loader.load(s+"?t="+e.file.hash,"texture",function(n,r){n?(t.fire("error",n,e),t.fire("error:"+e.id,n,e),e.fire("error",n,e)):(t._loader.patch({resource:r,type:"texture",data:e.data},t),e._dds=r,i.patch(e,t))})}}else delete e._dds;if(e.file&&e._dds||!e.resources[1]){if(e._dds&&!e.resources[1]){e.resources=[e.resources[0]],e._dds.fixCubemapSeams=!0,e._dds.addressU=n.ADDRESS_CLAMP_TO_EDGE,e._dds.addressV=n.ADDRESS_CLAMP_TO_EDGE;var a=0;this._device.useTexCubeLod&&(e.resources.push(e._dds),a=1);for(var o=a;o<6;o++){var h=new n.Texture(this._device,{cubemap:!0,fixCubemapSeams:!0,mipmaps:!0,format:e._dds.format,rgbm:e._dds.rgbm,width:Math.pow(2,7-o),height:Math.pow(2,7-o)});h._levels[0]=e._dds._levels[o],h.upload(),e.resources.push(h)}r=!0}}else e.resources=[e.resources[0]],r=!0;var l=e.resource;l.name!==e.name&&(l.name=e.name);var c=!!e.data.rgbm;e.data.hasOwnProperty("rgbm")&&l.rgbm!==c&&(l.rgbm=c),l.fixCubemapSeams=!!e._dds,e.data.hasOwnProperty("minFilter")&&l.minFilter!==e.data.minFilter&&(l.minFilter=e.data.minFilter),e.data.hasOwnProperty("magFilter")&&l.magFilter!==e.data.magFilter&&(l.magFilter=e.data.magFilter),e.data.hasOwnProperty("anisotropy")&&l.anisotropy!==e.data.anisotropy&&(l.anisotropy=e.data.anisotropy),l.addressU!==n.ADDRESS_CLAMP_TO_EDGE&&(l.addressU=n.ADDRESS_CLAMP_TO_EDGE),l.addressV!==n.ADDRESS_CLAMP_TO_EDGE&&(l.addressV=n.ADDRESS_CLAMP_TO_EDGE),this._patchTextureFaces(e,t),r&&(t.fire("load",e),t.fire("load:"+e.id,e),e.fire("load",e))},_patchTexture:function(){this.registry._loader._handlers.cubemap._patchTextureFaces(this,this.registry)},_patchTextureFaces:function(e,t){if(e.loadFaces||!e.file){var i=e.resource,n=[],r=0,s=!1,a=this;e._levelsEvents||(e._levelsEvents=[null,null,null,null,null,null]),e.data.textures.forEach(function(o,h){var l=function(o){r++,n[h]=o&&o.resource.getSource()||null;var l=e._levelsEvents[h];l!==o&&(l&&l.off("load",a._patchTexture,e),o&&o.on("load",a._patchTexture,e),e._levelsEvents[h]=o||null),n[h]!==i._levels[0][h]&&(s=!0),6===r&&s&&(i.setSource(n),t.fire("load",e),t.fire("load:"+e.id,e),e.fire("load",e))},c=function(e){e.ready(l),t.load(e)},d=t.get(o);d?(d.ready(l),t.load(d)):o?(t.once("load:"+o,l),t.once("add:"+o,c)):l(null)})}}}),{CubemapHandler:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading JSON resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}}),{JsonHandler:e}}()),Object.assign(n,function(){var e={ambient:"vec3",ambientTnumber:"boolean",aoMap:"texture",aoVertexColor:"boolean",aoVertexColorChannel:"string",aoMapChannel:"string",aoMapUv:"number",aoMapTiling:"vec2",aoMapOffset:"vec2",occludeSpecular:"boolean",diffuse:"vec3",diffuseMap:"texture",diffuseTint:"boolean",diffuseVertexColor:"boolean",diffuseVertexColorChannel:"string",diffuseMapChannel:"string",diffuseMapUv:"number",diffuseMapTiling:"vec2",diffuseMapOffset:"vec2",diffuseMapTnumber:"boolean",specular:"vec3",specularVertexColor:"boolean",specularVertexColorChannel:"string",specularMapChannel:"string",specularMapUv:"number",specularMap:"texture",specularTint:"boolean",specularMapTiling:"vec2",specularMapOffset:"vec2",specularMapTnumber:"boolean",specularAntialias:"boolean",useMetalness:"boolean",metalnessMap:"texture",metalnessVertexColor:"boolean",metalnessVertexColorChannel:"string",metalnessMapChannel:"string",metalnessMapUv:"number",metalnessMapTiling:"vec2",metalnessMapOffset:"vec2",metalnessMapTnumber:"boolean",metalness:"number",conserveEnergy:"boolean",shininess:"number",glossMap:"texture",glossVertexColor:"boolean",glossVertexColorChannel:"string",glossMapChannel:"string",glossMapUv:"number",glossMapTiling:"vec2",glossMapOffset:"vec2",fresnelModel:"number",fresnelFactor:"float",emissive:"vec3",emissiveMap:"texture",emissiveVertexColor:"boolean",emissiveVertexColorChannel:"string",emissiveMapChannel:"string",emissiveMapUv:"number",emissiveMapTiling:"vec2",emissiveMapOffset:"vec2",emissiveTint:"boolean",emissiveIntensity:"number",normalMap:"texture",normalMapTiling:"vec2",normalMapOffset:"vec2",normalMapUv:"number",bumpMapFactor:"number",heightMap:"texture",heightMapChannel:"string",heightMapUv:"number",heightMapTiling:"vec2",heightMapOffset:"vec2",heightMapFactor:"number",alphaTest:"number",opacity:"number",opacityMap:"texture",opacityVertexColor:"boolean",opacityVertexColorChannel:"string",opacityMapChannel:"string",opacityMapUv:"number",opacityMapTiling:"vec2",opacityMapOffset:"vec2",reflectivity:"number",refraction:"number",refractionIndex:"number",sphereMap:"texture",cubeMap:"cubemap",cubeMapProjection:"number",cubeMapProjectionBox:"boundingbox",lightMap:"texture",lightVertexColor:"boolean",lightVertexColorChannel:"string",lightMapChannel:"string",lightMapUv:"number",lightMapTiling:"vec2",lightMapOffset:"vec2",depthTest:"boolean",depthWrite:"boolean",depthBias:"number",slopeDepthBias:"number",cull:"number",blendType:"number",shadingModel:"number"},t={},i={aoMap:"white",diffuseMap:"gray",specularMap:"gray",metalnessMap:"black",glossMap:"gray",emissiveMap:"gray",normalMap:"normal",heightMap:"gray",opacityMap:"gray",sphereMap:"gray",lightMap:"white"},r=function(e,t,i,n){for(var r=["cubeMap","prefilteredCubeMap128","prefilteredCubeMap64","prefilteredCubeMap32","prefilteredCubeMap16","prefilteredCubeMap8","prefilteredCubeMap4"],s=0;s<r.length;s++)this[r[s]]!==e.resources[s]&&(this[r[s]]=e.resources[s]);this.update()},s=function(e){this._assets=e.assets,this._device=e.graphicsDevice,this._createPlaceholders()};return Object.assign(s.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t&&t(n.string.format("Error loading material: {0} [{1}]",e,i)):t&&t(null,r)})},open:function(e,t){var i=new n.StandardMaterial;return t.parameters||this._createParameters(t),i.init(t),i._data=t,i},_createPlaceholders:function(){var e={white:[255,255,255,255],gray:[128,128,128,255],black:[0,0,0,255],normal:[128,128,255,255]};for(var i in e)if(e.hasOwnProperty(i)){for(var r=t[i]=new n.Texture(this._device,{width:2,height:2,format:n.PIXELFORMAT_R8_G8_B8_A8}),s=r.lock(),a=0;a<4;a++)for(var o=0;o<4;o++)s[4*a+o]=e[i][o];r.unlock()}},_createParameters:function(t){var i=[];t.shadingModel||(t.shadingModel="blinn"===t.shader?n.SPECULAR_BLINN:n.SPECULAR_PHONG);var r=t.shader;delete t.shader;for(var s in t)t.hasOwnProperty(s)&&i.push({name:s,type:e[s],data:t[s]});t.shader=r,t.parameters=i},patch:function(e,t){void 0===e.data.shader&&(e.data=e.resource._data,delete e.resource._data),this._updateStandardMaterial(e,e.data,t),e.off("change",this._onAssetChange,this),e.on("change",this._onAssetChange,this),e.on("unload",this._onAssetUnload,this)},_onAssetChange:function(e,t,i){"data"===t&&this._updateStandardMaterial(e,i,this._assets)},_onAssetUnload:function(e){delete e.data.parameters,delete e.data.chunks,delete e.data.name},_updateStandardMaterial:function(e,s,a){var o,h=e.resource;e.file&&(o=n.path.getDirectory(e.getFileUrl())),s.name=e.name,s.parameters||this._createParameters(s);var l="path"===s.mapping_format;s.chunks=e.resource.chunks,s.parameters.forEach(function(c,d){var u;if("texture"===c.type){h._assetHandlers||(h._assetHandlers={});var f=h._assetHandlers[c.name];if(!c.data||c.data instanceof n.Texture)f&&!c.data&&(a.off("load:"+f.id,f.bind),a.off("add:"+f.id,f.add),a.off("remove:"+f.id,f.remove),f.url&&(a.off("add:url:"+f.url,f.add),a.off("remove:url:"+f.url,f.remove)),h._assetHandlers[c.name]=null);else if(l?e=a.getByUrl(n.path.join(o,c.data)):(u=c.data,e=a.get(c.data)),f&&(a.off("load:"+f.id,f.bind),a.off("add:"+f.id,f.add),a.off("remove:"+f.id,f.remove),f.url&&(a.off("add:url:"+f.url,f.add),a.off("remove:url:"+f.url,f.remove)),h._assetHandlers[c.name]=null),f=h._assetHandlers[c.name]={id:u,url:l?n.path.join(o,c.data):"",bind:function(e){s.parameters[d].data=e.resource,h[s.parameters[d].name]=e.resource,h.update()},add:function(e){a.load(e)},remove:function(e){h[s.parameters[d].name]===e.resource&&(s.parameters[d].data=null,h[s.parameters[d].name]=null,h.update())}},u?(a.on("load:"+u,f.bind),a.on("remove:"+u,f.remove)):l&&(a.on("load:url:"+n.path.join(o,c.data),f.bind),a.on("remove:url:"+n.path.join(o,c.data),f.remove)),e){if(e.resource)f.bind(e);else if(i[s.parameters[d].name]){var p=t[i[s.parameters[d].name]];p&&(s.parameters[d].data=p,h[s.parameters[d].name]=p)}a.load(e)}else u?a.once("add:"+u,f.add):l&&a.once("add:url:"+f.url,f.add)}else if("cubemap"===c.type&&c.data&&!(c.data instanceof n.Texture)){l?e=a.getByUrl(n.path.join(o,c.data)):(u=c.data,e=a.get(c.data));var _=function(e){c.data=e.resource,e.resources.length>1&&(s.parameters.push({name:"prefilteredCubeMap128",data:e.resources[1]}),s.parameters.push({name:"prefilteredCubeMap64",data:e.resources[2]}),s.parameters.push({name:"prefilteredCubeMap32",data:e.resources[3]}),s.parameters.push({name:"prefilteredCubeMap16",data:e.resources[4]}),s.parameters.push({name:"prefilteredCubeMap8",data:e.resources[5]}),s.parameters.push({name:"prefilteredCubeMap4",data:e.resources[6]})),h.init(s),e.off("load",r,h),e.on("load",r,h)},m=function(e){s.shadingModel===n.SPECULAR_PHONG&&(e.loadFaces=!0),e.ready(_),a.load(e)};e?m(e):u?a.once("add:"+u,m):l&&a.once("add:url:"+n.path.join(o,c.data),function(e){e.ready(function(e){s.parameters[d].data=e.resource,h.init(s),e.off("load",r,h),e.on("load",r,h)}),a.load(e)})}}),h.init(s)}}),{MaterialHandler:s,getMaterialParamType:function(t){return e[t]}}}()),Object.assign(n,function(){var e=function(e){this._device=e,this._parsers=[],this.addParser(new n.JsonModelParser(this._device),function(e,t){return".json"===n.path.getExtension(e)})};return e.DEFAULT_MATERIAL=n.Scene.defaultMaterial,Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){t&&(i?t(n.string.format("Error loading model: {0} [{1}]",e,i)):t(null,r))})},open:function(e,t){for(var i=0;i<this._parsers.length;i++){var s=this._parsers[i];if(s.decider(e,t))return s.parser.parse(t)}return r(n.string.format("No model parser found for: {0}",e)),null},patch:function(e,t){if(e.resource){var i=e.data;e.resource.meshInstances.forEach(function(r,s){if(i.mapping){var a=function(e){e.resource?r.material=e.resource:(e.once("load",a),t.load(e)),e.once("remove",function(e){r.material===e.resource&&(r.material=n.ModelHandler.DEFAULT_MATERIAL)})};if(!i.mapping[s])return void(r.material=n.ModelHandler.DEFAULT_MATERIAL);var o,h=i.mapping[s].material,l=i.mapping[s].path;if(void 0!==h)h?(o=t.get(h),o?a(o):t.once("add:"+h,a)):r.material=n.ModelHandler.DEFAULT_MATERIAL;else if(l){var c=e.getFileUrl(),d=n.path.getDirectory(c),u=n.path.join(d,i.mapping[s].path);o=t.getByUrl(u),o?a(o):t.once("add:url:"+u,a)}}})}},addParser:function(e,t){this._parsers.push({parser:e,decider:t})}}),{ModelHandler:e}}()),Object.assign(n,function(){var e=function(e){this._app=e,this._scripts={},this._cache={}};return e._types=[],e._push=function(t){n.script.legacy&&e._types.length>0?console.assert("Script Ordering Error. Contact support@playcanvas.com"):e._types.push(t)},Object.assign(e.prototype,{load:function(t,i){var r=this;n.script.app=this._app,this._loadScript(t,function(t,s,a){if(t)i(t);else if(n.script.legacy){var o=null;e._types.length&&(o=e._types.pop()),o?this._scripts[s]=o:o=null,i(null,o,a)}else{for(var h={},l=0;l<e._types.length;l++)h[e._types[l].name]=e._types[l];e._types.length=0,i(null,h,a),delete r._loader._cache[s+"script"]}}.bind(this))},open:function(e,t){return t},patch:function(e,t){},_loadScript:function(e,t){var i=document.head,r=document.createElement("script");this._cache[e]=r,r.async=!1,r.addEventListener("error",function(e){t(n.string.format("Script: {0} failed to load",e.target.src))},!1);var s=!1;r.onload=r.onreadystatechange=function(){s||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(s=!0,t(null,e,r))},r.src=e,i.appendChild(r)}}),{ScriptHandler:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading text resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}}),{TextHandler:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,{responseType:n.Http.ResponseType.ARRAY_BUFFER},function(i,r){i?t(n.string.format("Error loading binary resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}}),{BinaryHandler:e}}()),Object.assign(n,function(){function e(e,t,i,n){var r,s=i/4,a=n%4,o=new Uint32Array(e.buffer,0,(n-a)/4),h=new Uint32Array(t.buffer);for(r=0;r<o.length;r++)h[s+r]=o[r];for(r=n-a;r<n;r++)t[i+r]=e[r]}var t={repeat:n.ADDRESS_REPEAT,clamp:n.ADDRESS_CLAMP_TO_EDGE,mirror:n.ADDRESS_MIRRORED_REPEAT},i={nearest:n.FILTER_NEAREST,linear:n.FILTER_LINEAR,nearest_mip_nearest:n.FILTER_NEAREST_MIPMAP_NEAREST,linear_mip_nearest:n.FILTER_LINEAR_MIPMAP_NEAREST,nearest_mip_linear:n.FILTER_NEAREST_MIPMAP_LINEAR,linear_mip_linear:n.FILTER_LINEAR_MIPMAP_LINEAR},r=function(e,t,i){this._device=e,this._assets=t,this._loader=i,this.crossOrigin=void 0,t.prefix&&(this.crossOrigin="anonymous")};return Object.assign(r.prototype,{load:function(e,t){var i,r=this,s=e.indexOf("?")>=0?e.split("?")[0]:e,a=n.path.getExtension(s).toLowerCase();if(".dds"===a||".crn"===a){var o={cache:!0,responseType:"arraybuffer"};n.http.get(e,o,function(e,i){e?t(e):t(null,i)})}else if(".jpg"===a||".jpeg"===a||".gif"===a||".png"===a)i=new Image,void 0!==r.crossOrigin&&n.ABSOLUTE_URL.test(e)&&(i.crossOrigin=r.crossOrigin),i.onload=function(){t(null,i)},i.onerror=function(i){t(n.string.format("Error loading Texture from: '{0}'",e))},i.src=e;else{var h=s.indexOf("blob:");h>=0?(s=s.substr(h),e=s,i=new Image,i.onload=function(){t(null,i)},i.onerror=function(i){t(n.string.format("Error loading Texture from: '{0}'",e))},i.src=e):setTimeout(function(){t(n.string.format("Error loading Texture: format not supported: '{0}'",a))},0)}},open:function(t,i){if(t){var r,s=n.path.getExtension(t).toLowerCase(),a=null;if(i instanceof Image||i instanceof HTMLImageElement){var o=i;a=".jpg"===s||".jpeg"===s?n.PIXELFORMAT_R8_G8_B8:n.PIXELFORMAT_R8_G8_B8_A8,r=new n.Texture(this._device,{width:o.width,height:o.height,format:a}),r.setSource(o)}else if(i instanceof ArrayBuffer){if(".crn"===s){var h=i.byteLength,l=new Uint8Array(i),c=Module._malloc(h);e(l,Module.HEAPU8,c,h);var d=Module._crn_decompress_get_data(c,h),u=Module._crn_decompress_get_size(c,h);i=Module.HEAPU8.buffer.slice(d,d+u)}var f=new Uint32Array(i,0,32),p=f[4],_=f[3],m=Math.max(f[7],1),A=4===f[20],v=f[21],y=f[22],g=65024===f[28],b=827611204,E=894720068,T=116,S=826496069,w=825438800,C=825504336,M=825439312,P=825504848,I=!1,R=!1,x=!1,O=!1,k=!1;if(A?v===b?(a=n.PIXELFORMAT_DXT1,I=!0):v===E?(a=n.PIXELFORMAT_DXT5,I=!0):v===T?(a=n.PIXELFORMAT_RGBA32F,R=!0):v===S?(a=n.PIXELFORMAT_ETC1,I=!0,x=!0):v===w||v===C?(a=v===w?n.PIXELFORMAT_PVRTC_2BPP_RGB_1:n.PIXELFORMAT_PVRTC_2BPP_RGBA_1,I=!0,O=!0):v!==M&&v!==P||(a=v===M?n.PIXELFORMAT_PVRTC_4BPP_RGB_1:n.PIXELFORMAT_PVRTC_4BPP_RGBA_1,I=!0,k=!0):32===y&&(a=n.PIXELFORMAT_R8_G8_B8_A8),!a)return r=new n.Texture(this._device,{width:4,height:4,format:n.PIXELFORMAT_R8_G8_B8});var D={width:p,height:_,format:a,cubemap:g};r=new n.Texture(this._device,D),g&&(r.addressU=n.ADDRESS_CLAMP_TO_EDGE,r.addressV=n.ADDRESS_CLAMP_TO_EDGE);
for(var L,N,F,B,V=128,U=g?6:1,G=4,W=4,z=v===b?8:16,H=0;H<U;H++)for(var j=p,Y=_,X=0;X<m;X++){I?x?L=Math.floor((j+3)/4)*Math.floor((Y+3)/4)*8:O?L=Math.max(j,16)*Math.max(Y,8)/4:k?L=Math.max(j,8)*Math.max(Y,8)/2:(N=Math.floor((j+G-1)/G),F=Math.floor((Y+W-1)/W),B=N*F,L=B*z):L=j*Y*4;var Z=R?new Float32Array(i,V,L):new Uint8Array(i,V,L);g?(r._levels[X]||(r._levels[X]=[]),r._levels[X][H]=Z):r._levels[X]=Z,V+=R?4*L:L,j=Math.max(.5*j,1),Y=Math.max(.5*Y,1)}r.upload()}return r}},patch:function(e,n){var r=e.resource;if(r){r.name!==e.name&&(r.name=e.name),e.data.hasOwnProperty("minfilter")&&r.minFilter!==i[e.data.minfilter]&&(r.minFilter=i[e.data.minfilter]),e.data.hasOwnProperty("magfilter")&&r.magFilter!==i[e.data.magfilter]&&(r.magFilter=i[e.data.magfilter]),e.data.hasOwnProperty("addressu")&&r.addressU!==t[e.data.addressu]&&(r.addressU=t[e.data.addressu]),e.data.hasOwnProperty("addressv")&&r.addressV!==t[e.data.addressv]&&(r.addressV=t[e.data.addressv]),e.data.hasOwnProperty("mipmaps")&&r.mipmaps!==e.data.mipmaps&&(r.mipmaps=e.data.mipmaps),e.data.hasOwnProperty("anisotropy")&&r.anisotropy!==e.data.anisotropy&&(r.anisotropy=e.data.anisotropy);var s=!!e.data.rgbm;e.data.hasOwnProperty("rgbm")&&r.rgbm!==s&&(r.rgbm=s)}}}),{TextureHandler:r}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading html resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}}),{HtmlHandler:e}}()),Object.assign(n,function(){var e=function(){};Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading css resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}});var t=function(e){var t=document.createElement("style");return t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),t};return{CssHandler:e,createStyle:t}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,r){i?t(n.string.format("Error loading shader resource: {0} [{1}]",e,i)):t(null,r)})},open:function(e,t){return t},patch:function(e,t){}}),{ShaderHandler:e}}()),Object.assign(n,function(){var e=function(e){this._app=e};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,n){i?t("Error requesting scene: "+e):t(null,n)})},open:function(e,t){this._app.systems.script.preloading=!0;var i=new n.SceneParser(this._app),r=i.parse(t),s=this._app.scene;return s.root=r,this._app.applySceneSettings(t.settings),this._app.systems.script.preloading=!1,s},patch:function(e,t){}}),{SceneHandler:e}}()),Object.assign(n,function(){var e=function(e){this._app=e};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,n){i?t("Error requesting scene: "+e):t(null,n)})},open:function(e,t){this._app.systems.script.preloading=!0;var i=new n.SceneParser(this._app),r=i.parse(t);return this._app.systems.script.preloading=!1,r}}),{HierarchyHandler:e}}()),Object.assign(n,function(){var e=function(e){this._app=e};return Object.assign(e.prototype,{load:function(e,t){n.http.get(e,function(i,n){i?t("Error requesting scene: "+e):t(null,n)})},open:function(e,t){return t.settings}}),{SceneSettingsHandler:e}}()),Object.assign(n,function(){var e=function(){};return Object.assign(e.prototype,{load:function(e,t){t(null,null)},open:function(e,t){return t}}),{FolderHandler:e}}()),Object.assign(n,function(){var e=function(e){this._loader=e};return Object.assign(e.prototype,{load:function(e,t,i){var r=this;".json"===n.path.getExtension(e)?n.http.get(e,function(i,s){i?t(n.string.format("Error loading font resource: {0} [{1}]",e,i)):r._loadTextures(e.replace(".json",".png"),s,function(e,i){return e?t(e):void t(null,{data:s,textures:i})})}):this._loadTextures(e,i&&i.data,t)},_loadTextures:function(e,t,i){var n=1,r=0,s=null;t&&t.version>=2&&(n=t.info.maps.length);for(var a=new Array(n),o=this._loader,h=function(t){var h=function(e,o){if(!s){if(e)return s=e,i(e);o.upload(),a[t]=o,r++,r===n&&i(null,a)}};0===t?o.load(e,"texture",h):o.load(e.replace(".png",t+".png"),"texture",h)},l=0;l<n;l++)h(l)},open:function(e,t,i){var r;return r=t.textures?new n.Font(t.textures,t.data):new n.Font(t,null)},patch:function(e,t){var i=e.resource;!i.data&&e.data?i.data=e.data:!e.data&&i.data&&(e.data=i.data)}}),{FontHandler:e}}()),Object.assign(n,function(){var e={repeat:n.ADDRESS_REPEAT,clamp:n.ADDRESS_CLAMP_TO_EDGE,mirror:n.ADDRESS_MIRRORED_REPEAT},t={nearest:n.FILTER_NEAREST,linear:n.FILTER_LINEAR,nearest_mip_nearest:n.FILTER_NEAREST_MIPMAP_NEAREST,linear_mip_nearest:n.FILTER_LINEAR_MIPMAP_NEAREST,nearest_mip_linear:n.FILTER_NEAREST_MIPMAP_LINEAR,linear_mip_linear:n.FILTER_LINEAR_MIPMAP_LINEAR},i=/^data\.frames\.(\d+)$/,r=function(e){this._loader=e};return Object.assign(r.prototype,{load:function(e,t){var i=this,r=this._loader.getHandler("texture");return".json"!==n.path.getExtension(e)?r.load(e,t):void n.http.get(e,function(n,r){if(n)t(n);else{var s=e.replace(".json",".png");i._loader.load(s,"texture",function(e,i){e?t(e):t(null,{data:r,texture:i})})}})},open:function(e,t){var i=new n.TextureAtlas;if(t.texture&&t.data)i.texture=t.texture,i.__data=t.data;else{var r=this._loader.getHandler("texture"),s=r.open(e,t);if(!s)return null;i.texture=s}return i},patch:function(i,r){i.resource.__data&&(void 0!==i.resource.__data.minfilter&&(i.data.minfilter=i.resource.__data.minfilter),void 0!==i.resource.__data.magfilter&&(i.data.magfilter=i.resource.__data.magfilter),void 0!==i.resource.__data.addressu&&(i.data.addressu=i.resource.__data.addressu),void 0!==i.resource.__data.addressv&&(i.data.addressv=i.resource.__data.addressv),void 0!==i.resource.__data.mipmaps&&(i.data.mipmaps=i.resource.__data.mipmaps),void 0!==i.resource.__data.anisotropy&&(i.data.anisotropy=i.resource.__data.anisotropy),void 0!==i.resource.__data.rgbm&&(i.data.rgbm=!!i.resource.__data.rgbm),i.data.frames=i.resource.__data.frames,delete i.resource.__data);var s=i.resource.texture;if(s){s.name=i.name,i.data.hasOwnProperty("minfilter")&&s.minFilter!==t[i.data.minfilter]&&(s.minFilter=t[i.data.minfilter]),i.data.hasOwnProperty("magfilter")&&s.magFilter!==t[i.data.magfilter]&&(s.magFilter=t[i.data.magfilter]),i.data.hasOwnProperty("addressu")&&s.addressU!==e[i.data.addressu]&&(s.addressU=e[i.data.addressu]),i.data.hasOwnProperty("addressv")&&s.addressV!==e[i.data.addressv]&&(s.addressV=e[i.data.addressv]),i.data.hasOwnProperty("mipmaps")&&s.mipmaps!==i.data.mipmaps&&(s.mipmaps=i.data.mipmaps),i.data.hasOwnProperty("anisotropy")&&s.anisotropy!==i.data.anisotropy&&(s.anisotropy=i.data.anisotropy);var a=!!i.data.rgbm;i.data.hasOwnProperty("rgbm")&&s.rgbm!==a&&(s.rgbm=a)}i.resource.texture=s;var o={};for(var h in i.data.frames){var l=i.data.frames[h];o[h]={rect:new n.Vec4(l.rect),pivot:new n.Vec2(l.pivot),border:new n.Vec4(l.border)}}i.resource.frames=o,i.off("change",this._onAssetChange,this),i.on("change",this._onAssetChange,this)},_onAssetChange:function(e,t,r){var s;if("data"===t||"data.frames"===t){var a={};for(var o in r.frames)s=r.frames[o],a[o]={rect:new n.Vec4(s.rect),pivot:new n.Vec2(s.pivot),border:new n.Vec4(s.border)};e.resource.frames=a}else{var h=t.match(i);if(h){var l=h[1];r?(e.resource.frames[l]?(s=e.resource.frames[l],s.rect.set(r.rect[0],r.rect[1],r.rect[2],r.rect[3]),s.pivot.set(r.pivot[0],r.pivot[1]),s.border.set(r.border[0],r.border[1],r.border[2],r.border[3])):e.resource.frames[l]={rect:new n.Vec4(r.rect),pivot:new n.Vec2(r.pivot),border:new n.Vec4(r.border)},e.resource.fire("set:frame",l,e.resource.frames[l])):e.resource.frames[l]&&(delete e.resource.frames[l],e.resource.fire("remove:frame",l))}}}}),{TextureAtlasHandler:r}}()),Object.assign(n,function(){var e=function(e,t){this._assets=e,this._device=t},t=function(e){var t=this;t.resource&&(t.resource.atlas=e.resource)},i=function(e){var t=this;t.registry.load(e)};return Object.assign(e.prototype,{load:function(e,t){".json"===n.path.getExtension(e)&&n.http.get(e,function(e,i){e?t(e):t(null,i)})},open:function(e,t){var i=new n.Sprite(this._device);return t&&(i.__data=t),i},patch:function(e,t){var i=e.resource;if(i.__data){e.data.pixelsPerUnit=i.__data.pixelsPerUnit,e.data.renderMode=i.__data.renderMode,e.data.frameKeys=i.__data.frameKeys;var n=t.getByUrl(i.__data.textureAtlasAsset);n&&(e.data.textureAtlasAsset=n.id),delete i.__data}i.startUpdate(),i.renderMode=e.data.renderMode,i.pixelsPerUnit=e.data.pixelsPerUnit,i.frameKeys=e.data.frameKeys,this._updateAtlas(e),i.endUpdate(),e.off("change",this._onAssetChange,this),e.on("change",this._onAssetChange,this)},_updateAtlas:function(e){var n=e.resource;if(!e.data.textureAtlasAsset)return void(n.atlas=null);this._assets.off("load:"+e.data.textureAtlasAsset,t,e),this._assets.on("load:"+e.data.textureAtlasAsset,t,e);var r=this._assets.get(e.data.textureAtlasAsset);r&&r.resource?n.atlas=r.resource:r?this._assets.load(r):(this._assets.off("add:"+e.data.textureAtlasAsset,i,e),this._assets.on("add:"+e.data.textureAtlasAsset,i,e))},_onAssetChange:function(e,n,r,s){"data"===n&&r&&r.textureAtlasAsset&&s&&r.textureAtlasAsset!==s.textureAtlasAsset&&(this._assets.off("load:"+s.textureAtlasAsset,t,e),this._assets.off("add:"+s.textureAtlasAsset,i,e))}}),{SpriteHandler:e}}()),Object.assign(n,function(){var e={points:n.PRIMITIVE_POINTS,lines:n.PRIMITIVE_LINES,lineloop:n.PRIMITIVE_LINELOOP,linestrip:n.PRIMITIVE_LINESTRIP,triangles:n.PRIMITIVE_TRIANGLES,trianglestrip:n.PRIMITIVE_TRISTRIP,trianglefan:n.PRIMITIVE_TRIFAN},t={int8:n.TYPE_INT8,uint8:n.TYPE_UINT8,int16:n.TYPE_INT16,uint16:n.TYPE_UINT16,int32:n.TYPE_INT32,uint32:n.TYPE_UINT32,float32:n.TYPE_FLOAT32},i=function(e){this._device=e};return Object.assign(i.prototype,{parse:function(e){var t=e.model;if(!t)return null;if(t.version<=1)return null;var i=this._parseNodes(e),r=this._parseSkins(e,i),s=this._parseMorphs(e,i),a=this._parseVertexBuffers(e),o=this._parseIndexBuffers(e,a),h=this._parseMeshes(e,r.skins,s.morphs,a,o.buffer,o.data);this._initMorphs(e,s.morphs,a,h);var l=this._parseMeshInstances(e,i,h,r.skins,r.instances,s.morphs,s.instances),c=new n.Model;return c.graph=i[0],c.meshInstances=l,c.skinInstances=r.instances,c.morphInstances=s.instances,c.getGraph().syncHierarchy(),c},_parseNodes:function(e){var t,i=e.model,r=[];for(t=0;t<i.nodes.length;t++){var s=i.nodes[t],a=new n.GraphNode;a.setName(s.name),a.setLocalPosition(s.position[0],s.position[1],s.position[2]),a.setLocalEulerAngles(s.rotation[0],s.rotation[1],s.rotation[2]),a.setLocalScale(s.scale[0],s.scale[1],s.scale[2]),a.scaleCompensation=!!s.scaleCompensation,r.push(a)}for(t=1;t<i.parents.length;t++)r[i.parents[t]].addChild(r[t]);return r},_parseSkins:function(e,t){var i,r,s=e.model,a=[],o=[];if(!this._device.supportsBoneTextures&&s.skins.length>0){var h=this._device.getBoneLimit();n.partitionSkin(s,null,h)}for(i=0;i<s.skins.length;i++){var l=s.skins[i],c=[];for(r=0;r<l.inverseBindMatrices.length;r++){var d=l.inverseBindMatrices[r];c[r]=new n.Mat4(d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15])}var u=new n.Skin(this._device,c,l.boneNames);a.push(u);var f=new n.SkinInstance(u),p=[];for(r=0;r<u.boneNames.length;r++){var _=u.boneNames[r],m=t[0].findByName(_);p.push(m)}f.bones=p,o.push(f)}return{skins:a,instances:o}},_parseMorphs:function(e,t){var i,r,s,a,o,h=e.model,l=[],c=[];if(h.morphs)for(i=0;i<h.morphs.length;i++){for(s=h.morphs[i].targets,o=[],r=0;r<s.length;r++){var d=s[r].aabb,u=d.min,f=d.max,p=new n.BoundingBox(new n.Vec3(.5*(f[0]+u[0]),.5*(f[1]+u[1]),.5*(f[2]+u[2])),new n.Vec3(.5*(f[0]-u[0]),.5*(f[1]-u[1]),.5*(f[2]-u[2])));a=new n.MorphTarget({indices:s[r].indices,deltaPositions:s[r].deltaPositions,deltaNormals:s[r].deltaNormals,name:s[r].name,aabb:p}),o.push(a)}var _=new n.Morph(o);l.push(_);var m=new n.MorphInstance(_);c.push(m)}return{morphs:l,instances:c}},_calculateTangentsMorphTarget:function(e,t,i,n,r,s,a,o){var h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T,S,w,C,M,P,I,R,x,O,k,D,L,N,F,B,V,U,G,W,z,H,j,Y,X,Z,K,Q,J,q,$,ee,te,ie,ne,re;for(B=n.length/3,te=0,$=0;$<B;$++)V=n[3*$],U=n[3*$+1],G=n[3*$+2],p=e[3*V],_=e[3*V+1],m=e[3*V+2],A=e[3*U],v=e[3*U+1],y=e[3*U+2],g=e[3*G],b=e[3*G+1],E=e[3*G+2],T=i[2*V],S=i[2*V+1],w=i[2*U],C=i[2*U+1],M=i[2*G],P=i[2*G+1],W=A-p,z=g-p,H=v-_,j=b-_,Y=y-m,X=E-m,Z=w-T,K=M-T,Q=C-S,J=P-S,te=Z*J-K*Q,0==te?(h=0,l=1,c=0,d=1,u=0,f=0):(q=1/te,h=(J*W-Q*z)*q,l=(J*H-Q*j)*q,c=(J*Y-Q*X)*q,d=(Z*z-K*W)*q,u=(Z*j-K*H)*q,f=(Z*X-K*Y)*q),r[3*V+0]+=h,r[3*V+1]+=l,r[3*V+2]+=c,r[3*U+0]+=h,r[3*U+1]+=l,r[3*U+2]+=c,r[3*G+0]+=h,r[3*G+1]+=l,r[3*G+2]+=c,s[3*V+0]+=d,s[3*V+1]+=u,s[3*V+2]+=f,s[3*U+0]+=d,s[3*U+1]+=u,s[3*U+2]+=f,s[3*G+0]+=d,s[3*G+1]+=u,s[3*G+2]+=f;for(ne=a.length,ee=0;ee<ne;ee++)$=a[ee],L=t[3*$],N=t[3*$+1],F=t[3*$+2],I=r[3*$],R=r[3*$+1],x=r[3*$+2],O=s[3*$],k=s[3*$+1],D=s[3*$+2],ie=L*I+N*R+F*x,p=L*ie,_=N*ie,m=F*ie,A=N*x-R*F,v=F*I-x*L,y=L*R-I*N,I-=p,R-=_,x-=m,re=1/Math.sqrt(I*I+R*R+x*x),I*=re,R*=re,x*=re,o[4*$]=I,o[4*$+1]=R,o[4*$+2]=x,o[4*$+3]=A*O+v*k+y*D<0?-1:1;return o},_initMorphs:function(e,t,i,n){var r,s,a,o,h,l,c,d,u,f,p,_,m,A,v,y,g,b,E,T=e.model,S=[],w=[];for(r=0;r<n.length;r++)if(E=T.meshes[r].vertices,!w[E]&&(b=T.vertices[E],b.tangent)){var C=new Float32Array(b.tangent.data);if(w[E]=!0,b.position&&b.normal&&b.texCoord0){var M=[];for(s=0;s<T.meshes.length;s++)T.meshes[s].vertices===E&&(M=M.concat(T.meshes[s].indices));p=b.position.data,_=b.normal.data,m=b.texCoord0.data,A=p.length/3,v=M.length;var P=new Float32Array(4*A),I=new Float32Array(3*A),R=new Float32Array(3*A);for(y=new Float32Array(3*A),y.set(p),g=new Float32Array(3*A),g.set(_),s=0;s<t.length;s++)if(T.meshes[r].morph===s)for(o=0;o<t[s]._targets.length;o++){a=t[s]._targets[o];var x=a.indices,O=x.length;if(0!==O){if(a.deltaTangents=new Float32Array(4*O),!f||f.length<A)f=new Uint8Array(A);else for(h=0;h<A;h++)f[h]=0;for(h=0;h<O;h++)l=x[h],f[l]=1;var k=0;for(h=0;h<v;h+=3)c=M[h],d=M[h+1],u=M[h+2],(f[c]||f[d]||f[u])&&(S[k]=c,S[k+1]=d,S[k+2]=u,k+=3);S.length=k;var D=a.deltaPositions,L=a.deltaNormals;for(h=0;h<O;h++)l=x[h],y[3*l]+=D[3*h],y[3*l+1]+=D[3*h+1],y[3*l+2]+=D[3*h+2],g[3*l]+=L[3*h],g[3*l+1]+=L[3*h+1],g[3*l+2]+=L[3*h+2];this._calculateTangentsMorphTarget(y,g,m,S,I,R,x,P);var N=a.deltaTangents;for(h=0;h<O;h++)l=x[h],N[4*h]=P[4*h]-C[4*l],N[4*h+1]=P[4*h+1]-C[4*l+1],N[4*h+2]=P[4*h+2]-C[4*l+2],N[4*h+3]=P[4*h+3]-C[4*l+3];if(o!==t[s]._targets.length-1){for(h=0;h<v;h+=3)c=M[h],d=M[h+1],u=M[h+2],I[3*c+0]=0,I[3*c+1]=0,I[3*c+2]=0,I[3*d+0]=0,I[3*d+1]=0,I[3*d+2]=0,I[3*u+0]=0,I[3*u+1]=0,I[3*u+2]=0,R[3*c+0]=0,R[3*c+1]=0,R[3*c+2]=0,R[3*d+0]=0,R[3*d+1]=0,R[3*d+2]=0,R[3*u+0]=0,R[3*u+1]=0,R[3*u+2]=0;for(h=0;h<O;h++)l=a.indices[h],y[3*l]=p[3*l],y[3*l+1]=p[3*l+1],y[3*l+2]=p[3*l+2],g[3*l]=_[3*l],g[3*l+1]=_[3*l+1],g[3*l+2]=_[3*l+2]}}}}}},_parseVertexBuffers:function(e){var i,r,s,a,o=e.model,h=[],l={position:n.SEMANTIC_POSITION,normal:n.SEMANTIC_NORMAL,tangent:n.SEMANTIC_TANGENT,blendWeight:n.SEMANTIC_BLENDWEIGHT,blendIndices:n.SEMANTIC_BLENDINDICES,color:n.SEMANTIC_COLOR,texCoord0:n.SEMANTIC_TEXCOORD0,texCoord1:n.SEMANTIC_TEXCOORD1,texCoord2:n.SEMANTIC_TEXCOORD2,texCoord3:n.SEMANTIC_TEXCOORD3,texCoord4:n.SEMANTIC_TEXCOORD4,texCoord5:n.SEMANTIC_TEXCOORD5,texCoord6:n.SEMANTIC_TEXCOORD6,texCoord7:n.SEMANTIC_TEXCOORD7};for(s=0;s<o.vertices.length;s++){var c=o.vertices[s];if(!c.tangent&&c.position&&c.normal&&c.texCoord0){var d=[];for(a=0;a<o.meshes.length;a++)o.meshes[a].vertices===s&&(d=d.concat(o.meshes[a].indices));var u=n.calculateTangents(c.position.data,c.normal.data,c.texCoord0.data,d);c.tangent={type:"float32",components:4,data:u}}var f=[];for(r in c){i=c[r];var p=i.type;this._device.supportsUnsignedByte||("uint8"===p&&(p="float32"),"int8"===p&&(p="float32")),f.push({semantic:l[r],components:i.components,type:t[p],normalize:l[r]===n.SEMANTIC_COLOR})}var _=new n.VertexFormat(this._device,f),m=c.position.data.length/c.position.components,A=new n.VertexBuffer(this._device,_,m),v=new n.VertexIterator(A);for(a=0;a<m;a++){for(r in c)switch(i=c[r],i.components){case 1:v.element[l[r]].set(i.data[a]);break;case 2:v.element[l[r]].set(i.data[2*a],i.data[2*a+1]);break;case 3:v.element[l[r]].set(i.data[3*a],i.data[3*a+1],i.data[3*a+2]);break;case 4:v.element[l[r]].set(i.data[4*a],i.data[4*a+1],i.data[4*a+2],i.data[4*a+3])}v.next()}v.end(),h.push(A)}return h},_parseIndexBuffers:function(e,t){var i,r=e.model,s=null,a=null,o=0;for(i=0;i<r.meshes.length;i++){var h=r.meshes[i];void 0!==h.indices&&(o+=h.indices.length)}var l=0;for(i=0;i<t.length;i++)l=Math.max(l,t[i].numVertices);return o>0&&(l>65535&&this._device.extUintElement?(s=new n.IndexBuffer(this._device,n.INDEXFORMAT_UINT32,o),a=new Uint32Array(s.lock())):(s=new n.IndexBuffer(this._device,n.INDEXFORMAT_UINT16,o),a=new Uint16Array(s.lock()))),{buffer:s,data:a}},_parseMeshes:function(t,i,r,s,a,o){var h,l=t.model,c=[],d=0;for(h=0;h<l.meshes.length;h++){var u=l.meshes[h],f=u.aabb,p=f.min,_=f.max,m=new n.BoundingBox(new n.Vec3(.5*(_[0]+p[0]),.5*(_[1]+p[1]),.5*(_[2]+p[2])),new n.Vec3(.5*(_[0]-p[0]),.5*(_[1]-p[1]),.5*(_[2]-p[2]))),A=void 0!==u.indices,v=new n.Mesh;v.vertexBuffer=s[u.vertices],v.indexBuffer[0]=A?a:null,v.primitive[0].type=e[u.type],v.primitive[0].base=A?u.base+d:u.base,v.primitive[0].count=u.count,v.primitive[0].indexed=A,v.skin=void 0!==u.skin?i[u.skin]:null,v.morph=void 0!==u.morph?r[u.morph]:null,v.aabb=m,A&&(o.set(u.indices,d),d+=u.indices.length),c.push(v)}return null!==a&&a.unlock(),c},_parseMeshInstances:function(e,t,i,r,s,a,o){var h,l=e.model,c=[];for(h=0;h<l.meshInstances.length;h++){var d=l.meshInstances[h],u=t[d.node],f=i[d.mesh],p=new n.MeshInstance(u,f,n.ModelHandler.DEFAULT_MATERIAL);if(f.skin){var _=r.indexOf(f.skin);p.skinInstance=s[_]}if(f.morph){var m=a.indexOf(f.morph);p.morphInstance=o[m]}c.push(p)}return c}}),{JsonModelParser:i}}()),Object.assign(n,function(){var e=function(e){this._app=e};return Object.assign(e.prototype,{parse:function(e){var t,i,n={},r=null;for(t in e.entities)n[t]=this._createEntity(e.entities[t]),null===e.entities[t].parent&&(r=n[t]);for(t in e.entities){var s=e.entities[t].children.length;for(i=0;i<s;i++){var a=e.entities[t].children[i];n[a]&&n[t].addChild(n[a])}}return this._openComponentData(r,e.entities),r},_createEntity:function(e){var t=new n.Entity,i=e.position,r=e.rotation,s=e.scale;if(t.name=e.name,t._guid=e.resource_id,t.setLocalPosition(i[0],i[1],i[2]),t.setLocalEulerAngles(r[0],r[1],r[2]),t.setLocalScale(s[0],s[1],s[2]),t._enabled=void 0===e.enabled||e.enabled,t._enabledInHierarchy=t._enabled,t.template=e.template,e.tags)for(var a=0;a<e.tags.length;a++)t.tags.add(e.tags[a]);return e.labels&&e.labels.forEach(function(e){t.addLabel(e)}),t},_openComponentData:function(e,t){var i,n=this._app.systems.list(),r=n.length,s=t[e._guid];for(i=0;i<r;i++){var a=s.components[n[i].id];a&&this._app.systems[n[i].id].addComponent(e,a)}var o=s.children.length,h=e._children;for(i=0;i<o;i++)h[i]=this._openComponentData(h[i],t);return e}}),{SceneParser:e}}()),Object.assign(n,function(){var e=0,t=new RegExp("^\\s*(?:[a-z]+[a-z0-9\\-\\+\\.]*:)?//","i"),i=function(t,i,r,s){this._id=++e,this.name=t||"",this.type=i,this.tags=new n.Tags(this),this._preload=!1,this.variants=new n.AssetVariants(this),this._file=null,this._data=s||{},this._resources=[],this.loaded=!1,this.loading=!1,this.registry=null,n.events.attach(this),r&&(this.file=r)};return Object.assign(i.prototype,{getFileUrl:function(){var e=this.getPreferredFile();if(!e||!e.url)return null;var i=e.url;if(this.registry&&this.registry.prefix&&!t.test(i)&&(i=this.registry.prefix+i),"script"!==this.type&&e.hash){var n=i.indexOf("?")!==-1?"&":"?";i+=n+"t="+e.hash}return i},getPreferredFile:function(){if(!this.file)return null;if("texture"===this.type||"textureatlas"===this.type){var e=this.registry._loader.getHandler("texture")._device;if(this.variants.pvr&&e.extCompressedTexturePVRTC)return this.variants.pvr;if(this.variants.dxt&&e.extCompressedTextureS3TC)return this.variants.dxt;if(this.variants.etc1&&e.extCompressedTextureETC1)return this.variants.etc1}return this.file},ready:function(e,t){t=t||this,this.resource?e.call(t,this):this.once("load",function(i){e.call(t,i)})},reload:function(){this.loaded&&("cubemap"===this.type?this.registry._loader.patch(this,this.registry):(this.loaded=!1,this.registry.load(this)))},unload:function(){(this.loaded||this.resource)&&(this.fire("unload",this),this.registry.fire("unload:"+this.id,this),this.resource&&this.resource.destroy&&this.resource.destroy(),this.resource=null,this.loaded=!1,this.file&&this.registry._loader.clearCache(this.getFileUrl(),this.type))}}),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,t>e&&(e=t)}}),Object.defineProperty(i.prototype,"file",{get:function(){return this._file},set:function(e){var t,i=!!e,n=!!this._file;if(i!==n||e&&this._file&&e.hash!==this._file)if(e){if(this._file||(this._file={}),this._file.url=e.url,this._file.filename=e.filename,this._file.hash=e.hash,this._file.size=e.size,this._file.variants=this.variants,e.hasOwnProperty("variants")&&(this.variants.clear(),e.variants))for(t in e.variants)e.variants[t]&&(this.variants[t]=e.variants[t]);this.fire("change",this,"file",this._file,this._file),this.reload()}else this._file=null,this.variants.clear();else if(e&&this._file&&e.hasOwnProperty("variants")&&(this.variants.clear(),e.variants))for(t in e.variants)e.variants[t]&&(this.variants[t]=e.variants[t])}}),Object.defineProperty(i.prototype,"data",{get:function(){return this._data},set:function(e){var t=this._data;this._data=e,e!==t&&(this.fire("change",this,"data",e,t),this.loaded&&this.registry._loader.patch(this,this.registry))}}),Object.defineProperty(i.prototype,"resource",{get:function(){return this._resources[0]},set:function(e){var t=this._resources[0];this._resources[0]=e,this.fire("change",this,"resource",e,t)}}),Object.defineProperty(i.prototype,"resources",{get:function(){return this._resources},set:function(e){var t=this._resources;this._resources=e,this.fire("change",this,"resources",e,t)}}),Object.defineProperty(i.prototype,"preload",{get:function(){return this._preload},set:function(e){e=!!e,this._preload!==e&&(this._preload=e,this._preload&&!this.loaded&&!this.loading&&this.registry&&this.registry.load(this))}}),{Asset:i,ASSET_ANIMATION:"animation",ASSET_AUDIO:"audio",ASSET_IMAGE:"image",ASSET_JSON:"json",ASSET_MODEL:"model",ASSET_MATERIAL:"material",ASSET_TEXT:"text",ASSET_TEXTURE:"texture",ASSET_CUBEMAP:"cubemap",ASSET_SHADER:"shader",ASSET_CSS:"css",ASSET_HTML:"html",ASSET_SCRIPT:"script",ABSOLUTE_URL:t}}()),Object.assign(n,function(){var e=[],t=function(e){this.asset=e},i=function(i){var n="_"+i;e.push(n),Object.defineProperty(t.prototype,i,{get:function(){return this[n]||null},set:function(e){var t=!!this[n],i=!!e;(t!==i||this[n]&&e&&this[n].hash!==e.hash)&&(e?this[n]={url:e.url,filename:e.filename,size:e.size,hash:e.hash,opt:e.opt||0}:this[n]=null,this.asset.file&&(this.asset.fire("change",this.asset,"file",this.asset._file,this.asset._file),this.asset.reload()))}})};return i("dxt"),i("pvr"),i("etc1"),t.prototype.clear=function(){for(var t=0;t<e.length;t++)this[e[t]]=null},{AssetVariants:t}}()),Object.assign(n,function(){var e=function(e){this._loader=e,this._assets=[],this._cache={},this._names={},this._tags=new n.TagsCache("_id"),this._urls={},this.prefix=null,Object.assign(this,n.events)};return Object.assign(e.prototype,{list:function(e){return e=e||{},this._assets.filter(function(t){var i=!0;return void 0!==e.preload&&(i=t.preload===e.preload),i})},add:function(e){var t,i=this._assets.push(e)-1;this._cache[e.id]=i,this._names[e.name]||(this._names[e.name]=[]),this._names[e.name].push(i),e.file&&(t=e.file.url,this._urls[t]=i),e.registry=this,this._tags.addItem(e),e.tags.on("add",this._onTagAdd,this),e.tags.on("remove",this._onTagRemove,this),this.fire("add",e),this.fire("add:"+e.id,e),t&&this.fire("add:url:"+t,e),e.preload&&this.load(e)},remove:function(e){delete this._cache[e.id],delete this._names[e.name];var t=e.file?e.file.url:null;t&&delete this._urls[t],this._tags.removeItem(e),e.tags.off("add",this._onTagAdd,this),e.tags.off("remove",this._onTagRemove,this),e.fire("remove",e),this.fire("remove",e),this.fire("remove:"+e.id,e),t&&this.fire("remove:url:"+t,e)},get:function(e){var t=this._cache[e];return this._assets[t]},getByUrl:function(e){var t=this._urls[e];return this._assets[t]},load:function(e){if(!e.loading){var t=this;if(e.loaded)return void("cubemap"===e.type&&t._loader.patch(e,this));var i=!!e.file,r=e.getPreferredFile(),s=function(){var i=e.getFileUrl();e.loading=!0,t._loader.load(i,e.type,function(i,s,a){if(e.loaded=!0,e.loading=!1,i)return t.fire("error",i,e),t.fire("error:"+e.id,i,e),void e.fire("error",i,e);if(s instanceof Array?e.resources=s:e.resource=s,!n.script.legacy&&"script"===e.type){var o=t._loader.getHandler("script");o._cache[e.id]&&o._cache[e.id].parentNode===document.head&&document.head.removeChild(o._cache[e.id]),o._cache[e.id]=a}t._loader.patch(e,t),t.fire("load",e),t.fire("load:"+e.id,e),r&&r.url&&t.fire("load:url:"+r.url,e),e.fire("load",e)},e)},a=function(){var i=t._loader.open(e.type,e.data);i instanceof Array?e.resources=i:e.resource=i,e.loaded=!0,t._loader.patch(e,t),t.fire("load",e),t.fire("load:"+e.id,e),r&&r.url&&t.fire("load:url:"+r.url,e),e.fire("load",e)};if(r&&"cubemap"===e.type){i=!1;var o=e.getFileUrl();this._loader.load(o,"texture",function(i,n){i?(t.fire("error",i,e),t.fire("error:"+e.id,i,e),e.fire("error",i,e)):(t._loader.patch({resource:n,type:"texture",data:e.data},t),e._dds=n,a())})}r?i&&(this.fire("load:start",e),this.fire("load:"+e.id+":start",e),s()):a()}},loadFromUrl:function(e,t,i){var r=this,s=n.path.getBasename(e),a={url:e},o={},h=r.getByUrl(e);return h||(h=new n.Asset(s,t,a,o),r.add(h)),"model"===t?void r._loadModel(h,i):(h.once("load",function(e){i(null,e)}),h.once("error",function(e){i(e)}),void r.load(h))},_loadModel:function(e,t){var i=this,r=e.getFileUrl(),s=n.path.getDirectory(r),a=n.path.getBasename(r),o=n.path.getExtension(r),h=function(e){e.once("load",function(e){t(null,e)}),e.once("error",function(e){t(e)}),i.load(e)};if(".json"===o){var l=n.path.join(s,a.replace(".json",".mapping.json"));this._loader.load(l,"json",function(t,n){return t?(e.data={mapping:[]},void h(e)):void i._loadMaterials(s,n,function(t,i){e.data=n,h(e)})})}else h(e)},_loadMaterials:function(e,t,i){var r,s=this,a=t.mapping.length,o=[],h=function(e,t){s._loadTextures(t,function(e,n){i(null,t)})};0===a&&i(null,o);var l=function(e,t){o.push(t),a--,0===a&&h(null,o)};for(r=0;r<t.mapping.length;r++){var c=t.mapping[r].path;c?s.loadFromUrl(n.path.join(e,c),"material",l):a--}},_loadTextures:function(e,t){var i,r,s=this,a={},o=[],h=[],l=0;for(i=0;i<e.length;i++)if(e[i].data.parameters){var c=e[i].data.parameters;for(r=0;r<c.length;r++)if("texture"===c[r].type){var d=e[i].getFileUrl(),u=n.path.getDirectory(d);d=n.path.join(u,c[r].data),a[d]||(a[d]=!0,o.push(d),l++)}}else console.warn("Update material asset loader to support new material format");if(!l)return void t(null,h);var f=function(e,i){h.push(i),l--,e&&console.error(e),0===l&&t(null,h)};for(i=0;i<o.length;i++)s.loadFromUrl(o[i],"texture",f)},findAll:function(e,t){var i=this,n=this._names[e];if(n){var r=n.map(function(e){return i._assets[e]});return t?r.filter(function(e){return e.type===t}):r}return[]},_onTagAdd:function(e,t){this._tags.add(e,t)},_onTagRemove:function(e,t){this._tags.remove(e,t)},findByTag:function(){return this._tags.find(arguments)},filter:function(e){for(var t=[],i=0,n=this._assets.length;i<n;i++)e(this._assets[i])&&t.push(this._assets[i]);return t},find:function(e,t){var i=this.findAll(e,t);return i?i[0]:null},getAssetById:function(e){return console.warn("DEPRECATED: getAssetById() use get() instead"),this.get(e)}}),{AssetRegistry:e}}()),Function.prototype.extendsFrom=function(e){var t,i,n=function(){};return t=this,i=function(){e.apply(this,arguments),t.apply(this,arguments),this.constructor=t},i._super=e.prototype,n.prototype=e.prototype,i.prototype=new n,i},Object.assign(n,function(){return{inherits:function(e,t){var i=function(){},n=function(i,n,r,s,a,o,h,l){t.call(this,i,n,r,s,a,o,h,l),e.call(this,i,n,r,s,a,o,h,l)};return n._super=t.prototype,i.prototype=t.prototype,n.prototype=new i,n}}}()),n.anim={Animation:n.Animation,Key:n.Key,Node:n.Node,Skeleton:n.Skeleton},n.asset={ASSET_ANIMATION:"animation",ASSET_AUDIO:"audio",ASSET_IMAGE:"image",ASSET_JSON:"json",ASSET_MODEL:"model",ASSET_MATERIAL:"material",ASSET_TEXT:"text",ASSET_TEXTURE:"texture",ASSET_CUBEMAP:"cubemap",ASSET_SCRIPT:"script"},n.audio={AudioManager:n.SoundManager,Channel:n.Channel,Channel3d:n.Channel3d,Listener:n.Listener,Sound:n.Sound},n.fw={Application:n.Application,Component:n.Component,ComponentData:n.ComponentData,ComponentSystem:n.ComponentSystem,Entity:n.Entity,FillMode:{NONE:n.FILLMODE_NONE,FILL_WINDOW:n.FILLMODE_FILL_WINDOW,KEEP_ASPECT:n.FILLMODE_KEEP_ASPECT},ResolutionMode:{AUTO:n.RESOLUTION_AUTO,FIXED:n.RESOLUTION_FIXED}},Object.assign(n.gfx,{drawQuadWithShader:n.drawQuadWithShader,precalculatedTangents:n.precalculatedTangents,programlib:n.programlib,shaderChunks:n.shaderChunks,ContextCreationError:n.ContextCreationError,Device:n.GraphicsDevice,IndexBuffer:n.IndexBuffer,ProgramLibrary:n.ProgramLibrary,RenderTarget:n.RenderTarget,ScopeId:n.ScopeId,Shader:n.Shader,ShaderInput:n.ShaderInput,Texture:n.Texture,UnsupportedBrowserError:n.UnsupportedBrowserError,VertexBuffer:n.VertexBuffer,VertexFormat:n.VertexFormat,VertexIterator:n.VertexIterator}),function(){function e(e){this.name="UnsupportedBrowserError",this.message=e||""}function t(e){this.name="ContextCreationError",this.message=e||""}e.prototype=Error.prototype,t.prototype=Error.prototype,n.ContextCreationError=t,n.UnsupportedBrowserError=e}(),Object.assign(n.input,{getTouchTargetCoords:n.getTouchTargetCoords,Controller:n.Controller,GamePads:n.GamePads,Keyboard:n.Keyboard,KeyboardEvent:n.KeyboardEvent,Mouse:n.Mouse,MouseEvent:n.MouseEvent,Touch:n.Touch,TouchDevice:n.TouchDevice,TouchEvent:n.TouchEvent}),n.math.INV_LOG2=Math.LOG2E,n.math.intToBytes=n.math.intToBytes32,n.math.bytesToInt=n.math.bytesToInt32,n.posteffect={createFullscreenQuad:n.createFullscreenQuad,drawFullscreenQuad:n.drawFullscreenQuad,PostEffect:n.PostEffect,PostEffectQueue:n.PostEffectQueue},Object.assign(n.scene,{partitionSkin:n.partitionSkin,procedural:{calculateTangents:n.calculateTangents,createMesh:n.createMesh,createTorus:n.createTorus,createCylinder:n.createCylinder,createCapsule:n.createCapsule,createCone:n.createCone,createSphere:n.createSphere,createPlane:n.createPlane,createBox:n.createBox},BasicMaterial:n.BasicMaterial,DepthMaterial:n.DepthMaterial,ForwardRenderer:n.ForwardRenderer,GraphNode:n.GraphNode,Material:n.Material,Command:n.Command,Mesh:n.Mesh,MeshInstance:n.MeshInstance,Model:n.Model,ParticleEmitter:n.ParticleEmitter,PhongMaterial:n.StandardMaterial,Picker:n.Picker,PickMaterial:n.PickMaterial,Projection:{ORTHOGRAPHIC:n.PROJECTION_ORTHOGRAPHIC,PERSPECTIVE:n.PROJECTION_PERSPECTIVE},Scene:n.Scene,Skin:n.Skin,SkinInstance:n.SkinInstance}),n.shape={Aabb:n.BoundingBox,Sphere:n.BoundingSphere,Plane:n.Plane},n.time={now:n.now,Timer:n.Timer},n.PhongMaterial=n.StandardMaterial,n.BoundingSphere.prototype.intersectRay=n.BoundingSphere.prototype.intersectsRay,n.ELEMENTTYPE_INT8=n.TYPE_INT8,n.ELEMENTTYPE_UINT8=n.TYPE_UINT8,n.ELEMENTTYPE_INT16=n.TYPE_INT16,n.ELEMENTTYPE_UINT16=n.TYPE_UINT16,n.ELEMENTTYPE_INT32=n.TYPE_INT32,n.ELEMENTTYPE_UINT32=n.TYPE_UINT32,n.ELEMENTTYPE_FLOAT32=n.TYPE_FLOAT32,Object.defineProperty(n.shaderChunks,"transformSkinnedVS",{get:function(){return"#define SKIN\n"+n.shaderChunks.transformVS}}),Object.assign(n.Application.prototype,function(){function e(){this._immediateData||(this._immediateData=new _(this.graphicsDevice),this.on("prerender",this._preRenderImmediate,this),this.on("postrender",this._postRenderImmediate,this))}function t(e,t,i){void 0===i.layer&&(i.layer=this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE)),
void 0===i.depthTest&&(i.depthTest=!0),this._initImmediate();var r=i.layer;this._immediateData.addLayer(r);var s=this._immediateData.getLayerIdx(r);if(void 0===s){var a=new m;a.init(this.graphicsDevice,this._immediateData.lineVertexFormat,r,e.length/2),a.material.depthTest=i.depthTest,i.mask&&(a.meshInstance.mask=i.mask),s=this._immediateData.lineBatches.push(a)-1,this._immediateData.addLayerIdx(s,r)}else this._immediateData.lineBatches[s].init(this.graphicsDevice,this._immediateData.lineVertexFormat,r,e.length/2),this._immediateData.lineBatches[s].material.depthTest=i.depthTest,i.mask&&(this._immediateData.lineBatches[s].meshInstance.mask=i.mask);this._immediateData.lineBatches[s].addLines(e,t)}function i(e,t,i){var r,s=i,a=arguments[3],o=arguments[4];a instanceof n.Color?(s=a,"number"==typeof o?(p||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),p=!0),r=o===n.LINEBATCH_OVERLAY?{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!1}:{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!0}):r=o):"number"==typeof a?(p||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),p=!0),s=i,r=a===n.LINEBATCH_OVERLAY?{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!1}:{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!0}):r=a?a:{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!0},this._addLines([e,t],[i,s],r)}function r(e,t,i){i?"number"==typeof i&&(p||(console.warn("lineBatch argument is deprecated for renderLine. Use options.layer instead"),p=!0),i=i===n.LINEBATCH_OVERLAY?{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!1}:{layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!0}):i={layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE),depthTest:!0};var r=!!t.length;return r&&e.length!==t.length?void n.log.error("renderLines: position/color arrays have different lengths"):e.length%2!==0?void n.log.error("renderLines: array length is not divisible by 2"):void this._addLines(e,t,i)}function s(e,t,i){var r;if(this._initImmediate(),!this._immediateData.cubeLocalPos){var s=.5;this._immediateData.cubeLocalPos=[new n.Vec3((-s),(-s),(-s)),new n.Vec3((-s),s,(-s)),new n.Vec3(s,s,(-s)),new n.Vec3(s,(-s),(-s)),new n.Vec3((-s),(-s),s),new n.Vec3((-s),s,s),new n.Vec3(s,s,s),new n.Vec3(s,(-s),s)],this._immediateData.cubeWorldPos=[new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3,new n.Vec3]}var a=this._immediateData.cubeLocalPos,o=this._immediateData.cubeWorldPos;for(r=0;r<8;r++)e.transformPoint(a[r],o[r]);this.renderLines([o[0],o[1],o[1],o[2],o[2],o[3],o[3],o[0],o[4],o[5],o[5],o[6],o[6],o[7],o[7],o[4],o[0],o[4],o[1],o[5],o[2],o[6],o[3],o[7]],t,i)}function a(){for(var e=0;e<this._immediateData.lineBatches.length;e++)this._immediateData.lineBatches[e]&&this._immediateData.lineBatches[e].finalize()}function o(){for(var e=0;e<this._immediateData.layers.length;e++)this._immediateData.layers[e].clearMeshInstances(!0);this._immediateData.layers.length=0}function h(e,t){t||(t={layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE)}),this._initImmediate(),this._immediateData.addLayer(t.layer),f[0]=e,t.layer.addMeshInstances(f,!0)}function l(e,t,i,r){r||(r={layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE)}),this._initImmediate(),d.worldTransform=i,d._dirtyWorld=d._dirtyNormal=!1;var s=new n.MeshInstance(d,e,t);s.cull=!1,r.mask&&(s.mask=r.mask),this._immediateData.addLayer(r.layer),f[0]=s,r.layer.addMeshInstances(f,!0)}function c(e,t,i){if(i||(i={layer:this.scene.layers.getLayerById(n.LAYERID_IMMEDIATE)}),this._initImmediate(),!this._immediateData.quadMesh){var r=new n.VertexFormat(this.graphicsDevice,[{semantic:n.SEMANTIC_POSITION,components:3,type:n.TYPE_FLOAT32}]),s=new n.VertexBuffer(this.graphicsDevice,r,4),a=new n.VertexIterator(s);a.element[n.SEMANTIC_POSITION].set(-.5,-.5,0),a.next(),a.element[n.SEMANTIC_POSITION].set(.5,-.5,0),a.next(),a.element[n.SEMANTIC_POSITION].set(-.5,.5,0),a.next(),a.element[n.SEMANTIC_POSITION].set(.5,.5,0),a.end(),this._immediateData.quadMesh=new n.Mesh,this._immediateData.quadMesh.vertexBuffer=s,this._immediateData.quadMesh.primitive[0].type=n.PRIMITIVE_TRISTRIP,this._immediateData.quadMesh.primitive[0].base=0,this._immediateData.quadMesh.primitive[0].count=4,this._immediateData.quadMesh.primitive[0].indexed=!1}d.worldTransform=e,d._dirtyWorld=d._dirtyNormal=!1;var o=new n.MeshInstance(d,this._immediateData.quadMesh,t);o.cull=!1,f[0]=o,this._immediateData.addLayer(i.layer),i.layer.addMeshInstances(f,!0)}var d=new n.GraphNode,u=new n.GraphNode,f=[],p=!1,_=function(e){this.lineVertexFormat=new n.VertexFormat(e,[{semantic:n.SEMANTIC_POSITION,components:3,type:n.TYPE_FLOAT32},{semantic:n.SEMANTIC_COLOR,components:4,type:n.TYPE_UINT8,normalize:!0}]),this.lineBatches=[],this.layers=[],this.layerToBatch={},this.quadMesh=null,this.cubeLocalPos=null,this.cubeWorldPos=null,this.identityGraphNode=new n.GraphNode};_.prototype.addLayer=function(e){this.layers.indexOf(e)<0&&this.layers.push(e)},_.prototype.getLayerIdx=function(e){return this.layerToBatch[e.id]},_.prototype.addLayerIdx=function(e,t){this.layerToBatch[t.id]=e};var m=function(){this.numLinesAllocated=128,this.vb=null,this.vbRam=null,this.mesh=null,this.linesUsed=0,this.material=null,this.meshInstance=null,this.layer=null};return Object.assign(m.prototype,{init:function(e,t,i,r){for(this.mesh||(this.mesh=new n.Mesh,this.mesh.primitive[0].type=n.PRIMITIVE_LINES,this.mesh.primitive[0].base=0,this.mesh.primitive[0].indexed=!1,this.material=new n.BasicMaterial,this.material.vertexColors=!0,this.material.blend=!0,this.material.blendType=n.BLEND_NORMAL,this.material.update()),this.layer=i;this.linesUsed+r>this.numLinesAllocated;)this.vb&&(this.vb.destroy(),this.vb=null),this.numLinesAllocated*=2;this.vertexFormat=t,this.vb||(this.vb=new n.VertexBuffer(e,t,2*this.numLinesAllocated,n.BUFFER_DYNAMIC),this.mesh.vertexBuffer=this.vb,this.vbRam=new DataView(this.vb.lock()),this.meshInstance||(u.worldTransform=n.Mat4.IDENTITY,u._dirtyWorld=u._dirtyNormal=!1,this.meshInstance=new n.MeshInstance(u,this.mesh,this.material),this.meshInstance.cull=!1))},addLines:function(e,t){for(var i,n=!!t.length,r=2*this.linesUsed*this.vertexFormat.size,s=0;s<e.length;s++)this.vbRam.setFloat32(r,e[s].x,!0),r+=4,this.vbRam.setFloat32(r,e[s].y,!0),r+=4,this.vbRam.setFloat32(r,e[s].z,!0),r+=4,i=n?t[s]:t,this.vbRam.setUint8(r,255*i.r),r+=1,this.vbRam.setUint8(r,255*i.g),r+=1,this.vbRam.setUint8(r,255*i.b),r+=1,this.vbRam.setUint8(r,255*i.a),r+=1;this.linesUsed+=e.length/2},finalize:function(){this.linesUsed>0&&(this.vb.setData(this.vbRam.buffer),this.mesh.primitive[0].count=2*this.linesUsed,f[0]=this.meshInstance,this.layer.addMeshInstances(f,!0),this.linesUsed=0)}}),{renderMeshInstance:h,renderMesh:l,renderLine:i,renderLines:r,renderQuad:c,renderWireCube:s,_addLines:t,_initImmediate:e,_preRenderImmediate:a,_postRenderImmediate:o}}()),Object.assign(n,function(){function e(t,i,n,r){if(t.enabled){var s;if(t.model&&t.model.model&&t.model.enabled&&(r&&r.push(t),t.model.data.lightmapped&&i)){var a=!0,o=t.model.model.meshInstances;for(s=0;s<o.length;s++)if(!o[s].mesh.vertexBuffer.format.hasUv1){a=!1;break}if(a){var h,l,c=[];for(s=0;s<o.length;s++){for(l=!1,h=0;h<o.length;h++)s!==h&&o[s].mesh===o[h].mesh&&(l=!0);l?(i.push(t),n.push([o[s]])):c.push(o[s])}c.length>0&&(i.push(t),n.push(c))}}for(s=0;s<t._children.length;s++)e(t._children[s],i,n,r)}}var t,i=2048,r=2,s=4,a=[],o=[],h=new n.Vec3,l=new n.BoundingBox,c=new n.BoundingBox,d={},u=0,f=1,p=["texture_lightMap","texture_dirLightMap"],_=[],m=function(e,t,i,n,r){this.device=e,this.root=t,this.scene=i,this.renderer=n,this.assets=r};return Object.assign(m.prototype,{calculateLightmapSize:function(e){var t,r,s=this.scene.lightmapSizeMultiplier||16,a=h,o={x:1,y:1,z:1,uv:1};e.model.asset?(t=this.assets.get(e.model.asset).data,t.area&&(o.x=t.area.x,o.y=t.area.y,o.z=t.area.z,o.uv=t.area.uv)):e.model._area&&(t=e.model,t._area&&(o.x=t._area.x,o.y=t._area.y,o.z=t._area.z,o.uv=t._area.uv));var l=e.model.lightmapSizeMultiplier||1;for(o.x*=l,o.y*=l,o.z*=l,a.copy(e.localScale),r=e._parent;r;)a.mul(r.localScale),r=r._parent;a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.z=Math.abs(a.z);var c=o.x*a.y*a.z+o.y*a.x*a.z+o.z*a.x*a.y;return c/=o.uv,c=Math.sqrt(c),Math.min(n.math.nextPowerOfTwo(c*s),this.scene.lightmapMaxResolution||i)},bake:function(i,m){var A,v,y=this.device,g=this.scene,b=1;void 0===m&&(m=n.BAKE_COLORDIR),m===n.BAKE_COLORDIR&&(b=2);var E,T=[],S=[];if(i){var w;for(A=o.length-1;A>=0;A--)for(v=0;v<i.length;v++)if(o[A]===i[v]){for(w=0;w<a[A].length;w++)a[A][w].destroy();a.splice(A,1),o.splice(A,1)}var C=[];for(A=0;A<i.length;A++)e(i[A],C,S);i=C,e(this.root,null,null,T)}else{for(A=0;A<a.length;A++)for(v=0;v<a[A].length;v++)a[A][v].destroy();a=[],o=[],i=[],e(this.root,i,S,T)}if(0===i.length)return void y.fire("lightmapper:end",{timestamp:n.now(),target:this});var M=!1;g._needsStaticPrepare&&(g._needsStaticPrepare=!1,M=!0);var P,I,R=[],x=[[],[]],O={},k=new n.Texture(this.device,{width:4,height:4,format:n.PIXELFORMAT_R8_G8_B8_A8,rgbm:!0});for(A=0;A<i.length;A++){for(P=this.calculateLightmapSize(i[A]),R.push(P),E=0;E<b;E++)I=new n.Texture(y,{width:P,height:P,format:n.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1,rgbm:E===u,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),x[E].push(I);if(!O[P]){var D=new n.Texture(y,{width:P,height:P,format:n.PIXELFORMAT_R8_G8_B8_A8,mipmaps:!1,rgbm:!0,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),L=new n.RenderTarget(y,D,{depth:!1});O[P]=L}}var N=g.layers;N._update();var F,B=[],V=[],U=[],G=[],W=N._lights;for(A=0;A<W.length;A++)W[A]._enabled&&(F=W[A]._mask,0!==(F&s)&&(V.push(F),U.push(W[A].shadowUpdateMode),W[A]._mask=4294967295,W[A].shadowUpdateMode=W[A]._type===n.LIGHTTYPE_DIRECTIONAL?n.SHADOWUPDATE_REALTIME:n.SHADOWUPDATE_THISFRAME,B.push(W[A]),W[A].isStatic=!1)),G.push(W[A]._enabled),W[A].enabled=!1;var z=n.shaderChunks,H="#define UV1LAYOUT\n"+z.transformVS,j=z.bakeLmEndPS,Y=z.dilatePS,X=z.createShaderFromCode(y,z.fullscreenQuadVS,Y,"lmDilate"),Z=y.scope.resolve("source"),K=y.scope.resolve("pixelOffset"),Q=y.scope.resolve("bakeDir"),J=new n.Vec2,q=N._meshInstances;for(A=0;A<q.length;A++)q[A].node&&q[A].node.getWorldTransform();var $=g.fog,ee=g.ambientLight.data[0],te=g.ambientLight.data[1],ie=g.ambientLight.data[2];g.fog=n.FOG_NONE,g.ambientLight.data[0]=0,g.ambientLight.data[1]=0,g.ambientLight.data[2]=0,t||(t=new n.Camera,t._node=new n.GraphNode,t.clearColor[0]=0,t.clearColor[1]=0,t.clearColor[2]=0,t.clearColor[3]=0,t.clearDepth=1,t.clearFlags=n.CLEARFLAG_COLOR,t.clearStencil=null,t.frustumCulling=!1);var ne,re,se,ae,oe=[];oe.length=o.length;var he;for(ne=0;ne<T.length;ne++){for(se=T[ne].model.model.meshInstances,he=[],A=0;A<se.length;A++)he.push(se[A]._shaderDefs),se[A]._shaderDefs&=~(n.SHADERDEF_LM|n.SHADERDEF_DIRLM);for(A=0;A<o.length;A++)if(o[A]===T[ne]){oe[A]=he;break}}var le,ce=[],de=[];for(ne=0;ne<T.length;ne++)if(ce[ne]=T[ne].model.castShadows,T[ne].model.castShadows=T[ne].model.data.castShadowsLightmap,T[ne].model.data.castShadowsLightmap)for(le=T[ne].model.meshInstances,A=0;A<le.length;A++)le[A].visibleThisFrame=!0,de.push(le[A]);this.renderer.updateCpuSkinMatrices(de),this.renderer.gpuUpdate(de);var ue,fe,pe,_e,me,Ae=[],ve=[],ye=[[],[]],ge=[];ge.length=i.length;var be;for(E=0;E<b;E++)_[E]||(be=new n.StandardMaterial,be.chunks.transformVS=H,E===u?(be.chunks.endPS=j,be.ambient=new n.Color(0,0,0),be.ambientTint=!0,be.lightMap=k):(be.chunks.basePS=z.basePS+"\nuniform sampler2D texture_dirLightMap;\nuniform float bakeDir;\n",be.chunks.endPS=z.bakeDirLmEndPS),be.chunks.outputAlphaPS="\n",be.chunks.outputAlphaOpaquePS="\n",be.chunks.outputAlphaPremulPS="\n",be.cull=n.CULLFACE_NONE,be.forceUv1=!0,be.update(),be.updateShader(y,g),be.name="lmMaterial"+E,_[E]=be);for(ne=0;ne<i.length;ne++){if(se=S[ne],ge[ne]=0,se.length>0)for(l.copy(se[0].aabb),A=0;A<se.length;A++)se[A].node.getWorldTransform(),l.add(se[A].aabb);var Ee=new n.BoundingBox;for(Ee.copy(l),ve.push(Ee),A=0;A<se.length;A++)ae=se[A],ae._shaderDefs&=~(n.SHADERDEF_LM|n.SHADERDEF_DIRLM),ae.mask=s,ae.deleteParameter("texture_lightMap"),ae.deleteParameter("texture_dirLightMap"),ae.setParameter("texture_lightMap",ae.material.lightMap?ae.material.lightMap:k),ae.setParameter("texture_dirLightMap",k);for(E=0;E<b;E++)re=x[E][ne],ue=new n.RenderTarget(y,re,{depth:!1}),ye[E].push(ue)}for(v=0;v<B.length;v++)B[v].enabled=!1;var Te,Se=[[],[],[]],we=!1;for(A=0;A<B.length;A++){for(B[A].enabled=!0,Te=!1,B[A]._cacheShadowMap=!0,B[A]._type!==n.LIGHTTYPE_DIRECTIONAL&&(B[A]._node.getWorldTransform(),B[A].getBoundingSphere(d),c.center=d.center,c.halfExtents.x=d.radius,c.halfExtents.y=d.radius,c.halfExtents.z=d.radius),B[A]._type===n.LIGHTTYPE_SPOT&&(_e=B[A],me=this.renderer.getShadowCamera(y,_e),me._node.setPosition(_e._node.getPosition()),me._node.setRotation(_e._node.getRotation()),me._node.rotateLocal(-90,0,0),me.projection=n.PROJECTION_PERSPECTIVE,me.nearClip=_e.attenuationEnd/1e3,me.farClip=_e.attenuationEnd,me.aspectRatio=1,me.fov=2*_e._outerConeAngle,this.renderer.updateCameraFrustum(me)),S.length>0&&this.renderer.updateShaders(S[0]),ne=0;ne<i.length;ne++){if(se=S[ne],l=ve[ne],B[A]._type===n.LIGHTTYPE_DIRECTIONAL){h.copy(l.center),h.y+=l.halfExtents.y,t._node.setPosition(h),t._node.setEulerAngles(-90,0,0);var Ce=Math.max(l.halfExtents.x,l.halfExtents.z);t.projection=n.PROJECTION_ORTHOGRAPHIC,t.nearClip=0,t.farClip=2*l.halfExtents.y,t.aspectRatio=1,t.orthoHeight=Ce}else if(!c.intersects(l))continue;if(B[A]._type===n.LIGHTTYPE_SPOT){var Me=!1;for(v=0;v<se.length;v++)if(this.renderer._isVisible(me,se[v])){Me=!0;break}if(!Me)continue}for(B[A]._type===n.LIGHTTYPE_DIRECTIONAL?(Se[n.LIGHTTYPE_DIRECTIONAL][0]=B[A],Se[n.LIGHTTYPE_POINT].length=0,Se[n.LIGHTTYPE_SPOT].length=0,!Te&&B[A].castShadows&&(this.renderer.cullDirectionalShadowmap(B[A],de,t,0),this.renderer.renderShadows(Se[n.LIGHTTYPE_DIRECTIONAL],0),Te=!0)):(Se[n.LIGHTTYPE_DIRECTIONAL].length=0,B[A]._type===n.LIGHTTYPE_POINT?(Se[n.LIGHTTYPE_POINT][0]=B[A],Se[n.LIGHTTYPE_SPOT].length=0,!Te&&B[A].castShadows&&(this.renderer.cullLocalShadowmap(B[A],de),this.renderer.renderShadows(Se[n.LIGHTTYPE_POINT]),Te=!0)):(Se[n.LIGHTTYPE_POINT].length=0,Se[n.LIGHTTYPE_SPOT][0]=B[A],!Te&&B[A].castShadows&&(this.renderer.cullLocalShadowmap(B[A],de),this.renderer.renderShadows(Se[n.LIGHTTYPE_SPOT]),Te=!0))),v=0;v<se.length;v++)Ae[v]=se[v].material;for(E=0;E<b;E++){for(re=x[E][ne],ue=ye[E][ne],fe=O[re.width],pe=fe.colorBuffer,0===E?we=g.updateShaders:we&&(g.updateShaders=!0),v=0;v<se.length;v++)se[v].material=_[E];for(b>1&&this.renderer.updateShaders(se),this.renderer.setCamera(t,fe,!0),E===f&&Q.setValue(B[A].bakeDir?1:0),this.renderer._forwardTime=0,this.renderer._shadowMapTime=0,this.renderer.renderForward(t,se,se.length,Se,n.SHADER_FORWARDHDR),x[E][ne]=pe,ye[E][ne]=fe,O[re.width]=ue,v=0;v<se.length;v++)ae=se[v],ae.setParameter(p[E],pe),ae._shaderDefs|=n.SHADERDEF_LM}for(ge[ne]++,v=0;v<se.length;v++)se[v].material=Ae[v]}B[A].enabled=!1,B[A]._cacheShadowMap=!1,B[A]._isCachedShadowMap&&B[A]._destroyShadowMap()}var Pe;for(ne=0;ne<i.length;ne++){for(se=S[ne],Pe=[],E=0;E<b;E++){re=x[E][ne],ue=ye[E][ne],fe=O[re.width],pe=fe.colorBuffer;var Ie=4;for(J.set(1/re.width,1/re.height),K.setValue(J.data),A=0;A<Ie;A++)Z.setValue(re),n.drawQuadWithShader(y,fe,X),Z.setValue(pe),n.drawQuadWithShader(y,ue,X);for(A=0;A<se.length;A++)ae=se[A],ae.mask=r,se[A].setParameter(p[E],re),E===f&&(se[A]._shaderDefs|=n.SHADERDEF_DIRLM);Pe[E]=re,E===b-1&&ue.destroy()}a.push(Pe),o.push(i[ne])}for(var Re in O)O.hasOwnProperty(Re)&&(O[Re].colorBuffer.destroy(),O[Re].destroy());for(A=0;A<a.length;A++)for(v=0;v<a[A].length;v++)I=a[A][v],I.minFilter=n.FILTER_LINEAR,I.magFilter=n.FILTER_LINEAR;for(ne=0;ne<T.length;ne++)T[ne].model.castShadows=ce[ne];for(A=0;A<oe.length;A++)if(oe[A])for(se=o[A].model.model.meshInstances,v=0;v<se.length;v++)se[v]._shaderDefs|=oe[A][v]&(n.SHADERDEF_LM|n.SHADERDEF_DIRLM);for(A=0;A<B.length;A++)B[A]._mask=V[A],B[A].shadowUpdateMode=U[A];for(A=0;A<W.length;A++)W[A].enabled=G[A];g.fog=$,g.ambientLight.data[0]=ee,g.ambientLight.data[1]=te,g.ambientLight.data[2]=ie,M&&(g._needsStaticPrepare=!0)}}),{Lightmapper:m}}()),Object.assign(n,function(){function e(e,t){if(e&&!t)return!1;if(!e&&t)return!1;if(e=e.data,t=t.data,e===t)return!0;if(e instanceof Float32Array&&t instanceof Float32Array){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}return!1}var t=function(e,t,i){this.origMeshInstances=e,this._aabb=new n.BoundingBox,this.meshInstance=null,this.model=null,this.dynamic=t,this.batchGroupId=i,this.refCounter=0},i=function(e,t,i,r,s){this.dynamic=i,this.maxAabbSize=r,this.id=e,this.name=t,this.layers=void 0===s?[n.LAYERID_WORLD]:s},r=function(e,t,i){this.device=e,this.rootNode=i,this._dirty=!0,this.bones=t;var r=t.length;if(e.supportsBoneTextures){var s;s=r>256?64:r>64?32:r>16?16:8,this.boneTexture=new n.Texture(e,{width:s,height:s,format:n.PIXELFORMAT_RGBA32F,mipmaps:!1,minFilter:n.FILTER_NEAREST,magFilter:n.FILTER_NEAREST}),this.matrixPalette=this.boneTexture.lock()}else this.matrixPalette=new Float32Array(16*r)};Object.assign(r.prototype,{updateMatrices:function(){},updateMatrixPalette:function(){for(var e,t,i=this.matrixPalette,n=this.bones.length-1;n>=0;n--)e=this.bones[n].getWorldTransform().data,t=16*n,i[t]=e[0],i[t+1]=e[1],i[t+2]=e[2],i[t+3]=e[3],i[t+4]=e[4],i[t+5]=e[5],i[t+6]=e[6],i[t+7]=e[7],i[t+8]=e[8],i[t+9]=e[9],i[t+10]=e[10],i[t+11]=e[11],i[t+12]=e[12],i[t+13]=e[13],i[t+14]=e[14],i[t+15]=e[15];this.device.supportsBoneTextures&&(this.boneTexture.lock(),this.boneTexture.unlock())}});var s=function(e,t,i){this.device=e,this.rootNode=t,this.scene=i,this._init=!1,this._batchGroups={},this._batchGroupCounter=0,this._batchList=[],this._dirtyGroups=[]};return s.prototype.addGroup=function(e,t,i,r,s){if(void 0===r&&(r=this._batchGroupCounter,this._batchGroupCounter++),!this._batchGroups[r]){var a;return this._batchGroups[r]=a=new n.BatchGroup(r,e,t,i,s),a}},s.prototype.removeGroup=function(e){if(this._batchGroups[e]){for(var t=[],i=0;i<this._batchList.length;i++)this._batchList[i].batchGroupId===e?this.destroy(this._batchList[i]):t.push(this._batchList[i]);this._batchList=t,this._removeModelsFromBatchGroup(this.rootNode,e),delete this._batchGroups[e]}},s.prototype._removeModelsFromBatchGroup=function(e,t){if(e.enabled){e.model&&e.model.batchGroupId===t&&(e.model.batchGroupId=-1),e.element&&e.element.batchGroupId===t&&(e.element.batchGroupId=-1),e.sprite&&e.sprite.batchGroupId===t&&(e.sprite.batchGroupId=-1);for(var i=0;i<e._children.length;i++)this._removeModelsFromBatchGroup(e._children[i],t)}},s.prototype._collectAndRemoveModels=function(e,t,i){if(e.enabled){var n,r;if(e.model&&e.model.batchGroupId>=0&&e.model.model&&e.model.enabled&&(!i||i&&i.indexOf(e.model.batchGroupId)>=0)){if(r=t[e.model.batchGroupId],r||(r=t[e.model.batchGroupId]=[]),e.model.isStatic){var s=this.scene.drawCalls,a=e.model.meshInstances;for(n=0;n<s.length;n++)s[n]._staticSource&&(a.indexOf(s[n]._staticSource)<0||t[e.model.batchGroupId].push(s[n]));for(n=0;n<a.length;n++)s.indexOf(a[n])>=0&&t[e.model.batchGroupId].push(a[n])}else t[e.model.batchGroupId]=r.concat(e.model.meshInstances);e.model.removeModelFromLayers(e.model.model)}if(e.element&&e.element.batchGroupId>=0&&e.element.enabled&&(!i||i&&i.indexOf(e.element.batchGroupId)>=0)){r=t[e.element.batchGroupId],r||(r=t[e.element.batchGroupId]=[]);var o=!1;e.element._text?(t[e.element.batchGroupId].push(e.element._text._model.meshInstances[0]),e.element.removeModelFromLayers(e.element._text._model),o=!0):e.element._image&&(t[e.element.batchGroupId].push(e.element._image._model.meshInstances[0]),e.element.removeModelFromLayers(e.element._image._model),o=!0)}for(e.sprite&&e.sprite.batchGroupId>=0&&e.sprite.enabled&&(!i||i&&i.indexOf(e.sprite.batchGroupId)>=0)&&(r=t[e.sprite.batchGroupId],r||(r=t[e.sprite.batchGroupId]=[]),e.sprite._meshInstance&&(t[e.sprite.batchGroupId].push(e.sprite._meshInstance),this.scene.removeModel(e.sprite._model),e.sprite._batchGroup=this._batchGroups[e.sprite.batchGroupId])),n=0;n<e._children.length;n++)this._collectAndRemoveModels(e._children[n],t,i)}},s.prototype.markGroupDirty=function(e){this._dirtyGroups.indexOf(e)<0&&this._dirtyGroups.push(e)},s.prototype._registerEntities=function(e,t){for(var i,n=[],r=0;r<t.length;r++){for(i=t[r].node;!i._app&&i._parent;)i=i._parent;i._app&&n.push(i)}this.register(e,n)},s.prototype.generate=function(e){var t,i,n={};if(e){var r=[];for(t=0;t<this._batchList.length;t++)e.indexOf(this._batchList[t].batchGroupId)<0?r.push(this._batchList[t]):this.destroy(this._batchList[t]);if(this._batchList=r,this._collectAndRemoveModels(this.rootNode,n,e),e===this._dirtyGroups)this._dirtyGroups.length=0;else{var s=[];for(t=0;t<this._dirtyGroups.length;t++)e.indexOf(this._dirtyGroups[t])<0&&s.push(this._dirtyGroups[t]);this._dirtyGroups=s}}else{for(t=0;t<this._batchList.length;t++)this.destroy(this._batchList[t]);this._batchList.length=0,this._collectAndRemoveModels(this.rootNode,n),this._dirtyGroups.length=0}var a,o,h,l;for(var c in n)if(n.hasOwnProperty(c)&&(a=n[c],h=this._batchGroups[c]))for(o=this.prepare(a,h.dynamic,h.maxAabbSize),t=0;t<o.length;t++){for(l=this.create(o[t],h.dynamic,parseInt(c,10)),i=0;i<h.layers.length;i++)this.scene.layers.getLayerById(h.layers[i]).addMeshInstances(l.model.meshInstances);this._registerEntities(l,o[t])}},s.prototype.getGroupByName=function(e){var t=this._batchGroups;for(var i in t)if(t.hasOwnProperty(i)&&t[i].name===e)return t[i];return null},s.prototype.prepare=function(t,i,r){if(0===t.length)return[];void 0===r&&(r=Number.POSITIVE_INFINITY);for(var s,a,o,h,l,c,d,u,f,p,_,m,A=.5*r,v=this.device.supportsBoneTextures?1024:this.device.boneLimit,y=new n.BoundingBox,g=new n.BoundingBox,b=[],E=0,T=t;T.length>0;){for(b[E]=[],_=[],a=T[0].material,o=T[0].layer,p=T[0]._shaderDefs,l=T[0].parameters,f=T[0]._staticLightList,h=T[0].mesh.vertexBuffer.getNumVertices(),y.copy(T[0].aabb),s=0;s<T.length;s++){if(s>0){if(a!==T[s].material){_.push(T[s]);continue}if(o!==T[s].layer){_.push(T[s]);continue}if(p!==T[s]._shaderDefs){_.push(T[s]);continue}if(h+T[s].mesh.vertexBuffer.getNumVertices()>65535){_.push(T[s]);continue}if(g.copy(y),g.add(T[s].aabb),g.halfExtents.x>A||g.halfExtents.y>A||g.halfExtents.z>A){_.push(T[s]);continue}c=T[s].parameters,u=!1;for(d in l)if(l.hasOwnProperty(d)&&!e(l[d],c[d])){u=!0;break}if(!u)for(d in c)if(c.hasOwnProperty(d)&&!e(c[d],l[d])){u=!0;break}if(u){_.push(T[s]);continue}if(c=T[s]._staticLightList,f&&!c||!f&&c){_.push(T[s]);continue}if(f&&c){for(u=!1,m=0;m<f.length;m++)if(c.indexOf(f[m])<0){u=!0;break}for(m=0;m<c.length;m++)if(f.indexOf(c[m])<0){u=!0;break}if(u){_.push(T[s]);continue}}}if(y.add(T[s].aabb),h+=T[s].mesh.vertexBuffer.getNumVertices(),b[E].push(T[s]),i&&b[E].length===v){_=s===T.length?[]:T.slice(s+1);break}}E++,T=_}return b},s.prototype.create=function(e,t,i){if(!this._init){var s="#define BONE_LIMIT "+this.device.getBoneLimit()+"\n";this.transformVS=s+"#define DYNAMICBATCH\n"+n.shaderChunks.transformVS,this.skinTexVS=n.shaderChunks.skinBatchTexVS,this.skinConstVS=n.shaderChunks.skinBatchConstVS,this.vertexFormats={},this._init=!0}var a,o,h=new n.Batch(e,t,i);this._batchList.push(h);var l,c,d,u,f,p,_,m,A,v,y=null,g=0,b=0;for(a=0;a<e.length;a++){if(y){if(y!==e[a].material)return}else y=e[a].material;for(l=e[a].mesh,c=l.vertexBuffer.format.elements,d=l.vertexBuffer.numVertices,g+=d,o=0;o<c.length;o++)c[o].name===n.SEMANTIC_POSITION?f=!0:c[o].name===n.SEMANTIC_NORMAL?p=!0:c[o].name===n.SEMANTIC_TEXCOORD0?_=!0:c[o].name===n.SEMANTIC_TEXCOORD1?m=!0:c[o].name===n.SEMANTIC_TANGENT?A=!0:c[o].name===n.SEMANTIC_COLOR&&(v=!0);b+=l.primitive[0].count}if(f){var E,T,S,w,C,M,P,I,R,x,O,k,D,L,N,F=t?1:0,B=3+(p?3:0)+(_?2:0)+(m?2:0)+(A?4:0)+(v?1:0)+F,V=3,U=p?6:3,G=(p?6:3)+(_?2:0),W=(p?6:3)+(_?2:0)+(m?2:0),z=(p?6:3)+(_?2:0)+(m?2:0)+(A?4:0),H=(p?6:3)+(_?2:0)+(m?2:0)+(A?4:0)+(v?1:0),j=new ArrayBuffer(g*B*4),Y=new Float32Array(j),X=new Uint8Array(j),Z=new n.IndexBuffer(this.device,n.INDEXFORMAT_UINT16,b,n.BUFFER_STATIC),K=new Uint16Array(Z.lock()),Q=0,J=0,q=0;for(t||(L=new n.Vec3,N=L.data),a=0;a<e.length;a++){for(l=e[a].mesh,c=l.vertexBuffer.format.elements,d=l.vertexBuffer.numVertices,u=l.vertexBuffer.format.size,E=u/4,o=0;o<c.length;o++)c[o].name===n.SEMANTIC_POSITION?P=c[o].offset/4:c[o].name===n.SEMANTIC_NORMAL?I=c[o].offset/4:c[o].name===n.SEMANTIC_TEXCOORD0?R=c[o].offset/4:c[o].name===n.SEMANTIC_TEXCOORD1?x=c[o].offset/4:c[o].name===n.SEMANTIC_TANGENT?O=c[o].offset/4:c[o].name===n.SEMANTIC_COLOR&&(k=c[o].offset/4);if(T=new Float32Array(l.vertexBuffer.storage),S=new Uint8Array(l.vertexBuffer.storage),t)for(o=0;o<d;o++)Y[o*B+q]=T[o*E+P],Y[o*B+q+1]=T[o*E+P+1],Y[o*B+q+2]=T[o*E+P+2],p&&(Y[o*B+q+V]=T[o*E+I],Y[o*B+q+V+1]=T[o*E+I+1],Y[o*B+q+V+2]=T[o*E+I+2]),_&&(Y[o*B+q+U]=T[o*E+R],Y[o*B+q+U+1]=T[o*E+R+1]),m&&(Y[o*B+q+G]=T[o*E+x],Y[o*B+q+G+1]=T[o*E+x+1]),A&&(Y[o*B+q+W]=T[o*E+O],Y[o*B+q+W+1]=T[o*E+O+1],Y[o*B+q+W+2]=T[o*E+O+2],Y[o*B+q+W+3]=T[o*E+O+3]),v&&(X[o*B*4+4*q+4*z]=S[o*E*4+4*k],X[o*B*4+4*q+4*z+1]=S[o*E*4+4*k+1],X[o*B*4+4*q+4*z+2]=S[o*E*4+4*k+2],X[o*B*4+4*q+4*z+3]=S[o*E*4+4*k+3]),Y[o*B+H+q]=a;else for(D=e[a].node.getWorldTransform(),o=0;o<d;o++)L.set(T[o*E+P],T[o*E+P+1],T[o*E+P+2]),D.transformPoint(L,L),Y[o*B+q]=N[0],Y[o*B+q+1]=N[1],Y[o*B+q+2]=N[2],p&&(L.set(T[o*E+I],T[o*E+I+1],T[o*E+I+2]),D.transformVector(L,L),Y[o*B+q+V]=N[0],Y[o*B+q+V+1]=N[1],Y[o*B+q+V+2]=N[2]),_&&(Y[o*B+q+U]=T[o*E+R],Y[o*B+q+U+1]=T[o*E+R+1]),m&&(Y[o*B+q+G]=T[o*E+x],Y[o*B+q+G+1]=T[o*E+x+1]),A&&(L.set(T[o*E+O],T[o*E+O+1],T[o*E+O+2]),D.transformVector(L,L),Y[o*B+q+W]=N[0],Y[o*B+q+W+1]=N[1],Y[o*B+q+W+2]=N[2],Y[o*B+q+W+3]=T[o*E+O+3]),v&&(X[o*B*4+4*q+4*z]=S[o*E*4+4*k],X[o*B*4+4*q+4*z+1]=S[o*E*4+4*k+1],X[o*B*4+4*q+4*z+2]=S[o*E*4+4*k+2],X[o*B*4+4*q+4*z+3]=S[o*E*4+4*k+3]);for(w=l.primitive[0].base,C=l.primitive[0].count,M=new Uint16Array(l.indexBuffer[0].storage),o=0;o<C;o++)K[o+J]=M[w+o]+Q;J+=C,Q+=d,q=Q*B}var $=0;p&&($|=2),_&&($|=4),m&&($|=8),A&&($|=16),v&&($|=32),t&&($|=64);var ee=this.vertexFormats[$];if(!ee){var te=[];te.push({semantic:n.SEMANTIC_POSITION,components:3,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),p&&te.push({semantic:n.SEMANTIC_NORMAL,components:3,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),_&&te.push({semantic:n.SEMANTIC_TEXCOORD0,components:2,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),m&&te.push({semantic:n.SEMANTIC_TEXCOORD1,components:2,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),A&&te.push({semantic:n.SEMANTIC_TANGENT,components:4,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),v&&te.push({semantic:n.SEMANTIC_COLOR,components:4,type:n.ELEMENTTYPE_UINT8,normalize:!0}),t&&te.push({semantic:n.SEMANTIC_BLENDINDICES,components:1,type:n.ELEMENTTYPE_FLOAT32,normalize:!1}),ee=this.vertexFormats[$]=new n.VertexFormat(this.device,te)}var ie=new n.VertexBuffer(this.device,ee,g,n.BUFFER_STATIC,Y.buffer);Z.unlock(),l=new n.Mesh,l.vertexBuffer=ie,l.indexBuffer[0]=Z,l.primitive[0].type=h.origMeshInstances[0].mesh.primitive[0].type,l.primitive[0].base=0,l.primitive[0].count=b,l.primitive[0].indexed=!0,l.cull=!1,t&&(y=y.clone(),y.chunks.transformVS=this.transformVS,y.chunks.skinTexVS=this.skinTexVS,y.chunks.skinConstVS=this.skinConstVS,y.update());var ne=new n.MeshInstance(this.rootNode,l,y);if(ne.castShadow=h.origMeshInstances[0].castShadow,ne.parameters=h.origMeshInstances[0].parameters,ne.isStatic=h.origMeshInstances[0].isStatic,ne.cull=h.origMeshInstances[0].cull,ne.layer=h.origMeshInstances[0].layer,ne._staticLightList=h.origMeshInstances[0]._staticLightList,ne._shaderDefs=h.origMeshInstances[0]._shaderDefs,t){var re=[];for(a=0;a<h.origMeshInstances.length;a++)re.push(h.origMeshInstances[a].node);ne.skinInstance=new r(this.device,re,this.rootNode)}ne._updateAabb=!1,h.meshInstance=ne,this.update(h);var se=new n.Model;return se.meshInstances=[h.meshInstance],se.castShadows=h.origMeshInstances[0].castShadows,h.model=se,h}},s.prototype.update=function(e){e._aabb.copy(e.origMeshInstances[0].aabb);for(var t=0;t<e.origMeshInstances.length;t++)t>0&&e._aabb.add(e.origMeshInstances[t].aabb);e.meshInstance.aabb=e._aabb,e._aabb._radiusVer=-1,e.meshInstance._aabbVer=0},s.prototype.updateAll=function(){this._dirtyGroups.length>0&&this.generate(this._dirtyGroups);for(var e=0;e<this._batchList.length;e++)this._batchList[e].dynamic&&this.update(this._batchList[e])},s.prototype.clone=function(e,t){var i=new n.Batch(t,e.dynamic,e.batchGroupId);this._batchList.push(i);for(var s=[],a=0;a<t.length;a++)s.push(t[a].node);i.meshInstance=new n.MeshInstance(e.meshInstance.node,e.meshInstance.mesh,e.meshInstance.material),i.meshInstance._updateAabb=!1,i.meshInstance.parameters=t[0].parameters,i.meshInstance.isStatic=t[0].isStatic,i.meshInstance.cull=t[0].cull,i.meshInstance.layer=t[0].layer,i.meshInstance._staticLightList=t[0]._staticLightList,e.dynamic&&(i.meshInstance.skinInstance=new r(this.device,s,this.rootNode)),i.meshInstance.castShadow=e.meshInstance.castShadow,i.meshInstance._shader=e.meshInstance._shader;var o=new n.Model;return o.meshInstances=[i.meshInstance],o.castShadows=e.origMeshInstances[0].castShadows,i.model=o,i},s.prototype.destroy=function(e){e.refCounter=0;for(var t=this._batchGroups[e.batchGroupId].layers,i=0;i<t.length;i++)this.scene.layers.getLayerById(t[i]).removeMeshInstances(e.model.meshInstances);e.model.destroy()},s.prototype.decrement=function(e){e.refCounter--,0===e.refCounter&&this.destroy(e)},s.prototype.register=function(e,t){e.refCounter=t.length;for(var i=this,n=function(){i.decrement(e)},r=0;r<t.length;r++)t[r].once("destroy",n)},{Batch:t,BatchGroup:i,BatchManager:s}}()),n}),pc.Application.prototype.require=function(e,t){var i=function(e,t,n){var r=document.head||document.getElementsByTagName("head")[0];if(e[t]){var s=e[t],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",s),a.onerror=function(r){console.warn("Failed to load PlayCanvas script tag for "+s+". "+r.message),t+=1,i(e,t,n)},a.onload=function(){t+=1,i(e,t,n)},r.appendChild(a)}else null!=n&&n()};null!=e&&e instanceof String?i([e],0,t):null!=e&&e instanceof Array?i(e,0,t):console.warn("Invalid required script libraries specfied for the pc.Application.require prototype.")};var DracoDecoderModule=function(e){function t(e){if("string"!=typeof e)return!1;const t=e.split(".");return!(t.length<2||t.length>3)&&(1==t[0]&&t[1]>=0&&t[1]<=3||!(0!=t[0]||t[1]>10))}function i(e,t){e||Ae("Assertion failed: "+t)}function n(e,t,i,n){switch(i=i||"i8","*"===i.charAt(i.length-1)&&(i="i32"),i){case"i1":ht[e>>0]=t;break;case"i8":ht[e>>0]=t;break;case"i16":ct[e>>1]=t;break;case"i32":ut[e>>2]=t;break;case"i64":tempI64=[t>>>0,(tempDouble=t,+jt(tempDouble)>=1?tempDouble>0?(0|Zt(+Xt(tempDouble/4294967296),4294967295))>>>0:~~+Yt((tempDouble-+(~~tempDouble>>>0))/4294967296)>>>0:0)],ut[e>>2]=tempI64[0],ut[e+4>>2]=tempI64[1];break;case"float":pt[e>>2]=t;break;case"double":_t[e>>3]=t;break;default:Ae("invalid type for setValue: "+i)}}function r(e,t,r,s){var a,o;"number"==typeof e?(a=!0,o=e):(a=!1,o=e.length);var h,l="string"==typeof t?t:null;if(h=r==It?s:["function"==typeof xr?xr:St.staticAlloc,St.stackAlloc,St.staticAlloc,St.dynamicAlloc][void 0===r?Pt:r](Math.max(o,l?1:t.length)),a){var c;for(s=h,i(0==(3&h)),c=h+(o&-4);s<c;s+=4)ut[s>>2]=0;for(c=h+o;s<c;)ht[s++>>0]=0;return h}if("i8"===l)return e.subarray||e.slice?lt.set(e,h):lt.set(new Uint8Array(e),h),h;for(var d,u,f,p=0;p<o;){var _=e[p];"function"==typeof _&&(_=St.getFunctionIndex(_)),d=l||t[p],0!==d?("i64"==d&&(d="i32"),n(h+p,_,d),f!==d&&(u=St.getNativeTypeSize(d),f=d),p+=u):p++}return h}function s(e,t){if(0===t||!e)return"";for(var i,n=0,r=0;;){if(i=lt[e+r>>0],n|=i,0==i&&!t)break;if(r++,t&&r==t)break}t||(t=r);var s="";if(n<128){for(var a,o=1024;t>0;)a=String.fromCharCode.apply(String,lt.subarray(e,e+Math.min(t,o))),s=s?s+a:a,e+=o,t-=o;return s;
}return Ze.UTF8ToString(e)}function a(e,t){for(var i=t;e[i];)++i;if(i-t>16&&e.subarray&&Rt)return Rt.decode(e.subarray(t,i));for(var n,r,s,a,o,h,l="";;){if(n=e[t++],!n)return l;if(128&n)if(r=63&e[t++],192!=(224&n))if(s=63&e[t++],224==(240&n)?n=(15&n)<<12|r<<6|s:(a=63&e[t++],240==(248&n)?n=(7&n)<<18|r<<12|s<<6|a:(o=63&e[t++],248==(252&n)?n=(3&n)<<24|r<<18|s<<12|a<<6|o:(h=63&e[t++],n=(1&n)<<30|r<<24|s<<18|a<<12|o<<6|h))),n<65536)l+=String.fromCharCode(n);else{var c=n-65536;l+=String.fromCharCode(55296|c>>10,56320|1023&c)}else l+=String.fromCharCode((31&n)<<6|r);else l+=String.fromCharCode(n)}}function o(e,t,i,n){if(!(n>0))return 0;for(var r=i,s=i+n-1,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),o<=127){if(i>=s)break;t[i++]=o}else if(o<=2047){if(i+1>=s)break;t[i++]=192|o>>6,t[i++]=128|63&o}else if(o<=65535){if(i+2>=s)break;t[i++]=224|o>>12,t[i++]=128|o>>6&63,t[i++]=128|63&o}else if(o<=2097151){if(i+3>=s)break;t[i++]=240|o>>18,t[i++]=128|o>>12&63,t[i++]=128|o>>6&63,t[i++]=128|63&o}else if(o<=67108863){if(i+4>=s)break;t[i++]=248|o>>24,t[i++]=128|o>>18&63,t[i++]=128|o>>12&63,t[i++]=128|o>>6&63,t[i++]=128|63&o}else{if(i+5>=s)break;t[i++]=252|o>>30,t[i++]=128|o>>24&63,t[i++]=128|o>>18&63,t[i++]=128|o>>12&63,t[i++]=128|o>>6&63,t[i++]=128|63&o}}return t[i]=0,i-r}function h(e,t,i){return o(e,lt,t,i)}function l(e){for(var t=0,i=0;i<e.length;++i){var n=e.charCodeAt(i);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++i)),n<=127?++t:t+=n<=2047?2:n<=65535?3:n<=2097151?4:n<=67108863?5:6}return t}function c(e){return e}function d(e){var t=/__Z[\w\d_]+/g;return e.replace(t,function(e){var t=c(e);return e===t?e:e+" ["+t+"]"})}function u(){var e=new Error;if(!e.stack){try{throw new Error(0)}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}function f(){var e=u();return Ze.extraStackTrace&&(e+="\n"+Ze.extraStackTrace()),d(e)}function p(e,t){return e%t>0&&(e+=t-e%t),e}function _(e){Ze.buffer=ot=e}function m(){Ze.HEAP8=ht=new Int8Array(ot),Ze.HEAP16=ct=new Int16Array(ot),Ze.HEAP32=ut=new Int32Array(ot),Ze.HEAPU8=lt=new Uint8Array(ot),Ze.HEAPU16=dt=new Uint16Array(ot),Ze.HEAPU32=ft=new Uint32Array(ot),Ze.HEAPF32=pt=new Float32Array(ot),Ze.HEAPF64=_t=new Float64Array(ot)}function A(){Ae("Cannot enlarge memory arrays. Either (1) compile with  -s TOTAL_MEMORY=X  with X higher than the current value "+Ft+", (2) compile with  -s ALLOW_MEMORY_GROWTH=1  which allows increasing the size at runtime but prevents some optimizations, (3) set Module.TOTAL_MEMORY to a higher value before the program runs, or (4) if you want malloc to return NULL (0) instead of this abort, compile with  -s ABORTING_MALLOC=0 ")}function v(){var e=Ze.usingWasm?xt:Ot,t=2147483648-e;if(ut[Tt>>2]>t)return!1;var i=Ft;for(Ft=Math.max(Ft,kt);Ft<ut[Tt>>2];)Ft=Ft<=536870912?p(2*Ft,e):Math.min(p((3*Ft+2147483648)/4,e),t);var n=Ze.reallocBuffer(Ft);return n&&n.byteLength==Ft?(_(n),m(),!0):(Ft=i,!1)}function y(){return Ft}function g(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?Ze.dynCall_v(i):Ze.dynCall_vi(i,t.arg):i(void 0===t.arg?null:t.arg)}else t()}}function b(){if(Ze.preRun)for("function"==typeof Ze.preRun&&(Ze.preRun=[Ze.preRun]);Ze.preRun.length;)C(Ze.preRun.shift());g(Bt)}function E(){zt||(zt=!0,g(Vt))}function T(){g(Ut)}function S(){g(Gt),Ht=!0}function w(){if(Ze.postRun)for("function"==typeof Ze.postRun&&(Ze.postRun=[Ze.postRun]);Ze.postRun.length;)P(Ze.postRun.shift());g(Wt)}function C(e){Bt.unshift(e)}function M(e){Ut.unshift(e)}function P(e){Wt.unshift(e)}function I(e,t){ht.set(e,t)}function R(e){Kt++,Ze.monitorRunDependencies&&Ze.monitorRunDependencies(Kt)}function x(e){if(Kt--,Ze.monitorRunDependencies&&Ze.monitorRunDependencies(Kt),0==Kt&&(null!==Qt&&(clearInterval(Qt),Qt=null),Jt)){var t=Jt;Jt=null,t()}}function O(e){return xr(e)}function k(){return!!k.uncaught_exception}function D(e){var t=ei.infos[e];return t&&!t.caught&&(t.caught=!0,k.uncaught_exception--),t&&(t.rethrown=!1),ei.caught.push(e),ei.addRef(ei.deAdjust(e)),e}function L(){throw wt=!0,"Pure virtual function called!"}function N(e){throw ei.last||(ei.last=e),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function F(){var e=ei.last;if(!e)return 0|(St.setTempRet0(0),0);var t=ei.infos[e],i=t.type;if(!i)return 0|(St.setTempRet0(0),e);var n=Array.prototype.slice.call(arguments);Ze.___cxa_is_pointer_type(i);F.buffer||(F.buffer=xr(4)),ut[F.buffer>>2]=e,e=F.buffer;for(var r=0;r<n.length;r++)if(n[r]&&Ze.___cxa_can_catch(n[r],i,e))return e=ut[e>>2],t.adjusted=e,0|(St.setTempRet0(n[r]),e);return e=ut[e>>2],0|(St.setTempRet0(i),e)}function B(e,t,i){throw ei.infos[e]={ptr:e,adjusted:e,type:t,destructor:i,refcount:0,caught:!1,rethrown:!1},ei.last=e,"uncaught_exception"in k?k.uncaught_exception++:k.uncaught_exception=1,e+" - Exception catching is disabled, this exception cannot be caught. Compile with -s DISABLE_EXCEPTION_CATCHING=0 or DISABLE_EXCEPTION_CATCHING=2 to catch."}function V(){}function U(e,t){ii.varargs=t;try{var i=ii.getStreamFromFD(),n=(ii.get(),ii.get()),r=ii.get(),s=ii.get(),a=n;return FS.llseek(i,a,s),ut[r>>2]=i.position,i.getdents&&0===a&&0===s&&(i.getdents=null),0}catch(o){return"undefined"!=typeof FS&&o instanceof FS.ErrnoError||Ae(o),-o.errno}}function G(e,t){ii.varargs=t;try{var n=ii.get(),r=ii.get(),s=ii.get(),o=0;G.buffer||(G.buffers=[null,[],[]],G.printChar=function(e,t){var n=G.buffers[e];i(n),0===t||10===t?((1===e?Ze.print:Ze.printErr)(a(n,0)),n.length=0):n.push(t)});for(var h=0;h<s;h++){for(var l=ut[r+8*h>>2],c=ut[r+(8*h+4)>>2],d=0;d<c;d++)G.printChar(n,lt[l+d]);o+=c}return o}catch(u){return"undefined"!=typeof FS&&u instanceof FS.ErrnoError||Ae(u),-u.errno}}function W(e,t){ii.varargs=t;try{return 0}catch(i){return"undefined"!=typeof FS&&i instanceof FS.ErrnoError||Ae(i),-i.errno}}function z(e,t){ii.varargs=t;try{var i=ii.getStreamFromFD();return FS.close(i),0}catch(n){return"undefined"!=typeof FS&&n instanceof FS.ErrnoError||Ae(n),-n.errno}}function H(){Ze.abort()}function j(e,t,i){return lt.set(lt.subarray(t,t+i),e),e}function Y(e){return ni[e]||0}function X(e,t){return 0==e?si.EINVAL:(ut[e>>2]=ri,ni[ri]=0,ri++,0)}function Z(e,t){Z.seen||(Z.seen={}),e in Z.seen||(Ze.dynCall_v(t),Z.seen[e]=1)}function K(e,t){return e in ni?(ni[e]=t,0):si.EINVAL}function Q(e){return Ze.___errno_location&&(ut[Ze.___errno_location()>>2]=e),e}function J(e,t,i){var n=i>0?i:l(e)+1,r=new Array(n),s=o(e,r,0,r.length);return t&&(r.length=s),r}function q(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r>255&&(ai&&i(!1,"Character code "+r+" ("+String.fromCharCode(r)+")  at offset "+n+" not in 0x00-0xFF."),r&=255),t.push(String.fromCharCode(r))}return t.join("")}function $(e){if("boolean"==typeof tt&&tt){var t;try{t=Buffer.from(e,"base64")}catch(i){t=new Buffer(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var n=hi(e),r=new Uint8Array(n.length),s=0;s<n.length;++s)r[s]=n.charCodeAt(s);return r}catch(i){throw new Error("Converting base64 string to bytes failed.")}}function ee(e){var t="data:application/octet-stream;base64,";if(String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t))return $(e.slice(t.length))}function te(e,t){try{return Ze.dynCall_ii(e,t)}catch(i){if("number"!=typeof i&&"longjmp"!==i)throw i;Ze.setThrew(1,0)}}function ie(e,t,i){try{return Ze.dynCall_iii(e,t,i)}catch(n){if("number"!=typeof n&&"longjmp"!==n)throw n;Ze.setThrew(1,0)}}function ne(e,t,i,n){try{return Ze.dynCall_iiii(e,t,i,n)}catch(r){if("number"!=typeof r&&"longjmp"!==r)throw r;Ze.setThrew(1,0)}}function re(e,t,i,n,r,s,a){try{return Ze.dynCall_iiiiiii(e,t,i,n,r,s,a)}catch(o){if("number"!=typeof o&&"longjmp"!==o)throw o;Ze.setThrew(1,0)}}function se(e){try{Ze.dynCall_v(e)}catch(t){if("number"!=typeof t&&"longjmp"!==t)throw t;Ze.setThrew(1,0)}}function ae(e,t){try{Ze.dynCall_vi(e,t)}catch(i){if("number"!=typeof i&&"longjmp"!==i)throw i;Ze.setThrew(1,0)}}function oe(e,t,i){try{Ze.dynCall_vii(e,t,i)}catch(n){if("number"!=typeof n&&"longjmp"!==n)throw n;Ze.setThrew(1,0)}}function he(e,t,i,n){try{Ze.dynCall_viii(e,t,i,n)}catch(r){if("number"!=typeof r&&"longjmp"!==r)throw r;Ze.setThrew(1,0)}}function le(e,t,i,n,r){try{Ze.dynCall_viiii(e,t,i,n,r)}catch(s){if("number"!=typeof s&&"longjmp"!==s)throw s;Ze.setThrew(1,0)}}function ce(e,t,i,n,r,s){try{Ze.dynCall_viiiii(e,t,i,n,r,s)}catch(a){if("number"!=typeof a&&"longjmp"!==a)throw a;Ze.setThrew(1,0)}}function de(e,t,i,n,r,s,a){try{Ze.dynCall_viiiiii(e,t,i,n,r,s,a)}catch(o){if("number"!=typeof o&&"longjmp"!==o)throw o;Ze.setThrew(1,0)}}function ue(){Ze.readAsync(qt,kr,function(){throw"could not load memory initializer "+qt})}function fe(){var e=Ze.memoryInitializerRequest,t=e.response;if(200!==e.status&&0!==e.status){var i=ee(Ze.memoryInitializerRequestURL);if(!i)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+qt),void ue();t=i.buffer}kr(t)}function pe(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function _e(e){function t(){Ze.calledRun||(Ze.calledRun=!0,wt||(E(),T(),Ze.onRuntimeInitialized&&Ze.onRuntimeInitialized(),w()))}e=e||Ze.arguments,null===Nr&&(Nr=Date.now()),Kt>0||(b(),Kt>0||Ze.calledRun||(Ze.setStatus?(Ze.setStatus("Running..."),setTimeout(function(){setTimeout(function(){Ze.setStatus("")},1),t()},1)):t()))}function me(e,t){t&&Ze.noExitRuntime||(Ze.noExitRuntime||(wt=!0,Ct=e,gt=Lr,S(),Ze.onExit&&Ze.onExit(e)),tt&&process.exit(e),Ze.quit(e,new pe(e)))}function Ae(e){Ze.onAbort&&Ze.onAbort(e),void 0!==e?(Ze.print(e),Ze.printErr(e),e=JSON.stringify(e)):e="",wt=!0,Ct=1;var t="\nIf this abort() is unexpected, build with -s ASSERTIONS=1 which can give more information.",i="abort("+e+") at "+f()+t;throw Fr&&Fr.forEach(function(t){i=t(i,e)}),i}function ve(){}function ye(e){return(e||ve).__cache__}function ge(e,t){var i=ye(t),n=i[e];return n?n:(n=Object.create((t||ve).prototype),n.ptr=e,i[e]=n)}function be(e,t){return ge(e.ptr,t)}function Ee(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete ye(e.__class__)[e.ptr]}function Te(e,t){return e.ptr===t.ptr}function Se(e){return e.ptr}function we(e){return e.__class__}function Ce(e){if("string"==typeof e){var t=J(e),i=Br.alloc(t,ht);return Br.copy(t,ht,i),i}return e}function Me(e){if("object"==typeof e){var t=Br.alloc(e,ht);return Br.copy(e,ht,t),t}return e}function Pe(){throw"cannot construct a Status, no constructor in IDL"}function Ie(){this.ptr=fn(),ye(Ie)[this.ptr]=this}function Re(){this.ptr=ir(),ye(Re)[this.ptr]=this}function xe(){this.ptr=bn(),ye(xe)[this.ptr]=this}function Oe(){this.ptr=An(),ye(Oe)[this.ptr]=this}function ke(){this.ptr=ci(),ye(ke)[this.ptr]=this}function De(){this.ptr=Yn(),ye(De)[this.ptr]=this}function Le(){this.ptr=gi(),ye(Le)[this.ptr]=this}function Ne(){this.ptr=pi(),ye(Ne)[this.ptr]=this}function Fe(){this.ptr=ln(),ye(Fe)[this.ptr]=this}function Be(){this.ptr=Un(),ye(Be)[this.ptr]=this}function Ve(){this.ptr=en(),ye(Ve)[this.ptr]=this}function Ue(){this.ptr=Qi(),ye(Ue)[this.ptr]=this}function Ge(){this.ptr=wn(),ye(Ge)[this.ptr]=this}function We(){this.ptr=Ti(),ye(We)[this.ptr]=this}function ze(){this.ptr=Pi(),ye(ze)[this.ptr]=this}function He(){this.ptr=Mn(),ye(He)[this.ptr]=this}function je(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Ye(){this.ptr=sn(),ye(Ye)[this.ptr]=this}function Xe(){this.ptr=zn(),ye(Xe)[this.ptr]=this}e=e||{};var Ze=e,Ke=!1,Qe=!1;Ze.onRuntimeInitialized=function(){Ke=!0,Qe&&"function"==typeof Ze.onModuleLoaded&&Ze.onModuleLoaded(Ze)},Ze.onModuleParsed=function(){Qe=!0,Ke&&"function"==typeof Ze.onModuleLoaded&&Ze.onModuleLoaded(Ze)},Ze.isVersionSupported=t;var Ze;Ze||(Ze=("undefined"!=typeof e?e:null)||{});var Je,qe={};for(Je in Ze)Ze.hasOwnProperty(Je)&&(qe[Je]=Ze[Je]);var $e=!1,et=!1,tt=!1,it=!1;if(Ze.ENVIRONMENT)if("WEB"===Ze.ENVIRONMENT)$e=!0;else if("WORKER"===Ze.ENVIRONMENT)et=!0;else if("NODE"===Ze.ENVIRONMENT)tt=!0;else{if("SHELL"!==Ze.ENVIRONMENT)throw new Error("The provided Module['ENVIRONMENT'] value is not valid. It must be one of: WEB|WORKER|NODE|SHELL.");it=!0}else $e="object"==typeof window,et="function"==typeof importScripts,tt="object"==typeof process&&"function"==typeof require&&!$e&&!et,it=!$e&&!tt&&!et;if(tt){Ze.print||(Ze.print=console.log),Ze.printErr||(Ze.printErr=console.warn);var nt,rt;Ze.read=function(e,t){var i;return i=ee(e),i||(nt||(nt=require("fs")),rt||(rt=require("path")),e=rt.normalize(e),i=nt.readFileSync(e)),t?i:i.toString()},Ze.readBinary=function(e){var t=Ze.read(e,!0);return t.buffer||(t=new Uint8Array(t)),i(t.buffer),t},Ze.thisProgram||(process.argv.length>1?Ze.thisProgram=process.argv[1].replace(/\\/g,"/"):Ze.thisProgram="unknown-program"),Ze.arguments=process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof pe))throw e}),Ze.inspect=function(){return"[Emscripten Module object]"}}else if(it)Ze.print||(Ze.print=print),"undefined"!=typeof printErr&&(Ze.printErr=printErr),"undefined"!=typeof read?Ze.read=function(e){var t=ee(e);return t?q(t):read(e)}:Ze.read=function(){throw"no read() available"},Ze.readBinary=function(e){var t;return(t=ee(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(t=read(e,"binary"),i("object"==typeof t),t)},"undefined"!=typeof scriptArgs?Ze.arguments=scriptArgs:"undefined"!=typeof arguments&&(Ze.arguments=arguments),"function"==typeof quit&&(Ze.quit=function(e,t){quit(e)});else{if(!$e&&!et)throw new Error("Unknown runtime environment. Where are we?");if(Ze.read=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(i){var n=ee(e);if(n)return q(n);throw i}},et&&(Ze.readBinary=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(i){var n=ee(e);if(n)return n;throw i}}),Ze.readAsync=function(e,t,i){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){if(200==n.status||0==n.status&&n.response)return void t(n.response);var r=ee(e);return r?void t(r.buffer):void i()},n.onerror=i,n.send(null)},"undefined"!=typeof arguments&&(Ze.arguments=arguments),"undefined"!=typeof console)Ze.print||(Ze.print=function(e){console.log(e)}),Ze.printErr||(Ze.printErr=function(e){console.warn(e)});else{var st=!1;Ze.print||(Ze.print=st&&"undefined"!=typeof dump?function(e){dump(e)}:function(e){})}"undefined"==typeof Ze.setWindowTitle&&(Ze.setWindowTitle=function(e){document.title=e})}Ze.print||(Ze.print=function(){}),Ze.printErr||(Ze.printErr=Ze.print),Ze.arguments||(Ze.arguments=[]),Ze.thisProgram||(Ze.thisProgram="./this.program"),Ze.quit||(Ze.quit=function(e,t){throw t}),Ze.print=Ze.print,Ze.printErr=Ze.printErr,Ze.preRun=[],Ze.postRun=[];for(Je in qe)qe.hasOwnProperty(Je)&&(Ze[Je]=qe[Je]);qe=void 0;var at,ot,ht,lt,ct,dt,ut,ft,pt,_t,mt,At,vt,yt,gt,bt,Et,Tt,St={setTempRet0:function(e){return tempRet0=e,e},getTempRet0:function(){return tempRet0},stackSave:function(){return gt},stackRestore:function(e){gt=e},getNativeTypeSize:function(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return St.QUANTUM_SIZE;if("i"===e[0]){var t=parseInt(e.substr(1));return i(t%8===0),t/8}return 0}},getNativeFieldSize:function(e){return Math.max(St.getNativeTypeSize(e),St.QUANTUM_SIZE)},STACK_ALIGN:16,prepVararg:function(e,t){return"double"===t||"i64"===t?7&e&&(i(4===(7&e)),e+=4):i(0===(3&e)),e},getAlignSize:function(e,t,i){return i||"i64"!=e&&"double"!=e?e?Math.min(t||(e?St.getNativeFieldSize(e):0),St.QUANTUM_SIZE):Math.min(t,8):8},dynCall:function(e,t,i){return i&&i.length?Ze["dynCall_"+e].apply(null,[t].concat(i)):Ze["dynCall_"+e].call(null,t)},functionPointers:[],addFunction:function(e){for(var t=0;t<St.functionPointers.length;t++)if(!St.functionPointers[t])return St.functionPointers[t]=e,2*(1+t);throw"Finished up all reserved function pointers. Use a higher value for RESERVED_FUNCTION_POINTERS."},removeFunction:function(e){St.functionPointers[(e-2)/2]=null},warnOnce:function(e){St.warnOnce.shown||(St.warnOnce.shown={}),St.warnOnce.shown[e]||(St.warnOnce.shown[e]=1,Ze.printErr(e))},funcWrappers:{},getFuncWrapper:function(e,t){if(e){i(t),St.funcWrappers[t]||(St.funcWrappers[t]={});var n=St.funcWrappers[t];return n[e]||(1===t.length?n[e]=function(){return St.dynCall(t,e)}:2===t.length?n[e]=function(i){return St.dynCall(t,e,[i])}:n[e]=function(){return St.dynCall(t,e,Array.prototype.slice.call(arguments))}),n[e]}},getCompilerSetting:function(e){throw"You must build with -s RETAIN_COMPILER_SETTINGS=1 for Runtime.getCompilerSetting or emscripten_get_compiler_setting to work"},stackAlloc:function(e){var t=gt;return gt=gt+e|0,gt=gt+15&-16,t},staticAlloc:function(e){var t=At;return At=At+e|0,At=At+15&-16,t},dynamicAlloc:function(e){var t=ut[Tt>>2],i=(t+e+15|0)&-16;if(ut[Tt>>2]=i,i>=Ft){var n=v();if(!n)return ut[Tt>>2]=t,0}return t},alignMemory:function(e,t){var i=e=Math.ceil(e/(t?t:16))*(t?t:16);return i},makeBigInt:function(e,t,i){var n=i?+(e>>>0)+4294967296*+(t>>>0):+(e>>>0)+4294967296*+(0|t);return n},GLOBAL_BASE:8,QUANTUM_SIZE:4,__dummy__:0},wt=0,Ct=0,Mt={stackSave:function(){St.stackSave()},stackRestore:function(){St.stackRestore()},arrayToC:function(e){var t=St.stackAlloc(e.length);return I(e,t),t},stringToC:function(e){var t=0;if(null!==e&&void 0!==e&&0!==e){var i=(e.length<<2)+1;t=St.stackAlloc(i),h(e,t,i)}return t}},Pt=({string:Mt.stringToC,array:Mt.arrayToC},2),It=4,Rt="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,xt=("undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0,65536),Ot=16777216,kt=16777216;mt=At=yt=gt=bt=Et=Tt=0,vt=!1,Ze.reallocBuffer||(Ze.reallocBuffer=function(e){var t;try{if(ArrayBuffer.transfer)t=ArrayBuffer.transfer(ot,e);else{var i=ht;t=new ArrayBuffer(e);var n=new Int8Array(t);n.set(i)}}catch(r){return!1}var s=Rr(t);return!!s&&t});var Dt;try{Dt=Function.prototype.call.bind(Object.getOwnPropertyDescriptor(ArrayBuffer.prototype,"byteLength").get),Dt(new ArrayBuffer(4))}catch(Lt){Dt=function(e){return e.byteLength}}var Nt=Ze.TOTAL_STACK||5242880,Ft=Ze.TOTAL_MEMORY||16777216;if(Ft<Nt&&Ze.printErr("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+Ft+"! (TOTAL_STACK="+Nt+")"),ot=Ze.buffer?Ze.buffer:new ArrayBuffer(Ft),m(),ut[0]=1668509029,ct[1]=25459,115!==lt[2]||99!==lt[3])throw"Runtime error: expected the system to be little-endian!";Ze.HEAP=at,Ze.buffer=ot,Ze.HEAP8=ht,Ze.HEAP16=ct,Ze.HEAP32=ut,Ze.HEAPU8=lt,Ze.HEAPU16=dt,Ze.HEAPU32=ft,Ze.HEAPF32=pt,Ze.HEAPF64=_t;var Bt=[],Vt=[],Ut=[],Gt=[],Wt=[],zt=!1,Ht=!1;i(Math.imul&&Math.fround&&Math.clz32&&Math.trunc,"this is a legacy browser, build with LEGACY_VM_SUPPORT");var jt=Math.abs,Yt=(Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.atan2,Math.exp,Math.log,Math.sqrt,Math.ceil),Xt=Math.floor,Zt=(Math.pow,Math.imul,Math.fround,Math.round,Math.min),Kt=(Math.clz32,Math.trunc,0),Qt=null,Jt=null;Ze.preloadedImages={},Ze.preloadedAudios={};var qt=null;mt=St.GLOBAL_BASE,At=mt+18080,Vt.push(),qt="data:application/octet-stream;base64,UBIAAJgSAAAYAAAAAAAAACgSAAC/EgAAUBIAANwSAAAYAAAAAAAAAFASAAAFEwAAQAAAAAAAAAAoEgAAIRMAAFASAAC1EwAAMAAAAAAAAAAoEgAA1xMAAFASAAD8EwAAMAAAAAAAAABQEgAAkSAAAFgAAAAAAAAAUBIAACwUAACQAAAAAAAAAFASAACFFAAAoAAAAAAAAABQEgAA2RQAALAAAAAAAAAAUBIAAA0VAADAAAAAAAAAACgSAAA4FQAAUBIAAFwVAADYAAAAAAAAACgSAAD6FQAAUBIAAJgWAADwAAAAAAAAAFASAAAwFwAAkAAAAAAAAABQEgAAuRcAAPAAAAAAAAAAUBIAAFMYAADwAAAAAAAAAFASAADlGAAA8AAAAAAAAABQEgAAixkAAPAAAAAAAAAAUBIAACYaAADwAAAAAAAAAFASAAC8GgAAYAEAAAAAAAAoEgAAZxsAAFASAAASHAAAeAEAAAAAAABQEgAAtxwAAJAAAAAAAAAAUBIAAE0dAAB4AQAAAAAAAFASAAD0HQAAeAEAAAAAAABQEgAAkx4AAHgBAAAAAAAAUBIAAEYfAAB4AQAAAAAAAFASAADuHwAAeAEAAAAAAABQEgAAUS0AAHAAAAAAAAAAUBIAAL0gAAD4AQAAAAAAAFASAAAuIQAAoAAAAAAAAABQEgAAmiEAABgCAAAAAAAAKBIAAFAiAABQEgAABiMAADACAAAAAAAAUBIAALYjAAD4AQAAAAAAAFASAABXJAAAUAIAAAAAAAAoEgAAGiUAAFASAADdJQAAaAIAAAAAAABQEgAAmiYAAPgBAAAAAAAAUBIAAEgnAACIAgAAAAAAAFASAACsJwAAoAAAAAAAAABQEgAACygAAKgCAAAAAAAAKBIAALQoAABQEgAAXSkAAMACAAAAAAAAUBIAAAAqAACIAgAAAAAAAFASAACUKgAA4AIAAAAAAAAoEgAASisAAFASAAAALAAA+AIAAAAAAABQEgAAsCwAAIgCAAAAAAAAUBIAAHwtAABwAAAAAAAAAFASAAAULgAA2AMAAAAAAABQEgAAKi4AABgDAAAAAAAAUBIAABgxAACQAwAAAAAAACgSAABLLgAAUBIAAJMuAABgAwAAAAAAACgSAABdLwAAKBIAAHcvAABQEgAAsi8AAGADAAAAAAAAUBIAAFswAABgAwAAAAAAACgSAABkMQAAUBIAAJIxAACQAwAAAAAAAFASAADoMQAAkAMAAAAAAABQEgAAVTIAABgDAAAAAAAAUBIAADsyAABgAwAAAAAAACgSAAB1MgAAUBIAAKgzAADYAwAAAAAAAFASAADKMwAA2AMAAAAAAABQEgAA8DMAABAEAAAAAAAAKBIAAP4zAAAoEgAAoj4AAFASAAACPwAAMAQAAAAAAABQEgAArz4AAEAEAAAAAAAAKBIAANA+AABQEgAA3T4AACAEAAAAAAAAUBIAAOQ/AAAYBAAAAAAAAFASAAD0PwAAWAQAAAAAAABQEgAAKUAAADAEAAAAAAAAUBIAAAVAAAB4BAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAACAAAAAEAAAACAAAAAQAAAAEAAAABAAAAAAAAACAAAAADAAAABAAAAAIAAAACAAAAAgAAAAAAAAAwAAAABQAAAAYAAAABAAAAAwAAAAQAAAAFAAAAAwAAAAQAAAAGAAAAAQAAAAcAAAAFAAAAAAAAAEgAAAAHAAAACAAAAAEAAAADAAAABAAAAAUAAAADAAAABAAAAAYAAAAIAAAACQAAAAYAAAAAAAAAWAAAAAkAAAAKAAAAAgAAAAoAAAADAAAABAAAAAsAAAAMAAAABQAAAP////8AAAAAYAAAAAsAAAAMAAAAAQAAAA0AAAAOAAAABQAAAAMAAAAEAAAADwAAABAAAAARAAAABwAAAAEAAAAAAAAAcAAAAA0AAAAOAAAABgAAAAoAAAADAAAABAAAABIAAAAMAAAABwAAAAgAAAABAAAACAAAABMAAAAAAAAAkAAAAA8AAAAQAAAAAQAAAAkAAAABAAAACgAAABQAAAAVAAAACwAAAAwAAAAWAAAAAQAAAAAAAACAAAAADwAAABEAAAANAAAACQAAAA4AAAAKAAAAFAAAABUAAAALAAAADAAAABYAAAABAAAAAAAAAEABAAAPAAAAEgAAAA8AAAAJAAAAEAAAAAoAAAAUAAAAFQAAAAsAAAAMAAAAFgAAAAIAAAAAAAAAMAEAAA8AAAATAAAAEQAAAAkAAAASAAAACgAAABQAAAAVAAAACwAAAAwAAAAWAAAAAwAAAAAAAAAgAQAAFAAAABUAAAATAAAACQAAABQAAAAKAAAAFAAAABUAAAALAAAADAAAABcAAAAEAAAAAAAAABABAAAWAAAAFwAAABUAAAAJAAAAFgAAABcAAAAYAAAAGQAAAAsAAAAMAAAAGgAAAAUAAAAAAAAAAAEAABgAAAAZAAAAGAAAAAkAAAAZAAAAGgAAABsAAAAcAAAACwAAAAwAAAAdAAAABgAAAAAAAADgAAAAGgAAABsAAAAbAAAACQAAABwAAAAdAAAAHgAAAB8AAAALAAAADAAAACAAAAAHAAAAAAAAAMgAAAAcAAAAHQAAACEAAAAeAAAAAgAAAAAAAADIAQAADwAAAB4AAAAfAAAACQAAACAAAAAKAAAAFAAAABUAAAALAAAADAAAABYAAAAIAAAAAAAAALgBAAAPAAAAHwAAACEAAAAJAAAAIgAAAAoAAAAUAAAAFQAAAAsAAAAMAAAAFgAAAAkAAAAAAAAAqAEAACAAAAAhAAAAIwAAAAkAAAAkAAAACgAAABQAAAAVAAAACwAAAAwAAAAiAAAACgAAAAAAAACYAQAAIgAAACMAAAAlAAAACQAAACYAAAAnAAAAIwAAACQAAAALAAAADAAAACUAAAALAAAAAAAAAIgBAAAkAAAAJQAAACgAAAAJAAAAKQAAACoAAAAmAAAAJwAAAAsAAAAMAAAAKAAAAAwAAAAAAAAAaAEAACYAAAAnAAAAKwAAAAkAAAAsAAAALQAAACkAAAAqAAAACwAAAAwAAAArAAAADQAAAAAAAABQAQAAKAAAACkAAAAsAAAALgAAAAMAAAAAAAAA2AEAAA0AAAAqAAAACQAAAAoAAAADAAAACgAAABIAAAAMAAAABwAAAAsAAAACAAAALwAAAC0AAAAAAAAAeAIAACsAAAAsAAAAMAAAADEAAAAyAAAAMwAAAC4AAAAvAAAANAAAADUAAAAwAAAADgAAAAAAAADoAQAAKwAAAC0AAAA2AAAANwAAADgAAAA5AAAAMQAAADIAAAA6AAAAOwAAADMAAAAPAAAAAAAAAFgCAAAuAAAALwAAADwAAAA3AAAAPQAAAD4AAAA0AAAANQAAADoAAAA7AAAANgAAABAAAAAAAAAAQAIAADAAAAAxAAAANwAAAD8AAAAEAAAAAAAAACACAAAyAAAAMwAAAEAAAAA3AAAAQQAAAEIAAAA4AAAAOQAAADoAAAA7AAAAOgAAABEAAAAAAAAACAIAADQAAAA1AAAAOwAAAEMAAAAFAAAAAAAAAOgCAAA2AAAANwAAAEQAAAAxAAAARQAAAEYAAAA8AAAAPQAAADQAAAA1AAAAPgAAABIAAAAAAAAA0AIAADgAAAA5AAAAPwAAAEcAAAAGAAAAAAAAALACAAA6AAAAOwAAAEgAAAAxAAAASQAAAEoAAABAAAAAQQAAADQAAAA1AAAAQgAAABMAAAAAAAAAmAIAADwAAAA9AAAAQwAAAEsAAAAHAAAAAAAAAAgDAAA+AAAAPwAAAAwAAAAKAAAAAwAAAA0AAAASAAAADAAAAAcAAAAOAAAAAQAAAAgAAABEAAAATAAAAEUAAAAAAAAAGAMAAEAAAABBAAAATQAAAE4AAAABAAAATwAAAFAAAABRAAAAUgAAAFMAAABGAAAARwAAAAEAAAAAAAAAKAMAAEIAAABDAAAATQAAAFQAAABIAAAATwAAAFAAAABRAAAAVQAAAFYAAABJAAAASgAAAFcAAAAAAAAAOAMAAEQAAABFAAAASwAAAEwAAABNAAAATgAAAFgAAABZAAAAWgAAAFsAAAD/////AAAAAFADAABGAAAARwAAAE8AAABcAAAAAAAAAEgDAABIAAAASQAAAEoAAAD/////AAAAAHADAABLAAAATAAAAFAAAABdAAAAAAAAAGgDAABNAAAATgAAAE8AAAAAAAAAgAMAAFAAAABRAAAAUQAAAF4AAAAAAAAAmAMAAFIAAABTAAAAUgAAAFMAAABUAAAAVQAAAF8AAABgAAAAYQAAAGIAAAAAAAAAqAMAAFQAAABVAAAAVgAAAFcAAABYAAAAWQAAAGMAAABkAAAAZQAAAGYAAAAAAAAAAQAAAAMAAAAFAAAABwAAAAAAAAC4AwAAQAAAAFYAAABNAAAATgAAAFoAAABPAAAAUAAAAFEAAABSAAAAUwAAAEYAAABHAAAAZwAAAAAAAADIAwAAVwAAAFgAAABbAAAAaAAAAAAAAADYAwAAQAAAAFkAAABpAAAATgAAAAEAAABqAAAAUAAAAFEAAABSAAAAAAAAAOADAABAAAAAWgAAAGkAAABOAAAAXAAAAGsAAABQAAAAUQAAAFIAAAAAAAAA8AMAAEAAAABbAAAAaQAAAE4AAABdAAAAbAAAAFAAAABRAAAAUgAAAP//////////AAAAAAAEAABcAAAAXQAAAAgAAAADAAAA/////wAAAAAQBAAAXgAAAF8AAAAJAAAABAAAACwOAAAFAAAAAAAAAAAAAABtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPAAAAEAAAAJRCAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAD//////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKAPAAAFAAAAAAAAAAAAAABtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAEAAAAJxCAAAABAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAK/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAwAAAAUAAAAHAAAACwAAAA0AAAARAAAAEwAAABcAAAAdAAAAHwAAACUAAAApAAAAKwAAAC8AAAA1AAAAOwAAAD0AAABDAAAARwAAAEkAAABPAAAAUwAAAFkAAABhAAAAZQAAAGcAAABrAAAAbQAAAHEAAAB/AAAAgwAAAIkAAACLAAAAlQAAAJcAAACdAAAAowAAAKcAAACtAAAAswAAALUAAAC/AAAAwQAAAMUAAADHAAAA0wAAAAEAAAALAAAADQAAABEAAAATAAAAFwAAAB0AAAAfAAAAJQAAACkAAAArAAAALwAAADUAAAA7AAAAPQAAAEMAAABHAAAASQAAAE8AAABTAAAAWQAAAGEAAABlAAAAZwAAAGsAAABtAAAAcQAAAHkAAAB/AAAAgwAAAIkAAACLAAAAjwAAAJUAAACXAAAAnQAAAKMAAACnAAAAqQAAAK0AAACzAAAAtQAAALsAAAC/AAAAwQAAAMUAAADHAAAA0QAAAAIAAACZPgAAAAAAACAEAABgAAAAYQAAAGIAAABjAAAAEwAAAAEAAAABAAAAAwAAAAAAAABIBAAAYAAAAGQAAABiAAAAYwAAABMAAAACAAAAAgAAAAQAAAAAAAAAWAQAAGUAAABmAAAAbgAAAAAAAABoBAAAZQAAAGcAAABuAAAATjVkcmFjbzI4QXR0cmlidXRlT2N0YWhlZHJvblRyYW5zZm9ybUUATjVkcmFjbzE4QXR0cmlidXRlVHJhbnNmb3JtRQBONWRyYWNvMzBBdHRyaWJ1dGVRdWFudGl6YXRpb25UcmFuc2Zvcm1FAE41ZHJhY28xN0F0dHJpYnV0ZXNEZWNvZGVyRQBONWRyYWNvMjZBdHRyaWJ1dGVzRGVjb2RlckludGVyZmFjZUUAS2RUcmVlQXR0cmlidXRlc0RlY29kZXI6IGNvbXByZXNzaW9uIGxldmVsICVpIG5vdCBzdXBwb3J0ZWQuCgBNZXRob2Qgbm90IHN1cHBvcnRlZC4gCgBWZXJzaW9uIG5vdCBzdXBwb3J0ZWQuIAoATjVkcmFjbzIzS2RUcmVlQXR0cmlidXRlc0RlY29kZXJFAE41ZHJhY28yNlNlcXVlbnRpYWxBdHRyaWJ1dGVEZWNvZGVyRQBONWRyYWNvMzdTZXF1ZW50aWFsQXR0cmlidXRlRGVjb2RlcnNDb250cm9sbGVyRQBONWRyYWNvMjhQcmVkaWN0aW9uU2NoZW1lRGVsdGFEZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRUVFAE41ZHJhY28yM1ByZWRpY3Rpb25TY2hlbWVEZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRUVFAE41ZHJhY28zN1ByZWRpY3Rpb25TY2hlbWVUeXBlZERlY29kZXJJbnRlcmZhY2VJaWlFRQBONWRyYWNvMzJQcmVkaWN0aW9uU2NoZW1lRGVjb2RlckludGVyZmFjZUUATjVkcmFjbzI1UHJlZGljdGlvblNjaGVtZUludGVyZmFjZUUATjVkcmFjbzQ4TWVzaFByZWRpY3Rpb25TY2hlbWVHZW9tZXRyaWNOb3JtYWxQcmVkaWN0b3JBcmVhSWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckJhc2VJaU5TXzM3UHJlZGljdGlvblNjaGVtZVdyYXBEZWNvZGluZ1RyYW5zZm9ybUlpaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMTFDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280Mk1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18xMUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzI3TWVzaFByZWRpY3Rpb25TY2hlbWVEZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDRNZXNoUHJlZGljdGlvblNjaGVtZVRleENvb3Jkc1BvcnRhYmxlRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18xMUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzM2TWVzaFByZWRpY3Rpb25TY2hlbWVUZXhDb29yZHNEZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNTZNZXNoUHJlZGljdGlvblNjaGVtZUNvbnN0cmFpbmVkTXVsdGlQYXJhbGxlbG9ncmFtRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18xMUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQ1TWVzaFByZWRpY3Rpb25TY2hlbWVNdWx0aVBhcmFsbGVsb2dyYW1EZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDBNZXNoUHJlZGljdGlvblNjaGVtZVBhcmFsbGVsb2dyYW1EZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckFyZWFJaU5TXzM3UHJlZGljdGlvblNjaGVtZVdyYXBEZWNvZGluZ1RyYW5zZm9ybUlpaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMjRNZXNoQXR0cmlidXRlQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckJhc2VJaU5TXzM3UHJlZGljdGlvblNjaGVtZVdyYXBEZWNvZGluZ1RyYW5zZm9ybUlpaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMjRNZXNoQXR0cmlidXRlQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDJNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbERlY29kZXJJaU5TXzM3UHJlZGljdGlvblNjaGVtZVdyYXBEZWNvZGluZ1RyYW5zZm9ybUlpaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMjRNZXNoQXR0cmlidXRlQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvMjdNZXNoUHJlZGljdGlvblNjaGVtZURlY29kZXJJaU5TXzM3UHJlZGljdGlvblNjaGVtZVdyYXBEZWNvZGluZ1RyYW5zZm9ybUlpaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMjRNZXNoQXR0cmlidXRlQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDRNZXNoUHJlZGljdGlvblNjaGVtZVRleENvb3Jkc1BvcnRhYmxlRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28zNk1lc2hQcmVkaWN0aW9uU2NoZW1lVGV4Q29vcmRzRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY281Nk1lc2hQcmVkaWN0aW9uU2NoZW1lQ29uc3RyYWluZWRNdWx0aVBhcmFsbGVsb2dyYW1EZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzI0TWVzaEF0dHJpYnV0ZUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQ1TWVzaFByZWRpY3Rpb25TY2hlbWVNdWx0aVBhcmFsbGVsb2dyYW1EZWNvZGVySWlOU18zN1ByZWRpY3Rpb25TY2hlbWVXcmFwRGVjb2RpbmdUcmFuc2Zvcm1JaWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzI0TWVzaEF0dHJpYnV0ZUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQwTWVzaFByZWRpY3Rpb25TY2hlbWVQYXJhbGxlbG9ncmFtRGVjb2RlcklpTlNfMzdQcmVkaWN0aW9uU2NoZW1lV3JhcERlY29kaW5nVHJhbnNmb3JtSWlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28zM1NlcXVlbnRpYWxJbnRlZ2VyQXR0cmlidXRlRGVjb2RlckUATjVkcmFjbzI4UHJlZGljdGlvblNjaGVtZURlbHRhRGVjb2RlcklpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVFRQBONWRyYWNvMjNQcmVkaWN0aW9uU2NoZW1lRGVjb2RlcklpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckFyZWFJaU5TXzYyUHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25DYW5vbmljYWxpemVkRGVjb2RpbmdUcmFuc2Zvcm1JaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMTFDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280OE1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsUHJlZGljdG9yQmFzZUlpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18xMUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQyTWVzaFByZWRpY3Rpb25TY2hlbWVHZW9tZXRyaWNOb3JtYWxEZWNvZGVySWlOU182MlByZWRpY3Rpb25TY2hlbWVOb3JtYWxPY3RhaGVkcm9uQ2Fub25pY2FsaXplZERlY29kaW5nVHJhbnNmb3JtSWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvMjdNZXNoUHJlZGljdGlvblNjaGVtZURlY29kZXJJaU5TXzYyUHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25DYW5vbmljYWxpemVkRGVjb2RpbmdUcmFuc2Zvcm1JaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMTFDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280OE1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsUHJlZGljdG9yQXJlYUlpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280OE1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsUHJlZGljdG9yQmFzZUlpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280Mk1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsRGVjb2RlcklpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28yN01lc2hQcmVkaWN0aW9uU2NoZW1lRGVjb2RlcklpTlNfNjJQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkNhbm9uaWNhbGl6ZWREZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28yOFByZWRpY3Rpb25TY2hlbWVEZWx0YURlY29kZXJJaU5TXzQ5UHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25EZWNvZGluZ1RyYW5zZm9ybUlpRUVFRQBONWRyYWNvMjNQcmVkaWN0aW9uU2NoZW1lRGVjb2RlcklpTlNfNDlQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkRlY29kaW5nVHJhbnNmb3JtSWlFRUVFAE41ZHJhY280OE1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsUHJlZGljdG9yQXJlYUlpTlNfNDlQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkRlY29kaW5nVHJhbnNmb3JtSWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckJhc2VJaU5TXzQ5UHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25EZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18xMUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQyTWVzaFByZWRpY3Rpb25TY2hlbWVHZW9tZXRyaWNOb3JtYWxEZWNvZGVySWlOU180OVByZWRpY3Rpb25TY2hlbWVOb3JtYWxPY3RhaGVkcm9uRGVjb2RpbmdUcmFuc2Zvcm1JaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMTFDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28yN01lc2hQcmVkaWN0aW9uU2NoZW1lRGVjb2RlcklpTlNfNDlQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkRlY29kaW5nVHJhbnNmb3JtSWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzExQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvNDhNZXNoUHJlZGljdGlvblNjaGVtZUdlb21ldHJpY05vcm1hbFByZWRpY3RvckFyZWFJaU5TXzQ5UHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25EZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY280OE1lc2hQcmVkaWN0aW9uU2NoZW1lR2VvbWV0cmljTm9ybWFsUHJlZGljdG9yQmFzZUlpTlNfNDlQcmVkaWN0aW9uU2NoZW1lTm9ybWFsT2N0YWhlZHJvbkRlY29kaW5nVHJhbnNmb3JtSWlFRU5TXzI0TWVzaFByZWRpY3Rpb25TY2hlbWVEYXRhSU5TXzI0TWVzaEF0dHJpYnV0ZUNvcm5lclRhYmxlRUVFRUUATjVkcmFjbzQyTWVzaFByZWRpY3Rpb25TY2hlbWVHZW9tZXRyaWNOb3JtYWxEZWNvZGVySWlOU180OVByZWRpY3Rpb25TY2hlbWVOb3JtYWxPY3RhaGVkcm9uRGVjb2RpbmdUcmFuc2Zvcm1JaUVFTlNfMjRNZXNoUHJlZGljdGlvblNjaGVtZURhdGFJTlNfMjRNZXNoQXR0cmlidXRlQ29ybmVyVGFibGVFRUVFRQBONWRyYWNvMjdNZXNoUHJlZGljdGlvblNjaGVtZURlY29kZXJJaU5TXzQ5UHJlZGljdGlvblNjaGVtZU5vcm1hbE9jdGFoZWRyb25EZWNvZGluZ1RyYW5zZm9ybUlpRUVOU18yNE1lc2hQcmVkaWN0aW9uU2NoZW1lRGF0YUlOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRUVFAE41ZHJhY28zMlNlcXVlbnRpYWxOb3JtYWxBdHRyaWJ1dGVEZWNvZGVyRQBONWRyYWNvMzhTZXF1ZW50aWFsUXVhbnRpemF0aW9uQXR0cmlidXRlRGVjb2RlckUAVW5zdXBwb3J0ZWQgZW5jb2RpbmcgbWV0aG9kLgBJbnB1dCBpcyBub3QgYSBtZXNoLgBJbnB1dCBpcyBub3QgYSBwb2ludCBjbG91ZC4Ac2tpcF9hdHRyaWJ1dGVfdHJhbnNmb3JtAE41ZHJhY28xMU1lc2hEZWNvZGVyRQBONWRyYWNvMjJNZXNoRWRnZUJyZWFrZXJEZWNvZGVyRQBONWRyYWNvMjlDb3JuZXJUYWJsZVRyYXZlcnNhbFByb2Nlc3NvcklOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRQBONWRyYWNvMjJNZXNoVHJhdmVyc2FsU2VxdWVuY2VySU5TXzIwRWRnZUJyZWFrZXJUcmF2ZXJzZXJJTlNfMjlDb3JuZXJUYWJsZVRyYXZlcnNhbFByb2Nlc3NvcklOU18yNE1lc2hBdHRyaWJ1dGVDb3JuZXJUYWJsZUVFRU5TXzM2TWVzaEF0dHJpYnV0ZUluZGljZXNFbmNvZGluZ09ic2VydmVySVMzX0VFTlNfMTlFZGdlQnJlYWtlck9ic2VydmVyRUVFRUUATjVkcmFjbzE1UG9pbnRzU2VxdWVuY2VyRQBONWRyYWNvMjlDb3JuZXJUYWJsZVRyYXZlcnNhbFByb2Nlc3NvcklOU18xMUNvcm5lclRhYmxlRUVFAE41ZHJhY28yMk1lc2hUcmF2ZXJzYWxTZXF1ZW5jZXJJTlNfMjVQcmVkaWN0aW9uRGVncmVlVHJhdmVyc2VySU5TXzI5Q29ybmVyVGFibGVUcmF2ZXJzYWxQcm9jZXNzb3JJTlNfMTFDb3JuZXJUYWJsZUVFRU5TXzM2TWVzaEF0dHJpYnV0ZUluZGljZXNFbmNvZGluZ09ic2VydmVySVMzX0VFRUVFRQBONWRyYWNvMjJNZXNoVHJhdmVyc2FsU2VxdWVuY2VySU5TXzIwRWRnZUJyZWFrZXJUcmF2ZXJzZXJJTlNfMjlDb3JuZXJUYWJsZVRyYXZlcnNhbFByb2Nlc3NvcklOU18xMUNvcm5lclRhYmxlRUVFTlNfMzZNZXNoQXR0cmlidXRlSW5kaWNlc0VuY29kaW5nT2JzZXJ2ZXJJUzNfRUVOU18xOUVkZ2VCcmVha2VyT2JzZXJ2ZXJFRUVFRQBONWRyYWNvMjZNZXNoRWRnZUJyZWFrZXJEZWNvZGVySW1wbElOU18zMU1lc2hFZGdlQnJlYWtlclRyYXZlcnNhbERlY29kZXJFRUUATjVkcmFjbzM1TWVzaEVkZ2VCcmVha2VyRGVjb2RlckltcGxJbnRlcmZhY2VFAE41ZHJhY28yNk1lc2hFZGdlQnJlYWtlckRlY29kZXJJbXBsSU5TXzQxTWVzaEVkZ2VCcmVha2VyVHJhdmVyc2FsUHJlZGljdGl2ZURlY29kZXJFRUUATjVkcmFjbzI2TWVzaEVkZ2VCcmVha2VyRGVjb2RlckltcGxJTlNfMzhNZXNoRWRnZUJyZWFrZXJUcmF2ZXJzYWxWYWxlbmNlRGVjb2RlckVFRQBONWRyYWNvMTVMaW5lYXJTZXF1ZW5jZXJFAE41ZHJhY28yMU1lc2hTZXF1ZW50aWFsRGVjb2RlckUATjVkcmFjbzE3UG9pbnRDbG91ZERlY29kZXJFAEZhaWxlZCB0byBwYXJzZSBEcmFjbyBoZWFkZXIuAERSQUNPAE5vdCBhIERyYWNvIGZpbGUuAEZhaWxlZCB0byBkZWNvZGUgbWV0YWRhdGEuAFVzaW5nIGluY29tcGF0aWJsZSBkZWNvZGVyIGZvciB0aGUgaW5wdXQgZ2VvbWV0cnkuAFVua25vd24gbWFqb3IgdmVyc2lvbi4AVW5rbm93biBtaW5vciB2ZXJzaW9uLgBGYWlsZWQgdG8gaW5pdGlhbGl6ZSB0aGUgZGVjb2Rlci4ARmFpbGVkIHRvIGRlY29kZSBnZW9tZXRyeSBkYXRhLgBGYWlsZWQgdG8gZGVjb2RlIHBvaW50IGF0dHJpYnV0ZXMuAE41ZHJhY28yM1BvaW50Q2xvdWRLZFRyZWVEZWNvZGVyRQBONWRyYWNvMjdQb2ludENsb3VkU2VxdWVudGlhbERlY29kZXJFAE41ZHJhY280TWVzaEUATjVkcmFjbzEwUG9pbnRDbG91ZEUARmxvYXRQb2ludHNUcmVlRGVjb2RlcjogY29tcHJlc3Npb24gbGV2ZWwgJWkgbm90IHN1cHBvcnRlZC4KAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUAEQAKABEREQAAAAAFAAAAAAAACQAAAAALAAAAAAAAAAARAA8KERERAwoHAAETCQsLAAAJBgsAAAsABhEAAAAREREAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAADAAAAAAJDAAAAAAADAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAANAAAABA0AAAAACQ4AAAAAAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAADwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAASEhIAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAKAAAAAAoAAAAACQsAAAAAAAsAAAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAtKyAgIDBYMHgAKG51bGwpAC0wWCswWCAwWC0weCsweCAweABpbmYASU5GAG5hbgBOQU4AMDEyMzQ1Njc4OUFCQ0RFRi4AVCEiGQ0BAgMRSxwMEAQLHRIeJ2hub3BxYiAFBg8TFBUaCBYHKCQXGAkKDhsfJSODgn0mKis8PT4/Q0dKTVhZWltcXV5fYGFjZGVmZ2lqa2xyc3R5ent8AElsbGVnYWwgYnl0ZSBzZXF1ZW5jZQBEb21haW4gZXJyb3IAUmVzdWx0IG5vdCByZXByZXNlbnRhYmxlAE5vdCBhIHR0eQBQZXJtaXNzaW9uIGRlbmllZABPcGVyYXRpb24gbm90IHBlcm1pdHRlZABObyBzdWNoIGZpbGUgb3IgZGlyZWN0b3J5AE5vIHN1Y2ggcHJvY2VzcwBGaWxlIGV4aXN0cwBWYWx1ZSB0b28gbGFyZ2UgZm9yIGRhdGEgdHlwZQBObyBzcGFjZSBsZWZ0IG9uIGRldmljZQBPdXQgb2YgbWVtb3J5AFJlc291cmNlIGJ1c3kASW50ZXJydXB0ZWQgc3lzdGVtIGNhbGwAUmVzb3VyY2UgdGVtcG9yYXJpbHkgdW5hdmFpbGFibGUASW52YWxpZCBzZWVrAENyb3NzLWRldmljZSBsaW5rAFJlYWQtb25seSBmaWxlIHN5c3RlbQBEaXJlY3Rvcnkgbm90IGVtcHR5AENvbm5lY3Rpb24gcmVzZXQgYnkgcGVlcgBPcGVyYXRpb24gdGltZWQgb3V0AENvbm5lY3Rpb24gcmVmdXNlZABIb3N0IGlzIGRvd24ASG9zdCBpcyB1bnJlYWNoYWJsZQBBZGRyZXNzIGluIHVzZQBCcm9rZW4gcGlwZQBJL08gZXJyb3IATm8gc3VjaCBkZXZpY2Ugb3IgYWRkcmVzcwBCbG9jayBkZXZpY2UgcmVxdWlyZWQATm8gc3VjaCBkZXZpY2UATm90IGEgZGlyZWN0b3J5AElzIGEgZGlyZWN0b3J5AFRleHQgZmlsZSBidXN5AEV4ZWMgZm9ybWF0IGVycm9yAEludmFsaWQgYXJndW1lbnQAQXJndW1lbnQgbGlzdCB0b28gbG9uZwBTeW1ib2xpYyBsaW5rIGxvb3AARmlsZW5hbWUgdG9vIGxvbmcAVG9vIG1hbnkgb3BlbiBmaWxlcyBpbiBzeXN0ZW0ATm8gZmlsZSBkZXNjcmlwdG9ycyBhdmFpbGFibGUAQmFkIGZpbGUgZGVzY3JpcHRvcgBObyBjaGlsZCBwcm9jZXNzAEJhZCBhZGRyZXNzAEZpbGUgdG9vIGxhcmdlAFRvbyBtYW55IGxpbmtzAE5vIGxvY2tzIGF2YWlsYWJsZQBSZXNvdXJjZSBkZWFkbG9jayB3b3VsZCBvY2N1cgBTdGF0ZSBub3QgcmVjb3ZlcmFibGUAUHJldmlvdXMgb3duZXIgZGllZABPcGVyYXRpb24gY2FuY2VsZWQARnVuY3Rpb24gbm90IGltcGxlbWVudGVkAE5vIG1lc3NhZ2Ugb2YgZGVzaXJlZCB0eXBlAElkZW50aWZpZXIgcmVtb3ZlZABEZXZpY2Ugbm90IGEgc3RyZWFtAE5vIGRhdGEgYXZhaWxhYmxlAERldmljZSB0aW1lb3V0AE91dCBvZiBzdHJlYW1zIHJlc291cmNlcwBMaW5rIGhhcyBiZWVuIHNldmVyZWQAUHJvdG9jb2wgZXJyb3IAQmFkIG1lc3NhZ2UARmlsZSBkZXNjcmlwdG9yIGluIGJhZCBzdGF0ZQBOb3QgYSBzb2NrZXQARGVzdGluYXRpb24gYWRkcmVzcyByZXF1aXJlZABNZXNzYWdlIHRvbyBsYXJnZQBQcm90b2NvbCB3cm9uZyB0eXBlIGZvciBzb2NrZXQAUHJvdG9jb2wgbm90IGF2YWlsYWJsZQBQcm90b2NvbCBub3Qgc3VwcG9ydGVkAFNvY2tldCB0eXBlIG5vdCBzdXBwb3J0ZWQATm90IHN1cHBvcnRlZABQcm90b2NvbCBmYW1pbHkgbm90IHN1cHBvcnRlZABBZGRyZXNzIGZhbWlseSBub3Qgc3VwcG9ydGVkIGJ5IHByb3RvY29sAEFkZHJlc3Mgbm90IGF2YWlsYWJsZQBOZXR3b3JrIGlzIGRvd24ATmV0d29yayB1bnJlYWNoYWJsZQBDb25uZWN0aW9uIHJlc2V0IGJ5IG5ldHdvcmsAQ29ubmVjdGlvbiBhYm9ydGVkAE5vIGJ1ZmZlciBzcGFjZSBhdmFpbGFibGUAU29ja2V0IGlzIGNvbm5lY3RlZABTb2NrZXQgbm90IGNvbm5lY3RlZABDYW5ub3Qgc2VuZCBhZnRlciBzb2NrZXQgc2h1dGRvd24AT3BlcmF0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3MAT3BlcmF0aW9uIGluIHByb2dyZXNzAFN0YWxlIGZpbGUgaGFuZGxlAFJlbW90ZSBJL08gZXJyb3IAUXVvdGEgZXhjZWVkZWQATm8gbWVkaXVtIGZvdW5kAFdyb25nIG1lZGl1bSB0eXBlAE5vIGVycm9yIGluZm9ybWF0aW9uAAAlZAB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzOiAlcwB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzAHRlcm1pbmF0aW5nIHdpdGggJXMgZm9yZWlnbiBleGNlcHRpb24AdGVybWluYXRpbmcAdW5jYXVnaHQAU3Q5ZXhjZXB0aW9uAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAHB0aHJlYWRfb25jZSBmYWlsdXJlIGluIF9fY3hhX2dldF9nbG9iYWxzX2Zhc3QoKQBjYW5ub3QgY3JlYXRlIHB0aHJlYWQga2V5IGZvciBfX2N4YV9nZXRfZ2xvYmFscygpAGNhbm5vdCB6ZXJvIG91dCB0aHJlYWQgdmFsdWUgZm9yIF9fY3hhX2dldF9nbG9iYWxzKCkAdGVybWluYXRlX2hhbmRsZXIgdW5leHBlY3RlZGx5IHJldHVybmVkAFN0MTFsb2dpY19lcnJvcgBTdDEybGVuZ3RoX2Vycm9yAE4xMF9fY3h4YWJpdjExOV9fcG9pbnRlcl90eXBlX2luZm9FAE4xMF9fY3h4YWJpdjExN19fcGJhc2VfdHlwZV9pbmZvRQ==";
var $t=At;At+=16;var ei={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||ei.infos[e])return e;for(var t in ei.infos){var i=ei.infos[t];if(i.adjusted===e)return t}return e},addRef:function(e){if(e){var t=ei.infos[e];t.refcount++}},decRef:function(e){if(e){var t=ei.infos[e];i(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&Ze.dynCall_vi(t.destructor,e),delete ei.infos[e],___cxa_free_exception(e))}},clearRef:function(e){if(e){var t=ei.infos[e];t.refcount=0}}},ti=r([8,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,7,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,6,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,5,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0,4,0,1,0,2,0,1,0,3,0,1,0,2,0,1,0],"i8",Pt),ii={varargs:0,get:function(e){ii.varargs+=4;var t=ut[ii.varargs-4>>2];return t},getStr:function(){var e=s(ii.get());return e},get64:function(){var e=ii.get(),t=ii.get();return i(e>=0?0===t:t===-1),e},getZero:function(){i(0===ii.get())}},ni={},ri=1,si={EPERM:1,ENOENT:2,ESRCH:3,EINTR:4,EIO:5,ENXIO:6,E2BIG:7,ENOEXEC:8,EBADF:9,ECHILD:10,EAGAIN:11,EWOULDBLOCK:11,ENOMEM:12,EACCES:13,EFAULT:14,ENOTBLK:15,EBUSY:16,EEXIST:17,EXDEV:18,ENODEV:19,ENOTDIR:20,EISDIR:21,EINVAL:22,ENFILE:23,EMFILE:24,ENOTTY:25,ETXTBSY:26,EFBIG:27,ENOSPC:28,ESPIPE:29,EROFS:30,EMLINK:31,EPIPE:32,EDOM:33,ERANGE:34,ENOMSG:42,EIDRM:43,ECHRNG:44,EL2NSYNC:45,EL3HLT:46,EL3RST:47,ELNRNG:48,EUNATCH:49,ENOCSI:50,EL2HLT:51,EDEADLK:35,ENOLCK:37,EBADE:52,EBADR:53,EXFULL:54,ENOANO:55,EBADRQC:56,EBADSLT:57,EDEADLOCK:35,EBFONT:59,ENOSTR:60,ENODATA:61,ETIME:62,ENOSR:63,ENONET:64,ENOPKG:65,EREMOTE:66,ENOLINK:67,EADV:68,ESRMNT:69,ECOMM:70,EPROTO:71,EMULTIHOP:72,EDOTDOT:73,EBADMSG:74,ENOTUNIQ:76,EBADFD:77,EREMCHG:78,ELIBACC:79,ELIBBAD:80,ELIBSCN:81,ELIBMAX:82,ELIBEXEC:83,ENOSYS:38,ENOTEMPTY:39,ENAMETOOLONG:36,ELOOP:40,EOPNOTSUPP:95,EPFNOSUPPORT:96,ECONNRESET:104,ENOBUFS:105,EAFNOSUPPORT:97,EPROTOTYPE:91,ENOTSOCK:88,ENOPROTOOPT:92,ESHUTDOWN:108,ECONNREFUSED:111,EADDRINUSE:98,ECONNABORTED:103,ENETUNREACH:101,ENETDOWN:100,ETIMEDOUT:110,EHOSTDOWN:112,EHOSTUNREACH:113,EINPROGRESS:115,EALREADY:114,EDESTADDRREQ:89,EMSGSIZE:90,EPROTONOSUPPORT:93,ESOCKTNOSUPPORT:94,EADDRNOTAVAIL:99,ENETRESET:102,EISCONN:106,ENOTCONN:107,ETOOMANYREFS:109,EUSERS:87,EDQUOT:122,ESTALE:116,ENOTSUP:95,ENOMEDIUM:123,EILSEQ:84,EOVERFLOW:75,ECANCELED:125,ENOTRECOVERABLE:131,EOWNERDEAD:130,ESTRPIPE:86};Gt.push(function(){var e=Ze._fflush;e&&e(0);var t=G.printChar;if(t){var i=G.buffers;i[1].length&&t(1,10),i[2].length&&t(2,10)}}),Tt=St.staticAlloc(4),yt=gt=St.alignMemory(At),bt=yt+Nt,Et=St.alignMemory(bt),ut[Tt>>2]=Et,vt=!0;var ai=!1,oi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",hi="function"==typeof atob?atob:function(e){var t,i,n,r,s,a,o,h="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=oi.indexOf(e.charAt(l++)),s=oi.indexOf(e.charAt(l++)),a=oi.indexOf(e.charAt(l++)),o=oi.indexOf(e.charAt(l++)),t=r<<2|s>>4,i=(15&s)<<4|a>>2,n=(3&a)<<6|o,h+=String.fromCharCode(t),64!==a&&(h+=String.fromCharCode(i)),64!==o&&(h+=String.fromCharCode(n));while(l<e.length);return h};Ze.asmGlobalArg={Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array,NaN:NaN,Infinity:1/0,byteLength:Dt},Ze.asmLibraryArg={abort:Ae,assert:i,enlargeMemory:v,getTotalMemory:y,abortOnCannotGrowMemory:A,invoke_ii:te,invoke_iii:ie,invoke_iiii:ne,invoke_iiiiiii:re,invoke_v:se,invoke_vi:ae,invoke_vii:oe,invoke_viii:he,invoke_viiii:le,invoke_viiiii:ce,invoke_viiiiii:de,__ZSt18uncaught_exceptionv:k,___cxa_allocate_exception:O,___cxa_begin_catch:D,___cxa_find_matching_catch:F,___cxa_pure_virtual:L,___cxa_throw:B,___gxx_personality_v0:V,___resumeException:N,___setErrNo:Q,___syscall140:U,___syscall146:G,___syscall54:W,___syscall6:z,_abort:H,_emscripten_memcpy_big:j,_pthread_getspecific:Y,_pthread_key_create:X,_pthread_once:Z,_pthread_setspecific:K,DYNAMICTOP_PTR:Tt,tempDoublePtr:$t,ABORT:wt,STACKTOP:gt,STACK_MAX:bt,cttz_i8:ti};var li=function(e,t,i){"almost asm";function n(e){return!(16777215&Hf(e)||Hf(e)<=16777215||Hf(e)>2147483648)&&(If=new Pf(e),xf=new Rf(e),kf=new Of(e),Lf=new Df(e),Ff=new Nf(e),Vf=new Bf(e),Gf=new Uf(e),zf=new Wf(e),i=e,!0)}function r(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0;if(i=0|If[t+11>>0],n=i<<24>>24<0,r=n?0|kf[t>>2]:t,s=n?0|kf[t+4>>2]:255&i,s>>>0>3){for(i=r,t=s,n=s;;){if(a=0|np(Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,1540483477),t=(0|np(a>>>24^a,1540483477))^(0|np(t,1540483477)),n=n+-4|0,n>>>0<=3)break;i=i+4|0}i=s+-4|0,n=i&-4,o=r+(n+4)|0,h=t,l=i-n|0}else o=r,h=s,l=s;switch(0|l){case 3:c=Lf[o+2>>0]<<16^h,d=6;break;case 2:c=h,d=6;break;case 1:u=h,d=7;break;default:f=h}if(6==(0|d)&&(u=Lf[o+1>>0]<<8^c,d=7),7==(0|d)&&(f=0|np(Lf[o>>0]^u,1540483477)),u=0|np(f>>>13^f,1540483477),f=u>>>15^u,u=0|kf[e+4>>2],!u)return p=0,0|p;if(o=u+-1|0,c=0==(o&u|0),_=c?f&o:f>>>0<u>>>0?f:(f>>>0)%(u>>>0)|0,h=0|kf[(0|kf[e>>2])+(_<<2)>>2],!h)return p=0,0|p;if(e=0|kf[h>>2],!e)return p=0,0|p;if(h=0==(0|s),c){c=e;e:for(;;){if(l=0|kf[c+4>>2],n=(0|l)==(0|f),!(n|(l&o|0)==(0|_))){p=0,d=41;break}do if(n?(l=c+8|0,i=0|If[l+11>>0],t=i<<24>>24<0,a=255&i,(0|(t?0|kf[c+12>>2]:a))==(0|s)):0){if(i=0|kf[l>>2],m=t?i:l,t){if(h){p=c,d=41;break e}if(0|fo(m,r,s))break;p=c,d=41;break e}if(h){p=c,d=41;break e}if((255&i)<<24>>24==(0|If[r>>0])){i=a,a=l,l=r;do{if(i=i+-1|0,a=a+1|0,!i){p=c,d=41;break e}l=l+1|0}while((0|If[a>>0])==(0|If[l>>0]))}}while(0);if(c=0|kf[c>>2],!c){p=0,d=41;break}}if(41==(0|d))return 0|p}else A=e;e:for(;;){if(e=0|kf[A+4>>2],c=(0|e)==(0|f))d=33;else{if(v=e>>>0<u>>>0?e:(e>>>0)%(u>>>0)|0,(0|v)!=(0|_)){p=0,d=41;break}c&&(d=33)}do if(33==(0|d)?(d=0,c=A+8|0,e=0|If[c+11>>0],o=e<<24>>24<0,n=255&e,(0|(o?0|kf[A+12>>2]:n))==(0|s)):0){if(e=0|kf[c>>2],l=o?e:c,o){if(h){p=A,d=41;break e}if(0|fo(l,r,s))break;p=A,d=41;break e}if(h){p=A,d=41;break e}if((255&e)<<24>>24==(0|If[r>>0])){e=n,n=c,c=r;do{if(e=e+-1|0,n=n+1|0,!e){p=A,d=41;break e}c=c+1|0}while((0|If[n>>0])==(0|If[c>>0]))}}while(0);if(A=0|kf[A>>2],!A){p=0,d=41;break}}return 41==(0|d)?0|p:0}function s(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;s=e+4|0,a=0|kf[t>>2],t=a;do if((0|a)!=(0|s)){if(o=a+16|0,h=0|If[o+11>>0],l=h<<24>>24<0,c=l?0|kf[a+20>>2]:255&h,h=0|If[r+11>>0],d=h<<24>>24<0,u=d?0|kf[r+4>>2]:255&h,h=c>>>0<u>>>0,f=h?c:u,0!=(0|f)?(p=0|fo(d?0|kf[r>>2]:r,l?0|kf[o>>2]:o,f),0!=(0|p)):0){if((0|p)<0)break}else _=4;if(4==(0|_)?u>>>0<c>>>0:0)break;if(p=u>>>0<c>>>0?u:c,(0!=(0|p)?(c=0|fo(l?0|kf[o>>2]:o,d?0|kf[r>>2]:r,p),0!=(0|c)):0)?(0|c)>=0&&(_=36):_=20,(20==(0|_)?!h:0)&&(_=36),36==(0|_))return kf[i>>2]=t,kf[n>>2]=t,m=n,0|m;if(h=a+4|0,c=0|kf[h>>2]){for(o=c;;){if(l=0|kf[o>>2],!l)break;o=l}A=o}else if(p=a+8|0,o=0|kf[p>>2],(0|kf[o>>2])==(0|a))A=o;else{o=p;do p=0|kf[o>>2],o=p+8|0,l=0|kf[o>>2];while((0|kf[l>>2])!=(0|p));A=l}do if((0|A)!=(0|s)){if(c=A+16|0,l=0|If[c+11>>0],p=l<<24>>24<0,f=p?0|kf[A+20>>2]:255&l,l=f>>>0<u>>>0?f:u,0!=(0|l)?(v=0|fo(d?0|kf[r>>2]:r,p?0|kf[c>>2]:c,l),0!=(0|v)):0){if((0|v)<0)break}else _=30;if(30==(0|_)?u>>>0<f>>>0:0)break;return m=0|Dt(e,i,r),0|m}while(0);return 0|kf[a+4>>2]?(kf[i>>2]=A,m=A,0|m):(kf[i>>2]=t,m=h,0|m)}while(0);A=0|kf[a>>2];do{if((0|a)!=(0|kf[e>>2])){if(A)for(s=A;;){if(h=0|kf[s+4>>2],!h){g=s;break}s=h}else for(s=a;;){if(n=0|kf[s+8>>2],(0|kf[n>>2])!=(0|s)){g=n;break}s=n}if(s=g,h=g+16|0,n=0|If[r+11>>0],u=n<<24>>24<0,d=u?0|kf[r+4>>2]:255&n,n=0|If[h+11>>0],o=n<<24>>24<0,f=o?0|kf[g+20>>2]:255&n,n=d>>>0<f>>>0?d:f,0!=(0|n)?(v=0|fo(o?0|kf[h>>2]:h,u?0|kf[r>>2]:r,n),0!=(0|v)):0){if((0|v)<0){y=s;break}}else _=12;if(12==(0|_)?f>>>0<d>>>0:0){y=s;break}return m=0|Dt(e,i,r),0|m}y=t}while(0);return A?(a=y,kf[i>>2]=a,m=a+4|0,0|m):(kf[i>>2]=a,m=a,0|m)}function a(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0;r=Xf,Xf=Xf+64|0,s=r,a=s,o=a+52|0;do kf[a>>2]=0,a=a+4|0;while((0|a)<(0|o));e:do if(0|E(s,i)?0|Q(s,i):0){if(a=0==(0|e))0|oi(i,0,0);else{if(!(0|kf[s+12>>2])){h=0;break}if(0|oi(i,0,0),!a)for(a=s+44|0,o=s+48|0,l=s+40|0,c=s+16|0,d=s+28|0,u=(0|t)>0,f=i+36|0,p=i+32|0,_=i+24|0,m=i+28|0,A=0|kf[o>>2],v=0,y=0;;){t:do if(A>>>0<16384)for(g=0|kf[a>>2],b=A;;){if((0|g)<=0){T=b;break t}if(S=0|kf[l>>2],g=g+-1|0,kf[a>>2]=g,w=Lf[S+g>>0]|b<<8,kf[o>>2]=w,w>>>0>=16384){T=w;break}b=w}else T=A;while(0);b=4095&T,g=0|kf[(0|kf[c>>2])+(b<<2)>>2],w=0|kf[d>>2],A=(0|np(0|kf[w+(g<<3)>>2],T>>>12))+b-(0|kf[w+(g<<3)+4>>2])|0,kf[o>>2]=A;t:do if(u){if((0|g)>0)C=0,M=y;else for(w=0==(0|If[f>>0]),b=0,S=y;;){if(w){h=0;break e}if(P=S+1|0,kf[n+(S<<2)>>2]=0,b=b+1|0,(0|b)>=(0|t)){I=P;break t}S=P}for(;;){if(!(0|If[f>>0])){h=0;break e}for(S=0|kf[_>>2],b=0|kf[m>>2],w=0|kf[p>>2],P=0,R=0;;){if(x=S+(w>>>3)|0,x>>>0<b>>>0?(O=(0|Lf[x>>0])>>>(7&w)&1,x=w+1|0,kf[p>>2]=x,k=x,D=O):(k=w,D=0),R=D<<P|R,P=P+1|0,(0|P)==(0|g))break;w=k}if(w=M+1|0,kf[n+(M<<2)>>2]=R,C=C+1|0,(0|C)>=(0|t)){I=w;break}M=w}}else I=y;while(0);if(v=v+t|0,v>>>0>=e>>>0)break;y=I}}hh(i),h=1}else h=0;while(0);return i=0|kf[s+28>>2],0|i&&(I=s+32|0,e=0|kf[I>>2],(0|e)!=(0|i)&&(kf[I>>2]=e+(~((e+-8-i|0)>>>3)<<3)),mf(i)),i=0|kf[s+16>>2],0|i&&(e=s+20|0,I=0|kf[e>>2],(0|I)!=(0|i)&&(kf[e>>2]=I+(~((I+-4-i|0)>>>2)<<2)),mf(i)),(i=0|kf[s>>2])?(I=s+4|0,s=0|kf[I>>2],(0|s)!=(0|i)&&(kf[I>>2]=s+(~((s+-4-i|0)>>>2)<<2)),mf(i),Xf=r,0|h):(Xf=r,0|h)}function o(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0;if(s=e,a=t,o=a,h=i,l=n,c=l,!o)return d=0!=(0|r),c?d?(kf[r>>2]=0|e,kf[r+4>>2]=0&t,u=0,f=0,0|(qf=u,f)):(u=0,f=0,0|(qf=u,f)):(d&&(kf[r>>2]=(s>>>0)%(h>>>0),kf[r+4>>2]=0),u=0,f=(s>>>0)/(h>>>0)>>>0,0|(qf=u,f));d=0==(0|c);do{if(h){if(!d){if(p=(0|sp(0|c))-(0|sp(0|o))|0,p>>>0<=31){_=p+1|0,m=31-p|0,A=p-31>>31,v=_,y=s>>>(_>>>0)&A|o<<m,g=o>>>(_>>>0)&A,b=0,E=s<<m;break}return r?(kf[r>>2]=0|e,kf[r+4>>2]=a|0&t,u=0,f=0,0|(qf=u,f)):(u=0,f=0,0|(qf=u,f))}if(m=h-1|0,m&h|0){A=(0|sp(0|h))+33-(0|sp(0|o))|0,_=64-A|0,p=32-A|0,T=p>>31,S=A-32|0,w=S>>31,v=A,y=p-1>>31&o>>>(S>>>0)|(o<<p|s>>>(A>>>0))&w,g=w&o>>>(A>>>0),b=s<<_&T,E=(o<<_|s>>>(S>>>0))&T|s<<p&A-33>>31;break}return 0|r&&(kf[r>>2]=m&s,kf[r+4>>2]=0),1==(0|h)?(u=a|0&t,f=0|e|0,0|(qf=u,f)):(m=0|Ih(0|h),u=o>>>(m>>>0)|0,f=o<<32-m|s>>>(m>>>0)|0,0|(qf=u,f))}if(d)return 0|r&&(kf[r>>2]=(o>>>0)%(h>>>0),kf[r+4>>2]=0),u=0,f=(o>>>0)/(h>>>0)>>>0,0|(qf=u,f);if(!s)return 0|r&&(kf[r>>2]=0,kf[r+4>>2]=(o>>>0)%(c>>>0)),u=0,f=(o>>>0)/(c>>>0)>>>0,0|(qf=u,f);if(m=c-1|0,!(m&c))return 0|r&&(kf[r>>2]=0|e,kf[r+4>>2]=m&o|0&t),u=0,f=o>>>((0|Ih(0|c))>>>0),0|(qf=u,f);if(m=(0|sp(0|c))-(0|sp(0|o))|0,m>>>0<=30){A=m+1|0,p=31-m|0,v=A,y=o<<p|s>>>(A>>>0),g=o>>>(A>>>0),b=0,E=s<<p;break}return r?(kf[r>>2]=0|e,kf[r+4>>2]=a|0&t,u=0,f=0,0|(qf=u,f)):(u=0,f=0,0|(qf=u,f))}while(0);if(v){t=0|i|0,i=l|0&n,n=0|tc(0|t,0|i,-1,-1),l=qf,a=E,E=b,b=g,g=y,y=v,v=0;do e=a,a=E>>>31|a<<1,E=v|E<<1,s=g<<1|e>>>31|0,e=g>>>31|b<<1|0,0|nc(0|n,0|l,0|s,0|e),o=qf,c=o>>31|((0|o)<0?-1:0)<<1,v=1&c,g=0|nc(0|s,0|e,c&t|0,(((0|o)<0?-1:0)>>31|((0|o)<0?-1:0)<<1)&i|0),b=qf,y=y-1|0;while(0!=(0|y));C=a,M=E,P=b,I=g,R=0,x=v}else C=E,M=b,P=g,I=y,R=0,x=0;return v=M,M=0,0|r&&(kf[r>>2]=I,kf[r+4>>2]=P),u=(0|v)>>>31|(C|M)<<1|0&(M<<1|v>>>31)|R,f=(v<<1|0)&-2|x,0|(qf=u,f)}function h(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0;if(r=t+12|0,s=0|kf[r>>2],a=(0|kf[i>>2])-s|0,o=i+4|0,h=(0|kf[o>>2])-s|0,l=i,kf[l>>2]=a,kf[l+4>>2]=h,l=0|kf[r>>2],c=(((0|h)>-1?h:0-h|0)+((0|a)>-1?a:0-a|0)|0)<=(0|l),c?(d=a,u=h):((h|a|0)>-1?(f=1,p=1):(_=(0|a)<1&(0|h)<1,f=_?-1:(0|a)>0?1:-1,p=_?-1:(0|h)>0?1:-1),_=0|np(l,f),m=0|np(l,p),l=(a<<1)-_|0,kf[i>>2]=l,a=(h<<1)-m|0,kf[o>>2]=a,(0|np(f,p))>-1?(p=0-a|0,kf[i>>2]=p,A=0-l|0,v=p):(kf[i>>2]=a,A=l,v=a),a=(v+_|0)/2|0,kf[i>>2]=a,_=(A+m|0)/2|0,kf[o>>2]=_,d=a,u=_),y=d?(0|d)<0&(0|u)<1:0==(0|u),g=d?(0|d)>0?(u>>31)+2|0:(0|u)<1?0:3:0==(0|u)?0:(0|u)>0?3:1,y)b=d,E=u,T=1;else{switch(0|g){case 1:S=u,w=0-d|0;break;case 2:S=0-d|0,w=0-u|0;break;case 3:S=0-u|0,w=d;break;default:S=d,w=u}u=i,kf[u>>2]=S,kf[u+4>>2]=w,b=S,E=w,T=0}if(w=(0|kf[n>>2])+b|0,kf[e>>2]=w,b=(0|kf[n+4>>2])+E|0,E=e+4|0,kf[E>>2]=b,n=0|kf[r>>2],C=(0|n)>=(0|w)?(0|w)<(0-n|0)?(0|kf[t+4>>2])+w|0:w:w-(0|kf[t+4>>2])|0,kf[e>>2]=C,M=(0|n)>=(0|b)?(0|b)<(0-n|0)?(0|kf[t+4>>2])+b|0:b:b-(0|kf[t+4>>2])|0,kf[E>>2]=M,T)P=C,I=M;else{switch((4-g|0)%4|0|0){case 1:R=M,x=0-C|0;break;case 2:R=0-C|0,x=0-M|0;break;case 3:R=0-M|0,x=C;break;default:R=C,x=M}M=e,kf[M>>2]=R,kf[M+4>>2]=x,P=R,I=x}return c?(O=P,k=I,D=O+s|0,L=k+s|0,N=e,F=N,kf[F>>2]=D,B=N+4|0,V=B,void(kf[V>>2]=L)):((I|P|0)>-1?(U=1,G=1):(c=(0|P)<1&(0|I)<1,U=c?-1:(0|P)>0?1:-1,G=c?-1:(0|I)>0?1:-1),c=0|np(n,U),x=0|np(n,G),n=(P<<1)-c|0,kf[e>>2]=n,P=(I<<1)-x|0,kf[E>>2]=P,(0|np(U,G))>-1?(G=0-P|0,kf[e>>2]=G,W=0-n|0,z=G):(kf[e>>2]=P,W=n,z=P),P=(z+c|0)/2|0,kf[e>>2]=P,c=(W+x|0)/2|0,kf[E>>2]=c,O=P,k=c,D=O+s|0,L=k+s|0,N=e,F=N,kf[F>>2]=D,B=N+4|0,V=B,void(kf[V>>2]=L))}function l(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0;if(i=e+4|0,!t)return n=0|kf[e>>2],kf[e>>2]=0,0|n&&mf(n),void(kf[i>>2]=0);t>>>0>1073741823&&(n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)),n=0|sl(t<<2),r=0|kf[e>>2],kf[e>>2]=n,0|r&&mf(r),kf[i>>2]=t,i=0;do kf[(0|kf[e>>2])+(i<<2)>>2]=0,i=i+1|0;while((0|i)!=(0|t));if(i=e+8|0,r=0|kf[i>>2],r&&(n=0|kf[r+4>>2],s=t+-1|0,a=0==(s&t|0),o=a?n&s:n>>>0<t>>>0?n:(n>>>0)%(t>>>0)|0,kf[(0|kf[e>>2])+(o<<2)>>2]=i,i=0|kf[r>>2])){h=r,l=i,c=o,d=r;e:for(;;){t:do if(a)for(r=h,o=l,i=d;;){for(n=o;;){if(u=kf[n+4>>2]&s,(0|u)==(0|c))break;if(f=(0|kf[e>>2])+(u<<2)|0,!(0|kf[f>>2])){p=n,_=i,m=f,A=u;break t}for(f=n+8|0,v=n;;){if(y=0|kf[v>>2],!y)break;if((0|kf[f>>2])!=(0|kf[y+8>>2]))break;v=y}if(kf[i>>2]=y,kf[v>>2]=kf[kf[(0|kf[e>>2])+(u<<2)>>2]>>2],kf[kf[(0|kf[e>>2])+(u<<2)>>2]>>2]=n,f=0|kf[r>>2],!f){g=37;break e}n=f}if(o=0|kf[n>>2],!o){g=37;break e}r=n,i=n}else for(i=h,r=l,o=d;;){for(f=r;;){if(b=0|kf[f+4>>2],E=b>>>0<t>>>0?b:(b>>>0)%(t>>>0)|0,(0|E)==(0|c))break;if(b=(0|kf[e>>2])+(E<<2)|0,!(0|kf[b>>2])){p=f,_=o,m=b,A=E;break t}for(b=f+8|0,T=f;;){if(S=0|kf[T>>2],!S)break;if((0|kf[b>>2])!=(0|kf[S+8>>2]))break;T=S}if(kf[o>>2]=S,kf[T>>2]=kf[kf[(0|kf[e>>2])+(E<<2)>>2]>>2],kf[kf[(0|kf[e>>2])+(E<<2)>>2]>>2]=f,b=0|kf[i>>2],!b){g=37;break e}f=b}if(r=0|kf[f>>2],!r){g=37;break e}i=f,o=f}while(0);if(kf[m>>2]=_,l=0|kf[p>>2],!l){g=37;break}h=p,c=A,d=p}}}function c(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,C=0,M=0,P=0,I=0,R=0;i=Xf,Xf=Xf+32|0,n=i+24|0,r=i+20|0,s=i+8|0,a=i+4|0,o=i,kf[n>>2]=0,0|Qs(n,0|kf[e>>2]);e:do if(0|kf[n>>2]){for(h=0;;){if(h=h+1|0,!(0|w(e,t))){l=0;break}if(h>>>0>=(0|kf[n>>2])>>>0)break e}return Xf=i,0|l}while(0);kf[r>>2]=0,0|Qs(r,0|kf[e>>2]);e:do if(0|kf[r>>2])for(n=s+11|0,h=0;;){kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,u=0|kf[e>>2],f=u+8|0,p=0|kf[f+4>>2],_=u+16|0,m=_,A=0|kf[m>>2],v=0|kf[m+4>>2];do if((0|p)>(0|v)|((0|p)==(0|v)?(0|kf[f>>2])>>>0>A>>>0:0)){if(m=0|If[(0|kf[u>>2])+A>>0],y=0|tc(0|A,0|v,1,0),g=_,kf[g>>2]=y,kf[g+4>>2]=qf,g=255&m,ea(s,g,0),m<<24>>24){if(y=0|kf[e>>2],b=0|Go(s,0),E=y+8|0,T=0|kf[E>>2],S=0|kf[E+4>>2],E=y+16|0,C=E,M=0|kf[C>>2],P=255&m,m=0|tc(0|M,0|kf[C+4>>2],0|P,0),C=qf,(0|S)<(0|C)|(0|S)==(0|C)&T>>>0<m>>>0){I=1;break}0|ui(0|b,(0|kf[y>>2])+M|0,0|g),g=E,M=0|tc(0|kf[g>>2],0|kf[g+4>>2],0|P,0),P=E,kf[P>>2]=M,kf[P+4>>2]=qf}P=0|sl(40),kf[P>>2]=0,kf[P+4>>2]=0,kf[P+8>>2]=0,kf[P+12>>2]=0,Gf[P+16>>2]=ap(1),M=P+20|0,kf[M>>2]=0,kf[M+4>>2]=0,kf[M+8>>2]=0,kf[M+12>>2]=0,Gf[P+36>>2]=ap(1),kf[a>>2]=P,0|c(e,P)?(P=0|kf[a>>2],kf[a>>2]=0,kf[o>>2]=P,0|Yt(t,s,o),hs(o),R=0):R=1,hs(a),I=R}else I=1;while(0);if((0|If[n>>0])<0&&mf(0|kf[s>>2]),h=h+1|0,0|I){d=0;break e}if(h>>>0>=(0|kf[r>>2])>>>0){d=1;break}}else d=1;while(0);return l=d,Xf=i,0|l}function d(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+176|0,r=n+136|0,s=n+64|0,a=n,o=n+32|0,h=0|kf[(0|kf[t+4>>2])+44>>2],l=0|sl(88),kf[l+4>>2]=0,kf[l>>2]=3216,c=l+12|0,kf[c>>2]=3196,d=l+64|0,kf[d>>2]=0,kf[l+68>>2]=0,kf[l+72>>2]=0,u=l+16|0,f=u+44|0;do kf[u>>2]=0,u=u+4|0;while((0|u)<(0|f));kf[l+76>>2]=h,kf[l+80>>2]=i,kf[l+84>>2]=0,p=l,_=s+4|0,kf[_>>2]=3196,m=s+56|0,kf[m>>2]=0,A=s+60|0,kf[A>>2]=0,kf[s+64>>2]=0,u=s+8|0,f=u+44|0;do kf[u>>2]=0,u=u+4|0;while((0|u)<(0|f));return u=0|kf[t+8>>2],kf[a>>2]=3196,t=a+4|0,f=t+4|0,kf[f>>2]=0,kf[f+4>>2]=0,kf[f+8>>2]=0,kf[f+12>>2]=0,kf[f+16>>2]=0,kf[f+20>>2]=0,f=u,kf[t>>2]=f,t=((0|kf[f+4>>2])-(0|kf[u>>2])>>2>>>0)/3|0,If[r>>0]=0,pi(a+8|0,t,r),xp[127&kf[(0|kf[a>>2])+8>>2]](a),ct(o,a),ct(r,o),kf[s>>2]=kf[r+4>>2],t=s+4|0,0|St(t,r),kf[r>>2]=3196,f=0|kf[r+20>>2],0|f&&mf(f),f=0|kf[r+8>>2],0|f&&mf(f),kf[s+36>>2]=u,kf[s+40>>2]=i,kf[s+44>>2]=h,kf[s+48>>2]=l,kf[o>>2]=3196,h=0|kf[o+20>>2],0|h&&mf(h),h=0|kf[o+8>>2],0|h&&mf(h),kf[l+8>>2]=kf[s>>2],0|St(c,t),t=l+44|0,l=s+36|0,kf[t>>2]=kf[l>>2],kf[t+4>>2]=kf[l+4>>2],kf[t+8>>2]=kf[l+8>>2],kf[t+12>>2]=kf[l+12>>2],If[t+16>>0]=0|If[l+16>>0],Mt(d,0|kf[m>>2],0|kf[A>>2]),kf[e>>2]=p,kf[a>>2]=3196,p=0|kf[a+20>>2],0|p&&mf(p),p=0|kf[a+8>>2],0|p&&mf(p),p=0|kf[m>>2],0|p&&(m=0|kf[A>>2],(0|m)!=(0|p)&&(kf[A>>2]=m+(~((m+-4-p|0)>>>2)<<2)),mf(p)),kf[_>>2]=3196,_=0|kf[s+24>>2],0|_&&mf(_),(_=0|kf[s+12>>2])?(mf(_),void(Xf=n)):void(Xf=n)}function u(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0;if(s=e+8|0,kf[s>>2]=r,a=e+32|0,o=e+36|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,c>>>0>=r>>>0?(c>>>0>r>>>0?(h=d+(r<<2)|0,(0|l)!=(0|h)):0)?(kf[o>>2]=l+(~((l+-4-h|0)>>>2)<<2),u=r):u=r:(Kr(a,r-c|0),u=0|kf[s>>2]),c=r>>>0>1073741823?-1:r<<2,a=0|ff(c),0|Bs(0|a,0,0|c),(0|u)>0){c=e+16|0,h=e+32|0,l=e+12|0,o=0;do d=0|kf[a+(o<<2)>>2],f=0|kf[c>>2],(0|d)>(0|f)?(p=0|kf[h>>2],kf[p+(o<<2)>>2]=f,_=p):(p=0|kf[l>>2],f=0|kf[h>>2],kf[f+(o<<2)>>2]=(0|d)<(0|p)?p:d,_=f),o=o+1|0,m=0|kf[s>>2];while((0|o)<(0|m));if((0|m)>0){o=e+20|0,h=0;do f=(0|kf[t+(h<<2)>>2])+(0|kf[_+(h<<2)>>2])|0,d=i+(h<<2)|0,kf[d>>2]=f,(0|f)<=(0|kf[c>>2])?(0|f)<(0|kf[l>>2])&&(A=(0|kf[o>>2])+f|0,v=18):(A=f-(0|kf[o>>2])|0,v=18),18==(0|v)&&(v=0,kf[d>>2]=A),h=h+1|0,d=0|kf[s>>2];while((0|h)<(0|d));y=d}else y=m}else y=u;if((0|r)>=(0|n))return pf(a),1;for(u=0-r|0,m=e+16|0,h=e+32|0,A=e+12|0,o=e+20|0,e=y,y=r;;){if(l=i+(y<<2)|0,c=l+(u<<2)|0,_=t+(y<<2)|0,(0|e)>0){d=0;do f=0|kf[c+(d<<2)>>2],p=0|kf[m>>2],(0|f)>(0|p)?(g=0|kf[h>>2],kf[g+(d<<2)>>2]=p,b=g):(g=0|kf[A>>2],p=0|kf[h>>2],kf[p+(d<<2)>>2]=(0|f)<(0|g)?g:f,b=p),d=d+1|0,E=0|kf[s>>2];while((0|d)<(0|E));if((0|E)>0){d=0;do c=(0|kf[_+(d<<2)>>2])+(0|kf[b+(d<<2)>>2])|0,p=l+(d<<2)|0,kf[p>>2]=c,(0|c)<=(0|kf[m>>2])?(0|c)<(0|kf[A>>2])&&(T=(0|kf[o>>2])+c|0,v=33):(T=c-(0|kf[o>>2])|0,v=33),33==(0|v)&&(v=0,kf[p>>2]=T),d=d+1|0,p=0|kf[s>>2];while((0|d)<(0|p));S=p}else S=E}else S=e;if(y=y+r|0,(0|y)>=(0|n))break;e=S}return pf(a),1}function f(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(n=Xf,Xf=Xf+16|0,r=n,s=e+68|0,kf[s>>2]=(0|kf[s>>2])+1,s=(0|kf[e+8+(12*t|0)+4>>2])-(0|kf[e+8+(12*t|0)>>2])|0,a=s>>2,(0|s)<=0)return void(Xf=n);for(s=e+4|0,o=e+56|0,h=e+72|0,l=0|kf[i>>2],i=l+4|0,c=l+8|0,d=e+76|0,u=0|kf[e+44+(t<<2)>>2],t=0;;){f=(0|u)==-1,p=f?-1:(u>>>0)/3|0,_=(0|kf[o>>2])+(p>>>5<<2)|0,kf[_>>2]=kf[_>>2]|1<<(31&p),kf[h>>2]=(0|kf[h>>2])+1;do if(t){if(m=f?-1:0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|u)/3|0)|0)+(((0|u)%3|0)<<2)>>2],kf[d>>2]=m,kf[r>>2]=m,p=0|kf[i>>2],p>>>0<(0|kf[c>>2])>>>0?(kf[p>>2]=m,kf[i>>2]=p+4):us(l,r),!(1&t)){if(p=u+1|0,f){A=-1;break}v=0==((p>>>0)%3|0|0)?u+-2|0:p,y=35;break}if(!f){if((u>>>0)%3|0){v=u+-1|0,y=35;break}v=u+2|0,y=35;break}A=-1}else g=f?-1:0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|u)/3|0)|0)+(((0|u)%3|0)<<2)>>2],kf[r>>2]=g,p=0|kf[i>>2],p>>>0<(0|kf[c>>2])>>>0?(kf[p>>2]=g,kf[i>>2]=p+4):us(l,r),p=u+1|0,b=(f?0:(_=0==((p>>>0)%3|0|0)?u+-2|0:p,(0|_)!=-1))?0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|_)/3|0)|0)+(((0|_)%3|0)<<2)>>2]:-1,kf[r>>2]=b,_=0|kf[i>>2],_>>>0<(0|kf[c>>2])>>>0?(kf[_>>2]=b,kf[i>>2]=_+4):us(l,r),E=(f?0:(_=(0==((u>>>0)%3|0|0)?2:-1)+u|0,(0|_)!=-1))?0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|_)/3|0)|0)+(((0|_)%3|0)<<2)>>2]:-1,kf[d>>2]=E,kf[r>>2]=E,_=0|kf[i>>2],_>>>0<(0|kf[c>>2])>>>0?(kf[_>>2]=E,kf[i>>2]=_+4):us(l,r),v=u,y=35;while(0);if(35==(0|y)&&(y=0,A=(0|v)==-1?-1:0|kf[(0|kf[(0|kf[s>>2])+12>>2])+(v<<2)>>2]),t=t+1|0,(0|t)>=(0|a))break;u=A}Xf=n}function p(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0;i=e+148|0,n=0|kf[t>>2],t=(0|n)==-1,r=n+1|0;do{if(!t){if(s=0==((r>>>0)%3|0|0)?n+-2|0:r,(n>>>0)%3|0){a=s,o=n+-1|0;break}a=s,o=n+2|0;break}a=-1,o=-1}while(0);switch(s=e+184|0,h=0|kf[s>>2],0|h){case 1:case 0:l=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],c=0|kf[e+156>>2],d=c+(l<<2)|0,kf[d>>2]=(0|kf[d>>2])+1,(0|o)==-1?(u=1,f=c,p=-1,_=28):(u=1,f=c,p=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],_=28);break;case 5:m=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],c=0|kf[e+156>>2],d=c+(m<<2)|0,kf[d>>2]=(0|kf[d>>2])+1,A=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],d=c+(A<<2)|0,kf[d>>2]=(0|kf[d>>2])+1,(0|o)==-1?(u=2,f=c,p=-1,_=28):(u=2,f=c,p=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],_=28);break;case 3:v=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],c=0|kf[e+156>>2],d=c+(v<<2)|0,kf[d>>2]=(0|kf[d>>2])+1,y=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],d=c+(y<<2)|0,kf[d>>2]=(0|kf[d>>2])+2,(0|o)==-1?(u=1,f=c,p=-1,_=28):(u=1,f=c,p=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],_=28);break;case 7:g=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],c=0|kf[e+156>>2],d=c+(g<<2)|0,kf[d>>2]=(0|kf[d>>2])+2,b=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],a=c+(b<<2)|0,kf[a>>2]=(0|kf[a>>2])+2,(0|o)==-1?(u=2,f=c,p=-1,_=28):(u=2,f=c,p=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],_=28);break;default:E=h}switch(28==(0|_)&&(_=f+(p<<2)|0,kf[_>>2]=(0|kf[_>>2])+u,E=0|kf[s>>2]),0|E){case 5:case 0:break;default:return void(kf[e+188>>2]=-1)}E=0|kf[i>>2],T=(t?0:(t=0==((r>>>0)%3|0|0)?n+-2|0:r,(0|t)!=-1))?0|kf[(0|kf[E>>2])+(t<<2)>>2]:-1,kf[e+188>>2]=(0|kf[(0|kf[e+156>>2])+(T<<2)>>2])<6?5:0}function _(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0;if(n=Xf,Xf=Xf+16|0,r=n+8|0,s=n,a=n+4|0,!(0|Gs(e,t)))return o=0,Xf=n,0|o;if(h=t+96|0,l=t+100|0,t=0|kf[l>>2],c=0|kf[h>>2],(0|t)==(0|c))return o=1,Xf=n,0|o;for(d=e+56|0,u=e+8|0,p=e+12|0,_=e+20|0,m=e+24|0,A=e+32|0,v=e+36|0,y=e+68|0,g=e+76|0,b=0|kf[i>>2],i=b+4|0,E=b+8|0,T=e+72|0,S=b,w=c,c=t,t=0;;){if(kf[(0|kf[d>>2])+(t>>>5<<2)>>2]&1<<(31&t)?(x=w,O=c):(C=3*t|0,kf[s>>2]=C,kf[r>>2]=kf[s>>2],Rn(e,0,r),M=(0|kf[p>>2])-(0|kf[u>>2])>>2,kf[s>>2]=C+1,kf[r>>2]=kf[s>>2],Rn(e,1,r),P=(0|kf[m>>2])-(0|kf[_>>2])>>2,I=P>>>0>M>>>0,kf[s>>2]=C+2,kf[r>>2]=kf[s>>2],Rn(e,2,r),C=(0|kf[v>>2])-(0|kf[A>>2])>>2>>>0>(I?P:M)>>>0?2:I?1:(0==(0|M))<<31>>31,(0|kf[y>>2])>0&&(M=0|kf[g>>2],kf[r>>2]=M,I=0|kf[i>>2],I>>>0<(0|kf[E>>2])>>>0?(kf[I>>2]=M,kf[i>>2]=I+4):us(b,r),I=0|kf[e+44+(C<<2)>>2],R=(0|I)==-1?-1:0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|I)/3|0)|0)+(((0|I)%3|0)<<2)>>2],kf[r>>2]=R,I=0|kf[i>>2],I>>>0<(0|kf[E>>2])>>>0?(kf[I>>2]=R,kf[i>>2]=I+4):us(b,r),I=(0|kf[T>>2])+2|0,kf[T>>2]=I,1&I|0&&(kf[r>>2]=R,I=0|kf[i>>2],I>>>0<(0|kf[E>>2])>>>0?(kf[I>>2]=R,kf[i>>2]=I+4):us(b,r),kf[T>>2]=(0|kf[T>>2])+1)),kf[a>>2]=S,kf[r>>2]=kf[a>>2],f(e,C,r),x=0|kf[h>>2],O=0|kf[l>>2]),t=t+1|0,t>>>0>=((O-x|0)/12|0)>>>0){o=1;break}w=x,c=O}return Xf=n,0|o}function m(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|Ti(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function A(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|wi(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function v(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|Ci(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function y(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|Pi(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function g(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|Ii(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function b(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,
h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|sr(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function E(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=0|xf[t+38>>1],!(i<<16>>16))return n=0,0|n;r=e+12|0;do{if((65535&i)<512){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return n=0,0|n;c=(0|kf[t>>2])+l|0,l=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[r>>0]=l,If[r+1>>0]=l>>8,If[r+2>>0]=l>>16,If[r+3>>0]=l>>24,c=s,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=s,kf[c>>2]=a,kf[c+4>>2]=qf,d=l;break}if(0|Qs(r,t)){d=0|kf[r>>2];break}return n=0,0|n}while(0);if(i=e+4|0,l=0|kf[i>>2],c=0|kf[e>>2],a=l-c>>2,s=c,c=l,d>>>0<=a>>>0?(d>>>0<a>>>0?(l=s+(d<<2)|0,(0|c)!=(0|l)):0)?(kf[i>>2]=c+(~((c+-4-l|0)>>>2)<<2),u=d):u=d:(Kr(e,d-a|0),u=0|kf[r>>2]),!u)return n=1,0|n;a=t+8|0,d=t+16|0,l=u,u=0;e:for(;;){if(c=a,i=0|kf[c>>2],s=0|kf[c+4>>2],c=d,h=0|kf[c>>2],o=0|kf[c+4>>2],!((0|s)>(0|o)|(0|s)==(0|o)&i>>>0>h>>>0)){n=0,f=23;break}switch(c=0|kf[t>>2],p=0|If[c+h>>0],_=0|tc(0|h,0|o,1,0),o=qf,h=d,kf[h>>2]=_,kf[h+4>>2]=o,h=255&p,m=3&h,A=h>>>2,3&p){case 3:if(p=A+u|0,p>>>0>=l>>>0){n=0,f=23;break e}0|Bs((0|kf[e>>2])+(u<<2)|0,0,(A<<2)+4|0),v=p;break;case 0:y=A,f=20;break;default:for(p=o,o=_,_=0,h=A;;){if(!((0|s)>(0|p)|(0|s)==(0|p)&i>>>0>o>>>0)){n=0,f=23;break e}if(A=0|If[c+o>>0],o=0|tc(0|o,0|p,1,0),p=qf,g=d,kf[g>>2]=o,kf[g+4>>2]=p,g=(255&A)<<(_<<3|6)|h,_=_+1|0,(0|_)>=(0|m)){y=g,f=20;break}h=g}}if(20==(0|f)&&(f=0,kf[(0|kf[e>>2])+(u<<2)>>2]=y,v=u),u=v+1|0,l=0|kf[r>>2],u>>>0>=l>>>0){f=22;break}}return 22==(0|f)?(n=0|ar(e+16|0,0|kf[e>>2],l),0|n):23==(0|f)?0|n:0}function T(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;i=e+148|0,n=0|kf[t>>2],t=(0|n)==-1,r=n+1|0;do{if(!t){if(s=0==((r>>>0)%3|0|0)?n+-2|0:r,(n>>>0)%3|0){a=s,o=n+-1|0;break}a=s,o=n+2|0;break}a=-1,o=-1}while(0);switch(0|kf[e+168>>2]){case 1:case 0:h=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],r=0|kf[e+156>>2],s=r+(h<<2)|0,kf[s>>2]=(0|kf[s>>2])+1,(0|o)==-1?(l=1,c=r,d=-1,u=28):(l=1,c=r,d=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],u=28);break;case 5:f=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],r=0|kf[e+156>>2],s=r+(f<<2)|0,kf[s>>2]=(0|kf[s>>2])+1,p=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],s=r+(p<<2)|0,kf[s>>2]=(0|kf[s>>2])+1,(0|o)==-1?(l=2,c=r,d=-1,u=28):(l=2,c=r,d=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],u=28);break;case 3:_=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],r=0|kf[e+156>>2],s=r+(_<<2)|0,kf[s>>2]=(0|kf[s>>2])+1,m=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],s=r+(m<<2)|0,kf[s>>2]=(0|kf[s>>2])+2,(0|o)==-1?(l=1,c=r,d=-1,u=28):(l=1,c=r,d=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],u=28);break;case 7:A=t?-1:0|kf[(0|kf[kf[i>>2]>>2])+(n<<2)>>2],n=0|kf[e+156>>2],t=n+(A<<2)|0,kf[t>>2]=(0|kf[t>>2])+2,v=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],t=n+(v<<2)|0,kf[t>>2]=(0|kf[t>>2])+2,(0|o)==-1?(l=2,c=n,d=-1,u=28):(l=2,c=n,d=0|kf[(0|kf[kf[i>>2]>>2])+(o<<2)>>2],u=28)}return 28==(0|u)&&(u=c+(d<<2)|0,kf[u>>2]=(0|kf[u>>2])+l),y=(0|a)==-1?-1:0|kf[(0|kf[kf[i>>2]>>2])+(a<<2)>>2],a=0|kf[(0|kf[e+156>>2])+(y<<2)>>2],y=0|kf[e+176>>2],(0|a)<(0|y)?(g=y,b=g-y|0,E=e+172|0,void(kf[E>>2]=b)):(i=0|kf[e+180>>2],g=(0|a)>(0|i)?i:a,b=g-y|0,E=e+172|0,void(kf[E>>2]=b))}function S(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(n=Xf,Xf=Xf+16|0,a=n+4|0,o=n,kf[e+72>>2]=r,kf[e+64>>2]=s,s=0|ff(r>>>0>1073741823?-1:r<<2),h=e+68|0,l=0|kf[h>>2],kf[h>>2]=s,0|l&&pf(l),l=e+8|0,kf[l>>2]=r,s=e+32|0,c=e+36|0,d=0|kf[c>>2],u=0|kf[s>>2],f=d-u>>2,p=u,u=d,f>>>0>=r>>>0?(f>>>0>r>>>0?(d=p+(r<<2)|0,(0|u)!=(0|d)):0)&&(kf[c>>2]=u+(~((u+-4-d|0)>>>2)<<2)):Kr(s,r-f|0),f=e+56|0,s=0|kf[f>>2],d=0|kf[s+4>>2],u=0|kf[s>>2],c=d-u|0,p=c>>2,(0|c)<=0)return Xf=n,1;for(c=e+16|0,_=e+32|0,m=e+12|0,A=e+20|0,(0|d)==(0|u)?(v=s,Du(v)):(y=u,g=0);;){if(kf[o>>2]=kf[y+(g<<2)>>2],kf[a>>2]=kf[o>>2],mn(e,a,i,g),u=0|np(g,r),s=0|kf[h>>2],d=t+(u<<2)|0,b=i+(u<<2)|0,(0|kf[l>>2])>0){u=0;do E=0|kf[s+(u<<2)>>2],T=0|kf[c>>2],(0|E)>(0|T)?(S=0|kf[_>>2],kf[S+(u<<2)>>2]=T,w=S):(S=0|kf[m>>2],T=0|kf[_>>2],kf[T+(u<<2)>>2]=(0|E)<(0|S)?S:E,w=T),u=u+1|0,C=0|kf[l>>2];while((0|u)<(0|C));if((0|C)>0){u=0;do s=(0|kf[d+(u<<2)>>2])+(0|kf[w+(u<<2)>>2])|0,T=b+(u<<2)|0,kf[T>>2]=s,(0|s)<=(0|kf[c>>2])?(0|s)<(0|kf[m>>2])&&(M=(0|kf[A>>2])+s|0,P=22):(M=s-(0|kf[A>>2])|0,P=22),22==(0|P)&&(P=0,kf[T>>2]=M),u=u+1|0;while((0|u)<(0|kf[l>>2]))}}if(g=g+1|0,(0|g)>=(0|p)){P=10;break}if(u=0|kf[f>>2],y=0|kf[u>>2],(0|kf[u+4>>2])-y>>2>>>0<=g>>>0){v=u,P=11;break}}return 10==(0|P)?(Xf=n,1):(11==(0|P)&&Du(v),0)}function w(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0;i=Xf,Xf=Xf+32|0,n=i+16|0,r=i+12|0,s=i,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,a=0|kf[e>>2],o=a+8|0,h=0|kf[o+4>>2],l=a+16|0,c=l,d=0|kf[c>>2],u=0|kf[c+4>>2];do if((0|h)>(0|u)|((0|h)==(0|u)?(0|kf[o>>2])>>>0>d>>>0:0)){if(c=0|If[(0|kf[a>>2])+d>>0],f=0|tc(0|d,0|u,1,0),p=l,kf[p>>2]=f,kf[p+4>>2]=qf,p=255&c,ea(n,p,0),c<<24>>24){if(f=0|kf[e>>2],_=0|Go(n,0),m=f+8|0,A=0|kf[m>>2],v=0|kf[m+4>>2],m=f+16|0,y=m,g=0|kf[y>>2],b=255&c,c=0|tc(0|g,0|kf[y+4>>2],0|b,0),y=qf,(0|v)<(0|y)|(0|v)==(0|y)&A>>>0<c>>>0){E=0;break}0|ui(0|_,(0|kf[f>>2])+g|0,0|p),p=m,g=0|tc(0|kf[p>>2],0|kf[p+4>>2],0|b,0),b=m,kf[b>>2]=g,kf[b+4>>2]=qf}if(kf[r>>2]=0,b=1^(0|Qs(r,0|kf[e>>2])),g=0|kf[r>>2],0==(0|g)|b)T=0;else{kf[s>>2]=0,b=s+4|0,kf[b>>2]=0,kf[s+8>>2]=0,(0|g)<0&&Du(s),m=0|sl(g),kf[b>>2]=m,kf[s>>2]=m,kf[s+8>>2]=m+g,p=m,m=g;do If[p>>0]=0,p=(0|kf[b>>2])+1|0,kf[b>>2]=p,m=m+-1|0;while(0!=(0|m));m=0|kf[r>>2],p=0|kf[e>>2],g=p+8|0,f=0|kf[g>>2],_=0|kf[g+4>>2],g=p+16|0,c=g,A=0|kf[c>>2],y=0|tc(0|A,0|kf[c+4>>2],0|m,0),c=qf,(0|_)<(0|c)|(0|_)==(0|c)&f>>>0<y>>>0?S=0:(0|ui(0|kf[s>>2],(0|kf[p>>2])+A|0,0|m),A=g,p=0|tc(0|kf[A>>2],0|kf[A+4>>2],0|m,0),m=g,kf[m>>2]=p,kf[m+4>>2]=qf,Nh(t,n,s),S=1),m=0|kf[s>>2],0|m&&((0|kf[b>>2])!=(0|m)&&(kf[b>>2]=m),mf(m)),T=S}E=T}else E=0;while(0);return(0|If[n+11>>0])>=0?(Xf=i,0|E):(mf(0|kf[n>>2]),Xf=i,0|E)}function C(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(n=Xf,Xf=Xf+16|0,a=n+4|0,o=n,kf[e+72>>2]=r,kf[e+64>>2]=s,s=0|ff(r>>>0>1073741823?-1:r<<2),h=e+68|0,l=0|kf[h>>2],kf[h>>2]=s,0|l&&pf(l),l=e+8|0,kf[l>>2]=r,s=e+32|0,c=e+36|0,d=0|kf[c>>2],u=0|kf[s>>2],f=d-u>>2,p=u,u=d,f>>>0>=r>>>0?(f>>>0>r>>>0?(d=p+(r<<2)|0,(0|u)!=(0|d)):0)&&(kf[c>>2]=u+(~((u+-4-d|0)>>>2)<<2)):Kr(s,r-f|0),f=e+56|0,s=0|kf[f>>2],d=0|kf[s+4>>2],u=0|kf[s>>2],c=d-u|0,p=c>>2,(0|c)<=0)return Xf=n,1;for(c=e+16|0,_=e+32|0,m=e+12|0,A=e+20|0,(0|d)==(0|u)?(v=s,Du(v)):(y=u,g=0);;){if(kf[o>>2]=kf[y+(g<<2)>>2],kf[a>>2]=kf[o>>2],_n(e,a,i,g),u=0|np(g,r),s=0|kf[h>>2],d=t+(u<<2)|0,b=i+(u<<2)|0,(0|kf[l>>2])>0){u=0;do E=0|kf[s+(u<<2)>>2],T=0|kf[c>>2],(0|E)>(0|T)?(S=0|kf[_>>2],kf[S+(u<<2)>>2]=T,w=S):(S=0|kf[m>>2],T=0|kf[_>>2],kf[T+(u<<2)>>2]=(0|E)<(0|S)?S:E,w=T),u=u+1|0,C=0|kf[l>>2];while((0|u)<(0|C));if((0|C)>0){u=0;do s=(0|kf[d+(u<<2)>>2])+(0|kf[w+(u<<2)>>2])|0,T=b+(u<<2)|0,kf[T>>2]=s,(0|s)<=(0|kf[c>>2])?(0|s)<(0|kf[m>>2])&&(M=(0|kf[A>>2])+s|0,P=22):(M=s-(0|kf[A>>2])|0,P=22),22==(0|P)&&(P=0,kf[T>>2]=M),u=u+1|0;while((0|u)<(0|kf[l>>2]))}}if(g=g+1|0,(0|g)>=(0|p)){P=10;break}if(u=0|kf[f>>2],y=0|kf[u>>2],(0|kf[u+4>>2])-y>>2>>>0<=g>>>0){v=u,P=11;break}}return 10==(0|P)?(Xf=n,1):(11==(0|P)&&Du(v),0)}function M(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=wp,A=wp,v=wp,y=0,g=0,b=0,E=0,T=0;i=0|kf[t>>2],t=e+4|0,n=0|kf[t>>2],r=0==(0|n);e:do if(r)l=0;else{if(s=n+-1|0,a=0==(s&n|0),o=a?s&i:i>>>0<n>>>0?i:(i>>>0)%(n>>>0)|0,h=0|kf[(0|kf[e>>2])+(o<<2)>>2]){if(a){for(a=h;;){if(c=0|kf[a>>2],!c){l=o;break e}if(d=0|kf[c+4>>2],!((0|d)==(0|i)|(d&s|0)==(0|o))){l=o;break e}if((0|kf[c+8>>2])==(0|i)){u=c;break}a=c}return f=u+12|0,0|f}for(p=h;;){if(a=0|kf[p>>2],!a){l=o;break e}if(s=0|kf[a+4>>2],(0|s)!=(0|i)&&(_=s>>>0<n>>>0?s:(s>>>0)%(n>>>0)|0,(0|_)!=(0|o))){l=o;break e}if((0|kf[a+8>>2])==(0|i)){u=a;break}p=a}return f=u+12|0,0|f}l=o}while(0);p=0|sl(16),kf[p+8>>2]=i,kf[p+12>>2]=0,kf[p+4>>2]=i,kf[p>>2]=0,o=e+12|0,m=ap(((0|kf[o>>2])+1|0)>>>0),A=ap(n>>>0),v=ap(Gf[e+16>>2]);do if(r|m>ap(A*v)){if(_=1&(n>>>0<3|0!=(n+-1&n|0))|n<<1,h=~~ap(ip(ap(m/v)))>>>0,Or(e,_>>>0<h>>>0?h:_),_=0|kf[t>>2],h=_+-1|0,!(h&_)){y=_,g=h&i;break}i>>>0<_>>>0?(y=_,g=i):(y=_,g=(i>>>0)%(_>>>0)|0)}else y=n,g=l;while(0);return l=(0|kf[e>>2])+(g<<2)|0,g=0|kf[l>>2],g?(kf[p>>2]=kf[g>>2],E=g,T=30):(n=e+8|0,kf[p>>2]=kf[n>>2],kf[n>>2]=p,kf[l>>2]=n,n=0|kf[p>>2],0|n&&(l=0|kf[n+4>>2],n=y+-1|0,b=n&y?l>>>0<y>>>0?l:(l>>>0)%(y>>>0)|0:l&n,E=(0|kf[e>>2])+(b<<2)|0,T=30)),30==(0|T)&&(kf[E>>2]=p),kf[o>>2]=(0|kf[o>>2])+1,u=p,f=u+12|0,0|f}function P(e,t){e=0|e,t=0|t;var i=0,n=0,r=0;kf[e>>2]=kf[t>>2],i=t+4|0,kf[e+4>>2]=kf[i>>2],n=t+8|0,kf[e+8>>2]=kf[n>>2],r=t+12|0,kf[e+12>>2]=kf[r>>2],kf[i>>2]=0,kf[n>>2]=0,kf[r>>2]=0,r=t+16|0,kf[e+16>>2]=kf[r>>2],n=t+20|0,kf[e+20>>2]=kf[n>>2],i=t+24|0,kf[e+24>>2]=kf[i>>2],kf[r>>2]=0,kf[n>>2]=0,kf[i>>2]=0,If[e+28>>0]=0|If[t+28>>0],i=e+32|0,n=t+32|0,kf[i>>2]=0,r=e+36|0,kf[r>>2]=0,kf[e+40>>2]=0,kf[i>>2]=kf[n>>2],i=t+36|0,kf[r>>2]=kf[i>>2],r=t+40|0,kf[e+40>>2]=kf[r>>2],kf[r>>2]=0,kf[i>>2]=0,kf[n>>2]=0,n=e+44|0,i=t+44|0,kf[n>>2]=0,r=e+48|0,kf[r>>2]=0,kf[e+52>>2]=0,kf[n>>2]=kf[i>>2],n=t+48|0,kf[r>>2]=kf[n>>2],r=t+52|0,kf[e+52>>2]=kf[r>>2],kf[r>>2]=0,kf[n>>2]=0,kf[i>>2]=0,i=e+56|0,n=t+56|0,kf[i>>2]=0,r=e+60|0,kf[r>>2]=0,kf[e+64>>2]=0,kf[i>>2]=kf[n>>2],i=t+60|0,kf[r>>2]=kf[i>>2],r=t+64|0,kf[e+64>>2]=kf[r>>2],kf[r>>2]=0,kf[i>>2]=0,kf[n>>2]=0,kf[e+68>>2]=kf[t+68>>2],kf[e+72>>2]=kf[t+72>>2],n=e+76|0,i=t+76|0,kf[n>>2]=0,r=e+80|0,kf[r>>2]=0,kf[e+84>>2]=0,kf[n>>2]=kf[i>>2],n=t+80|0,kf[r>>2]=kf[n>>2],r=t+84|0,kf[e+84>>2]=kf[r>>2],kf[r>>2]=0,kf[n>>2]=0,kf[i>>2]=0,i=e+88|0,n=t+88|0,kf[i>>2]=0,r=e+92|0,kf[r>>2]=0,kf[e+96>>2]=0,kf[i>>2]=kf[n>>2],i=t+92|0,kf[r>>2]=kf[i>>2],r=t+96|0,kf[e+96>>2]=kf[r>>2],kf[r>>2]=0,kf[i>>2]=0,kf[n>>2]=0,If[e+100>>0]=0|If[t+100>>0],n=e+104|0,i=t+104|0,kf[n>>2]=0,r=e+108|0,kf[r>>2]=0,kf[e+112>>2]=0,kf[n>>2]=kf[i>>2],n=t+108|0,kf[r>>2]=kf[n>>2],r=t+112|0,kf[e+112>>2]=kf[r>>2],kf[r>>2]=0,kf[n>>2]=0,kf[i>>2]=0,i=e+116|0,n=t+116|0,kf[i>>2]=0,r=e+120|0,kf[r>>2]=0,kf[e+124>>2]=0,kf[i>>2]=kf[n>>2],i=t+120|0,kf[r>>2]=kf[i>>2],r=t+124|0,kf[e+124>>2]=kf[r>>2],kf[r>>2]=0,kf[i>>2]=0,kf[n>>2]=0,kf[e+128>>2]=kf[t+128>>2],n=e+132|0,i=t+132|0,kf[n>>2]=0,r=e+136|0,kf[r>>2]=0,kf[e+140>>2]=0,kf[n>>2]=kf[i>>2],n=t+136|0,kf[r>>2]=kf[n>>2],r=t+140|0,kf[e+140>>2]=kf[r>>2],kf[r>>2]=0,kf[n>>2]=0,kf[i>>2]=0}function I(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;switch(r=Xf,Xf=Xf+32|0,s=r+8|0,a=r,0|n){case 2:n=0|kf[t+12>>2],o=0|kf[t+4>>2],kf[s>>2]=-1,kf[s+4>>2]=-1,kf[s+8>>2]=-1,kf[s+12>>2]=-1;e:do if((0|i)==-2)h=0,l=8;else{c=0|kf[(0|kf[(0|kf[o+4>>2])+8>>2])+(n<<2)>>2];do if(1==(0|Cp[127&kf[(0|kf[o>>2])+8>>2]](o))){if(ce(a,o,i,n,s,65535&((0|Lf[o+36>>0])<<8|(0|Lf[o+37>>0]))),d=0|kf[a>>2]){u=d,f=a;break e}kf[a>>2]=0;break}while(0);d=0|sl(24),kf[d+4>>2]=c,p=d+8|0,kf[p>>2]=kf[s>>2],kf[p+4>>2]=kf[s+4>>2],kf[p+8>>2]=kf[s+8>>2],kf[p+12>>2]=kf[s+12>>2],kf[d>>2]=2436,h=d,l=8}while(0);return 8==(0|l)&&(kf[a>>2]=h,u=h,f=a),kf[e>>2]=u,kf[f>>2]=0,void(Xf=r);case 3:f=0|kf[t+12>>2],u=0|kf[t+4>>2],kf[s>>2]=-1,kf[s+4>>2]=-1,kf[s+8>>2]=-1,kf[s+12>>2]=-1;e:do if((0|i)==-2)_=0,l=16;else{t=0|kf[(0|kf[(0|kf[u+4>>2])+8>>2])+(f<<2)>>2];do if(1==(0|Cp[127&kf[(0|kf[u>>2])+8>>2]](u))){if(le(a,u,i,f,s,65535&((0|Lf[u+36>>0])<<8|(0|Lf[u+37>>0]))),h=0|kf[a>>2]){m=h,A=a;break e}kf[a>>2]=0;break}while(0);c=0|sl(24),kf[c+4>>2]=t,h=c+8|0,kf[h>>2]=kf[s>>2],kf[h+4>>2]=kf[s+4>>2],kf[h+8>>2]=kf[s+8>>2],kf[h+12>>2]=kf[s+12>>2],kf[c>>2]=2492,_=c,l=16}while(0);return 16==(0|l)&&(kf[a>>2]=_,m=_,A=a),kf[e>>2]=m,kf[A>>2]=0,void(Xf=r);default:return kf[e>>2]=0,void(Xf=r)}}function R(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(n=Xf,Xf=Xf+16|0,a=n+4|0,o=n,h=e+60|0,kf[e+64>>2]=s,s=e+8|0,kf[s>>2]=r,l=e+32|0,c=e+36|0,d=0|kf[c>>2],u=0|kf[l>>2],f=d-u>>2,p=u,u=d,f>>>0>=r>>>0?(f>>>0>r>>>0?(d=p+(r<<2)|0,(0|u)!=(0|d)):0)&&(kf[c>>2]=u+(~((u+-4-d|0)>>>2)<<2)):Kr(l,r-f|0),f=e+56|0,l=0|kf[f>>2],d=0|kf[l+4>>2],u=0|kf[l>>2],c=d-u|0,p=c>>2,(0|c)<=0)return _=1,Xf=n,0|_;for(c=e+16|0,m=e+32|0,A=e+12|0,v=e+20|0,(0|d)==(0|u)?(y=l,Du(y)):(g=u,b=0);;){if(kf[o>>2]=kf[g+(b<<2)>>2],kf[a>>2]=kf[o>>2],!(0|Zi(h,a,i,b))){_=0,E=24;break}if(u=0|np(b,r),l=t+(u<<2)|0,d=i+(u<<2)|0,(0|kf[s>>2])>0){u=0;do T=0|kf[e+68+(u<<2)>>2],S=0|kf[c>>2],(0|T)>(0|S)?(w=0|kf[m>>2],kf[w+(u<<2)>>2]=S,C=w):(w=0|kf[A>>2],S=0|kf[m>>2],kf[S+(u<<2)>>2]=(0|T)<(0|w)?w:T,C=S),u=u+1|0,M=0|kf[s>>2];while((0|u)<(0|M));if((0|M)>0){u=0;do S=(0|kf[l+(u<<2)>>2])+(0|kf[C+(u<<2)>>2])|0,T=d+(u<<2)|0,kf[T>>2]=S,(0|S)<=(0|kf[c>>2])?(0|S)<(0|kf[A>>2])&&(P=(0|kf[v>>2])+S|0,E=20):(P=S-(0|kf[v>>2])|0,E=20),20==(0|E)&&(E=0,kf[T>>2]=P),u=u+1|0;while((0|u)<(0|kf[s>>2]))}}if(b=b+1|0,(0|b)>=(0|p)){_=1,E=24;break}if(u=0|kf[f>>2],g=0|kf[u>>2],(0|kf[u+4>>2])-g>>2>>>0<=b>>>0){y=u,E=8;break}}if(8==(0|E))Du(y);else if(24==(0|E))return Xf=n,0|_;return 0}function x(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(n=Xf,Xf=Xf+16|0,a=n+4|0,o=n,h=e+60|0,kf[e+64>>2]=s,s=e+8|0,kf[s>>2]=r,l=e+32|0,c=e+36|0,d=0|kf[c>>2],u=0|kf[l>>2],f=d-u>>2,p=u,u=d,f>>>0>=r>>>0?(f>>>0>r>>>0?(d=p+(r<<2)|0,(0|u)!=(0|d)):0)&&(kf[c>>2]=u+(~((u+-4-d|0)>>>2)<<2)):Kr(l,r-f|0),f=e+56|0,l=0|kf[f>>2],d=0|kf[l+4>>2],u=0|kf[l>>2],c=d-u|0,p=c>>2,(0|c)<=0)return _=1,Xf=n,0|_;for(c=e+16|0,m=e+32|0,A=e+12|0,v=e+20|0,(0|d)==(0|u)?(y=l,Du(y)):(g=u,b=0);;){if(kf[o>>2]=kf[g+(b<<2)>>2],kf[a>>2]=kf[o>>2],!(0|Xi(h,a,i,b))){_=0,E=24;break}if(u=0|np(b,r),l=t+(u<<2)|0,d=i+(u<<2)|0,(0|kf[s>>2])>0){u=0;do T=0|kf[e+68+(u<<2)>>2],S=0|kf[c>>2],(0|T)>(0|S)?(w=0|kf[m>>2],kf[w+(u<<2)>>2]=S,C=w):(w=0|kf[A>>2],S=0|kf[m>>2],kf[S+(u<<2)>>2]=(0|T)<(0|w)?w:T,C=S),u=u+1|0,M=0|kf[s>>2];while((0|u)<(0|M));if((0|M)>0){u=0;do S=(0|kf[l+(u<<2)>>2])+(0|kf[C+(u<<2)>>2])|0,T=d+(u<<2)|0,kf[T>>2]=S,(0|S)<=(0|kf[c>>2])?(0|S)<(0|kf[A>>2])&&(P=(0|kf[v>>2])+S|0,E=20):(P=S-(0|kf[v>>2])|0,E=20),20==(0|E)&&(E=0,kf[T>>2]=P),u=u+1|0;while((0|u)<(0|kf[s>>2]))}}if(b=b+1|0,(0|b)>=(0|p)){_=1,E=24;break}if(u=0|kf[f>>2],g=0|kf[u>>2],(0|kf[u+4>>2])-g>>2>>>0<=b>>>0){y=u,E=8;break}}if(8==(0|E))Du(y);else if(24==(0|E))return Xf=n,0|_;return 0}function O(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,gt(r,n,n+(e<<1)|0),p=1,Xf=s,0|p;kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0;do if(c<<24>>24){if(!(c<<24>>24<0)){f=d<<1,i=0|sl(f),kf[h>>2]=i,_=i+(d<<1)|0,kf[h+8>>2]=_,0|Bs(0|i,0,0|f),kf[n>>2]=_;break}Du(h)}while(0);gt(r,0,0+(e<<1)|0);e:do if(u){if(e=t+84|0,_=t+68|0,c<<24>>24>0)A=0,v=0;else for(f=0;;){if(y=0|If[e>>0]?f:0|kf[(0|kf[_>>2])+(f<<2)>>2],i=0|kf[h>>2],kf[o>>2]=y,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Vi(t,a,g,i))){m=0;break e}if(f=f+1|0,f>>>0>=u>>>0){m=1;break e}}for(;;){if(b=0|If[e>>0]?v:0|kf[(0|kf[_>>2])+(v<<2)>>2],f=0|kf[h>>2],kf[o>>2]=b,i=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Vi(t,a,i,f))){m=0;break e}for(f=0|kf[h>>2],i=0|kf[r>>2],g=A,E=0;;){if(xf[i+(g<<1)>>1]=0|xf[f+(E<<1)>>1],E=E+1|0,(0|E)==(0|d))break;g=g+1|0}if(v=v+1|0,v>>>0>=u>>>0){m=1;break}A=d+A|0}}else m=1;while(0);return A=0|kf[h>>2],0|A&&(h=0|kf[n>>2],(0|h)!=(0|A)&&(kf[n>>2]=h+(~((h+-2-A|0)>>>1)<<1)),mf(A)),p=m,Xf=s,0|p}function k(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,gt(r,n,n+(e<<1)|0),p=1,Xf=s,0|p;kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0;do if(c<<24>>24){if(!(c<<24>>24<0)){f=d<<1,i=0|sl(f),kf[h>>2]=i,_=i+(d<<1)|0,kf[h+8>>2]=_,0|Bs(0|i,0,0|f),kf[n>>2]=_;break}Du(h)}while(0);gt(r,0,0+(e<<1)|0);e:do if(u){if(e=t+84|0,_=t+68|0,c<<24>>24>0)A=0,v=0;else for(f=0;;){if(y=0|If[e>>0]?f:0|kf[(0|kf[_>>2])+(f<<2)>>2],i=0|kf[h>>2],kf[o>>2]=y,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Ui(t,a,g,i))){m=0;break e}if(f=f+1|0,f>>>0>=u>>>0){m=1;break e}}for(;;){if(b=0|If[e>>0]?v:0|kf[(0|kf[_>>2])+(v<<2)>>2],f=0|kf[h>>2],kf[o>>2]=b,i=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Ui(t,a,i,f))){m=0;break e}for(f=0|kf[h>>2],i=0|kf[r>>2],g=A,E=0;;){if(xf[i+(g<<1)>>1]=0|xf[f+(E<<1)>>1],E=E+1|0,(0|E)==(0|d))break;g=g+1|0}if(v=v+1|0,v>>>0>=u>>>0){m=1;break}A=d+A|0}}else m=1;while(0);return A=0|kf[h>>2],0|A&&(h=0|kf[n>>2],(0|h)!=(0|A)&&(kf[n>>2]=h+(~((h+-2-A|0)>>>1)<<1)),mf(A)),p=m,Xf=s,0|p}function D(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,bt(r,n,n+(e<<2)|0),p=1,Xf=s,0|p;kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0;do if(c<<24>>24){if(!(c<<24>>24<0)){f=d<<2,i=0|sl(f),kf[h>>2]=i,_=i+(d<<2)|0,kf[h+8>>2]=_,0|Bs(0|i,0,0|f),kf[n>>2]=_;break}Du(h)}while(0);bt(r,0,0+(e<<2)|0);e:do if(u){if(e=t+84|0,_=t+68|0,c<<24>>24>0)A=0,v=0;else for(f=0;;){if(y=0|If[e>>0]?f:0|kf[(0|kf[_>>2])+(f<<2)>>2],i=0|kf[h>>2],kf[o>>2]=y,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Gi(t,a,g,i))){m=0;break e}if(f=f+1|0,f>>>0>=u>>>0){m=1;break e}}for(;;){if(b=0|If[e>>0]?v:0|kf[(0|kf[_>>2])+(v<<2)>>2],f=0|kf[h>>2],kf[o>>2]=b,i=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Gi(t,a,i,f))){m=0;break e}for(f=0|kf[h>>2],i=0|kf[r>>2],g=A,E=0;;){if(kf[i+(g<<2)>>2]=kf[f+(E<<2)>>2],E=E+1|0,(0|E)==(0|d))break;g=g+1|0}if(v=v+1|0,v>>>0>=u>>>0){m=1;break}A=d+A|0}}else m=1;while(0);return A=0|kf[h>>2],0|A&&(h=0|kf[n>>2],(0|h)!=(0|A)&&(kf[n>>2]=h+(~((h+-4-A|0)>>>2)<<2)),mf(A)),p=m,Xf=s,0|p}function L(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,bt(r,n,n+(e<<2)|0),p=1,Xf=s,0|p;kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0;do if(c<<24>>24){if(!(c<<24>>24<0)){f=d<<2,i=0|sl(f),kf[h>>2]=i,_=i+(d<<2)|0,kf[h+8>>2]=_,0|Bs(0|i,0,0|f),kf[n>>2]=_;break}Du(h)}while(0);bt(r,0,0+(e<<2)|0);e:do if(u){if(e=t+84|0,_=t+68|0,c<<24>>24>0)A=0,v=0;else for(f=0;;){if(y=0|If[e>>0]?f:0|kf[(0|kf[_>>2])+(f<<2)>>2],i=0|kf[h>>2],kf[o>>2]=y,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Wi(t,a,g,i))){m=0;break e}if(f=f+1|0,f>>>0>=u>>>0){m=1;break e}}for(;;){if(b=0|If[e>>0]?v:0|kf[(0|kf[_>>2])+(v<<2)>>2],f=0|kf[h>>2],kf[o>>2]=b,i=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Wi(t,a,i,f))){m=0;break e}for(f=0|kf[h>>2],i=0|kf[r>>2],g=A,E=0;;){if(kf[i+(g<<2)>>2]=kf[f+(E<<2)>>2],E=E+1|0,(0|E)==(0|d))break;g=g+1|0}if(v=v+1|0,v>>>0>=u>>>0){m=1;break}A=d+A|0}}else m=1;while(0);return A=0|kf[h>>2],0|A&&(h=0|kf[n>>2],(0|h)!=(0|A)&&(kf[n>>2]=h+(~((h+-4-A|0)>>>2)<<2)),mf(A)),p=m,Xf=s,0|p}function N(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(n=t+8|0,r=0|kf[n+4>>2],s=t+16|0,a=s,o=0|kf[a>>2],h=0|kf[a+4>>2],!((0|r)>(0|h)|((0|r)==(0|h)?(0|kf[n>>2])>>>0>o>>>0:0)))return l=0,0|l;n=0|If[(0|kf[t>>2])+o>>0],r=0|tc(0|o,0|h,1,0),h=s,kf[h>>2]=r,kf[h+4>>2]=qf;do switch(n<<24>>24){case 1:return l=0|Ze(e,t,i),0|l;case 2:return l=0|Ze(e,t,i),0|l;case 3:return l=0|Ze(e,t,i),0|l;case 4:return l=0|Ze(e,t,i),0|l;case 5:return l=0|Ze(e,t,i),0|l;case 6:return l=0|Ze(e,t,i),0|l;case 7:return l=0|Ze(e,t,i),0|l;case 8:return l=0|Ze(e,t,i),0|l;case 9:return l=0|Xe(e,t,i),0|l;case 10:return l=0|Ye(e,t,i),0|l;case 11:return l=0|je(e,t,i),0|l;case 12:return l=0|He(e,t,i),0|l;case 13:return l=0|ze(e,t,i),0|l;case 14:return l=0|We(e,t,i),0|l;case 15:return l=0|We(e,t,i),0|l;case 16:return l=0|We(e,t,i),0|l;case 17:return l=0|We(e,t,i),0|l;case 18:return l=0|We(e,t,i),0|l;default:return l=0,0|l}while(0);return 0}function F(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,Vt(r,n,n+e|0),p=1,Xf=s,0|p;if(kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0,c<<24>>24){c<<24>>24<0&&Du(h),f=0|sl(d),kf[n>>2]=f,kf[h>>2]=f,kf[h+8>>2]=f+d,i=f,f=d;do If[i>>0]=0,i=(0|kf[n>>2])+1|0,kf[n>>2]=i,f=f+-1|0;while(0!=(0|f))}Vt(r,0,0+e|0);e:do if(u){if(e=t+84|0,f=t+68|0,c<<24>>24>0)m=0,A=0;else for(i=0;;){if(v=0|If[e>>0]?i:0|kf[(0|kf[f>>2])+(i<<2)>>2],y=0|kf[h>>2],kf[o>>2]=v,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Hi(t,a,g,y))){_=0;break e}if(i=i+1|0,i>>>0>=u>>>0){_=1;break e}}for(;;){if(b=0|If[e>>0]?A:0|kf[(0|kf[f>>2])+(A<<2)>>2],i=0|kf[h>>2],kf[o>>2]=b,y=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|Hi(t,a,y,i))){_=0;break e}for(E=m,T=0;;){if(If[(0|kf[r>>2])+E>>0]=0|If[(0|kf[h>>2])+T>>0],T=T+1|0,(0|T)==(0|d))break;E=E+1|0}if(A=A+1|0,A>>>0>=u>>>0){_=1;break}m=d+m|0}}else _=1;while(0);return m=0|kf[h>>2],0|m&&((0|kf[n>>2])!=(0|m)&&(kf[n>>2]=m),mf(m)),p=_,Xf=s,0|p}function B(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+12|0,h=s,l=t+24|0,c=0|If[l>>0],d=c<<24>>24,u=0|kf[e+80>>2],e=0|np(u,d),f=0|kf[t+28>>2],(0|f)==(0|i)|(0|f)==(0|n)?0|If[t+84>>0]:0)return n=(0|kf[kf[t>>2]>>2])+(0|kf[t+48>>2])|0,Vt(r,n,n+e|0),p=1,Xf=s,0|p;if(kf[h>>2]=0,n=h+4|0,kf[n>>2]=0,kf[h+8>>2]=0,c<<24>>24){c<<24>>24<0&&Du(h),f=0|sl(d),kf[n>>2]=f,kf[h>>2]=f,kf[h+8>>2]=f+d,i=f,f=d;do If[i>>0]=0,i=(0|kf[n>>2])+1|0,kf[n>>2]=i,f=f+-1|0;while(0!=(0|f))}Vt(r,0,0+e|0);e:do if(u){if(e=t+84|0,f=t+68|0,c<<24>>24>0)m=0,A=0;else for(i=0;;){if(v=0|If[e>>0]?i:0|kf[(0|kf[f>>2])+(i<<2)>>2],y=0|kf[h>>2],kf[o>>2]=v,g=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|ji(t,a,g,y))){_=0;break e}if(i=i+1|0,i>>>0>=u>>>0){_=1;break e}}for(;;){if(b=0|If[e>>0]?A:0|kf[(0|kf[f>>2])+(A<<2)>>2],i=0|kf[h>>2],kf[o>>2]=b,y=0|If[l>>0],kf[a>>2]=kf[o>>2],!(0|ji(t,a,y,i))){_=0;break e}for(E=m,T=0;;){if(If[(0|kf[r>>2])+E>>0]=0|If[(0|kf[h>>2])+T>>0],T=T+1|0,(0|T)==(0|d))break;E=E+1|0}if(A=A+1|0,A>>>0>=u>>>0){_=1;break}m=d+m|0}}else _=1;while(0);return m=0|kf[h>>2],0|m&&((0|kf[n>>2])!=(0|m)&&(kf[n>>2]=m),mf(m)),p=_,Xf=s,0|p}function V(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(i=Xf,Xf=Xf+32|0,n=i+16|0,r=i,(0|Ff[t+38>>1])<514){if(s=t+8|0,a=0|kf[s+4>>2],o=t+16|0,h=o,l=0|kf[h>>2],c=0|kf[h+4>>2],!((0|a)>(0|c)|((0|a)==(0|c)?(0|kf[s>>2])>>>0>l>>>0:0)))return d=0,Xf=i,0|d;if(s=0|If[(0|kf[t>>2])+l>>0],a=0|tc(0|l,0|c,1,0),c=o,kf[c>>2]=a,kf[c+4>>2]=qf,s<<24>>24)return d=0,Xf=i,0|d}s=0;do{if(0|Qs(n,t),c=0|kf[n>>2],0|c){if(a=e+60+(12*s|0)|0,W(a,c,0),rd(r),!(0|ie(r,t))){u=12;break}if(0|kf[n>>2]){c=0;do o=0|Qa(r),l=(0|kf[a>>2])+(c>>>5<<2)|0,h=1<<(31&c),f=0|kf[l>>2],kf[l>>2]=o?f|h:f&~h,c=c+1|0;while(c>>>0<(0|kf[n>>2])>>>0)}bf(r)}s=s+1|0}while((0|s)<4);return 12==(0|u)?(bf(r),d=0,Xf=i,0|d):(r=t+8|0,u=0|kf[r>>2],s=0|kf[r+4>>2],r=t+16|0,n=r,c=0|kf[n>>2],a=0|kf[n+4>>2],n=0|tc(0|c,0|a,4,0),h=qf,(0|s)<(0|h)|(0|s)==(0|h)&u>>>0<n>>>0?(d=0,Xf=i,0|d):(f=0|kf[t>>2],t=f+c|0,o=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,t=r,kf[t>>2]=n,kf[t+4>>2]=h,h=0|tc(0|c,0|a,8,0),a=qf,(0|s)<(0|a)|(0|s)==(0|a)&u>>>0<h>>>0?(d=0,Xf=i,0|d):(u=f+n|0,n=Lf[u>>0]|Lf[u+1>>0]<<8|Lf[u+2>>0]<<16|Lf[u+3>>0]<<24,u=r,kf[u>>2]=h,kf[u+4>>2]=a,(0|o)>(0|n)?(d=0,Xf=i,0|d):(kf[e+12>>2]=o,kf[e+16>>2]=n,a=0|nc(0|n,((0|n)<0)<<31>>31|0,0|o,((0|o)<0)<<31>>31|0),o=qf,o>>>0<0|0==(0|o)&a>>>0<2147483647?(o=a+1|0,kf[e+20>>2]=o,a=(0|o)/2|0,n=e+24|0,kf[n>>2]=a,kf[e+28>>2]=0-a,1&o|0?(d=1,Xf=i,0|d):(kf[n>>2]=a+-1,d=1,Xf=i,0|d)):(d=0,Xf=i,0|d)))))}function U(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0;if(r=0|kf[t>>2],s=0|kf[t+4>>2],a=((0|kf[i>>2])-r<<3)+(0|kf[i+4>>2])-s|0,i=r,(0|a)<=0)return o=n+4|0,h=0|kf[n>>2],kf[e>>2]=h,l=e+4|0,c=0|kf[o>>2],void(kf[l>>2]=c);if(s?(r=32-s|0,_=(0|a)<(0|r)?a:r,m=-1>>>(r-_|0)&-1<<s&kf[i>>2],r=n+4|0,A=0|kf[r>>2],v=32-A|0,y=v>>>0<_>>>0?v:_,g=0|kf[n>>2],b=kf[g>>2]&~(-1>>>(v-y|0)&-1<<A),kf[g>>2]=b,A=0|kf[r>>2],kf[g>>2]=(A>>>0>s>>>0?m<<A-s:m>>>(s-A|0))|b,b=(0|kf[r>>2])+y|0,A=g+(b>>>5<<2)|0,kf[n>>2]=A,g=31&b,kf[r>>2]=g,b=_-y|0,(0|b)>0?(kf[A>>2]=m>>>(s+y|0)|kf[A>>2]&~(-1>>>(32-b|0)),kf[r>>2]=b,E=b):E=g,g=i+4|0,kf[t>>2]=g,d=E,u=g,f=r,p=a-_|0):(r=n+4|0,d=0|kf[r>>2],u=i,f=r,p=a),_=32-d|0,a=-1<<d,(0|p)>31){for(d=~a,r=0|kf[n>>2],g=p+-32|0,E=g>>>5,i=E+1|0,b=g-(E<<5)|0,E=0|kf[r>>2],g=r,A=p,y=u;;){if(s=0|kf[y>>2],m=E&d,kf[g>>2]=m,kf[g>>2]=s<<kf[f>>2]|m,g=g+4|0,E=kf[g>>2]&a|s>>>_,kf[g>>2]=E,A=A+-32|0,(0|A)<=31)break;y=y+4|0}y=u+(i<<2)|0,kf[t>>2]=y,kf[n>>2]=r+(i<<2),T=y,S=b}else T=u,S=p;return(0|S)<=0?(o=f,h=0|kf[n>>2],kf[e>>2]=h,l=e+4|0,c=0|kf[o>>2],void(kf[l>>2]=c)):(p=kf[T>>2]&-1>>>(32-S|0),T=(0|_)<(0|S)?_:S,u=0|kf[n>>2],b=kf[u>>2]&~(-1<<kf[f>>2]&-1>>>(_-T|0)),kf[u>>2]=b,kf[u>>2]=b|p<<kf[f>>2],b=(0|kf[f>>2])+T|0,_=u+(b>>>5<<2)|0,kf[n>>2]=_,kf[f>>2]=31&b,b=S-T|0,(0|b)<=0?(o=f,h=0|kf[n>>2],kf[e>>2]=h,l=e+4|0,c=0|kf[o>>2],void(kf[l>>2]=c)):(kf[_>>2]=kf[_>>2]&~(-1>>>(32-b|0))|p>>>T,kf[f>>2]=b,o=f,h=0|kf[n>>2],kf[e>>2]=h,l=e+4|0,c=0|kf[o>>2],void(kf[l>>2]=c)))}function G(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;i=Xf,Xf=Xf+32|0,n=i+16|0,r=i,kf[n>>2]=0;do{if((0|Ff[t+38>>1])<514){if(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return d=0,Xf=i,0|d;a=(0|kf[t>>2])+l|0,l=Lf[a>>0]|Lf[a+1>>0]<<8|Lf[a+2>>0]<<16|Lf[a+3>>0]<<24,kf[n>>2]=l,a=s,kf[a>>2]=c,kf[a+4>>2]=h,u=l;break}if(0|Qs(n,t)){u=0|kf[n>>2];break}return d=0,Xf=i,0|d}while(0);if(!u)return d=0,Xf=i,0|d;if(l=e+76|0,W(l,u,0),rd(r),0|ie(r,t)){if(0|kf[n>>2]){u=0,h=1;do h^=1^(0|Qa(r)),a=(0|kf[l>>2])+(u>>>5<<2)|0,c=1<<(31&u),s=0|kf[a>>2],kf[a>>2]=h?s|c:s&~c,u=u+1|0;while(u>>>0<(0|kf[n>>2])>>>0)}n=t+8|0,u=0|kf[n>>2],h=0|kf[n+4>>2],n=t+16|0,l=n,c=0|kf[l>>2],s=0|kf[l+4>>2],l=0|tc(0|c,0|s,4,0),a=qf,((!!((0|h)<(0|a)|(0|h)==(0|a)&u>>>0<l>>>0)||(o=0|kf[t>>2],t=o+c|0,f=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,t=n,kf[t>>2]=l,kf[t+4>>2]=a,a=0|tc(0|c,0|s,8,0),s=qf,(0|h)<(0|s)|(0|h)==(0|s)&u>>>0<a>>>0)?0:(u=o+l|0,l=Lf[u>>0]|Lf[u+1>>0]<<8|Lf[u+2>>0]<<16|Lf[u+3>>0]<<24,u=n,kf[u>>2]=a,kf[u+4>>2]=s,(0|f)<=(0|l)))?(kf[e+12>>2]=f,kf[e+16>>2]=l,s=0|nc(0|l,((0|l)<0)<<31>>31|0,0|f,((0|f)<0)<<31>>31|0),f=qf,f>>>0<0|0==(0|f)&s>>>0<2147483647):0)?(f=s+1|0,kf[e+20>>2]=f,s=(0|f)/2|0,l=e+24|0,kf[l>>2]=s,kf[e+28>>2]=0-s,1&f?p=1:(kf[l>>2]=s+-1,p=1)):p=0}else p=0;return bf(r),d=p,Xf=i,0|d}function W(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;return n=Xf,Xf=Xf+32|0,r=n+8|0,s=n,a=e+4|0,o=0|kf[a>>2],o>>>0>=t>>>0?(kf[a>>2]=t,void(Xf=n)):(h=e+8|0,l=0|kf[h>>2],c=l<<5,d=t-o|0,c>>>0<d>>>0|o>>>0>(c-d|0)>>>0?(kf[r>>2]=0,u=r+4|0,kf[u>>2]=0,f=r+8|0,kf[f>>2]=0,(0|t)<0&&Du(e),p=l<<6,l=t+31&-32,Hr(r,c>>>0<1073741823?p>>>0<l>>>0?l:p:2147483647),p=0|kf[a>>2],kf[u>>2]=p+d,l=0|kf[e>>2],c=l,_=0|kf[r>>2],m=(c+(p>>>5<<2)-l<<3)+(31&p)|0,(0|m)>0?(p=m>>>5,0|Sh(0|_,0|l,p<<2|0),l=m-(p<<5)|0,m=_+(p<<2)|0,A=m,(0|l)>0?(v=-1>>>(32-l|0),kf[m>>2]=kf[m>>2]&~v|kf[c+(p<<2)>>2]&v,y=A,g=l):(y=A,g=0)):(y=_,g=0),kf[s>>2]=y,kf[s+4>>2]=g,g=s,s=0|kf[g>>2],y=0|kf[g+4>>2],g=0|kf[e>>2],kf[e>>2]=kf[r>>2],kf[r>>2]=g,r=0|kf[a>>2],kf[a>>2]=kf[u>>2],kf[u>>2]=r,r=0|kf[h>>2],kf[h>>2]=kf[f>>2],kf[f>>2]=r,0|g&&mf(g),b=s,E=y):(y=(0|kf[e>>2])+(o>>>5<<2)|0,kf[a>>2]=t,b=y,E=31&o),d?(o=0==(0|E),y=b,i?(o?(T=b,S=y,w=d):(i=32-E|0,t=i>>>0>d>>>0?d:i,kf[y>>2]=kf[y>>2]|-1>>>(i-t|0)&-1<<E,i=y+4|0,T=i,S=i,w=d-t|0),t=w>>>5,0|Bs(0|T,-1,t<<2|0),T=w-(t<<5)|0,w=S+(t<<2)|0,T?(kf[w>>2]=kf[w>>2]|-1>>>(32-T|0),void(Xf=n)):void(Xf=n)):(o?(C=b,M=y,P=d):(b=32-E|0,o=b>>>0>d>>>0?d:b,kf[y>>2]=kf[y>>2]&~(-1>>>(b-o|0)&-1<<E),E=y+4|0,C=E,M=E,P=d-o|0),o=P>>>5,0|Bs(0|C,0,o<<2|0),C=P-(o<<5)|0,P=M+(o<<2)|0,C?(kf[P>>2]=kf[P>>2]&~(-1>>>(32-C|0)),void(Xf=n)):void(Xf=n))):void(Xf=n))}function z(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0;if(r=0|kf[t>>2],s=t+4|0,a=0|kf[s>>2],o=((0|kf[i>>2])-r<<3)+(0|kf[i+4>>2])-a|0,i=r,(0|o)<=0)return h=n+4|0,l=0|kf[n>>2],kf[e>>2]=l,c=e+4|0,d=0|kf[h>>2],void(kf[c>>2]=d);if(a?(r=32-a|0,m=(0|o)<(0|r)?o:r,A=-1>>>(r-m|0)&-1<<a&kf[i>>2],i=n+4|0,a=0|kf[i>>2],r=32-a|0,v=r>>>0<m>>>0?r:m,y=0|kf[n>>2],g=kf[y>>2]&~(-1>>>(r-v|0)&-1<<a),kf[y>>2]=g,a=0|kf[i>>2],r=0|kf[s>>2],kf[y>>2]=(a>>>0>r>>>0?A<<a-r:A>>>(r-a|0))|g,g=(0|kf[i>>2])+v|0,a=y+(g>>>5<<2)|0,kf[n>>2]=a,y=31&g,kf[i>>2]=y,g=m-v|0,(0|g)>0?(r=kf[a>>2]&~(-1>>>(32-g|0)),kf[a>>2]=r,kf[a>>2]=A>>>((0|kf[s>>2])+v|0)|r,kf[i>>2]=g,b=g):b=y,y=(0|kf[t>>2])+4|0,kf[t>>2]=y,u=b,f=y,p=i,_=o-m|0):(r=n+4|0,u=0|kf[r>>2],f=i,p=r,_=o),m=32-u|0,o=-1<<u,(0|_)>31){u=~o,i=f,y=_;do b=0|kf[i>>2],g=0|kf[n>>2],r=kf[g>>2]&u,kf[g>>2]=r,kf[g>>2]=b<<kf[p>>2]|r,r=g+4|0,kf[n>>2]=r,kf[r>>2]=kf[r>>2]&o|b>>>m,y=y+-32|0,i=(0|kf[t>>2])+4|0,kf[t>>2]=i;while((0|y)>31);E=i,T=31&_}else E=f,T=_;return(0|T)<=0?(h=p,l=0|kf[n>>2],kf[e>>2]=l,c=e+4|0,d=0|kf[h>>2],void(kf[c>>2]=d)):(_=kf[E>>2]&-1>>>(32-T|0),E=(0|m)<(0|T)?m:T,f=0|kf[n>>2],i=kf[f>>2]&~(-1<<kf[p>>2]&-1>>>(m-E|0)),kf[f>>2]=i,kf[f>>2]=i|_<<kf[p>>2],i=(0|kf[p>>2])+E|0,m=f+(i>>>5<<2)|0,kf[n>>2]=m,kf[p>>2]=31&i,i=T-E|0,(0|i)<=0?(h=p,l=0|kf[n>>2],kf[e>>2]=l,c=e+4|0,d=0|kf[h>>2],void(kf[c>>2]=d)):(kf[m>>2]=kf[m>>2]&~(-1>>>(32-i|0))|_>>>E,kf[p>>2]=i,h=p,l=0|kf[n>>2],kf[e>>2]=l,c=e+4|0,d=0|kf[h>>2],void(kf[c>>2]=d)))}function H(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,
Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+4194304|0,kf[e+48>>2]=v,c=v>>>0<1073741824,Xf=i,0|c}function j(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+2097152|0,kf[e+48>>2]=v,c=v>>>0<536870912,Xf=i,0|c}function Y(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+1048576|0,kf[e+48>>2]=v,c=v>>>0<268435456,Xf=i,0|c}function X(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+262144|0,kf[e+48>>2]=v,c=v>>>0<67108864,Xf=i,0|c}function Z(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+131072|0,kf[e+48>>2]=v,c=v>>>0<33554432,Xf=i,0|c}function K(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+32768|0,kf[e+48>>2]=v,c=v>>>0<8388608,Xf=i,0|c}function Q(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=Xf,Xf=Xf+16|0,n=i;do{if((0|Ff[t+38>>1])<512){if(r=t+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return c=0,Xf=i,0|c;d=(0|kf[t>>2])+h|0,h=d,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=d+4|0,d=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=n,kf[h>>2]=u,kf[h+4>>2]=d,h=r,kf[h>>2]=l,kf[h+4>>2]=o,f=s,p=a,_=l,m=o,A=d,v=u,y=r;break}if(0|Es(n,t)){r=n,u=t+8|0,d=t+16|0,o=d,f=0|kf[u>>2],p=0|kf[u+4>>2],_=0|kf[o>>2],m=0|kf[o+4>>2],A=0|kf[r+4>>2],v=0|kf[r>>2],y=d;break}return c=0,Xf=i,0|c}while(0);if(n=0|nc(0|f,0|p,0|_,0|m),p=qf,A>>>0>p>>>0|(0|A)==(0|p)&v>>>0>n>>>0)return c=0,Xf=i,0|c;if(n=(0|kf[t>>2])+_|0,t=0|tc(0|_,0|m,0|v,0|A),A=y,kf[A>>2]=t,kf[A+4>>2]=qf,(0|v)<1)return c=0,Xf=i,0|c;kf[e+40>>2]=n,A=v+-1|0,t=n+A|0;e:do switch((0|Lf[t>>0])>>>6&3){case 0:kf[e+44>>2]=A,g=63&If[t>>0];break;case 1:if((0|v)<2)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-2,y=n+v+-2|0,g=(0|Lf[y+1>>0])<<8&16128|(0|Lf[y>>0]);break e;case 2:if((0|v)<3)return c=0,Xf=i,0|c;kf[e+44>>2]=v+-3,y=n+v+-3|0,g=(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])|(0|Lf[y+2>>0])<<16&4128768;break e;case 3:kf[e+44>>2]=v+-4,y=n+v+-4|0,g=(0|Lf[y+2>>0])<<16|(0|Lf[y+3>>0])<<24&1056964608|(0|Lf[y+1>>0])<<8|(0|Lf[y>>0])}while(0);return v=g+16384|0,kf[e+48>>2]=v,c=v>>>0<4194304,Xf=i,0|c}function J(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(t=e+32|0,i=0|kf[t>>2],n=i+8|0,r=0|kf[n+4>>2],s=i+16|0,a=s,o=0|kf[a>>2],h=0|kf[a+4>>2],!((0|r)>(0|h)|((0|r)==(0|h)?(0|kf[n>>2])>>>0>o>>>0:0)))return l=0,0|l;n=0|If[(0|kf[i>>2])+o>>0],i=0|tc(0|o,0|h,1,0),h=s,kf[h>>2]=i,kf[h+4>>2]=qf,h=255&n,i=n<<24>>24==0;e:do if(!i){for(n=0;;){if(!(0|Mp[127&kf[(0|kf[e>>2])+16>>2]](e,n))){l=0;break}if(n=n+1|0,(0|n)>=(0|h))break e}return 0|l}while(0);n=e+8|0,s=0|kf[n>>2],o=0|kf[e+12>>2];e:do if((0|s)!=(0|o)){for(r=e+4|0,a=s;;){if(c=0|kf[a>>2],a=a+4|0,!(0|Pp[31&kf[(0|kf[c>>2])+8>>2]](c,e,0|kf[r>>2]))){l=0;break}if((0|a)==(0|o))break e}return 0|l}while(0);if(!i){o=0;do if(s=0|kf[(0|kf[n>>2])+(o<<2)>>2],o=o+1|0,!(0|Mp[127&kf[(0|kf[s>>2])+12>>2]](s,0|kf[t>>2]))){l=0,d=26;break}while((0|o)<(0|h));if(26==(0|d))return 0|l;if(!i){i=e+20|0,d=e+24|0,o=0;do{if(t=0|kf[(0|kf[n>>2])+(o<<2)>>2],s=0|Cp[127&kf[(0|kf[t>>2])+24>>2]](t),(0|s)>0){t=0;do{a=0|kf[(0|kf[n>>2])+(o<<2)>>2],r=0|Mp[127&kf[(0|kf[a>>2])+20>>2]](a,t),a=0|kf[d>>2],c=0|kf[i>>2],u=a-c>>2,f=c;do if(r>>>0>=u>>>0){if(c=r+1|0,p=a,c>>>0>u>>>0){Kr(i,c-u|0),_=0|kf[i>>2];break}(c>>>0<u>>>0?(m=f+(c<<2)|0,(0|p)!=(0|m)):0)?(kf[d>>2]=p+(~((p+-4-m|0)>>>2)<<2),_=f):_=f}else _=f;while(0);kf[_+(r<<2)>>2]=o,t=t+1|0}while((0|t)!=(0|s))}o=o+1|0}while((0|o)!=(0|h))}}return 0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e)?(l=0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e),0|l):(l=0,0|l)}function q(e){e=0|e;var t=0,i=0,n=0,r=0;if(kf[e>>2]=3072,t=e+368|0,i=0|kf[t>>2],kf[t>>2]=0,0|i){if(t=i+-4|0,n=0|kf[t>>2],0|n){r=i+(n<<4)|0;do r=r+-16|0,bf(r);while((0|r)!=(0|i))}pf(t)}if(bf(e+352|0),bf(e+312|0),bf(e+296|0),bf(e+256|0),Qr(e+216|0),t=0|kf[e+196>>2],0|t&&(i=e+200|0,r=0|kf[i>>2],(0|r)!=(0|t)&&(kf[i>>2]=r+(~((r+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+184>>2],0|t&&(r=e+188|0,i=0|kf[r>>2],(0|i)!=(0|t)&&(kf[r>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+172>>2],0|t&&(i=e+176|0,r=0|kf[i>>2],(0|r)!=(0|t)&&(kf[i>>2]=r+(~((r+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+160>>2],0|t&&(r=e+164|0,i=0|kf[r>>2],(0|i)!=(0|t)&&(kf[r>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+144>>2],0|t){i=t;do t=i,i=0|kf[i>>2],mf(t);while(0!=(0|i))}i=e+136|0,t=0|kf[i>>2],kf[i>>2]=0,0|t&&mf(t),t=0|kf[e+120>>2],0|t&&mf(t),t=0|kf[e+108>>2],0|t&&mf(t),t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&(i=e+76|0,r=0|kf[i>>2],(0|r)!=(0|t)&&(kf[i>>2]=r+(~((r+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+60>>2],0|t&&mf(t),t=0|kf[e+48>>2],0|t&&(r=e+52|0,i=0|kf[r>>2],(0|i)!=(0|t)&&(kf[r>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+36>>2],0|t&&(i=e+40|0,r=0|kf[i>>2],(0|r)!=(0|t)&&(kf[i>>2]=r+(12*~(((r+-12-t|0)>>>0)/12|0)|0)),mf(t)),t=0|kf[e+24>>2],0|t&&(r=e+28|0,i=0|kf[r>>2],(0|i)!=(0|t)&&(kf[r>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+12>>2],0|t&&(i=e+16|0,r=0|kf[i>>2],(0|r)!=(0|t)&&(kf[i>>2]=r+(~((r+-4-t|0)>>>2)<<2)),mf(t)),t=e+8|0,e=0|kf[t>>2],kf[t>>2]=0,e&&(is(e),mf(e))}function $(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(t=Xf,Xf=Xf+16|0,i=t,n=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),(0|n)<=0)return r=1,Xf=t,0|r;for(s=e+36|0,a=e+48|0,o=i+8|0,h=i+4|0,l=i+11|0,c=0;;){if(d=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+40|0,0!=(0|kf[d>>2])?(d=0|kf[(0|kf[s>>2])+(c<<2)>>2],u=0|kf[d+8>>2],f=0|yr(d),0!=(0|f)):0){d=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+40|0,p=0|kf[d>>2],d=0|kf[u+56>>2],u=0|sl(32),kf[i>>2]=u,kf[o>>2]=-2147483616,kf[h>>2]=24,_=u,m=11771,A=_+24|0;do If[_>>0]=0|If[m>>0],_=_+1|0,m=m+1|0;while((0|_)<(0|A));if(If[u+24>>0]=0,m=p+16|0,_=0|kf[m>>2]){A=m,v=_;e:for(;;){for(_=v;;){if((0|kf[_+16>>2])>=(0|d))break;if(y=0|kf[_+4>>2],!y){g=A;break e}_=y}if(v=0|kf[_>>2],!v){g=_;break}A=_}(((0|g)!=(0|m)?(0|d)>=(0|kf[g+16>>2]):0)?(A=g+20|0,0!=(0|mr(A,i))):0)?b=0|ma(A,i,0):E=14}else E=14;14==(0|E)&&(E=0,b=0|ma(p,i,0)),(0|If[l>>0])<0&&mf(0|kf[i>>2]),b?ke(0|kf[(0|kf[(0|kf[s>>2])+(c<<2)>>2])+8>>2],f):E=19}else E=19;if(19==(0|E)?(E=0,A=0|kf[(0|kf[s>>2])+(c<<2)>>2],!(0|Mp[127&kf[(0|kf[A>>2])+24>>2]](A,a))):0){r=0,E=21;break}if(c=c+1|0,(0|c)>=(0|n)){r=1,E=21;break}}return 21==(0|E)?(Xf=t,0|r):0}function ee(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(n=Xf,Xf=Xf+32|0,r=n+12|0,s=n,a=t+24|0,o=0|If[a>>0],h=o<<24>>24,kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,kf[r+8>>2]=0,o<<24>>24){o<<24>>24<0&&Du(r),o=0|sl(h),kf[l>>2]=o,kf[r>>2]=o,kf[r+8>>2]=o+h,d=o,o=h;do If[d>>0]=0,d=(0|kf[l>>2])+1|0,kf[l>>2]=d,o=o+-1|0;while(0!=(0|o));c=0|If[a>>0]}else c=0;if(o=c<<24>>24,kf[s>>2]=0,d=s+4|0,kf[d>>2]=0,kf[s+8>>2]=0,c<<24>>24){c<<24>>24<0&&Du(s),c=0|sl(o),kf[d>>2]=c,kf[s>>2]=c,kf[s+8>>2]=c+o,h=c,c=o;do If[h>>0]=0,h=(0|kf[d>>2])+1|0,kf[d>>2]=h,c=c+-1|0;while(0!=(0|c))}if(c=t+80|0,0|kf[c>>2]){h=t+48|0,o=t+40|0,f=t+64|0,p=e+48|0,e=0;do{if(_=0|kf[r>>2],m=h,A=0|kf[m>>2],v=0|kf[m+4>>2],m=o,y=0|kf[m>>2],g=0|pl(0|y,0|kf[m+4>>2],0|e,0),m=0|tc(0|g,0|qf,0|A,0|v),0|ui(0|_,(0|kf[kf[t>>2]>>2])+m|0,0|y),(0|If[a>>0])>0?(If[kf[s>>2]>>0]=(0|kf[(0|kf[p>>2])+(i<<2)>>2])+(0|Lf[_>>0]),(0|If[a>>0])>1):0){_=1;do If[(0|kf[s>>2])+_>>0]=(0|kf[(0|kf[p>>2])+(_+i<<2)>>2])+(0|Lf[(0|kf[r>>2])+_>>0]),_=_+1|0;while((0|_)<(0|If[a>>0]))}_=0|kf[s>>2],y=o,m=0|kf[y>>2],v=0|pl(0|m,0|kf[y+4>>2],0|e,0),0|ui((0|kf[kf[f>>2]>>2])+v|0,0|_,0|m),e=e+1|0}while(e>>>0<(0|kf[c>>2])>>>0);u=_}else u=0|kf[s>>2];return 0|u&&((0|kf[d>>2])!=(0|u)&&(kf[d>>2]=u),mf(u)),(u=0|kf[r>>2])?((0|kf[l>>2])!=(0|u)&&(kf[l>>2]=u),mf(u),Xf=n,1):(Xf=n,1)}function te(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0;return r=t+12|0,s=0|kf[r>>2],a=(0|kf[i>>2])-s|0,o=i+4|0,h=(0|kf[o>>2])-s|0,l=i,kf[l>>2]=a,kf[l+4>>2]=h,l=0|kf[r>>2],(((0|h)>-1?h:0-h|0)+((0|a)>-1?a:0-a|0)|0)>(0|l)?((h|a|0)>-1?(c=1,d=1):(u=(0|a)<1&(0|h)<1,c=u?-1:(0|a)>0?1:-1,d=u?-1:(0|h)>0?1:-1),u=0|np(l,c),f=0|np(l,d),p=(a<<1)-u|0,kf[i>>2]=p,_=(h<<1)-f|0,kf[o>>2]=_,(0|np(c,d))>-1?(d=0-_|0,kf[i>>2]=d,m=0-p|0,A=d):(kf[i>>2]=_,m=p,A=_),_=(A+u|0)/2|0,kf[i>>2]=_,i=(m+f|0)/2|0,kf[o>>2]=i,v=_,y=i,g=0|kf[r>>2],b=0):(v=a,y=h,g=l,b=1),l=(0|kf[n>>2])+v|0,kf[e>>2]=l,v=(0|kf[n+4>>2])+y|0,y=e+4|0,kf[y>>2]=v,E=(0|g)>=(0|l)?(0|l)<(0-g|0)?(0|kf[t+4>>2])+l|0:l:l-(0|kf[t+4>>2])|0,kf[e>>2]=E,T=(0|g)>=(0|v)?(0|v)<(0-g|0)?(0|kf[t+4>>2])+v|0:v:v-(0|kf[t+4>>2])|0,kf[y>>2]=T,b?(S=E,w=T,C=S+s|0,M=w+s|0,P=e,I=P,kf[I>>2]=C,R=P+4|0,x=R,void(kf[x>>2]=M)):((E|T|0)>-1?(O=1,k=1):(b=(0|T)<1&(0|E)<1,O=b?-1:(0|E)>0?1:-1,k=b?-1:(0|T)>0?1:-1),b=0|np(g,O),t=0|np(g,k),g=(E<<1)-b|0,kf[e>>2]=g,E=(T<<1)-t|0,kf[y>>2]=E,(0|np(O,k))>-1?(k=0-E|0,kf[e>>2]=k,D=0-g|0,L=k):(kf[e>>2]=E,D=g,L=E),E=(L+b|0)/2|0,kf[e>>2]=E,b=(D+t|0)/2|0,kf[y>>2]=b,S=E,w=b,C=S+s|0,M=w+s|0,P=e,I=P,kf[I>>2]=C,R=P+4|0,x=R,void(kf[x>>2]=M))}function ie(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(i=Xf,Xf=Xf+16|0,n=i,r=t+8|0,s=r,a=0|kf[s+4>>2],o=t+16|0,h=o,l=0|kf[h>>2],c=0|kf[h+4>>2],!((0|a)>(0|c)|((0|a)==(0|c)?(0|kf[s>>2])>>>0>l>>>0:0)))return d=0,Xf=i,0|d;If[e+12>>0]=0|If[(0|kf[t>>2])+l>>0],l=o,s=0|kf[l>>2],c=0|kf[l+4>>2],l=0|tc(0|s,0|c,1,0),a=o,kf[a>>2]=l,kf[a+4>>2]=qf,(0|Ff[t+38>>1])<514?(a=r,h=0|kf[a>>2],u=0|kf[a+4>>2],a=0|tc(0|s,0|c,5,0),c=qf,(0|u)<(0|c)|(0|u)==(0|c)&h>>>0<a>>>0?f=0:(s=(0|kf[t>>2])+l|0,l=Lf[s>>0]|Lf[s+1>>0]<<8|Lf[s+2>>0]<<16|Lf[s+3>>0]<<24,kf[n>>2]=l,s=o,kf[s>>2]=a,kf[s+4>>2]=c,p=h,_=u,m=a,A=c,v=l,y=7)):0|Qs(n,t)?(l=r,r=o,p=0|kf[l>>2],_=0|kf[l+4>>2],m=0|kf[r>>2],A=0|kf[r+4>>2],v=0|kf[n>>2],y=7):f=0;e:do if(7==(0|y))if(n=0|nc(0|p,0|_,0|m,0|A),r=qf,0>(0|r)|0==(0|r)&v>>>0>n>>>0?0:(n=(0|kf[t>>2])+m|0,(0|v)>=1)){switch(kf[e>>2]=n,r=v+-1|0,l=n+r|0,(0|Lf[l>>0])>>>6&3){case 0:kf[e+4>>2]=r,g=63&If[l>>0];break;case 1:if((0|v)<2){f=0;break e}kf[e+4>>2]=v+-2,l=n+v+-2|0,g=(0|Lf[l+1>>0])<<8&16128|(0|Lf[l>>0]);break;case 2:if((0|v)<3){f=0;break e}kf[e+4>>2]=v+-3,l=n+v+-3|0,g=(0|Lf[l+1>>0])<<8|(0|Lf[l>>0])|(0|Lf[l+2>>0])<<16&4128768;break;default:f=0;break e}l=g+4096|0,kf[e+8>>2]=l,l>>>0<=1048575?(l=0|tc(0|m,0|A,0|v,0),n=o,kf[n>>2]=l,kf[n+4>>2]=qf,f=1):f=0}else f=0;while(0);return d=f,Xf=i,0|d}function ne(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;if(i=Xf,Xf=Xf+32|0,n=i,r=e+8|0,s=0|kf[r>>2],a=e+4|0,o=0|kf[a>>2],((s-o|0)/144|0)>>>0>=t>>>0){h=o,l=t;do{kf[h>>2]=-1,eo(h+4|0),If[h+100>>0]=1,c=h+104|0,d=c+40|0;do kf[c>>2]=0,c=c+4|0;while((0|c)<(0|d));h=(0|kf[a>>2])+144|0,kf[a>>2]=h,l=l+-1|0}while(0!=(0|l));return void(Xf=i)}l=0|kf[e>>2],h=(o-l|0)/144|0,o=h+t|0,o>>>0>29826161&&Du(e),u=(s-l|0)/144|0,l=u<<1,s=u>>>0<14913080?l>>>0<o>>>0?o:l:29826161,kf[n+12>>2]=0,kf[n+16>>2]=e+8;do if(s){if(!(s>>>0>29826161)){f=0|sl(144*s|0);break}l=0|dp(8),cd(l,13392),kf[l>>2]=4748,fp(0|l,1128,101)}else f=0;while(0);kf[n>>2]=f,l=f+(144*h|0)|0,h=n+8|0,kf[h>>2]=l,o=n+4|0,kf[o>>2]=l,u=n+12|0,kf[u>>2]=f+(144*s|0),s=l,l=t;do{kf[s>>2]=-1,eo(s+4|0),If[s+100>>0]=1,c=s+104|0,d=c+40|0;do kf[c>>2]=0,c=c+4|0;while((0|c)<(0|d));s=(0|kf[h>>2])+144|0,kf[h>>2]=s,l=l+-1|0}while(0!=(0|l));if(l=0|kf[e>>2],s=0|kf[a>>2],(0|s)==(0|l))p=o,_=0|kf[o>>2],m=l,A=s;else{c=0|kf[o>>2],d=s;do c=c+-144|0,d=d+-144|0,P(c,d);while((0|d)!=(0|l));kf[o>>2]=c,p=o,_=c,m=0|kf[e>>2],A=0|kf[a>>2]}kf[e>>2]=_,kf[p>>2]=m,kf[a>>2]=kf[h>>2],kf[h>>2]=A,A=0|kf[r>>2],kf[r>>2]=kf[u>>2],kf[u>>2]=A,kf[n>>2]=kf[p>>2],ts(n),Xf=i}function re(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(i=(0|t)==(0|e),If[t+12>>0]=1&i,i);else{for(n=t;;){if(r=0|kf[n+8>>2],t=r+12|0,0|If[t>>0]){s=23;break}if(a=r+8|0,o=0|kf[a>>2],i=0|kf[o>>2],(0|i)==(0|r)){if(h=0|kf[o+4>>2],!h){s=7;break}if(l=h+12|0,0|If[l>>0]){s=7;break}c=l}else{if(!i){s=16;break}if(l=i+12|0,0|If[l>>0]){s=16;break}c=l}if(If[t>>0]=1,t=(0|o)==(0|e),If[o+12>>0]=1&t,If[c>>0]=1,t){s=23;break}n=o}if(7==(0|s))return(0|kf[r>>2])==(0|n)?(d=r,u=o):(c=r+4|0,e=0|kf[c>>2],t=0|kf[e>>2],kf[c>>2]=t,t?(kf[t+8>>2]=r,f=0|kf[a>>2]):f=o,kf[e+8>>2]=f,f=0|kf[a>>2],kf[((0|kf[f>>2])==(0|r)?f:f+4|0)>>2]=e,kf[e>>2]=r,kf[a>>2]=e,d=e,u=0|kf[e+8>>2]),If[d+12>>0]=1,If[u+12>>0]=0,d=0|kf[u>>2],e=d+4|0,f=0|kf[e>>2],kf[u>>2]=f,0|f&&(kf[f+8>>2]=u),f=u+8|0,kf[d+8>>2]=kf[f>>2],t=0|kf[f>>2],kf[((0|kf[t>>2])==(0|u)?t:t+4|0)>>2]=d,kf[e>>2]=u,void(kf[f>>2]=d);if(16==(0|s))return(0|kf[r>>2])==(0|n)?(n=0|kf[r>>2],d=n+4|0,f=0|kf[d>>2],kf[r>>2]=f,f?(kf[f+8>>2]=r,p=0|kf[a>>2]):p=o,kf[n+8>>2]=p,p=0|kf[a>>2],kf[((0|kf[p>>2])==(0|r)?p:p+4|0)>>2]=n,kf[d>>2]=r,kf[a>>2]=n,_=n,m=0|kf[n+8>>2]):(_=r,m=o),If[_+12>>0]=1,If[m+12>>0]=0,_=m+4|0,o=0|kf[_>>2],r=0|kf[o>>2],kf[_>>2]=r,0|r&&(kf[r+8>>2]=m),r=m+8|0,kf[o+8>>2]=kf[r>>2],_=0|kf[r>>2],kf[((0|kf[_>>2])==(0|m)?_:_+4|0)>>2]=o,kf[o>>2]=m,void(kf[r>>2]=o)}}function se(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|Jn(e,0|kf[d>>2],i):(p=0,0|p)}function ae(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|$n(e,0|kf[d>>2],i):(p=0,0|p)}function oe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|qn(e,0|kf[d>>2],i):(p=0,0|p)}function he(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;if(i=Xf,Xf=Xf+16|0,n=i,r=t+8|0,s=r,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0)return d=0,Xf=i,0|d;if(a=(0|kf[t>>2])+l|0,l=Lf[a>>0]|Lf[a+1>>0]<<8|Lf[a+2>>0]<<16|Lf[a+3>>0]<<24,a=s,kf[a>>2]=c,kf[a+4>>2]=h,(0|l)<0)return d=0,Xf=i,0|d;if(W(e+76|0,l,0),rd(n),0|ie(n,t)){if((0|l)>0){h=e+76|0,a=0,c=1;do c^=1^(0|Qa(n)),o=(0|kf[h>>2])+(a>>>5<<2)|0,u=1<<(31&a),f=0|kf[o>>2],kf[o>>2]=c?f|u:f&~u,a=a+1|0;while((0|a)<(0|l))}l=r,r=0|kf[l>>2],a=0|kf[l+4>>2],l=s,c=0|kf[l>>2],h=0|kf[l+4>>2],l=0|tc(0|c,0|h,4,0),u=qf,((!!((0|a)<(0|u)|(0|a)==(0|u)&r>>>0<l>>>0)||(f=0|kf[t>>2],t=f+c|0,o=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,t=s,kf[t>>2]=l,kf[t+4>>2]=u,u=0|tc(0|c,0|h,8,0),h=qf,(0|a)<(0|h)|(0|a)==(0|h)&r>>>0<u>>>0)?0:(r=f+l|0,l=Lf[r>>0]|Lf[r+1>>0]<<8|Lf[r+2>>0]<<16|Lf[r+3>>0]<<24,r=s,kf[r>>2]=u,kf[r+4>>2]=h,(0|o)<=(0|l)))?(kf[e+12>>2]=o,kf[e+16>>2]=l,h=0|nc(0|l,((0|l)<0)<<31>>31|0,0|o,((0|o)<0)<<31>>31|0),o=qf,o>>>0<0|0==(0|o)&h>>>0<2147483647):0)?(o=h+1|0,kf[e+20>>2]=o,h=(0|o)/2|0,l=e+24|0,kf[l>>2]=h,kf[e+28>>2]=0-h,1&o?p=1:(kf[l>>2]=h+-1,p=1)):p=0}else p=0;return bf(n),d=p,Xf=i,0|d}function le(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0;if(s=0|kf[(0|kf[(0|kf[t+4>>2])+8>>2])+(n<<2)>>2],!((i+-1|0)>>>0<6&1==(0|Cp[127&kf[(0|kf[t>>2])+8>>2]](t))))return a=0,void(kf[e>>2]=a);if(o=0|Cp[127&kf[(0|kf[t>>2])+36>>2]](t),h=0|Mp[127&kf[(0|kf[t>>2])+44>>2]](t,n),0==(0|o)|0==(0|h))return a=0,void(kf[e>>2]=a);if(l=0|Mp[127&kf[(0|kf[t>>2])+40>>2]](t,n),n=0|kf[t+44>>2],t=h+12|0,c=6==(0|i),l){if(c)return c=0|sl(104),kf[c+4>>2]=s,s=c+8|0,kf[s>>2]=kf[r>>2],kf[s+4>>2]=kf[r+4>>2],kf[s+8>>2]=kf[r+8>>2],kf[s+12>>2]=kf[r+12>>2],kf[c+24>>2]=n,kf[c+28>>2]=l,kf[c+32>>2]=t,kf[c+36>>2]=h,kf[c>>2]=2548,kf[c+44>>2]=0,kf[c+48>>2]=0,kf[c+52>>2]=n,kf[c+56>>2]=l,kf[c+60>>2]=t,kf[c+64>>2]=h,kf[c+40>>2]=2604,kf[c+68>>2]=1,h=c+72|0,kf[h>>2]=-1,kf[h+4>>2]=-1,kf[h+8>>2]=-1,kf[h+12>>2]=-1,rd(c+88|0),a=c,void(kf[e>>2]=a)}else if(c)return i=0|sl(104),kf[i+4>>2]=s,d=i+8|0,kf[d>>2]=kf[r>>2],kf[d+4>>2]=kf[r+4>>2],kf[d+8>>2]=kf[r+8>>2],kf[d+12>>2]=kf[r+12>>2],kf[i+24>>2]=n,kf[i+28>>2]=o,kf[i+32>>2]=t,kf[i+36>>2]=h,kf[i>>2]=2632,kf[i+44>>2]=0,kf[i+48>>2]=0,kf[i+52>>2]=n,kf[i+56>>2]=o,kf[i+60>>2]=t,kf[i+64>>2]=h,kf[i+40>>2]=2688,kf[i+68>>2]=1,o=i+72|0,kf[o>>2]=-1,kf[o+4>>2]=-1,kf[o+8>>2]=-1,kf[o+12>>2]=-1,rd(i+88|0),a=i,void(kf[e>>2]=a);kf[e>>2]=0,kf[e>>2]=0,a=0,kf[e>>2]=a}function ce(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0;if(s=0|kf[(0|kf[(0|kf[t+4>>2])+8>>2])+(n<<2)>>2],!((i+-1|0)>>>0<6&1==(0|Cp[127&kf[(0|kf[t>>2])+8>>2]](t))))return a=0,void(kf[e>>2]=a);if(o=0|Cp[127&kf[(0|kf[t>>2])+36>>2]](t),h=0|Mp[127&kf[(0|kf[t>>2])+44>>2]](t,n),0==(0|o)|0==(0|h))return a=0,void(kf[e>>2]=a);if(l=0|Mp[127&kf[(0|kf[t>>2])+40>>2]](t,n),n=0|kf[t+44>>2],t=h+12|0,c=6==(0|i),l){if(c)return c=0|sl(104),kf[c+4>>2]=s,s=c+8|0,kf[s>>2]=kf[r>>2],kf[s+4>>2]=kf[r+4>>2],kf[s+8>>2]=kf[r+8>>2],kf[s+12>>2]=kf[r+12>>2],kf[c+24>>2]=n,kf[c+28>>2]=l,kf[c+32>>2]=t,kf[c+36>>2]=h,kf[c>>2]=2716,kf[c+44>>2]=0,kf[c+48>>2]=0,kf[c+52>>2]=n,kf[c+56>>2]=l,kf[c+60>>2]=t,kf[c+64>>2]=h,kf[c+40>>2]=2772,kf[c+68>>2]=1,h=c+72|0,kf[h>>2]=-1,kf[h+4>>2]=-1,kf[h+8>>2]=-1,kf[h+12>>2]=-1,rd(c+88|0),a=c,void(kf[e>>2]=a)}else if(c)return i=0|sl(104),kf[i+4>>2]=s,d=i+8|0,kf[d>>2]=kf[r>>2],kf[d+4>>2]=kf[r+4>>2],kf[d+8>>2]=kf[r+8>>2],kf[d+12>>2]=kf[r+12>>2],kf[i+24>>2]=n,kf[i+28>>2]=o,kf[i+32>>2]=t,kf[i+36>>2]=h,kf[i>>2]=2800,kf[i+44>>2]=0,kf[i+48>>2]=0,kf[i+52>>2]=n,kf[i+56>>2]=o,kf[i+60>>2]=t,kf[i+64>>2]=h,kf[i+40>>2]=2856,kf[i+68>>2]=1,o=i+72|0,kf[o>>2]=-1,kf[o+4>>2]=-1,kf[o+8>>2]=-1,kf[o+12>>2]=-1,rd(i+88|0),a=i,void(kf[e>>2]=a);kf[e>>2]=0,kf[e>>2]=0,a=0,kf[e>>2]=a}function de(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0;n=Xf,Xf=Xf+32|0,r=n+12|0,s=n,a=t+24|0,o=0|If[a>>0],h=o<<24>>24,kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,kf[r+8>>2]=0,c=o<<24>>24==0;do if(c)p=0,_=0,m=0;else{if(!(o<<24>>24<0)){d=h<<1,u=0|sl(d),kf[r>>2]=u,f=u+(h<<1)|0,kf[r+8>>2]=f,0|Bs(0|u,0,0|d),kf[l>>2]=f,p=u,_=f,m=u;break}Du(r)}while(0);if(kf[s>>2]=0,r=s+4|0,kf[r>>2]=0,kf[s+8>>2]=0,c?(A=0,v=0,y=0):(c=h<<1,o=0|sl(c),kf[s>>2]=o,u=o+(h<<1)|0,kf[s+8>>2]=u,0|Bs(0|o,0,0|c),kf[r>>2]=u,A=o,v=u,y=o),o=t+80|0,0|kf[o>>2])for(u=t+48|0,c=t+40|0,s=t+64|0,h=e+48|0,e=m,f=A,d=0;;){if(g=u,b=0|kf[g>>2],E=0|kf[g+4>>2],g=c,T=0|kf[g>>2],S=0|pl(0|T,0|kf[g+4>>2],0|d,0),g=0|tc(0|S,0|qf,0|b,0|E),0|ui(0|e,(0|kf[kf[t>>2]>>2])+g|0,0|T),T=0|If[a>>0],T<<24>>24>0){g=0|kf[h>>2],E=T<<24>>24,T=0;do xf[f+(T<<1)>>1]=(0|kf[g+(T+i<<2)>>2])+(0|Ff[p+(T<<1)>>1]),T=T+1|0;while((0|T)<(0|E));w=m}else w=e;if(E=c,T=0|kf[E>>2],g=0|pl(0|T,0|kf[E+4>>2],0|d,0),0|ui((0|kf[kf[s>>2]>>2])+g|0,0|y,0|T),d=d+1|0,d>>>0>=(0|kf[o>>2])>>>0)break;e=w,f=y}return 0|A&&((0|v)!=(0|A)&&(kf[r>>2]=v+(~((v+-2-A|0)>>>1)<<1)),mf(y)),p?((0|_)!=(0|p)&&(kf[l>>2]=_+(~((_+-2-p|0)>>>1)<<1)),mf(m),Xf=n,1):(Xf=n,1)}function ue(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0;n=Xf,Xf=Xf+32|0,r=n+12|0,s=n,a=t+24|0,o=0|If[a>>0],h=o<<24>>24,kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,kf[r+8>>2]=0,c=o<<24>>24==0;do if(c)p=0,_=0,m=0;else{if(!(o<<24>>24<0)){d=h<<2,u=0|sl(d),kf[r>>2]=u,f=u+(h<<2)|0,kf[r+8>>2]=f,0|Bs(0|u,0,0|d),kf[l>>2]=f,p=u,_=f,m=u;break}Du(r)}while(0);if(kf[s>>2]=0,r=s+4|0,kf[r>>2]=0,kf[s+8>>2]=0,c?(A=0,v=0,y=0):(c=h<<2,o=0|sl(c),kf[s>>2]=o,u=o+(h<<2)|0,kf[s+8>>2]=u,0|Bs(0|o,0,0|c),kf[r>>2]=u,A=o,v=u,y=o),o=t+80|0,0|kf[o>>2])for(u=t+48|0,c=t+40|0,s=t+64|0,h=e+48|0,e=m,f=A,d=0;;){if(g=u,b=0|kf[g>>2],E=0|kf[g+4>>2],g=c,T=0|kf[g>>2],S=0|pl(0|T,0|kf[g+4>>2],0|d,0),g=0|tc(0|S,0|qf,0|b,0|E),0|ui(0|e,(0|kf[kf[t>>2]>>2])+g|0,0|T),T=0|If[a>>0],T<<24>>24>0){g=0|kf[h>>2],E=T<<24>>24,T=0;do kf[f+(T<<2)>>2]=(0|kf[g+(T+i<<2)>>2])+(0|kf[p+(T<<2)>>2]),T=T+1|0;while((0|T)<(0|E));w=m}else w=e;if(E=c,T=0|kf[E>>2],g=0|pl(0|T,0|kf[E+4>>2],0|d,0),0|ui((0|kf[kf[s>>2]>>2])+g|0,0|y,0|T),d=d+1|0,d>>>0>=(0|kf[o>>2])>>>0)break;e=w,f=y}return 0|A&&((0|v)!=(0|A)&&(kf[r>>2]=v+(~((v+-4-A|0)>>>2)<<2)),mf(y)),p?((0|_)!=(0|p)&&(kf[l>>2]=_+(~((_+-4-p|0)>>>2)<<2)),mf(m),Xf=n,1):(Xf=n,1)}function fe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|Hn(e,0|kf[d>>2],i):(p=0,0|p)}function pe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|Yn(e,0|kf[d>>2],i):(p=0,0|p)}function _e(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),
l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32)return p=0,0|p;if(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),!_)return p=1,0|p;kf[e+8>>2]=0,_=0;do{if(!(0|ie(e+16+(_<<4)|0,t))){p=0,m=17;break}_=_+1|0}while((0|_)<32);return 17==(0|m)?0|p:0|ie(e+528|0,t)&&0|ot(e+544|0,t)&&0|ot(e+564|0,t)&&0|ot(e+584|0,t)?0|jn(e,0|kf[d>>2],i):(p=0,0|p)}function me(e){e=0|e;var t=0,i=0,n=0;if(kf[e>>2]=3240,Aa(e+232|0),Qr(e+216|0),t=0|kf[e+196>>2],0|t&&(i=e+200|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+184>>2],0|t&&(n=e+188|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+172>>2],0|t&&(i=e+176|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+160>>2],0|t&&(n=e+164|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+144>>2],0|t){i=t;do t=i,i=0|kf[i>>2],mf(t);while(0!=(0|i))}i=e+136|0,t=0|kf[i>>2],kf[i>>2]=0,0|t&&mf(t),t=0|kf[e+120>>2],0|t&&mf(t),t=0|kf[e+108>>2],0|t&&mf(t),t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&(i=e+76|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+60>>2],0|t&&mf(t),t=0|kf[e+48>>2],0|t&&(n=e+52|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+36>>2],0|t&&(i=e+40|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(12*~(((n+-12-t|0)>>>0)/12|0)|0)),mf(t)),t=0|kf[e+24>>2],0|t&&(n=e+28|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+12>>2],0|t&&(i=e+16|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+8|0,e=0|kf[t>>2],kf[t>>2]=0,e&&(is(e),mf(e))}function Ae(e){e=0|e;var t=0,i=0,n=0;if(kf[e>>2]=3288,qt(e+232|0),Qr(e+216|0),t=0|kf[e+196>>2],0|t&&(i=e+200|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+184>>2],0|t&&(n=e+188|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+172>>2],0|t&&(i=e+176|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+160>>2],0|t&&(n=e+164|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+144>>2],0|t){i=t;do t=i,i=0|kf[i>>2],mf(t);while(0!=(0|i))}i=e+136|0,t=0|kf[i>>2],kf[i>>2]=0,0|t&&mf(t),t=0|kf[e+120>>2],0|t&&mf(t),t=0|kf[e+108>>2],0|t&&mf(t),t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&(i=e+76|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+60>>2],0|t&&mf(t),t=0|kf[e+48>>2],0|t&&(n=e+52|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+36>>2],0|t&&(i=e+40|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(12*~(((n+-12-t|0)>>>0)/12|0)|0)),mf(t)),t=0|kf[e+24>>2],0|t&&(n=e+28|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+12>>2],0|t&&(i=e+16|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+8|0,e=0|kf[t>>2],kf[t>>2]=0,e&&(is(e),mf(e))}function ve(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;i=Xf,Xf=Xf+16|0,n=i,r=e+40|0,s=r,a=e,o=s+40|0;do kf[s>>2]=kf[a>>2],s=s+4|0,a=a+4|0;while((0|s)<(0|o));if(0|oi(r,1,n)){s=e,a=r,o=s+40|0;do kf[s>>2]=kf[a>>2],s=s+4|0,a=a+4|0;while((0|s)<(0|o));if(r=n,h=0|kf[r>>2],l=0|kf[r+4>>2],r=e+8|0,c=r,d=e+16|0,u=d,f=0|kf[u>>2],p=0|kf[u+4>>2],u=0|nc(0|kf[c>>2],0|kf[c+4>>2],0|f,0|p),c=qf,!(l>>>0>c>>>0|(0|l)==(0|c)&h>>>0>u>>>0)){u=0|tc(0|f,0|p,0|h,0|l),l=d,kf[l>>2]=u,kf[l+4>>2]=qf;do{if(!((0|Ff[e+38>>1])>=514)){l=e+96|0,s=l,a=e,o=s+40|0;do kf[s>>2]=kf[a>>2],s=s+4|0,a=a+4|0;while((0|s)<(0|o));if(0|oi(l,1,n)){s=e,a=l,o=s+40|0;do kf[s>>2]=kf[a>>2],s=s+4|0,a=a+4|0;while((0|s)<(0|o));if(l=n,u=0|kf[l>>2],h=0|kf[l+4>>2],l=r,p=d,f=0|kf[p>>2],c=0|kf[p+4>>2],p=0|nc(0|kf[l>>2],0|kf[l+4>>2],0|f,0|c),l=qf,!(h>>>0>l>>>0|(0|h)==(0|l)&u>>>0>p>>>0)){p=0|tc(0|f,0|c,0|u,0|h),h=d,kf[h>>2]=p,kf[h+4>>2]=qf;break}}return _=0,Xf=i,0|_}if(!(0|ie(e+80|0,e)))return _=0,Xf=i,0|_}while(0);if(!(0|as(e)))return _=0,Xf=i,0|_;s=t,a=e,o=s+40|0;do kf[s>>2]=kf[a>>2],s=s+4|0,a=a+4|0;while((0|s)<(0|o));return _=1,Xf=i,0|_}}return _=0,Xf=i,0|_}function ye(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=Xf,Xf=Xf+16|0,n=i,!(0|fn(e,t)))return r=0,Xf=i,0|r;if(s=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),a=e+36|0,o=e+40|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,s>>>0<=c>>>0){if(s>>>0<c>>>0?(h=d+(s<<2)|0,(0|l)!=(0|h)):0){d=l;do l=d+-4|0,kf[o>>2]=l,u=0|kf[l>>2],kf[l>>2]=0,0|u&&xp[127&kf[(0|kf[u>>2])+4>>2]](u),d=0|kf[o>>2];while((0|d)!=(0|h))}}else Ut(a,s-c|0);if(c=t+8|0,(0|s)<=0)return r=1,Xf=i,0|r;for(h=t+16|0,d=0;;){if(o=c,u=0|kf[o+4>>2],l=h,f=0|kf[l>>2],p=0|kf[l+4>>2],!((0|u)>(0|p)|((0|u)==(0|p)?(0|kf[o>>2])>>>0>f>>>0:0))){r=0,_=19;break}if(o=0|If[(0|kf[t>>2])+f>>0],u=0|tc(0|f,0|p,1,0),p=h,kf[p>>2]=u,kf[p+4>>2]=qf,kp[15&kf[(0|kf[e>>2])+48>>2]](n,e,o),o=(0|kf[a>>2])+(d<<2)|0,p=0|kf[n>>2],kf[n>>2]=0,u=0|kf[o>>2],kf[o>>2]=p,0|u&&xp[127&kf[(0|kf[u>>2])+4>>2]](u),u=0|kf[n>>2],kf[n>>2]=0,0|u&&xp[127&kf[(0|kf[u>>2])+4>>2]](u),u=0|kf[(0|kf[a>>2])+(d<<2)>>2],!u){r=0,_=19;break}if(p=0|kf[(0|kf[u>>2])+8>>2],o=0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e),f=0|Mp[127&kf[(0|kf[e>>2])+20>>2]](e,d),d=d+1|0,!(0|Pp[31&p](u,o,f))){r=0,_=19;break}if((0|d)>=(0|s)){r=1,_=19;break}}return 19==(0|_)?(Xf=i,0|r):0}function ge(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;if(i=Xf,Xf=Xf+16|0,n=i+12|0,r=i,s=0|sl(52),kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,Gf[s+16>>2]=ap(1),a=s+20|0,kf[a>>2]=0,kf[a+4>>2]=0,kf[a+8>>2]=0,kf[a+12>>2]=0,Gf[s+36>>2]=ap(1),kf[s+40>>2]=0,kf[s+44>>2]=0,kf[s+48>>2]=0,zu(n),0|li(n,0|kf[t+32>>2],s)){if(n=(0|kf[t+4>>2])+4|0,t=0|kf[n>>2],kf[n>>2]=s,0|t){if(n=t+40|0,a=0|kf[n>>2],0|a){if(o=t+44|0,h=0|kf[o>>2],(0|h)==(0|a))l=a;else{c=h;do h=c+-4|0,kf[o>>2]=h,d=0|kf[h>>2],kf[h>>2]=0,0|d&&(vs(d),mf(d)),c=0|kf[o>>2];while((0|c)!=(0|a));l=0|kf[n>>2]}mf(l)}vs(t),mf(t)}return kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,void(Xf=i)}kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,t=0|sl(32),kf[r>>2]=t,kf[r+8>>2]=-2147483616,kf[r+4>>2]=26,l=t,n=12999,a=l+26|0;do If[l>>0]=0|If[n>>0],l=l+1|0,n=n+1|0;while((0|l)<(0|a));if(If[t+26>>0]=0,kf[e>>2]=-1,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),r=s+40|0,e=0|kf[r>>2],0|e){if(t=s+44|0,n=0|kf[t>>2],(0|n)==(0|e))u=e;else{l=n;do n=l+-4|0,kf[t>>2]=n,a=0|kf[n>>2],kf[n>>2]=0,0|a&&(vs(a),mf(a)),l=0|kf[t>>2];while((0|l)!=(0|e));u=0|kf[r>>2]}mf(u)}return vs(s),mf(s),void(Xf=i)}function be(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0;i=Xf,Xf=Xf+16|0,n=i+4|0,r=i,s=0|kf[t>>2],kf[n>>2]=s,t=e+8|0,a=(0|s)==-1,o=s+1|0;do{if(!a){if(kf[n+4>>2]=0==((o>>>0)%3|0|0)?s+-2|0:o,(s>>>0)%3|0){h=s+-1|0;break}h=s+2|0;break}kf[n+4>>2]=-1,h=-1}while(0);for(kf[n+8>>2]=h,h=a?-1:(s>>>0)/3|0,a=e+216|0,o=e+220|0,l=e+368|0,e=s,s=0;;){if((0|e)!=-1?(c=0|kf[(0|kf[(0|kf[t>>2])+12>>2])+(e<<2)>>2],(0|c)!=-1):0){if(((c>>>0)/3|0)>>>0>=h>>>0?(0|kf[o>>2])!=(0|kf[a>>2]):0){c=0;do 0|Qa((0|kf[l>>2])+(c<<4)|0)&&(d=0|kf[a>>2],kf[r>>2]=e,u=d+(144*c|0)+136|0,f=0|kf[u>>2],f>>>0<(0|kf[d+(144*c|0)+140>>2])>>>0?(kf[f>>2]=e,kf[u>>2]=f+4):us(d+(144*c|0)+132|0,r)),c=c+1|0;while(c>>>0<(((0|kf[o>>2])-(0|kf[a>>2])|0)/144|0)>>>0)}}else p=10;if(10==(0|p)?(p=0,c=0|kf[o>>2],d=0|kf[a>>2],(0|c)!=(0|d)):0)for(f=c,c=d,d=0;;){if(u=c,kf[r>>2]=e,_=u+(144*d|0)+136|0,m=0|kf[_>>2],m>>>0<(0|kf[u+(144*d|0)+140>>2])>>>0?(kf[m>>2]=e,kf[_>>2]=m+4,A=c,v=f):(us(u+(144*d|0)+132|0,r),A=0|kf[a>>2],v=0|kf[o>>2]),d=d+1|0,d>>>0>=((v-A|0)/144|0)>>>0)break;f=v,c=A}if(c=s+1|0,3==(0|c))break;e=0|kf[n+(c<<2)>>2],s=c}return Xf=i,1}function Ee(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ot(e+16|0,t)&&0|ot(e+36|0,t)&&0|ot(e+56|0,t)&&0|ot(e+76|0,t)?0|Qn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Te(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ot(e+16|0,t)&&0|ot(e+36|0,t)&&0|ot(e+56|0,t)&&0|ot(e+76|0,t)?0|Kn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Se(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ie(e+16|0,t)&&0|ot(e+32|0,t)&&0|ot(e+52|0,t)&&0|ot(e+72|0,t)?0|nr(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function we(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ie(e+16|0,t)&&0|ot(e+32|0,t)&&0|ot(e+52|0,t)&&0|ot(e+72|0,t)?0|er(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Ce(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;n=Xf,Xf=Xf+32|0,r=n+8|0,s=n+4|0,a=n,kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0,h=t+8|0,l=0|kf[h>>2],c=0|kf[h+4>>2],h=t+16|0,d=h,u=0|kf[d>>2],f=0|kf[d+4>>2],d=0|tc(0|u,0|f,4,0),p=qf;e:do if((0|c)<(0|p)|(0|c)==(0|p)&l>>>0<d>>>0)_=0;else{m=0|kf[t>>2],A=m+u|0,v=Lf[A>>0]|Lf[A+1>>0]<<8|Lf[A+2>>0]<<16|Lf[A+3>>0]<<24,A=h,kf[A>>2]=d,kf[A+4>>2]=p;t:do switch(0|v){case 3:if(!((0|c)>(0|p)|(0|c)==(0|p)&l>>>0>d>>>0)){_=0;break e}if(A=0|If[m+d>>0],y=0|tc(0|u,0|f,5,0),g=h,kf[g>>2]=y,kf[g+4>>2]=qf,kf[e+8>>2]=A<<24>>24,A<<24>>24==1){if(0|dn(e,t,r))break t;_=0;break e}0|So(4996,23,1,0|kf[906]),_=0;break e;case 2:if(!(0|dn(e,t,r))){_=0;break e}break;default:0|So(5020,24,1,0|kf[906]),_=0;break e}while(0);kf[s>>2]=kf[r>>2],kf[a>>2]=kf[o>>2],Qe(s,a,e,i),_=1}while(0);return(i=0|kf[r>>2])?(r=0|kf[o>>2],(0|r)!=(0|i)&&(kf[o>>2]=r+(12*~(((r+-12-i|0)>>>0)/12|0)|0)),mf(i),Xf=n,0|_):(Xf=n,0|_)}function Me(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0;e:do if(t>>>0<=20)do switch(0|t){case 9:n=(0|kf[i>>2])+3&-4,r=0|kf[n>>2],kf[i>>2]=n+4,kf[e>>2]=r;break e;case 10:r=(0|kf[i>>2])+3&-4,n=0|kf[r>>2],kf[i>>2]=r+4,r=e,kf[r>>2]=n,kf[r+4>>2]=((0|n)<0)<<31>>31;break e;case 11:n=(0|kf[i>>2])+3&-4,r=0|kf[n>>2],kf[i>>2]=n+4,n=e,kf[n>>2]=r,kf[n+4>>2]=0;break e;case 12:n=(0|kf[i>>2])+7&-8,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],kf[i>>2]=n+8,n=e,kf[n>>2]=s,kf[n+4>>2]=a;break e;case 13:a=(0|kf[i>>2])+3&-4,n=0|kf[a>>2],kf[i>>2]=a+4,a=(65535&n)<<16>>16,n=e,kf[n>>2]=a,kf[n+4>>2]=((0|a)<0)<<31>>31;break e;case 14:a=(0|kf[i>>2])+3&-4,n=0|kf[a>>2],kf[i>>2]=a+4,a=e,kf[a>>2]=65535&n,kf[a+4>>2]=0;break e;case 15:a=(0|kf[i>>2])+3&-4,n=0|kf[a>>2],kf[i>>2]=a+4,a=(255&n)<<24>>24,n=e,kf[n>>2]=a,kf[n+4>>2]=((0|a)<0)<<31>>31;break e;case 16:a=(0|kf[i>>2])+3&-4,n=0|kf[a>>2],kf[i>>2]=a+4,a=e,kf[a>>2]=255&n,kf[a+4>>2]=0;break e;case 17:a=(0|kf[i>>2])+7&-8,o=+zf[a>>3],kf[i>>2]=a+8,zf[e>>3]=o;break e;case 18:a=(0|kf[i>>2])+7&-8,o=+zf[a>>3],kf[i>>2]=a+8,zf[e>>3]=o;break e;default:break e}while(0);while(0)}function Pe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;n=Xf,Xf=Xf+144|0,r=n+136|0,s=n+32|0,a=n,o=0|kf[(0|kf[t+4>>2])+44>>2],h=0|sl(124),kf[h+4>>2]=0,kf[h>>2]=3172,kf[h+12>>2]=3196,kf[h+100>>2]=0,kf[h+104>>2]=0,kf[h+108>>2]=0,l=h+16|0,c=l+80|0;do kf[l>>2]=0,l=l+4|0;while((0|l)<(0|c));kf[h+112>>2]=o,kf[h+116>>2]=i,kf[h+120>>2]=0,d=h,kf[s+4>>2]=3196,kf[s+92>>2]=0,kf[s+96>>2]=0,kf[s+100>>2]=0,l=s+8|0,c=l+80|0;do kf[l>>2]=0,l=l+4|0;while((0|l)<(0|c));return l=0|kf[t+8>>2],kf[a>>2]=3196,t=a+4|0,c=t+4|0,kf[c>>2]=0,kf[c+4>>2]=0,kf[c+8>>2]=0,kf[c+12>>2]=0,kf[c+16>>2]=0,kf[c+20>>2]=0,c=l,kf[t>>2]=c,u=((0|kf[c+4>>2])-(0|kf[l>>2])>>2>>>0)/3|0,If[r>>0]=0,pi(a+8|0,u,r),xp[127&kf[(0|kf[a>>2])+8>>2]](a),kf[s>>2]=kf[t>>2],0|St(s+4|0,a),kf[s+36>>2]=l,kf[s+40>>2]=i,kf[s+44>>2]=o,kf[s+48>>2]=h,ei(h,s),kf[e>>2]=d,kf[a>>2]=3196,d=0|kf[a+20>>2],0|d&&mf(d),(d=0|kf[a+8>>2])?(mf(d),cs(s),void(Xf=n)):(cs(s),void(Xf=n))}function Ie(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0;if(n=Xf,Xf=Xf+16|0,r=n,s=0|kf[e+40>>2],a=0|kf[e+44>>2],(0|s)==(0|a))return o=2,h=0,l=2==(0|o),c=l?0:h,Xf=n,0|c;e=r+11|0,d=r+4|0,u=i+11|0,f=i+4|0,p=s,s=0;e:for(;;){kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,_=0|Ls(0|kf[p>>2],t,r),m=0|If[e>>0];t:do if(_)if(A=m<<24>>24<0,v=255&m,y=A?0|kf[d>>2]:v,g=0|If[u>>0],b=g<<24>>24<0,(0|y)==(0|(b?0|kf[f>>2]:255&g))){g=0|kf[r>>2],E=A?g:r,T=b?0|kf[i>>2]:i,b=0==(0|y);i:do if(A){if(b?0:0|fo(E,T,y)){S=0,w=s;break t}}else if(!b){if((255&g)<<24>>24!=(0|If[T>>0])){S=0,w=s;break t}for(C=v,M=r,P=T;;){if(C=C+-1|0,M=M+1|0,!C)break i;if(P=P+1|0,(0|If[M>>0])!=(0|If[P>>0])){S=0,w=s;break t}}}while(0);S=1,w=0|kf[p>>2]}else S=0,w=s;else S=3,w=s;while(0);switch(m<<24>>24<0&&mf(0|kf[r>>2]),3&S){case 3:case 0:break;default:o=S,h=w,I=17;break e}if(p=p+4|0,(0|p)==(0|a)){o=2,h=w,I=17;break}s=w}return 17==(0|I)?(l=2==(0|o),c=l?0:h,Xf=n,0|c):0}function Re(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0;i=Xf,Xf=Xf+32|0,n=i,r=e+4|0,s=0|kf[e>>2],a=(0|kf[r>>2])-s>>2,o=a+1|0,o>>>0>1073741823&&Du(e),h=e+8|0,l=(0|kf[h>>2])-s|0,s=l>>1,c=l>>2>>>0<536870911?s>>>0<o>>>0?o:s:1073741823,kf[n+12>>2]=0,kf[n+16>>2]=e+8;do if(c){if(!(c>>>0>1073741823)){d=0|sl(c<<2);break}s=0|dp(8),cd(s,13392),kf[s>>2]=4748,fp(0|s,1128,101)}else d=0;while(0);if(kf[n>>2]=d,s=d+(a<<2)|0,a=n+8|0,o=n+4|0,kf[o>>2]=s,l=n+12|0,kf[l>>2]=d+(c<<2),c=0|kf[t>>2],kf[t>>2]=0,kf[s>>2]=c,kf[a>>2]=s+4,s=0|kf[e>>2],c=0|kf[r>>2],(0|c)==(0|s))return u=o,f=0|kf[o>>2],p=s,_=c,kf[e>>2]=f,kf[u>>2]=p,m=0|kf[a>>2],kf[r>>2]=m,kf[a>>2]=_,A=0|kf[h>>2],v=0|kf[l>>2],kf[h>>2]=v,kf[l>>2]=A,y=0|kf[u>>2],kf[n>>2]=y,Ir(n),void(Xf=i);t=0|kf[o>>2],d=c;do d=d+-4|0,c=0|kf[d>>2],kf[d>>2]=0,kf[t+-4>>2]=c,t=(0|kf[o>>2])+-4|0,kf[o>>2]=t;while((0|d)!=(0|s));u=o,f=t,p=0|kf[e>>2],_=0|kf[r>>2],kf[e>>2]=f,kf[u>>2]=p,m=0|kf[a>>2],kf[r>>2]=m,kf[a>>2]=_,A=0|kf[h>>2],v=0|kf[l>>2],kf[h>>2]=v,kf[l>>2]=A,y=0|kf[u>>2],kf[n>>2]=y,Ir(n),Xf=i}function xe(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;i=Xf,Xf=Xf+16|0,n=i+4|0,r=i,s=0|kf[t>>2],kf[n>>2]=s,t=e+8|0,a=s+1|0;do{if((0|s)!=-1){if(kf[n+4>>2]=0==((a>>>0)%3|0|0)?s+-2|0:a,(s>>>0)%3|0){o=s+-1|0;break}o=s+2|0;break}kf[n+4>>2]=-1,o=-1}while(0);for(kf[n+8>>2]=o,o=e+216|0,a=e+220|0,h=e+368|0,e=s,s=0;;){if((0|e)!=-1?(0|kf[(0|kf[(0|kf[t>>2])+12>>2])+(e<<2)>>2])!=-1:0){if((0|kf[a>>2])!=(0|kf[o>>2])){l=0;do 0|Qa((0|kf[h>>2])+(l<<4)|0)&&(c=0|kf[o>>2],kf[r>>2]=e,d=c+(144*l|0)+136|0,u=0|kf[d>>2],u>>>0<(0|kf[c+(144*l|0)+140>>2])>>>0?(kf[u>>2]=e,kf[d>>2]=u+4):us(c+(144*l|0)+132|0,r)),l=l+1|0;while(l>>>0<(((0|kf[a>>2])-(0|kf[o>>2])|0)/144|0)>>>0)}}else f=11;if(11==(0|f)?(f=0,l=0|kf[a>>2],c=0|kf[o>>2],(0|l)!=(0|c)):0)for(u=c,c=l,l=0;;){if(d=u,kf[r>>2]=e,p=d+(144*l|0)+136|0,_=0|kf[p>>2],_>>>0<(0|kf[d+(144*l|0)+140>>2])>>>0?(kf[_>>2]=e,kf[p>>2]=_+4,m=u,A=c):(us(d+(144*l|0)+132|0,r),m=0|kf[o>>2],A=0|kf[a>>2]),l=l+1|0,l>>>0>=((A-m|0)/144|0)>>>0)break;u=m,c=A}if(c=s+1|0,3==(0|c))break;e=0|kf[n+(c<<2)>>2],s=c}return Xf=i,1}function Oe(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(i=Xf,Xf=Xf+32|0,n=i+12|0,r=i,s=0|Oo(t,0),!s)return kf[e>>2]=0,void(Xf=i);a=0|kf[t+100>>2],o=0|kf[t+96>>2],t=a-o|0,h=(0|t)/12|0,kf[n>>2]=0,l=n+4|0,kf[l>>2]=0,kf[n+8>>2]=0,c=o;do if(t){if(!(h>>>0>357913941)){d=0|sl(t),kf[n>>2]=d,kf[n+8>>2]=d+(12*h|0),0|Bs(0|d,0,0|t),kf[l>>2]=d+t,u=d;break}Du(n)}else u=0;while(0);kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0;e:do if((0|a)!=(0|o)){if(t=r+4|0,d=r+8|0,0|If[s+84>>0])for(f=0;;)if(p=c+(12*f|0)|0,kf[r>>2]=kf[p>>2],kf[r+4>>2]=kf[p+4>>2],kf[r+8>>2]=kf[p+8>>2],kf[u+(12*f|0)>>2]=kf[r>>2],kf[u+(12*f|0)+4>>2]=kf[t>>2],kf[u+(12*f|0)+8>>2]=kf[d>>2],f=f+1|0,f>>>0>=h>>>0)break e;f=0|kf[s+68>>2],p=0;do _=0|kf[f+(kf[c+(12*p|0)>>2]<<2)>>2],kf[r>>2]=_,kf[t>>2]=kf[f+(kf[c+(12*p|0)+4>>2]<<2)>>2],m=0|kf[f+(kf[c+(12*p|0)+8>>2]<<2)>>2],kf[d>>2]=m,kf[u+(12*p|0)>>2]=_,kf[u+(12*p|0)+4>>2]=kf[t>>2],kf[u+(12*p|0)+8>>2]=m,p=p+1|0;while(p>>>0<h>>>0)}while(0);na(e,n),e=0|kf[n>>2],0|e&&(n=0|kf[l>>2],(0|n)!=(0|e)&&(kf[l>>2]=n+(12*~(((n+-12-e|0)>>>0)/12|0)|0)),mf(e)),Xf=i}function ke(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(0|kf[e+64>>2]?o=e:(i=0|sl(32),wl(i),n=e+64|0,r=0|kf[n>>2],kf[n>>2]=i,r?(i=0|kf[r>>2],0|i&&(a=r+4|0,(0|kf[a>>2])!=(0|i)&&(kf[a>>2]=i),mf(i)),mf(r),s=0|kf[n>>2]):s=i,Ka(e,s,0,0,0,0),o=e),0|Rs(o,t)){if(If[e+84>>0]=0|If[t+84>>0],kf[e+80>>2]=kf[t+80>>2],(0|e)!=(0|t)&&Mt(e+68|0,0|kf[t+68>>2],0|kf[t+72>>2]),o=0|kf[t+88>>2],!o){if(t=e+88|0,s=0|kf[t>>2],kf[t>>2]=0,!s)return;return t=0|kf[s+8>>2],0|t&&(n=s+12|0,(0|kf[n>>2])!=(0|t)&&(kf[n>>2]=t),mf(t)),void mf(s)}s=0|sl(40),kf[s>>2]=kf[o>>2],t=s+8|0,n=o+8|0,kf[t>>2]=0,r=s+12|0,kf[r>>2]=0,i=s+16|0,kf[i>>2]=0,a=o+12|0,h=(0|kf[a>>2])-(0|kf[n>>2])|0,0|h&&((0|h)<0&&Du(t),l=0|sl(h),kf[r>>2]=l,kf[t>>2]=l,kf[i>>2]=l+h,h=0|kf[n>>2],n=(0|kf[a>>2])-h|0,(0|n)>0&&(0|ui(0|l,0|h,0|n),kf[r>>2]=l+n)),n=s+24|0,l=o+24|0,kf[n>>2]=kf[l>>2],kf[n+4>>2]=kf[l+4>>2],kf[n+8>>2]=kf[l+8>>2],kf[n+12>>2]=kf[l+12>>2],l=e+88|0,e=0|kf[l>>2],kf[l>>2]=s,e&&(s=0|kf[e+8>>2],0|s&&(l=e+12|0,(0|kf[l>>2])!=(0|s)&&(kf[l>>2]=s),mf(s)),mf(e))}}function De(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(t=Xf,Xf=Xf+16|0,i=t+4|0,n=t,r=e+8|0,s=0|kf[r>>2],pa(0|kf[e+4>>2],(0|kf[s+28>>2])-(0|kf[s+24>>2])>>2),s=e+100|0,a=0|kf[r>>2],o=(0|kf[a+28>>2])-(0|kf[a+24>>2])>>2,kf[i>>2]=0,a=e+104|0,h=0|kf[a>>2],l=0|kf[s>>2],c=h-l>>2,d=l,l=h,o>>>0<=c>>>0?(o>>>0<c>>>0?(h=d+(o<<2)|0,(0|l)!=(0|h)):0)&&(kf[a>>2]=l+(~((l+-4-h|0)>>>2)<<2)):lr(s,o-c|0,i),c=e+120|0,e=0|kf[c>>2]){if(o=0|kf[e>>2],(0|kf[e+4>>2])==(0|o))return u=1,Xf=t,0|u;for(e=o,o=0;;){if(kf[n>>2]=kf[e+(o<<2)>>2],kf[i>>2]=kf[n>>2],o=o+1|0,!(0|Bi(r,i))){u=0,f=15;break}if(s=0|kf[c>>2],e=0|kf[s>>2],o>>>0>=(0|kf[s+4>>2])-e>>2>>>0){u=1,f=15;break}}if(15==(0|f))return Xf=t,0|u}else{if(o=0|kf[r>>2],s=(0|kf[o+4>>2])-(0|kf[o>>2])>>2,o=(s>>>0)/3|0,s>>>0<=2)return u=1,Xf=t,0|u;for(s=0;;){if(kf[n>>2]=3*s,kf[i>>2]=kf[n>>2],s=s+1|0,!(0|Bi(r,i))){u=0,f=15;break}if((0|s)>=(0|o)){u=1,f=15;break}}if(15==(0|f))return Xf=t,0|u}return 0}function Le(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0;if(n=Xf,Xf=Xf+32|0,r=n+20|0,s=n+16|0,a=n,o=t+24|0,h=0|If[o>>0],l=h<<24>>24,c=0|kf[e+80>>2],e=0|np(c,l),kf[a>>2]=kf[294],kf[a+4>>2]=kf[295],kf[a+8>>2]=kf[296],kf[a+12>>2]=kf[297],d=i+4|0,u=0|kf[d>>2],f=0|kf[i>>2],p=u-f>>2,_=f,f=u,e>>>0<=p>>>0?(e>>>0<p>>>0?(u=_+(e<<2)|0,(0|f)!=(0|u)):0)&&(kf[d>>2]=f+(~((f+-4-u|0)>>>2)<<2)):Kr(i,e-p|0),!c)return m=1,Xf=n,0|m;if(p=t+84|0,e=t+68|0,h<<24>>24<=0){for(h=0;;){if(A=0|If[p>>0]?h:0|kf[(0|kf[e>>2])+(h<<2)>>2],kf[s>>2]=A,u=0|If[o>>0],kf[r>>2]=kf[s>>2],!(0|ir(t,r,u,a))){m=0,v=18;break}if(h=h+1|0,h>>>0>=c>>>0){m=1,v=18;break}}if(18==(0|v))return Xf=n,0|m}else y=0,g=0;for(;;){if(b=0|If[p>>0]?g:0|kf[(0|kf[e>>2])+(g<<2)>>2],kf[s>>2]=b,h=0|If[o>>0],kf[r>>2]=kf[s>>2],!(0|ir(t,r,h,a))){m=0,v=18;break}for(h=0|kf[i>>2],A=y,u=0;;){if(kf[h+(A<<2)>>2]=kf[a+(u<<2)>>2],u=u+1|0,(0|u)==(0|l))break;A=A+1|0}if(g=g+1|0,g>>>0>=c>>>0){m=1,v=18;break}y=l+y|0}return 18==(0|v)?(Xf=n,0|m):0}function Ne(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ot(e+16|0,t)&&0|ot(e+36|0,t)&&0|ot(e+56|0,t)&&0|ot(e+76|0,t)?0|zn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Fe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ot(e+16|0,t)&&0|ot(e+36|0,t)&&0|ot(e+56|0,t)&&0|ot(e+76|0,t)?0|Wn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Be(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ie(e+16|0,t)&&0|ot(e+32|0,t)&&0|ot(e+52|0,t)&&0|ot(e+72|0,t)?0|Zn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Ve(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return n=t+8|0,r=n,s=0|kf[r>>2],a=0|kf[r+4>>2],r=t+16|0,o=r,h=0|kf[o>>2],l=0|kf[o+4>>2],o=0|tc(0|h,0|l,4,0),c=qf,(0|a)<(0|c)|(0|a)==(0|c)&s>>>0<o>>>0?(d=0|kf[e>>2],u=h,f=l):(l=(0|kf[t>>2])+h|0,h=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[e>>0]=h,If[e+1>>0]=h>>8,If[e+2>>0]=h>>16,If[e+3>>0]=h>>24,l=r,o=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=qf,s=r,kf[s>>2]=o,kf[s+4>>2]=l,d=h,u=o,f=l),d>>>0>32?(p=0,0|p):(d=e+4|0,l=n,n=0|kf[l>>2],o=0|kf[l+4>>2],l=0|tc(0|u,0|f,4,0),f=qf,(0|o)<(0|f)|(0|o)==(0|f)&n>>>0<l>>>0?_=0|kf[d>>2]:(l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,If[d>>0]=u,If[d+1>>0]=u>>8,If[d+2>>0]=u>>16,If[d+3>>0]=u>>24,l=r,n=0|tc(0|kf[l>>2],0|kf[l+4>>2],4,0),l=r,kf[l>>2]=n,kf[l+4>>2]=qf,_=u),_?(kf[e+8>>2]=0,0|ie(e+16|0,t)&&0|ot(e+32|0,t)&&0|ot(e+52|0,t)&&0|ot(e+72|0,t)?0|Xn(e,0|kf[d>>2],i):(p=0,0|p)):(p=1,0|p))}function Ue(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=0|kf[e+8>>2],n=e+76|0,r=0|kf[n>>2],s=0|kf[r+80>>2],If[t+84>>0]=0,a=t+68|0,o=t+72|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,s>>>0<=c>>>0?(s>>>0<c>>>0?(h=d+(s<<2)|0,(0|l)!=(0|h)):0)?(kf[o>>2]=l+(~((l+-4-h|0)>>>2)<<2),u=r,f=s):(u=r,f=s):(lr(a,s-c|0,3160),c=0|kf[n>>2],u=c,f=0|kf[c+80>>2]),c=(0|kf[u+100>>2])-(0|kf[u+96>>2])|0,n=(0|c)/12|0,!c)return p=1,0|p;for(c=e+80|0,e=t+68|0,t=0|kf[u+96>>2],u=0;;){if(s=3*u|0,(0|s)==-1){p=0,_=12;break}if(a=0|kf[i>>2],r=0|kf[a+(s<<2)>>2],(0|r)==-1){p=0,_=12;break}if(h=0|kf[(0|kf[c>>2])+12>>2],l=0|kf[h+(r<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(r=0|kf[e>>2],kf[r+(kf[t+(12*u|0)>>2]<<2)>>2]=l,l=s+1|0,(0|l)==-1){p=0,_=12;break}if(o=0|kf[a+(l<<2)>>2],(0|o)==-1){p=0,_=12;break}if(l=0|kf[h+(o<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(kf[r+(kf[t+(12*u|0)+4>>2]<<2)>>2]=l,l=s+2|0,(0|l)==-1){p=0,_=12;break}if(s=0|kf[a+(l<<2)>>2],(0|s)==-1){p=0,_=12;break}if(l=0|kf[h+(s<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(kf[r+(kf[t+(12*u|0)+8>>2]<<2)>>2]=l,u=u+1|0,u>>>0>=n>>>0){p=1,_=12;break}}return 12==(0|_)?0|p:0}function Ge(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=0|kf[e+8>>2],n=e+112|0,r=0|kf[n>>2],s=0|kf[r+80>>2],If[t+84>>0]=0,a=t+68|0,o=t+72|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,s>>>0<=c>>>0?(s>>>0<c>>>0?(h=d+(s<<2)|0,(0|l)!=(0|h)):0)?(kf[o>>2]=l+(~((l+-4-h|0)>>>2)<<2),u=r,f=s):(u=r,f=s):(lr(a,s-c|0,3160),c=0|kf[n>>2],u=c,f=0|kf[c+80>>2]),c=(0|kf[u+100>>2])-(0|kf[u+96>>2])|0,n=(0|c)/12|0,!c)return p=1,0|p;for(c=e+116|0,e=t+68|0,t=0|kf[u+96>>2],u=0;;){if(s=3*u|0,(0|s)==-1){p=0,_=12;break}if(a=0|kf[i>>2],r=0|kf[a+(s<<2)>>2],(0|r)==-1){p=0,_=12;break}if(h=0|kf[(0|kf[c>>2])+12>>2],l=0|kf[h+(r<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(r=0|kf[e>>2],kf[r+(kf[t+(12*u|0)>>2]<<2)>>2]=l,l=s+1|0,(0|l)==-1){p=0,_=12;break}if(o=0|kf[a+(l<<2)>>2],(0|o)==-1){p=0,_=12;break}if(l=0|kf[h+(o<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(kf[r+(kf[t+(12*u|0)+4>>2]<<2)>>2]=l,l=s+2|0,(0|l)==-1){p=0,_=12;break}if(s=0|kf[a+(l<<2)>>2],(0|s)==-1){p=0,_=12;break}if(l=0|kf[h+(s<<2)>>2],l>>>0>=f>>>0){p=0,_=12;break}if(kf[r+(kf[t+(12*u|0)+8>>2]<<2)>>2]=l,u=u+1|0,u>>>0>=n>>>0){p=1,_=12;break}}return 12==(0|_)?0|p:0}function We(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,A=0,v=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|m(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|H(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<4194304)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(A=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,v=0|Lf[A+f>>0]|p<<8,kf[s>>2]=v,v>>>0>=4194304){_=v;break}p=v}else _=d;while(0);if(p=1048575&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],v=0|kf[c>>2],d=(0|np(0|kf[v+(f<<3)>>2],_>>>20))+p-(0|kf[v+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function ze(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,v=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|A(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|j(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<2097152)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,v=0|Lf[m+f>>0]|p<<8,kf[s>>2]=v,v>>>0>=2097152){_=v;break}p=v}else _=d;while(0);if(p=524287&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],v=0|kf[c>>2],d=(0|np(0|kf[v+(f<<3)>>2],_>>>19))+p-(0|kf[v+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function He(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|v(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|Y(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<1048576)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,A=0|Lf[m+f>>0]|p<<8,kf[s>>2]=A,A>>>0>=1048576){_=A;break}p=A}else _=d;while(0);if(p=262143&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],A=0|kf[c>>2],d=(0|np(0|kf[A+(f<<3)>>2],_>>>18))+p-(0|kf[A+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function je(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|y(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|X(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<262144)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,A=0|Lf[m+f>>0]|p<<8,kf[s>>2]=A,A>>>0>=262144){_=A;break}p=A}else _=d;while(0);if(p=65535&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],A=0|kf[c>>2],d=(0|np(0|kf[A+(f<<3)>>2],_>>>16))+p-(0|kf[A+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),
mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function Ye(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|g(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|Z(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<131072)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,A=0|Lf[m+f>>0]|p<<8,kf[s>>2]=A,A>>>0>=131072){_=A;break}p=A}else _=d;while(0);if(p=32767&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],A=0|kf[c>>2],d=(0|np(0|kf[A+(f<<3)>>2],_>>>15))+p-(0|kf[A+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function Xe(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|b(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|K(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<32768)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,A=0|Lf[m+f>>0]|p<<8,kf[s>>2]=A,A>>>0>=32768){_=A;break}p=A}else _=d;while(0);if(p=8191&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],A=0|kf[c>>2],d=(0|np(0|kf[A+(f<<3)>>2],_>>>13))+p-(0|kf[A+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function Ze(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+64|0,r=n,s=r,a=s+52|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));do if(0|E(r,t)){if(s=0==(0|e),s?0:0==(0|kf[r+12>>2])){o=0;break}if(a=0|Q(r,t),s|1^a)o=a;else for(a=r+44|0,s=r+48|0,h=r+40|0,l=r+16|0,c=r+28|0,d=0|kf[s>>2],u=0;;){e:do if(d>>>0<16384)for(f=0|kf[a>>2],p=d;;){if((0|f)<=0){_=p;break e}if(m=0|kf[h>>2],f=f+-1|0,kf[a>>2]=f,A=0|Lf[m+f>>0]|p<<8,kf[s>>2]=A,A>>>0>=16384){_=A;break}p=A}else _=d;while(0);if(p=4095&_,f=0|kf[(0|kf[l>>2])+(p<<2)>>2],A=0|kf[c>>2],d=(0|np(0|kf[A+(f<<3)>>2],_>>>12))+p-(0|kf[A+(f<<3)+4>>2])|0,kf[s>>2]=d,kf[i+(u<<2)>>2]=f,u=u+1|0,(0|u)==(0|e)){o=1;break}}}else o=0;while(0);return e=0|kf[r+28>>2],0|e&&(i=r+32|0,_=0|kf[i>>2],(0|_)!=(0|e)&&(kf[i>>2]=_+(~((_+-8-e|0)>>>3)<<3)),mf(e)),e=0|kf[r+16>>2],0|e&&(_=r+20|0,i=0|kf[_>>2],(0|i)!=(0|e)&&(kf[_>>2]=i+(~((i+-4-e|0)>>>2)<<2)),mf(e)),(e=0|kf[r>>2])?(i=r+4|0,r=0|kf[i>>2],(0|r)!=(0|e)&&(kf[i>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e),Xf=n,0|o):(Xf=n,0|o)}function Ke(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;for(i=0|kf[t>>2],t=0|kf[i>>2],n=0|kf[e+4>>2],r=0|kf[i+4>>2],s=n+-1|0,a=0==(s&n|0),o=a?s&r:r>>>0<n>>>0?r:(r>>>0)%(n>>>0)|0,r=(0|kf[e>>2])+(o<<2)|0,h=0|kf[r>>2];;){if(l=0|kf[h>>2],(0|l)==(0|i))break;h=l}(0|h)!=(e+8|0)?(l=0|kf[h+4>>2],c=a?l&s:l>>>0<n>>>0?l:(l>>>0)%(n>>>0)|0,(0|c)==(0|o)?(d=t,u=21):u=13):u=13;do if(13==(0|u)){if(0|t&&(c=0|kf[t+4>>2],f=a?c&s:c>>>0<n>>>0?c:(c>>>0)%(n>>>0)|0,(0|f)==(0|o))){p=t,_=t,u=22;break}kf[r>>2]=0,d=0|kf[i>>2],u=21}while(0);return 21==(0|u)&&(r=d,d?(p=d,_=r,u=22):m=r),22==(0|u)&&(u=0|kf[p+4>>2],A=a?u&s:u>>>0<n>>>0?u:(u>>>0)%(n>>>0)|0,(0|A)==(0|o)?m=_:(kf[(0|kf[e>>2])+(A<<2)>>2]=h,m=0|kf[i>>2])),kf[h>>2]=m,kf[i>>2]=0,m=e+12|0,kf[m>>2]=(0|kf[m>>2])+-1,i?(m=i+8|0,e=0|kf[i+20>>2],0|e&&(h=i+24|0,(0|kf[h>>2])!=(0|e)&&(kf[h>>2]=e),mf(e)),(0|If[m+11>>0])<0&&mf(0|kf[m>>2]),mf(i),0|t):0|t}function Qe(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=wp,h=0,l=0,c=0,d=0,u=0,f=wp,p=wp,_=0,m=wp,A=wp,v=0,y=0,g=0,b=0;if(r=Xf,Xf=Xf+32|0,s=r+16|0,a=r,o=ap(Gf[i+4>>2]),h=(1<<kf[i>>2])+-1|0,Vd(s),0|$h(s,o,h),i=0|kf[e>>2],(0|i)==(0|kf[t>>2]))return void(Xf=r);e=s+4|0,l=a+4|0,c=a+8|0,d=n+16|0,u=n+28|0,n=i;do i=(0|kf[n>>2])-h|0,o=ap(Gf[e>>2]),f=ap(Gf[s>>2]),(0|i)>-1?p=ap(f*ap(o*ap(0|i))):(_=0|nc(0,0,0|i,((0|i)<0)<<31>>31|0),p=ap(-ap(f*ap(o*ap(+(_>>>0)+4294967296*+(0|qf)))))),_=(0|kf[n+4>>2])-h|0,(0|_)>-1?m=ap(f*ap(o*ap(0|_))):(i=0|nc(0,0,0|_,((0|_)<0)<<31>>31|0),m=ap(-ap(f*ap(o*ap(+(i>>>0)+4294967296*+(0|qf)))))),i=(0|kf[n+8>>2])-h|0,(0|i)>-1?A=ap(f*ap(o*ap(0|i))):(_=0|nc(0,0,0|i,((0|i)<0)<<31>>31|0),A=ap(-ap(f*ap(o*ap(+(_>>>0)+4294967296*+(0|qf)))))),Gf[a>>2]=p,Gf[l>>2]=m,Gf[c>>2]=A,_=0|kf[d>>2],i=0|kf[_>>2],v=0|kf[u>>2],y=0|If[i+84>>0]?v:0|kf[(0|kf[i+68>>2])+(v<<2)>>2],v=a+(kf[_+4>>2]<<2)|0,_=i+40|0,g=0|kf[_>>2],b=0|pl(0|g,0|kf[_+4>>2],0|y,0),0|ui((0|kf[kf[i+64>>2]>>2])+b|0,0|v,0|g),kf[u>>2]=(0|kf[u>>2])+1,n=n+12|0;while((0|n)!=(0|kf[t>>2]));Xf=r}function Je(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(t=e+640|0,i=0|kf[t>>2],0|i){if(n=e+644|0,r=0|kf[n>>2],(0|r)==(0|i))s=i;else{for(a=r;;){if(r=a+-12|0,kf[n>>2]=r,o=0|kf[r>>2],o?(r=a+-8|0,l=0|kf[r>>2],(0|l)!=(0|o)&&(kf[r>>2]=l+(~((l+-4-o|0)>>>2)<<2)),mf(o),h=0|kf[n>>2]):h=r,(0|h)==(0|i))break;a=h}s=0|kf[t>>2]}mf(s)}if(s=e+628|0,t=0|kf[s>>2],0|t){if(h=e+632|0,a=0|kf[h>>2],(0|a)==(0|t))c=t;else{for(i=a;;){if(a=i+-12|0,kf[h>>2]=a,n=0|kf[a>>2],n?(a=i+-8|0,o=0|kf[a>>2],(0|o)!=(0|n)&&(kf[a>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n),d=0|kf[h>>2]):d=a,(0|d)==(0|t))break;i=d}c=0|kf[s>>2]}mf(c)}return c=0|kf[e+616>>2],0|c&&(s=e+620|0,d=0|kf[s>>2],(0|d)!=(0|c)&&(kf[s>>2]=d+(~((d+-4-c|0)>>>2)<<2)),mf(c)),(c=0|kf[e+604>>2])?(d=e+608|0,s=0|kf[d>>2],(0|s)!=(0|c)&&(kf[d>>2]=s+(~((s+-4-c|0)>>>2)<<2)),mf(c),u=e+584|0,bo(u),f=e+564|0,bo(f),p=e+544|0,bo(p),_=e+528|0,bf(_),m=e+16|0,void Fs(m)):(u=e+584|0,bo(u),f=e+564|0,bo(f),p=e+544|0,bo(p),_=e+528|0,bf(_),m=e+16|0,void Fs(m))}function qe(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;r=Xf,Xf=Xf+80|0,s=r,a=r+60|0,o=r+40|0,h=s,l=i,c=h+40|0;do kf[h>>2]=kf[l>>2],h=h+4|0,l=l+4|0;while((0|h)<(0|c));if(un(e,s,a),0|kf[e>>2])return d=s+24|0,bf(d),void(Xf=r);if(u=e+4|0,f=u+11|0,(0|If[f>>0])<0&&mf(0|kf[u>>2]),0|If[a+7>>0]){kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,p=0|sl(32),kf[o>>2]=p,kf[o+8>>2]=-2147483616,kf[o+4>>2]=27,h=p,l=11743,c=h+27|0;do If[h>>0]=0|If[l>>0],h=h+1|0,l=l+1|0;while((0|h)<(0|c));return If[p+27>>0]=0,kf[e>>2]=-1,Ds(u,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),d=s+24|0,bf(d),void(Xf=r)}ci(o,0|If[a+8>>0]),a=0|kf[o>>2],a?(kf[e>>2]=a,Ds(u,o+4|0)):(p=o+16|0,l=0|kf[p>>2],kf[p>>2]=0,xn(e,l,t,i,n),0|kf[e>>2]||((0|If[f>>0])<0&&mf(0|kf[u>>2]),kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0),0|l&&xp[127&kf[(0|kf[l>>2])+4>>2]](l)),u=o+16|0,a=0|kf[u>>2],kf[u>>2]=0,0|a&&xp[127&kf[(0|kf[a>>2])+4>>2]](a),a=o+4|0,(0|If[a+11>>0])<0&&mf(0|kf[a>>2]),d=s+24|0,bf(d),Xf=r}function $e(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;r=Xf,Xf=Xf+80|0,s=r,a=r+60|0,o=r+40|0,h=s,l=i,c=h+40|0;do kf[h>>2]=kf[l>>2],h=h+4|0,l=l+4|0;while((0|h)<(0|c));if(un(e,s,a),0|kf[e>>2])return d=s+24|0,bf(d),void(Xf=r);if(u=e+4|0,f=u+11|0,(0|If[f>>0])<0&&mf(0|kf[u>>2]),1!=(0|If[a+7>>0])){kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,p=0|sl(32),kf[o>>2]=p,kf[o+8>>2]=-2147483616,kf[o+4>>2]=20,h=p,l=11722,c=h+20|0;do If[h>>0]=0|If[l>>0],h=h+1|0,l=l+1|0;while((0|h)<(0|c));return If[p+20>>0]=0,kf[e>>2]=-1,Ds(u,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),d=s+24|0,bf(d),void(Xf=r)}Tr(o,0|If[a+8>>0]),a=0|kf[o>>2],a?(kf[e>>2]=a,Ds(u,o+4|0)):(p=o+16|0,l=0|kf[p>>2],kf[p>>2]=0,gh(e,l,t,i,n),0|kf[e>>2]||((0|If[f>>0])<0&&mf(0|kf[u>>2]),kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0),0|l&&xp[127&kf[(0|kf[l>>2])+4>>2]](l)),u=o+16|0,a=0|kf[u>>2],kf[u>>2]=0,0|a&&xp[127&kf[(0|kf[a>>2])+4>>2]](a),a=o+4|0,(0|If[a+11>>0])<0&&mf(0|kf[a>>2]),d=s+24|0,bf(d),Xf=r}function et(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;i=Xf,Xf=Xf+16|0,n=i,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=t,gr(e+16|0),rd(e+528|0),Pc(e+544|0),Pc(e+564|0),Pc(e+584|0),r=e+604|0,kf[r>>2]=0,s=e+608|0,kf[s>>2]=0,kf[e+612>>2]=0,a=0==(0|t);do if(!a){if(!(t>>>0>1073741823)){o=t<<2,h=0|sl(o),kf[r>>2]=h,l=h+(t<<2)|0,kf[e+612>>2]=l,0|Bs(0|h,0,0|o),kf[s>>2]=l;break}Du(r)}while(0);return s=e+616|0,kf[s>>2]=0,r=e+620|0,kf[r>>2]=0,kf[e+624>>2]=0,a||(l=t<<2,o=0|sl(l),kf[s>>2]=o,s=o+(t<<2)|0,kf[e+624>>2]=s,0|Bs(0|o,0,0|l),kf[r>>2]=s),s=t<<5|1,kf[n>>2]=0,r=n+4|0,kf[r>>2]=0,kf[n+8>>2]=0,a||(l=t<<2,o=0|sl(l),kf[n>>2]=o,h=o+(t<<2)|0,kf[n+8>>2]=h,0|Bs(0|o,0,0|l),kf[r>>2]=h),Ia(e+628|0,s,n),h=0|kf[n>>2],0|h&&(l=0|kf[r>>2],(0|l)!=(0|h)&&(kf[r>>2]=l+(~((l+-4-h|0)>>>2)<<2)),mf(h)),kf[n>>2]=0,h=n+4|0,kf[h>>2]=0,kf[n+8>>2]=0,a||(a=t<<2,l=0|sl(a),kf[n>>2]=l,r=l+(t<<2)|0,kf[n+8>>2]=r,0|Bs(0|l,0,0|a),kf[h>>2]=r),Ia(e+640|0,s,n),(s=0|kf[n>>2])?(n=0|kf[h>>2],(0|n)!=(0|s)&&(kf[h>>2]=n+(~((n+-4-s|0)>>>2)<<2)),mf(s),void(Xf=i)):void(Xf=i)}function tt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;i=Xf,Xf=Xf+32|0,n=i+12|0,r=i,s=3*t|0,kf[n>>2]=0,a=n+4|0,kf[a>>2]=0,kf[n+8>>2]=0;do if(s){if(!(s>>>0>1073741823)){o=12*t|0,h=0|sl(o),kf[n>>2]=h,l=h+(s<<2)|0,kf[n+8>>2]=l,0|Bs(0|h,0,0|o),kf[a>>2]=l,c=h;break}Du(n)}else c=0;while(0);if(0|ks(s,1,0|kf[e+32>>2],c))if(t)for(c=e+44|0,e=r+4|0,s=r+8|0,h=0,l=0,o=0;;){if(kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,u=0|kf[n>>2],f=0|kf[u+(o<<2)>>2],p=f>>>1,_=(0==(1&f|0)?p:0-p|0)+l|0,kf[r>>2]=_,p=0|kf[u+(o+1<<2)>>2],f=p>>>1,m=(0==(1&p|0)?f:0-f|0)+_|0,kf[e>>2]=m,_=0|kf[u+(o+2<<2)>>2],u=_>>>1,l=(0==(1&_|0)?u:0-u|0)+m|0,kf[s>>2]=l,m=0|kf[c>>2],u=m+100|0,_=0|kf[u>>2],(0|_)==(0|kf[m+104>>2])?Yr(m+96|0,r):(kf[_>>2]=kf[r>>2],kf[_+4>>2]=kf[r+4>>2],kf[_+8>>2]=kf[r+8>>2],kf[u>>2]=(0|kf[u>>2])+12),h=h+1|0,h>>>0>=t>>>0){d=1;break}o=o+3|0}else d=1;else d=0;return(o=0|kf[n>>2])?(n=0|kf[a>>2],(0|n)!=(0|o)&&(kf[a>>2]=n+(~((n+-4-o|0)>>>2)<<2)),mf(o),Xf=i,0|d):(Xf=i,0|d)}function it(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;i=Xf,Xf=Xf+16|0,n=i,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=t,Pc(e+16|0),Pc(e+36|0),Pc(e+56|0),Pc(e+76|0),r=e+96|0,kf[r>>2]=0,s=e+100|0,kf[s>>2]=0,kf[e+104>>2]=0,a=0==(0|t);do if(!a){if(!(t>>>0>1073741823)){o=t<<2,h=0|sl(o),kf[r>>2]=h,l=h+(t<<2)|0,kf[e+104>>2]=l,0|Bs(0|h,0,0|o),kf[s>>2]=l;break}Du(r)}while(0);return s=e+108|0,kf[s>>2]=0,r=e+112|0,kf[r>>2]=0,kf[e+116>>2]=0,a||(l=t<<2,o=0|sl(l),kf[s>>2]=o,s=o+(t<<2)|0,kf[e+116>>2]=s,0|Bs(0|o,0,0|l),kf[r>>2]=s),s=t<<5|1,kf[n>>2]=0,r=n+4|0,kf[r>>2]=0,kf[n+8>>2]=0,a||(l=t<<2,o=0|sl(l),kf[n>>2]=o,h=o+(t<<2)|0,kf[n+8>>2]=h,0|Bs(0|o,0,0|l),kf[r>>2]=h),Ia(e+120|0,s,n),h=0|kf[n>>2],0|h&&(l=0|kf[r>>2],(0|l)!=(0|h)&&(kf[r>>2]=l+(~((l+-4-h|0)>>>2)<<2)),mf(h)),kf[n>>2]=0,h=n+4|0,kf[h>>2]=0,kf[n+8>>2]=0,a||(a=t<<2,l=0|sl(a),kf[n>>2]=l,r=l+(t<<2)|0,kf[n+8>>2]=r,0|Bs(0|l,0,0|a),kf[h>>2]=r),Ia(e+132|0,s,n),(s=0|kf[n>>2])?(n=0|kf[h>>2],(0|n)!=(0|s)&&(kf[h>>2]=n+(~((n+-4-s|0)>>>2)<<2)),mf(s),void(Xf=i)):void(Xf=i)}function nt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0;return n=Xf,Xf=Xf+16|0,r=n,s=i+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=i+16|0,h=s,l=0|kf[h>>2],c=0|kf[h+4>>2],(0|o)>(0|c)|(0|o)==(0|c)&a>>>0>l>>>0?(h=0|If[(0|kf[i>>2])+l>>0],d=0|tc(0|l,0|c,1,0),u=qf,f=s,kf[f>>2]=d,kf[f+4>>2]=u,h<<24>>24!=-2&&(p=u,_=d,m=h,A=3)):(p=c,_=l,m=0,A=3),3==(0|A)&&((0|o)>(0|p)|(0|o)==(0|p)&a>>>0>_>>>0?(a=0|If[(0|kf[i>>2])+_>>0],o=0|tc(0|_,0|p,1,0),p=s,kf[p>>2]=o,kf[p+4>>2]=qf,v=a):v=0,Dp[7&kf[(0|kf[e>>2])+40>>2]](r,e,m<<24>>24,v<<24>>24),v=e+20|0,m=0|kf[r>>2],kf[r>>2]=0,a=0|kf[v>>2],kf[v>>2]=m,a?(xp[127&kf[(0|kf[a>>2])+4>>2]](a),a=0|kf[r>>2],kf[r>>2]=0,0|a&&xp[127&kf[(0|kf[a>>2])+4>>2]](a)):kf[r>>2]=0),r=0|kf[e+20>>2],(!(0|r)||0|Mp[127&kf[(0|kf[e>>2])+28>>2]](e,r))&&0|Pp[31&kf[(0|kf[e>>2])+36>>2]](e,t,i)?(i=(0|kf[t+4>>2])-(0|kf[t>>2])>>2,t=0|kf[e+4>>2],!(0|t?((0|Lf[t+36>>0])<<8&65535)<512:0)||0|Mp[127&kf[(0|kf[e>>2])+48>>2]](e,i)?(y=1,Xf=n,0|y):(y=0,Xf=n,0|y)):(y=0,Xf=n,0|y)}function rt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;i=Xf,Xf=Xf+16|0,n=i,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=t,rd(e+16|0),Pc(e+32|0),Pc(e+52|0),Pc(e+72|0),r=e+92|0,kf[r>>2]=0,s=e+96|0,kf[s>>2]=0,kf[e+100>>2]=0,a=0==(0|t);do if(!a){if(!(t>>>0>1073741823)){o=t<<2,h=0|sl(o),kf[r>>2]=h,l=h+(t<<2)|0,kf[e+100>>2]=l,0|Bs(0|h,0,0|o),kf[s>>2]=l;break}Du(r)}while(0);return s=e+104|0,kf[s>>2]=0,r=e+108|0,kf[r>>2]=0,kf[e+112>>2]=0,a||(l=t<<2,o=0|sl(l),kf[s>>2]=o,s=o+(t<<2)|0,kf[e+112>>2]=s,0|Bs(0|o,0,0|l),kf[r>>2]=s),s=t<<5|1,kf[n>>2]=0,r=n+4|0,kf[r>>2]=0,kf[n+8>>2]=0,a||(l=t<<2,o=0|sl(l),kf[n>>2]=o,h=o+(t<<2)|0,kf[n+8>>2]=h,0|Bs(0|o,0,0|l),kf[r>>2]=h),Ia(e+116|0,s,n),h=0|kf[n>>2],0|h&&(l=0|kf[r>>2],(0|l)!=(0|h)&&(kf[r>>2]=l+(~((l+-4-h|0)>>>2)<<2)),mf(h)),kf[n>>2]=0,h=n+4|0,kf[h>>2]=0,kf[n+8>>2]=0,a||(a=t<<2,l=0|sl(a),kf[n>>2]=l,r=l+(t<<2)|0,kf[n+8>>2]=r,0|Bs(0|l,0,0|a),kf[h>>2]=r),Ia(e+128|0,s,n),(s=0|kf[n>>2])?(n=0|kf[h>>2],(0|n)!=(0|s)&&(kf[h>>2]=n+(~((n+-4-s|0)>>>2)<<2)),mf(s),void(Xf=i)):void(Xf=i)}function st(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(t=e+132|0,i=0|kf[t>>2],0|i){if(n=e+136|0,r=0|kf[n>>2],(0|r)==(0|i))s=i;else{for(a=r;;){if(r=a+-12|0,kf[n>>2]=r,o=0|kf[r>>2],o?(r=a+-8|0,l=0|kf[r>>2],(0|l)!=(0|o)&&(kf[r>>2]=l+(~((l+-4-o|0)>>>2)<<2)),mf(o),h=0|kf[n>>2]):h=r,(0|h)==(0|i))break;a=h}s=0|kf[t>>2]}mf(s)}if(s=e+120|0,t=0|kf[s>>2],0|t){if(h=e+124|0,a=0|kf[h>>2],(0|a)==(0|t))c=t;else{for(i=a;;){if(a=i+-12|0,kf[h>>2]=a,n=0|kf[a>>2],n?(a=i+-8|0,o=0|kf[a>>2],(0|o)!=(0|n)&&(kf[a>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n),d=0|kf[h>>2]):d=a,(0|d)==(0|t))break;i=d}c=0|kf[s>>2]}mf(c)}return c=0|kf[e+108>>2],0|c&&(s=e+112|0,d=0|kf[s>>2],(0|d)!=(0|c)&&(kf[s>>2]=d+(~((d+-4-c|0)>>>2)<<2)),mf(c)),(c=0|kf[e+96>>2])?(d=e+100|0,s=0|kf[d>>2],(0|s)!=(0|c)&&(kf[d>>2]=s+(~((s+-4-c|0)>>>2)<<2)),mf(c),u=e+76|0,bo(u),f=e+56|0,bo(f),p=e+36|0,bo(p),_=e+16|0,void bo(_)):(u=e+76|0,bo(u),f=e+56|0,bo(f),p=e+36|0,bo(p),_=e+16|0,void bo(_))}function at(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=0|kf[e+8>>2],n=e+76|0,r=0|kf[n>>2],s=0|kf[r+80>>2],If[t+84>>0]=0,a=t+68|0,o=t+72|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,s>>>0<=c>>>0?(s>>>0<c>>>0?(h=d+(s<<2)|0,(0|l)!=(0|h)):0)?(kf[o>>2]=l+(~((l+-4-h|0)>>>2)<<2),u=r,f=s):(u=r,f=s):(lr(a,s-c|0,3160),c=0|kf[n>>2],u=c,f=0|kf[c+80>>2]),c=(0|kf[u+100>>2])-(0|kf[u+96>>2])|0,n=(0|c)/12|0,!c)return p=1,0|p;for(c=e+80|0,e=t+68|0,t=0|kf[u+96>>2],u=0|kf[i+28>>2],i=0;;){if(s=3*i|0,a=0|kf[u+(s<<2)>>2],(0|a)==-1){p=0,_=11;break}if(r=0|kf[(0|kf[c>>2])+12>>2],h=0|kf[r+(a<<2)>>2],h>>>0>=f>>>0){p=0,_=11;break}if(a=0|kf[e>>2],kf[a+(kf[t+(12*i|0)>>2]<<2)>>2]=h,h=0|kf[u+(s+1<<2)>>2],(0|h)==-1){p=0,_=11;break}if(l=0|kf[r+(h<<2)>>2],l>>>0>=f>>>0){p=0,_=11;break}if(kf[a+(kf[t+(12*i|0)+4>>2]<<2)>>2]=l,l=0|kf[u+(s+2<<2)>>2],(0|l)==-1){p=0,_=11;break}if(s=0|kf[r+(l<<2)>>2],s>>>0>=f>>>0){p=0,_=11;break}if(kf[a+(kf[t+(12*i|0)+8>>2]<<2)>>2]=s,i=i+1|0,i>>>0>=n>>>0){p=1,_=11;break}}return 11==(0|_)?0|p:0}function ot(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0;return i=0|kf[e>>2],n=e+4|0,r=0|kf[n>>2],s=i,a=r+(~((r+-4-s|0)>>>2)<<2)|0,(0|r)==(0|i)?(o=r,h=i):(kf[n>>2]=a,o=a,h=a),a=e+16|0,kf[a>>2]=0,r=e+12|0,kf[r>>2]=h,h=t+8|0,l=h,c=0|kf[l>>2],d=0|kf[l+4>>2],l=t+16|0,u=l,f=0|kf[u>>2],p=0|tc(0|f,0|kf[u+4>>2],4,0),u=qf,(0|d)<(0|u)|(0|d)==(0|u)&c>>>0<p>>>0?(_=0,0|_):(m=(0|kf[t>>2])+f|0,f=Lf[m>>0]|Lf[m+1>>0]<<8|Lf[m+2>>0]<<16|Lf[m+3>>0]<<24,m=l,kf[m>>2]=p,kf[m+4>>2]=u,0!=(0|f)&0==(3&f|0)?(m=0|nc(0|c,0|d,0|p,0|u),A=qf,0>(0|A)|0==(0|A)&f>>>0>m>>>0?(_=0,0|_):(m=f>>>2,A=o-s>>2,m>>>0<=A>>>0?(m>>>0<A>>>0?(s=i+(m<<2)|0,(0|o)!=(0|s)):0)?(kf[n>>2]=o+(~((o+-4-s|0)>>>2)<<2),v=p,y=u,g=d,b=c):(v=p,y=u,g=d,b=c):(Kr(e,m-A|0),A=h,h=l,v=0|kf[h>>2],y=0|kf[h+4>>2],g=0|kf[A+4>>2],b=0|kf[A>>2]),A=0|tc(0|v,0|y,0|f,0),y=qf,(0|g)<(0|y)|(0|g)==(0|y)&b>>>0<A>>>0?(_=0,0|_):(0|ui(0|kf[e>>2],(0|kf[t>>2])+v|0,0|f),v=l,t=0|tc(0|kf[v>>2],0|kf[v+4>>2],0|f,0),f=l,kf[f>>2]=t,kf[f+4>>2]=qf,kf[r>>2]=kf[e>>2],kf[a>>2]=0,_=1,0|_))):(_=0,0|_))}function ht(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;i=e+4|0,n=0|kf[e>>2],r=((0|kf[i>>2])-n|0)/24|0,s=r+1|0,s>>>0>178956970&&Du(e),a=e+8|0,o=((0|kf[a>>2])-n|0)/24|0,n=o<<1,h=o>>>0<89478485?n>>>0<s>>>0?s:n:178956970;do if(h){if(!(h>>>0>178956970)){l=0|sl(24*h|0);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else l=0;while(0);if(n=l+(24*r|0)|0,s=n,o=l+(24*h|0)|0,kf[n>>2]=1228,kf[l+(24*r|0)+4>>2]=kf[t+4>>2],Sa(l+(24*r|0)+8|0,t+8|0),kf[l+(24*r|0)+20>>2]=kf[t+20>>2],t=n+24|0,r=0|kf[e>>2],l=0|kf[i>>2],(0|l)==(0|r))c=s,d=r,u=r;else{h=n,n=l,l=s;do kf[h+-24>>2]=1228,kf[h+-20>>2]=kf[n+-20>>2],s=h+-16|0,f=n+-16|0,kf[s>>2]=0,p=h+-12|0,kf[p>>2]=0,kf[h+-8>>2]=0,kf[s>>2]=kf[f>>2],s=n+-12|0,kf[p>>2]=kf[s>>2],p=n+-8|0,kf[h+-8>>2]=kf[p>>2],kf[p>>2]=0,kf[s>>2]=0,kf[f>>2]=0,kf[h+-4>>2]=kf[n+-4>>2],n=n+-24|0,h=l+-24|0,l=h;while((0|n)!=(0|r));c=l,d=0|kf[e>>2],u=0|kf[i>>2]}if(kf[e>>2]=c,kf[i>>2]=t,kf[a>>2]=o,o=d,(0|u)!=(0|o)){a=u;do a=a+-24|0,xp[127&kf[kf[a>>2]>>2]](a);while((0|a)!=(0|o))}d&&mf(d)}function lt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;i=Xf,Xf=Xf+32|0,n=i+24|0,r=i+16|0,s=i+8|0,a=i,kf[e>>2]=3148,kf[e+4>>2]=kf[t+4>>2],o=e+8|0,h=t+8|0,kf[o>>2]=0,l=e+12|0,kf[l>>2]=0,c=e+16|0,kf[c>>2]=0,d=t+12|0,u=0|kf[d>>2];do if(0|u){if(!((0|u)<0)){f=((u+-1|0)>>>5)+1|0,p=0|sl(f<<2),kf[o>>2]=p,kf[l>>2]=0,kf[c>>2]=f,f=0|kf[h>>2],kf[s>>2]=f,kf[s+4>>2]=0,p=0|kf[d>>2],kf[a>>2]=f+(p>>>5<<2),kf[a+4>>2]=31&p,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[n>>2]=kf[a>>2],kf[n+4>>2]=kf[a+4>>2],_t(o,r,n);break}Du(o)}while(0);return o=e+20|0,kf[o>>2]=0,d=e+24|0,kf[d>>2]=0,h=e+28|0,kf[h>>2]=0,e=t+24|0,(c=0|kf[e>>2])?((0|c)<0&&Du(o),l=((c+-1|0)>>>5)+1|0,c=0|sl(l<<2),kf[o>>2]=c,kf[d>>2]=0,kf[h>>2]=l,l=0|kf[t+20>>2],kf[s>>2]=l,kf[s+4>>2]=0,t=0|kf[e>>2],kf[a>>2]=l+(t>>>5<<2),kf[a+4>>2]=31&t,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[n>>2]=kf[a>>2],kf[n+4>>2]=kf[a+4>>2],_t(o,r,n),void(Xf=i)):void(Xf=i)}function ct(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;i=Xf,Xf=Xf+32|0,n=i+24|0,r=i+16|0,s=i+8|0,a=i,kf[e>>2]=3196,kf[e+4>>2]=kf[t+4>>2],o=e+8|0,h=t+8|0,kf[o>>2]=0,l=e+12|0,kf[l>>2]=0,c=e+16|0,kf[c>>2]=0,d=t+12|0,u=0|kf[d>>2];do if(0|u){if(!((0|u)<0)){f=((u+-1|0)>>>5)+1|0,p=0|sl(f<<2),kf[o>>2]=p,kf[l>>2]=0,kf[c>>2]=f,f=0|kf[h>>2],kf[s>>2]=f,kf[s+4>>2]=0,p=0|kf[d>>2],kf[a>>2]=f+(p>>>5<<2),kf[a+4>>2]=31&p,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[n>>2]=kf[a>>2],kf[n+4>>2]=kf[a+4>>2],_t(o,r,n);break}Du(o)}while(0);return o=e+20|0,kf[o>>2]=0,d=e+24|0,kf[d>>2]=0,h=e+28|0,kf[h>>2]=0,e=t+24|0,(c=0|kf[e>>2])?((0|c)<0&&Du(o),l=((c+-1|0)>>>5)+1|0,c=0|sl(l<<2),kf[o>>2]=c,kf[d>>2]=0,kf[h>>2]=l,l=0|kf[t+20>>2],kf[s>>2]=l,kf[s+4>>2]=0,t=0|kf[e>>2],kf[a>>2]=l+(t>>>5<<2),kf[a+4>>2]=31&t,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[n>>2]=kf[a>>2],kf[n+4>>2]=kf[a+4>>2],_t(o,r,n),void(Xf=i)):void(Xf=i)}function dt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(t=e+128|0,i=0|kf[t>>2],0|i){if(n=e+132|0,r=0|kf[n>>2],(0|r)==(0|i))s=i;else{for(a=r;;){if(r=a+-12|0,kf[n>>2]=r,o=0|kf[r>>2],o?(r=a+-8|0,l=0|kf[r>>2],(0|l)!=(0|o)&&(kf[r>>2]=l+(~((l+-4-o|0)>>>2)<<2)),mf(o),h=0|kf[n>>2]):h=r,(0|h)==(0|i))break;a=h}s=0|kf[t>>2]}mf(s)}if(s=e+116|0,t=0|kf[s>>2],0|t){if(h=e+120|0,a=0|kf[h>>2],(0|a)==(0|t))c=t;else{for(i=a;;){if(a=i+-12|0,kf[h>>2]=a,n=0|kf[a>>2],n?(a=i+-8|0,o=0|kf[a>>2],(0|o)!=(0|n)&&(kf[a>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n),d=0|kf[h>>2]):d=a,(0|d)==(0|t))break;i=d}c=0|kf[s>>2]}mf(c)}return c=0|kf[e+104>>2],0|c&&(s=e+108|0,d=0|kf[s>>2],(0|d)!=(0|c)&&(kf[s>>2]=d+(~((d+-4-c|0)>>>2)<<2)),mf(c)),(c=0|kf[e+92>>2])?(d=e+96|0,s=0|kf[d>>2],(0|s)!=(0|c)&&(kf[d>>2]=s+(~((s+-4-c|0)>>>2)<<2)),mf(c),u=e+72|0,bo(u),f=e+52|0,bo(f),p=e+32|0,bo(p),_=e+16|0,void bf(_)):(u=e+72|0,bo(u),f=e+52|0,bo(f),p=e+32|0,bo(p),_=e+16|0,void bf(_))}function ut(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=wp,A=wp,v=0,y=0,g=wp,b=0,E=wp;if(i=Xf,Xf=Xf+16|0,n=i,r=0|kf[e+24>>2],s=e+8|0,a=0|If[(0|kf[s>>2])+24>>0],o=a<<24>>24,h=o<<2,l=0|ff(o>>>0>1073741823?-1:o<<2),Vd(n),!(0|$h(n,ap(Gf[e+32>>2]),(1<<r)+-1|0)))return c=0,pf(l),Xf=i,0|c;if(r=0|kf[e+16>>2],d=0|kf[r+80>>2]?(0|kf[kf[r>>2]>>2])+(0|kf[r+48>>2])|0:0,!t)return c=1,pf(l),Xf=i,0|c;if(r=n+4|0,u=e+28|0,!(a<<24>>24>0)){for(a=0,e=0;;){if(0|ui((0|kf[kf[(0|kf[s>>2])+64>>2]>>2])+e|0,0|l,0|h),a=a+1|0,(0|a)==(0|t)){c=1;break}e=e+h|0}return pf(l),Xf=i,0|c}for(f=0,p=0,_=0;;){for(e=0|kf[u>>2],m=ap(Gf[r>>2]),A=ap(Gf[n>>2]),a=0,v=_;;){if(y=0|kf[d+(v<<2)>>2],(0|y)>-1?g=ap(ap(ap(0|y)*m)*A):(b=0|nc(0,0,0|y,((0|y)<0)<<31>>31|0),g=ap(-ap(A*ap(m*ap(+(b>>>0)+4294967296*+(0|qf)))))),E=ap(g+ap(Gf[e+(a<<2)>>2])),Gf[l+(a<<2)>>2]=E,a=a+1|0,(0|a)==(0|o))break;v=v+1|0}if(0|ui((0|kf[kf[(0|kf[s>>2])+64>>2]>>2])+p|0,0|l,0|h),f=f+1|0,(0|f)==(0|t)){c=1;break}p=p+h|0,_=o+_|0}return pf(l),Xf=i,0|c}function ft(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],a=s,((n-s|0)/12|0)>>>0>=t>>>0)return 0|Bs(0|s,0,12*t|0),void(kf[r>>2]=a+(12*t|0));o=0|kf[e>>2],h=(s-o|0)/12|0,s=h+t|0,l=o,s>>>0>357913941&&Du(e),c=(n-o|0)/12|0,n=c<<1,d=c>>>0<178956970?n>>>0<s>>>0?s:n:357913941;do if(d){if(!(d>>>0>357913941)){u=0|sl(12*d|0);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else u=0;while(0);if(n=u+(12*h|0)|0,h=n,s=u+(12*d|0)|0,0|Bs(0|n,0,12*t|0),d=n+(12*t|0)|0,(0|a)==(0|l))f=h,p=o,_=a;else{o=n,n=a,a=h;do h=o+-12|0,t=n,n=n+-12|0,kf[h>>2]=0,u=o+-8|0,kf[u>>2]=0,kf[o+-4>>2]=0,kf[h>>2]=kf[n>>2],h=t+-8|0,kf[u>>2]=kf[h>>2],u=t+-4|0,kf[o+-4>>2]=kf[u>>2],kf[u>>2]=0,kf[h>>2]=0,kf[n>>2]=0,o=a+-12|0,a=o;while((0|n)!=(0|l));f=a,p=0|kf[e>>2],_=0|kf[r>>2]}if(kf[e>>2]=f,kf[r>>2]=d,kf[i>>2]=s,s=p,(0|_)!=(0|s)){i=_;do _=i,i=i+-12|0,d=0|kf[i>>2],0|d&&(r=_+-8|0,_=0|kf[r>>2],(0|_)!=(0|d)&&(kf[r>>2]=_+(~((_+-4-d|0)>>>2)<<2)),mf(d));while((0|i)!=(0|s))}p&&mf(p)}function pt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return t=0|If[(0|kf[e+8>>2])+24>>0],i=0|ff(t>>>0>1073741823?-1:t<<2),n=e+28|0,r=0|kf[n>>2],kf[n>>2]=i,0|r&&pf(r),r=e+4|0,i=0|kf[(0|kf[r>>2])+32>>2],s=t<<2,t=i+8|0,a=0|kf[t>>2],o=0|kf[t+4>>2],t=i+16|0,h=t,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],0|s,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0?(d=0,0|d):(0|ui(0|kf[n>>2],(0|kf[i>>2])+l|0,0|s),l=t,i=0|tc(0|kf[l>>2],0|kf[l+4>>2],0|s,0),s=t,kf[s>>2]=i,kf[s+4>>2]=qf,s=(0|kf[r>>2])+32|0,r=0|kf[s>>2],i=r+8|0,t=0|kf[i>>2],l=0|kf[i+4>>2],i=r+16|0,n=i,c=0|kf[n>>2],a=0|tc(0|c,0|kf[n+4>>2],4,0),n=qf,(0|l)<(0|n)|(0|l)==(0|n)&t>>>0<a>>>0?(d=0,0|d):(a=e+32|0,t=(0|kf[r>>2])+c|0,c=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,If[a>>0]=c,If[a+1>>0]=c>>8,If[a+2>>0]=c>>16,If[a+3>>0]=c>>24,c=i,a=0|tc(0|kf[c>>2],0|kf[c+4>>2],4,0),c=i,kf[c>>2]=a,kf[c+4>>2]=qf,c=0|kf[s>>2],s=c+8|0,a=0|kf[s+4>>2],i=c+16|0,t=i,r=0|kf[t>>2],n=0|kf[t+4>>2],(0|a)>(0|n)|((0|a)==(0|n)?(0|kf[s>>2])>>>0>r>>>0:0)?(s=0|If[(0|kf[c>>2])+r>>0],c=0|tc(0|r,0|n,1,0),n=i,kf[n>>2]=c,kf[n+4>>2]=qf,(255&s)>31?(d=0,0|d):(kf[e+24>>2]=255&s,d=1,0|d)):(d=0,0|d)))}function _t(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;return n=Xf,Xf=Xf+48|0,r=n+40|0,s=n+32|0,a=n+8|0,o=n,h=n+24|0,l=n+16|0,c=e+4|0,d=0|kf[c>>2],u=t,t=0|kf[u>>2],f=0|kf[u+4>>2],u=i,i=0|kf[u>>2],p=0|kf[u+4>>2],u=i-t<<3,kf[c>>2]=d-f+p+u,c=(0|kf[e>>2])+(d>>>5<<2)|0,e=31&d,d=c,(0|f)!=(0|e)?(_=a,kf[_>>2]=t,kf[_+4>>2]=f,_=o,kf[_>>2]=i,kf[_+4>>2]=p,kf[h>>2]=d,kf[h+4>>2]=e,kf[s>>2]=kf[a>>2],kf[s+4>>2]=kf[a+4>>2],kf[r>>2]=kf[o>>2],kf[r+4>>2]=kf[o+4>>2],U(l,s,r,h),void(Xf=n)):(h=p-f+u|0,u=t,(0|h)>0?(f?(t=32-f|0,p=(0|h)<(0|t)?h:t,r=-1>>>(t-p|0)&-1<<f,kf[c>>2]=kf[c>>2]&~r|kf[u>>2]&r,r=p+f|0,t=u+4|0,m=c+(r>>>5<<2)|0,A=t,v=t,y=h-p|0,g=31&r):(m=c,A=t,v=u,y=h,g=0),r=(0|y)/32|0,0|Sh(0|m,0|A,r<<2|0),A=y-(r<<5)|0,y=m+(r<<2)|0,m=y,(0|A)>0?(p=-1>>>(32-A|0),kf[y>>2]=kf[y>>2]&~p|kf[v+(r<<2)>>2]&p,b=m,E=A):(b=m,E=g)):(b=d,E=f),kf[l>>2]=b,kf[l+4>>2]=E,void(Xf=n))}function mt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=Xf,Xf=Xf+32|0,n=i,r=e+8|0,s=0|kf[r>>2],a=e+4|0,o=0|kf[a>>2],s-o>>2>>>0>=t>>>0)return 0|Bs(0|o,0,t<<2|0),kf[a>>2]=o+(t<<2),void(Xf=i);h=0|kf[e>>2],l=o-h>>2,o=l+t|0,o>>>0>1073741823&&Du(e),c=s-h|0,h=c>>1,s=c>>2>>>0<536870911?h>>>0<o>>>0?o:h:1073741823,kf[n+12>>2]=0,kf[n+16>>2]=e+8;do if(s){if(!(s>>>0>1073741823)){d=0|sl(s<<2);break}h=0|dp(8),cd(h,13392),kf[h>>2]=4748,fp(0|h,1128,101)}else d=0;while(0);if(kf[n>>2]=d,h=d+(l<<2)|0,l=n+8|0,o=n+4|0,kf[o>>2]=h,c=n+12|0,kf[c>>2]=d+(s<<2),0|Bs(0|h,0,t<<2|0),kf[l>>2]=h+(t<<2),t=0|kf[e>>2],h=0|kf[a>>2],(0|h)==(0|t))u=o,f=0|kf[o>>2],p=t,_=h;else{s=0|kf[o>>2],d=h;do d=d+-4|0,h=0|kf[d>>2],kf[d>>2]=0,kf[s+-4>>2]=h,s=(0|kf[o>>2])+-4|0,kf[o>>2]=s;while((0|d)!=(0|t));u=o,f=s,p=0|kf[e>>2],_=0|kf[a>>2]}kf[e>>2]=f,kf[u>>2]=p,kf[a>>2]=kf[l>>2],kf[l>>2]=_,_=0|kf[r>>2],kf[r>>2]=kf[c>>2],kf[c>>2]=_,kf[n>>2]=kf[u>>2],Ir(n),Xf=i}function At(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t,r=i-n>>2,s=e+8|0,a=0|kf[s>>2],o=0|kf[e>>2],h=o,r>>>0<=a-o>>2>>>0){if(l=e+4|0,c=(0|kf[l>>2])-o>>2,d=r>>>0>c>>>0,u=t+(c<<2)|0,c=d?u:i,f=c,p=f-n|0,_=p>>2,0|_&&0|Sh(0|o,0|t,0|p),p=h+(_<<2)|0,!d){if(d=0|kf[l>>2],(0|d)==(0|p))return;return void(kf[l>>2]=d+(~((d+-4-p|0)>>>2)<<2))}if((0|c)==(0|i))return;for(c=0|kf[l>>2],p=((i+-4-f|0)>>>2)+1|0,f=c,d=u;;){if(kf[f>>2]=kf[d>>2],d=d+4|0,(0|d)==(0|i))break;f=f+4|0}return void(kf[l>>2]=c+(p<<2))}if(p=o,o?(a=e+4|0,c=0|kf[a>>2],(0|c)!=(0|h)&&(kf[a>>2]=c+(~((c+-4-o|0)>>>2)<<2)),mf(p),kf[s>>2]=0,kf[a>>2]=0,kf[e>>2]=0,m=0):m=a,r>>>0>1073741823&&Du(e),a=m>>1,p=m>>2>>>0<536870911?a>>>0<r>>>0?r:a:1073741823,p>>>0>1073741823&&Du(e),a=0|sl(p<<2),r=e+4|0,kf[r>>2]=a,kf[e>>2]=a,kf[s>>2]=a+(p<<2),(0|t)!=(0|i)){for(p=((i+-4-n|0)>>>2)+1|0,n=a,s=t;;){if(kf[n>>2]=kf[s>>2],s=s+4|0,(0|s)==(0|i))break;n=n+4|0}kf[r>>2]=a+(p<<2)}}function vt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0)return l=0,0|l;if(c=0|kf[t>>2],d=c+a|0,u=Lf[d>>0]|Lf[d+1>>0]<<8|Lf[d+2>>0]<<16|Lf[d+3>>0]<<24,d=i,kf[d>>2]=s,kf[d+4>>2]=h,h=0|tc(0|a,0|o,8,0),d=qf,(0|r)<(0|d)|(0|r)==(0|d)&n>>>0<h>>>0)return l=0,0|l;if(f=c+s|0,s=Lf[f>>0]|Lf[f+1>>0]<<8|Lf[f+2>>0]<<16|Lf[f+3>>0]<<24,f=i,kf[f>>2]=h,kf[f+4>>2]=d,(0|u)>(0|s))return l=0,0|l;if(kf[e+12>>2]=u,kf[e+16>>2]=s,f=0|nc(0|s,((0|s)<0)<<31>>31|0,0|u,((0|u)<0)<<31>>31|0),u=qf,!(u>>>0<0|0==(0|u)&f>>>0<2147483647))return l=0,0|l;u=f+1|0,kf[e+20>>2]=u,f=(0|u)/2|0,s=e+24|0,kf[s>>2]=f,kf[e+28>>2]=0-f,1&u||(kf[s>>2]=f+-1);do if((0|Ff[t+38>>1])<514){if(!((0|r)>(0|d)|(0|r)==(0|d)&n>>>0>h>>>0))return l=0,0|l;if(f=0|If[c+h>>0],s=0|tc(0|a,0|o,9,0),u=i,kf[u>>2]=s,kf[u+4>>2]=qf,(255&f)<2){kf[e+88>>2]=255&f;break}return l=0,0|l}while(0);return l=0|ie(e+108|0,t),0|l}function yt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;n=e+8|0,r=0|kf[n>>2],s=0|kf[e>>2],a=s;do{if(r-s>>2>>>0>=t>>>0){if(o=e+4|0,h=0|kf[o>>2],l=h-s>>2,c=l>>>0<t>>>0,d=c?l:t,u=h,0|d)for(h=a,f=d;;){if(kf[h>>2]=kf[i>>2],f=f+-1|0,!f)break;h=h+4|0}if(c){for(h=t-l|0,f=u,d=h;;){if(kf[f>>2]=kf[i>>2],d=d+-1|0,!d)break;f=f+4|0}p=o,_=u+(h<<2)|0;break}if(h=a+(t<<2)|0,(0|u)==(0|h))return;p=o,_=u+(~((u+-4-h|0)>>>2)<<2)|0;break}for(f=s,s?(d=e+4|0,l=0|kf[d>>2],(0|l)!=(0|a)&&(kf[d>>2]=l+(~((l+-4-s|0)>>>2)<<2)),mf(f),kf[n>>2]=0,kf[d>>2]=0,kf[e>>2]=0,m=0):m=r,t>>>0>1073741823&&Du(e),d=m>>1,f=m>>2>>>0<536870911?d>>>0<t>>>0?t:d:1073741823,f>>>0>1073741823&&Du(e),d=0|sl(f<<2),l=e+4|0,kf[l>>2]=d,kf[e>>2]=d,kf[n>>2]=d+(f<<2),f=d,c=t;;){if(kf[f>>2]=kf[i>>2],c=c+-1|0,!c)break;f=f+4|0}p=l,_=d+(t<<2)|0}while(0);kf[p>>2]=_}function gt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;if(n=t,r=i-n|0,s=r>>1,a=e+8|0,o=0|kf[a>>2],h=0|kf[e>>2],l=h,s>>>0<=o-h>>1>>>0){if(c=e+4|0,d=(0|kf[c>>2])-h>>1,u=s>>>0>d>>>0,f=t+(d<<1)|0,d=u?f:i,p=d,_=p-n|0,m=_>>1,0|m&&0|Sh(0|h,0|t,0|_),_=l+(m<<1)|0,!u){if(u=0|kf[c>>2],(0|u)==(0|_))return;return void(kf[c>>2]=u+(~((u+-2-_|0)>>>1)<<1))}if((0|d)==(0|i))return;for(d=0|kf[c>>2],_=i+-2-p|0,p=d,u=f;;){if(xf[p>>1]=0|xf[u>>1],u=u+2|0,(0|u)==(0|i))break;p=p+2|0}return void(kf[c>>2]=d+((_>>>1)+1<<1))}if(_=h,h?(o=e+4|0,d=0|kf[o>>2],(0|d)!=(0|l)&&(kf[o>>2]=d+(~((d+-2-h|0)>>>1)<<1)),mf(_),kf[a>>2]=0,kf[o>>2]=0,kf[e>>2]=0,A=0):A=o,(0|r)<0&&Du(e),r=A>>1>>>0<1073741823?A>>>0<s>>>0?s:A:2147483647,(0|r)<0&&Du(e),A=0|sl(r<<1),s=e+4|0,kf[s>>2]=A,kf[e>>2]=A,kf[a>>2]=A+(r<<1),(0|t)!=(0|i)){for(r=i+-2-n|0,n=A,a=t;;){if(xf[n>>1]=0|xf[a>>1],a=a+2|0,(0|a)==(0|i))break;n=n+2|0}kf[s>>2]=A+((r>>>1)+1<<1)}}function bt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(n=t,r=i-n>>2,s=e+8|0,a=0|kf[s>>2],o=0|kf[e>>2],h=o,r>>>0<=a-o>>2>>>0){if(l=e+4|0,c=(0|kf[l>>2])-o>>2,d=r>>>0>c>>>0,u=t+(c<<2)|0,c=d?u:i,f=c,p=f-n|0,_=p>>2,0|_&&0|Sh(0|o,0|t,0|p),p=h+(_<<2)|0,!d){if(d=0|kf[l>>2],(0|d)==(0|p))return;return void(kf[l>>2]=d+(~((d+-4-p|0)>>>2)<<2))}if((0|c)==(0|i))return;for(c=0|kf[l>>2],p=i+-4-f|0,f=c,d=u;;){if(kf[f>>2]=kf[d>>2],d=d+4|0,(0|d)==(0|i))break;f=f+4|0}return void(kf[l>>2]=c+((p>>>2)+1<<2))}if(p=o,o?(a=e+4|0,c=0|kf[a>>2],(0|c)!=(0|h)&&(kf[a>>2]=c+(~((c+-4-o|0)>>>2)<<2)),mf(p),kf[s>>2]=0,kf[a>>2]=0,kf[e>>2]=0,m=0):m=a,r>>>0>1073741823&&Du(e),a=m>>1,p=m>>2>>>0<536870911?a>>>0<r>>>0?r:a:1073741823,p>>>0>1073741823&&Du(e),a=0|sl(p<<2),r=e+4|0,kf[r>>2]=a,kf[e>>2]=a,kf[s>>2]=a+(p<<2),(0|t)!=(0|i)){for(p=i+-4-n|0,n=a,s=t;;){if(kf[n>>2]=kf[s>>2],s=s+4|0,(0|s)==(0|i))break;n=n+4|0}kf[r>>2]=a+((p>>>2)+1<<2)}}function Et(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0;a=Xf,Xf=Xf+32|0,o=a+16|0,h=a,l=0|kf[(0|kf[(0|kf[t+4>>2])+8>>2])+(n<<2)>>2];do if((i+-1|0)>>>0<6&1==(0|Cp[127&kf[(0|kf[t>>2])+8>>2]](t))){if(c=0|Cp[127&kf[(0|kf[t>>2])+36>>2]](t),d=0|Mp[127&kf[(0|kf[t>>2])+44>>2]](t,n),0==(0|c)|0==(0|d))return kf[e>>2]=0,void(Xf=a);if(u=0|Mp[127&kf[(0|kf[t>>2])+40>>2]](t,n)){if(kf[h>>2]=kf[t+44>>2],kf[h+4>>2]=u,kf[h+12>>2]=d,kf[h+8>>2]=d+12,bn(e,o,i,l,r,h,s),!(0|kf[e>>2])){kf[e>>2]=0;break}return void(Xf=a)}if(kf[h>>2]=kf[t+44>>2],kf[h+4>>2]=c,kf[h+12>>2]=d,kf[h+8>>2]=d+12,En(e,o,i,l,r,h,s),!(0|kf[e>>2])){kf[e>>2]=0;break}return void(Xf=a)}while(0);kf[e>>2]=0,Xf=a}function Tt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;if(i=Xf,Xf=Xf+16|0,n=i,r=e+76|0,s=0|kf[r>>2],a=e+80|0,o=0|kf[a>>2],(0|o)!=(0|s)&&(kf[a>>2]=o+(~((o+-4-s|0)>>>2)<<2)),kf[r>>2]=0,kf[a>>2]=0,kf[e+84>>2]=0,0|s&&mf(s),s=e+64|0,a=0|kf[s>>2],r=e+68|0,(0|kf[r>>2])!=(0|a)&&(kf[r>>2]=a),kf[s>>2]=0,kf[r>>2]=0,kf[e+72>>2]=0,0|a&&mf(a),a=t+4|0,r=0|kf[a>>2],s=0|kf[t>>2],o=3*((r-s|0)/12|0)|0,h=e+4|0,l=0|kf[h>>2],c=0|kf[e>>2],d=l-c>>2,u=c,c=l,l=s,o>>>0<=d>>>0?(o>>>0<d>>>0?(f=u+(o<<2)|0,(0|c)!=(0|f)):0)?(kf[h>>2]=c+(~((c+-4-f|0)>>>2)<<2),p=r,_=s,m=l):(p=r,_=s,m=l):(Kr(e,o-d|0),d=0|kf[t>>2],p=0|kf[a>>2],_=d,m=d),(0|p)!=(0|_)){_=0|kf[e>>2],d=(p-m|0)/12|0,p=0;do a=3*p|0,kf[_+(a<<2)>>2]=kf[m+(12*p|0)>>2],kf[_+(a+1<<2)>>2]=kf[m+(12*p|0)+4>>2],kf[_+(a+2<<2)>>2]=kf[m+(12*p|0)+8>>2],p=p+1|0;while(p>>>0<d>>>0)}return kf[n>>2]=-1,0|tn(e,n)?(0|Ni(e,0|kf[n>>2]),A=1,Xf=i,0|A):(A=0,Xf=i,0|A)}function St(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0;if(kf[e+4>>2]=kf[t+4>>2],i=e+8|0,n=t+8|0,(0|e)==(0|t))return 0|e;if(r=t+12|0,s=0|kf[r>>2]){o=e+16|0;do if(s>>>0>kf[o>>2]<<5>>>0){if(h=0|kf[i>>2],h?(mf(h),kf[i>>2]=0,kf[o>>2]=0,kf[e+12>>2]=0,l=0|kf[r>>2]):l=s,!((0|l)<0)){h=((l+-1|0)>>>5)+1|0,c=0|sl(h<<2),kf[i>>2]=c,kf[e+12>>2]=0,kf[o>>2]=h,
d=0|kf[r>>2],u=c;break}Du(i)}else d=s,u=0|kf[i>>2];while(0);0|Sh(0|u,0|kf[n>>2],((d+-1|0)>>>5<<2)+4|0),a=0|kf[r>>2]}else a=0;if(kf[e+12>>2]=a,a=e+20|0,r=t+20|0,d=t+24|0,t=0|kf[d>>2]){n=e+28|0;do if(t>>>0>kf[n>>2]<<5>>>0){if(u=0|kf[a>>2],u?(mf(u),kf[a>>2]=0,kf[n>>2]=0,kf[e+24>>2]=0,p=0|kf[d>>2]):p=t,!((0|p)<0)){u=((p+-1|0)>>>5)+1|0,i=0|sl(u<<2),kf[a>>2]=i,kf[e+24>>2]=0,kf[n>>2]=u,_=0|kf[d>>2],m=i;break}Du(a)}else _=t,m=0|kf[a>>2];while(0);0|Sh(0|m,0|kf[r>>2],((_+-1|0)>>>5<<2)+4|0),f=0|kf[d>>2]}else f=0;return kf[e+24>>2]=f,0|e}function wt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(kf[t>>2]=1,i=e+4|0,n=t+8|0,r=t+12|0,t=0|kf[n>>2],s=(0|kf[r>>2])-t|0,s>>>0<4294967292?(Ja(n,s+4|0,0),a=0|kf[n>>2]):a=t,t=a+s|0,s=Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,If[t>>0]=s,If[t+1>>0]=s>>8,If[t+2>>0]=s>>16,If[t+3>>0]=s>>24,s=e+8|0,t=e+12|0,i=0|kf[s>>2],(0|kf[t>>2])!=(0|i)){a=i,i=0;do o=a+(i<<2)|0,h=0|kf[n>>2],l=(0|kf[r>>2])-h|0,l>>>0<4294967292?(Ja(n,l+4|0,0),c=0|kf[n>>2]):c=h,h=c+l|0,l=Lf[o>>0]|Lf[o+1>>0]<<8|Lf[o+2>>0]<<16|Lf[o+3>>0]<<24,If[h>>0]=l,If[h+1>>0]=l>>8,If[h+2>>0]=l>>16,If[h+3>>0]=l>>24,i=i+1|0,a=0|kf[s>>2];while(i>>>0<(0|kf[t>>2])-a>>2>>>0)}return a=e+20|0,e=0|kf[n>>2],t=(0|kf[r>>2])-e|0,t>>>0<4294967292?(Ja(n,t+4|0,0),d=0|kf[n>>2],u=d+t|0,f=Lf[a>>0]|Lf[a+1>>0]<<8|Lf[a+2>>0]<<16|Lf[a+3>>0]<<24,If[u>>0]=f,If[u+1>>0]=f>>8,If[u+2>>0]=f>>16,void(If[u+3>>0]=f>>24)):(d=e,u=d+t|0,f=Lf[a>>0]|Lf[a+1>>0]<<8|Lf[a+2>>0]<<16|Lf[a+3>>0]<<24,If[u>>0]=f,If[u+1>>0]=f>>8,If[u+2>>0]=f>>16,void(If[u+3>>0]=f>>24))}function Ct(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(t=Xf,Xf=Xf+16|0,i=t+4|0,n=t,r=e+8|0,s=0|kf[r>>2],pa(0|kf[e+4>>2],(0|kf[s+56>>2])-(0|kf[s+52>>2])>>2),s=e+84|0,e=0|kf[s>>2]){if(a=0|kf[e>>2],(0|kf[e+4>>2])==(0|a))return h=1,Xf=t,0|h;for(e=a,a=0;;){if(kf[n>>2]=kf[e+(a<<2)>>2],kf[i>>2]=kf[n>>2],a=a+1|0,!(0|zi(r,i))){h=0,l=10;break}if(o=0|kf[s>>2],e=0|kf[o>>2],a>>>0>=(0|kf[o+4>>2])-e>>2>>>0){h=1,l=10;break}}if(10==(0|l))return Xf=t,0|h}else{if(a=0|kf[(0|kf[r>>2])+64>>2],o=(0|kf[a+4>>2])-(0|kf[a>>2])>>2,a=(o>>>0)/3|0,o>>>0<=2)return h=1,Xf=t,0|h;for(o=0;;){if(kf[n>>2]=3*o,kf[i>>2]=kf[n>>2],o=o+1|0,!(0|zi(r,i))){h=0,l=10;break}if((0|o)>=(0|a)){h=1,l=10;break}}if(10==(0|l))return Xf=t,0|h}return 0}function Mt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;if(n=i,r=t,s=n-r|0,a=s>>2,o=e+8|0,h=0|kf[o>>2],l=0|kf[e>>2],c=l,a>>>0>h-l>>2>>>0){if(d=l,l?(h=e+4|0,f=0|kf[h>>2],(0|f)!=(0|c)&&(kf[h>>2]=f+(~((f+-4-l|0)>>>2)<<2)),mf(d),kf[o>>2]=0,kf[h>>2]=0,kf[e>>2]=0,u=0):u=h,a>>>0>1073741823&&Du(e),h=u>>1,d=u>>2>>>0<536870911?h>>>0<a>>>0?a:h:1073741823,d>>>0>1073741823&&Du(e),h=0|sl(d<<2),u=e+4|0,kf[u>>2]=h,kf[e>>2]=h,kf[o>>2]=h+(d<<2),(0|s)<=0)return;return 0|ui(0|h,0|t,0|s),void(kf[u>>2]=h+(s>>>2<<2))}if(s=e+4|0,e=0|kf[s>>2],h=e-l>>2,l=a>>>0>h>>>0,a=l?t+(h<<2)|0:i,i=e,h=e,(0|a)==(0|t))p=c;else{for(e=a+-4-r|0,r=t,t=c;;){if(kf[t>>2]=kf[r>>2],r=r+4|0,(0|r)==(0|a))break;t=t+4|0}p=c+((e>>>2)+1<<2)|0}if(l){if(l=n-a|0,(0|l)<=0)return;return 0|ui(0|h,0|a,0|l),void(kf[s>>2]=(0|kf[s>>2])+(l>>>2<<2))}if((0|i)!=(0|p))return void(kf[s>>2]=i+(~((i+-4-p|0)>>>2)<<2))}function Pt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;if(i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0)return l=0,0|l;c=0|kf[t>>2],d=c+a|0,u=Lf[d>>0]|Lf[d+1>>0]<<8|Lf[d+2>>0]<<16|Lf[d+3>>0]<<24,d=i,kf[d>>2]=s,kf[d+4>>2]=h,d=(0|Ff[t+38>>1])<514;do{if(d){if(f=0|tc(0|a,0|o,8,0),p=qf,(0|r)<(0|p)|(0|r)==(0|p)&n>>>0<f>>>0)return l=0,0|l;_=i,kf[_>>2]=f,kf[_+4>>2]=p,m=p,A=f;break}m=h,A=s}while(0);if(!(1&u))return l=0,0|l;if(s=31^(0|sp(0|u)),(s+-1|0)>>>0>28)return l=0,0|l;kf[e+8>>2]=s+1,u=2<<s,kf[e+12>>2]=u+-1,s=u+-2|0,kf[e+16>>2]=s,kf[e+20>>2]=(0|s)/2|0;do if(d){if(!((0|r)>(0|m)|(0|r)==(0|m)&n>>>0>A>>>0))return l=0,0|l;if(s=0|If[c+A>>0],u=0|tc(0|A,0|m,1,0),h=i,kf[h>>2]=u,kf[h+4>>2]=qf,(255&s)<2){kf[e+68>>2]=255&s;break}return l=0,0|l}while(0);return l=0|ie(e+88|0,t),0|l}function It(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(t=Xf,Xf=Xf+16|0,i=t+4|0,n=t,r=e+8|0,s=0|kf[r>>2],pa(0|kf[e+4>>2],(0|kf[s+28>>2])-(0|kf[s+24>>2])>>2),s=e+84|0,e=0|kf[s>>2]){if(a=0|kf[e>>2],(0|kf[e+4>>2])==(0|a))return h=1,Xf=t,0|h;for(e=a,a=0;;){if(kf[n>>2]=kf[e+(a<<2)>>2],kf[i>>2]=kf[n>>2],a=a+1|0,!(0|Yi(r,i))){h=0,l=10;break}if(o=0|kf[s>>2],e=0|kf[o>>2],a>>>0>=(0|kf[o+4>>2])-e>>2>>>0){h=1,l=10;break}}if(10==(0|l))return Xf=t,0|h}else{if(a=0|kf[r>>2],o=(0|kf[a+4>>2])-(0|kf[a>>2])>>2,a=(o>>>0)/3|0,o>>>0<=2)return h=1,Xf=t,0|h;for(o=0;;){if(kf[n>>2]=3*o,kf[i>>2]=kf[n>>2],o=o+1|0,!(0|Yi(r,i))){h=0,l=10;break}if((0|o)>=(0|a)){h=1,l=10;break}}if(10==(0|l))return Xf=t,0|h}return 0}function Rt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;i=Xf,Xf=Xf+112|0,n=i+96|0,r=i+16|0,s=i+4|0,a=i,o=r+76|0,h=r,l=h+76|0;do kf[h>>2]=0,h=h+4|0;while((0|h)<(0|l));return kf[o>>2]=-1,kf[s>>2]=0,o=s+4|0,kf[o>>2]=0,kf[s+8>>2]=0,kf[a>>2]=s,kf[n>>2]=kf[a>>2],0|_(r,e,n)?(n=0|kf[s>>2],bt(t,n,n+((0|kf[o>>2])-n>>2<<2)|0),c=0|kf[r+68>>2]):c=0,n=0|kf[s>>2],0|n&&(s=0|kf[o>>2],(0|s)!=(0|n)&&(kf[o>>2]=s+(~((s+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[r+56>>2],0|n&&mf(n),n=0|kf[r+32>>2],0|n&&(s=r+36|0,o=0|kf[s>>2],(0|o)!=(0|n)&&(kf[s>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[r+20>>2],0|n&&(o=r+24|0,s=0|kf[o>>2],(0|s)!=(0|n)&&(kf[o>>2]=s+(~((s+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[r+8>>2],0|n&&(s=r+12|0,o=0|kf[s>>2],(0|o)!=(0|n)&&(kf[s>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n)),n=r+4|0,r=0|kf[n>>2],kf[n>>2]=0,r?(is(r),mf(r),Xf=i,0|c):(Xf=i,0|c)}function xt(e,t,i,n){e=0|e,t=ap(t),i=ap(i),n=0|n;var r=wp,s=wp,a=wp,o=wp,h=wp,l=wp,c=wp,d=wp,u=0,f=0,p=0,_=0,m=0,A=0,v=wp,y=wp,g=0,b=0;if(r=ap(t+i),s=ap(t-i),!(s<=ap(.5))|(!(s>=ap(-.5))|(!(r>=ap(.5))|!(r<=ap(1.5))))){do{if(!(r<=ap(.5))){if(r>=ap(1.5)){a=ap(ap(1.5)-i),o=ap(ap(1.5)-t);break}if(s<=ap(-.5)){a=ap(i+ap(-.5)),o=ap(t+ap(.5));break}a=ap(i+ap(.5)),o=ap(t+ap(-.5));break}a=ap(ap(.5)-i),o=ap(ap(.5)-t)}while(0);h=a,l=ap(a-o),c=ap(o+a),d=o,u=-1}else h=t,l=s,c=r,d=i,u=1;return i=ap(2*+h+-1),h=ap(2*+d+-1),f=2*+c,p=f+-1,_=3-f,f=2*+l,m=f+1,A=1-f,f=A<m?A:m,m=_<p?_:p,l=ap(u*(f<m?f:m)),c=ap(ap(h*h)+ap(ap(i*i)+ap(l*l))),+c<1e-6?(Gf[n>>2]=ap(0),v=ap(0),y=ap(0),g=n+4|0,Gf[g>>2]=v,b=n+8|0,void(Gf[b>>2]=y)):(d=ap(ap(1)/ap(tp(ap(c)))),c=ap(l*d),Gf[n>>2]=c,v=ap(i*d),y=ap(h*d),g=n+4|0,Gf[g>>2]=v,b=n+8|0,void(Gf[b>>2]=y))}function Ot(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;n=255&t,r=0!=(0|i);e:do if(r&0!=(3&e|0))for(s=255&t,a=i,o=e;;){if((0|If[o>>0])==s<<24>>24){h=a,l=o,c=6;break e}if(d=o+1|0,u=a+-1|0,f=0!=(0|u),!(f&0!=(3&d|0))){p=u,_=d,m=f,c=5;break}a=u,o=d}else p=i,_=e,m=r,c=5;while(0);5==(0|c)&&(m?(h=p,l=_,c=6):(A=0,v=_));e:do if(6==(0|c))if(_=255&t,(0|If[l>>0])==_<<24>>24)A=h,v=l;else{p=0|np(n,16843009);t:do if(h>>>0>3){for(m=h,r=l;;){if(e=kf[r>>2]^p,(e&-2139062144^-2139062144)&e+-16843009|0)break;if(e=r+4|0,i=m+-4|0,!(i>>>0>3)){y=i,g=e,c=11;break t}m=i,r=e}b=m,E=r}else y=h,g=l,c=11;while(0);if(11==(0|c)){if(!y){A=0,v=g;break}b=y,E=g}for(;;){if((0|If[E>>0])==_<<24>>24){A=b,v=E;break e}if(p=E+1|0,b=b+-1|0,!b){A=0,v=p;break}E=p}}while(0);return 0|(0|A?v:0)}function kt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=e+4|0,n=0|kf[i>>2],r=0|kf[e>>2],s=r;do if((0|n)==(0|r)){if(a=e+8|0,o=0|kf[a>>2],h=e+12|0,l=0|kf[h>>2],c=l,o>>>0<l>>>0){l=o,d=((c-l>>2)+1|0)/2|0,u=o+(d<<2)|0,f=l-n|0,l=f>>2,p=u+(0-l<<2)|0,l?(0|Sh(0|p,0|n,0|f),_=0|kf[a>>2],m=p):(_=o,m=u),kf[i>>2]=m,kf[a>>2]=_+(d<<2),A=m;break}if(d=c-s>>1,c=0==(0|d)?1:d,c>>>0>1073741823&&(d=0|dp(8),cd(d,13392),kf[d>>2]=4748,fp(0|d,1128,101)),d=0|sl(c<<2),p=d,f=d+((c+3|0)>>>2<<2)|0,u=f,l=d+(c<<2)|0,(0|n)==(0|o))v=n,y=u;else{c=f,d=n,g=u;do kf[c>>2]=kf[d>>2],c=g+4|0,g=c,d=d+4|0;while((0|d)!=(0|o));v=0|kf[e>>2],y=g}kf[e>>2]=p,kf[i>>2]=u,kf[a>>2]=y,kf[h>>2]=l,v?(mf(v),A=0|kf[i>>2]):A=f}else A=n;while(0);kf[A+-4>>2]=kf[t>>2],kf[i>>2]=(0|kf[i>>2])+-4}function Dt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(n=e+4|0,r=0|kf[n>>2],!r)return kf[t>>2]=n,s=n,0|s;for(n=0|If[i+11>>0],a=n<<24>>24<0,o=a?0|kf[i+4>>2]:255&n,n=a?0|kf[i>>2]:i,i=r,r=e+4|0;;){if(e=i+16|0,a=0|If[e+11>>0],h=a<<24>>24<0,l=h?0|kf[i+20>>2]:255&a,a=l>>>0<o>>>0,c=a?l:o,u=(0!=(0|c)?(d=0|fo(n,h?0|kf[e>>2]:e,c),0!=(0|d)):0)?(0|d)<0?8:10:o>>>0<l>>>0?8:10,8==(0|u)){if(u=0,d=0|kf[i>>2],!d){u=9;break}f=d,p=i}else if(10==(0|u)){if(u=0,d=o>>>0<l>>>0?o:l,0!=(0|d)?(l=0|fo(h?0|kf[e>>2]:e,n,d),0!=(0|l)):0){if((0|l)>=0){u=16;break}}else u=12;if(12==(0|u)?(u=0,!a):0){u=16;break}if(_=i+4|0,a=0|kf[_>>2],!a){u=15;break}f=a,p=_}i=f,r=p}return 9==(0|u)?(kf[t>>2]=i,s=i,0|s):15==(0|u)?(kf[t>>2]=i,s=_,0|s):16==(0|u)?(kf[t>>2]=i,s=r,0|s):0}function Lt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0;return n=Xf,Xf=Xf+32|0,r=n+24|0,s=n+16|0,a=n+8|0,o=n,h=e+4|0,l=0|kf[h>>2],c=0|kf[t>>2],d=0|kf[t+4>>2],t=0|kf[i>>2],u=0|kf[i+4>>2],i=t-c<<3,kf[h>>2]=l-d+u+i,h=(0|kf[e>>2])+(l>>>5<<2)|0,e=31&l,l=h,(0|d)!=(0|e)?(kf[r>>2]=c,kf[r+4>>2]=d,kf[s>>2]=t,kf[s+4>>2]=u,kf[a>>2]=l,kf[a+4>>2]=e,z(o,r,s,a),void(Xf=n)):(a=u-d+i|0,i=c,(0|a)>0?(d?(c=32-d|0,u=(0|a)<(0|c)?a:c,s=-1>>>(c-u|0)&-1<<d,kf[h>>2]=kf[h>>2]&~s|kf[i>>2]&s,s=u+d|0,c=i+4|0,f=c,p=c,_=a-u|0,m=h+(s>>>5<<2)|0,A=31&s):(f=c,p=i,_=a,m=h,A=0),s=(0|_)/32|0,0|Sh(0|m,0|f,s<<2|0),f=_-(s<<5)|0,_=m+(s<<2)|0,m=_,(0|f)>0?(h=-1>>>(32-f|0),kf[_>>2]=kf[_>>2]&~h|kf[p+(s<<2)>>2]&h,v=m,y=f):(v=m,y=A)):(v=l,y=d),kf[o>>2]=v,kf[o+4>>2]=y,void(Xf=n))}function Nt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(t=0|kf[e+32>>2],i=t+8|0,n=0|kf[i+4>>2],r=t+16|0,s=r,a=0|kf[s>>2],o=0|kf[s+4>>2],!((0|n)>(0|o)|((0|n)==(0|o)?(0|kf[i>>2])>>>0>a>>>0:0)))return h=0,0|h;switch(i=0|If[(0|kf[t>>2])+a>>0],t=0|tc(0|a,0|o,1,0),o=r,kf[o>>2]=t,kf[o+4>>2]=qf,o=e+48|0,t=0|kf[o>>2],kf[o>>2]=0,0|t&&xp[127&kf[(0|kf[t>>2])+4>>2]](t),i<<24>>24){case 0:i=0|sl(384),ha(i),t=0|kf[o>>2],kf[o>>2]=i,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),c=11):l=i;break;case 1:t=0|sl(424),bs(t),i=0|kf[o>>2],kf[o>>2]=t,i?(xp[127&kf[(0|kf[i>>2])+4>>2]](i),c=11):l=t;break;case 2:i=0|sl(440),$r(i),t=0|kf[o>>2],kf[o>>2]=i,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),c=11):l=i;break;default:c=11}if(11==(0|c)){if(c=0|kf[o>>2],!c)return h=0,0|h;l=c}return h=0|Mp[127&kf[(0|kf[l>>2])+8>>2]](l,e),0|h}function Ft(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;return n=Xf,Xf=Xf+32|0,r=n+12|0,s=n,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,a=0|qs(t),a>>>0>4294967279&&Du(r),a>>>0<11?(If[r+11>>0]=a,a?(h=r,l=6):o=r):(c=a+16&-16,d=0|sl(c),kf[r>>2]=d,kf[r+8>>2]=c|-2147483648,kf[r+4>>2]=a,h=d,l=6),6==(0|l)&&(0|ui(0|h,0|t,0|a),o=h),If[o+a>>0]=0,kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,a=0|qs(i),a>>>0>4294967279&&Du(s),a>>>0<11?(If[s+11>>0]=a,a?(f=s,l=12):u=s):(o=a+16&-16,h=0|sl(o),kf[s>>2]=h,kf[s+8>>2]=o|-2147483648,kf[s+4>>2]=a,f=h,l=12),12==(0|l)&&(0|ui(0|f,0|i,0|a),u=f),If[u+a>>0]=0,a=0|kf[e+4>>2],p=(0!=(0|a)?(u=0|Ie(a,r,s),0!=(0|u)):0)?0|uo(e,0|kf[u+40>>2]):-1,(0|If[s+11>>0])<0&&mf(0|kf[s>>2]),(0|If[r+11>>0])>=0?(Xf=n,0|p):(mf(0|kf[r>>2]),Xf=n,0|p)}function Bt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;i=e+8|0,n=0|kf[i>>2],r=e+12|0,s=0|kf[r>>2],a=s,o=n;do if((0|n)==(0|s)){if(h=e+4|0,l=0|kf[h>>2],c=0|kf[e>>2],d=c,l>>>0>c>>>0){u=l,f=((u-d>>2)+1|0)/-2|0,p=l+(f<<2)|0,_=o-u|0,u=_>>2,u?(0|Sh(0|p,0|l,0|_),m=0|kf[h>>2]):m=l,_=p+(u<<2)|0,kf[i>>2]=_,kf[h>>2]=m+(f<<2),A=_;break}if(_=a-d>>1,d=0==(0|_)?1:_,d>>>0>1073741823&&(_=0|dp(8),cd(_,13392),kf[_>>2]=4748,fp(0|_,1128,101)),_=0|sl(d<<2),f=_,u=_+(d>>>2<<2)|0,p=u,v=_+(d<<2)|0,(0|l)==(0|n))y=c,g=p;else{c=u,u=l,l=p;do kf[c>>2]=kf[u>>2],c=l+4|0,l=c,u=u+4|0;while((0|u)!=(0|n));y=0|kf[e>>2],g=l}kf[e>>2]=f,kf[h>>2]=p,kf[i>>2]=g,kf[r>>2]=v,y?(mf(y),A=0|kf[i>>2]):A=g}else A=n;while(0);kf[A>>2]=kf[t>>2],kf[i>>2]=(0|kf[i>>2])+4}function Vt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;if(n=t,r=i-n|0,s=e+8|0,a=0|kf[s>>2],o=0|kf[e>>2],h=o,r>>>0>(a-o|0)>>>0){if(o?(a=e+4|0,(0|kf[a>>2])!=(0|h)&&(kf[a>>2]=h),mf(h),kf[s>>2]=0,kf[a>>2]=0,kf[e>>2]=0,l=0):l=a,(0|r)<0&&Du(e),a=l<<1,c=l>>>0<1073741823?a>>>0<r>>>0?r:a:2147483647,(0|c)<0&&Du(e),a=0|sl(c),l=e+4|0,kf[l>>2]=a,kf[e>>2]=a,kf[s>>2]=a+c,(0|t)==(0|i))return;d=a,u=t;do If[d>>0]=0|If[u>>0],u=u+1|0,d=(0|kf[l>>2])+1|0,kf[l>>2]=d;while((0|u)!=(0|i))}else{if(u=e+4|0,e=(0|kf[u>>2])-o|0,o=r>>>0>e>>>0,r=t+e|0,e=o?r:i,d=e-n|0,0|d&&0|Sh(0|h,0|t,0|d),t=h+d|0,!o){if((0|kf[u>>2])==(0|t))return;return void(kf[u>>2]=t)}if((0|e)!=(0|i)){e=0|kf[u>>2],t=r;do If[e>>0]=0|If[t>>0],t=t+1|0,e=(0|kf[u>>2])+1|0,kf[u>>2]=e;while((0|t)!=(0|i))}}}function Ut(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],a=s,n-s>>2>>>0>=t>>>0)return 0|Bs(0|s,0,t<<2|0),void(kf[r>>2]=s+(t<<2));o=0|kf[e>>2],h=s-o>>2,s=h+t|0,l=o,s>>>0>1073741823&&Du(e),c=n-o|0,n=c>>1,d=c>>2>>>0<536870911?n>>>0<s>>>0?s:n:1073741823;do if(d){if(!(d>>>0>1073741823)){u=0|sl(d<<2);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else u=0;while(0);if(n=u+(h<<2)|0,0|Bs(0|n,0,t<<2|0),t=n,h=u+(d<<2)|0,d=u+(s<<2)|0,(0|a)==(0|l))f=t,p=o,_=a;else{o=n,n=a,a=t;do n=n+-4|0,t=0|kf[n>>2],kf[n>>2]=0,kf[o+-4>>2]=t,o=a+-4|0,a=o;while((0|n)!=(0|l));f=a,p=0|kf[e>>2],_=0|kf[r>>2]}if(kf[e>>2]=f,kf[r>>2]=d,kf[i>>2]=h,h=p,(0|_)!=(0|h)){i=_;do i=i+-4|0,_=0|kf[i>>2],kf[i>>2]=0,0|_&&xp[127&kf[(0|kf[_>>2])+4>>2]](_);while((0|i)!=(0|h))}p&&mf(p)}function Gt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;i=e+4|0,n=0|kf[e>>2],r=((0|kf[i>>2])-n|0)/12|0,s=r+1|0,s>>>0>357913941&&Du(e),a=e+8|0,o=((0|kf[a>>2])-n|0)/12|0,n=o<<1,h=o>>>0<178956970?n>>>0<s>>>0?s:n:357913941;do if(h){if(!(h>>>0>357913941)){l=0|sl(12*h|0);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else l=0;while(0);if(n=l+(12*r|0)|0,r=n,s=l+(12*h|0)|0,Ds(n,t),t=n+12|0,h=0|kf[e>>2],l=0|kf[i>>2],(0|l)==(0|h))c=r,d=h,u=h;else{o=n,n=l,l=r;do r=o+-12|0,n=n+-12|0,kf[r>>2]=kf[n>>2],kf[r+4>>2]=kf[n+4>>2],kf[r+8>>2]=kf[n+8>>2],kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,o=l+-12|0,l=o;while((0|n)!=(0|h));c=l,d=0|kf[e>>2],u=0|kf[i>>2]}if(kf[e>>2]=c,kf[i>>2]=t,kf[a>>2]=s,s=d,(0|u)!=(0|s)){a=u;do a=a+-12|0,(0|If[a+11>>0])<0&&mf(0|kf[a>>2]);while((0|a)!=(0|s))}d&&mf(d)}function Wt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(n=i,r=t,s=n-r|0,a=s>>2,o=e+8|0,h=0|kf[o>>2],l=0|kf[e>>2],c=l,a>>>0<=h-l>>2>>>0){if(d=e+4|0,u=(0|kf[d>>2])-l>>2,f=a>>>0>u>>>0,p=f?t+(u<<2)|0:i,i=p,u=i-r|0,r=u>>2,0|r&&0|Sh(0|l,0|t,0|u),u=c+(r<<2)|0,f){if(f=n-i|0,(0|f)<=0)return;return 0|ui(0|kf[d>>2],0|p,0|f),void(kf[d>>2]=(0|kf[d>>2])+(f>>>2<<2))}if(f=0|kf[d>>2],(0|f)==(0|u))return;return void(kf[d>>2]=f+(~((f+-4-u|0)>>>2)<<2))}u=l,l?(h=e+4|0,f=0|kf[h>>2],(0|f)!=(0|c)&&(kf[h>>2]=f+(~((f+-4-l|0)>>>2)<<2)),mf(u),kf[o>>2]=0,kf[h>>2]=0,kf[e>>2]=0,_=0):_=h,a>>>0>1073741823&&Du(e),h=_>>1,u=_>>2>>>0<536870911?h>>>0<a>>>0?a:h:1073741823,u>>>0>1073741823&&Du(e),h=0|sl(u<<2),a=e+4|0,kf[a>>2]=h,kf[e>>2]=h,kf[o>>2]=h+(u<<2),(0|s)<=0||(0|ui(0|h,0|t,0|s),kf[a>>2]=h+(s>>>2<<2))}function zt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0)return l=0,0|l;if(c=0|kf[t>>2],d=c+a|0,u=Lf[d>>0]|Lf[d+1>>0]<<8|Lf[d+2>>0]<<16|Lf[d+3>>0]<<24,d=i,kf[d>>2]=s,kf[d+4>>2]=h,h=0|tc(0|a,0|o,8,0),d=qf,(0|r)<(0|d)|(0|r)==(0|d)&n>>>0<h>>>0)return l=0,0|l;if(s=i,kf[s>>2]=h,kf[s+4>>2]=d,!(1&u))return l=0,0|l;if(s=31^(0|sp(0|u)),(s+-1|0)>>>0>28)return l=0,0|l;kf[e+8>>2]=s+1,u=2<<s,kf[e+12>>2]=u+-1,s=u+-2|0,kf[e+16>>2]=s,kf[e+20>>2]=(0|s)/2|0;do if((0|Ff[t+38>>1])<514){if(!((0|r)>(0|d)|(0|r)==(0|d)&n>>>0>h>>>0))return l=0,0|l;if(s=0|If[c+h>>0],u=0|tc(0|a,0|o,9,0),f=i,kf[f>>2]=u,kf[f+4>>2]=qf,(255&s)<2){kf[e+68>>2]=255&s;break}return l=0,0|l}while(0);return l=0|ie(e+88|0,t),0|l}function Ht(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;if(i=Xf,Xf=Xf+16|0,n=i,r=0|sl(64),s=0|sl(12),a=0|kf[(0|kf[e+4>>2])+80>>2],kf[s+4>>2]=0,kf[s>>2]=3416,kf[s+8>>2]=a,kf[n>>2]=s,Do(r,n),s=r,(0|t)>=0){a=e+8|0,o=e+12|0,e=0|kf[o>>2],h=0|kf[a>>2],l=e-h>>2;do if((0|l)<=(0|t)){if(c=t+1|0,d=e,c>>>0>l>>>0){Ut(a,c-l|0);break}if(c>>>0<l>>>0?(u=h+(c<<2)|0,(0|d)!=(0|u)):0){c=d;do d=c+-4|0,kf[o>>2]=d,f=0|kf[d>>2],kf[d>>2]=0,0|f&&xp[127&kf[(0|kf[f>>2])+4>>2]](f),c=0|kf[o>>2];while((0|c)!=(0|u))}}while(0);o=(0|kf[a>>2])+(t<<2)|0,t=0|kf[o>>2],kf[o>>2]=s,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),p=1):p=1}else xp[127&kf[(0|kf[r>>2])+4>>2]](r),p=0;return r=0|kf[n>>2],kf[n>>2]=0,r?(xp[127&kf[(0|kf[r>>2])+4>>2]](r),Xf=i,0|p):(Xf=i,0|p)}function jt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;i=0|kf[t>>2];do if((0|i)!=-1){if(t=0|kf[(0|kf[(0|kf[e+4>>2])+12>>2])+(i<<2)>>2],n=i+1|0,r=0==((n>>>0)%3|0|0)?i+-2|0:n,s=(0|r)==-1?-1:0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|r)/3|0)|0)+(((0|r)%3|0)<<2)>>2],(0|t)!=-1?(r=(0==((t>>>0)%3|0|0)?2:-1)+t|0,(0|r)==-1?(a=0,o=-1,h=t):(a=0,o=0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|r)/3|0)|0)+(((0|r)%3|0)<<2)>>2],h=t)):(a=1,o=-1,h=-1),(0|s)!=(0|o))return l=-1,0|l;if(t=(0==((i>>>0)%3|0|0)?2:-1)+i|0,(0|t)==-1){if(a){c=-1,d=-1,u=h;break}f=-1}else{if(r=0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|t)/3|0)|0)+(((0|t)%3|0)<<2)>>2],a){c=-1,d=r,u=h;break}f=r}r=h+1|0,t=0==((r>>>0)%3|0|0)?h+-2|0:r,(0|t)==-1?(c=-1,d=f,u=h):(c=0|kf[(0|kf[(0|kf[e>>2])+96>>2])+(12*((0|t)/3|0)|0)+(((0|t)%3|0)<<2)>>2],d=f,u=h)}else c=-1,d=-1,u=-1;while(0);return l=(0|d)!=(0|c)?-1:u,0|l}function Yt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,s=0,a=0,o=0;if(n=e+20|0,0|r(n,t))return s=0,0|s;if(e=0|hn(n,t),t=0|kf[i>>2],kf[i>>2]=0,i=0|kf[e>>2],kf[e>>2]=t,!i)return s=1,0|s;if(t=0|kf[i+28>>2],0|t){e=t;do t=e,e=0|kf[e>>2],Nr(t+8|0),mf(t);while(0!=(0|e))}if(e=i+20|0,t=0|kf[e>>2],kf[e>>2]=0,0|t&&mf(t),t=0|kf[i+8>>2],0|t){e=t;do t=e,e=0|kf[e>>2],n=t+8|0,a=0|kf[t+20>>2],0|a&&(o=t+24|0,(0|kf[o>>2])!=(0|a)&&(kf[o>>2]=a),mf(a)),(0|If[n+11>>0])<0&&mf(0|kf[n>>2]),mf(t);while(0!=(0|e))}return e=0|kf[i>>2],kf[i>>2]=0,0|e&&mf(e),mf(i),s=1,0|s}function Xt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;n=Xf,Xf=Xf+16|0,r=n,kf[r>>2]=t,s=e+8|0,((0|kf[e+12>>2])-(0|kf[s>>2])>>2|0)<=(0|t)&&hr(s,t+1|0),a=0|kf[(0|kf[i>>2])+56>>2];do if((0|a)<5){if(o=e+20+(12*a|0)+4|0,h=0|kf[o>>2],(0|h)==(0|kf[e+20+(12*a|0)+8>>2])){us(e+20+(12*a|0)|0,r);break}kf[h>>2]=t,kf[o>>2]=h+4;break}while(0);return t=0|kf[i>>2],a=0|kf[r>>2],kf[t+60>>2]=a,r=(0|kf[s>>2])+(a<<2)|0,kf[i>>2]=0,i=0|kf[r>>2],kf[r>>2]=t,i?(t=i+88|0,r=0|kf[t>>2],kf[t>>2]=0,0|r&&(t=0|kf[r+8>>2],0|t&&(a=r+12|0,(0|kf[a>>2])!=(0|t)&&(kf[a>>2]=t),mf(t)),mf(r)),r=0|kf[i+68>>2],0|r&&(t=i+72|0,a=0|kf[t>>2],(0|a)!=(0|r)&&(kf[t>>2]=a+(~((a+-4-r|0)>>>2)<<2)),mf(r)),r=i+64|0,a=0|kf[r>>2],kf[r>>2]=0,0|a&&(r=0|kf[a>>2],0|r&&(t=a+4|0,(0|kf[t>>2])!=(0|r)&&(kf[t>>2]=r),mf(r)),mf(a)),mf(i),void(Xf=n)):void(Xf=n)}function Zt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(kf[e>>2]=3608,t=0|kf[e+68>>2],0|t&&(i=e+72|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+56>>2],0|t&&(n=e+60|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+44>>2],0|t&&(i=e+48|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+32>>2],0|t&&(n=e+36|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+20>>2],0|t&&(i=e+24|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),Mr(e+8|0),t=e+4|0,e=0|kf[t>>2],kf[t>>2]=0,e){if(t=e+40|0,n=0|kf[t>>2],0|n){if(i=e+44|0,r=0|kf[i>>2],(0|r)==(0|n))s=n;else{a=r;do r=a+-4|0,kf[i>>2]=r,o=0|kf[r>>2],kf[r>>2]=0,0|o&&(vs(o),mf(o)),a=0|kf[i>>2];while((0|a)!=(0|n));s=0|kf[t>>2]}mf(s)}vs(e),mf(e)}}function Kt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(t=e+12|0,i=0|kf[e>>2],n=e+8|0,r=0|kf[n>>2],s=(0|r)==-1,!(0|If[t>>0])){do{if(((s?0:(a=(0==((r>>>0)%3|0|0)?2:-1)+r|0,(0|a)!=-1))?0==(kf[(0|kf[i>>2])+(a>>>5<<2)>>2]&1<<(31&a)|0):0)?(o=0|kf[(0|kf[(0|kf[i+64>>2])+12>>2])+(a<<2)>>2],(0|o)!=-1):0){if((o>>>0)%3|0){h=o+-1|0;break}h=o+2|0;break}h=-1}while(0);return void(kf[n>>2]=h)}if(h=r+1|0,((s?0:(s=0==((h>>>0)%3|0|0)?r+-2|0:h,(0|s)!=-1))?0==(kf[(0|kf[i>>2])+(s>>>5<<2)>>2]&1<<(31&s)|0):0)?(h=0|kf[(0|kf[(0|kf[i+64>>2])+12>>2])+(s<<2)>>2],s=h+1|0,(0|h)!=-1):0){if(r=0==((s>>>0)%3|0|0)?h+-2|0:s,kf[n>>2]=r,(0|r)!=-1){if((0|r)!=(0|kf[e+4>>2]))return;return void(kf[n>>2]=-1)}}else kf[n>>2]=-1;r=0|kf[e+4>>2];do{if((((0|r)!=-1?(e=(0==((r>>>0)%3|0|0)?2:-1)+r|0,(0|e)!=-1):0)?0==(kf[(0|kf[i>>2])+(e>>>5<<2)>>2]&1<<(31&e)|0):0)?(s=0|kf[(0|kf[(0|kf[i+64>>2])+12>>2])+(e<<2)>>2],(0|s)!=-1):0){if((s>>>0)%3|0){l=s+-1|0;break}l=s+2|0;break}l=-1}while(0);kf[n>>2]=l,If[t>>0]=0}function Qt(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;n=Xf,Xf=Xf+48|0,r=n+16|0,s=n,a=n+32|0,o=e+28|0,h=0|kf[o>>2],kf[a>>2]=h,l=e+20|0,c=(0|kf[l>>2])-h|0,kf[a+4>>2]=c,kf[a+8>>2]=t,kf[a+12>>2]=i,t=c+i|0,c=e+60|0,kf[s>>2]=kf[c>>2],kf[s+4>>2]=a,kf[s+8>>2]=2,h=0|gc(0|mp(146,0|s));e:do if((0|t)!=(0|h)){for(s=h,d=a,u=2,f=t;;){if((0|s)<0)break;if(f=f-s|0,p=0|kf[d+4>>2],_=s>>>0>p>>>0,m=_?d+8|0:d,A=(_<<31>>31)+u|0,v=s-(_?p:0)|0,kf[m>>2]=(0|kf[m>>2])+v,p=m+4|0,kf[p>>2]=(0|kf[p>>2])-v,kf[r>>2]=kf[c>>2],kf[r+4>>2]=m,kf[r+8>>2]=A,s=0|gc(0|mp(146,0|r)),(0|f)==(0|s)){y=3;break e}d=m,u=A}kf[e+16>>2]=0,kf[o>>2]=0,kf[l>>2]=0,kf[e>>2]=32|kf[e>>2],g=2==(0|u)?0:i-(0|kf[d+4>>2])|0}else y=3;while(0);return 3==(0|y)&&(y=0|kf[e+44>>2],kf[e+16>>2]=y+(0|kf[e+48>>2]),kf[o>>2]=y,kf[l>>2]=y,g=i),Xf=n,0|g}function Jt(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;i=e+4|0,e=0|kf[i>>2];do if(0|e){n=0|If[t+11>>0],r=n<<24>>24<0,s=r?0|kf[t+4>>2]:255&n,n=r?0|kf[t>>2]:t,r=i,a=e;e:for(;;){for(o=a;;){if(h=o+16|0,l=0|If[h+11>>0],c=l<<24>>24<0,d=c?0|kf[o+20>>2]:255&l,l=s>>>0<d>>>0?s:d,0!=(0|l)?(u=0|fo(c?0|kf[h>>2]:h,n,l),0!=(0|u)):0){if((0|u)>=0)break}else f=6;if(6==(0|f)?(f=0,d>>>0>=s>>>0):0)break;if(d=0|kf[o+4>>2],!d){p=r;break e}o=d}if(a=0|kf[o>>2],!a){p=o;break}r=o}if((0|p)!=(0|i)){if(r=p+16|0,a=0|If[r+11>>0],d=a<<24>>24<0,u=d?0|kf[p+20>>2]:255&a,a=u>>>0<s>>>0?u:s,0|a?(l=0|fo(n,d?0|kf[r>>2]:r,a),0|l):0){if((0|l)<0)break;return _=p,0|_}if(s>>>0>=u>>>0)return _=p,0|_}}while(0);return _=i,0|_}function qt(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(t=0|kf[e+196>>2],0|t&&(i=e+200|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+184|0,n=0|kf[t>>2],0|n){if(i=e+188|0,r=0|kf[i>>2],(0|r)==(0|n))s=n;else{for(a=r;;){if(r=a+-12|0,kf[i>>2]=r,o=0|kf[r>>2],o?(r=a+-8|0,l=0|kf[r>>2],(0|l)!=(0|o)&&(kf[r>>2]=l+(~((l+-4-o|0)>>>2)<<2)),mf(o),h=0|kf[i>>2]):h=r,(0|h)==(0|n))break;a=h}s=0|kf[t>>2]}mf(s)}if(s=0|kf[e+156>>2],0|s&&(t=e+160|0,h=0|kf[t>>2],(0|h)!=(0|s)&&(kf[t>>2]=h+(~((h+-4-s|0)>>>2)<<2)),mf(s)),s=e+136|0,h=0|kf[s>>2],kf[s>>2]=0,!h)return c=e+120|0,bf(c),d=e+80|0,bf(d),u=e+64|0,bf(u),f=e+24|0,void bf(f);if(s=h+-4|0,t=0|kf[s>>2],0|t){a=h+(t<<4)|0;do a=a+-16|0,bf(a);while((0|a)!=(0|h))}pf(s),c=e+120|0,bf(c),d=e+80|0,bf(d),u=e+64|0,bf(u),f=e+24|0,bf(f)}function $t(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+8|0,r=0|kf[n>>2],s=e+4|0,a=0|kf[s>>2],((r-a|0)/12|0)>>>0>=t>>>0){o=a,h=t;do kf[o>>2]=kf[i>>2],kf[o+4>>2]=kf[i+4>>2],kf[o+8>>2]=kf[i+8>>2],o=(0|kf[s>>2])+12|0,kf[s>>2]=o,h=h+-1|0;while(0!=(0|h))}else{h=0|kf[e>>2],o=(a-h|0)/12|0,a=o+t|0,a>>>0>357913941&&Du(e),l=(r-h|0)/12|0,h=l<<1,r=l>>>0<178956970?h>>>0<a>>>0?a:h:357913941;do if(r){if(!(r>>>0>357913941)){c=0|sl(12*r|0);break}h=0|dp(8),cd(h,13392),kf[h>>2]=4748,fp(0|h,1128,101)}else c=0;while(0);h=c+(12*o|0)|0,o=c+(12*r|0)|0,r=h,c=t,t=h;do kf[r>>2]=kf[i>>2],kf[r+4>>2]=kf[i+4>>2],kf[r+8>>2]=kf[i+8>>2],r=t+12|0,t=r,c=c+-1|0;while(0!=(0|c));c=0|kf[e>>2],r=(0|kf[s>>2])-c|0,i=h+(12*((0|r)/-12|0)|0)|0,(0|r)>0&&0|ui(0|i,0|c,0|r),kf[e>>2]=i,kf[s>>2]=t,kf[n>>2]=o,c&&mf(c)}}function ei(e,t){e=0|e,t=0|t;var i=0,n=0,r=0;return i=e+8|0,kf[i>>2]=kf[t>>2],0|St(e+12|0,t+4|0),n=e+44|0,r=t+36|0,kf[n>>2]=kf[r>>2],kf[n+4>>2]=kf[r+4>>2],kf[n+8>>2]=kf[r+8>>2],kf[n+12>>2]=kf[r+12>>2],(0|i)==(0|t)?void(kf[e+96>>2]=kf[t+88>>2]):(Mt(e+60|0,0|kf[t+52>>2],0|kf[t+56>>2]),Mt(e+72|0,0|kf[t+64>>2],0|kf[t+68>>2]),Mt(e+84|0,0|kf[t+76>>2],0|kf[t+80>>2]),kf[e+96>>2]=kf[t+88>>2],void Wt(e+100|0,0|kf[t+92>>2],0|kf[t+96>>2]))}function ti(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;i=e+4|0,n=0|kf[e>>2],r=(0|kf[i>>2])-n>>2,s=r+1|0,s>>>0>1073741823&&Du(e),a=e+8|0,o=(0|kf[a>>2])-n|0,n=o>>1,h=o>>2>>>0<536870911?n>>>0<s>>>0?s:n:1073741823;do if(h){if(!(h>>>0>1073741823)){l=0|sl(h<<2);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else l=0;while(0);if(n=l+(r<<2)|0,r=n,s=l+(h<<2)|0,h=0|kf[t>>2],kf[t>>2]=0,kf[n>>2]=h,h=n+4|0,t=0|kf[e>>2],l=0|kf[i>>2],(0|l)==(0|t))c=r,d=t,u=t;else{o=n,n=l,l=r;do n=n+-4|0,r=0|kf[n>>2],kf[n>>2]=0,kf[o+-4>>2]=r,o=l+-4|0,l=o;while((0|n)!=(0|t));c=l,d=0|kf[e>>2],u=0|kf[i>>2]}if(kf[e>>2]=c,kf[i>>2]=h,kf[a>>2]=s,s=d,(0|u)!=(0|s)){a=u;do a=a+-4|0,u=0|kf[a>>2],kf[a>>2]=0,0|u&&(vs(u),mf(u));while((0|a)!=(0|s))}d&&mf(d)}function ii(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0;return n=Xf,Xf=Xf+80|0,r=n,s=n+64|0,Qo(r),a=0|kf[(0|kf[e+8>>2])+56>>2],o=0|np(0|oh(5),i),ia(r,a,0,255&i,5,0,o,((0|o)<0)<<31>>31,0,0),o=0|sl(96),Lo(o,r),If[o+84>>0]=1,r=0|kf[o+68>>2],i=o+72|0,a=0|kf[i>>2],(0|a)!=(0|r)&&(kf[i>>2]=a+(~((a+-4-r|0)>>>2)<<2)),0|Ys(o,t),kf[s>>2]=o,Ms(e,s),e=0|kf[s>>2],kf[s>>2]=0,e?(s=e+88|0,o=0|kf[s>>2],kf[s>>2]=0,0|o&&(s=0|kf[o+8>>2],0|s&&(t=o+12|0,(0|kf[t>>2])!=(0|s)&&(kf[t>>2]=s),mf(s)),mf(o)),o=0|kf[e+68>>2],0|o&&(s=e+72|0,t=0|kf[s>>2],(0|t)!=(0|o)&&(kf[s>>2]=t+(~((t+-4-o|0)>>>2)<<2)),mf(o)),o=e+64|0,t=0|kf[o>>2],kf[o>>2]=0,0|t&&(o=0|kf[t>>2],0|o&&(s=t+4|0,(0|kf[s>>2])!=(0|o)&&(kf[s>>2]=o),mf(o)),mf(t)),mf(e),void(Xf=n)):void(Xf=n)}function ni(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return i=0|kf[t>>2],t=0|kf[e>>2],n=t+(i>>>5<<2)|0,kf[n>>2]=kf[n>>2]|1<<(31&i),n=0|kf[e+64>>2],r=(0|i)==-1,s=i+1|0,o=(r?0:(a=0==((s>>>0)%3|0|0)?i+-2|0:s,(0|a)!=-1))?0|kf[(0|kf[n>>2])+(a<<2)>>2]:-1,a=e+12|0,s=(0|kf[a>>2])+(o>>>5<<2)|0,kf[s>>2]=kf[s>>2]|1<<(31&o),r?(o=(0|kf[a>>2])+536870908|0,void(kf[o>>2]=kf[o>>2]|-2147483648)):(o=(0==((i>>>0)%3|0|0)?2:-1)+i|0,h=(0|o)==-1?-1:0|kf[(0|kf[n>>2])+(o<<2)>>2],o=(0|kf[a>>2])+(h>>>5<<2)|0,kf[o>>2]=kf[o>>2]|1<<(31&h),void(r||(r=0|kf[(0|kf[n+12>>2])+(i<<2)>>2],(0|r)!=-1&&(If[e+24>>0]=0,e=t+(r>>>5<<2)|0,kf[e>>2]=kf[e>>2]|1<<(31&r),e=r+1|0,t=0==((e>>>0)%3|0|0)?r+-2|0:e,l=(0|t)==-1?-1:0|kf[(0|kf[n>>2])+(t<<2)>>2],t=(0|kf[a>>2])+(l>>>5<<2)|0,kf[t>>2]=kf[t>>2]|1<<(31&l),l=(0==((r>>>0)%3|0|0)?2:-1)+r|0,c=(0|l)==-1?-1:0|kf[(0|kf[n>>2])+(l<<2)>>2],l=(0|kf[a>>2])+(c>>>5<<2)|0,kf[l>>2]=kf[l>>2]|1<<(31&c)))))}function ri(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+8|0,l=s,c=r>>>0>1073741823?-1:r<<2,d=0|ff(c),0|Bs(0|d,0,0|c),c=e+8|0,e=0|kf[d+4>>2],u=0|kf[t>>2],f=0|kf[t+4>>2],kf[o>>2]=kf[d>>2],kf[o+4>>2]=e,kf[l>>2]=u,kf[l+4>>2]=f,h(a,c,o,l),kf[i>>2]=kf[a>>2],kf[i+4>>2]=kf[a+4>>2],(0|r)>=(0|n))return pf(d),Xf=s,1;f=0-r|0,u=o+4|0,e=l+4|0,p=a+4|0,_=r;do m=i+(_<<2)|0,A=m+(f<<2)|0,v=t+(_<<2)|0,y=0|kf[A+4>>2],g=0|kf[v>>2],b=0|kf[v+4>>2],kf[o>>2]=kf[A>>2],kf[u>>2]=y,kf[l>>2]=g,kf[e>>2]=b,h(a,c,o,l),kf[m>>2]=kf[a>>2],kf[m+4>>2]=kf[p>>2],_=_+r|0;while((0|_)<(0|n));return pf(d),Xf=s,1}function si(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0;return n=Xf,Xf=Xf+16|0,r=n,s=0|kf[i>>2],kf[i>>2]=0,kf[r>>2]=s,Xt(e,t,r),s=0|kf[r>>2],kf[r>>2]=0,0|s&&(r=s+88|0,i=0|kf[r>>2],kf[r>>2]=0,0|i&&(r=0|kf[i+8>>2],0|r&&(a=i+12|0,(0|kf[a>>2])!=(0|r)&&(kf[a>>2]=r),mf(r)),mf(i)),i=0|kf[s+68>>2],0|i&&(r=s+72|0,a=0|kf[r>>2],(0|a)!=(0|i)&&(kf[r>>2]=a+(~((a+-4-i|0)>>>2)<<2)),mf(i)),i=s+64|0,a=0|kf[i>>2],kf[i>>2]=0,0|a&&(i=0|kf[a>>2],0|i&&(r=a+4|0,(0|kf[r>>2])!=(0|i)&&(kf[r>>2]=i),mf(i)),mf(a)),mf(s)),s=e+84|0,a=e+88|0,e=0|kf[a>>2],i=0|kf[s>>2],r=e-i>>2,(0|r)>(0|t)?void(Xf=n):(o=t+1|0,t=e,o>>>0>r>>>0?(_r(s,o-r|0),void(Xf=n)):o>>>0>=r>>>0?void(Xf=n):(r=i+(o<<2)|0,(0|t)==(0|r)?void(Xf=n):(kf[a>>2]=t+(~((t+-4-r|0)>>>2)<<2),void(Xf=n))))}function ai(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;t=e+172|0,i=0|kf[t>>2];do{if((0|i)!=-1){if(a=(0|kf[e+196>>2])+(i<<2)|0,r=0|kf[a>>2],o=r+-1|0,kf[a>>2]=o,(0|r)<1)return p=9,0|p;f=0|kf[3328+(kf[(0|kf[(0|kf[e+184>>2])+(12*(0|kf[t>>2])|0)>>2])+(o<<2)>>2]<<2)>>2];break}n=0|kf[e+144>>2],r=0|Cp[127&kf[(0|kf[n>>2])+32>>2]](n),(65535&(Lf[r+36>>0]<<8|Lf[r+37>>0]))<514?0|If[e+76>>0]?(r=e+72|0,n=0|kf[r>>2],s=0|kf[e+64>>2],a=0|kf[e+68>>2],o=s+(n>>>3)|0,(o>>>0<a>>>0?(h=0|Lf[o>>0],o=n+1|0,kf[r>>2]=o,0!=(h&1<<(7&n)|0)):0)?(h=s+(o>>>3)|0,h>>>0<a>>>0?(l=(0|Lf[h>>0])>>>(7&o)&1,h=n+2|0,kf[r>>2]=h,c=h,d=l):(c=o,d=0),o=s+(c>>>3)|0,o>>>0<a>>>0?(a=(0|Lf[o>>0])>>>(7&c),kf[r>>2]=c+1,u=a<<1&2):u=0,f=(u|d)<<1|1):f=0):f=1:f=7}while(0);return kf[e+168>>2]=f,p=f,0|p}function oi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0;do if(t){if((0|Ff[e+38>>1])>=514){if(0|Es(i,e))break;return n=0,0|n}if(r=e+8|0,s=0|kf[r>>2],a=0|kf[r+4>>2],r=e+16|0,o=r,h=0|kf[o>>2],l=0|tc(0|h,0|kf[o+4>>2],8,0),o=qf,(0|a)<(0|o)|(0|a)==(0|o)&s>>>0<l>>>0)return n=0,0|n;l=(0|kf[e>>2])+h|0,h=l,s=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=l+4|0,l=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,h=i,o=h,If[o>>0]=s,If[o+1>>0]=s>>8,If[o+2>>0]=s>>16,If[o+3>>0]=s>>24,s=h+4|0,If[s>>0]=l,If[s+1>>0]=l>>8,If[s+2>>0]=l>>16,If[s+3>>0]=l>>24,l=r,s=0|tc(0|kf[l>>2],0|kf[l+4>>2],8,0),l=r,kf[l>>2]=s,kf[l+4>>2]=qf;break}while(0);return If[e+36>>0]=1,i=e+16|0,t=0|kf[i>>2],l=(0|kf[e>>2])+t|0,s=e+8|0,r=0|nc(0|kf[s>>2],0|kf[s+4>>2],0|t,0|kf[i+4>>2]),kf[e+32>>2]=0,kf[e+24>>2]=l,kf[e+28>>2]=l+r,n=1,0|n}function hi(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0;if(s=Xf,Xf=Xf+32|0,a=s+16|0,o=s+8|0,h=s,l=r>>>0>1073741823?-1:r<<2,c=0|ff(l),0|Bs(0|c,0,0|l),l=e+8|0,e=0|kf[c>>2],d=0|kf[c+4>>2],u=0|kf[t+4>>2],kf[a>>2]=kf[t>>2],kf[a+4>>2]=u,kf[h>>2]=e,kf[h+4>>2]=d,te(o,l,h,a),kf[i>>2]=kf[o>>2],kf[i+4>>2]=kf[o+4>>2],(0|r)>=(0|n))return pf(c),Xf=s,1;d=0-r|0,e=a+4|0,u=h+4|0,f=o+4|0,p=r;do _=i+(p<<2)|0,m=_+(d<<2)|0,A=t+(p<<2)|0,v=0|kf[m>>2],y=0|kf[m+4>>2],m=0|kf[A+4>>2],kf[a>>2]=kf[A>>2],kf[e>>2]=m,kf[h>>2]=v,kf[u>>2]=y,te(o,l,h,a),kf[_>>2]=kf[o>>2],kf[_+4>>2]=kf[f>>2],p=p+r|0;while((0|p)<(0|n));return pf(c),Xf=s,1}function li(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,d=0,u=0;if(n=Xf,Xf=Xf+16|0,r=n+8|0,s=n+4|0,a=n,!i)return o=0,Xf=n,0|o;kf[e>>2]=t,kf[r>>2]=0,0|Qs(r,t);e:do if(0|kf[r>>2]){for(t=0;;){if(0|Qs(s,0|kf[e>>2]),l=0|sl(44),kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,kf[l+12>>2]=0,Gf[l+16>>2]=ap(1),d=l+20|0,kf[d>>2]=0,kf[d+4>>2]=0,kf[d+8>>2]=0,kf[d+12>>2]=0,Gf[l+36>>2]=ap(1),kf[l+40>>2]=kf[s>>2],!(0|c(e,l)))break;if(kf[a>>2]=l,0|Ra(i,a),d=0|kf[a>>2],kf[a>>2]=0,0|d&&(vs(d),mf(d)),t=t+1|0,t>>>0>=(0|kf[r>>2])>>>0){h=8;break e}}vs(l),mf(l),u=0}else h=8;while(0);return 8==(0|h)&&(u=0|c(e,i)),o=u,Xf=n,0|o}function ci(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;switch(i=Xf,Xf=Xf+32|0,n=i+16|0,r=i,t<<24>>24){case 0:t=0|sl(44),s=t,a=s+44|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));return Th(t),kf[t>>2]=3528,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=t,void(Xf=i);case 1:t=0|sl(44),s=t,a=s+44|0;do kf[s>>2]=0,s=s+4|0;while((0|s)<(0|a));return Th(t),kf[t>>2]=3484,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=t,void(Xf=i);default:t=0|sl(32),kf[r>>2]=t,kf[r+8>>2]=-2147483616,kf[r+4>>2]=28,s=t,o=11693,a=s+28|0;do If[s>>0]=0|If[o>>0],s=s+1|0,o=o+1|0;while((0|s)<(0|a));return If[t+28>>0]=0,kf[n>>2]=-1,t=n+4|0,Ds(t,r),kf[e>>2]=kf[n>>2],Ds(e+4|0,t),kf[e+16>>2]=0,(0|If[t+11>>0])<0&&mf(0|kf[t>>2]),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=i)}}function di(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;
do if(0|Ud(e,0|kf[t+8>>2],r))Qh(0,t,i,n);else{if(s=e+8|0,!(0|Ud(e,0|kf[t>>2],r))){a=0|kf[s>>2],Lp[3&kf[(0|kf[a>>2])+24>>2]](a,t,i,n,r);break}if(a=t+32|0,(0|kf[t+16>>2])!=(0|i)?(o=t+20|0,(0|kf[o>>2])!=(0|i)):0){if(kf[a>>2]=n,h=t+44|0,4==(0|kf[h>>2]))break;l=t+52|0,If[l>>0]=0,c=t+53|0,If[c>>0]=0,d=0|kf[s>>2],Np[3&kf[(0|kf[d>>2])+20>>2]](d,t,i,i,1,r),0|If[c>>0]?0|If[l>>0]?p=3:(u=3,f=11):(u=4,f=11),11==(0|f)&&(kf[o>>2]=i,o=t+40|0,kf[o>>2]=(0|kf[o>>2])+1,(1==(0|kf[t+36>>2])?2==(0|kf[t+24>>2]):0)?(If[t+54>>0]=1,p=u):p=u),kf[h>>2]=p;break}1==(0|n)&&(kf[a>>2]=1)}while(0)}function ui(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;if((0|i)>=8192)return 0|gp(0|e,0|t,0|i);if(n=0|e,r=e+i|0,(3&e)==(3&t)){for(;3&e;){if(!i)return 0|n;If[e>>0]=0|If[t>>0],e=e+1|0,t=t+1|0,i=i-1|0}for(s=r&-4|0,i=s-64|0;(0|e)<=(0|i);)kf[e>>2]=kf[t>>2],kf[e+4>>2]=kf[t+4>>2],kf[e+8>>2]=kf[t+8>>2],kf[e+12>>2]=kf[t+12>>2],kf[e+16>>2]=kf[t+16>>2],kf[e+20>>2]=kf[t+20>>2],kf[e+24>>2]=kf[t+24>>2],kf[e+28>>2]=kf[t+28>>2],kf[e+32>>2]=kf[t+32>>2],kf[e+36>>2]=kf[t+36>>2],kf[e+40>>2]=kf[t+40>>2],kf[e+44>>2]=kf[t+44>>2],kf[e+48>>2]=kf[t+48>>2],kf[e+52>>2]=kf[t+52>>2],kf[e+56>>2]=kf[t+56>>2],kf[e+60>>2]=kf[t+60>>2],e=e+64|0,t=t+64|0;for(;(0|e)<(0|s);)kf[e>>2]=kf[t>>2],e=e+4|0,t=t+4|0}else for(s=r-4|0;(0|e)<(0|s);)If[e>>0]=0|If[t>>0],If[e+1>>0]=0|If[t+1>>0],If[e+2>>0]=0|If[t+2>>0],If[e+3>>0]=0|If[t+3>>0],e=e+4|0,t=t+4|0;for(;(0|e)<(0|r);)If[e>>0]=0|If[t>>0],e=e+1|0,t=t+1|0;return 0|n}function fi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(i=0|kf[t+88>>2],!i)return n=0,0|n;if(1!=(0|kf[i>>2]))return n=0,0|n;if(r=i+8|0,i=0|kf[r>>2],kf[e+4>>2]=Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,s=e+8|0,a=t+24|0,t=0|If[a>>0],o=t<<24>>24,h=e+12|0,l=0|kf[h>>2],c=0|kf[s>>2],d=l-c>>2,u=c,c=l,o>>>0<=d>>>0?(o>>>0<d>>>0?(l=u+(o<<2)|0,(0|c)!=(0|l)):0)?(kf[h>>2]=c+(~((c+-4-l|0)>>>2)<<2),f=t,p=i):(f=t,p=i):(Kr(s,o-d|0),f=0|If[a>>0],p=0|kf[r>>2]),r=p+4|0,a=Lf[r>>0]|Lf[r+1>>0]<<8|Lf[r+2>>0]<<16|Lf[r+3>>0]<<24,f<<24>>24>0)for(r=0|kf[s>>2],s=f<<24>>24,f=4,d=0,o=a;;){if(kf[r+(d<<2)>>2]=o,f=f+4|0,d=d+1|0,i=p+f|0,t=Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,(0|d)>=(0|s)){_=t;break}o=t}else _=a;return kf[e+20>>2]=_,n=1,0|n}function pi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;return n=Xf,Xf=Xf+16|0,r=n,s=e+4|0,kf[s>>2]=0,t?(a=e+8|0,o=0|kf[a>>2],h=o<<5,h>>>0<t>>>0?(kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,c=r+8|0,kf[c>>2]=0,(0|t)<0&&Du(e),d=o<<6,o=t+31&-32,Hr(r,h>>>0<1073741823?d>>>0<o>>>0?o:d:2147483647),d=0|kf[e>>2],kf[e>>2]=kf[r>>2],kf[r>>2]=d,r=0|kf[s>>2],kf[s>>2]=t,kf[l>>2]=r,r=0|kf[a>>2],kf[a>>2]=kf[c>>2],kf[c>>2]=r,0|d&&mf(d),u=e):(kf[s>>2]=t,u=e),e=0|kf[u>>2],u=e,s=e,e=t>>>5,d=e<<2,0|If[i>>0]?(0|Bs(0|s,-1,0|d),d=t-(e<<5)|0,t=u+(e<<2)|0,d?(kf[t>>2]=kf[t>>2]|-1>>>(32-d|0),void(Xf=n)):void(Xf=n)):(0|Bs(0|s,0,0|d),i=t-(e<<5)|0,r=u+(e<<2)|0,i?(kf[r>>2]=kf[r>>2]&~(-1>>>(32-i|0)),void(Xf=n)):void(Xf=n))):void(Xf=n)}function _i(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,a=0,o=0,h=0,l=0,c=0;return r=Xf,Xf=Xf+16|0,a=r+12|0,o=r+8|0,h=r,kf[h>>2]=kf[t>>2],kf[a>>2]=kf[h>>2],h=0|s(e,a,o,r+4|0,i),i=0|kf[h>>2],0|i?(l=i,Xf=r,0|l):(i=0|sl(40),Ds(i+16|0,n),Ds(i+28|0,n+12|0),n=0|kf[o>>2],kf[i>>2]=0,kf[i+4>>2]=0,kf[i+8>>2]=n,kf[h>>2]=i,n=0|kf[kf[e>>2]>>2],n?(kf[e>>2]=n,c=0|kf[h>>2]):c=i,re(0|kf[e+4>>2],c),c=e+8|0,kf[c>>2]=(0|kf[c>>2])+1,l=i,Xf=r,0|l)}function mi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0?(l=0,0|l):(c=0|kf[t>>2],t=c+a|0,d=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,t=i,kf[t>>2]=s,kf[t+4>>2]=h,h=0|tc(0|a,0|o,8,0),o=qf,(0|r)<(0|o)|(0|r)==(0|o)&n>>>0<h>>>0?(l=0,0|l):(n=c+s|0,s=Lf[n>>0]|Lf[n+1>>0]<<8|Lf[n+2>>0]<<16|Lf[n+3>>0]<<24,n=i,kf[n>>2]=h,kf[n+4>>2]=o,(0|d)>(0|s)?(l=0,0|l):(kf[e+12>>2]=d,kf[e+16>>2]=s,o=0|nc(0|s,((0|s)<0)<<31>>31|0,0|d,((0|d)<0)<<31>>31|0),d=qf,d>>>0<0|0==(0|d)&o>>>0<2147483647?(d=o+1|0,kf[e+20>>2]=d,o=(0|d)/2|0,s=e+24|0,kf[s>>2]=o,kf[e+28>>2]=0-o,1&d|0?(l=1,0|l):(kf[s>>2]=o+-1,l=1,0|l)):(l=0,0|l))))}function Ai(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;i=e+4|0,n=0|kf[i>>2],r=0|kf[e>>2],s=(n-r|0)/12|0,a=s+1|0,o=r,h=n,a>>>0>357913941&&Du(e),n=e+8|0,l=((0|kf[n>>2])-r|0)/12|0,c=l<<1,d=l>>>0<178956970?c>>>0<a>>>0?a:c:357913941;do if(d){if(!(d>>>0>357913941)){u=0|sl(12*d|0);break}c=0|dp(8),cd(c,13392),kf[c>>2]=4748,fp(0|c,1128,101)}else u=0;while(0);if(c=u+(12*s|0)|0,a=u+(12*d|0)|0,kf[c>>2]=kf[t>>2],kf[u+(12*s|0)+4>>2]=kf[t+4>>2],kf[u+(12*s|0)+8>>2]=kf[t+8>>2],t=c+12|0,(0|h)==(0|o))f=c;else for(s=c,c=h;;){if(h=c,c=c+-12|0,kf[s+-12>>2]=kf[c>>2],kf[s+-8>>2]=kf[h+-8>>2],kf[s+-4>>2]=kf[h+-4>>2],h=s+-12|0,(0|c)==(0|o)){f=h;break}s=h}kf[e>>2]=f,kf[i>>2]=t,kf[n>>2]=a,r&&mf(r)}function vi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;return r=0|sl(32),kf[e>>2]=r,kf[e+4>>2]=t+8,t=e+8|0,If[t>>0]=0,s=r+8|0,kf[s>>2]=kf[n>>2],kf[s+4>>2]=kf[n+4>>2],kf[s+8>>2]=kf[n+8>>2],kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,s=r+20|0,a=n+12|0,kf[s>>2]=0,kf[r+24>>2]=0,kf[r+28>>2]=0,r=n+16|0,n=0|kf[r>>2],o=0|kf[a>>2],(h=n-o|0)?(qr(s,h),l=0|kf[a>>2],c=0|kf[r>>2],d=0|kf[s>>2],u=l,f=c-u|0,0|ui(0|d,0|l,0|f),If[t>>0]=1,p=0|kf[e>>2],_=p+4|0,kf[_>>2]=i,void(kf[p>>2]=0)):(l=o,c=n,d=0,u=l,f=c-u|0,0|ui(0|d,0|l,0|f),If[t>>0]=1,p=0|kf[e>>2],_=p+4|0,kf[_>>2]=i,void(kf[p>>2]=0))}function yi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;t>>>0>4294967279&&Du(e),i=e+11|0,n=0|If[i>>0],r=n<<24>>24<0,r?(s=0|kf[e+4>>2],a=(2147483647&kf[e+8>>2])+-1|0):(s=255&n,a=10),o=s>>>0>t>>>0?s:t,t=o>>>0<11,h=t?10:(o+16&-16)+-1|0;do if((0|h)!=(0|a)){do{if(!t){if(o=0|sl(h+1|0),r){l=o,c=1,d=0|kf[e>>2],u=13;break}0|ed(o,e,(255&n)+1|0),f=o,u=14;break}o=0|kf[e>>2],r?(l=e,c=0,d=o,u=13):(0|ed(e,o,(255&n)+1|0),mf(o),u=15)}while(0);if(13==(0|u)&&(0|ed(l,d,(0|kf[e+4>>2])+1|0),mf(d),c?(f=l,u=14):u=15),14==(0|u)){kf[e+8>>2]=h+1|-2147483648,kf[e+4>>2]=s,kf[e>>2]=f;break}if(15==(0|u)){If[i>>0]=s;break}}while(0)}function gi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;n=e+12|0;e:do if((0|kf[n>>2])!=(0|t)){if(r=0|kf[e>>2],s=e+4|0,a=0|kf[s>>2],(0|a)!=(0|r))for(o=a;;){if(a=o+-12|0,kf[s>>2]=a,(0|If[a+11>>0])<0?(mf(0|kf[a>>2]),h=0|kf[s>>2]):h=a,(0|h)==(0|r))break;o=h}if(kf[n>>2]=t,o=0|kf[t+8>>2],0|o)for(a=e+8|0,l=r,c=o;;){if(o=c+8|0,(0|l)==(0|kf[a>>2])?Gt(e,o):(Ds(l,o),kf[s>>2]=(0|kf[s>>2])+12),o=0|kf[c>>2],!o)break e;l=0|kf[s>>2],c=o}}while(0);return(0|i)<0?(d=0,0|d):(t=0|kf[e>>2],(((0|kf[e+4>>2])-t|0)/12|0)>>>0<=i>>>0?(d=0,0|d):(e=t+(12*i|0)|0,(0|If[e+11>>0])<0?(d=0|kf[e>>2],0|d):(d=e,0|d)))}function bi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;return i=Xf,Xf=Xf+16|0,n=i,r=0|kf[(0|kf[e>>2])+8>>2],s=e+8|0,a=e+12|0,o=(0|kf[a>>2])-(0|kf[s>>2])>>2,h=0|kf[t>>2],kf[t>>2]=0,kf[n>>2]=h,kp[15&r](e,o,n),o=0|kf[n>>2],kf[n>>2]=0,o?(n=o+88|0,e=0|kf[n>>2],kf[n>>2]=0,0|e&&(n=0|kf[e+8>>2],0|n&&(r=e+12|0,(0|kf[r>>2])!=(0|n)&&(kf[r>>2]=n),mf(n)),mf(e)),e=0|kf[o+68>>2],0|e&&(n=o+72|0,r=0|kf[n>>2],(0|r)!=(0|e)&&(kf[n>>2]=r+(~((r+-4-e|0)>>>2)<<2)),mf(e)),e=o+64|0,r=0|kf[e>>2],kf[e>>2]=0,0|r&&(e=0|kf[r>>2],0|e&&(n=r+4|0,(0|kf[n>>2])!=(0|e)&&(kf[n>>2]=e),mf(e)),mf(r)),mf(o),l=0|kf[a>>2],c=0|kf[s>>2],d=l-c|0,u=d>>2,f=u+-1|0,Xf=i,0|f):(l=0|kf[a>>2],c=0|kf[s>>2],d=l-c|0,u=d>>2,f=u+-1|0,Xf=i,0|f)}function Ei(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],n-s>>3>>>0>=t>>>0){a=s,o=t;do h=a,kf[h>>2]=0,kf[h+4>>2]=0,a=(0|kf[r>>2])+8|0,kf[r>>2]=a,o=o+-1|0;while(0!=(0|o))}else{o=0|kf[e>>2],a=s-o>>3,s=a+t|0,s>>>0>536870911&&Du(e),h=n-o|0,o=h>>2,n=h>>3>>>0<268435455?o>>>0<s>>>0?s:o:536870911;do if(n){if(!(n>>>0>536870911)){l=0|sl(n<<3);break}o=0|dp(8),cd(o,13392),kf[o>>2]=4748,fp(0|o,1128,101)}else l=0;while(0);o=l+(a<<3)|0,a=l+(n<<3)|0,n=o,l=t,t=o;do s=n,kf[s>>2]=0,kf[s+4>>2]=0,n=t+8|0,t=n,l=l+-1|0;while(0!=(0|l));l=0|kf[e>>2],n=(0|kf[r>>2])-l|0,s=o+(0-(n>>3)<<3)|0,(0|n)>0&&0|ui(0|s,0|l,0|n),kf[e>>2]=s,kf[r>>2]=t,kf[i>>2]=a,l&&mf(l)}}function Ti(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=1048576?(1048576!=(0|a)?(r=o+4194304|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,1048576-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>1048576){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=1048576==(0|a),0|l)}function Si(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return i=Xf,Xf=Xf+16|0,n=i,0|ve(e,t)?(s=t+8|0,a=0|kf[s>>2],o=0|kf[s+4>>2],s=t+16|0,h=s,l=0|kf[h>>2],c=0|tc(0|l,0|kf[h+4>>2],4,0),h=qf,(0|o)<(0|h)|(0|o)==(0|h)&a>>>0<c>>>0?(r=0,Xf=i,0|r):(a=(0|kf[t>>2])+l|0,l=Lf[a>>0]|Lf[a+1>>0]<<8|Lf[a+2>>0]<<16|Lf[a+3>>0]<<24,a=s,kf[a>>2]=c,kf[a+4>>2]=h,(0|l)<0?(r=0,Xf=i,0|r):(h=0|kf[e+152>>2],(0|l)>=(0|h)?(r=0,Xf=i,0|r):(l=e+156|0,kf[n>>2]=0,a=e+160|0,c=0|kf[a>>2],s=0|kf[l>>2],o=c-s>>2,d=s,s=c,h>>>0<=o>>>0?(h>>>0<o>>>0?(c=d+(h<<2)|0,(0|s)!=(0|c)):0)&&(kf[a>>2]=s+(~((s+-4-c|0)>>>2)<<2)):lr(l,h-o|0,n),r=0|ie(e+168|0,t),Xf=i,0|r)))):(r=0,Xf=i,0|r)}function wi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=524288?(524288!=(0|a)?(r=o+2097152|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,524288-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>524288){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=524288==(0|a),0|l)}function Ci(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=262144?(262144!=(0|a)?(r=o+1048576|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,262144-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>262144){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=262144==(0|a),0|l)}function Mi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;return i=Xf,Xf=Xf+16|0,n=i,t?(s=e+84|0,a=0|kf[s>>2],o=e+88|0,h=0|kf[o>>2],(0|h)!=(0|a)&&(kf[o>>2]=h+(~((h+-4-a|0)>>>2)<<2)),kf[s>>2]=0,kf[o>>2]=0,kf[e+92>>2]=0,0|a&&mf(a),a=e+72|0,o=0|kf[a>>2],s=e+76|0,(0|kf[s>>2])!=(0|o)&&(kf[s>>2]=o),kf[a>>2]=0,kf[s>>2]=0,kf[e+80>>2]=0,0|o&&mf(o),o=t+4|0,s=(0|kf[o>>2])-(0|kf[t>>2])>>2,If[n>>0]=0,pi(e,s,n),s=t+24|0,a=t+28|0,h=(0|kf[a>>2])-(0|kf[s>>2])>>2,If[n>>0]=0,pi(e+12|0,h,n),yt(e+28|0,(0|kf[o>>2])-(0|kf[t>>2])>>2,3596),pa(e+52|0,(0|kf[a>>2])-(0|kf[s>>2])>>2),pa(e+40|0,(0|kf[a>>2])-(0|kf[s>>2])>>2),kf[e+64>>2]=t,If[e+24>>0]=1,r=1,Xf=i,0|r):(r=0,Xf=i,0|r)}function Pi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=65536?(65536!=(0|a)?(r=o+262144|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,65536-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>65536){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=65536==(0|a),0|l)}function Ii(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=32768?(32768!=(0|a)?(r=o+131072|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,32768-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>32768){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=32768==(0|a),0|l)}function Ri(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0;s=Xf,Xf=Xf+64|0,n=s+16|0,a=s,o=e+8|0,kf[o>>2]=r,h=e+32|0,l=e+36|0,c=0|kf[l>>2],d=0|kf[h>>2],u=c-d>>2,f=d,d=c,u>>>0>=r>>>0?(u>>>0>r>>>0?(c=f+(r<<2)|0,(0|d)!=(0|c)):0)&&(kf[l>>2]=d+(~((d+-4-c|0)>>>2)<<2)):Kr(h,r-u|0),u=n,h=u+48|0;do kf[u>>2]=0,u=u+4|0;while((0|u)<(0|h));if(kf[a>>2]=0,r?(lr(n,r,a),p=0|kf[n+12>>2],_=0|kf[n+16>>2]):(p=0,_=0),kf[a>>2]=0,u=n+16|0,h=_-p>>2,c=p,p=_,h>>>0>=r>>>0?(h>>>0>r>>>0?(_=c+(r<<2)|0,(0|p)!=(0|_)):0)&&(kf[u>>2]=p+(~((p+-4-_|0)>>>2)<<2)):lr(n+12|0,r-h|0,a),h=n+24|0,kf[a>>2]=0,_=n+28|0,p=0|kf[_>>2],u=0|kf[h>>2],c=p-u>>2,d=u,u=p,c>>>0>=r>>>0?(c>>>0>r>>>0?(p=d+(r<<2)|0,(0|u)!=(0|p)):0)&&(kf[_>>2]=u+(~((u+-4-p|0)>>>2)<<2)):lr(h,r-c|0,a),c=n+36|0,kf[a>>2]=0,h=n+40|0,p=0|kf[h>>2],u=0|kf[c>>2],_=p-u>>2,d=u,u=p,_>>>0>=r>>>0?(_>>>0>r>>>0?(p=d+(r<<2)|0,(0|u)!=(0|p)):0)&&(kf[h>>2]=u+(~((u+-4-p|0)>>>2)<<2)):lr(c,r-_|0,a),_=0|kf[n>>2],(0|kf[o>>2])>0){c=e+16|0,p=e+32|0,u=e+12|0,h=0;do d=0|kf[_+(h<<2)>>2],l=0|kf[c>>2],(0|d)>(0|l)?(f=0|kf[p>>2],kf[f+(h<<2)>>2]=l,m=f):(f=0|kf[u>>2],l=0|kf[p>>2],kf[l+(h<<2)>>2]=(0|d)<(0|f)?f:d,m=l),h=h+1|0,A=0|kf[o>>2];while((0|h)<(0|A));if((0|A)>0){A=e+20|0,h=0;do p=(0|kf[t+(h<<2)>>2])+(0|kf[m+(h<<2)>>2])|0,_=i+(h<<2)|0,kf[_>>2]=p,(0|p)<=(0|kf[c>>2])?(0|p)<(0|kf[u>>2])&&(v=(0|kf[A>>2])+p|0,y=18):(v=p-(0|kf[A>>2])|0,y=18),18==(0|y)&&(y=0,kf[_>>2]=v),h=h+1|0;while((0|h)<(0|kf[o>>2]))}}h=0|kf[e+48>>2],v=0|kf[e+52>>2],A=0|sl(16),kf[A>>2]=0,kf[A+4>>2]=0,kf[A+8>>2]=0,kf[A+12>>2]=0,kf[a>>2]=0,u=a+4|0,kf[u>>2]=0,kf[a+8>>2]=0;do if(r){if(!(r>>>0>1073741823)){c=r<<2,m=0|sl(c),kf[a>>2]=m,_=m+(r<<2)|0,kf[a+8>>2]=_,0|Bs(0|m,0,0|c),kf[u>>2]=_,g=m;break}Du(a)}else g=0;while(0);m=e+56|0,_=0|kf[m>>2],c=0|kf[_+4>>2],p=0|kf[_>>2],l=c-p|0,d=l>>2;e:do if((0|l)>4){for(f=h+64|0,b=h+28|0,E=(0|r)>0,T=e+16|0,S=e+32|0,w=e+12|0,C=e+20|0,M=r<<2,c-p>>2>>>0>1?(P=p,I=1):(R=_,Du(R));;){x=0|kf[P+(I<<2)>>2],O=(0==((x>>>0)%3|0|0)?2:-1)+x|0,k=O>>>5,D=1<<(31&O),L=(0|x)==-1|(0|O)==-1,N=x,F=1,B=0;t:for(;;){for(V=1^F,U=N,G=B;;){if((0|U)==-1){W=G,y=58;break t}if(z=0|kf[n+(12*G|0)>>2],(0==(kf[(0|kf[h>>2])+(U>>>5<<2)>>2]&1<<(31&U)|0)?(H=0|kf[(0|kf[(0|kf[f>>2])+12>>2])+(U<<2)>>2],(0|H)!=-1):0)?(j=0|kf[b>>2],Y=0|kf[v>>2],X=0|kf[Y+(kf[j+(H<<2)>>2]<<2)>>2],Z=H+1|0,K=0|kf[Y+(kf[j+((0==((Z>>>0)%3|0|0)?H+-2|0:Z)<<2)>>2]<<2)>>2],Z=0|kf[Y+(kf[j+((0==((H>>>0)%3|0|0)?2:-1)+H<<2)>>2]<<2)>>2],(0|X)<(0|I)&(0|K)<(0|I)&(0|Z)<(0|I)):0){if(H=0|np(X,r),X=0|np(K,r),K=0|np(Z,r),E){Z=0;do kf[z+(Z<<2)>>2]=(0|kf[i+(Z+K<<2)>>2])+(0|kf[i+(Z+X<<2)>>2])-(0|kf[i+(Z+H<<2)>>2]),Z=Z+1|0;while((0|Z)!=(0|r))}if(Z=G+1|0,4==(0|Z)){Q=4,y=38;break t}J=Z}else J=G;do if(F)Z=U+1|0,H=0==((Z>>>0)%3|0|0)?U+-2|0:Z,q=(((0|H)!=-1?0==(kf[(0|kf[h>>2])+(H>>>5<<2)>>2]&1<<(31&H)|0):0)?(Z=0|kf[(0|kf[(0|kf[f>>2])+12>>2])+(H<<2)>>2],H=Z+1|0,(0|Z)!=-1):0)?0==((H>>>0)%3|0|0)?Z+-2|0:H:-1;else{if(H=(0==((U>>>0)%3|0|0)?2:-1)+U|0,((0|H)!=-1?0==(kf[(0|kf[h>>2])+(H>>>5<<2)>>2]&1<<(31&H)|0):0)?(Z=0|kf[(0|kf[(0|kf[f>>2])+12>>2])+(H<<2)>>2],(0|Z)!=-1):0){if((Z>>>0)%3|0){q=Z+-1|0;break}q=Z+2|0;break}q=-1}while(0);if((0|q)==(0|x)){W=J,y=58;break t}if(!((0|q)!=-1|V))break;U=q,G=J}L?(N=-1,F=0,B=J):kf[(0|kf[h>>2])+(k<<2)>>2]&D|0?(N=-1,F=0,B=J):(G=0|kf[(0|kf[(0|kf[f>>2])+12>>2])+(O<<2)>>2],(0|G)!=-1?(G>>>0)%3|0?(N=G+-1|0,F=0,B=J):(N=G+2|0,F=0,B=J):(N=-1,F=0,B=J))}if(58==(0|y)&&(y=0,(0|W)>0?(Q=W,y=38):($=0|np(I,r),y=72)),38==(0|y)){if(y=0,E)for(0|Bs(0|kf[a>>2],0,0|M),B=Q+-1|0,F=A+(B<<2)|0,N=e+60+(12*B|0)+4|0,O=e+60+(12*B|0)|0,B=0|kf[a>>2],D=0,k=0;;){if(L=0|kf[F>>2],kf[F>>2]=L+1,(0|kf[N>>2])>>>0<=L>>>0){ee=B,te=0;break e}if(kf[(0|kf[O>>2])+(L>>>5<<2)>>2]&1<<(31&L))ie=k;else{L=0|kf[n+(12*D|0)>>2],x=0;do G=B+(x<<2)|0,kf[G>>2]=(0|kf[G>>2])+(0|kf[L+(x<<2)>>2]),x=x+1|0;while((0|x)!=(0|r));ie=k+1|0}if(D=D+1|0,(0|D)>=(0|Q)){ne=ie;break}k=ie}else for(k=Q+-1|0,D=A+(k<<2)|0,B=e+60+(12*k|0)|0,O=0|kf[a>>2],N=0|kf[e+60+(12*k|0)+4>>2],k=0|kf[D>>2],F=0,x=0;;){if(L=k,k=k+1|0,kf[D>>2]=k,N>>>0<=L>>>0){ee=O,te=0;break e}if(G=x+(0==(kf[(0|kf[B>>2])+(L>>>5<<2)>>2]&1<<(31&L)|0)&1)|0,F=F+1|0,(0|F)>=(0|Q)){ne=G;break}x=G}if(x=0|np(I,r),ne){if(F=0|kf[a>>2],E){B=0;do O=F+(B<<2)|0,kf[O>>2]=(0|kf[O>>2])/(0|ne)|0,B=B+1|0;while((0|B)!=(0|r))}if(B=t+(x<<2)|0,O=i+(x<<2)|0,(0|kf[o>>2])>0){N=0;do k=0|kf[F+(N<<2)>>2],D=0|kf[T>>2],(0|k)>(0|D)?(G=0|kf[S>>2],kf[G+(N<<2)>>2]=D,re=G):(G=0|kf[w>>2],D=0|kf[S>>2],kf[D+(N<<2)>>2]=(0|k)<(0|G)?G:k,re=D),N=N+1|0,se=0|kf[o>>2];while((0|N)<(0|se));if((0|se)>0){N=0;do{F=(0|kf[B+(N<<2)>>2])+(0|kf[re+(N<<2)>>2])|0,D=O+(N<<2)|0,kf[D>>2]=F;do if((0|F)>(0|kf[T>>2]))ae=F-(0|kf[C>>2])|0,y=94;else{if((0|F)>=(0|kf[w>>2]))break;ae=(0|kf[C>>2])+F|0,y=94}while(0);94==(0|y)&&(y=0,kf[D>>2]=ae),N=N+1|0}while((0|N)<(0|kf[o>>2]))}}}else $=x,y=72}if(72==(0|y)?(y=0,N=i+((0|np(I+-1|0,r))<<2)|0,O=t+($<<2)|0,B=i+($<<2)|0,(0|kf[o>>2])>0):0){F=0;do k=0|kf[N+(F<<2)>>2],G=0|kf[T>>2],(0|k)>(0|G)?(L=0|kf[S>>2],kf[L+(F<<2)>>2]=G,oe=L):(L=0|kf[w>>2],G=0|kf[S>>2],kf[G+(F<<2)>>2]=(0|k)<(0|L)?L:k,oe=G),F=F+1|0,he=0|kf[o>>2];while((0|F)<(0|he));if((0|he)>0){F=0;do N=(0|kf[O+(F<<2)>>2])+(0|kf[oe+(F<<2)>>2])|0,x=B+(F<<2)|0,kf[x>>2]=N,(0|N)<=(0|kf[T>>2])?(0|N)<(0|kf[w>>2])&&(le=(0|kf[C>>2])+N|0,y=82):(le=N-(0|kf[C>>2])|0,y=82),82==(0|y)&&(y=0,kf[x>>2]=le),F=F+1|0;while((0|F)<(0|kf[o>>2]))}}if(I=I+1|0,(0|I)>=(0|d)){y=99;break}if(F=0|kf[m>>2],P=0|kf[F>>2],(0|kf[F+4>>2])-P>>2>>>0<=I>>>0){R=F,y=28;break}}if(28==(0|y))Du(R);else if(99==(0|y)){ee=0|kf[a>>2],te=1;break}}else ee=g,te=1;while(0);return 0|ee&&(g=0|kf[u>>2],(0|g)!=(0|ee)&&(kf[u>>2]=g+(~((g+-4-ee|0)>>>2)<<2)),mf(ee)),mf(A),A=0|kf[n+36>>2],0|A&&(ee=n+40|0,g=0|kf[ee>>2],(0|g)!=(0|A)&&(kf[ee>>2]=g+(~((g+-4-A|0)>>>2)<<2)),mf(A)),A=0|kf[n+24>>2],0|A&&(g=n+28|0,ee=0|kf[g>>2],(0|ee)!=(0|A)&&(kf[g>>2]=ee+(~((ee+-4-A|0)>>>2)<<2)),mf(A)),A=0|kf[n+12>>2],0|A&&(ee=n+16|0,g=0|kf[ee>>2],(0|g)!=(0|A)&&(kf[ee>>2]=g+(~((g+-4-A|0)>>>2)<<2)),mf(A)),(A=0|kf[n>>2])?(g=n+4|0,n=0|kf[g>>2],(0|n)!=(0|A)&&(kf[g>>2]=n+(~((n+-4-A|0)>>>2)<<2)),mf(A),Xf=s,0|te):(Xf=s,0|te)}function xi(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0;s=Xf,Xf=Xf+64|0,n=s+16|0,a=s,o=e+8|0,kf[o>>2]=r,h=e+32|0,l=e+36|0,c=0|kf[l>>2],d=0|kf[h>>2],u=c-d>>2,f=d,d=c,u>>>0>=r>>>0?(u>>>0>r>>>0?(c=f+(r<<2)|0,(0|d)!=(0|c)):0)&&(kf[l>>2]=d+(~((d+-4-c|0)>>>2)<<2)):Kr(h,r-u|0),u=n,h=u+48|0;do kf[u>>2]=0,u=u+4|0;while((0|u)<(0|h));if(kf[a>>2]=0,r?(lr(n,r,a),p=0|kf[n+12>>2],_=0|kf[n+16>>2]):(p=0,_=0),kf[a>>2]=0,u=n+16|0,h=_-p>>2,c=p,p=_,h>>>0>=r>>>0?(h>>>0>r>>>0?(_=c+(r<<2)|0,(0|p)!=(0|_)):0)&&(kf[u>>2]=p+(~((p+-4-_|0)>>>2)<<2)):lr(n+12|0,r-h|0,a),h=n+24|0,kf[a>>2]=0,_=n+28|0,p=0|kf[_>>2],u=0|kf[h>>2],c=p-u>>2,d=u,u=p,c>>>0>=r>>>0?(c>>>0>r>>>0?(p=d+(r<<2)|0,(0|u)!=(0|p)):0)&&(kf[_>>2]=u+(~((u+-4-p|0)>>>2)<<2)):lr(h,r-c|0,a),c=n+36|0,kf[a>>2]=0,h=n+40|0,p=0|kf[h>>2],u=0|kf[c>>2],_=p-u>>2,d=u,u=p,_>>>0>=r>>>0?(_>>>0>r>>>0?(p=d+(r<<2)|0,(0|u)!=(0|p)):0)&&(kf[h>>2]=u+(~((u+-4-p|0)>>>2)<<2)):lr(c,r-_|0,a),_=0|kf[n>>2],(0|kf[o>>2])>0){c=e+16|0,p=e+32|0,u=e+12|0,h=0;do d=0|kf[_+(h<<2)>>2],l=0|kf[c>>2],(0|d)>(0|l)?(f=0|kf[p>>2],kf[f+(h<<2)>>2]=l,m=f):(f=0|kf[u>>2],l=0|kf[p>>2],kf[l+(h<<2)>>2]=(0|d)<(0|f)?f:d,m=l),h=h+1|0,A=0|kf[o>>2];while((0|h)<(0|A));if((0|A)>0){A=e+20|0,h=0;do p=(0|kf[t+(h<<2)>>2])+(0|kf[m+(h<<2)>>2])|0,_=i+(h<<2)|0,kf[_>>2]=p,(0|p)<=(0|kf[c>>2])?(0|p)<(0|kf[u>>2])&&(v=(0|kf[A>>2])+p|0,y=18):(v=p-(0|kf[A>>2])|0,y=18),18==(0|y)&&(y=0,kf[_>>2]=v),h=h+1|0;while((0|h)<(0|kf[o>>2]))}}h=0|kf[e+48>>2],v=0|kf[e+52>>2],A=0|sl(16),kf[A>>2]=0,kf[A+4>>2]=0,kf[A+8>>2]=0,kf[A+12>>2]=0,kf[a>>2]=0,u=a+4|0,kf[u>>2]=0,kf[a+8>>2]=0;do if(r){if(!(r>>>0>1073741823)){c=r<<2,m=0|sl(c),kf[a>>2]=m,_=m+(r<<2)|0,kf[a+8>>2]=_,0|Bs(0|m,0,0|c),kf[u>>2]=_,g=m;break}Du(a)}else g=0;while(0);m=e+56|0,_=0|kf[m>>2],c=0|kf[_+4>>2],p=0|kf[_>>2],l=c-p|0,d=l>>2;e:do if((0|l)>4){for(f=h+12|0,b=(0|r)>0,E=e+16|0,T=e+32|0,S=e+12|0,w=e+20|0,C=r<<2,c-p>>2>>>0>1?(M=p,P=1):(I=_,Du(I));;){R=0|kf[M+(P<<2)>>2],x=(0==((R>>>0)%3|0|0)?2:-1)+R|0,O=(0|R)==-1|(0|x)==-1,k=R,D=1,L=0;t:for(;;){for(N=1^D,F=k,B=L;;){if((0|F)==-1){V=B,y=58;break t}if(U=0|kf[n+(12*B|0)>>2],G=0|kf[f>>2],W=0|kf[G+(F<<2)>>2],(0|W)!=-1)if(z=0|kf[h>>2],H=0|kf[v>>2],j=0|kf[H+(kf[z+(W<<2)>>2]<<2)>>2],Y=W+1|0,X=0==((Y>>>0)%3|0|0)?W+-2|0:Y,Z=(0|X)==-1?-1:0|kf[z+(X<<2)>>2],X=0|kf[H+(Z<<2)>>2],Y=(0==((W>>>0)%3|0|0)?2:-1)+W|0,K=(0|Y)==-1?-1:0|kf[z+(Y<<2)>>2],Y=0|kf[H+(K<<2)>>2],(0|j)<(0|P)&(0|X)<(0|P)&(0|Y)<(0|P)){if(H=0|np(j,r),j=0|np(X,r),X=0|np(Y,r),b){Y=0;do kf[U+(Y<<2)>>2]=(0|kf[i+(Y+X<<2)>>2])+(0|kf[i+(Y+j<<2)>>2])-(0|kf[i+(Y+H<<2)>>2]),Y=Y+1|0;while((0|Y)!=(0|r))}if(Y=B+1|0,4==(0|Y)){Q=4,y=41;break t}J=Y}else J=B;else J=B;do if(D)Y=F+1|0,H=0==((Y>>>0)%3|0|0)?F+-2|0:Y,q=((0|H)!=-1?(Y=0|kf[G+(H<<2)>>2],H=Y+1|0,(0|Y)!=-1):0)?0==((H>>>0)%3|0|0)?Y+-2|0:H:-1;else{if(H=(0==((F>>>0)%3|0|0)?2:-1)+F|0,(0|H)!=-1?(Y=0|kf[G+(H<<2)>>2],(0|Y)!=-1):0){if((Y>>>0)%3|0){q=Y+-1|0;break}q=Y+2|0;break}q=-1}while(0);if((0|q)==(0|R)){V=J,y=58;break t}if(!((0|q)!=-1|N))break;F=q,B=J}O?(k=-1,D=0,L=J):(B=0|kf[G+(x<<2)>>2],(0|B)!=-1?(B>>>0)%3|0?(k=B+-1|0,D=0,L=J):(k=B+2|0,D=0,L=J):(k=-1,D=0,L=J))}if(58==(0|y)&&(y=0,(0|V)>0?(Q=V,y=41):($=0|np(P,r),y=72)),41==(0|y)){if(y=0,b)for(0|Bs(0|kf[a>>2],0,0|C),L=Q+-1|0,D=A+(L<<2)|0,k=e+60+(12*L|0)+4|0,x=e+60+(12*L|0)|0,L=0|kf[a>>2],O=0,R=0;;){if(B=0|kf[D>>2],kf[D>>2]=B+1,(0|kf[k>>2])>>>0<=B>>>0){ee=L,te=0;break e}if(kf[(0|kf[x>>2])+(B>>>5<<2)>>2]&1<<(31&B))ie=R;else{B=0|kf[n+(12*O|0)>>2],F=0;do N=L+(F<<2)|0,kf[N>>2]=(0|kf[N>>2])+(0|kf[B+(F<<2)>>2]),F=F+1|0;while((0|F)!=(0|r));ie=R+1|0}if(O=O+1|0,(0|O)>=(0|Q)){ne=ie;break}R=ie}else for(R=Q+-1|0,O=A+(R<<2)|0,L=e+60+(12*R|0)|0,x=0|kf[a>>2],k=0|kf[e+60+(12*R|0)+4>>2],R=0|kf[O>>2],D=0,F=0;;){if(B=R,R=R+1|0,kf[O>>2]=R,k>>>0<=B>>>0){ee=x,te=0;break e}if(N=F+(0==(kf[(0|kf[L>>2])+(B>>>5<<2)>>2]&1<<(31&B)|0)&1)|0,D=D+1|0,(0|D)>=(0|Q)){ne=N;break}F=N}if(F=0|np(P,r),ne){if(D=0|kf[a>>2],b){L=0;do x=D+(L<<2)|0,kf[x>>2]=(0|kf[x>>2])/(0|ne)|0,L=L+1|0;while((0|L)!=(0|r))}if(L=t+(F<<2)|0,x=i+(F<<2)|0,(0|kf[o>>2])>0){k=0;do R=0|kf[D+(k<<2)>>2],O=0|kf[E>>2],(0|R)>(0|O)?(N=0|kf[T>>2],kf[N+(k<<2)>>2]=O,re=N):(N=0|kf[S>>2],O=0|kf[T>>2],kf[O+(k<<2)>>2]=(0|R)<(0|N)?N:R,re=O),k=k+1|0,se=0|kf[o>>2];while((0|k)<(0|se));if((0|se)>0){k=0;do{D=(0|kf[L+(k<<2)>>2])+(0|kf[re+(k<<2)>>2])|0,O=x+(k<<2)|0,kf[O>>2]=D;do if((0|D)>(0|kf[E>>2]))ae=D-(0|kf[w>>2])|0,y=94;else{if((0|D)>=(0|kf[S>>2]))break;ae=(0|kf[w>>2])+D|0,y=94}while(0);94==(0|y)&&(y=0,kf[O>>2]=ae),k=k+1|0}while((0|k)<(0|kf[o>>2]))}}}else $=F,y=72}if(72==(0|y)?(y=0,k=i+((0|np(P+-1|0,r))<<2)|0,x=t+($<<2)|0,L=i+($<<2)|0,(0|kf[o>>2])>0):0){D=0;do R=0|kf[k+(D<<2)>>2],N=0|kf[E>>2],(0|R)>(0|N)?(B=0|kf[T>>2],kf[B+(D<<2)>>2]=N,oe=B):(B=0|kf[S>>2],N=0|kf[T>>2],kf[N+(D<<2)>>2]=(0|R)<(0|B)?B:R,oe=N),D=D+1|0,he=0|kf[o>>2];while((0|D)<(0|he));if((0|he)>0){D=0;do k=(0|kf[x+(D<<2)>>2])+(0|kf[oe+(D<<2)>>2])|0,F=L+(D<<2)|0,kf[F>>2]=k,(0|k)<=(0|kf[E>>2])?(0|k)<(0|kf[S>>2])&&(le=(0|kf[w>>2])+k|0,y=82):(le=k-(0|kf[w>>2])|0,y=82),82==(0|y)&&(y=0,kf[F>>2]=le),D=D+1|0;while((0|D)<(0|kf[o>>2]))}}if(P=P+1|0,(0|P)>=(0|d)){y=99;break}if(D=0|kf[m>>2],M=0|kf[D>>2],(0|kf[D+4>>2])-M>>2>>>0<=P>>>0){I=D,y=28;break}}if(28==(0|y))Du(I);else if(99==(0|y)){ee=0|kf[a>>2],te=1;break}}else ee=g,te=1;while(0);return 0|ee&&(g=0|kf[u>>2],(0|g)!=(0|ee)&&(kf[u>>2]=g+(~((g+-4-ee|0)>>>2)<<2)),mf(ee)),mf(A),A=0|kf[n+36>>2],0|A&&(ee=n+40|0,g=0|kf[ee>>2],(0|g)!=(0|A)&&(kf[ee>>2]=g+(~((g+-4-A|0)>>>2)<<2)),mf(A)),A=0|kf[n+24>>2],0|A&&(g=n+28|0,ee=0|kf[g>>2],(0|ee)!=(0|A)&&(kf[g>>2]=ee+(~((ee+-4-A|0)>>>2)<<2)),mf(A)),A=0|kf[n+12>>2],0|A&&(ee=n+16|0,g=0|kf[ee>>2],(0|g)!=(0|A)&&(kf[ee>>2]=g+(~((g+-4-A|0)>>>2)<<2)),mf(A)),(A=0|kf[n>>2])?(g=n+4|0,n=0|kf[g>>2],(0|n)!=(0|A)&&(kf[g>>2]=n+(~((n+-4-A|0)>>>2)<<2)),mf(A),Xf=s,0|te):(Xf=s,0|te)}function Oi(e,t,i,n,r,s){e=0|e,t=+t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0;a=Xf,Xf=Xf+560|0,o=a+8|0,h=a,l=a+524|0,c=l,d=a+512|0,kf[h>>2]=0,u=d+12|0,0|Bc(t),(0|qf)<0?(f=1,p=13941,_=-t):(f=0!=(2049&r|0)&1,p=0==(2048&r|0)?0==(1&r|0)?13942:13947:13944,_=t),0|Bc(_),m=2146435072&qf;do if(m>>>0<2146435072|2146435072==(0|m)&!1){if(t=2*+Zu(_,h),A=0!=t,A&&(kf[h>>2]=(0|kf[h>>2])+-1),v=32|s,97==(0|v)){y=32&s,g=0==(0|y)?p:p+9|0,b=2|f,E=12-n|0;do{if(!(n>>>0>11|0==(0|E))){T=E,S=8;do T=T+-1|0,S=16*S;while(0!=(0|T));if(45==(0|If[g>>0])){w=-(S+(-t-S));break}w=t+S-S;break}w=t}while(0);for(E=0|kf[h>>2],T=(0|E)<0?0-E|0:E,C=0|ca(T,((0|T)<0)<<31>>31,u),(0|C)==(0|u)?(T=d+11|0,If[T>>0]=48,M=T):M=C,If[M+-1>>0]=(E>>31&2)+43,E=M+-2|0,If[E>>0]=s+15,C=(0|n)<1,T=0==(8&r|0),P=l,I=w;;){if(R=~~I,x=P+1|0,If[P>>0]=Lf[13976+R>>0]|y,I=16*(I-+(0|R)),1!=(x-c|0)||T&(C&0==I)?O=x:(If[x>>0]=46,O=P+2|0),0==I)break;P=O}P=O-c|0,C=u-E|0,T=0!=(0|n)&(P+-2|0)<(0|n)?n+2|0:P,y=C+b+T|0,so(e,32,i,y,r),Td(e,g,b),so(e,48,i,y,65536^r),Td(e,l,P),so(e,48,T-P|0,0,0),Td(e,E,C),so(e,32,i,y,8192^r),k=y;break}y=(0|n)<0?6:n,A?(C=(0|kf[h>>2])+-28|0,kf[h>>2]=C,D=C,L=268435456*t):(D=0|kf[h>>2],L=t),C=(0|D)<0?o:o+288|0,I=L,P=C;do T=~~I>>>0,kf[P>>2]=T,P=P+4|0,I=1e9*(I-+(T>>>0));while(0!=I);if((0|D)>0)for(A=D,E=C,b=P;;){if(g=(0|A)<29?A:29,T=b+-4|0,T>>>0>=E>>>0){x=0,R=T;do T=0|ql(0|kf[R>>2],0,0|g),N=0|tc(0|T,0|qf,0|x,0),T=qf,F=0|nl(0|N,0|T,1e9,0),kf[R>>2]=F,x=0|Yd(0|N,0|T,1e9,0),R=R+-4|0;while(R>>>0>=E>>>0);x?(R=E+-4|0,kf[R>>2]=x,B=R):B=E}else B=E;for(R=b;;){if(R>>>0<=B>>>0)break;if(T=R+-4|0,0|kf[T>>2])break;R=T}if(x=(0|kf[h>>2])-g|0,kf[h>>2]=x,!((0|x)>0)){V=x,U=B,G=R;break}A=x,E=B,b=R}else V=D,U=C,G=P;if((0|V)<0)for(b=((y+25|0)/9|0)+1|0,E=102==(0|v),A=V,x=U,T=G;;){if(N=0-A|0,F=(0|N)<9?N:9,x>>>0<T>>>0){N=(1<<F)+-1|0,W=1e9>>>F,z=0,H=x;do j=0|kf[H>>2],kf[H>>2]=(j>>>F)+z,z=0|np(j&N,W),H=H+4|0;while(H>>>0<T>>>0);H=0==(0|kf[x>>2])?x+4|0:x,z?(kf[T>>2]=z,Y=H,X=T+4|0):(Y=H,X=T)}else Y=0==(0|kf[x>>2])?x+4|0:x,X=T;if(H=E?C:Y,W=(X-H>>2|0)>(0|b)?H+(b<<2)|0:X,A=(0|kf[h>>2])+F|0,kf[h>>2]=A,(0|A)>=0){Z=Y,K=W;break}x=Y,T=W}else Z=U,K=G;if(T=C,Z>>>0<K>>>0)if(x=9*(T-Z>>2)|0,A=0|kf[Z>>2],A>>>0<10)Q=x;else for(b=x,x=10;;){if(x=10*x|0,E=b+1|0,A>>>0<x>>>0){Q=E;break}b=E}else Q=0;if(b=103==(0|v),x=0!=(0|y),A=y-(102!=(0|v)?Q:0)+((x&b)<<31>>31)|0,(0|A)<((9*(K-T>>2)|0)+-9|0)){if(E=A+9216|0,A=C+4+(((0|E)/9|0)+-1024<<2)|0,P=((0|E)%9|0)+1|0,(0|P)<9)for(E=10,W=P;;){if(P=10*E|0,W=W+1|0,9==(0|W)){J=P;break}E=P}else J=10;if(E=0|kf[A>>2],W=(E>>>0)%(J>>>0)|0,v=(A+4|0)==(0|K),v&0==(0|W))ne=Z,re=A,se=Q;else if(S=0==(1&((E>>>0)/(J>>>0)|0)|0)?9007199254740992:9007199254740994,P=(0|J)/2|0,I=W>>>0<P>>>0?.5:v&(0|W)==(0|P)?1:1.5,f?(P=45==(0|If[p>>0]),q=P?-S:S,$=P?-I:I):(q=S,$=I),P=E-W|0,kf[A>>2]=P,q+$!=q){if(W=P+J|0,kf[A>>2]=W,W>>>0>999999999)for(W=Z,P=A;;){if(E=P+-4|0,kf[P>>2]=0,E>>>0<W>>>0?(v=W+-4|0,kf[v>>2]=0,ee=v):ee=W,v=(0|kf[E>>2])+1|0,kf[E>>2]=v,!(v>>>0>999999999)){te=ee,ie=E;break}W=ee,P=E}else te=Z,ie=A;if(P=9*(T-te>>2)|0,W=0|kf[te>>2],W>>>0<10)ne=te,re=ie,se=P;else for(E=P,P=10;;){if(P=10*P|0,v=E+1|0,W>>>0<P>>>0){ne=te,re=ie,se=v;break}E=v}}else ne=Z,re=A,se=Q;E=re+4|0,ae=ne,oe=se,he=K>>>0>E>>>0?E:K}else ae=Z,oe=Q,he=K;for(E=he;;){if(E>>>0<=ae>>>0){le=0;break}if(P=E+-4|0,0|kf[P>>2]){le=1;break}E=P}A=0-oe|0;do if(b){if(P=(1&(1^x))+y|0,(0|P)>(0|oe)&(0|oe)>-5?(ce=P+-1-oe|0,de=s+-1|0):(ce=P+-1|0,de=s+-2|0),P=8&r,!P){if(le?(W=0|kf[E+-4>>2],0!=(0|W)):0)if((W>>>0)%10|0)ue=0;else for(v=10,H=0;;){if(v=10*v|0,N=H+1|0,(W>>>0)%(v>>>0)|0|0){ue=N;break}H=N}else ue=9;if(H=(9*(E-T>>2)|0)+-9|0,102==(32|de|0)){v=H-ue|0,W=(0|v)>0?v:0,fe=0,pe=(0|ce)<(0|W)?ce:W,_e=de;break}W=H+oe-ue|0,H=(0|W)>0?W:0,fe=0,pe=(0|ce)<(0|H)?ce:H,_e=de;break}fe=P,pe=ce,_e=de}else fe=8&r,pe=y,_e=s;while(0);if(y=pe|fe,T=0!=(0|y)&1,x=102==(32|_e|0))me=0,Ae=(0|oe)>0?oe:0;else{if(b=(0|oe)<0?A:oe,H=0|ca(b,((0|b)<0)<<31>>31,u),b=u,(b-H|0)<2)for(W=H;;){if(v=W+-1|0,If[v>>0]=48,!((b-v|0)<2)){ve=v;break}W=v}else ve=H;If[ve+-1>>0]=(oe>>31&2)+43,W=ve+-2|0,If[W>>0]=_e,me=W,Ae=b-W|0}if(W=f+1+pe+T+Ae|0,so(e,32,i,W,r),Td(e,p,f),so(e,48,i,W,65536^r),x){A=ae>>>0>C>>>0?C:ae,v=l+9|0,F=v,z=l+8|0,N=A;do{if(R=0|ca(0|kf[N>>2],0,v),(0|N)==(0|A))(0|R)==(0|v)?(If[z>>0]=48,ye=z):ye=R;else if(R>>>0>l>>>0)for(0|Bs(0|l,48,R-c|0),g=R;;){if(j=g+-1|0,!(j>>>0>l>>>0)){ye=j;break}g=j}else ye=R;Td(e,ye,F-ye|0),N=N+4|0}while(N>>>0<=C>>>0);if(0|y&&Td(e,13992,1),N>>>0<E>>>0&(0|pe)>0)for(C=N,F=pe;;){if(z=0|ca(0|kf[C>>2],0,v),z>>>0>l>>>0)for(0|Bs(0|l,48,z-c|0),A=z;;){if(x=A+-1|0,!(x>>>0>l>>>0)){ge=x;break}A=x}else ge=z;if(Td(e,ge,(0|F)<9?F:9),C=C+4|0,A=F+-9|0,!(C>>>0<E>>>0&(0|F)>9)){be=A;break}F=A}else be=pe;so(e,48,be+9|0,9,0)}else{if(F=le?E:ae+4|0,(0|pe)>-1)for(C=l+9|0,v=0==(0|fe),N=C,y=0-c|0,A=l+8|0,R=ae,x=pe;;){T=0|ca(0|kf[R>>2],0,C),(0|T)==(0|C)?(If[A>>0]=48,Ee=A):Ee=T;do if((0|R)==(0|ae)){if(T=Ee+1|0,Td(e,Ee,1),v&(0|x)<1){Te=T;break}Td(e,13992,1),Te=T}else{if(Ee>>>0<=l>>>0){Te=Ee;break}for(0|Bs(0|l,48,Ee+y|0),T=Ee;;){if(b=T+-1|0,!(b>>>0>l>>>0)){Te=b;break}T=b}}while(0);if(z=N-Te|0,Td(e,Te,(0|x)>(0|z)?z:x),T=x-z|0,R=R+4|0,!(R>>>0<F>>>0&(0|T)>-1)){Se=T;break}x=T}else Se=pe;so(e,48,Se+18|0,18,0),Td(e,me,u-me|0)}so(e,32,i,W,8192^r),k=W}else x=0!=(32&s|0),F=f+3|0,so(e,32,i,F,r&-65537),Td(e,p,f),Td(e,_!=_|!1?x?13968:13972:x?13960:13964,3),so(e,32,i,F,8192^r),k=F;while(0);return Xf=a,0|((0|k)<(0|i)?i:k)}function ki(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0;if(i=Xf,Xf=Xf+48|0,n=i+36|0,r=i+24|0,s=i+12|0,a=i,o=e+4|0,h=0|kf[(0|kf[o>>2])+44>>2],l=e+8|0,c=0|kf[l>>2],d=((0|kf[c+4>>2])-(0|kf[c>>2])>>2>>>0)/3|0,c=h+96|0,u=h+100|0,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,h=0|kf[u>>2],f=0|kf[c>>2],p=(h-f|0)/12|0,_=f,f=h,d>>>0<=p>>>0?(d>>>0<p>>>0?(h=_+(12*d|0)|0,(0|f)!=(0|h)):0)&&(kf[u>>2]=f+(12*~(((f+-12-h|0)>>>0)/12|0)|0)):$t(c,d-p|0,n),p=e+216|0,d=e+220|0,(0|kf[p>>2])==(0|kf[d>>2])){if(c=0|kf[o>>2],h=0|kf[c+44>>2],f=0|kf[h+100>>2],u=0|kf[h+96>>2],(0|f)==(0|u))m=c;else for(_=r+4|0,A=r+8|0,v=h,h=u,u=c,y=c,c=f,f=0;;){if(kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,g=3*f|0,(0|g)!=-1?(b=0|kf[(0|kf[kf[l>>2]>>2])+(g<<2)>>2],kf[r>>2]=b,E=g+1|0,(0|E)==-1?(kf[_>>2]=-1,T=b,S=0,w=92):(C=b,M=E,w=91)):(kf[r>>2]=-1,C=-1,M=0,w=91),91==(0|w)&&(w=0,kf[_>>2]=kf[(0|kf[kf[l>>2]>>2])+(M<<2)>>2],E=g+2|0,(0|E)==-1?(P=C,I=-1):(T=C,S=E,w=92)),92==(0|w)&&(w=0,
P=T,I=0|kf[(0|kf[kf[l>>2]>>2])+(S<<2)>>2]),kf[A>>2]=I,E=v+96|0,g=v+100|0,b=(c-h|0)/12|0,R=h,x=f,f=f+1|0,x>>>0<b>>>0?(O=u,k=v,D=y,L=R,N=h,F=c):(B=c,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,f>>>0<=b>>>0?(f>>>0<b>>>0?(V=R+(12*f|0)|0,(0|B)!=(0|V)):0)?(U=B+(12*~(((B+-12-V|0)>>>0)/12|0)|0)|0,kf[g>>2]=U,G=R,W=y,z=v,H=U,j=h):(G=R,W=y,z=v,H=c,j=h):($t(E,f-b|0,n),b=0|kf[o>>2],R=0|kf[b+44>>2],G=0|kf[E>>2],W=b,z=R,H=0|kf[R+100>>2],j=0|kf[R+96>>2]),O=W,k=z,D=W,L=G,N=j,F=H),kf[L+(12*x|0)>>2]=P,kf[L+(12*x|0)+4>>2]=kf[_>>2],kf[L+(12*x|0)+8>>2]=kf[A>>2],f>>>0>=((F-N|0)/12|0)>>>0){m=O;break}v=k,h=N,u=O,y=D,c=F}return kf[(0|kf[m+4>>2])+80>>2]=t,Y=1,Xf=i,0|Y}kf[r>>2]=0,t=r+4|0,kf[t>>2]=0,kf[r+8>>2]=0,m=0|kf[l>>2],F=(0|kf[m+4>>2])-(0|kf[m>>2])|0,c=F>>2,kf[s>>2]=0,D=s+4|0,kf[D>>2]=0,kf[s+8>>2]=0;do if(0|c){if(!(c>>>0>1073741823)){y=0|sl(F),kf[s>>2]=y,O=y+(c<<2)|0,kf[s+8>>2]=O,0|Bs(0|y,0,0|F),kf[D>>2]=O;break}Du(s)}while(0);e:do if(((0|kf[m+28>>2])-(0|kf[m+24>>2])|0)>0)for(F=e+120|0,c=r+8|0,O=m,y=0;;){u=0|kf[(0|kf[O+24>>2])+(y<<2)>>2];t:do if((0|u)!=-1){i:do if(0==(kf[(0|kf[F>>2])+(y>>>5<<2)>>2]&1<<(31&y)|0)?(N=0|kf[d>>2],h=0|kf[p>>2],k=h,(0|N)!=(0|h)):0){if(v=(0==((u>>>0)%3|0|0)?2:-1)+u|0,f=(N-h|0)/144|0,(0|v)==-1)for(h=0;;){if(N=0|kf[(0|kf[kf[k+(144*h|0)+68>>2]>>2])+(u<<2)>>2],1<<(31&N)&kf[(0|kf[k+(144*h|0)+16>>2])+(N>>>5<<2)>>2]|0){X=0;break e}if(h=h+1|0,h>>>0>=f>>>0){Z=u;break i}}for(h=O+12|0,N=0;;){if(A=0|kf[(0|kf[kf[k+(144*N|0)+68>>2]>>2])+(u<<2)>>2],1<<(31&A)&kf[(0|kf[k+(144*N|0)+16>>2])+(A>>>5<<2)>>2]|0){A=0|kf[k+(144*N|0)+32>>2],L=0|kf[A+(u<<2)>>2],_=0|kf[h>>2],P=0|kf[_+(v<<2)>>2];do{if((0|P)!=-1){if((P>>>0)%3|0){K=P+-1|0;break}K=P+2|0;break}K=-1}while(0);if((0|K)!=(0|u))for(P=K;;){if((0|P)==-1){X=0;break e}if((0|kf[A+(P<<2)>>2])!=(0|L)){Z=P;break i}H=(0==((P>>>0)%3|0|0)?2:-1)+P|0;do{if((0|H)!=-1){if(j=0|kf[_+(H<<2)>>2],(0|j)==-1){Q=-1;break}if((j>>>0)%3|0){Q=j+-1|0;break}Q=j+2|0;break}Q=-1}while(0);if((0|Q)==(0|u))break;P=Q}}if(N=N+1|0,N>>>0>=f>>>0){Z=u;break}}}else Z=u;while(0);if(f=0|kf[t>>2],kf[(0|kf[s>>2])+(Z<<2)>>2]=f-(0|kf[r>>2])>>2,kf[n>>2]=Z,N=f,N>>>0<(0|kf[c>>2])>>>0?(kf[N>>2]=Z,kf[t>>2]=N+4,J=O):(us(r,n),J=0|kf[l>>2]),(((0|Z)!=-1?(N=(0==((Z>>>0)%3|0|0)?2:-1)+Z|0,(0|N)!=-1):0)?(f=0|kf[(0|kf[J+12>>2])+(N<<2)>>2],(0|f)!=-1):0)?(N=f+(0==((f>>>0)%3|0|0)?2:-1)|0,(0|N)!=-1&(0|N)!=(0|Z)):0)for(f=J,v=N,N=Z;;){h=0|kf[d>>2],k=0|kf[p>>2],P=k;i:do if((0|h)==(0|k))w=66;else{for(_=(h-k|0)/144|0,L=0;;){if(A=0|kf[P+(144*L|0)+32>>2],L=L+1|0,(0|kf[A+(v<<2)>>2])!=(0|kf[A+(N<<2)>>2]))break;if(L>>>0>=_>>>0){w=66;break i}}_=0|kf[t>>2],kf[(0|kf[s>>2])+(v<<2)>>2]=_-(0|kf[r>>2])>>2,kf[n>>2]=v,L=_,L>>>0<(0|kf[c>>2])>>>0?(kf[L>>2]=v,kf[t>>2]=L+4,q=f):(us(r,n),q=0|kf[l>>2]),$=q}while(0);if(66==(0|w)&&(w=0,P=0|kf[s>>2],kf[P+(v<<2)>>2]=kf[P+(N<<2)>>2],$=f),(0|v)==-1){ee=$;break t}if(P=(0==((v>>>0)%3|0|0)?2:-1)+v|0,(0|P)==-1){ee=$;break t}if(k=0|kf[(0|kf[$+12>>2])+(P<<2)>>2],(0|k)==-1){ee=$;break t}if(P=k+(0==((k>>>0)%3|0|0)?2:-1)|0,!((0|P)!=-1&(0|P)!=(0|Z))){ee=$;break}k=v,f=$,v=P,N=k}else ee=J}else ee=O;while(0);if(y=y+1|0,(0|y)>=((0|kf[ee+28>>2])-(0|kf[ee+24>>2])>>2|0)){w=27;break}O=ee}else w=27;while(0);if(27==(0|w)){if(w=0|kf[o>>2],ee=0|kf[w+44>>2],J=0|kf[ee+100>>2],$=0|kf[ee+96>>2],(0|J)==(0|$))te=w;else for(Z=a+4|0,q=a+8|0,l=w,p=w,w=ee,ee=$,$=J,J=0;;){if(kf[a>>2]=0,kf[a+4>>2]=0,kf[a+8>>2]=0,d=(0|kf[s>>2])+(3*J<<2)|0,kf[a>>2]=kf[d>>2],kf[a+4>>2]=kf[d+4>>2],kf[a+8>>2]=kf[d+8>>2],d=w+96|0,Q=w+100|0,K=($-ee|0)/12|0,m=ee,e=J,J=J+1|0,e>>>0<K>>>0?(ie=m,ne=ee,re=$,se=l,ae=w,oe=p):(O=$,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,J>>>0<=K>>>0?(J>>>0<K>>>0?(y=m+(12*J|0)|0,(0|O)!=(0|y)):0)?(c=O+(12*~(((O+-12-y|0)>>>0)/12|0)|0)|0,kf[Q>>2]=c,he=m,le=p,ce=w,de=c,ue=ee):(he=m,le=p,ce=w,de=$,ue=ee):($t(d,J-K|0,n),K=0|kf[o>>2],m=0|kf[K+44>>2],he=0|kf[d>>2],le=K,ce=m,de=0|kf[m+100>>2],ue=0|kf[m+96>>2]),ie=he,ne=ue,re=de,se=le,ae=ce,oe=le),kf[ie+(12*e|0)>>2]=kf[a>>2],kf[ie+(12*e|0)+4>>2]=kf[Z>>2],kf[ie+(12*e|0)+8>>2]=kf[q>>2],J>>>0>=((re-ne|0)/12|0)>>>0){te=se;break}l=se,p=oe,w=ae,ee=ne,$=re}kf[(0|kf[te+4>>2])+80>>2]=(0|kf[t>>2])-(0|kf[r>>2])>>2,X=1}return te=0|kf[s>>2],0|te&&(s=0|kf[D>>2],(0|s)!=(0|te)&&(kf[D>>2]=s+(~((s+-4-te|0)>>>2)<<2)),mf(te)),te=0|kf[r>>2],0|te&&(r=0|kf[t>>2],(0|r)!=(0|te)&&(kf[t>>2]=r+(~((r+-4-te|0)>>>2)<<2)),mf(te)),Y=X,Xf=i,0|Y}function Di(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Pe=0,Ie=0;s=Xf,Xf=Xf+64|0,a=s+16|0,o=s,h=s+24|0,l=s+8|0,c=s+20|0,kf[a>>2]=t,d=0!=(0|e),u=h+40|0,f=u,p=h+39|0,h=l+4|0,_=t,t=0,m=0,A=0;e:for(;;){do{if((0|t)>-1){if((0|m)>(2147483647-t|0)){v=0|nf(),kf[v>>2]=75,y=-1;break}y=m+t|0;break}y=t}while(0);if(v=0|If[_>>0],!(v<<24>>24)){g=87;break}b=v,E=_;t:for(;;){switch(b<<24>>24){case 37:T=E,S=E,g=9;break t;case 0:w=E,C=E;break t}v=E+1|0,kf[a>>2]=v,b=0|If[v>>0],E=v}t:do if(9==(0|g))for(;;){if(g=0,37!=(0|If[T+1>>0])){w=T,C=S;break t}if(v=S+1|0,M=T+2|0,kf[a>>2]=M,37!=(0|If[M>>0])){w=M,C=v;break}T=M,S=v,g=9}while(0);if(v=C-_|0,d&&Td(e,_,v),0|v)_=w,t=y,m=v;else{v=w+1|0,M=(0|If[v>>0])+-48|0,M>>>0<10?(P=36==(0|If[w+2>>0]),I=P?M:-1,R=P?1:A,x=P?w+3|0:v):(I=-1,R=A,x=v),kf[a>>2]=x,v=0|If[x>>0],P=(v<<24>>24)+-32|0;t:do if(P>>>0<32)for(M=v,O=0,k=x,D=P;;){if(L=1<<D,!(75913&L)){N=M,F=k,B=O;break t}if(V=L|O,L=k+1|0,kf[a>>2]=L,U=0|If[L>>0],D=(U<<24>>24)+-32|0,D>>>0>=32){N=U,F=L,B=V;break}M=U,O=V,k=L}else N=v,F=x,B=0;while(0);if(N<<24>>24==42){if(v=F+1|0,P=(0|If[v>>0])+-48|0,P>>>0<10?36==(0|If[F+2>>0]):0)kf[r+(P<<2)>>2]=10,G=1,W=F+3|0,z=0|kf[n+((0|If[v>>0])+-48<<3)>>2];else{if(0|R){H=-1;break}d?(P=(0|kf[i>>2])+3&-4,k=0|kf[P>>2],kf[i>>2]=P+4,G=0,W=v,z=k):(G=0,W=v,z=0)}kf[a>>2]=W,v=(0|z)<0,j=W,Y=v?8192|B:B,X=G,Z=v?0-z|0:z}else{if(v=0|Ko(a),(0|v)<0){H=-1;break}j=0|kf[a>>2],Y=B,X=R,Z=v}do if(46==(0|If[j>>0])){if(42!=(0|If[j+1>>0])){kf[a>>2]=j+1,v=0|Ko(a),K=0|kf[a>>2],Q=v;break}if(v=j+2|0,k=(0|If[v>>0])+-48|0,k>>>0<10?36==(0|If[j+3>>0]):0){kf[r+(k<<2)>>2]=10,k=0|kf[n+((0|If[v>>0])+-48<<3)>>2],P=j+4|0,kf[a>>2]=P,K=P,Q=k;break}if(0|X){H=-1;break e}d?(k=(0|kf[i>>2])+3&-4,P=0|kf[k>>2],kf[i>>2]=k+4,J=P):J=0,kf[a>>2]=v,K=v,Q=J}else K=j,Q=-1;while(0);for(v=K,P=0;;){if(((0|If[v>>0])+-65|0)>>>0>57){H=-1;break e}if(q=v+1|0,kf[a>>2]=q,$=0|If[(0|If[v>>0])+-65+(13460+(58*P|0))>>0],ee=255&$,!((ee+-1|0)>>>0<8))break;v=q,P=ee}if(!($<<24>>24)){H=-1;break}k=(0|I)>-1;do if($<<24>>24==19){if(k){H=-1;break e}g=49}else{if(k){kf[r+(I<<2)>>2]=ee,O=n+(I<<3)|0,M=0|kf[O+4>>2],D=o,kf[D>>2]=kf[O>>2],kf[D+4>>2]=M,g=49;break}if(!d){H=0;break e}Me(o,ee,i)}while(0);if(49!=(0|g)||(g=0,d)){k=0|If[v>>0],M=0!=(0|P)&3==(15&k|0)?k&-33:k,k=Y&-65537,D=0==(8192&Y|0)?Y:k;t:do switch(0|M){case 110:switch((255&P)<<24>>24){case 0:kf[kf[o>>2]>>2]=y,_=q,t=y,m=0,A=X;continue e;case 1:kf[kf[o>>2]>>2]=y,_=q,t=y,m=0,A=X;continue e;case 2:O=0|kf[o>>2],kf[O>>2]=y,kf[O+4>>2]=((0|y)<0)<<31>>31,_=q,t=y,m=0,A=X;continue e;case 3:xf[kf[o>>2]>>1]=y,_=q,t=y,m=0,A=X;continue e;case 4:If[kf[o>>2]>>0]=y,_=q,t=y,m=0,A=X;continue e;case 6:kf[kf[o>>2]>>2]=y,_=q,t=y,m=0,A=X;continue e;case 7:O=0|kf[o>>2],kf[O>>2]=y,kf[O+4>>2]=((0|y)<0)<<31>>31,_=q,t=y,m=0,A=X;continue e;default:_=q,t=y,m=0,A=X;continue e}break;case 112:te=8|D,ie=Q>>>0>8?Q:8,ne=120,g=61;break;case 88:case 120:te=D,ie=Q,ne=M,g=61;break;case 111:O=o,L=0|kf[O>>2],V=0|kf[O+4>>2],O=0|th(L,V,u),U=f-O|0,re=L,se=V,ae=O,oe=D,he=0==(8&D|0)|(0|Q)>(0|U)?Q:U+1|0,le=0,ce=13924,g=67;break;case 105:case 100:if(U=o,O=0|kf[U>>2],V=0|kf[U+4>>2],(0|V)<0){U=0|nc(0,0,0|O,0|V),L=qf,de=o,kf[de>>2]=U,kf[de+4>>2]=L,ue=U,fe=L,pe=1,_e=13924,g=66;break t}ue=O,fe=V,pe=0!=(2049&D|0)&1,_e=0==(2048&D|0)?0==(1&D|0)?13924:13926:13925,g=66;break t;case 117:V=o,ue=0|kf[V>>2],fe=0|kf[V+4>>2],pe=0,_e=13924,g=66;break;case 99:If[p>>0]=kf[o>>2],me=p,Ae=k,ve=1,ye=0,ge=13924,be=u;break;case 109:V=0|nf(),Ee=0|Id(0|kf[V>>2]),g=71;break;case 115:V=0|kf[o>>2],Ee=0|V?V:13934,g=71;break;case 67:kf[l>>2]=kf[o>>2],kf[h>>2]=0,kf[o>>2]=l,Te=l,Se=-1,g=75;break;case 83:V=0|kf[o>>2],Q?(Te=V,Se=Q,g=75):(so(e,32,Z,0,D),we=0,g=84);break;case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:_=q,t=y,m=0|Oi(e,+zf[o>>3],Z,Q,D,M),A=X;continue e;default:me=_,Ae=D,ve=Q,ye=0,ge=13924,be=u}while(0);t:do if(61==(0|g))g=0,M=o,P=0|kf[M>>2],v=0|kf[M+4>>2],M=0|No(P,v,u,32&ne),V=0==(8&te|0)|0==(0|P)&0==(0|v),re=P,se=v,ae=M,oe=te,he=ie,le=V?0:2,ce=V?13924:13924+(ne>>4)|0,g=67;else if(66==(0|g))g=0,re=ue,se=fe,ae=0|ca(ue,fe,u),oe=D,he=Q,le=pe,ce=_e,g=67;else if(71==(0|g))g=0,V=0|Ot(Ee,0,Q),M=0==(0|V),me=Ee,Ae=k,ve=M?Q:V-Ee|0,ye=0,ge=13924,be=M?Ee+Q|0:V;else if(75==(0|g)){for(g=0,V=0,M=0,v=Te;;){if(P=0|kf[v>>2],!P){Ce=V,Pe=M;break}if(O=0|ud(c,P),(0|O)<0|O>>>0>(Se-V|0)>>>0){Ce=V,Pe=O;break}if(P=O+V|0,!(Se>>>0>P>>>0)){Ce=P,Pe=O;break}V=P,M=O,v=v+4|0}if((0|Pe)<0){H=-1;break e}if(so(e,32,Z,Ce,D),Ce)for(v=0,M=Te;;){if(V=0|kf[M>>2],!V){we=Ce,g=84;break t}if(O=0|ud(c,V),v=O+v|0,(0|v)>(0|Ce)){we=Ce,g=84;break t}if(Td(e,c,O),v>>>0>=Ce>>>0){we=Ce,g=84;break}M=M+4|0}else we=0,g=84}while(0);if(67==(0|g))g=0,k=0!=(0|re)|0!=(0|se),M=0!=(0|he)|k,v=(1&(1^k))+(f-ae)|0,me=M?ae:u,Ae=(0|he)>-1?oe&-65537:oe,ve=M?(0|he)>(0|v)?he:v:he,ye=le,ge=ce,be=u;else if(84==(0|g)){g=0,so(e,32,Z,we,8192^D),_=q,t=y,m=(0|Z)>(0|we)?Z:we,A=X;continue}v=be-me|0,M=(0|ve)<(0|v)?v:ve,k=M+ye|0,O=(0|Z)<(0|k)?k:Z,so(e,32,O,k,Ae),Td(e,ge,ye),so(e,48,O,k,65536^Ae),so(e,48,M,v,0),Td(e,me,v),so(e,32,O,k,8192^Ae),_=q,t=y,m=O,A=X}else _=q,t=y,m=0,A=X}}e:do if(87==(0|g))if(e)H=y;else if(A){for(X=1;;){if(m=0|kf[r+(X<<2)>>2],!m){Ie=X;break}if(Me(n+(X<<3)|0,m,i),X=X+1|0,(0|X)>=10){H=1;break e}}for(;;){if(0|kf[r+(Ie<<2)>>2]){H=-1;break e}if(Ie=Ie+1|0,(0|Ie)>=10){H=1;break}}}else H=0;while(0);return Xf=s,0|H}function Li(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0;t=Xf,Xf=Xf+32|0,i=t+20|0,n=t+16|0,r=t+4|0,s=t,a=e+36|0,o=e+37|0,h=e+32|0,l=0|kf[h>>2];do{if((65535&((0|Lf[a>>0])<<8|(0|Lf[o>>0])))<514){if(c=l+8|0,d=0|kf[c>>2],u=0|kf[c+4>>2],c=l+16|0,f=c,p=0|kf[f>>2],_=0|kf[f+4>>2],f=0|tc(0|p,0|_,4,0),m=qf,(0|u)<(0|m)|(0|u)==(0|m)&d>>>0<f>>>0)return A=0,Xf=t,0|A;if(v=(0|kf[l>>2])+p|0,y=Lf[v>>0]|Lf[v+1>>0]<<8|Lf[v+2>>0]<<16|Lf[v+3>>0]<<24,kf[i>>2]=y,v=c,kf[v>>2]=f,kf[v+4>>2]=m,m=0|tc(0|p,0|_,8,0),_=qf,(0|u)<(0|_)|(0|u)==(0|_)&d>>>0<m>>>0)return A=0,Xf=t,0|A;d=(0|kf[l>>2])+f|0,kf[n>>2]=Lf[d>>0]|Lf[d+1>>0]<<8|Lf[d+2>>0]<<16|Lf[d+3>>0]<<24,d=c,kf[d>>2]=m,kf[d+4>>2]=_,g=y;break}if(!(0|Qs(i,l)))return A=0,Xf=t,0|A;if(0|Qs(n,0|kf[h>>2])){g=0|kf[i>>2];break}return A=0,Xf=t,0|A}while(0);if(g>>>0>1431655765)return A=0,Xf=t,0|A;if(l=0|kf[n>>2],y=0|pl(0|g,0,3,0),_=qf,0>_>>>0|0==(0|_)&l>>>0>y>>>0)return A=0,Xf=t,0|A;if(y=0|kf[h>>2],_=y+8|0,d=0|kf[_+4>>2],m=y+16|0,c=m,f=0|kf[c>>2],u=0|kf[c+4>>2],!((0|d)>(0|u)|((0|d)==(0|u)?(0|kf[_>>2])>>>0>f>>>0:0)))return A=0,Xf=t,0|A;_=0|If[(0|kf[y>>2])+f>>0],d=0|tc(0|f,0|u,1,0),c=qf,p=m,kf[p>>2]=d,kf[p+4>>2]=c;e:do if(_<<24>>24){if(l>>>0<256){if(!g)break;p=e+44|0,m=r+4|0,v=r+8|0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,b=y+8|0,E=0|kf[b>>2],T=0|kf[b+4>>2];t:do if((0|T)>(0|c)|(0|T)==(0|c)&E>>>0>d>>>0)for(b=y,S=E,w=g,C=d,M=c,P=T,I=0;;){if(R=b+16|0,x=0|kf[b>>2],O=0|If[x+C>>0],k=0|tc(0|C,0|M,1,0),D=qf,L=R,kf[L>>2]=k,kf[L+4>>2]=D,kf[r>>2]=255&O,!((0|P)>(0|D)|(0|P)==(0|D)&S>>>0>k>>>0))break t;if(D=0|If[x+k>>0],k=0|tc(0|C,0|M,2,0),O=qf,L=R,kf[L>>2]=k,kf[L+4>>2]=O,kf[m>>2]=255&D,!((0|P)>(0|O)|(0|P)==(0|O)&S>>>0>k>>>0))break t;if(O=0|If[x+k>>0],k=0|tc(0|C,0|M,3,0),x=R,kf[x>>2]=k,kf[x+4>>2]=qf,kf[v>>2]=255&O,O=0|kf[p>>2],x=O+100|0,k=0|kf[x>>2],(0|k)==(0|kf[O+104>>2])?(Yr(O+96|0,r),N=0|kf[i>>2]):(kf[k>>2]=kf[r>>2],kf[k+4>>2]=kf[r+4>>2],kf[k+8>>2]=kf[r+8>>2],kf[x>>2]=(0|kf[x>>2])+12,N=w),I=I+1|0,I>>>0>=N>>>0)break e;if(b=0|kf[h>>2],x=b+16|0,C=0|kf[x>>2],M=0|kf[x+4>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,x=b+8|0,S=0|kf[x>>2],P=0|kf[x+4>>2],!((0|P)>(0|M)|(0|P)==(0|M)&S>>>0>C>>>0))break;w=N}while(0);return A=0,Xf=t,0|A}if(l>>>0<65536){if(!g)break;p=e+44|0,v=r+4|0,m=r+8|0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,T=y+8|0,E=0|kf[T>>2],w=0|kf[T+4>>2],T=0|tc(0|f,0|u,3,0),C=qf;t:do if(!((0|w)<(0|C)|(0|w)==(0|C)&E>>>0<T>>>0))for(S=y,M=d,P=T,b=C,I=c,x=w,k=E,O=g,R=0;;){if(D=S+16|0,L=0|kf[S>>2],F=L+M|0,B=Lf[F>>0]|Lf[F+1>>0]<<8,F=D,kf[F>>2]=P,kf[F+4>>2]=b,kf[r>>2]=65535&B,B=0|tc(0|M,0|I,4,0),F=qf,(0|x)<(0|F)|(0|x)==(0|F)&k>>>0<B>>>0)break t;if(V=L+P|0,U=Lf[V>>0]|Lf[V+1>>0]<<8,V=D,kf[V>>2]=B,kf[V+4>>2]=F,kf[v>>2]=65535&U,U=0|tc(0|M,0|I,6,0),F=qf,(0|x)<(0|F)|(0|x)==(0|F)&k>>>0<U>>>0)break t;if(V=L+B|0,B=Lf[V>>0]|Lf[V+1>>0]<<8,V=D,kf[V>>2]=U,kf[V+4>>2]=F,kf[m>>2]=65535&B,B=0|kf[p>>2],F=B+100|0,V=0|kf[F>>2],(0|V)==(0|kf[B+104>>2])?(Yr(B+96|0,r),G=0|kf[i>>2]):(kf[V>>2]=kf[r>>2],kf[V+4>>2]=kf[r+4>>2],kf[V+8>>2]=kf[r+8>>2],kf[F>>2]=(0|kf[F>>2])+12,G=O),R=R+1|0,R>>>0>=G>>>0)break e;if(S=0|kf[h>>2],F=S+16|0,M=0|kf[F>>2],I=0|kf[F+4>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,F=S+8|0,k=0|kf[F>>2],x=0|kf[F+4>>2],P=0|tc(0|M,0|I,2,0),b=qf,(0|x)<(0|b)|(0|x)==(0|b)&k>>>0<P>>>0)break;O=G}while(0);return A=0,Xf=t,0|A}if(p=e+44|0,(0|kf[(0|kf[p>>2])+80>>2])>>>0<2097152?(65535&((0|Lf[a>>0])<<8|(0|Lf[o>>0])))>513:0){if(!g)break;m=r+4|0,v=r+8|0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0;t:do if(0|Qs(s,y)){E=0;do{if(kf[r>>2]=kf[s>>2],!(0|Qs(s,0|kf[h>>2])))break t;if(kf[m>>2]=kf[s>>2],!(0|Qs(s,0|kf[h>>2])))break t;if(kf[v>>2]=kf[s>>2],w=0|kf[p>>2],C=w+100|0,T=0|kf[C>>2],(0|T)==(0|kf[w+104>>2])?Yr(w+96|0,r):(kf[T>>2]=kf[r>>2],kf[T+4>>2]=kf[r+4>>2],kf[T+8>>2]=kf[r+8>>2],kf[C>>2]=(0|kf[C>>2])+12),E=E+1|0,E>>>0>=(0|kf[i>>2])>>>0)break e;C=0|kf[h>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0}while(0|Qs(s,C))}while(0);return A=0,Xf=t,0|A}if(0|g){v=r+4|0,m=r+8|0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,E=y+8|0,C=0|kf[E>>2],T=0|kf[E+4>>2],E=0|tc(0|f,0|u,5,0),w=qf;t:do if(!((0|T)<(0|w)|(0|T)==(0|w)&C>>>0<E>>>0))for(O=y,P=d,k=E,b=w,x=c,I=T,M=C,S=g,R=0;;){if(F=O+16|0,V=0|kf[O>>2],B=V+P|0,U=Lf[B>>0]|Lf[B+1>>0]<<8|Lf[B+2>>0]<<16|Lf[B+3>>0]<<24,B=F,kf[B>>2]=k,kf[B+4>>2]=b,kf[r>>2]=U,U=0|tc(0|P,0|x,8,0),B=qf,(0|I)<(0|B)|(0|I)==(0|B)&M>>>0<U>>>0)break t;if(D=V+k|0,L=Lf[D>>0]|Lf[D+1>>0]<<8|Lf[D+2>>0]<<16|Lf[D+3>>0]<<24,D=F,kf[D>>2]=U,kf[D+4>>2]=B,kf[v>>2]=L,L=0|tc(0|P,0|x,12,0),B=qf,(0|I)<(0|B)|(0|I)==(0|B)&M>>>0<L>>>0)break t;if(D=V+U|0,U=Lf[D>>0]|Lf[D+1>>0]<<8|Lf[D+2>>0]<<16|Lf[D+3>>0]<<24,D=F,kf[D>>2]=L,kf[D+4>>2]=B,kf[m>>2]=U,U=0|kf[p>>2],B=U+100|0,D=0|kf[B>>2],(0|D)==(0|kf[U+104>>2])?(Yr(U+96|0,r),W=0|kf[i>>2]):(kf[D>>2]=kf[r>>2],kf[D+4>>2]=kf[r+4>>2],kf[D+8>>2]=kf[r+8>>2],kf[B>>2]=(0|kf[B>>2])+12,W=S),R=R+1|0,R>>>0>=W>>>0)break e;if(O=0|kf[h>>2],B=O+16|0,P=0|kf[B>>2],x=0|kf[B+4>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,B=O+8|0,M=0|kf[B>>2],I=0|kf[B+4>>2],k=0|tc(0|P,0|x,4,0),b=qf,(0|I)<(0|b)|(0|I)==(0|b)&M>>>0<k>>>0)break;S=W}while(0);return A=0,Xf=t,0|A}}else if(!(0|tt(e,g)))return A=0,Xf=t,0|A;while(0);return kf[(0|kf[e+4>>2])+80>>2]=kf[n>>2],A=1,Xf=t,0|A}function Ni(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0;i=Xf,Xf=Xf+32|0,n=i+16|0,r=i+4|0,s=i,kf[e+36>>2]=t,a=e+24|0,o=e+28|0,h=0|kf[o>>2],l=0|kf[a>>2],c=h-l>>2,d=l,l=h,c>>>0>=t>>>0?(c>>>0>t>>>0?(h=d+(t<<2)|0,(0|l)!=(0|h)):0)&&(kf[o>>2]=l+(~((l+-4-h|0)>>>2)<<2)):lr(a,t-c|0,3564),kf[n>>2]=0,c=n+4|0,kf[c>>2]=0,h=n+8|0,kf[h>>2]=0,t?((0|t)<0&&Du(n),l=((t+-1|0)>>>5)+1|0,d=0|sl(l<<2),kf[n>>2]=d,kf[h>>2]=l,kf[c>>2]=t,l=t>>>5,0|Bs(0|d,0,l<<2|0),u=t-(l<<5)|0,f=d+(l<<2)|0,l=d,u?(kf[f>>2]=kf[f>>2]&~(-1>>>(32-u|0)),p=t,_=l,m=d):(p=t,_=l,m=d)):(p=0,_=0,m=0),d=e+4|0,l=0|kf[e>>2],u=(0|kf[d>>2])-l|0,f=u>>2,kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,v=r+8|0,kf[v>>2]=0;do if(f)if((0|u)<0&&Du(r),y=((f+-1|0)>>>5)+1|0,g=0|sl(y<<2),kf[r>>2]=g,kf[v>>2]=y,kf[A>>2]=f,y=f>>>5,0|Bs(0|g,0,y<<2|0),b=f-(y<<5)|0,E=g+(y<<2)|0,0|b&&(kf[E>>2]=kf[E>>2]&~(-1>>>(32-b|0))),f>>>0>2){b=e+12|0,E=e+32|0,y=e+52|0,g=e+56|0,T=e+48|0,S=l,w=_,C=m,M=0,P=t;e:for(;;){if(I=S,R=3*M|0,(0|R)!=-1)if(x=0|kf[I+(R<<2)>>2],O=R+1|0,k=0==((O>>>0)%3|0|0)?R+-2|0:O,D=(0|k)==-1?-1:0|kf[I+(k<<2)>>2],k=(0==((R>>>0)%3|0|0)?2:-1)+R|0,L=(0|k)==-1?-1:0|kf[I+(k<<2)>>2],(0|x)==(0|D)||(0|x)==(0|L)|(0|D)==(0|L))ee=w,te=C,ie=P;else for(x=C,k=w,I=0,O=P;;){if(N=I+R|0,kf[(0|kf[r>>2])+(N>>>5<<2)>>2]&1<<(31&N))J=k,q=x,$=O;else{if(F=0|kf[(0|kf[e>>2])+(N<<2)>>2],kf[s>>2]=F,kf[x+(F>>>5<<2)>>2]&1<<(31&F)){if(F=0|kf[o>>2],(0|F)==(0|kf[E>>2])?us(a,3564):(kf[F>>2]=-1,kf[o>>2]=F+4),F=0|kf[y>>2],(0|F)==(0|kf[g>>2])?us(T,s):(kf[F>>2]=kf[s>>2],kf[y>>2]=F+4),F=0|kf[c>>2],G=0|kf[h>>2],(0|F)==(G<<5|0)){if((F+1|0)<0){W=52;break e}z=G<<6,G=F+32&-32,Hr(n,F>>>0<1073741823?z>>>0<G>>>0?G:z:2147483647),H=0|kf[c>>2]}else H=F;kf[c>>2]=H+1,F=(0|kf[n>>2])+(H>>>5<<2)|0,kf[F>>2]=kf[F>>2]&~(1<<(31&H)),kf[s>>2]=O,B=O,V=1,U=O+1|0}else B=F,V=0,U=O;F=0|kf[n>>2],z=F+(B>>>5<<2)|0,kf[z>>2]=kf[z>>2]|1<<(31&B),z=F;t:do if(V)for(G=N;;){if((0|G)==-1){W=66;break t}j=(0|kf[r>>2])+(G>>>5<<2)|0,kf[j>>2]=kf[j>>2]|1<<(31&G),j=0|kf[s>>2],kf[(0|kf[a>>2])+(j<<2)>>2]=G,kf[(0|kf[e>>2])+(G<<2)>>2]=j,j=G+1|0,Y=0==((j>>>0)%3|0|0)?G+-2|0:j;do if((0|Y)==-1)X=-1;else{if(j=0|kf[(0|kf[b>>2])+(Y<<2)>>2],Z=j+1|0,(0|j)==-1){X=-1;break}X=0==((Z>>>0)%3|0|0)?j+-2|0:Z}while(0);if((0|X)==(0|N))break;G=X}else for(G=N;;){if((0|G)==-1){W=66;break t}Y=(0|kf[r>>2])+(G>>>5<<2)|0,kf[Y>>2]=kf[Y>>2]|1<<(31&G),kf[(0|kf[a>>2])+(kf[s>>2]<<2)>>2]=G,Y=G+1|0,Z=0==((Y>>>0)%3|0|0)?G+-2|0:Y;do if((0|Z)==-1)K=-1;else{if(Y=0|kf[(0|kf[b>>2])+(Z<<2)>>2],j=Y+1|0,(0|Y)==-1){K=-1;break}K=0==((j>>>0)%3|0|0)?Y+-2|0:j}while(0);if((0|K)==(0|N))break;G=K}while(0);t:do if(66==(0|W)){if(W=0,(0|N)==-1)break;if(G=(0==((N>>>0)%3|0|0)?2:-1)+N|0,(0|G)==-1)break;if(Z=0|kf[(0|kf[b>>2])+(G<<2)>>2],(0|Z)==-1)break;if(G=Z+(0==((Z>>>0)%3|0|0)?2:-1)|0,(0|G)==-1)break;if(!V)for(Z=G;;){if(j=(0|kf[r>>2])+(Z>>>5<<2)|0,kf[j>>2]=kf[j>>2]|1<<(31&Z),j=(0==((Z>>>0)%3|0|0)?2:-1)+Z|0,(0|j)==-1)break t;if(Y=0|kf[(0|kf[b>>2])+(j<<2)>>2],(0|Y)==-1)break t;if(Z=Y+(0==((Y>>>0)%3|0|0)?2:-1)|0,(0|Z)==-1)break t}Z=0|kf[e>>2],Y=G;do{if(j=(0|kf[r>>2])+(Y>>>5<<2)|0,kf[j>>2]=kf[j>>2]|1<<(31&Y),kf[Z+(Y<<2)>>2]=kf[s>>2],j=(0==((Y>>>0)%3|0|0)?2:-1)+Y|0,(0|j)==-1)break t;if(Q=0|kf[(0|kf[b>>2])+(j<<2)>>2],(0|Q)==-1)break t;Y=Q+(0==((Q>>>0)%3|0|0)?2:-1)|0}while((0|Y)!=-1)}while(0);J=z,q=F,$=U}if(I=I+1|0,(0|I)>=3){ee=J,te=q,ie=$;break}x=q,k=J,O=$}else ee=w,te=C,ie=P;if(M=M+1|0,S=0|kf[e>>2],M>>>0>=(((0|kf[d>>2])-S>>2>>>0)/3|0)>>>0){W=18;break}w=ee,C=te,P=ie}if(18==(0|W)){ne=ee,re=0|kf[c>>2];break}52==(0|W)&&Du(n)}else ne=_,re=p;else ne=_,re=p;while(0);p=e+44|0,kf[p>>2]=0,e=ne,ne=re>>>5,_=e+(ne<<2)|0,W=31&re,re=0!=(0|ne);e:do if(ne|W|0){if(!W)for(c=e,ee=0,ie=re;;){t:do if(ie)for(te=ee,d=0;;){if(kf[c>>2]&1<<d?se=te:($=te+1|0,kf[p>>2]=$,se=$),31==(0|d)){ae=se;break}te=se,d=d+1|0}else for(d=ee,te=0;;){if(kf[c>>2]&1<<te?oe=d:(F=d+1|0,kf[p>>2]=F,oe=F),31==(0|te)){ae=oe;break t}if(te=te+1|0,!te)break e;d=oe}while(0);if(c=c+4|0,(0|c)==(0|_))break e;ee=ae,ie=1}if(re)for(ie=e,ee=0,c=0;;){for(d=c,te=ee,F=0;;){if(kf[ie>>2]&1<<F?(he=te,le=d):(z=d+1|0,kf[p>>2]=z,he=z,le=z),31==(0|F))break;d=le,te=he,F=F+1|0}if(F=ie+4|0,(0|F)==(0|_)){ce=F,de=he;break}ie=F,ee=he,c=le}else ce=e,de=0;for(c=de,ee=0;;){if(kf[ce>>2]&1<<ee?ue=c:(ie=c+1|0,kf[p>>2]=ie,ue=ie),ee=ee+1|0,(0|ee)==(0|W))break;c=ue}}while(0);return ue=0|kf[r>>2],0|ue&&mf(ue),(ue=0|kf[n>>2])?(mf(ue),Xf=i,1):(Xf=i,1)}function Fi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=wp,E=0,T=0,S=0,w=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(c=0|If[l>>0],o=n+(h<<3)|0,kf[o>>2]=c,kf[o+4>>2]=((0|c)<0)<<31>>31,h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<3)|0,0,(i<<24>>24)-l<<3|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(u=n+(c<<3)|0,kf[u>>2]=Lf[o>>0],kf[u+4>>2]=0,c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<3)|0,0,(i<<24>>24)-o<<3|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(s=0|xf[u>>1],l=n+(a<<3)|0,kf[l>>2]=s,kf[l+4>>2]=((0|s)<0)<<31>>31,a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<3)|0,0,(i<<24>>24)-u<<3|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(l=n+(h<<3)|0,kf[l>>2]=Ff[s>>1],kf[l+4>>2]=0,h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<3)|0,0,(i<<24>>24)-s<<3|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(o=0|kf[l>>2],u=n+(c<<3)|0,kf[u>>2]=o,kf[u+4>>2]=((0|o)<0)<<31>>31,c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<3)|0,0,(i<<24>>24)-l<<3|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(u=n+(a<<3)|0,kf[u>>2]=kf[o>>2],kf[u+4>>2]=0,a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<3)|0,0,(i<<24>>24)-o<<3|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(s=u,l=0|kf[s+4>>2],v=n+(h<<3)|0,kf[v>>2]=kf[s>>2],kf[v+4>>2]=l,h=h+1|0,l=0|If[o>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}u=u+8|0}else y=a;return u=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<3)|0,0,(i<<24>>24)-u<<3|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,v=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=o+v|0;;){if(v=l,o=0|kf[v+4>>2],s=n+(c<<3)|0,kf[s>>2]=kf[v>>2],kf[s+4>>2]=o,c=c+1|0,o=0|If[u>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+8|0}else g=h;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<3)|0,0,(i<<24>>24)-l<<3|0),r=1,0|r);case 9:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=u+s|0;;){if(b=ap(Gf[o>>2]),s=+ep(+b)>=1?+b>0?~~+rp(+$f(+b/4294967296),4294967295)>>>0:~~+ip((+b-+(~~+b>>>0))/4294967296)>>>0:0,u=n+(a<<3)|0,kf[u>>2]=~~+b>>>0,kf[u+4>>2]=s,a=a+1|0,s=0|If[l>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}o=o+4|0}else E=c;return o=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<3)|0,0,(i<<24>>24)-o<<3|0),r=1,0|r);case 10:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=l+u|0;;){if(T=+zf[s>>3],u=+ep(T)>=1?T>0?~~+rp(+$f(T/4294967296),4294967295)>>>0:~~+ip((T-+(~~T>>>0))/4294967296)>>>0:0,l=n+(h<<3)|0,kf[l>>2]=~~T>>>0,kf[l+4>>2]=u,h=h+1|0,u=0|If[o>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){S=u;break}s=s+8|0}else S=a;return s=S<<24>>24,S<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<3)|0,0,(i<<24>>24)-s<<3|0),r=1,0|r);case 11:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=o+l|0;;){if(l=n+(c<<3)|0,kf[l>>2]=Lf[u>>0],kf[l+4>>2]=0,c=c+1|0,l=0|If[s>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){w=l;break}u=u+1|0}else w=h;return u=w<<24>>24,w<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<3)|0,0,(i<<24>>24)-u<<3|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function Bi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0;if(i=Xf,Xf=Xf+16|0,n=i+8|0,r=i,(0|kf[e+96>>2])==(0|kf[e+92>>2]))return Xf=i,1;if(s=e+56|0,a=0|kf[s>>2],(0|a)==(0|kf[e+60>>2])?(us(e+52|0,t),o=t):(kf[a>>2]=kf[t>>2],kf[s>>2]=a+4,o=t),t=e+88|0,kf[t>>2]=0,a=0|kf[e>>2],s=0|kf[o>>2],h=s+1|0,(0|s)!=-1?(l=0==((h>>>0)%3|0|0)?s+-2|0:h,c=(0|l)==-1?-1:0|kf[(0|kf[a>>2])+(l<<2)>>2],l=(0==((s>>>0)%3|0|0)?2:-1)+s|0,(0|l)==-1?(d=-1,u=c):(d=0|kf[(0|kf[a>>2])+(l<<2)>>2],u=c)):(d=-1,u=-1),c=e+24|0,l=0|kf[c>>2],a=l+(u>>>5<<2)|0,s=1<<(31&u),h=0|kf[a>>2],h&s?_=l:(kf[a>>2]=h|s,s=0|kf[o>>2],h=s+1|0,f=(0|s)==-1?-1:0==((h>>>0)%3|0|0)?s+-2|0:h,kf[r>>2]=f,h=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((f>>>0)/3|0)|0)+(((f>>>0)%3|0)<<2)>>2],f=0|kf[e+48>>2],kf[n>>2]=h,s=0|kf[f+4>>2],f=s+4|0,a=0|kf[f>>2],(0|a)==(0|kf[s+8>>2])?us(s,n):(kf[a>>2]=h,kf[f>>2]=a+4),a=e+40|0,f=0|kf[a>>2],h=f+4|0,s=0|kf[h>>2],(0|s)==(0|kf[f+8>>2])?(us(f,r),p=0|kf[a>>2]):(kf[s>>2]=kf[r>>2],kf[h>>2]=s+4,p=f),f=p+24|0,kf[(0|kf[p+12>>2])+(u<<2)>>2]=kf[f>>2],kf[f>>2]=(0|kf[f>>2])+1,_=0|kf[c>>2]),l=_+(d>>>5<<2)|0,_=1<<(31&d),f=0|kf[l>>2],!(f&_)){kf[l>>2]=f|_,_=0|kf[o>>2];do{if((0|_)!=-1){if((_>>>0)%3|0){m=_+-1|0;break}m=_+2|0;break}m=-1}while(0);kf[r>>2]=m,_=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((m>>>0)/3|0)|0)+(((m>>>0)%3|0)<<2)>>2],m=0|kf[e+48>>2],kf[n>>2]=_,f=0|kf[m+4>>2],m=f+4|0,l=0|kf[m>>2],(0|l)==(0|kf[f+8>>2])?us(f,n):(kf[l>>2]=_,kf[m>>2]=l+4),l=e+40|0,m=0|kf[l>>2],_=m+4|0,f=0|kf[_>>2],(0|f)==(0|kf[m+8>>2])?(us(m,r),A=0|kf[l>>2]):(kf[f>>2]=kf[r>>2],kf[_>>2]=f+4,A=m),m=A+24|0,kf[(0|kf[A+12>>2])+(d<<2)>>2]=kf[m>>2],kf[m>>2]=(0|kf[m>>2])+1}m=0|kf[o>>2],v=(0|m)==-1?-1:0|kf[(0|kf[kf[e>>2]>>2])+(m<<2)>>2],m=(0|kf[c>>2])+(v>>>5<<2)|0,d=1<<(31&v),A=0|kf[m>>2],d&A||(kf[m>>2]=A|d,d=0|kf[o>>2],kf[r>>2]=d,A=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((d>>>0)/3|0)|0)+(((d>>>0)%3|0)<<2)>>2],d=0|kf[e+48>>2],kf[n>>2]=A,m=0|kf[d+4>>2],d=m+4|0,f=0|kf[d>>2],(0|f)==(0|kf[m+8>>2])?us(m,n):(kf[f>>2]=A,kf[d>>2]=f+4),f=e+40|0,d=0|kf[f>>2],A=d+4|0,m=0|kf[A>>2],(0|m)==(0|kf[d+8>>2])?(us(d,r),y=0|kf[f>>2]):(kf[m>>2]=kf[r>>2],kf[A>>2]=m+4,y=d),d=y+24|0,kf[(0|kf[y+12>>2])+(v<<2)>>2]=kf[d>>2],kf[d>>2]=(0|kf[d>>2])+1),d=0|kf[t>>2];e:do if((0|d)<3){for(v=e+12|0,y=e+44|0,m=e+48|0,A=e+40|0,f=e+92|0,_=d;;){for(l=_;;){if(g=e+52+(12*l|0)+4|0,b=0|kf[g>>2],(0|kf[e+52+(12*l|0)>>2])!=(0|b))break;if(u=l+1|0,!((0|u)<3))break e;l=u}if(u=b+-4|0,p=0|kf[u>>2],kf[g>>2]=u,kf[t>>2]=l,kf[o>>2]=p,(0|p)==-1)break;u=(p>>>0)/3|0,s=0|kf[v>>2];do if(kf[s+(u>>>5<<2)>>2]&1<<(31&u))V=l;else{h=p,a=s;t:for(;;){if(E=(h>>>0)/3|0,T=a+(E>>>5<<2)|0,kf[T>>2]=1<<(31&E)|kf[T>>2],T=0|kf[o>>2],S=(0|T)==-1?-1:0|kf[(0|kf[kf[e>>2]>>2])+(T<<2)>>2],E=(0|kf[c>>2])+(S>>>5<<2)|0,w=1<<(31&S),C=0|kf[E>>2],w&C?I=T:(kf[E>>2]=C|w,w=0|kf[o>>2],kf[r>>2]=w,C=0|kf[(0|kf[(0|kf[y>>2])+96>>2])+(12*((w>>>0)/3|0)|0)+(((w>>>0)%3|0)<<2)>>2],w=0|kf[m>>2],kf[n>>2]=C,E=0|kf[w+4>>2],w=E+4|0,M=0|kf[w>>2],(0|M)==(0|kf[E+8>>2])?us(E,n):(kf[M>>2]=C,kf[w>>2]=M+4),M=0|kf[A>>2],w=M+4|0,C=0|kf[w>>2],(0|C)==(0|kf[M+8>>2])?(us(M,r),P=0|kf[A>>2]):(kf[C>>2]=kf[r>>2],kf[w>>2]=C+4,P=M),M=P+24|0,kf[(0|kf[P+12>>2])+(S<<2)>>2]=kf[M>>2],kf[M>>2]=(0|kf[M>>2])+1,I=0|kf[o>>2]),T=0|kf[e>>2],(0|I)==-1){R=93;break}M=I+1|0,C=0==((M>>>0)%3|0|0)?I+-2|0:M,x=(0|C)==-1?-1:0|kf[(0|kf[T+12>>2])+(C<<2)>>2],C=(0==((I>>>0)%3|0|0)?2:-1)+I|0,O=(0|C)==-1?-1:0|kf[(0|kf[T+12>>2])+(C<<2)>>2],C=(0|x)==-1,M=C?-1:(x>>>0)/3|0,w=(0|O)==-1,E=w?-1:(O>>>0)/3|0,k=C?1:0!=(kf[(0|kf[v>>2])+(M>>>5<<2)>>2]&1<<(31&M)|0);do if(w){if(k){R=93;break t}R=82}else{if(kf[(0|kf[v>>2])+(E>>>5<<2)>>2]&1<<(31&E)|0){if(k){R=93;break t}R=82;break}if(M=0|kf[(0|kf[T>>2])+(O<<2)>>2],1<<(31&M)&kf[(0|kf[c>>2])+(M>>>5<<2)>>2]?L=0:(D=(0|kf[f>>2])+(M<<2)|0,M=0|kf[D>>2],kf[D>>2]=M+1,L=(0|M)>0?1:2),k?(0|L)<=(0|kf[t>>2]):0){N=O;break}if(kf[n>>2]=O,M=e+52+(12*L|0)+4|0,D=0|kf[M>>2],(0|D)==(0|kf[e+52+(12*L|0)+8>>2])?us(e+52+(12*L|0)|0,n):(kf[D>>2]=O,kf[M>>2]=D+4),(0|kf[t>>2])>(0|L)&&(kf[t>>2]=L),k){R=93;break t}R=82}while(0);if(82==(0|R)){if(R=0,F=C?-1:0|kf[(0|kf[kf[e>>2]>>2])+(x<<2)>>2],1<<(31&F)&kf[(0|kf[c>>2])+(F>>>5<<2)>>2]?B=0:(T=(0|kf[f>>2])+(F<<2)|0,E=0|kf[T>>2],kf[T>>2]=E+1,B=(0|E)>0?1:2),(0|B)>(0|kf[t>>2]))break;N=x}kf[o>>2]=N,h=N,a=0|kf[v>>2]}if(93==(0|R)){R=0,V=0|kf[t>>2];break}kf[n>>2]=x,a=e+52+(12*B|0)+4|0,h=0|kf[a>>2],(0|h)==(0|kf[e+52+(12*B|0)+8>>2])?us(e+52+(12*B|0)|0,n):(kf[h>>2]=x,kf[a>>2]=h+4),h=0|kf[t>>2],(0|h)>(0|B)?(kf[t>>2]=B,U=B):U=h,V=U}while(0);if(!((0|V)<3))break e;_=V}return Xf=i,1}while(0);return kf[o>>2]=-1,Xf=i,1}function Vi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(xf[n+(h<<1)>>1]=0|If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(xf[n+(c<<1)>>1]=0|Lf[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(xf[n+(a<<1)>>1]=0|xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(xf[n+(h<<1)>>1]=0|xf[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<1)|0,0,(i<<24>>24)-s<<1|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(xf[n+(c<<1)>>1]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,
m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(xf[n+(a<<1)>>1]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(xf[n+(h<<1)>>1]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(xf[n+(c<<1)>>1]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<1)|0,0,(i<<24>>24)-s<<1|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=65535&~~ap(Gf[l>>2]),xf[n+(a<<1)>>1]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(xf[n+(h<<1)>>1]=~~+zf[o>>3],h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(xf[n+(c<<1)>>1]=0|Lf[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function Ui(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(xf[n+(h<<1)>>1]=0|If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(xf[n+(c<<1)>>1]=0|Lf[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(xf[n+(a<<1)>>1]=0|xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(xf[n+(h<<1)>>1]=0|xf[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<1)|0,0,(i<<24>>24)-s<<1|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(xf[n+(c<<1)>>1]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(xf[n+(a<<1)>>1]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(xf[n+(h<<1)>>1]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(xf[n+(c<<1)>>1]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<1)|0,0,(i<<24>>24)-s<<1|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=~~ap(Gf[l>>2]),xf[n+(a<<1)>>1]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<1)|0,0,(i<<24>>24)-l<<1|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(xf[n+(h<<1)>>1]=~~+zf[o>>3],h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<1)|0,0,(i<<24>>24)-o<<1|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(xf[n+(c<<1)>>1]=0|Lf[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<1)|0,0,(i<<24>>24)-u<<1|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function Gi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(kf[n+(h<<2)>>2]=If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(kf[n+(c<<2)>>2]=Lf[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(kf[n+(a<<2)>>2]=xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(kf[n+(h<<2)>>2]=Ff[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<2)|0,0,(i<<24>>24)-s<<2|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(kf[n+(c<<2)>>2]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(kf[n+(a<<2)>>2]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(kf[n+(h<<2)>>2]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(kf[n+(c<<2)>>2]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<2)|0,0,(i<<24>>24)-s<<2|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=~~ap(Gf[l>>2])>>>0,kf[n+(a<<2)>>2]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(kf[n+(h<<2)>>2]=~~+zf[o>>3]>>>0,h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(kf[n+(c<<2)>>2]=Lf[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function Wi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(kf[n+(h<<2)>>2]=If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(kf[n+(c<<2)>>2]=Lf[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(kf[n+(a<<2)>>2]=xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(kf[n+(h<<2)>>2]=Ff[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<2)|0,0,(i<<24>>24)-s<<2|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(kf[n+(c<<2)>>2]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(kf[n+(a<<2)>>2]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(kf[n+(h<<2)>>2]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(kf[n+(c<<2)>>2]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(s<<2)|0,0,(i<<24>>24)-s<<2|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=~~ap(Gf[l>>2]),kf[n+(a<<2)>>2]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(kf[n+(h<<2)>>2]=~~+zf[o>>3],h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(o<<2)|0,0,(i<<24>>24)-o<<2|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(kf[n+(c<<2)>>2]=Lf[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(u<<2)|0,0,(i<<24>>24)-u<<2|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function zi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0;if(i=Xf,Xf=Xf+16|0,n=i+8|0,r=i,s=0|kf[t>>2],(0|s)==-1)return a=1,Xf=i,0|a;if(o=(s>>>0)/3|0,h=e+12|0,kf[(0|kf[h>>2])+(o>>>5<<2)>>2]&1<<(31&o)|0)return a=1,Xf=i,0|a;o=e+56|0,l=0|kf[o>>2],c=e+60|0,d=0|kf[c>>2],(0|d)==(0|l)?u=l:(f=d+(~((d+-4-l|0)>>>2)<<2)|0,kf[c>>2]=f,u=f),f=e+64|0,(0|u)==(0|kf[f>>2])?us(o,t):(kf[u>>2]=s,kf[c>>2]=u+4),u=0|kf[e>>2],s=0|kf[t>>2],l=s+1|0;do{if((0|s)!=-1){if(d=0|kf[u+28>>2],p=0|kf[d+((0==((l>>>0)%3|0|0)?s+-2|0:l)<<2)>>2],(s>>>0)%3|0){_=d,m=p,A=s+-1|0;break}_=d,m=p,A=s+2|0;break}p=0|kf[u+28>>2],_=p,m=0|kf[p+-4>>2],A=-1}while(0);if(u=0|kf[_+(A<<2)>>2],(0|m)==-1|(0|u)==-1)return a=0,Xf=i,0|a;if(A=e+24|0,_=0|kf[A>>2],s=_+(m>>>5<<2)|0,l=1<<(31&m),p=0|kf[s>>2],p&l?g=_:(kf[s>>2]=p|l,l=0|kf[t>>2],p=l+1|0,v=(0|l)==-1?-1:0==((p>>>0)%3|0|0)?l+-2|0:p,kf[r>>2]=v,p=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((v>>>0)/3|0)|0)+(((v>>>0)%3|0)<<2)>>2],v=0|kf[e+48>>2],kf[n>>2]=p,l=0|kf[v+4>>2],v=l+4|0,s=0|kf[v>>2],(0|s)==(0|kf[l+8>>2])?us(l,n):(kf[s>>2]=p,kf[v>>2]=s+4),s=e+40|0,v=0|kf[s>>2],p=v+4|0,l=0|kf[p>>2],(0|l)==(0|kf[v+8>>2])?(us(v,r),y=0|kf[s>>2]):(kf[l>>2]=kf[r>>2],kf[p>>2]=l+4,y=v),v=y+24|0,kf[(0|kf[y+12>>2])+(m<<2)>>2]=kf[v>>2],kf[v>>2]=(0|kf[v>>2])+1,g=0|kf[A>>2]),_=g+(u>>>5<<2)|0,g=1<<(31&u),v=0|kf[_>>2],!(v&g)){kf[_>>2]=v|g,g=0|kf[t>>2];do{if((0|g)!=-1){if((g>>>0)%3|0){b=g+-1|0;break}b=g+2|0;break}b=-1}while(0);kf[r>>2]=b,g=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((b>>>0)/3|0)|0)+(((b>>>0)%3|0)<<2)>>2],b=0|kf[e+48>>2],kf[n>>2]=g,v=0|kf[b+4>>2],b=v+4|0,_=0|kf[b>>2],(0|_)==(0|kf[v+8>>2])?us(v,n):(kf[_>>2]=g,kf[b>>2]=_+4),_=e+40|0,b=0|kf[_>>2],g=b+4|0,v=0|kf[g>>2],(0|v)==(0|kf[b+8>>2])?(us(b,r),E=0|kf[_>>2]):(kf[v>>2]=kf[r>>2],kf[g>>2]=v+4,E=b),b=E+24|0,kf[(0|kf[E+12>>2])+(u<<2)>>2]=kf[b>>2],kf[b>>2]=(0|kf[b>>2])+1}if(b=0|kf[o>>2],u=0|kf[c>>2],(0|b)==(0|u))return a=1,Xf=i,0|a;E=e+44|0,v=e+48|0,g=e+40|0,_=b,b=u;e:for(;;){if(u=0|kf[b+-4>>2],kf[t>>2]=u,m=(u>>>0)/3|0,(0|u)!=-1?(u=(0|kf[h>>2])+(m>>>5<<2)|0,y=1<<(31&m),m=0|kf[u>>2],0==(m&y|0)):0){if(kf[u>>2]=m|y,y=0|kf[e>>2],m=0|kf[t>>2],u=0|kf[(0|kf[y+28>>2])+(m<<2)>>2],(0|u)==-1){a=0,T=79;break}S=m,w=y,C=u;t:for(;;){u=(0|kf[A>>2])+(C>>>5<<2)|0,y=1<<(31&C),m=0|kf[u>>2];do if(m&y)I=S,R=w,T=59;else{if(l=0|kf[(0|kf[w+40>>2])+(C<<2)>>2],(0|l)==-1?M=1:(p=0|kf[(0|kf[kf[w+64>>2]>>2])+(l<<2)>>2],M=0!=(1<<(31&p)&kf[(0|kf[w+12>>2])+(p>>>5<<2)>>2]|0)),kf[u>>2]=m|y,p=0|kf[t>>2],kf[r>>2]=p,l=0|kf[(0|kf[(0|kf[E>>2])+96>>2])+(12*((p>>>0)/3|0)|0)+(((p>>>0)%3|0)<<2)>>2],p=0|kf[v>>2],kf[n>>2]=l,s=0|kf[p+4>>2],p=s+4|0,d=0|kf[p>>2],(0|d)==(0|kf[s+8>>2])?us(s,n):(kf[d>>2]=l,kf[p>>2]=d+4),d=0|kf[g>>2],p=d+4|0,l=0|kf[p>>2],(0|l)==(0|kf[d+8>>2])?(us(d,r),P=0|kf[g>>2]):(kf[l>>2]=kf[r>>2],kf[p>>2]=l+4,P=d),d=P+24|0,kf[(0|kf[P+12>>2])+(C<<2)>>2]=kf[d>>2],kf[d>>2]=(0|kf[d>>2])+1,d=0|kf[e>>2],l=0|kf[t>>2],M){I=l,R=d,T=59;break}p=l+1|0;do if((0|l)==-1)x=-1;else{if(s=0==((p>>>0)%3|0|0)?l+-2|0:p,(0|s)==-1){x=-1;break}if(kf[(0|kf[d>>2])+(s>>>5<<2)>>2]&1<<(31&s)|0){x=-1;break}x=0|kf[(0|kf[(0|kf[d+64>>2])+12>>2])+(s<<2)>>2]}while(0);kf[t>>2]=x,O=d,k=(x>>>0)/3|0}while(0);if(59==(0|T)){if(T=0,y=I+1|0,(0|I)==-1){T=63;break}m=0==((y>>>0)%3|0|0)?I+-2|0:y;do if((0|m)==-1)D=-1;else{if(kf[(0|kf[R>>2])+(m>>>5<<2)>>2]&1<<(31&m)|0){D=-1;break}D=0|kf[(0|kf[(0|kf[R+64>>2])+12>>2])+(m<<2)>>2]}while(0);kf[n>>2]=D,m=(0==((I>>>0)%3|0|0)?2:-1)+I|0;do if((0|m)==-1)L=-1;else{if(kf[(0|kf[R>>2])+(m>>>5<<2)>>2]&1<<(31&m)|0){L=-1;break}L=0|kf[(0|kf[(0|kf[R+64>>2])+12>>2])+(m<<2)>>2]}while(0);m=(0|D)==-1,y=(D>>>0)/3|0,u=m?-1:y,p=(0|L)==-1,l=(L>>>0)/3|0,s=p?-1:l;do if(m)T=69;else{if(N=0|kf[h>>2],kf[N+(u>>>5<<2)>>2]&1<<(31&u)|0){T=69;break}if(p){F=D,B=y;break}if(!(kf[N+(s>>>5<<2)>>2]&1<<(31&s))){T=74;break t}F=D,B=y}while(0);if(69==(0|T)){if(T=0,p){T=71;break}if(kf[(0|kf[h>>2])+(s>>>5<<2)>>2]&1<<(31&s)){T=71;break}F=L,B=l}kf[t>>2]=F,O=R,k=B}if(y=(0|kf[h>>2])+(k>>>5<<2)|0,kf[y>>2]=kf[y>>2]|1<<(31&k),S=0|kf[t>>2],C=0|kf[(0|kf[O+28>>2])+(S<<2)>>2],(0|C)==-1){a=0,T=79;break e}w=O}do if(63==(0|T))T=0,kf[n>>2]=-1,T=71;else if(74==(0|T)){if(T=0,y=0|kf[c>>2],kf[y+-4>>2]=L,(0|y)==(0|kf[f>>2])){us(o,n),V=0|kf[c>>2];break}kf[y>>2]=kf[n>>2],u=y+4|0,kf[c>>2]=u,V=u;break}while(0);71==(0|T)&&(T=0,u=(0|kf[c>>2])+-4|0,kf[c>>2]=u,V=u),U=0|kf[o>>2],G=V}else u=b+-4|0,kf[c>>2]=u,U=_,G=u;if((0|U)==(0|G)){a=1,T=79;break}_=U,b=G}return 79==(0|T)?(Xf=i,0|a):0}function Hi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(If[n+h>>0]=0|If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(If[n+c>>0]=0|If[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(If[n+a>>0]=xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(If[n+h>>0]=xf[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+s|0,0,(i<<24>>24)-s|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(If[n+c>>0]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(If[n+a>>0]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(If[n+h>>0]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(If[n+c>>0]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+s|0,0,(i<<24>>24)-s|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=255&~~ap(Gf[l>>2]),If[n+a>>0]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(If[n+h>>0]=~~+zf[o>>3],h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(If[n+c>>0]=0|If[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function ji(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,l=o+c|0;;){if(If[n+h>>0]=0|If[l>>0],h=h+1|0,c=0|If[s>>0],(0|h)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){d=c;break}l=l+1|0}else d=a;return l=d<<24>>24,d<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 2:if(l=e+24|0,h=0|If[l>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],c=e+40|0,o=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,u=0|tc(0|o,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,o=s+u|0;;){if(If[n+c>>0]=0|If[o>>0],c=c+1|0,u=0|If[l>>0],(0|c)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){f=u;break}o=o+1|0}else f=h;return o=f<<24>>24,f<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 3:if(o=e+24|0,c=0|If[o>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],a=e+40|0,u=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,s=0|tc(0|u,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,u=l+s|0;;){if(If[n+a>>0]=xf[u>>1],a=a+1|0,s=0|If[o>>0],(0|a)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){p=s;break}u=u+2|0}else p=c;return u=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);case 4:if(u=e+24|0,a=0|If[u>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],h=e+40|0,s=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|s,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,s=o+l|0;;){if(If[n+h>>0]=xf[s>>1],h=h+1|0,l=0|If[u>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}s=s+2|0}else _=a;return s=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+s|0,0,(i<<24>>24)-s|0),r=1,0|r);case 5:if(s=e+24|0,h=0|If[s>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],c=e+40|0,l=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,o=0|tc(0|l,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,l=u+o|0;;){if(If[n+c>>0]=kf[l>>2],c=c+1|0,o=0|If[s>>0],(0|c)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){m=o;break}l=l+4|0}else m=h;return l=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 6:if(l=e+24|0,c=0|If[l>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],a=e+40|0,o=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,u=0|tc(0|o,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,o=s+u|0;;){if(If[n+a>>0]=kf[o>>2],a=a+1|0,u=0|If[l>>0],(0|a)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){A=u;break}o=o+4|0}else A=c;return o=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 7:if(o=e+24|0,a=0|If[o>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],h=e+40|0,u=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,s=0|tc(0|u,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,u=l+s|0;;){if(If[n+h>>0]=kf[u>>2],h=h+1|0,s=0|If[o>>0],(0|h)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){v=s;break}u=u+8|0}else v=a;return u=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);case 8:if(u=e+24|0,h=0|If[u>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(o=0|kf[kf[e>>2]>>2],c=e+40|0,s=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,l=0|tc(0|s,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,s=o+l|0;;){if(If[n+c>>0]=kf[s>>2],c=c+1|0,l=0|If[u>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}s=s+8|0}else y=h;return s=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+s|0,0,(i<<24>>24)-s|0),r=1,0|r);case 9:if(s=e+24|0,c=0|If[s>>0],(c<<24>>24>i<<24>>24?i:c)<<24>>24>0)for(u=0|kf[kf[e>>2]>>2],a=e+40|0,l=0|pl(0|kf[a>>2],0|kf[a+4>>2],0|kf[t>>2],0),a=e+48|0,o=0|tc(0|l,0|qf,0|kf[a>>2],0|kf[a+4>>2]),a=0,l=u+o|0;;){if(o=~~ap(Gf[l>>2]),If[n+a>>0]=o,a=a+1|0,o=0|If[s>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){g=o;break}l=l+4|0}else g=c;return l=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+l|0,0,(i<<24>>24)-l|0),r=1,0|r);case 10:if(l=e+24|0,a=0|If[l>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)for(s=0|kf[kf[e>>2]>>2],h=e+40|0,o=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,u=0|tc(0|o,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,o=s+u|0;;){if(If[n+h>>0]=~~+zf[o>>3],h=h+1|0,u=0|If[l>>0],(0|h)>=((u<<24>>24>i<<24>>24?i:u)<<24>>24|0)){b=u;break}o=o+8|0}else b=a;return o=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+o|0,0,(i<<24>>24)-o|0),r=1,0|r);case 11:if(o=e+24|0,h=0|If[o>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(l=0|kf[kf[e>>2]>>2],c=e+40|0,u=0|pl(0|kf[c>>2],0|kf[c+4>>2],0|kf[t>>2],0),c=e+48|0,s=0|tc(0|u,0|qf,0|kf[c>>2],0|kf[c+4>>2]),c=0,u=l+s|0;;){if(If[n+c>>0]=0|If[u>>0],c=c+1|0,s=0|If[o>>0],(0|c)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){E=s;break}u=u+1|0}else E=h;return u=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+u|0,0,(i<<24>>24)-u|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function Yi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0;
if(i=Xf,Xf=Xf+16|0,n=i+8|0,r=i,s=0|kf[t>>2],(0|s)==-1)return a=1,Xf=i,0|a;if(o=(s>>>0)/3|0,h=e+12|0,kf[(0|kf[h>>2])+(o>>>5<<2)>>2]&1<<(31&o)|0)return a=1,Xf=i,0|a;if(o=e+56|0,l=0|kf[o>>2],c=e+60|0,d=0|kf[c>>2],(0|d)==(0|l)?u=l:(f=d+(~((d+-4-l|0)>>>2)<<2)|0,kf[c>>2]=f,u=f),f=e+64|0,(0|u)==(0|kf[f>>2])?us(o,t):(kf[u>>2]=s,kf[c>>2]=u+4),u=0|kf[e>>2],s=0|kf[t>>2],l=s+1|0,(0|s)==-1)return a=0,Xf=i,0|a;if(d=0==((l>>>0)%3|0|0)?s+-2|0:l,p=(0|d)==-1?-1:0|kf[(0|kf[u>>2])+(d<<2)>>2],d=(0==((s>>>0)%3|0|0)?2:-1)+s|0,(0|d)==-1)return a=0,Xf=i,0|a;if(s=0|kf[(0|kf[u>>2])+(d<<2)>>2],(0|p)==-1|(0|s)==-1)return a=0,Xf=i,0|a;if(d=e+24|0,u=0|kf[d>>2],l=u+(p>>>5<<2)|0,_=1<<(31&p),m=0|kf[l>>2],m&_?y=u:(kf[l>>2]=m|_,_=0|kf[t>>2],m=_+1|0,A=(0|_)==-1?-1:0==((m>>>0)%3|0|0)?_+-2|0:m,kf[r>>2]=A,m=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((A>>>0)/3|0)|0)+(((A>>>0)%3|0)<<2)>>2],A=0|kf[e+48>>2],kf[n>>2]=m,_=0|kf[A+4>>2],A=_+4|0,l=0|kf[A>>2],(0|l)==(0|kf[_+8>>2])?us(_,n):(kf[l>>2]=m,kf[A>>2]=l+4),l=e+40|0,A=0|kf[l>>2],m=A+4|0,_=0|kf[m>>2],(0|_)==(0|kf[A+8>>2])?(us(A,r),v=0|kf[l>>2]):(kf[_>>2]=kf[r>>2],kf[m>>2]=_+4,v=A),A=v+24|0,kf[(0|kf[v+12>>2])+(p<<2)>>2]=kf[A>>2],kf[A>>2]=(0|kf[A>>2])+1,y=0|kf[d>>2]),u=y+(s>>>5<<2)|0,y=1<<(31&s),A=0|kf[u>>2],!(A&y)){kf[u>>2]=A|y,y=0|kf[t>>2];do{if((0|y)!=-1){if((y>>>0)%3|0){g=y+-1|0;break}g=y+2|0;break}g=-1}while(0);kf[r>>2]=g,y=0|kf[(0|kf[(0|kf[e+44>>2])+96>>2])+(12*((g>>>0)/3|0)|0)+(((g>>>0)%3|0)<<2)>>2],g=0|kf[e+48>>2],kf[n>>2]=y,A=0|kf[g+4>>2],g=A+4|0,u=0|kf[g>>2],(0|u)==(0|kf[A+8>>2])?us(A,n):(kf[u>>2]=y,kf[g>>2]=u+4),u=e+40|0,g=0|kf[u>>2],y=g+4|0,A=0|kf[y>>2],(0|A)==(0|kf[g+8>>2])?(us(g,r),b=0|kf[u>>2]):(kf[A>>2]=kf[r>>2],kf[y>>2]=A+4,b=g),g=b+24|0,kf[(0|kf[b+12>>2])+(s<<2)>>2]=kf[g>>2],kf[g>>2]=(0|kf[g>>2])+1}if(g=0|kf[o>>2],s=0|kf[c>>2],(0|g)==(0|s))return a=1,Xf=i,0|a;b=e+44|0,A=e+48|0,y=e+40|0,u=s,s=g;e:for(;;){if(g=0|kf[u+-4>>2],kf[t>>2]=g,p=(g>>>0)/3|0,(0|g)!=-1?(g=(0|kf[h>>2])+(p>>>5<<2)|0,v=1<<(31&p),p=0|kf[g>>2],0==(p&v|0)):0){if(kf[g>>2]=p|v,v=0|kf[t>>2],(0|v)==-1){a=0,E=80;break}p=0|kf[e>>2],g=v;t:for(;;){if(v=0|kf[(0|kf[p>>2])+(g<<2)>>2],(0|v)==-1){a=0,E=80;break e}_=(0|kf[d>>2])+(v>>>5<<2)|0,m=1<<(31&v),l=0|kf[_>>2];do if(l&m)I=g,R=p,E=64;else{T=0|kf[(0|kf[p+24>>2])+(v<<2)>>2],S=T+1|0;do if((0|T)==-1)w=1;else{if(C=0==((S>>>0)%3|0|0)?T+-2|0:S,(0|C)==-1){w=1;break}if(M=0|kf[(0|kf[p+12>>2])+(C<<2)>>2],C=M+1|0,(0|M)==-1){w=1;break}w=(0|(0==((C>>>0)%3|0|0)?M+-2|0:C))==-1}while(0);if(kf[_>>2]=l|m,S=0|kf[t>>2],kf[r>>2]=S,T=0|kf[(0|kf[(0|kf[b>>2])+96>>2])+(12*((S>>>0)/3|0)|0)+(((S>>>0)%3|0)<<2)>>2],S=0|kf[A>>2],kf[n>>2]=T,C=0|kf[S+4>>2],S=C+4|0,M=0|kf[S>>2],(0|M)==(0|kf[C+8>>2])?us(C,n):(kf[M>>2]=T,kf[S>>2]=M+4),M=0|kf[y>>2],S=M+4|0,T=0|kf[S>>2],(0|T)==(0|kf[M+8>>2])?(us(M,r),P=0|kf[y>>2]):(kf[T>>2]=kf[r>>2],kf[S>>2]=T+4,P=M),M=P+24|0,kf[(0|kf[P+12>>2])+(v<<2)>>2]=kf[M>>2],kf[M>>2]=(0|kf[M>>2])+1,M=0|kf[e>>2],T=0|kf[t>>2],w){if((0|T)==-1){E=63;break t}I=T,R=M,E=64;break}do if((0|T)==-1)x=-1;else{if(S=T+1|0,C=0==((S>>>0)%3|0|0)?T+-2|0:S,(0|C)==-1){x=-1;break}x=0|kf[(0|kf[M+12>>2])+(C<<2)>>2]}while(0);kf[t>>2]=x,O=M,k=(x>>>0)/3|0}while(0);if(64==(0|E)){E=0,v=I+1|0,m=0==((v>>>0)%3|0|0)?I+-2|0:v,D=(0|m)==-1?-1:0|kf[(0|kf[R+12>>2])+(m<<2)>>2],kf[n>>2]=D,m=(0==((I>>>0)%3|0|0)?2:-1)+I|0,L=(0|m)==-1?-1:0|kf[(0|kf[R+12>>2])+(m<<2)>>2],m=(0|D)==-1,v=(D>>>0)/3|0,l=m?-1:v,_=(0|L)==-1,T=(L>>>0)/3|0,C=_?-1:T;do if(m)E=70;else{if(S=0|kf[h>>2],kf[S+(l>>>5<<2)>>2]&1<<(31&l)|0){E=70;break}if(_){N=D,F=v;break}if(!(kf[S+(C>>>5<<2)>>2]&1<<(31&C))){E=75;break t}N=D,F=v}while(0);if(70==(0|E)){if(E=0,_){E=72;break}if(kf[(0|kf[h>>2])+(C>>>5<<2)>>2]&1<<(31&C)){E=72;break}N=L,F=T}kf[t>>2]=N,O=R,k=F}if(v=(0|kf[h>>2])+(k>>>5<<2)|0,kf[v>>2]=kf[v>>2]|1<<(31&k),g=0|kf[t>>2],(0|g)==-1){a=0,E=80;break e}p=O}do if(63==(0|E))E=0,kf[n>>2]=-1,E=72;else if(75==(0|E)){if(E=0,p=0|kf[c>>2],kf[p+-4>>2]=L,(0|p)==(0|kf[f>>2])){us(o,n),B=0|kf[c>>2];break}kf[p>>2]=kf[n>>2],g=p+4|0,kf[c>>2]=g,B=g;break}while(0);72==(0|E)&&(E=0,g=(0|kf[c>>2])+-4|0,kf[c>>2]=g,B=g),V=0|kf[o>>2],U=B}else g=u+-4|0,kf[c>>2]=g,V=s,U=g;if((0|V)==(0|U)){a=1,E=80;break}u=U,s=V}return 80==(0|E)?(Xf=i,0|a):0}function Xi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0;r=Xf,Xf=Xf+80|0,s=r+76|0,a=r+72|0,o=r+48|0,h=r+24|0,l=r,c=e+32|0,d=0|kf[t>>2],t=d+1|0,(0|d)!=-1?(u=0==((t>>>0)%3|0|0)?d+-2|0:t,t=(0==((d>>>0)%3|0|0)?2:-1)+d|0,f=(0|u)==-1?-1:0|kf[(0|kf[kf[c>>2]>>2])+(u<<2)>>2],(0|t)==-1?(p=f,_=-1):(p=f,_=0|kf[(0|kf[kf[c>>2]>>2])+(t<<2)>>2])):(p=-1,_=-1),t=0|kf[e+36>>2],c=0|kf[t>>2],f=(0|kf[t+4>>2])-c>>2,f>>>0<=p>>>0&&Du(t),u=c,c=0|kf[u+(p<<2)>>2],f>>>0<=_>>>0&&Du(t),t=0|kf[u+(_<<2)>>2],_=(0|c)<(0|n);do if(_&(0|t)<(0|n)){if(u=c<<1,f=0|kf[i+(u<<2)>>2],p=((0|f)<0)<<31>>31,d=0|kf[i+((1|u)<<2)>>2],u=((0|d)<0)<<31>>31,m=t<<1,A=0|kf[i+(m<<2)>>2],v=0|kf[i+((1|m)<<2)>>2],!((0|A)!=(0|f)|(0|v)!=(0|d)))return kf[e+8>>2]=f,kf[e+12>>2]=d,y=1,Xf=r,0|y;if(m=e+4|0,g=0|kf[(0|kf[m>>2])+(n<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,kf[o+12>>2]=0,kf[o+16>>2]=0,kf[o+20>>2]=0,b=0|kf[e>>2],E=0|If[b+84>>0]?g:0|kf[(0|kf[b+68>>2])+(g<<2)>>2],kf[a>>2]=E,g=0|If[b+24>>0],kf[s>>2]=kf[a>>2],0|Fi(b,s,g,o),g=0|kf[(0|kf[m>>2])+(c<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,kf[h+12>>2]=0,kf[h+16>>2]=0,kf[h+20>>2]=0,b=0|kf[e>>2],T=0|If[b+84>>0]?g:0|kf[(0|kf[b+68>>2])+(g<<2)>>2],kf[a>>2]=T,g=0|If[b+24>>0],kf[s>>2]=kf[a>>2],0|Fi(b,s,g,h),g=0|kf[(0|kf[m>>2])+(t<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,kf[l+12>>2]=0,kf[l+16>>2]=0,kf[l+20>>2]=0,m=0|kf[e>>2],S=0|If[m+84>>0]?g:0|kf[(0|kf[m+68>>2])+(g<<2)>>2],kf[a>>2]=S,g=0|If[m+24>>0],kf[s>>2]=kf[a>>2],0|Fi(m,s,g,l),g=l,m=h,b=0|kf[m>>2],w=0|kf[m+4>>2],m=0|nc(0|kf[g>>2],0|kf[g+4>>2],0|b,0|w),g=qf,C=l+8|0,M=h+8|0,P=0|kf[M>>2],I=0|kf[M+4>>2],M=0|nc(0|kf[C>>2],0|kf[C+4>>2],0|P,0|I),C=qf,R=l+16|0,x=h+16|0,O=0|kf[x>>2],k=0|kf[x+4>>2],x=0|nc(0|kf[R>>2],0|kf[R+4>>2],0|O,0|k),R=qf,D=0|pl(0|m,0|g,0|m,0|g),L=qf,N=0|pl(0|M,0|C,0|M,0|C),F=0|tc(0|N,0|qf,0|D,0|L),L=qf,D=0|pl(0|x,0|R,0|x,0|R),N=0|tc(0|F,0|L,0|D,0|qf),D=qf,0==(0|N)&0==(0|D))break;switch(L=o,F=0|nc(0|kf[L>>2],0|kf[L+4>>2],0|b,0|w),w=qf,b=o+8|0,L=0|nc(0|kf[b>>2],0|kf[b+4>>2],0|P,0|I),I=qf,P=o+16|0,b=0|nc(0|kf[P>>2],0|kf[P+4>>2],0|O,0|k),k=qf,O=0|pl(0|F,0|w,0|m,0|g),P=qf,B=0|pl(0|L,0|I,0|M,0|C),V=0|tc(0|B,0|qf,0|O,0|P),P=qf,O=0|pl(0|b,0|k,0|x,0|R),B=0|tc(0|V,0|P,0|O,0|qf),O=qf,P=0|nc(0|A,((0|A)<0)<<31>>31|0,0|f,0|p),A=qf,V=0|nc(0|v,((0|v)<0)<<31>>31|0,0|d,0|u),v=qf,U=0|pl(0|N,0|D,0|f,0|p),p=qf,f=0|pl(0|N,0|D,0|d,0|u),u=qf,d=0|pl(0|B,0|O,0|P,0|A),G=qf,W=0|pl(0|B,0|O,0|V,0|v),z=qf,H=0|tc(0|d,0|G,0|U,0|p),p=qf,U=0|tc(0|W,0|z,0|f,0|u),u=qf,f=0|pl(0|B,0|O,0|m,0|g),g=qf,m=0|pl(0|B,0|O,0|M,0|C),C=qf,M=0|pl(0|B,0|O,0|x,0|R),R=qf,x=0|Ya(0|f,0|g,0|N,0|D),g=qf,f=0|Ya(0|m,0|C,0|N,0|D),C=qf,m=0|Ya(0|M,0|R,0|N,0|D),R=qf,M=0|nc(0|F,0|w,0|x,0|g),g=qf,x=0|nc(0|L,0|I,0|f,0|C),C=qf,f=0|nc(0|b,0|k,0|m,0|R),R=qf,m=0|pl(0|M,0|g,0|M,0|g),g=qf,M=0|pl(0|x,0|C,0|x,0|C),C=0|tc(0|M,0|qf,0|m,0|g),g=qf,m=0|pl(0|f,0|R,0|f,0|R),R=0|tc(0|C,0|g,0|m,0|qf),m=qf,g=0|nc(0,0,0|P,0|A),A=qf,P=0|pl(0|R,0|m,0|N,0|D),m=qf,0|P){case 0:m?(X=1,Z=0,K=P,Q=m,J=23):(j=0,Y=0);break;case 1:m?(X=1,Z=0,K=P,Q=m,J=23):(q=1,$=0,J=24);break;default:X=1,Z=0,K=P,Q=m,J=23}if(23==(0|J))for(;;){if(J=0,R=0|ql(0|X,0|Z,1),C=qf,f=K,K=0|rc(0|K,0|Q,2),!(Q>>>0>0|0==(0|Q)&f>>>0>7)){q=R,$=C,J=24;break}X=R,Z=C,Q=qf,J=23}if(24==(0|J))for(;;){if(J=0,C=0|Yd(0|P,0|m,0|q,0|$),R=0|tc(0|C,0|qf,0|q,0|$),C=0|rc(0|R,0|qf,1),R=qf,f=0|pl(0|C,0|R,0|C,0|R),M=qf,!(M>>>0>m>>>0|(0|M)==(0|m)&f>>>0>P>>>0)){j=C,Y=R;break}q=C,$=R,J=24}return P=0|pl(0|j,0|Y,0|V,0|v),m=qf,R=0|pl(0|j,0|Y,0|g,0|A),C=qf,f=e+20|0,M=0|kf[f>>2],M?(x=M+-1|0,M=0!=(kf[(0|kf[e+16>>2])+(x>>>5<<2)>>2]&1<<(31&x)|0),kf[f>>2]=x,x=0|nc(0,0,0|P,0|m),f=0|tc(0|H,0|p,0|(M?P:x),0|(M?m:qf)),m=qf,x=0|nc(0,0,0|R,0|C),P=0|tc(0|U,0|u,0|(M?R:x),0|(M?C:qf)),C=qf,M=0|Ya(0|f,0|m,0|N,0|D),m=0|Ya(0|P,0|C,0|N,0|D),kf[e+8>>2]=M,kf[e+12>>2]=m,ee=1):ee=0,y=ee,Xf=r,0|y}while(0);do{if(!_){if((0|n)>0){te=(n<<1)+-2|0;break}return ee=e+8|0,kf[ee>>2]=0,kf[ee+4>>2]=0,y=1,Xf=r,0|y}te=c<<1}while(0);return kf[e+8>>2]=kf[i+(te<<2)>>2],kf[e+12>>2]=kf[i+(te+1<<2)>>2],y=1,Xf=r,0|y}function Zi(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0;r=Xf,Xf=Xf+80|0,s=r+76|0,a=r+72|0,o=r+48|0,h=r+24|0,l=r,c=e+32|0,d=0|kf[t>>2],t=d+1|0;do{if((0|d)!=-1){if(u=0==((t>>>0)%3|0|0)?d+-2|0:t,(d>>>0)%3|0){f=u,p=d+-1|0;break}f=u,p=d+2|0;break}f=-1,p=-1}while(0);d=0|kf[(0|kf[c>>2])+28>>2],c=0|kf[d+(f<<2)>>2],f=0|kf[d+(p<<2)>>2],p=0|kf[e+36>>2],d=0|kf[p>>2],t=(0|kf[p+4>>2])-d>>2,t>>>0<=c>>>0&&Du(p),u=d,d=0|kf[u+(c<<2)>>2],t>>>0<=f>>>0&&Du(p),p=0|kf[u+(f<<2)>>2],f=(0|d)<(0|n);do if(f&(0|p)<(0|n)){if(u=d<<1,t=0|kf[i+(u<<2)>>2],c=((0|t)<0)<<31>>31,_=0|kf[i+((1|u)<<2)>>2],u=((0|_)<0)<<31>>31,m=p<<1,A=0|kf[i+(m<<2)>>2],v=0|kf[i+((1|m)<<2)>>2],!((0|A)!=(0|t)|(0|v)!=(0|_)))return kf[e+8>>2]=t,kf[e+12>>2]=_,y=1,Xf=r,0|y;if(m=e+4|0,g=0|kf[(0|kf[m>>2])+(n<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,kf[o+12>>2]=0,kf[o+16>>2]=0,kf[o+20>>2]=0,b=0|kf[e>>2],E=0|If[b+84>>0]?g:0|kf[(0|kf[b+68>>2])+(g<<2)>>2],kf[a>>2]=E,g=0|If[b+24>>0],kf[s>>2]=kf[a>>2],0|Fi(b,s,g,o),g=0|kf[(0|kf[m>>2])+(d<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,kf[h+12>>2]=0,kf[h+16>>2]=0,kf[h+20>>2]=0,b=0|kf[e>>2],T=0|If[b+84>>0]?g:0|kf[(0|kf[b+68>>2])+(g<<2)>>2],kf[a>>2]=T,g=0|If[b+24>>0],kf[s>>2]=kf[a>>2],0|Fi(b,s,g,h),g=0|kf[(0|kf[m>>2])+(p<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,kf[l+12>>2]=0,kf[l+16>>2]=0,kf[l+20>>2]=0,m=0|kf[e>>2],S=0|If[m+84>>0]?g:0|kf[(0|kf[m+68>>2])+(g<<2)>>2],kf[a>>2]=S,g=0|If[m+24>>0],kf[s>>2]=kf[a>>2],0|Fi(m,s,g,l),g=l,m=h,b=0|kf[m>>2],w=0|kf[m+4>>2],m=0|nc(0|kf[g>>2],0|kf[g+4>>2],0|b,0|w),g=qf,C=l+8|0,M=h+8|0,P=0|kf[M>>2],I=0|kf[M+4>>2],M=0|nc(0|kf[C>>2],0|kf[C+4>>2],0|P,0|I),C=qf,R=l+16|0,x=h+16|0,O=0|kf[x>>2],k=0|kf[x+4>>2],x=0|nc(0|kf[R>>2],0|kf[R+4>>2],0|O,0|k),R=qf,D=0|pl(0|m,0|g,0|m,0|g),L=qf,N=0|pl(0|M,0|C,0|M,0|C),F=0|tc(0|N,0|qf,0|D,0|L),L=qf,D=0|pl(0|x,0|R,0|x,0|R),N=0|tc(0|F,0|L,0|D,0|qf),D=qf,0==(0|N)&0==(0|D))break;switch(L=o,F=0|nc(0|kf[L>>2],0|kf[L+4>>2],0|b,0|w),w=qf,b=o+8|0,L=0|nc(0|kf[b>>2],0|kf[b+4>>2],0|P,0|I),I=qf,P=o+16|0,b=0|nc(0|kf[P>>2],0|kf[P+4>>2],0|O,0|k),k=qf,O=0|pl(0|F,0|w,0|m,0|g),P=qf,B=0|pl(0|L,0|I,0|M,0|C),V=0|tc(0|B,0|qf,0|O,0|P),P=qf,O=0|pl(0|b,0|k,0|x,0|R),B=0|tc(0|V,0|P,0|O,0|qf),O=qf,P=0|nc(0|A,((0|A)<0)<<31>>31|0,0|t,0|c),A=qf,V=0|nc(0|v,((0|v)<0)<<31>>31|0,0|_,0|u),v=qf,U=0|pl(0|N,0|D,0|t,0|c),c=qf,t=0|pl(0|N,0|D,0|_,0|u),u=qf,_=0|pl(0|B,0|O,0|P,0|A),G=qf,W=0|pl(0|B,0|O,0|V,0|v),z=qf,H=0|tc(0|_,0|G,0|U,0|c),c=qf,U=0|tc(0|W,0|z,0|t,0|u),u=qf,t=0|pl(0|B,0|O,0|m,0|g),g=qf,m=0|pl(0|B,0|O,0|M,0|C),C=qf,M=0|pl(0|B,0|O,0|x,0|R),R=qf,x=0|Ya(0|t,0|g,0|N,0|D),g=qf,t=0|Ya(0|m,0|C,0|N,0|D),C=qf,m=0|Ya(0|M,0|R,0|N,0|D),R=qf,M=0|nc(0|F,0|w,0|x,0|g),g=qf,x=0|nc(0|L,0|I,0|t,0|C),C=qf,t=0|nc(0|b,0|k,0|m,0|R),R=qf,m=0|pl(0|M,0|g,0|M,0|g),g=qf,M=0|pl(0|x,0|C,0|x,0|C),C=0|tc(0|M,0|qf,0|m,0|g),g=qf,m=0|pl(0|t,0|R,0|t,0|R),R=0|tc(0|C,0|g,0|m,0|qf),m=qf,g=0|nc(0,0,0|P,0|A),A=qf,P=0|pl(0|R,0|m,0|N,0|D),m=qf,0|P){case 0:m?(X=1,Z=0,K=P,Q=m,J=22):(j=0,Y=0);break;case 1:m?(X=1,Z=0,K=P,Q=m,J=22):(q=1,$=0,J=23);break;default:X=1,Z=0,K=P,Q=m,J=22}if(22==(0|J))for(;;){if(J=0,R=0|ql(0|X,0|Z,1),C=qf,t=K,K=0|rc(0|K,0|Q,2),!(Q>>>0>0|0==(0|Q)&t>>>0>7)){q=R,$=C,J=23;break}X=R,Z=C,Q=qf,J=22}if(23==(0|J))for(;;){if(J=0,C=0|Yd(0|P,0|m,0|q,0|$),R=0|tc(0|C,0|qf,0|q,0|$),C=0|rc(0|R,0|qf,1),R=qf,t=0|pl(0|C,0|R,0|C,0|R),M=qf,!(M>>>0>m>>>0|(0|M)==(0|m)&t>>>0>P>>>0)){j=C,Y=R;break}q=C,$=R,J=23}return P=0|pl(0|j,0|Y,0|V,0|v),m=qf,R=0|pl(0|j,0|Y,0|g,0|A),C=qf,t=e+20|0,M=0|kf[t>>2],M?(x=M+-1|0,M=0!=(kf[(0|kf[e+16>>2])+(x>>>5<<2)>>2]&1<<(31&x)|0),kf[t>>2]=x,x=0|nc(0,0,0|P,0|m),t=0|tc(0|H,0|c,0|(M?P:x),0|(M?m:qf)),m=qf,x=0|nc(0,0,0|R,0|C),P=0|tc(0|U,0|u,0|(M?R:x),0|(M?C:qf)),C=qf,M=0|Ya(0|t,0|m,0|N,0|D),m=0|Ya(0|P,0|C,0|N,0|D),kf[e+8>>2]=M,kf[e+12>>2]=m,ee=1):ee=0,y=ee,Xf=r,0|y}while(0);do{if(!f){if((0|n)>0){te=(n<<1)+-2|0;break}return ee=e+8|0,kf[ee>>2]=0,kf[ee+4>>2]=0,y=1,Xf=r,0|y}te=d<<1}while(0);return kf[e+8>>2]=kf[i+(te<<2)>>2],kf[e+12>>2]=kf[i+(te+1<<2)>>2],y=1,Xf=r,0|y}function Ki(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0;n=Xf,Xf=Xf+96|0,r=n+92|0,s=n+88|0,a=n+72|0,o=n+48|0,h=n+24|0,l=n,c=e+16|0,d=0|kf[c>>2],u=0|kf[t>>2],kf[a>>2]=d,kf[a+4>>2]=u,t=a+8|0,kf[t>>2]=u,If[a+12>>0]=1,f=(0|u)==-1,p=f?-1:0|kf[(0|kf[d>>2])+(u<<2)>>2],d=e+20|0,_=0|kf[d>>2],m=0|kf[_>>2],(0|kf[_+4>>2])-m>>2>>>0<=p>>>0&&Du(_),_=e+8|0,A=0|kf[(0|kf[_>>2])+(kf[m+(p<<2)>>2]<<2)>>2],p=e+4|0,m=0|kf[p>>2],v=0|If[m+84>>0]?A:0|kf[(0|kf[m+68>>2])+(A<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,kf[o+12>>2]=0,kf[o+16>>2]=0,kf[o+20>>2]=0,kf[s>>2]=v,v=0|If[m+24>>0],kf[r>>2]=kf[s>>2],0|Fi(m,r,v,o),v=e+28|0,e=0==(0|kf[v>>2]);e:do if(f)ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=e;else{for(m=h+8|0,A=o+8|0,y=h+16|0,g=o+16|0,b=l+8|0,E=l+16|0,T=u,S=0,w=0,C=0,M=0,P=0,I=0,R=u,x=e,O=u;;){do{if(!x){if(B=O+1|0,k=0==((B>>>0)%3|0|0)?O+-2|0:B,(O>>>0)%3|0){V=T,U=R,G=k,W=O+-1|0,z=19;break}V=T,U=R,G=k,W=O+2|0,z=19;break}if(k=R+1|0,(0|R)==-1){D=T,L=-1,N=-1,F=-1;break}if(B=0==((k>>>0)%3|0|0)?R+-2|0:k,(0|T)!=-1){if((T>>>0)%3|0){V=T,U=T,G=B,W=T+-1|0,z=19;break}V=T,U=T,G=B,W=T+2|0,z=19;break}V=-1,U=-1,G=B,W=-1,z=19}while(0);if(19==(0|z)&&(z=0,(0|G)==-1?(D=V,L=U,N=W,F=-1):(D=V,L=U,N=W,F=0|kf[(0|kf[kf[c>>2]>>2])+(G<<2)>>2])),H=0|kf[d>>2],k=0|kf[H>>2],(0|kf[H+4>>2])-k>>2>>>0<=F>>>0){z=22;break}if(B=0|kf[(0|kf[_>>2])+(kf[k+(F<<2)>>2]<<2)>>2],k=0|kf[p>>2],j=0|If[k+84>>0]?B:0|kf[(0|kf[k+68>>2])+(B<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,kf[h+12>>2]=0,kf[h+16>>2]=0,kf[h+20>>2]=0,kf[s>>2]=j,B=0|If[k+24>>0],kf[r>>2]=kf[s>>2],0|Fi(k,r,B,h),Y=(0|N)==-1?-1:0|kf[(0|kf[kf[c>>2]>>2])+(N<<2)>>2],X=0|kf[d>>2],B=0|kf[X>>2],(0|kf[X+4>>2])-B>>2>>>0<=Y>>>0){z=28;break}if(k=0|kf[(0|kf[_>>2])+(kf[B+(Y<<2)>>2]<<2)>>2],B=0|kf[p>>2],Z=0|If[B+84>>0]?k:0|kf[(0|kf[B+68>>2])+(k<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,kf[l+12>>2]=0,kf[l+16>>2]=0,kf[l+20>>2]=0,kf[s>>2]=Z,k=0|If[B+24>>0],kf[r>>2]=kf[s>>2],0|Fi(B,r,k,l),k=h,B=o,K=0|kf[B>>2],Q=0|kf[B+4>>2],B=0|nc(0|kf[k>>2],0|kf[k+4>>2],0|K,0|Q),k=qf,J=m,q=A,$=0|kf[q>>2],ee=0|kf[q+4>>2],q=0|nc(0|kf[J>>2],0|kf[J+4>>2],0|$,0|ee),J=qf,te=y,ie=g,ne=0|kf[ie>>2],re=0|kf[ie+4>>2],ie=0|nc(0|kf[te>>2],0|kf[te+4>>2],0|ne,0|re),te=qf,se=l,ae=0|nc(0|kf[se>>2],0|kf[se+4>>2],0|K,0|Q),Q=qf,K=b,se=0|nc(0|kf[K>>2],0|kf[K+4>>2],0|$,0|ee),ee=qf,$=E,K=0|nc(0|kf[$>>2],0|kf[$+4>>2],0|ne,0|re),re=qf,ne=0|pl(0|K,0|re,0|q,0|J),$=qf,oe=0|pl(0|se,0|ee,0|ie,0|te),he=qf,le=0|pl(0|ae,0|Q,0|ie,0|te),te=qf,ie=0|pl(0|K,0|re,0|B,0|k),re=qf,K=0|pl(0|se,0|ee,0|B,0|k),k=qf,B=0|pl(0|ae,0|Q,0|q,0|J),J=qf,q=0|nc(0|S,0|w,0|oe,0|he),he=0|tc(0|q,0|qf,0|ne,0|$),$=qf,ne=0|tc(0|le,0|te,0|C,0|M),te=0|nc(0|ne,0|qf,0|ie,0|re),re=qf,ie=0|nc(0|P,0|I,0|B,0|J),J=0|tc(0|ie,0|qf,0|K,0|k),k=qf,pr(a),O=0|kf[t>>2],K=0==(0|kf[v>>2]),(0|O)==-1){ce=$,de=he,ue=re,fe=te,pe=k,_e=J,me=K;break e}T=D,S=he,w=$,C=te,M=re,P=J,I=k,R=L,x=K}22==(0|z)?Du(H):28==(0|z)&&Du(X)}while(0);return e=(0|ce)>-1|(0|ce)==-1&de>>>0>4294967295,X=0|nc(0,0,0|de,0|ce),z=e?ce:qf,H=(0|ue)>-1|(0|ue)==-1&fe>>>0>4294967295,L=0|nc(0,0,0|fe,0|ue),D=H?ue:qf,v=(0|pe)>-1|(0|pe)==-1&_e>>>0>4294967295,t=0|nc(0,0,0|_e,0|pe),a=0|tc(0|(H?fe:L),0|D,0|(v?_e:t),0|(v?pe:qf)),v=0|tc(0|a,0|qf,0|(e?de:X),0|z),z=qf,me?(0|v)<=536870912?(Ae=de,ve=fe,ye=_e,kf[i>>2]=Ae,ge=i+4|0,kf[ge>>2]=ve,be=i+8|0,kf[be>>2]=ye,void(Xf=n)):(me=0|rc(0|v,0|z,29),X=7&me,me=0|Ya(0|de,0|ce,0|X,0),e=0|Ya(0|fe,0|ue,0|X,0),a=0|Ya(0|_e,0|pe,0|X,0),Ae=me,ve=e,ye=a,kf[i>>2]=Ae,ge=i+4|0,kf[ge>>2]=ve,be=i+8|0,kf[be>>2]=ye,void(Xf=n)):(0|z)>0|0==(0|z)&v>>>0>536870912?(a=0|rc(0|v,0|z,29),z=qf,v=0|Ya(0|de,0|ce,0|a,0|z),ce=0|Ya(0|fe,0|ue,0|a,0|z),ue=0|Ya(0|_e,0|pe,0|a,0|z),Ae=v,ve=ce,ye=ue,kf[i>>2]=Ae,ge=i+4|0,kf[ge>>2]=ve,be=i+8|0,kf[be>>2]=ye,void(Xf=n)):(Ae=de,ve=fe,ye=_e,kf[i>>2]=Ae,ge=i+4|0,kf[ge>>2]=ve,be=i+8|0,kf[be>>2]=ye,void(Xf=n))}function Qi(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=wp,O=wp,k=wp,D=0,L=0,N=0,F=0;if(n=Xf,Xf=Xf+64|0,s=n+40|0,a=n+16|0,o=n,h=0|r(e,t),0|h&&(kf[a>>2]=h,kf[s>>2]=kf[a>>2],0|Ke(e,s)),kf[o>>2]=0,h=o+4|0,kf[h>>2]=0,kf[o+8>>2]=0,l=0|kf[i>>2],c=(0|kf[i+4>>2])-l|0,c?(qr(o,c),d=0|kf[o>>2],u=0|kf[i>>2]):(d=0,u=l),0|ui(0|d,0|u,0|c),Ds(a,t),t=a+12|0,kf[t>>2]=0,c=a+16|0,kf[c>>2]=0,kf[a+20>>2]=0,u=0|kf[h>>2],d=0|kf[o>>2],i=u-d|0,i?(qr(t,i),f=0|kf[h>>2],p=0|kf[t>>2],_=0|kf[o>>2]):(f=u,p=0,_=d),0|ui(0|p,0|_,f-_|0),_=a+11|0,f=0|If[_>>0],p=f<<24>>24<0,t=p?0|kf[a>>2]:a,i=p?0|kf[a+4>>2]:255&f,i>>>0>3){for(f=t,p=i,d=i;;){if(u=0|np(Lf[f>>0]|Lf[f+1>>0]<<8|Lf[f+2>>0]<<16|Lf[f+3>>0]<<24,1540483477),p=(0|np(u>>>24^u,1540483477))^(0|np(p,1540483477)),d=d+-4|0,d>>>0<=3)break;f=f+4|0}f=i+-4|0,d=f&-4,m=t+(d+4)|0,A=p,v=f-d|0}else m=t,A=i,v=i;switch(0|v){case 3:y=Lf[m+2>>0]<<16^A,g=12;break;case 2:y=A,g=12;break;case 1:b=A,g=13;break;default:E=A}12==(0|g)&&(b=Lf[m+1>>0]<<8^y,g=13),13==(0|g)&&(E=0|np(Lf[m>>0]^b,1540483477)),b=0|np(E>>>13^E,1540483477),E=b>>>15^b,b=e+4|0,m=0|kf[b>>2],y=0==(0|m);e:do if(y)S=0,g=54;else if(A=m+-1|0,v=0==(A&m|0),T=v?E&A:E>>>0<m>>>0?E:(E>>>0)%(m>>>0)|0,d=0|kf[(0|kf[e>>2])+(T<<2)>>2],0!=(0|d)?(f=0|kf[d>>2],0!=(0|f)):0){if(d=0==(0|i),v){if(d)for(v=f;;){if(p=0|kf[v+4>>2],!((0|p)==(0|E)|(p&A|0)==(0|T))){S=T,g=54;break e}if(p=0|If[v+8+11>>0],!(0|(p<<24>>24<0?0|kf[v+12>>2]:255&p)))break e;if(v=0|kf[v>>2],!v){S=T,g=54;break e}}else w=f;for(;;){if(v=0|kf[w+4>>2],!((0|v)==(0|E)|(v&A|0)==(0|T))){S=T,g=54;break e}v=w+8|0,p=0|If[v+11>>0],u=p<<24>>24<0,l=255&p;do if((0|(u?0|kf[w+12>>2]:l))==(0|i)){if(p=0|kf[v>>2],u){if(0|fo(p,t,i))break;break e}if((255&p)<<24>>24==(0|If[t>>0])){p=l,C=v,M=t;do{if(p=p+-1|0,C=C+1|0,!p)break e;M=M+1|0}while((0|If[C>>0])==(0|If[M>>0]))}}while(0);if(w=0|kf[w>>2],!w){S=T,g=54;break e}}}if(d)for(A=f;;){if(v=0|kf[A+4>>2],(0|v)!=(0|E)&&(P=v>>>0<m>>>0?v:(v>>>0)%(m>>>0)|0,(0|P)!=(0|T))){S=T,g=54;break e}if(v=0|If[A+8+11>>0],!(0|(v<<24>>24<0?0|kf[A+12>>2]:255&v)))break e;if(A=0|kf[A>>2],!A){S=T,g=54;break e}}else I=f;for(;;){if(A=0|kf[I+4>>2],(0|A)!=(0|E)&&(R=A>>>0<m>>>0?A:(A>>>0)%(m>>>0)|0,(0|R)!=(0|T))){S=T,g=54;break e}A=I+8|0,d=0|If[A+11>>0],v=d<<24>>24<0,l=255&d;do if((0|(v?0|kf[I+12>>2]:l))==(0|i)){if(d=0|kf[A>>2],v){if(0|fo(d,t,i))break;break e}if((255&d)<<24>>24==(0|If[t>>0])){d=l,u=A,M=t;do{if(d=d+-1|0,u=u+1|0,!d)break e;M=M+1|0}while((0|If[u>>0])==(0|If[M>>0]))}}while(0);if(I=0|kf[I>>2],!I){S=T,g=54;break}}}else S=T,g=54;while(0);if(54==(0|g)){vi(s,e,E,a),g=e+12|0,x=ap(((0|kf[g>>2])+1|0)>>>0),O=ap(m>>>0),k=ap(Gf[e+16>>2]);do if(y|x>ap(O*k)){if(T=1&(m>>>0<3|0!=(m+-1&m|0))|m<<1,I=~~ap(ip(ap(x/k)))>>>0,wr(e,T>>>0<I>>>0?I:T),T=0|kf[b>>2],I=T+-1|0,!(I&T)){D=T,L=I&E;break}E>>>0<T>>>0?(D=T,L=E):(D=T,L=(E>>>0)%(T>>>0)|0)}else D=m,L=S;while(0);S=0|kf[(0|kf[e>>2])+(L<<2)>>2],S?(kf[kf[s>>2]>>2]=kf[S>>2],kf[S>>2]=kf[s>>2],N=s):(m=e+8|0,kf[kf[s>>2]>>2]=kf[m>>2],kf[m>>2]=kf[s>>2],kf[(0|kf[e>>2])+(L<<2)>>2]=m,m=0|kf[s>>2],L=0|kf[m>>2],L?(E=0|kf[L+4>>2],L=D+-1|0,F=L&D?E>>>0<D>>>0?E:(E>>>0)%(D>>>0)|0:E&L,kf[(0|kf[e>>2])+(F<<2)>>2]=m,N=s):N=s),kf[g>>2]=(0|kf[g>>2])+1,kf[N>>2]=0}return N=0|kf[a+12>>2],0|N&&((0|kf[c>>2])!=(0|N)&&(kf[c>>2]=N),mf(N)),(0|If[_>>0])<0&&mf(0|kf[a>>2]),(a=0|kf[o>>2])?((0|kf[h>>2])!=(0|a)&&(kf[h>>2]=a),mf(a),void(Xf=n)):void(Xf=n)}function Ji(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0;n=Xf,Xf=Xf+96|0,r=n+92|0,s=n+88|0,a=n+72|0,o=n+48|0,h=n+24|0,l=n,c=e+16|0,d=0|kf[c>>2],u=0|kf[t>>2],kf[a>>2]=d,kf[a+4>>2]=u,t=a+8|0,kf[t>>2]=u,If[a+12>>0]=1,f=0|kf[(0|kf[d+28>>2])+(u<<2)>>2],d=e+20|0,p=0|kf[d>>2],_=0|kf[p>>2],(0|kf[p+4>>2])-_>>2>>>0<=f>>>0&&Du(p),p=e+8|0,m=0|kf[(0|kf[p>>2])+(kf[_+(f<<2)>>2]<<2)>>2],f=e+4|0,_=0|kf[f>>2],A=0|If[_+84>>0]?m:0|kf[(0|kf[_+68>>2])+(m<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,kf[o+12>>2]=0,kf[o+16>>2]=0,kf[o+20>>2]=0,kf[s>>2]=A,A=0|If[_+24>>0],kf[r>>2]=kf[s>>2],0|Fi(_,r,A,o),A=e+28|0,e=0==(0|kf[A>>2]);e:do if((0|u)!=-1){for(_=h+8|0,m=o+8|0,v=h+16|0,y=o+16|0,g=l+8|0,b=l+16|0,E=u,T=0,S=0,w=0,C=0,M=0,P=0,I=u,R=e,x=u;;){do{if(!R){if(k=x+1|0,O=0==((k>>>0)%3|0|0)?x+-2|0:k,(x>>>0)%3|0){D=E,L=I,N=O,F=x+-1|0;break}D=E,L=I,N=O,F=x+2|0;break}if(O=I+1|0,(0|I)!=-1){if(k=0==((O>>>0)%3|0|0)?I+-2|0:O,(0|E)!=-1){if((E>>>0)%3|0){D=E,L=E,N=k,F=E+-1|0;break}D=E,L=E,N=k,F=E+2|0;break}D=-1,L=-1,N=k,F=-1}else D=E,L=-1,N=-1,F=-1}while(0);if(O=0|kf[(0|kf[(0|kf[c>>2])+28>>2])+(N<<2)>>2],B=0|kf[d>>2],k=0|kf[B>>2],(0|kf[B+4>>2])-k>>2>>>0<=O>>>0){V=17;break}if(U=0|kf[(0|kf[p>>2])+(kf[k+(O<<2)>>2]<<2)>>2],O=0|kf[f>>2],G=0|If[O+84>>0]?U:0|kf[(0|kf[O+68>>2])+(U<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,kf[h+12>>2]=0,kf[h+16>>2]=0,kf[h+20>>2]=0,kf[s>>2]=G,U=0|If[O+24>>0],kf[r>>2]=kf[s>>2],0|Fi(O,r,U,h),U=0|kf[(0|kf[(0|kf[c>>2])+28>>2])+(F<<2)>>2],W=0|kf[d>>2],O=0|kf[W>>2],(0|kf[W+4>>2])-O>>2>>>0<=U>>>0){V=21;break}if(k=0|kf[(0|kf[p>>2])+(kf[O+(U<<2)>>2]<<2)>>2],U=0|kf[f>>2],z=0|If[U+84>>0]?k:0|kf[(0|kf[U+68>>2])+(k<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,kf[l+12>>2]=0,kf[l+16>>2]=0,kf[l+20>>2]=0,kf[s>>2]=z,k=0|If[U+24>>0],kf[r>>2]=kf[s>>2],0|Fi(U,r,k,l),k=h,U=o,O=0|kf[U>>2],H=0|kf[U+4>>2],U=0|nc(0|kf[k>>2],0|kf[k+4>>2],0|O,0|H),k=qf,j=_,Y=m,X=0|kf[Y>>2],Z=0|kf[Y+4>>2],Y=0|nc(0|kf[j>>2],0|kf[j+4>>2],0|X,0|Z),j=qf,K=v,Q=y,J=0|kf[Q>>2],q=0|kf[Q+4>>2],Q=0|nc(0|kf[K>>2],0|kf[K+4>>2],0|J,0|q),K=qf,$=l,ee=0|nc(0|kf[$>>2],0|kf[$+4>>2],0|O,0|H),H=qf,O=g,$=0|nc(0|kf[O>>2],0|kf[O+4>>2],0|X,0|Z),Z=qf,X=b,O=0|nc(0|kf[X>>2],0|kf[X+4>>2],0|J,0|q),q=qf,J=0|pl(0|O,0|q,0|Y,0|j),X=qf,te=0|pl(0|$,0|Z,0|Q,0|K),ie=qf,ne=0|pl(0|ee,0|H,0|Q,0|K),K=qf,Q=0|pl(0|O,0|q,0|U,0|k),q=qf,O=0|pl(0|$,0|Z,0|U,0|k),k=qf,U=0|pl(0|ee,0|H,0|Y,0|j),j=qf,Y=0|nc(0|T,0|S,0|te,0|ie),ie=0|tc(0|Y,0|qf,0|J,0|X),X=qf,J=0|tc(0|ne,0|K,0|w,0|C),K=0|nc(0|J,0|qf,0|Q,0|q),q=qf,Q=0|nc(0|M,0|P,0|U,0|j),j=0|tc(0|Q,0|qf,0|O,0|k),k=qf,Kt(a),x=0|kf[t>>2],O=0==(0|kf[A>>2]),(0|x)==-1){re=X,se=ie,ae=q,oe=K,he=k,le=j,ce=O;break e}E=D,T=ie,S=X,w=K,C=q,M=j,P=k,I=L,R=O}17==(0|V)?Du(B):21==(0|V)&&Du(W)}else re=0,se=0,ae=0,oe=0,he=0,le=0,ce=e;while(0);return e=(0|re)>-1|(0|re)==-1&se>>>0>4294967295,W=0|nc(0,0,0|se,0|re),V=e?re:qf,B=(0|ae)>-1|(0|ae)==-1&oe>>>0>4294967295,L=0|nc(0,0,0|oe,0|ae),D=B?ae:qf,A=(0|he)>-1|(0|he)==-1&le>>>0>4294967295,t=0|nc(0,0,0|le,0|he),a=0|tc(0|(B?oe:L),0|D,0|(A?le:t),0|(A?he:qf)),A=0|tc(0|a,0|qf,0|(e?se:W),0|V),V=qf,ce?(0|A)<=536870912?(de=se,ue=oe,fe=le,kf[i>>2]=de,pe=i+4|0,kf[pe>>2]=ue,_e=i+8|0,kf[_e>>2]=fe,void(Xf=n)):(ce=0|rc(0|A,0|V,29),W=7&ce,ce=0|Ya(0|se,0|re,0|W,0),e=0|Ya(0|oe,0|ae,0|W,0),a=0|Ya(0|le,0|he,0|W,0),de=ce,ue=e,fe=a,kf[i>>2]=de,pe=i+4|0,kf[pe>>2]=ue,_e=i+8|0,kf[_e>>2]=fe,void(Xf=n)):(0|V)>0|0==(0|V)&A>>>0>536870912?(a=0|rc(0|A,0|V,29),V=qf,A=0|Ya(0|se,0|re,0|a,0|V),re=0|Ya(0|oe,0|ae,0|a,0|V),ae=0|Ya(0|le,0|he,0|a,0|V),de=A,ue=re,fe=ae,kf[i>>2]=de,pe=i+4|0,kf[pe>>2]=ue,_e=i+8|0,kf[_e>>2]=fe,void(Xf=n)):(de=se,ue=oe,fe=le,kf[i>>2]=de,pe=i+4|0,kf[pe>>2]=ue,_e=i+8|0,kf[_e>>2]=fe,void(Xf=n))}function qi(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0;i=Xf,Xf=Xf+32|0,n=i+20|0,r=i+8|0,s=i+4|0,a=i,o=e+4|0;do{if((Lf[(0|kf[o>>2])+36>>0]<<8&65535)<512){if(h=t+8|0,l=0|kf[h>>2],c=0|kf[h+4>>2],h=t+16|0,d=h,u=0|kf[d>>2],f=0|tc(0|u,0|kf[d+4>>2],4,0),d=qf,(0|c)<(0|d)|(0|c)==(0|d)&l>>>0<f>>>0)return p=-1,Xf=i,0|p;l=(0|kf[t>>2])+u|0,u=Lf[l>>0]|Lf[l+1>>0]<<8|Lf[l+2>>0]<<16|Lf[l+3>>0]<<24,kf[n>>2]=u,l=h,kf[l>>2]=f,kf[l+4>>2]=d,_=u;break}if(0|Qs(n,t)){_=0|kf[n>>2];break}return p=-1,Xf=i,0|p}while(0);e:do if(0|_){if(u=0|kf[e+8>>2],_>>>0>(((0|kf[u+4>>2])-(0|kf[u>>2])>>2>>>0)/3|0)>>>0)return p=-1,Xf=i,0|p;if(u=0|kf[o>>2],(65535&(Lf[u+36>>0]<<8|Lf[u+37>>0]))<258){for(u=t+8|0,d=t+16|0,l=r+4|0,f=r+8|0,h=e+40|0,c=e+44|0,m=e+36|0,A=_,v=0;;){if(y=u,g=0|kf[y>>2],b=0|kf[y+4>>2],y=d,E=0|kf[y>>2],T=0|kf[y+4>>2],y=0|tc(0|E,0|T,4,0),S=qf,(0|b)<(0|S)|(0|b)==(0|S)&g>>>0<y>>>0)break;if(w=0|kf[t>>2],C=w+E|0,kf[r>>2]=Lf[C>>0]|Lf[C+1>>0]<<8|Lf[C+2>>0]<<16|Lf[C+3>>0]<<24,C=d,kf[C>>2]=y,kf[C+4>>2]=S,S=0|tc(0|E,0|T,8,0),C=qf,(0|b)<(0|C)|(0|b)==(0|C)&g>>>0<S>>>0)break;if(S=w+y|0,kf[l>>2]=Lf[S>>0]|Lf[S+1>>0]<<8|Lf[S+2>>0]<<16|Lf[S+3>>0]<<24,S=0|tc(0|E,0|T,8,0),y=qf,C=d,kf[C>>2]=S,kf[C+4>>2]=y,!((0|b)>(0|y)|(0|b)==(0|y)&g>>>0>S>>>0))break;if(g=0|If[w+S>>0],S=0|tc(0|E,0|T,9,0),T=d,kf[T>>2]=S,kf[T+4>>2]=qf,If[f>>0]=If[f>>0]&-2|1&g,g=0|kf[h>>2],(0|g)==(0|kf[c>>2])?(Yr(m,r),M=0|kf[n>>2]):(kf[g>>2]=kf[r>>2],kf[g+4>>2]=kf[r+4>>2],kf[g+8>>2]=kf[r+8>>2],kf[h>>2]=(0|kf[h>>2])+12,M=A),v=v+1|0,v>>>0>=M>>>0)break e;A=M}return p=-1,Xf=i,0|p}A=r+4|0,v=e+40|0,h=e+44|0,m=e+36|0,c=0,f=0;do{if(0|Qs(s,t),kf[A>>2]=(0|kf[s>>2])+f,0|Qs(s,t),d=0|kf[s>>2],f=0|kf[A>>2],f>>>0<d>>>0){P=36;break}kf[r>>2]=f-d,d=0|kf[v>>2],(0|d)==(0|kf[h>>2])?Yr(m,r):(kf[d>>2]=kf[r>>2],kf[d+4>>2]=kf[r+4>>2],kf[d+8>>2]=kf[r+8>>2],kf[v>>2]=(0|kf[v>>2])+12),c=c+1|0}while(c>>>0<(0|kf[n>>2])>>>0);if(36==(0|P))return p=-1,Xf=i,0|p;if(0|oi(t,0,0),c=0|kf[n>>2],0|c)for(v=t+36|0,m=t+32|0,h=t+24|0,f=t+28|0,A=e+36|0,d=0,l=0;;){if(u=0|kf[o>>2],g=0==(0|If[v>>0]),(65535&(Lf[u+36>>0]<<8|Lf[u+37>>0]))<514?g?x=d:(u=0|kf[m>>2],T=0|kf[h>>2],S=0|kf[f>>2],E=T+(u>>>3)|0,E>>>0<S>>>0?(w=(0|Lf[E>>0])>>>(7&u)&1,E=u+1|0,kf[m>>2]=E,I=E,R=w):(I=u,R=0),(T+(I>>>3)|0)>>>0<S>>>0?(kf[m>>2]=I+1,x=R):x=R):g?x=d:(g=0|kf[m>>2],S=(0|kf[h>>2])+(g>>>3)|0,S>>>0<(0|kf[f>>2])>>>0?(T=(0|Lf[S>>0])>>>(7&g)&1,kf[m>>2]=g+1,x=T):x=0),T=(0|kf[A>>2])+(12*l|0)+8|0,If[T>>0]=If[T>>0]&-2|1&x,l=l+1|0,l>>>0>=c>>>0)break;d=x}hh(t)}while(0);kf[r>>2]=0,x=0|kf[o>>2],R=65535&(Lf[x+36>>0]<<8|Lf[x+37>>0]),(65535&R)<512?(x=t+8|0,I=0|kf[x>>2],n=0|kf[x+4>>2],x=t+16|0,M=x,_=0|kf[M>>2],d=0|tc(0|_,0|kf[M+4>>2],4,0),M=qf,(0|n)<(0|M)|(0|n)==(0|M)&I>>>0<d>>>0?O=-1:(I=(0|kf[t>>2])+_|0,_=Lf[I>>0]|Lf[I+1>>0]<<8|Lf[I+2>>0]<<16|Lf[I+3>>0]<<24,kf[r>>2]=_,I=x,kf[I>>2]=d,kf[I+4>>2]=M,k=_,P=43)):R<<16>>16==512?0|Qs(r,t)?(k=0|kf[r>>2],P=43):O=-1:P=57;e:do if(43==(0|P))if(k){if(R=0|kf[o>>2],(65535&(Lf[R+36>>0]<<8|Lf[R+37>>0]))>=258)for(R=e+52|0,_=e+56|0,M=e+48|0,I=0,d=0;;)if(kf[s>>2]=0,0|Qs(a,t),d=(0|kf[a>>2])+d|0,kf[s>>2]=d,x=0|kf[R>>2],(0|x)==(0|kf[_>>2])?us(M,s):(kf[x>>2]=d,kf[R>>2]=x+4),I=I+1|0,I>>>0>=(0|kf[r>>2])>>>0){P=57;break e}for(I=t+8|0,R=t+16|0,d=e+52|0,M=e+56|0,_=e+48|0,x=0;;){if(kf[s>>2]=0,n=I,c=0|kf[n>>2],l=0|kf[n+4>>2],n=R,A=0|kf[n>>2],m=0|tc(0|A,0|kf[n+4>>2],4,0),n=qf,(0|l)<(0|n)|(0|l)==(0|n)&c>>>0<m>>>0)break;if(c=(0|kf[t>>2])+A|0,A=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,kf[s>>2]=A,c=R,kf[c>>2]=m,kf[c+4>>2]=n,n=0|kf[d>>2],(0|n)==(0|kf[M>>2])?us(_,s):(kf[n>>2]=A,kf[d>>2]=n+4),x=x+1|0,x>>>0>=(0|kf[r>>2])>>>0){P=57;break e}}O=-1}else P=57;while(0);return 57==(0|P)&&(O=0|kf[t+16>>2]),p=O,Xf=i,0|p}function $i(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0;if(i=Xf,Xf=Xf+736|0,n=i+716|0,r=i,s=i+64|0,(0|Ff[t+38>>1])<515)return a=1,Xf=i,0|a;if(o=t+8|0,h=0|kf[o+4>>2],l=t+16|0,c=l,d=0|kf[c>>2],u=0|kf[c+4>>2],!((0|h)>(0|u)|((0|h)==(0|u)?(0|kf[o>>2])>>>0>d>>>0:0)))return a=0,Xf=i,0|a;o=0|If[(0|kf[t>>2])+d>>0],h=0|tc(0|d,0|u,1,0),u=l,kf[u>>2]=h,kf[u+4>>2]=qf,u=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,h=0|kf[(0|kf[u>>2])+80>>2],u=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),kf[n>>2]=0,l=n+4|0,kf[l>>2]=0,kf[n+8>>2]=0;do if(0|u){if(!(u>>>0>214748364)){d=20*u|0,c=0|sl(d),kf[n>>2]=c,kf[n+8>>2]=c+(20*u|0),0|Bs(0|c,0,0|d),kf[l>>2]=c+d;break}Du(n)}while(0);u=e+64|0,d=e+68|0,c=e+60|0,f=e+52|0,p=e+56|0,_=e+48|0,m=0,A=0;e:for(;;){if((0|m)>=(0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e))){v=44;break}switch(y=0|Mp[127&kf[(0|kf[e>>2])+20>>2]](e,m),g=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,b=0|kf[(0|kf[(0|kf[g>>2])+8>>2])+(y<<2)>>2],0|Ys(b,h),If[b+84>>0]=1,y=0|kf[b+68>>2],g=b+72|0,E=0|kf[g>>2],(0|E)!=(0|y)&&(kf[g>>2]=E+(~((E+-4-y|0)>>>2)<<2)),0|kf[b+28>>2]){case 2:case 4:case 6:T=b;break;case 1:case 3:case 5:if(y=b+24|0,E=0|If[y>>0],E<<24>>24>0)for(g=E,E=0;;){if(kf[r>>2]=0,S=0|kf[f>>2],S>>>0<(0|kf[p>>2])>>>0?(kf[S>>2]=0,kf[f>>2]=S+4,w=g):(us(_,r),w=0|If[y>>0]),E=E+1|0,(0|E)>=(w<<24>>24|0))break;g=w}T=b;break;case 9:g=0|If[b+24>>0],Qo(r),E=0|kf[b+56>>2],y=0|np(0|oh(6),g<<24>>24),ia(r,E,0,g,6,0,y,((0|y)<0)<<31>>31,0,0),y=0|sl(96),Lo(y,r),kf[s>>2]=y,If[y+84>>0]=1,g=0|kf[y+68>>2],E=y+72|0,S=0|kf[E>>2],(0|S)!=(0|g)&&(kf[E>>2]=S+(~((S+-4-g|0)>>>2)<<2)),0|Ys(y,h),y=0|kf[u>>2],y>>>0<(0|kf[d>>2])>>>0?(g=0|kf[s>>2],kf[s>>2]=0,kf[y>>2]=g,g=y+4|0,kf[u>>2]=g,C=g):(Re(c,s),C=0|kf[u>>2]),g=0|kf[C+-4>>2],y=0|kf[s>>2],kf[s>>2]=0,0|y&&(S=y+88|0,E=0|kf[S>>2],kf[S>>2]=0,0|E&&(S=0|kf[E+8>>2],0|S&&(M=E+12|0,(0|kf[M>>2])!=(0|S)&&(kf[M>>2]=S),mf(S)),mf(E)),E=0|kf[y+68>>2],0|E&&(S=y+72|0,M=0|kf[S>>2],(0|M)!=(0|E)&&(kf[S>>2]=M+(~((M+-4-E|0)>>>2)<<2)),mf(E)),E=y+64|0,M=0|kf[E>>2],kf[E>>2]=0,0|M&&(E=0|kf[M>>2],0|E&&(S=M+4|0,(0|kf[S>>2])!=(0|E)&&(kf[S>>2]=E),mf(E)),mf(M)),mf(y)),T=g;break;default:P=0;break e}g=T,y=0|kf[g+28>>2],M=0|oh(y),E=0|If[g+24>>0],g=0|kf[n>>2],kf[g+(20*m|0)>>2]=T,kf[g+(20*m|0)+4>>2]=A,kf[g+(20*m|0)+8>>2]=y,kf[g+(20*m|0)+12>>2]=(0|M)>0?M:0,kf[g+(20*m|0)+16>>2]=E,m=m+1|0,A=E+A|0}if(44==(0|v)){switch(rr(r,n),o<<24>>24){case 0:it(s,A),o=0|Fe(s,t,r),st(s),o?v=52:I=0;break;case 1:it(s,A),o=0|Ne(s,t,r),st(s),o?v=52:I=0;break;case 2:rt(s,A),o=0|Ve(s,t,r),dt(s),o?v=52:I=0;break;case 3:rt(s,A),o=0|Be(s,t,r),dt(s),o?v=52:I=0;break;case 4:et(s,A),o=0|_e(s,t,r),Je(s),o?v=52:I=0;break;case 5:et(s,A),o=0|pe(s,t,r),Je(s),o?v=52:I=0;break;case 6:et(s,A),A=0|fe(s,t,r),Je(s),A?v=52:I=0;break;default:I=0}52==(0|v)&&(I=1),v=0|kf[r+16>>2],0|v&&(A=r+20|0,s=0|kf[A>>2],(0|s)!=(0|v)&&(kf[A>>2]=s+(20*~(((s+-20-v|0)>>>0)/20|0)|0)),mf(v)),v=0|kf[r>>2],0|v&&(s=r+4|0,(0|kf[s>>2])!=(0|v)&&(kf[s>>2]=v),mf(v)),P=I}return I=0|kf[n>>2],0|I&&(n=0|kf[l>>2],(0|n)!=(0|I)&&(kf[l>>2]=n+(20*~(((n+-20-I|0)>>>0)/20|0)|0)),mf(I)),a=P,Xf=i,0|a}function en(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=wp,q=wp,$=0,te=wp,ie=0,ne=wp;if(t=Xf,Xf=Xf+32|0,i=t+12|0,n=t,r=e+60|0,(0|kf[r>>2])==(0|kf[e+64>>2])?(0|kf[e+48>>2])==(0|kf[e+52>>2]):0)return s=1,Xf=t,0|s;e:do if((0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e))>0){a=i+4|0,o=i+8|0,h=n+4|0,l=n+8|0,c=n+8|0,d=i+8|0,u=e+36|0,f=i+8|0,p=i+4|0,_=i+11|0,m=i+4|0,A=0,v=0,y=0;t:for(;;){g=0|Mp[127&kf[(0|kf[e>>2])+20>>2]](e,A),b=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,E=0|kf[(0|kf[(0|kf[b>>2])+8>>2])+(g<<2)>>2],g=E+28|0;i:do switch(0|kf[g>>2]){case 1:case 3:case 5:if(b=E+24|0,T=0|If[b>>0],S=T<<24>>24,kf[i>>2]=0,kf[a>>2]=0,kf[o>>2]=0,T<<24>>24){if(T<<24>>24<0){C=8;break t}T=S<<2,M=0|sl(T),kf[i>>2]=M,P=M+(S<<2)|0,kf[d>>2]=P,0|Bs(0|M,0,0|T),kf[a>>2]=P,w=0|If[b>>0]}else w=0;if(P=w<<24>>24,kf[n>>2]=0,kf[h>>2]=0,kf[l>>2]=0,w<<24>>24){if(w<<24>>24<0){C=12;break t}T=P<<2,M=0|sl(T),kf[n>>2]=M,S=M+(P<<2)|0,kf[c>>2]=S,0|Bs(0|M,0,0|T),kf[h>>2]=S}switch(0|kf[g>>2]){case 5:0|ue(e,E,y)?C=18:(I=1,R=y);break;case 3:0|de(e,E,y)?C=18:(I=1,R=y);break;case 1:0|ee(e,E,y)?C=18:(I=1,R=y);break;default:C=18}if(18==(0|C)&&(C=0,I=0,R=(0|If[b>>0])+y|0),b=0|kf[n>>2],0|b&&(S=0|kf[h>>2],(0|S)!=(0|b)&&(kf[h>>2]=S+(~((S+-4-b|0)>>>2)<<2)),mf(b)),b=0|kf[i>>2],0|b&&(S=0|kf[a>>2],(0|S)!=(0|b)&&(kf[a>>2]=S+(~((S+-4-b|0)>>>2)<<2)),
mf(b)),I){k=I;break e}x=v,O=R;break;case 9:b=0|kf[(0|kf[r>>2])+(v<<2)>>2],S=0|kf[u>>2],T=v+1|0,M=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+40|0,P=0|kf[M>>2],M=0|kf[E+56>>2],D=0|sl(32),kf[i>>2]=D,kf[f>>2]=-2147483616,kf[p>>2]=24,L=D,N=11771,F=L+24|0;do If[L>>0]=0|If[N>>0],L=L+1|0,N=N+1|0;while((0|L)<(0|F));if(If[D+24>>0]=0,N=P+16|0,L=0|kf[N>>2]){F=N,B=L;n:for(;;){for(L=B;;){if((0|kf[L+16>>2])>=(0|M))break;if(V=0|kf[L+4>>2],!V){U=F;break n}L=V}if(B=0|kf[L>>2],!B){U=L;break}F=L}(((0|U)!=(0|N)?(0|M)>=(0|kf[U+16>>2]):0)?(F=U+20|0,0!=(0|mr(F,i))):0)?G=0|ma(F,i,0):C=37}else C=37;if(37==(0|C)&&(C=0,G=0|ma(P,i,0)),(0|If[_>>0])<0&&mf(0|kf[i>>2]),G){ke(E,b),x=T,O=y;break i}if(F=0|kf[S+(24*v|0)+4>>2],B=0|If[E+24>>0],D=B<<24>>24,V=D<<2,W=0|ff(D>>>0>1073741823?-1:D<<2),Vd(i),!(0|$h(i,ap(Gf[S+(24*v|0)+20>>2]),(1<<F)+-1|0))){C=54;break t}F=(0|kf[kf[b>>2]>>2])+(0|kf[b+48>>2])|0,z=b+80|0;n:do if(0|kf[z>>2]){if(H=E+64|0,j=S+(24*v|0)+8|0,B<<24>>24>0)Y=0,X=0,Z=0;else for(K=0,Q=0;;){if(0|ui((0|kf[kf[H>>2]>>2])+Q|0,0|W,0|V),K=K+1|0,K>>>0>=(0|kf[z>>2])>>>0)break n;Q=Q+V|0}for(;;){for(Q=0|kf[j>>2],J=ap(Gf[m>>2]),q=ap(Gf[i>>2]),K=0,L=Z;;){if($=0|kf[F+(L<<2)>>2],(0|$)>-1?te=ap(ap(ap(0|$)*J)*q):(ie=0|nc(0,0,0|$,((0|$)<0)<<31>>31|0),te=ap(-ap(q*ap(J*ap(+(ie>>>0)+4294967296*+(0|qf)))))),ne=ap(te+ap(Gf[Q+(K<<2)>>2])),Gf[W+(K<<2)>>2]=ne,K=K+1|0,(0|K)==(0|D))break;L=L+1|0}if(0|ui((0|kf[kf[H>>2]>>2])+X|0,0|W,0|V),Y=Y+1|0,Y>>>0>=(0|kf[z>>2])>>>0)break;X=X+V|0,Z=D+Z|0}}while(0);pf(W),x=T,O=y;break;default:x=v,O=y}while(0);if(A=A+1|0,(0|A)>=(0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e))){k=2;break e}v=x,y=O}if(8==(0|C))Du(i);else if(12==(0|C))Du(n);else if(54==(0|C)){pf(W),k=1;break}}else k=2;while(0);return s=2==(0|k),Xf=t,0|s}function tn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0;if(i=Xf,Xf=Xf+48|0,n=i+24|0,r=i+12|0,s=i,!t)return a=0,Xf=i,0|a;if(o=e+12|0,h=e+4|0,l=0|kf[h>>2],c=0|kf[e>>2],d=l-c>>2,u=e+16|0,f=0|kf[u>>2],p=0|kf[o>>2],_=f-p>>2,m=p,p=f,d>>>0<=_>>>0?(d>>>0<_>>>0?(f=m+(d<<2)|0,(0|p)!=(0|f)):0)?(kf[u>>2]=p+(~((p+-4-f|0)>>>2)<<2),A=c,v=l):(A=c,v=l):(lr(o,d-_|0,3564),A=0|kf[e>>2],v=0|kf[h>>2]),kf[n>>2]=0,_=n+4|0,kf[_>>2]=0,kf[n+8>>2]=0,pa(n,v-A>>2),A=0|kf[h>>2],v=0|kf[e>>2],(0|A)==(0|v))y=A,g=A;else for(d=0|kf[n>>2],l=d,c=l,f=v,v=d,d=A,A=l,l=0;;){if(p=0|kf[f+(l<<2)>>2],u=0|kf[_>>2],p>>>0<u-v>>2>>>0?(b=c,E=A,T=f,S=d):(m=p+1|0,kf[r>>2]=0,w=u-v>>2,C=v,M=u,m>>>0<=w>>>0?(m>>>0<w>>>0?(u=C+(m<<2)|0,(0|M)!=(0|u)):0)?(kf[_>>2]=M+(~((M+-4-u|0)>>>2)<<2),P=c,I=d,R=f):(P=c,I=d,R=f):(lr(n,m-w|0,r),P=0|kf[n>>2],I=0|kf[h>>2],R=0|kf[e>>2]),b=P,E=P,T=R,S=I),w=E+(p<<2)|0,kf[w>>2]=(0|kf[w>>2])+1,l=l+1|0,l>>>0>=S-T>>2>>>0){y=T,g=S;break}c=b,f=T,v=E,d=S,A=E}if(E=g-y|0,y=E>>2,kf[r>>2]=0,g=r+4|0,kf[g>>2]=0,kf[r+8>>2]=0,y){for(y>>>0>536870911&&Du(r),A=0|sl(E<<1),kf[g>>2]=A,kf[r>>2]=A,kf[r+8>>2]=A+(y<<3),E=A,S=y,d=A;;){if(v=E,kf[v>>2]=-1,kf[v+4>>2]=-1,v=d+8|0,T=S+-1|0,!T)break;E=v,S=T,d=v}kf[g>>2]=A+(y<<3),x=A,O=A}else x=0,O=0;A=0|kf[_>>2],y=0|kf[n>>2],d=A-y|0,S=d>>2,kf[s>>2]=0,E=s+4|0,kf[E>>2]=0,kf[s+8>>2]=0,v=y;do if(S){if(!(S>>>0>1073741823)){T=0|sl(d),kf[s>>2]=T,f=T+(S<<2)|0,kf[s+8>>2]=f,0|Bs(0|T,0,0|d),kf[E>>2]=f,k=T,D=f,L=T;break}Du(s)}else k=0,D=0,L=0;while(0);if((0|A)!=(0|y)){y=0,A=0;do kf[k+(y<<2)>>2]=A,A=(0|kf[v+(y<<2)>>2])+A|0,y=y+1|0;while(y>>>0<S>>>0)}if(y=0|kf[h>>2],h=0|kf[e>>2],A=h,(0|y)!=(0|h))for(d=e+40|0,e=y-h>>2,h=k,y=0,s=x,T=x,f=x,b=x,c=x,l=x;;){I=0|kf[A+(y<<2)>>2],R=y+1|0,P=0==((R>>>0)%3|0|0)?y+-2|0:R,N=(0|P)==-1?-1:0|kf[A+(P<<2)>>2],P=0==((y>>>0)%3|0|0),R=(P?2:-1)+y|0,F=(0|R)==-1?-1:0|kf[A+(R<<2)>>2],(P?(0|N)==(0|F)|((0|I)==(0|N)|(0|I)==(0|F)):0)?(kf[d>>2]=(0|kf[d>>2])+1,B=h,V=y+2|0,U=s,G=T,W=f,z=b,H=c,j=l):Y=51;e:do if(51==(0|Y)){Y=0,P=0|kf[v+(F<<2)>>2];t:do if((0|P)>0){for(R=0,w=0|kf[h+(F<<2)>>2];;){if(p=0|kf[c+(w<<3)>>2],(0|p)==-1){X=s,Z=T,K=b,Q=c;break t}if((0|p)==(0|N)&&(p=0|kf[c+(w<<3)+4>>2],J=(0|p)==-1?-1:0|kf[A+(p<<2)>>2],(0|I)!=(0|J)))break;if(p=R+1|0,!((0|p)<(0|P))){X=s,Z=T,K=b,Q=c;break t}R=p,w=w+1|0}for(p=0|kf[b+(w<<3)+4>>2],m=R,u=w,M=T;;){if(m=m+1|0,(0|m)>=(0|P))break;if(C=u+1|0,kf[M+(u<<3)>>2]=kf[M+(C<<3)>>2],kf[M+(u<<3)+4>>2]=kf[M+(C<<3)+4>>2],(0|kf[s+(u<<3)>>2])==-1)break;u=C,M=s}if(kf[f+(u<<3)>>2]=-1,(0|p)!=-1){M=0|kf[o>>2],kf[M+(y<<2)>>2]=p,kf[M+(p<<2)>>2]=y,B=h,V=y,U=f,G=f,W=f,z=f,H=f,j=l;break e}X=f,Z=f,K=f,Q=f}else X=s,Z=T,K=b,Q=c;while(0);if(P=0|kf[v+(N<<2)>>2],(0|P)>0){for(M=0,m=0|kf[k+(N<<2)>>2];;){if(q=l+(m<<3)|0,(0|kf[q>>2])==-1)break;if(M=M+1|0,(0|M)>=(0|P)){B=k,V=y,U=l,G=l,W=l,z=l,H=l,j=l;break e}m=m+1|0}kf[q>>2]=F,kf[x+(m<<3)+4>>2]=y,B=k,V=y,U=x,G=x,W=x,z=x,H=x,j=x}else B=h,V=y,U=X,G=Z,W=f,z=K,H=Q,j=l}while(0);if(y=V+1|0,y>>>0>=e>>>0)break;h=B,s=U,T=G,f=W,b=z,c=H,l=j}return kf[t>>2]=S,k?((0|D)!=(0|k)&&(kf[E>>2]=D+(~((D+-4-k|0)>>>2)<<2)),mf(L),L=0|kf[r>>2],$=L,ee=L):($=x,ee=O),0|$&&(L=0|kf[g>>2],(0|L)!=(0|$)&&(kf[g>>2]=L+(~((L+-8-$|0)>>>3)<<3)),mf(ee)),ee=0|kf[n>>2],0|ee&&(n=0|kf[_>>2],(0|n)!=(0|ee)&&(kf[_>>2]=n+(~((n+-4-ee|0)>>>2)<<2)),mf(ee)),a=1,Xf=i,0|a}function nn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0;if(s=e+8|0,kf[s>>2]=r,n=e+32|0,a=e+36|0,o=0|kf[a>>2],h=0|kf[n>>2],l=o-h>>2,c=h,h=o,l>>>0>=r>>>0?(l>>>0>r>>>0?(o=c+(r<<2)|0,(0|h)!=(0|o)):0)&&(kf[a>>2]=h+(~((h+-4-o|0)>>>2)<<2)):Kr(n,r-l|0),l=r>>>0>1073741823?-1:r<<2,n=0|ff(l),0|Bs(0|n,0,0|l),o=0|ff(l),0|Bs(0|o,0,0|l),l=0|kf[s>>2],(0|l)>0){h=e+16|0,a=e+32|0,c=e+12|0,d=0;do u=0|kf[n+(d<<2)>>2],f=0|kf[h>>2],(0|u)>(0|f)?(p=0|kf[a>>2],kf[p+(d<<2)>>2]=f,_=p):(p=0|kf[c>>2],f=0|kf[a>>2],kf[f+(d<<2)>>2]=(0|u)<(0|p)?p:u,_=f),d=d+1|0,m=0|kf[s>>2];while((0|d)<(0|m));if((0|m)>0){d=e+20|0,a=0;do f=(0|kf[t+(a<<2)>>2])+(0|kf[_+(a<<2)>>2])|0,u=i+(a<<2)|0,kf[u>>2]=f,(0|f)<=(0|kf[h>>2])?(0|f)<(0|kf[c>>2])&&(A=(0|kf[d>>2])+f|0,v=18):(A=f-(0|kf[d>>2])|0,v=18),18==(0|v)&&(v=0,kf[u>>2]=A),a=a+1|0,u=0|kf[s>>2];while((0|a)<(0|u));y=u}else y=m}else y=l;if(l=0|kf[e+48>>2],m=0|kf[e+56>>2],a=m+4|0,A=0|kf[a>>2],d=0|kf[m>>2],c=A-d|0,h=c>>2,(0|c)<=4)return pf(o),pf(n),1;for(c=0|kf[e+52>>2],_=(0|r)>0,u=e+16|0,f=e+32|0,p=e+12|0,g=e+20|0,e=l+12|0,b=r<<2,A-d>>2>>>0>1?(E=d,T=y,S=1):Du(m);;){if(y=0|kf[E+(S<<2)>>2],_&&0|Bs(0|n,0,0|b),(0|y)!=-1){for(d=0|kf[e>>2],A=y,w=0;;){if(C=0|kf[d+(A<<2)>>2],(0|C)!=-1)if(M=0|kf[l>>2],P=0|kf[c>>2],I=0|kf[P+(kf[M+(C<<2)>>2]<<2)>>2],R=C+1|0,x=0==((R>>>0)%3|0|0)?C+-2|0:R,O=(0|x)==-1?-1:0|kf[M+(x<<2)>>2],x=0|kf[P+(O<<2)>>2],R=(0==((C>>>0)%3|0|0)?2:-1)+C|0,k=(0|R)==-1?-1:0|kf[M+(R<<2)>>2],R=0|kf[P+(k<<2)>>2],(0|I)<(0|S)&(0|x)<(0|S)&(0|R)<(0|S)){if(P=0|np(I,r),I=0|np(x,r),x=0|np(R,r),_){R=0;do kf[o+(R<<2)>>2]=(0|kf[i+(R+x<<2)>>2])+(0|kf[i+(R+I<<2)>>2])-(0|kf[i+(R+P<<2)>>2]),R=R+1|0;while((0|R)!=(0|r));if(_){R=0;do P=n+(R<<2)|0,kf[P>>2]=(0|kf[P>>2])+(0|kf[o+(R<<2)>>2]),R=R+1|0;while((0|R)!=(0|r))}}D=w+1|0}else D=w;else D=w;R=(0==((A>>>0)%3|0|0)?2:-1)+A|0;do{if((0|R)!=-1?(P=0|kf[d+(R<<2)>>2],(0|P)!=-1):0){if((P>>>0)%3|0){L=P+-1|0;break}L=P+2|0;break}L=-1}while(0);if(A=(0|L)==(0|y)?-1:L,(0|A)==-1)break;w=D}if(w=0|np(S,r),D){if(_){A=0;do y=n+(A<<2)|0,kf[y>>2]=(0|kf[y>>2])/(0|D)|0,A=A+1|0;while((0|A)!=(0|r))}if(A=t+(w<<2)|0,y=i+(w<<2)|0,(0|T)>0){d=0;do R=0|kf[n+(d<<2)>>2],P=0|kf[u>>2],(0|R)>(0|P)?(I=0|kf[f>>2],kf[I+(d<<2)>>2]=P,N=I):(I=0|kf[p>>2],P=0|kf[f>>2],kf[P+(d<<2)>>2]=(0|R)<(0|I)?I:R,N=P),d=d+1|0,F=0|kf[s>>2];while((0|d)<(0|F));if((0|F)>0){d=0;do P=(0|kf[A+(d<<2)>>2])+(0|kf[N+(d<<2)>>2])|0,R=y+(d<<2)|0,kf[R>>2]=P,(0|P)<=(0|kf[u>>2])?(0|P)<(0|kf[p>>2])&&(B=(0|kf[g>>2])+P|0,v=70):(B=P-(0|kf[g>>2])|0,v=70),70==(0|v)&&(v=0,kf[R>>2]=B),d=d+1|0,R=0|kf[s>>2];while((0|d)<(0|R));V=R}else V=F}else V=T}else U=w,v=48}else U=0|np(S,r),v=48;if(48==(0|v))if(v=0,d=i+((0|np(S+-1|0,r))<<2)|0,y=t+(U<<2)|0,A=i+(U<<2)|0,(0|T)>0){R=0;do P=0|kf[d+(R<<2)>>2],I=0|kf[u>>2],(0|P)>(0|I)?(x=0|kf[f>>2],kf[x+(R<<2)>>2]=I,G=x):(x=0|kf[p>>2],I=0|kf[f>>2],kf[I+(R<<2)>>2]=(0|P)<(0|x)?x:P,G=I),R=R+1|0,W=0|kf[s>>2];while((0|R)<(0|W));if((0|W)>0){R=0;do d=(0|kf[y+(R<<2)>>2])+(0|kf[G+(R<<2)>>2])|0,w=A+(R<<2)|0,kf[w>>2]=d,(0|d)<=(0|kf[u>>2])?(0|d)<(0|kf[p>>2])&&(z=(0|kf[g>>2])+d|0,v=58):(z=d-(0|kf[g>>2])|0,v=58),58==(0|v)&&(v=0,kf[w>>2]=z),R=R+1|0,w=0|kf[s>>2];while((0|R)<(0|w));V=w}else V=W}else V=T;if(S=S+1|0,(0|S)>=(0|h)){v=22;break}if(E=0|kf[m>>2],(0|kf[a>>2])-E>>2>>>0<=S>>>0){v=23;break}T=V}return 22==(0|v)?(pf(o),pf(n),1):(23==(0|v)&&Du(m),0)}function rn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0;if(s=e+8|0,kf[s>>2]=r,n=e+32|0,a=e+36|0,o=0|kf[a>>2],h=0|kf[n>>2],l=o-h>>2,c=h,h=o,l>>>0>=r>>>0?(l>>>0>r>>>0?(o=c+(r<<2)|0,(0|h)!=(0|o)):0)&&(kf[a>>2]=h+(~((h+-4-o|0)>>>2)<<2)):Kr(n,r-l|0),l=r>>>0>1073741823?-1:r<<2,n=0|ff(l),0|Bs(0|n,0,0|l),o=0|ff(l),0|Bs(0|o,0,0|l),l=0|kf[s>>2],(0|l)>0){h=e+16|0,a=e+32|0,c=e+12|0,d=0;do u=0|kf[n+(d<<2)>>2],f=0|kf[h>>2],(0|u)>(0|f)?(p=0|kf[a>>2],kf[p+(d<<2)>>2]=f,_=p):(p=0|kf[c>>2],f=0|kf[a>>2],kf[f+(d<<2)>>2]=(0|u)<(0|p)?p:u,_=f),d=d+1|0,m=0|kf[s>>2];while((0|d)<(0|m));if((0|m)>0){d=e+20|0,a=0;do f=(0|kf[t+(a<<2)>>2])+(0|kf[_+(a<<2)>>2])|0,u=i+(a<<2)|0,kf[u>>2]=f,(0|f)<=(0|kf[h>>2])?(0|f)<(0|kf[c>>2])&&(A=(0|kf[d>>2])+f|0,v=18):(A=f-(0|kf[d>>2])|0,v=18),18==(0|v)&&(v=0,kf[u>>2]=A),a=a+1|0,u=0|kf[s>>2];while((0|a)<(0|u));y=u}else y=m}else y=l;if(l=0|kf[e+48>>2],m=0|kf[e+56>>2],a=m+4|0,A=0|kf[a>>2],d=0|kf[m>>2],c=A-d|0,h=c>>2,(0|c)<=4)return pf(o),pf(n),1;for(c=0|kf[e+52>>2],_=(0|r)>0,u=e+16|0,f=e+32|0,p=e+12|0,g=e+20|0,e=l+64|0,b=l+28|0,E=r<<2,A-d>>2>>>0>1?(T=d,S=y,w=1):Du(m);;){if(y=0|kf[T+(w<<2)>>2],_&&0|Bs(0|n,0,0|E),(0|y)!=-1){for(d=0|kf[l>>2],A=y,C=0;;){if((0==(kf[d+(A>>>5<<2)>>2]&1<<(31&A)|0)?(M=0|kf[(0|kf[(0|kf[e>>2])+12>>2])+(A<<2)>>2],(0|M)!=-1):0)?(P=0|kf[b>>2],I=0|kf[c>>2],R=0|kf[I+(kf[P+(M<<2)>>2]<<2)>>2],x=M+1|0,O=0|kf[I+(kf[P+((0==((x>>>0)%3|0|0)?M+-2|0:x)<<2)>>2]<<2)>>2],x=0|kf[I+(kf[P+((0==((M>>>0)%3|0|0)?2:-1)+M<<2)>>2]<<2)>>2],(0|R)<(0|w)&(0|O)<(0|w)&(0|x)<(0|w)):0){if(M=0|np(R,r),R=0|np(O,r),O=0|np(x,r),_){x=0;do kf[o+(x<<2)>>2]=(0|kf[i+(x+O<<2)>>2])+(0|kf[i+(x+R<<2)>>2])-(0|kf[i+(x+M<<2)>>2]),x=x+1|0;while((0|x)!=(0|r));if(_){x=0;do M=n+(x<<2)|0,kf[M>>2]=(0|kf[M>>2])+(0|kf[o+(x<<2)>>2]),x=x+1|0;while((0|x)!=(0|r))}}k=C+1|0}else k=C;x=(0==((A>>>0)%3|0|0)?2:-1)+A|0;do{if(((0|x)!=-1?0==(kf[d+(x>>>5<<2)>>2]&1<<(31&x)|0):0)?(M=0|kf[(0|kf[(0|kf[e>>2])+12>>2])+(x<<2)>>2],(0|M)!=-1):0){if((M>>>0)%3|0){D=M+-1|0;break}D=M+2|0;break}D=-1}while(0);if(A=(0|D)==(0|y)?-1:D,(0|A)==-1)break;C=k}if(C=0|np(w,r),k){if(_){A=0;do y=n+(A<<2)|0,kf[y>>2]=(0|kf[y>>2])/(0|k)|0,A=A+1|0;while((0|A)!=(0|r))}if(A=t+(C<<2)|0,y=i+(C<<2)|0,(0|S)>0){d=0;do x=0|kf[n+(d<<2)>>2],M=0|kf[u>>2],(0|x)>(0|M)?(R=0|kf[f>>2],kf[R+(d<<2)>>2]=M,L=R):(R=0|kf[p>>2],M=0|kf[f>>2],kf[M+(d<<2)>>2]=(0|x)<(0|R)?R:x,L=M),d=d+1|0,N=0|kf[s>>2];while((0|d)<(0|N));if((0|N)>0){d=0;do M=(0|kf[A+(d<<2)>>2])+(0|kf[L+(d<<2)>>2])|0,x=y+(d<<2)|0,kf[x>>2]=M,(0|M)<=(0|kf[u>>2])?(0|M)<(0|kf[p>>2])&&(F=(0|kf[g>>2])+M|0,v=68):(F=M-(0|kf[g>>2])|0,v=68),68==(0|v)&&(v=0,kf[x>>2]=F),d=d+1|0,x=0|kf[s>>2];while((0|d)<(0|x));B=x}else B=N}else B=S}else V=C,v=46}else V=0|np(w,r),v=46;if(46==(0|v))if(v=0,d=i+((0|np(w+-1|0,r))<<2)|0,y=t+(V<<2)|0,A=i+(V<<2)|0,(0|S)>0){x=0;do M=0|kf[d+(x<<2)>>2],R=0|kf[u>>2],(0|M)>(0|R)?(O=0|kf[f>>2],kf[O+(x<<2)>>2]=R,U=O):(O=0|kf[p>>2],R=0|kf[f>>2],kf[R+(x<<2)>>2]=(0|M)<(0|O)?O:M,U=R),x=x+1|0,G=0|kf[s>>2];while((0|x)<(0|G));if((0|G)>0){x=0;do d=(0|kf[y+(x<<2)>>2])+(0|kf[U+(x<<2)>>2])|0,C=A+(x<<2)|0,kf[C>>2]=d,(0|d)<=(0|kf[u>>2])?(0|d)<(0|kf[p>>2])&&(W=(0|kf[g>>2])+d|0,v=56):(W=d-(0|kf[g>>2])|0,v=56),56==(0|v)&&(v=0,kf[C>>2]=W),x=x+1|0,C=0|kf[s>>2];while((0|x)<(0|C));B=C}else B=G}else B=S;if(w=w+1|0,(0|w)>=(0|h)){v=22;break}if(T=0|kf[m>>2],(0|kf[a>>2])-T>>2>>>0<=w>>>0){v=23;break}S=B}return 22==(0|v)?(pf(o),pf(n),1):(23==(0|v)&&Du(m),0)}function sn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0;if(i=Xf,Xf=Xf+176|0,n=i+136|0,r=i+32|0,s=i,a=i+104|0,o=i+100|0,h=e+4|0,l=0|kf[h>>2],c=0|kf[l+32>>2],u=c+8|0,f=0|kf[u>>2],p=0|kf[u+4>>2],u=c+16|0,_=u,m=0|kf[_>>2],A=0|kf[_+4>>2],!((0|p)>(0|A)|(0|p)==(0|A)&f>>>0>m>>>0))return v=0,Xf=i,0|v;if(_=0|kf[c>>2],c=0|If[_+m>>0],y=0|tc(0|m,0|A,1,0),g=qf,b=u,kf[b>>2]=y,kf[b+4>>2]=g,!((0|p)>(0|g)|(0|p)==(0|g)&f>>>0>y>>>0))return v=0,Xf=i,0|v;if(g=0|If[_+y>>0],y=0|tc(0|m,0|A,2,0),b=qf,E=u,kf[E>>2]=y,kf[E+4>>2]=b,c<<24>>24>-1){if(E=c<<24>>24,T=0|kf[e+216>>2],E>>>0>=(((0|kf[e+220>>2])-T|0)/144|0)>>>0)return v=0,Xf=i,0|v;if(S=T+(144*E|0)|0,(0|kf[S>>2])>-1)return v=0,Xf=i,0|v;w=S}else{if(S=e+212|0,(0|kf[S>>2])>-1)return v=0,Xf=i,0|v;w=S}kf[w>>2]=t;do{if((65535&((0|Lf[l+36>>0])<<8|(0|Lf[l+37>>0])))>257){if((0|p)>(0|b)|(0|p)==(0|b)&f>>>0>y>>>0){w=0|If[_+y>>0],S=0|tc(0|m,0|A,3,0),E=u,kf[E>>2]=S,kf[E+4>>2]=qf,C=255&w;break}return v=0,Xf=i,0|v}C=0}while(0);if(u=0|kf[l+44>>2],g<<24>>24){if(0|C)return v=0,Xf=i,0|v;if(C=c<<24>>24,c<<24>>24<0)return v=0,Xf=i,0|v;c=0|sl(88),P=0|kf[e+216>>2],e=P+(144*C|0)+104|0,kf[c+4>>2]=0,kf[c>>2]=3124,M=c+12|0,kf[M>>2]=3148,g=c+64|0,kf[g>>2]=0,kf[c+68>>2]=0,kf[c+72>>2]=0,l=c+16|0,A=l+44|0;do kf[l>>2]=0,l=l+4|0;while((0|l)<(0|A));kf[c+76>>2]=u,kf[c+80>>2]=e,kf[c+84>>2]=0,m=r+4|0,kf[m>>2]=3148,y=r+56|0,kf[y>>2]=0,_=r+60|0,kf[_>>2]=0,kf[r+64>>2]=0,l=r+8|0,A=l+44|0;do kf[l>>2]=0,l=l+4|0;while((0|l)<(0|A));l=P+(144*C|0)+4|0,kf[s>>2]=3148,A=s+4|0,f=A+4|0,kf[f>>2]=0,kf[f+4>>2]=0,kf[f+8>>2]=0,kf[f+12>>2]=0,kf[f+16>>2]=0,kf[f+20>>2]=0,kf[A>>2]=l,A=0|kf[P+(144*C|0)+68>>2],C=((0|kf[A+4>>2])-(0|kf[A>>2])>>2>>>0)/3|0,If[n>>0]=0,pi(s+8|0,C,n),xp[127&kf[(0|kf[s>>2])+8>>2]](s),lt(a,s),lt(n,a),kf[r>>2]=kf[n+4>>2],C=r+4|0,0|St(C,n),kf[n>>2]=3148,A=0|kf[n+20>>2],0|A&&mf(A),A=0|kf[n+8>>2],0|A&&mf(A),kf[r+36>>2]=l,kf[r+40>>2]=e,kf[r+44>>2]=u,kf[r+48>>2]=c,kf[a>>2]=3148,u=0|kf[a+20>>2],0|u&&mf(u),u=0|kf[a+8>>2],0|u&&mf(u),kf[c+8>>2]=kf[r>>2],0|St(M,C),C=c+44|0,M=r+36|0,kf[C>>2]=kf[M>>2],kf[C+4>>2]=kf[M+4>>2],kf[C+8>>2]=kf[M+8>>2],kf[C+12>>2]=kf[M+12>>2],If[C+16>>0]=0|If[M+16>>0],Mt(g,0|kf[y>>2],0|kf[_>>2]),g=c,kf[s>>2]=3148,c=0|kf[s+20>>2],0|c&&mf(c),c=0|kf[s+8>>2],0|c&&mf(c),c=0|kf[y>>2],0|c&&(y=0|kf[_>>2],(0|y)!=(0|c)&&(kf[_>>2]=y+(~((y+-4-c|0)>>>2)<<2)),mf(c)),kf[m>>2]=3148,m=0|kf[r+24>>2],0|m&&mf(m),m=0|kf[r+12>>2],0|m&&mf(m),I=g}else{switch(c<<24>>24<0?M=e+184|0:(g=c<<24>>24,l=0|kf[e+216>>2],If[l+(144*g|0)+100>>0]=0,M=l+(144*g|0)+104|0),(255&C)<<24>>24){case 0:d(n,e,M),P=0|kf[n>>2];break;case 1:Pe(n,e,M),P=0|kf[n>>2];break;default:return v=0,Xf=i,0|v}if(!P)return v=0,Xf=i,0|v;I=P}if(g=0|sl(64),kf[o>>2]=I,Do(g,o),I=g,m=0|kf[o>>2],kf[o>>2]=0,0|m&&xp[127&kf[(0|kf[m>>2])+4>>2]](m),m=0|kf[h>>2],(0|t)<0)return xp[127&kf[(0|kf[g>>2])+4>>2]](g),v=0,Xf=i,0|v;g=m+8|0,h=m+12|0,m=0|kf[h>>2],o=0|kf[g>>2],r=m-o>>2;do if((0|r)<=(0|t)){if(c=t+1|0,y=m,c>>>0>r>>>0){Ut(g,c-r|0);break}if(c>>>0<r>>>0?(_=o+(c<<2)|0,(0|y)!=(0|_)):0){c=y;do y=c+-4|0,kf[h>>2]=y,s=0|kf[y>>2],kf[y>>2]=0,0|s&&xp[127&kf[(0|kf[s>>2])+4>>2]](s),c=0|kf[h>>2];while((0|c)!=(0|_))}}while(0);return h=(0|kf[g>>2])+(t<<2)|0,t=0|kf[h>>2],kf[h>>2]=I,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),v=1,Xf=i,0|v):(v=1,Xf=i,0|v)}function an(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0;i=Xf,Xf=Xf+16|0,n=i,r=e+144|0,s=0|kf[r>>2],a=0|Cp[127&kf[(0|kf[s>>2])+32>>2]](s);do if((65535&((0|Lf[a+36>>0])<<8|(0|Lf[a+37>>0])))<514){s=e+40|0,o=s,h=e,l=o+40|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));if(0|oi(s,1,n)){o=e,h=s,l=o+40|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));if(s=n,c=0|kf[s>>2],d=0|kf[s+4>>2],s=e+8|0,u=e+16|0,f=u,p=0|kf[f>>2],_=0|kf[f+4>>2],f=0|nc(0|kf[s>>2],0|kf[s+4>>2],0|p,0|_),s=qf,!(d>>>0>s>>>0|(0|d)==(0|s)&c>>>0>f>>>0)){f=0|tc(0|p,0|_,0|c,0|d),d=u,kf[d>>2]=f,kf[d+4>>2]=qf;break}}return m=0,Xf=i,0|m}while(0);do{if(!((0|Ff[e+38>>1])>=514)){a=e+96|0,o=a,h=e,l=o+40|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));if(0|oi(a,1,n)){o=e,h=a,l=o+40|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));if(a=n,d=0|kf[a>>2],f=0|kf[a+4>>2],a=e+8|0,u=e+16|0,c=u,_=0|kf[c>>2],p=0|kf[c+4>>2],c=0|nc(0|kf[a>>2],0|kf[a+4>>2],0|_,0|p),a=qf,!(f>>>0>a>>>0|(0|f)==(0|a)&d>>>0>c>>>0)){c=0|tc(0|_,0|p,0|d,0|f),f=u,kf[f>>2]=c,kf[f+4>>2]=qf;break}}return m=0,Xf=i,0|m}if(!(0|ie(e+80|0,e)))return m=0,Xf=i,0|m}while(0);if(!(0|as(e)))return m=0,Xf=i,0|m;o=t,h=e,l=o+40|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));h=0|kf[r>>2],o=0|Cp[127&kf[(0|kf[h>>2])+32>>2]](h);do{if((65535&((0|Lf[o+36>>0])<<8|(0|Lf[o+37>>0])))<514){if(h=0|kf[r>>2],l=(0|Cp[127&kf[(0|kf[h>>2])+32>>2]](h))+36|0,((0|Lf[l>>0])<<8&65535)<512?(l=t+8|0,h=0|kf[l>>2],f=0|kf[l+4>>2],l=t+16|0,c=l,u=0|kf[c>>2],d=0|tc(0|u,0|kf[c+4>>2],4,0),c=qf,(0|f)<(0|c)|(0|f)==(0|c)&h>>>0<d>>>0||(h=(0|kf[t>>2])+u|0,u=Lf[h>>0]|Lf[h+1>>0]<<8|Lf[h+2>>0]<<16|Lf[h+3>>0]<<24,kf[n>>2]=u,h=l,kf[h>>2]=d,kf[h+4>>2]=c,A=u,v=19)):0|Qs(n,t)&&(A=0|kf[n>>2],v=19),((19==(0|v)?(u=0|kf[e+152>>2],A>>>0<u>>>0):0)?(c=t+8|0,h=0|kf[c+4>>2],d=t+16|0,l=d,f=0|kf[l>>2],p=0|kf[l+4>>2],(0|h)>(0|p)|((0|h)==(0|p)?(0|kf[c>>2])>>>0>f>>>0:0)):0)?(c=0|If[(0|kf[t>>2])+f>>0],h=0|tc(0|f,0|p,1,0),p=d,kf[p>>2]=h,kf[p+4>>2]=qf,c<<24>>24==0):0){kf[e+176>>2]=2,kf[e+180>>2]=7,y=u;break}return m=0,Xf=i,0|m}kf[e+176>>2]=2,kf[e+180>>2]=7,y=0|kf[e+152>>2]}while(0);if((0|y)<0)return m=0,Xf=i,0|m;if(A=e+156|0,kf[n>>2]=0,v=e+160|0,r=0|kf[v>>2],o=0|kf[A>>2],u=r-o>>2,c=o,o=r,y>>>0<=u>>>0?(y>>>0<u>>>0?(r=c+(y<<2)|0,(0|o)!=(0|r)):0)?(kf[v>>2]=o+(~((o+-4-r|0)>>>2)<<2),g=2,b=7):(g=2,b=7):(lr(A,y-u|0,n),g=0|kf[e+176>>2],b=0|kf[e+180>>2]),u=b-g+1|0,g=e+184|0,b=e+188|0,y=0|kf[b>>2],A=0|kf[g>>2],r=(y-A|0)/12|0,o=A,A=y,u>>>0<=r>>>0)if(u>>>0<r>>>0?(v=o+(12*u|0)|0,(0|A)!=(0|v)):0){for(o=A;;){if(A=o+-12|0,kf[b>>2]=A,c=0|kf[A>>2],c?(A=o+-8|0,p=0|kf[A>>2],(0|p)!=(0|c)&&(kf[A>>2]=p+(~((p+-4-c|0)>>>2)<<2)),mf(c),E=0|kf[b>>2]):E=A,(0|E)==(0|v))break;o=E}T=E}else T=y;else ft(g,u-r|0),T=0|kf[b>>2];if(r=e+196|0,u=0|kf[g>>2],y=(T-u|0)/12|0,E=e+200|0,e=0|kf[E>>2],o=0|kf[r>>2],v=e-o>>2,c=o,o=e,y>>>0<=v>>>0?(y>>>0<v>>>0?(e=c+(y<<2)|0,(0|o)!=(0|e)):0)?(kf[E>>2]=o+(~((o+-4-e|0)>>>2)<<2),S=T,w=u):(S=T,w=u):(Kr(r,y-v|0),S=0|kf[b>>2],w=0|kf[g>>2]),(0|S)==(0|w))return m=1,Xf=i,0|m;w=0;do 0|Qs(n,t),S=0|kf[n>>2],0|S&&(v=0|kf[g>>2],y=v+(12*w|0)|0,u=v+(12*w|0)+4|0,T=0|kf[u>>2],e=0|kf[y>>2],o=T-e>>2,E=e,e=T,S>>>0<=o>>>0?(S>>>0<o>>>0?(T=E+(S<<2)|0,(0|e)!=(0|T)):0)?(kf[u>>2]=e+(~((e+-4-T|0)>>>2)<<2),C=v,M=S):(C=v,M=S):(Kr(y,S-o|0),C=0|kf[g>>2],M=0|kf[n>>2]),0|ks(M,1,t,0|kf[C+(12*w|0)>>2]),kf[(0|kf[r>>2])+(w<<2)>>2]=kf[n>>2]),w=w+1|0;while(w>>>0<(((0|kf[b>>2])-(0|kf[g>>2])|0)/12|0)>>>0);return m=1,Xf=i,0|m}function on(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(e){t=e+-8|0,i=0|kf[4120],n=0|kf[e+-4>>2],e=n&-8,r=t+e|0;do if(1&n)c=t,d=t,u=e;else{if(s=0|kf[t>>2],!(3&n))return;if(a=t+(0-s)|0,o=s+e|0,a>>>0<i>>>0)return;if((0|a)==(0|kf[4121])){if(h=r+4|0,l=0|kf[h>>2],3!=(3&l|0)){c=a,d=a,u=o;break}return kf[4118]=o,kf[h>>2]=l&-2,kf[a+4>>2]=1|o,void(kf[a+o>>2]=o)}if(l=s>>>3,s>>>0<256){if(s=0|kf[a+8>>2],h=0|kf[a+12>>2],(0|h)==(0|s)){kf[4116]=kf[4116]&~(1<<l),c=a,d=a,u=o;break}kf[s+12>>2]=h,kf[h+8>>2]=s,c=a,d=a,u=o;break}s=0|kf[a+24>>2],h=0|kf[a+12>>2];do if((0|h)==(0|a)){if(l=a+16|0,f=l+4|0,p=0|kf[f>>2])A=p,v=f;else{if(_=0|kf[l>>2],!_){m=0;break}A=_,v=l}for(;;)if(f=A+20|0,p=0|kf[f>>2],0|p)A=p,v=f;else{if(f=A+16|0,p=0|kf[f>>2],!p)break;A=p,v=f}kf[v>>2]=0,m=A}else f=0|kf[a+8>>2],kf[f+12>>2]=h,kf[h+8>>2]=f,m=h;while(0);if(s){if(h=0|kf[a+28>>2],f=16768+(h<<2)|0,(0|a)==(0|kf[f>>2])){if(kf[f>>2]=m,!m){kf[4117]=kf[4117]&~(1<<h),c=a,d=a,u=o;break}}else if(kf[s+16+(((0|kf[s+16>>2])!=(0|a)&1)<<2)>>2]=m,!m){c=a,d=a,u=o;break}kf[m+24>>2]=s,h=a+16|0,f=0|kf[h>>2],0|f&&(kf[m+16>>2]=f,kf[f+24>>2]=m),f=0|kf[h+4>>2],f?(kf[m+20>>2]=f,kf[f+24>>2]=m,c=a,d=a,u=o):(c=a,d=a,u=o)}else c=a,d=a,u=o}while(0);if(!(c>>>0>=r>>>0)&&(e=r+4|0,t=0|kf[e>>2],1&t)){if(2&t)kf[e>>2]=t&-2,kf[d+4>>2]=1|u,kf[c+u>>2]=u,E=u;else{if(m=0|kf[4121],(0|r)==(0|kf[4122])){if(A=(0|kf[4119])+u|0,kf[4119]=A,kf[4122]=d,kf[d+4>>2]=1|A,(0|d)!=(0|m))return;return kf[4121]=0,void(kf[4118]=0)}if((0|r)==(0|m))return m=(0|kf[4118])+u|0,kf[4118]=m,kf[4121]=c,kf[d+4>>2]=1|m,void(kf[c+m>>2]=m);m=(t&-8)+u|0,A=t>>>3;do{if(t>>>0<256){if(v=0|kf[r+8>>2],i=0|kf[r+12>>2],(0|i)==(0|v)){kf[4116]=kf[4116]&~(1<<A);break}kf[v+12>>2]=i,kf[i+8>>2]=v;break}v=0|kf[r+24>>2],i=0|kf[r+12>>2];do if((0|i)==(0|r)){if(n=r+16|0,f=n+4|0,h=0|kf[f>>2])g=h,b=f;else{if(p=0|kf[n>>2],!p){y=0;break}g=p,b=n}for(;;)if(f=g+20|0,h=0|kf[f>>2],0|h)g=h,b=f;else{if(f=g+16|0,h=0|kf[f>>2],!h)break;g=h,b=f}kf[b>>2]=0,y=g}else f=0|kf[r+8>>2],kf[f+12>>2]=i,kf[i+8>>2]=f,y=i;while(0);if(0|v){if(i=0|kf[r+28>>2],o=16768+(i<<2)|0,(0|r)==(0|kf[o>>2])){if(kf[o>>2]=y,!y){kf[4117]=kf[4117]&~(1<<i);break}}else if(kf[v+16+(((0|kf[v+16>>2])!=(0|r)&1)<<2)>>2]=y,!y)break;kf[y+24>>2]=v,i=r+16|0,o=0|kf[i>>2],0|o&&(kf[y+16>>2]=o,kf[o+24>>2]=y),o=0|kf[i+4>>2],0|o&&(kf[y+20>>2]=o,kf[o+24>>2]=y)}}while(0);if(kf[d+4>>2]=1|m,kf[c+m>>2]=m,(0|d)==(0|kf[4121]))return void(kf[4118]=m);E=m}if(u=E>>>3,E>>>0<256)return c=16504+(u<<1<<2)|0,t=0|kf[4116],e=1<<u,t&e?(e=c+8|0,T=e,S=0|kf[e>>2]):(kf[4116]=t|e,T=c+8|0,S=c),kf[T>>2]=d,kf[S+12>>2]=d,kf[d+8>>2]=S,void(kf[d+12>>2]=c);c=E>>>8,c?E>>>0>16777215?w=31:(S=(c+1048320|0)>>>16&8,T=c<<S,c=(T+520192|0)>>>16&4,e=T<<c,T=(e+245760|0)>>>16&2,t=14-(c|S|T)+(e<<T>>>15)|0,w=E>>>(t+7|0)&1|t<<1):w=0,t=16768+(w<<2)|0,kf[d+28>>2]=w,kf[d+20>>2]=0,kf[d+16>>2]=0,T=0|kf[4117],e=1<<w;do if(T&e){for(S=E<<(31==(0|w)?0:25-(w>>>1)|0),c=0|kf[t>>2];;){if((kf[c+4>>2]&-8|0)==(0|E)){C=73;break}if(M=c+16+(S>>>31<<2)|0,u=0|kf[M>>2],!u){C=72;break}S<<=1,c=u}if(72==(0|C)){kf[M>>2]=d,kf[d+24>>2]=c,kf[d+12>>2]=d,kf[d+8>>2]=d;break}if(73==(0|C)){S=c+8|0,v=0|kf[S>>2],kf[v+12>>2]=d,kf[S>>2]=d,kf[d+8>>2]=v,kf[d+12>>2]=c,kf[d+24>>2]=0;break}}else kf[4117]=T|e,kf[t>>2]=d,kf[d+24>>2]=t,kf[d+12>>2]=d,kf[d+8>>2]=d;while(0);if(d=(0|kf[4124])+-1|0,kf[4124]=d,!d){for(P=16920;;){if(d=0|kf[P>>2],!d)break;P=d+8|0}kf[4124]=-1}}}}function hn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=wp,M=wp,P=wp,I=0,R=0,x=0,O=0;if(i=0|If[t+11>>0],n=i<<24>>24<0,r=n?0|kf[t>>2]:t,s=n?0|kf[t+4>>2]:255&i,s>>>0>3){for(i=r,n=s,a=s;;){if(o=0|np(Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,1540483477),n=(0|np(o>>>24^o,1540483477))^(0|np(n,1540483477)),a=a+-4|0,a>>>0<=3)break;i=i+4|0}i=s+-4|0,a=i&-4,h=r+(a+4)|0,l=n,c=i-a|0}else h=r,l=s,c=s;switch(0|c){case 3:d=Lf[h+2>>0]<<16^l,u=6;break;case 2:d=l,u=6;break;case 1:f=l,u=7;break;default:p=l}6==(0|u)&&(f=Lf[h+1>>0]<<8^d,u=7),7==(0|u)&&(p=0|np(Lf[h>>0]^f,1540483477)),f=0|np(p>>>13^p,1540483477),p=f>>>15^f,f=e+4|0,h=0|kf[f>>2],d=0==(0|h);e:do if(d)m=0;else if(l=h+-1|0,c=0==(l&h|0),_=c?p&l:p>>>0<h>>>0?p:(p>>>0)%(h>>>0)|0,a=0|kf[(0|kf[e>>2])+(_<<2)>>2],0!=(0|a)?(i=0|kf[a>>2],0!=(0|i)):0){if(a=0==(0|s),c){if(a){for(c=i;;){if(n=0|kf[c+4>>2],!((0|n)==(0|p)|(n&l|0)==(0|_))){m=_;break e}if(n=0|If[c+8+11>>0],!(0|(n<<24>>24<0?0|kf[c+12>>2]:255&n))){A=c;break}if(c=0|kf[c>>2],!c){m=_;break e}}return v=A+20|0,0|v}y=i;t:for(;;){if(c=0|kf[y+4>>2],!((0|c)==(0|p)|(c&l|0)==(0|_))){m=_;break e}c=y+8|0,n=0|If[c+11>>0],o=n<<24>>24<0,g=255&n;do if((0|(o?0|kf[y+12>>2]:g))==(0|s)){if(n=0|kf[c>>2],o){if(0|fo(n,r,s))break;A=y,u=63;break t}if((255&n)<<24>>24==(0|If[r>>0])){n=g,b=c,E=r;do{if(n=n+-1|0,b=b+1|0,!n){A=y,u=63;break t}E=E+1|0}while((0|If[b>>0])==(0|If[E>>0]))}}while(0);if(y=0|kf[y>>2],!y){m=_;break e}}if(63==(0|u))return v=A+20|0,0|v}if(a){for(l=i;;){if(c=0|kf[l+4>>2],(0|c)!=(0|p)&&(T=c>>>0<h>>>0?c:(c>>>0)%(h>>>0)|0,(0|T)!=(0|_))){m=_;break e}if(c=0|If[l+8+11>>0],!(0|(c<<24>>24<0?0|kf[l+12>>2]:255&c))){A=l;break}if(l=0|kf[l>>2],!l){m=_;break e}}return v=A+20|0,0|v}S=i;t:for(;;){if(l=0|kf[S+4>>2],(0|l)!=(0|p)&&(w=l>>>0<h>>>0?l:(l>>>0)%(h>>>0)|0,(0|w)!=(0|_))){m=_;break e}l=S+8|0,a=0|If[l+11>>0],c=a<<24>>24<0,g=255&a;do if((0|(c?0|kf[S+12>>2]:g))==(0|s)){if(a=0|kf[l>>2],c){if(0|fo(a,r,s))break;A=S,u=63;break t}if((255&a)<<24>>24==(0|If[r>>0])){a=g,o=l,E=r;do{if(a=a+-1|0,o=o+1|0,!a){A=S,u=63;break t}E=E+1|0}while((0|If[o>>0])==(0|If[E>>0]))}}while(0);if(S=0|kf[S>>2],!S){m=_;break e}}if(63==(0|u))return v=A+20|0,0|v}else m=_;while(0);_=0|sl(24),Ds(_+8|0,t),kf[_+20>>2]=0,kf[_+4>>2]=p,kf[_>>2]=0,t=e+12|0,C=ap(((0|kf[t>>2])+1|0)>>>0),M=ap(h>>>0),P=ap(Gf[e+16>>2]);do if(d|C>ap(M*P)){if(S=1&(h>>>0<3|0!=(h+-1&h|0))|h<<1,r=~~ap(ip(ap(C/P)))>>>0,wr(e,S>>>0<r>>>0?r:S),S=0|kf[f>>2],r=S+-1|0,!(r&S)){I=S,R=r&p;break}p>>>0<S>>>0?(I=S,R=p):(I=S,R=(p>>>0)%(S>>>0)|0)}else I=h,R=m;while(0);return m=(0|kf[e>>2])+(R<<2)|0,R=0|kf[m>>2],R?(kf[_>>2]=kf[R>>2],O=R,u=61):(h=e+8|0,kf[_>>2]=kf[h>>2],kf[h>>2]=_,kf[m>>2]=h,h=0|kf[_>>2],0|h&&(m=0|kf[h+4>>2],h=I+-1|0,x=h&I?m>>>0<I>>>0?m:(m>>>0)%(I>>>0)|0:m&h,O=(0|kf[e>>2])+(x<<2)|0,u=61)),61==(0|u)&&(kf[O>>2]=_),kf[t>>2]=(0|kf[t>>2])+1,A=_,v=A+20|0,0|v}function ln(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0;if(s=e+8|0,kf[s>>2]=r,n=e+32|0,a=e+36|0,o=0|kf[a>>2],h=0|kf[n>>2],l=o-h>>2,c=h,h=o,l>>>0>=r>>>0?(l>>>0>r>>>0?(o=c+(r<<2)|0,(0|h)!=(0|o)):0)?(kf[a>>2]=h+(~((h+-4-o|0)>>>2)<<2),d=r):d=r:(Kr(n,r-l|0),d=0|kf[s>>2]),l=0|kf[e+48>>2],n=0|kf[e+52>>2],o=r>>>0>1073741823?-1:r<<2,h=0|ff(o),0|Bs(0|h,0,0|o),(0|d)>0){o=e+16|0,a=e+32|0,c=e+12|0,u=0;do f=0|kf[h+(u<<2)>>2],p=0|kf[o>>2],(0|f)>(0|p)?(_=0|kf[a>>2],kf[_+(u<<2)>>2]=p,m=_):(_=0|kf[c>>2],p=0|kf[a>>2],kf[p+(u<<2)>>2]=(0|f)<(0|_)?_:f,m=p),u=u+1|0,A=0|kf[s>>2];while((0|u)<(0|A));if((0|A)>0){u=e+20|0,a=0;do p=(0|kf[t+(a<<2)>>2])+(0|kf[m+(a<<2)>>2])|0,f=i+(a<<2)|0,kf[f>>2]=p,(0|p)<=(0|kf[o>>2])?(0|p)<(0|kf[c>>2])&&(v=(0|kf[u>>2])+p|0,y=18):(v=p-(0|kf[u>>2])|0,y=18),18==(0|y)&&(y=0,kf[f>>2]=v),a=a+1|0,f=0|kf[s>>2];while((0|a)<(0|f));g=f}else g=A}else g=d;if(d=0|kf[e+56>>2],A=0|kf[d>>2],a=(0|kf[d+4>>2])-A|0,v=a>>2,(0|a)<=4)return pf(h),1;for(a=e+16|0,u=e+32|0,c=e+12|0,o=e+20|0,e=l+12|0,m=(0|r)>0,f=A,A=g,g=1;;){if(v>>>0<=g>>>0){y=24;break}if(p=0|kf[f+(g<<2)>>2],_=0|np(g,r),(0|p)!=-1?(b=0|kf[(0|kf[e>>2])+(p<<2)>>2],(0|b)!=-1):0)if(p=0|kf[l>>2],E=0|kf[n>>2],T=0|kf[E+(kf[p+(b<<2)>>2]<<2)>>2],S=b+1|0,w=0==((S>>>0)%3|0|0)?b+-2|0:S,C=(0|w)==-1?-1:0|kf[p+(w<<2)>>2],w=0|kf[E+(C<<2)>>2],S=(0==((b>>>0)%3|0|0)?2:-1)+b|0,M=(0|S)==-1?-1:0|kf[p+(S<<2)>>2],S=0|kf[E+(M<<2)>>2],(0|T)<(0|g)&(0|w)<(0|g)&(0|S)<(0|g)){if(E=0|np(T,r),T=0|np(w,r),w=0|np(S,r),m){S=0;do kf[h+(S<<2)>>2]=(0|kf[i+(S+w<<2)>>2])+(0|kf[i+(S+T<<2)>>2])-(0|kf[i+(S+E<<2)>>2]),S=S+1|0;while((0|S)!=(0|r))}if(S=t+(_<<2)|0,E=i+(_<<2)|0,(0|A)>0){T=0;do w=0|kf[h+(T<<2)>>2],p=0|kf[a>>2],(0|w)>(0|p)?(b=0|kf[u>>2],kf[b+(T<<2)>>2]=p,P=b):(b=0|kf[c>>2],p=0|kf[u>>2],kf[p+(T<<2)>>2]=(0|w)<(0|b)?b:w,P=p),T=T+1|0,I=0|kf[s>>2];while((0|T)<(0|I));if((0|I)>0){T=0;do p=(0|kf[S+(T<<2)>>2])+(0|kf[P+(T<<2)>>2])|0,w=E+(T<<2)|0,kf[w>>2]=p,(0|p)<=(0|kf[a>>2])?(0|p)<(0|kf[c>>2])&&(R=(0|kf[o>>2])+p|0,y=56):(R=p-(0|kf[o>>2])|0,y=56),56==(0|y)&&(y=0,kf[w>>2]=R),T=T+1|0,w=0|kf[s>>2];while((0|T)<(0|w));x=w}else x=I}else x=A}else y=34;else y=34;if(34==(0|y))if(y=0,T=i+((0|np(g+-1|0,r))<<2)|0,E=t+(_<<2)|0,S=i+(_<<2)|0,(0|A)>0){w=0;do p=0|kf[T+(w<<2)>>2],b=0|kf[a>>2],(0|p)>(0|b)?(O=0|kf[u>>2],kf[O+(w<<2)>>2]=b,k=O):(O=0|kf[c>>2],b=0|kf[u>>2],kf[b+(w<<2)>>2]=(0|p)<(0|O)?O:p,k=b),w=w+1|0,D=0|kf[s>>2];while((0|w)<(0|D));if((0|D)>0){w=0;do T=(0|kf[E+(w<<2)>>2])+(0|kf[k+(w<<2)>>2])|0,_=S+(w<<2)|0,kf[_>>2]=T,(0|T)<=(0|kf[a>>2])?(0|T)<(0|kf[c>>2])&&(L=(0|kf[o>>2])+T|0,y=44):(L=T-(0|kf[o>>2])|0,y=44),44==(0|y)&&(y=0,kf[_>>2]=L),w=w+1|0,_=0|kf[s>>2];while((0|w)<(0|_));x=_}else x=D}else x=A;if(g=g+1|0,(0|g)>=(0|v)){y=22;break}A=x}return 22==(0|y)?(pf(h),1):(24==(0|y)&&Du(d),0)}function cn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0;if(s=e+8|0,kf[s>>2]=r,n=e+32|0,a=e+36|0,o=0|kf[a>>2],h=0|kf[n>>2],l=o-h>>2,c=h,h=o,l>>>0>=r>>>0?(l>>>0>r>>>0?(o=c+(r<<2)|0,(0|h)!=(0|o)):0)?(kf[a>>2]=h+(~((h+-4-o|0)>>>2)<<2),d=r):d=r:(Kr(n,r-l|0),d=0|kf[s>>2]),l=0|kf[e+48>>2],n=0|kf[e+52>>2],o=r>>>0>1073741823?-1:r<<2,h=0|ff(o),0|Bs(0|h,0,0|o),(0|d)>0){o=e+16|0,a=e+32|0,c=e+12|0,u=0;do f=0|kf[h+(u<<2)>>2],p=0|kf[o>>2],(0|f)>(0|p)?(_=0|kf[a>>2],kf[_+(u<<2)>>2]=p,m=_):(_=0|kf[c>>2],p=0|kf[a>>2],kf[p+(u<<2)>>2]=(0|f)<(0|_)?_:f,m=p),u=u+1|0,A=0|kf[s>>2];while((0|u)<(0|A));if((0|A)>0){u=e+20|0,a=0;do p=(0|kf[t+(a<<2)>>2])+(0|kf[m+(a<<2)>>2])|0,f=i+(a<<2)|0,kf[f>>2]=p,(0|p)<=(0|kf[o>>2])?(0|p)<(0|kf[c>>2])&&(v=(0|kf[u>>2])+p|0,y=18):(v=p-(0|kf[u>>2])|0,y=18),18==(0|y)&&(y=0,kf[f>>2]=v),a=a+1|0,f=0|kf[s>>2];while((0|a)<(0|f));g=f}else g=A}else g=d;if(d=0|kf[e+56>>2],A=0|kf[d>>2],a=(0|kf[d+4>>2])-A|0,v=a>>2,(0|a)<=4)return pf(h),1;for(a=e+16|0,u=e+32|0,c=e+12|0,o=e+20|0,e=l+64|0,m=l+28|0,f=(0|r)>0,p=A,A=g,g=1;;){if(v>>>0<=g>>>0){y=24;break}if(_=0|kf[p+(g<<2)>>2],b=0|np(g,r),(((0|_)!=-1?0==(kf[(0|kf[l>>2])+(_>>>5<<2)>>2]&1<<(31&_)|0):0)?(E=0|kf[(0|kf[(0|kf[e>>2])+12>>2])+(_<<2)>>2],(0|E)!=-1):0)?(_=0|kf[m>>2],T=0|kf[n>>2],S=0|kf[T+(kf[_+(E<<2)>>2]<<2)>>2],w=E+1|0,C=0|kf[T+(kf[_+((0==((w>>>0)%3|0|0)?E+-2|0:w)<<2)>>2]<<2)>>2],w=0|kf[T+(kf[_+((0==((E>>>0)%3|0|0)?2:-1)+E<<2)>>2]<<2)>>2],(0|S)<(0|g)&(0|C)<(0|g)&(0|w)<(0|g)):0){if(E=0|np(S,r),S=0|np(C,r),C=0|np(w,r),f){w=0;do kf[h+(w<<2)>>2]=(0|kf[i+(w+C<<2)>>2])+(0|kf[i+(w+S<<2)>>2])-(0|kf[i+(w+E<<2)>>2]),w=w+1|0;while((0|w)!=(0|r))}if(w=t+(b<<2)|0,E=i+(b<<2)|0,(0|A)>0){S=0;do C=0|kf[h+(S<<2)>>2],_=0|kf[a>>2],(0|C)>(0|_)?(T=0|kf[u>>2],kf[T+(S<<2)>>2]=_,M=T):(T=0|kf[c>>2],_=0|kf[u>>2],kf[_+(S<<2)>>2]=(0|C)<(0|T)?T:C,M=_),S=S+1|0,P=0|kf[s>>2];while((0|S)<(0|P));if((0|P)>0){S=0;do _=(0|kf[w+(S<<2)>>2])+(0|kf[M+(S<<2)>>2])|0,C=E+(S<<2)|0,kf[C>>2]=_,(0|_)<=(0|kf[a>>2])?(0|_)<(0|kf[c>>2])&&(I=(0|kf[o>>2])+_|0,y=53):(I=_-(0|kf[o>>2])|0,y=53),53==(0|y)&&(y=0,kf[C>>2]=I),S=S+1|0,C=0|kf[s>>2];while((0|S)<(0|C));R=C}else R=P}else R=A}else if(S=i+((0|np(g+-1|0,r))<<2)|0,E=t+(b<<2)|0,w=i+(b<<2)|0,(0|A)>0){C=0;do _=0|kf[S+(C<<2)>>2],T=0|kf[a>>2],(0|_)>(0|T)?(x=0|kf[u>>2],kf[x+(C<<2)>>2]=T,O=x):(x=0|kf[c>>2],T=0|kf[u>>2],kf[T+(C<<2)>>2]=(0|_)<(0|x)?x:_,O=T),C=C+1|0,k=0|kf[s>>2];while((0|C)<(0|k));if((0|k)>0){C=0;do S=(0|kf[E+(C<<2)>>2])+(0|kf[O+(C<<2)>>2])|0,b=w+(C<<2)|0,kf[b>>2]=S,(0|S)<=(0|kf[a>>2])?(0|S)<(0|kf[c>>2])&&(D=(0|kf[o>>2])+S|0,y=41):(D=S-(0|kf[o>>2])|0,y=41),41==(0|y)&&(y=0,kf[b>>2]=D),C=C+1|0,b=0|kf[s>>2];while((0|C)<(0|b));R=b}else R=k}else R=A;if(g=g+1|0,(0|g)>=(0|v)){y=22;break}A=R}return 22==(0|y)?(pf(h),1):(24==(0|y)&&Du(d),0)}function dn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0;if(n=Xf,Xf=Xf+672|0,r=n,s=n+656|0,a=n+4|0,o=t+8|0,h=o,l=0|kf[h>>2],c=0|kf[h+4>>2],h=t+16|0,d=h,u=0|kf[d>>2],f=0|tc(0|u,0|kf[d+4>>2],4,0),d=qf,(0|c)<(0|d)|(0|c)==(0|d)&l>>>0<f>>>0)return p=0,Xf=n,0|p;if(f=(0|kf[t>>2])+u|0,u=Lf[f>>0]|Lf[f+1>>0]<<8|Lf[f+2>>0]<<16|Lf[f+3>>0]<<24,If[e>>0]=u,If[e+1>>0]=u>>8,If[e+2>>0]=u>>16,If[e+3>>0]=u>>24,f=h,l=0|kf[f>>2],d=0|kf[f+4>>2],f=0|tc(0|l,0|d,4,0),c=h,kf[c>>2]=f,kf[c+4>>2]=qf,u>>>0>31)return p=0,Xf=n,0|p;if(u=o,c=0|kf[u>>2],_=0|kf[u+4>>2],u=0|tc(0|l,0|d,8,0),d=qf,(0|_)<(0|d)|(0|_)==(0|d)&c>>>0<u>>>0)return p=0,Xf=n,0|p;if(u=e+4|0,c=(0|kf[t>>2])+f|0,f=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,If[u>>0]=f,If[u+1>>0]=f>>8,If[u+2>>0]=f>>16,If[u+3>>0]=f>>24,f=h,u=0|kf[f>>2],c=0|kf[f+4>>2],f=0|tc(0|u,0|c,4,0),d=h,kf[d>>2]=f,kf[d+4>>2]=qf,d=e+12|0,_=o,l=0|kf[_>>2],m=0|kf[_+4>>2],_=0|tc(0|u,0|c,8,0),c=qf,(0|m)<(0|c)|(0|m)==(0|c)&l>>>0<_>>>0)return p=0,Xf=n,0|p;if(_=(0|kf[t>>2])+f|0,f=Lf[_>>0]|Lf[_+1>>0]<<8|Lf[_+2>>0]<<16|Lf[_+3>>0]<<24,If[d>>0]=f,If[d+1>>0]=f>>8,If[d+2>>0]=f>>16,
If[d+3>>0]=f>>24,_=h,l=0|kf[_>>2],c=0|kf[_+4>>2],_=0|tc(0|l,0|c,4,0),m=h,kf[m>>2]=_,kf[m+4>>2]=qf,m=e+16|0,e=o,o=0|kf[e>>2],u=0|kf[e+4>>2],e=0|tc(0|l,0|c,8,0),c=qf,(0|u)<(0|c)|(0|u)==(0|c)&o>>>0<e>>>0)return p=0,Xf=n,0|p;if(e=(0|kf[t>>2])+_|0,_=Lf[e>>0]|Lf[e+1>>0]<<8|Lf[e+2>>0]<<16|Lf[e+3>>0]<<24,If[m>>0]=_,If[m+1>>0]=_>>8,If[m+2>>0]=_>>16,If[m+3>>0]=_>>24,e=h,o=0|tc(0|kf[e>>2],0|kf[e+4>>2],4,0),e=h,kf[e>>2]=o,kf[e+4>>2]=qf,_>>>0>6)return kf[r>>2]=_,0|Xl(13331,r),p=0,Xf=n,0|p;kf[s>>2]=i;e:do if(f)switch(As(i,f),0|kf[m>>2]){case 0:it(a,3),0|Te(a,t,s),st(a),A=17;break e;case 1:it(a,3),0|Ee(a,t,s),st(a),A=17;break e;case 2:rt(a,3),0|we(a,t,s),dt(a),A=17;break e;case 3:rt(a,3),0|Se(a,t,s),dt(a),A=17;break e;case 4:et(a,3),0|oe(a,t,s),Je(a),A=17;break e;case 5:et(a,3),0|ae(a,t,s),Je(a),A=17;break e;case 6:et(a,3),0|se(a,t,s),Je(a),A=17;break e;default:v=0;break e}else A=17;while(0);return 17==(0|A)&&(v=(((0|kf[i+4>>2])-(0|kf[i>>2])|0)/12|0|0)==(0|kf[d>>2])),p=v,Xf=n,0|p}function un(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;if(n=Xf,Xf=Xf+16|0,r=n,s=t+8|0,a=s,o=0|kf[a>>2],h=0|kf[a+4>>2],a=t+16|0,l=a,c=0|kf[l>>2],d=0|tc(0|c,0|kf[l+4>>2],5,0),l=qf,(0|h)<(0|l)|(0|h)==(0|l)&o>>>0<d>>>0){d=0|sl(32),kf[r>>2]=d,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=d,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[d+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(d=(0|kf[t>>2])+c|0,If[i>>0]=0|If[d>>0],If[i+1>>0]=0|If[d+1>>0],If[i+2>>0]=0|If[d+2>>0],If[i+3>>0]=0|If[d+3>>0],If[i+4>>0]=0|If[d+4>>0],d=a,c=0|tc(0|kf[d>>2],0|kf[d+4>>2],5,0),d=qf,o=a,kf[o>>2]=c,kf[o+4>>2]=d,0|fo(i,12975,5)){o=0|sl(32),kf[r>>2]=o,kf[r+8>>2]=-2147483616,kf[r+4>>2]=17,u=o,f=12981,p=u+17|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[o+17>>0]=0,kf[e>>2]=-1,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(o=s,l=0|kf[o+4>>2],!((0|l)>(0|d)|((0|l)==(0|d)?(0|kf[o>>2])>>>0>c>>>0:0))){o=0|sl(32),kf[r>>2]=o,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=o,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[o+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(If[i+5>>0]=0|If[(0|kf[t>>2])+c>>0],c=a,o=0|tc(0|kf[c>>2],0|kf[c+4>>2],1,0),c=qf,d=a,kf[d>>2]=o,kf[d+4>>2]=c,d=s,l=0|kf[d+4>>2],!((0|l)>(0|c)|((0|l)==(0|c)?(0|kf[d>>2])>>>0>o>>>0:0))){d=0|sl(32),kf[r>>2]=d,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=d,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[d+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(If[i+6>>0]=0|If[(0|kf[t>>2])+o>>0],o=a,d=0|tc(0|kf[o>>2],0|kf[o+4>>2],1,0),o=qf,c=a,kf[c>>2]=d,kf[c+4>>2]=o,c=s,l=0|kf[c+4>>2],!((0|l)>(0|o)|((0|l)==(0|o)?(0|kf[c>>2])>>>0>d>>>0:0))){c=0|sl(32),kf[r>>2]=c,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=c,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[c+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(If[i+7>>0]=0|If[(0|kf[t>>2])+d>>0],d=a,c=0|tc(0|kf[d>>2],0|kf[d+4>>2],1,0),d=qf,o=a,kf[o>>2]=c,kf[o+4>>2]=d,o=s,l=0|kf[o+4>>2],!((0|l)>(0|d)|((0|l)==(0|d)?(0|kf[o>>2])>>>0>c>>>0:0))){o=0|sl(32),kf[r>>2]=o,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=o,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));return If[o+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=n)}if(If[i+8>>0]=0|If[(0|kf[t>>2])+c>>0],c=a,o=0|kf[c>>2],d=0|kf[c+4>>2],c=0|tc(0|o,0|d,1,0),l=a,kf[l>>2]=c,kf[l+4>>2]=qf,l=s,s=0|kf[l>>2],h=0|kf[l+4>>2],l=0|tc(0|o,0|d,3,0),d=qf,!((0|h)<(0|d)|(0|h)==(0|d)&s>>>0<l>>>0))return l=i+10|0,i=(0|kf[t>>2])+c|0,c=Lf[i>>0]|Lf[i+1>>0]<<8,If[l>>0]=c,If[l+1>>0]=c>>8,c=a,l=0|tc(0|kf[c>>2],0|kf[c+4>>2],2,0),c=a,kf[c>>2]=l,kf[c+4>>2]=qf,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,void(Xf=n);c=0|sl(32),kf[r>>2]=c,kf[r+8>>2]=-2147483616,kf[r+4>>2]=29,u=c,f=12945,p=u+29|0;do If[u>>0]=0|If[f>>0],u=u+1|0,f=f+1|0;while((0|u)<(0|p));If[c+29>>0]=0,kf[e>>2]=-2,Ds(e+4|0,r),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),Xf=n}function fn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0;i=Xf,Xf=Xf+80|0,n=i+76|0,r=i,s=i+72|0,a=i+64|0,o=i+68|0,h=e+28|0;do{if(((0|Lf[(0|kf[h>>2])+36>>0])<<8&65535)<512){if(l=t+8|0,c=0|kf[l>>2],d=0|kf[l+4>>2],l=t+16|0,u=l,f=0|kf[u>>2],p=0|tc(0|f,0|kf[u+4>>2],4,0),u=qf,(0|d)<(0|u)|(0|d)==(0|u)&c>>>0<p>>>0)return _=0,Xf=i,0|_;c=(0|kf[t>>2])+f|0,f=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,kf[n>>2]=f,c=l,kf[c>>2]=p,kf[c+4>>2]=u,m=f;break}if(0|Qs(n,t)){m=0|kf[n>>2];break}return _=0,Xf=i,0|_}while(0);if(!m)return _=0,Xf=i,0|_;if(f=e+4|0,u=e+8|0,c=0|kf[u>>2],p=0|kf[f>>2],l=c-p>>2,d=p,p=c,m>>>0>l>>>0){if(Kr(f,m-l|0),!(0|kf[n>>2]))return _=1,Xf=i,0|_}else(m>>>0<l>>>0?(l=d+(m<<2)|0,(0|p)!=(0|l)):0)&&(kf[u>>2]=p+(~((p+-4-l|0)>>>2)<<2));for(l=0|kf[e+32>>2],p=t+8|0,u=t+16|0,m=r+60|0,d=l+8|0,c=e+16|0,A=e+20|0,e=0;;){if(v=p,y=0|kf[v>>2],g=0|kf[v+4>>2],v=u,b=0|kf[v>>2],E=0|kf[v+4>>2],!((0|g)>(0|E)|(0|g)==(0|E)&y>>>0>b>>>0)){_=0,T=49;break}if(v=0|kf[t>>2],S=0|If[v+b>>0],w=0|tc(0|b,0|E,1,0),C=qf,M=u,kf[M>>2]=w,kf[M+4>>2]=C,!((0|g)>(0|C)|(0|g)==(0|C)&y>>>0>w>>>0)){_=0,T=49;break}if(C=0|If[v+w>>0],w=0|tc(0|b,0|E,2,0),M=qf,P=u,kf[P>>2]=w,kf[P+4>>2]=M,!((0|g)>(0|M)|(0|g)==(0|M)&y>>>0>w>>>0)){_=0,T=49;break}if(M=0|If[v+w>>0],w=0|tc(0|b,0|E,3,0),P=qf,I=u,kf[I>>2]=w,kf[I+4>>2]=P,!((0|g)>(0|P)|(0|g)==(0|P)&y>>>0>w>>>0)){_=0,T=49;break}if(y=0|If[v+w>>0],w=0|tc(0|b,0|E,4,0),E=u,kf[E>>2]=w,kf[E+4>>2]=qf,E=255&C,(C+-1&255)>10){_=0,T=49;break}if(Qo(r),C=0|np(0|oh(E),255&M),ia(r,255&S,0,M,E,y<<24>>24!=0,C,((0|C)<0)<<31>>31,0,0),C=0|kf[h>>2],(65535&((0|Lf[C+36>>0])<<8|(0|Lf[C+37>>0])))<259){if(C=p,y=0|kf[C>>2],E=0|kf[C+4>>2],C=u,M=0|kf[C>>2],S=0|tc(0|M,0|kf[C+4>>2],2,0),C=qf,(0|E)<(0|C)|(0|E)==(0|C)&y>>>0<S>>>0){T=47;break}y=(0|kf[t>>2])+M|0,M=Lf[y>>0]|Lf[y+1>>0]<<8,y=u,kf[y>>2]=S,kf[y+4>>2]=C,C=65535&M,kf[s>>2]=C,R=C}else 0|Qs(s,t),R=0|kf[s>>2];if(kf[m>>2]=R,C=0|sl(96),Lo(C,r),kf[a>>2]=C,C=0|bi(l,a),M=0|kf[a>>2],kf[a>>2]=0,0|M&&(y=M+88|0,S=0|kf[y>>2],kf[y>>2]=0,0|S&&(y=0|kf[S+8>>2],0|y&&(E=S+12|0,(0|kf[E>>2])!=(0|y)&&(kf[E>>2]=y),mf(y)),mf(S)),S=0|kf[M+68>>2],0|S&&(y=M+72|0,E=0|kf[y>>2],(0|E)!=(0|S)&&(kf[y>>2]=E+(~((E+-4-S|0)>>>2)<<2)),mf(S)),S=M+64|0,E=0|kf[S>>2],kf[S>>2]=0,0|E&&(S=0|kf[E>>2],0|S&&(y=E+4|0,(0|kf[y>>2])!=(0|S)&&(kf[y>>2]=S),mf(S)),mf(E)),mf(M)),kf[(0|kf[(0|kf[d>>2])+(C<<2)>>2])+60>>2]=kf[s>>2],kf[(0|kf[f>>2])+(e<<2)>>2]=C,M=0|kf[A>>2],E=0|kf[c>>2],S=M-E>>2,y=E,(0|C)<(0|S)?x=y:(E=C+1|0,kf[o>>2]=-1,w=M,E>>>0<=S>>>0?(E>>>0<S>>>0?(M=y+(E<<2)|0,(0|w)!=(0|M)):0)?(kf[A>>2]=w+(~((w+-4-M|0)>>>2)<<2),O=y):O=y:(lr(c,E-S|0,o),O=0|kf[c>>2]),x=O),kf[x+(C<<2)>>2]=e,e=e+1|0,e>>>0>=(0|kf[n>>2])>>>0){_=1,T=49;break}}return 47==(0|T)?(_=0,Xf=i,0|_):49==(0|T)?(Xf=i,0|_):0}function pn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0;if(!((0|t)<0||(i=e+12|0,n=0|kf[i>>2],r=0|kf[e+8>>2],s=r,a=n,n-r>>2>>>0<=t>>>0))){if(r=s+(t<<2)|0,n=0|kf[(0|kf[r>>2])+56>>2],o=0|kf[(0|kf[s+(t<<2)>>2])+60>>2],s=r+4|0,(0|s)!=(0|a)){h=s,s=r;do l=0|kf[h>>2],kf[h>>2]=0,c=0|kf[s>>2],kf[s>>2]=l,0|c&&(l=c+88|0,d=0|kf[l>>2],kf[l>>2]=0,0|d&&(l=0|kf[d+8>>2],0|l&&(u=d+12|0,(0|kf[u>>2])!=(0|l)&&(kf[u>>2]=l),mf(l)),mf(d)),d=0|kf[c+68>>2],0|d&&(l=c+72|0,u=0|kf[l>>2],(0|u)!=(0|d)&&(kf[l>>2]=u+(~((u+-4-d|0)>>>2)<<2)),mf(d)),d=c+64|0,u=0|kf[d>>2],kf[d>>2]=0,0|u&&(d=0|kf[u>>2],0|d&&(l=u+4|0,(0|kf[l>>2])!=(0|d)&&(kf[l>>2]=d),mf(d)),mf(u)),mf(c)),h=h+4|0,s=s+4|0;while((0|h)!=(0|a));h=0|kf[i>>2],(0|h)!=(0|s)&&(f=h,p=s,_=24)}else f=a,p=r,_=24;if(24==(0|_)){_=f;do f=_+-4|0,kf[i>>2]=f,r=0|kf[f>>2],kf[f>>2]=0,0|r&&(f=r+88|0,a=0|kf[f>>2],kf[f>>2]=0,0|a&&(f=0|kf[a+8>>2],0|f&&(s=a+12|0,(0|kf[s>>2])!=(0|f)&&(kf[s>>2]=f),mf(f)),mf(a)),a=0|kf[r+68>>2],0|a&&(f=r+72|0,s=0|kf[f>>2],(0|s)!=(0|a)&&(kf[f>>2]=s+(~((s+-4-a|0)>>>2)<<2)),mf(a)),a=r+64|0,s=0|kf[a>>2],kf[a>>2]=0,0|s&&(a=0|kf[s>>2],0|a&&(f=s+4|0,(0|kf[f>>2])!=(0|a)&&(kf[f>>2]=a),mf(a)),mf(s)),mf(r)),_=0|kf[i>>2];while((0|_)!=(0|p))}p=0|kf[e+4>>2];e:do if(0|p){for(_=p+44|0,i=0|kf[_>>2],r=0|kf[p+40>>2];;){if((0|r)==(0|i))break e;if(m=r+4|0,(0|kf[(0|kf[r>>2])+40>>2])==(0|o))break;r=m}if((0|m)!=(0|i)){s=m,a=r;do f=0|kf[s>>2],kf[s>>2]=0,h=0|kf[a>>2],kf[a>>2]=f,0|h&&(vs(h),mf(h)),s=s+4|0,a=a+4|0;while((0|s)!=(0|i));if(s=0|kf[_>>2],(0|s)==(0|a))break;A=s,v=a}else A=i,v=r;s=A;do h=s+-4|0,kf[_>>2]=h,f=0|kf[h>>2],kf[h>>2]=0,0|f&&(vs(f),mf(f)),s=0|kf[_>>2];while((0|s)!=(0|v))}while(0);e:do if((0|n)<5){v=0|kf[e+20+(12*n|0)>>2],A=e+20+(12*n|0)+4|0,m=0|kf[A>>2],o=m;t:do if((0|v)==(0|m))y=v;else for(p=v;;){if((0|kf[p>>2])==(0|t)){y=p;break t}if(p=p+4|0,(0|p)==(0|m))break e}while(0);(0|y)!=(0|m)&&(v=y+4|0,p=o-v|0,s=p>>2,s?(0|Sh(0|y,0|v,0|p),g=0|kf[A>>2]):g=m,p=y+(s<<2)|0,(0|g)!=(0|p)&&(kf[A>>2]=g+(~((g+-4-p|0)>>>2)<<2)))}while(0);if(g=0|kf[e+24>>2],y=0|kf[e+20>>2],n=y,(0|g)!=(0|y)){p=g-y>>2,y=0;do g=n+(y<<2)|0,s=0|kf[g>>2],(0|s)>(0|t)&&(kf[g>>2]=s+-1),y=y+1|0;while(y>>>0<p>>>0)}if(p=0|kf[e+36>>2],y=0|kf[e+32>>2],n=y,(0|p)!=(0|y)){s=p-y>>2,y=0;do p=n+(y<<2)|0,g=0|kf[p>>2],(0|g)>(0|t)&&(kf[p>>2]=g+-1),y=y+1|0;while(y>>>0<s>>>0)}if(s=0|kf[e+48>>2],y=0|kf[e+44>>2],n=y,(0|s)!=(0|y)){g=s-y>>2,y=0;do s=n+(y<<2)|0,p=0|kf[s>>2],(0|p)>(0|t)&&(kf[s>>2]=p+-1),y=y+1|0;while(y>>>0<g>>>0)}if(g=0|kf[e+60>>2],y=0|kf[e+56>>2],n=y,(0|g)!=(0|y)){p=g-y>>2,y=0;do g=n+(y<<2)|0,s=0|kf[g>>2],(0|s)>(0|t)&&(kf[g>>2]=s+-1),y=y+1|0;while(y>>>0<p>>>0)}if(p=0|kf[e+72>>2],y=0|kf[e+68>>2],e=y,(0|p)!=(0|y)){n=p-y>>2,y=0;do p=e+(y<<2)|0,s=0|kf[p>>2],(0|s)>(0|t)&&(kf[p>>2]=s+-1),y=y+1|0;while(y>>>0<n>>>0)}}}function _n(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=wp,v=wp,y=wp,g=wp,b=0,E=0,T=0,S=wp,w=wp,C=wp,M=wp,P=wp,I=wp,R=wp,x=wp,O=wp,k=wp,D=wp,L=0,N=0;if(r=Xf,Xf=Xf+48|0,s=r+40|0,a=r+36|0,o=r+24|0,h=r+12|0,l=r,c=e+48|0,d=0|kf[t>>2],t=d+1|0,(0|d)!=-1?(u=0==((t>>>0)%3|0|0)?d+-2|0:t,t=d+(0==((d>>>0)%3|0|0)?2:-1)|0,f=(0|u)==-1?-1:0|kf[(0|kf[kf[c>>2]>>2])+(u<<2)>>2],(0|t)==-1?(p=-1,_=f):(p=0|kf[(0|kf[kf[c>>2]>>2])+(t<<2)>>2],_=f)):(p=-1,_=-1),f=0|kf[e+52>>2],t=0|kf[f>>2],c=(0|kf[f+4>>2])-t>>2,c>>>0<=_>>>0&&Du(f),u=t,t=0|kf[u+(_<<2)>>2],c>>>0<=p>>>0&&Du(f),f=0|kf[u+(p<<2)>>2],p=(0|t)<(0|n),!(p&(0|f)<(0|n))){do{if(!p){if((0|n)>0){m=n+-1|0;break}if(u=e+72|0,(0|kf[u>>2])<=0)return void(Xf=r);c=0|kf[e+68>>2],_=0;do kf[c+(_<<2)>>2]=0,_=_+1|0;while((0|_)<(0|kf[u>>2]));return void(Xf=r)}m=t}while(0);if(p=e+72|0,u=0|kf[p>>2],_=0|np(u,m),(0|u)<=0)return void(Xf=r);u=0|kf[e+68>>2],m=0;do kf[u+(m<<2)>>2]=kf[i+(m+_<<2)>>2],m=m+1|0;while((0|m)<(0|kf[p>>2]));return void(Xf=r)}return p=0|kf[e+72>>2],m=0|np(p,t),A=ap(0|kf[i+(m<<2)>>2]),v=ap(0|kf[i+(m+1<<2)>>2]),m=0|np(p,f),y=ap(0|kf[i+(m<<2)>>2]),g=ap(0|kf[i+(m+1<<2)>>2]),y!=A|g!=v?(m=e+64|0,i=0|kf[(0|kf[m>>2])+(n<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,n=e+60|0,p=0|kf[n>>2],b=0|If[p+84>>0]?i:0|kf[(0|kf[p+68>>2])+(i<<2)>>2],kf[a>>2]=b,b=0|If[p+24>>0],kf[s>>2]=kf[a>>2],0|ir(p,s,b,o),b=0|kf[(0|kf[m>>2])+(t<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,t=0|kf[n>>2],E=0|If[t+84>>0]?b:0|kf[(0|kf[t+68>>2])+(b<<2)>>2],kf[a>>2]=E,E=0|If[t+24>>0],kf[s>>2]=kf[a>>2],0|ir(t,s,E,h),E=0|kf[(0|kf[m>>2])+(f<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,f=0|kf[n>>2],T=0|If[f+84>>0]?E:0|kf[(0|kf[f+68>>2])+(E<<2)>>2],kf[a>>2]=T,T=0|If[f+24>>0],kf[s>>2]=kf[a>>2],0|ir(f,s,T,l),S=ap(Gf[l>>2]),w=ap(Gf[h>>2]),C=ap(S-w),S=ap(Gf[l+4>>2]),M=ap(Gf[h+4>>2]),P=ap(S-M),S=ap(Gf[l+8>>2]),I=ap(Gf[h+8>>2]),R=ap(S-I),S=ap(ap(Gf[o>>2])-w),w=ap(ap(Gf[o+4>>2])-M),M=ap(ap(Gf[o+8>>2])-I),I=ap(ap(ap(ap(C*C)+ap(0))+ap(P*P))+ap(R*R)),(I>ap(0)?1:(0|kf[e+88>>2])<258)?(x=ap(ap(ap(ap(ap(C*S)+ap(0))+ap(P*w))+ap(R*M))/I),O=ap(S-ap(C*x)),C=ap(w-ap(P*x)),P=ap(M-ap(R*x)),k=x,D=ap(tp(ap(ap(ap(P*P)+ap(ap(C*C)+ap(ap(O*O)+ap(0))))/I)))):(k=ap(0),D=ap(0)),I=ap(y-A),y=ap(g-v),g=ap(A+ap(I*k)),A=ap(I*D),I=ap(v+ap(y*k)),k=ap(y*D),o=e+80|0,h=(0|kf[o>>2])+-1|0,l=0==(1<<(31&h)&kf[(0|kf[e+76>>2])+(h>>>5<<2)>>2]|0),kf[o>>2]=h,D=ap(-A),y=ap(I+(l?D:A)),A=ap(-k),D=ap(g+(l?k:A)),L=(2147483647&(Gf[Yf>>2]=D,0|kf[Yf>>2]))>>>0>2139095040?-2147483648:~~+$f(+(+D+.5)),l=0|kf[e+68>>2],kf[l>>2]=L,N=(2147483647&(Gf[Yf>>2]=y,0|kf[Yf>>2]))>>>0>2139095040?-2147483648:~~+$f(+(+y+.5)),kf[l+4>>2]=N,void(Xf=r)):(m=0|kf[e+68>>2],kf[m>>2]=~~y,kf[m+4>>2]=~~g,void(Xf=r))}function mn(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=wp,A=wp,v=wp,y=wp,g=0,b=0,E=0,T=wp,S=wp,w=wp,C=wp,M=wp,P=wp,I=wp,R=wp,x=wp,O=wp,k=wp,D=0,L=0;r=Xf,Xf=Xf+48|0,s=r+40|0,a=r+36|0,o=r+24|0,h=r+12|0,l=r,c=e+48|0,d=0|kf[t>>2],t=d+1|0;do{if((0|d)!=-1){if(u=0==((t>>>0)%3|0|0)?d+-2|0:t,(d>>>0)%3|0){f=u,p=d+-1|0;break}f=u,p=d+2|0;break}f=-1,p=-1}while(0);if(d=0|kf[(0|kf[c>>2])+28>>2],c=0|kf[d+(f<<2)>>2],f=0|kf[d+(p<<2)>>2],p=0|kf[e+52>>2],d=0|kf[p>>2],t=(0|kf[p+4>>2])-d>>2,t>>>0<=c>>>0&&Du(p),u=d,d=0|kf[u+(c<<2)>>2],t>>>0<=f>>>0&&Du(p),p=0|kf[u+(f<<2)>>2],f=(0|d)<(0|n),!(f&(0|p)<(0|n))){do{if(!f){if((0|n)>0){_=n+-1|0;break}if(u=e+72|0,(0|kf[u>>2])<=0)return void(Xf=r);t=0|kf[e+68>>2],c=0;do kf[t+(c<<2)>>2]=0,c=c+1|0;while((0|c)<(0|kf[u>>2]));return void(Xf=r)}_=d}while(0);if(f=e+72|0,u=0|kf[f>>2],c=0|np(u,_),(0|u)<=0)return void(Xf=r);u=0|kf[e+68>>2],_=0;do kf[u+(_<<2)>>2]=kf[i+(_+c<<2)>>2],_=_+1|0;while((0|_)<(0|kf[f>>2]));return void(Xf=r)}return f=0|kf[e+72>>2],_=0|np(f,d),m=ap(0|kf[i+(_<<2)>>2]),A=ap(0|kf[i+(_+1<<2)>>2]),_=0|np(f,p),v=ap(0|kf[i+(_<<2)>>2]),y=ap(0|kf[i+(_+1<<2)>>2]),v!=m|y!=A?(_=e+64|0,i=0|kf[(0|kf[_>>2])+(n<<2)>>2],kf[o>>2]=0,kf[o+4>>2]=0,kf[o+8>>2]=0,n=e+60|0,f=0|kf[n>>2],g=0|If[f+84>>0]?i:0|kf[(0|kf[f+68>>2])+(i<<2)>>2],kf[a>>2]=g,g=0|If[f+24>>0],kf[s>>2]=kf[a>>2],0|ir(f,s,g,o),g=0|kf[(0|kf[_>>2])+(d<<2)>>2],kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,d=0|kf[n>>2],b=0|If[d+84>>0]?g:0|kf[(0|kf[d+68>>2])+(g<<2)>>2],kf[a>>2]=b,b=0|If[d+24>>0],kf[s>>2]=kf[a>>2],0|ir(d,s,b,h),b=0|kf[(0|kf[_>>2])+(p<<2)>>2],kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,p=0|kf[n>>2],E=0|If[p+84>>0]?b:0|kf[(0|kf[p+68>>2])+(b<<2)>>2],kf[a>>2]=E,E=0|If[p+24>>0],kf[s>>2]=kf[a>>2],0|ir(p,s,E,l),T=ap(Gf[l>>2]),S=ap(Gf[h>>2]),w=ap(T-S),T=ap(Gf[l+4>>2]),C=ap(Gf[h+4>>2]),M=ap(T-C),T=ap(Gf[l+8>>2]),P=ap(Gf[h+8>>2]),I=ap(T-P),T=ap(ap(Gf[o>>2])-S),S=ap(ap(Gf[o+4>>2])-C),C=ap(ap(Gf[o+8>>2])-P),P=ap(ap(ap(ap(w*w)+ap(0))+ap(M*M))+ap(I*I)),(P>ap(0)?1:(0|kf[e+88>>2])<258)?(R=ap(ap(ap(ap(ap(w*T)+ap(0))+ap(M*S))+ap(I*C))/P),x=ap(T-ap(w*R)),w=ap(S-ap(M*R)),M=ap(C-ap(I*R)),O=R,k=ap(tp(ap(ap(ap(M*M)+ap(ap(w*w)+ap(ap(x*x)+ap(0))))/P)))):(O=ap(0),k=ap(0)),P=ap(v-m),v=ap(y-A),y=ap(m+ap(P*O)),m=ap(P*k),P=ap(A+ap(v*O)),O=ap(v*k),o=e+80|0,h=(0|kf[o>>2])+-1|0,l=0==(1<<(31&h)&kf[(0|kf[e+76>>2])+(h>>>5<<2)>>2]|0),kf[o>>2]=h,k=ap(-m),v=ap(P+(l?k:m)),m=ap(-O),k=ap(y+(l?O:m)),D=(2147483647&(Gf[Yf>>2]=k,0|kf[Yf>>2]))>>>0>2139095040?-2147483648:~~+$f(+(+k+.5)),l=0|kf[e+68>>2],kf[l>>2]=D,L=(2147483647&(Gf[Yf>>2]=v,0|kf[Yf>>2]))>>>0>2139095040?-2147483648:~~+$f(+(+v+.5)),kf[l+4>>2]=L,void(Xf=r)):(_=0|kf[e+68>>2],kf[_>>2]=~~v,kf[_+4>>2]=~~y,void(Xf=r))}function An(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0;if(n=Xf,Xf=Xf+16|0,r=n+8|0,s=n+4|0,a=n,o=e+64|0,h=0|kf[o>>2],(0|kf[h+28>>2])==(0|kf[h+24>>2]))return void(Xf=n);for(l=t+96|0,t=e+52|0,c=i+84|0,d=i+68|0,i=e+56|0,u=e+60|0,f=e+12|0,p=e+28|0,_=e+40|0,m=e+44|0,A=e+48|0,v=h,h=0,y=0;;){if(g=0|kf[(0|kf[v+24>>2])+(y<<2)>>2],(0|g)==-1)b=v,E=h;else{T=h+1|0,S=0|kf[(0|kf[l>>2])+(12*((0|g)/3|0)|0)+(((0|g)%3|0)<<2)>>2],w=0|If[c>>0]?S:0|kf[(0|kf[d>>2])+(S<<2)>>2],kf[r>>2]=w,S=0|kf[i>>2],S>>>0<(0|kf[u>>2])>>>0?(kf[S>>2]=w,kf[i>>2]=S+4):us(t,r),kf[r>>2]=g,kf[s>>2]=0;e:do if(kf[(0|kf[f>>2])+(y>>>5<<2)>>2]&1<<(31&y)){if(S=g+1|0,M=0==((S>>>0)%3|0|0)?g+-2|0:S,((0|M)!=-1?0==(kf[(0|kf[e>>2])+(M>>>5<<2)>>2]&1<<(31&M)|0):0)?(S=0|kf[(0|kf[(0|kf[o>>2])+12>>2])+(M<<2)>>2],M=S+1|0,(0|S)!=-1):0){if(P=0==((M>>>0)%3|0|0)?S+-2|0:M,kf[s>>2]=P,(0|P)==-1){C=g;break}for(I=P;;){if(kf[r>>2]=I,P=I+1|0,M=0==((P>>>0)%3|0|0)?I+-2|0:P,(0|M)==-1)break;if(kf[(0|kf[e>>2])+(M>>>5<<2)>>2]&1<<(31&M)|0)break;if(P=0|kf[(0|kf[(0|kf[o>>2])+12>>2])+(M<<2)>>2],M=P+1|0,(0|P)==-1)break;if(S=0==((M>>>0)%3|0|0)?P+-2|0:M,kf[s>>2]=S,(0|S)==-1){C=I;break e}I=S}kf[s>>2]=-1,C=I;break}kf[s>>2]=-1,C=g}else C=g;while(0);kf[(0|kf[p>>2])+(C<<2)>>2]=h,g=0|kf[m>>2],(0|g)==(0|kf[A>>2])?us(_,r):(kf[g>>2]=kf[r>>2],kf[m>>2]=g+4),g=0|kf[o>>2],S=0|kf[r>>2];e:do if(((0|S)!=-1?(M=(0==((S>>>0)%3|0|0)?2:-1)+S|0,(0|M)!=-1):0)?(P=0|kf[(0|kf[g+12>>2])+(M<<2)>>2],(0|P)!=-1):0)if(M=P+(0==((P>>>0)%3|0|0)?2:-1)|0,kf[s>>2]=M,(0|M)!=-1&(0|M)!=(0|S)){for(P=M,M=h,R=T;;){x=P+1|0,O=0==((x>>>0)%3|0|0)?P+-2|0:x;do{if(kf[(0|kf[e>>2])+(O>>>5<<2)>>2]&1<<(31&O)){if(x=R+1|0,k=0|kf[(0|kf[l>>2])+(12*((0|P)/3|0)|0)+(((0|P)%3|0)<<2)>>2],D=0|If[c>>0]?k:0|kf[(0|kf[d>>2])+(k<<2)>>2],kf[a>>2]=D,k=0|kf[i>>2],k>>>0<(0|kf[u>>2])>>>0?(kf[k>>2]=D,kf[i>>2]=k+4):us(t,a),k=0|kf[m>>2],(0|k)==(0|kf[A>>2])){us(_,s),L=R,N=x;break}kf[k>>2]=kf[s>>2],kf[m>>2]=k+4,L=R,N=x;break}L=M,N=R}while(0);if(kf[(0|kf[p>>2])+(kf[s>>2]<<2)>>2]=L,F=0|kf[o>>2],O=0|kf[s>>2],(0|O)==-1)break;if(x=(0==((O>>>0)%3|0|0)?2:-1)+O|0,(0|x)==-1)break;if(O=0|kf[(0|kf[F+12>>2])+(x<<2)>>2],(0|O)==-1)break;if(P=O+(0==((O>>>0)%3|0|0)?2:-1)|0,kf[s>>2]=P,(0|P)==-1||(0|P)==(0|kf[r>>2])){B=F,V=N;break e}M=L,R=N}kf[s>>2]=-1,B=F,V=N}else B=g,V=T;else U=28;while(0);28==(0|U)&&(U=0,kf[s>>2]=-1,B=g,V=T),b=B,E=V}if(y=y+1|0,y>>>0>=(0|kf[b+28>>2])-(0|kf[b+24>>2])>>2>>>0)break;v=b,h=E}Xf=n}function vn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0;if(r=Xf,Xf=Xf+32|0,n=r+28|0,a=r+16|0,o=r+8|0,h=r,l=e+60|0,kf[e+68>>2]=s,s=e+56|0,c=0|kf[s>>2],d=(0|kf[c+4>>2])-(0|kf[c>>2])|0,u=d>>2,kf[a>>2]=0,kf[a+4>>2]=0,kf[a+8>>2]=0,(0|d)<=0)return Xf=r,1;for(d=a+4|0,f=a+8|0,p=e+104|0,_=e+108|0,m=o+4|0,A=e+100|0,v=e+8|0,y=e+16|0,g=e+32|0,b=e+12|0,E=e+20|0,e=0|kf[c>>2],(0|kf[c+4>>2])==(0|e)?(T=c,Du(T)):(S=e,w=0);;){kf[h>>2]=kf[S+(w<<2)>>2],kf[n>>2]=kf[h>>2],Ji(l,n,a),e=0|kf[a>>2],c=(0|e)>-1?e:0-e|0,C=0|kf[d>>2],M=(0|C)>-1?C:0-C|0,P=0|tc(0|M,((0|M)<0)<<31>>31|0,0|c,((0|c)<0)<<31>>31|0),c=0|kf[f>>2],M=(0|c)>-1,I=M?c:0-c|0,c=0|tc(0|P,0|qf,0|I,((0|I)<0)<<31>>31|0),I=qf,P=0|kf[p>>2],0==(0|c)&0==(0|I)?(R=a,x=P):(O=((0|P)<0)<<31>>31,k=0|pl(0|P,0|O,0|e,((0|e)<0)<<31>>31|0),e=0|Ya(0|k,0|qf,0|c,0|I),kf[a>>2]=e,k=0|pl(0|P,0|O,0|C,((0|C)<0)<<31>>31|0),C=0|Ya(0|k,0|qf,0|c,0|I),kf[d>>2]=C,I=P-((0|e)>-1?e:0-e|0)-((0|C)>-1?C:0-C|0)|0,R=f,x=M?I:0-I|0),kf[R>>2]=x,I=0|Qa(_),M=0|kf[a>>2],I?(I=0-M|0,C=0-(0|kf[d>>2])|0,e=0-(0|kf[f>>2])|0,kf[a>>2]=I,kf[d>>2]=C,kf[f>>2]=e,D=I,L=C,N=e):(D=M,L=0|kf[d>>2],N=0|kf[f>>2]),(0|D)<=-1?(M=(0|N)>-1?N:0-N|0,F=(0|L)<0?M:(0|kf[A>>2])-M|0,M=(0|L)>-1?L:0-L|0,(0|N)<0?(B=F,V=M):(B=F,V=(0|kf[A>>2])-M|0)):(M=0|kf[p>>2],B=M+L|0,V=M+N|0),M=0==(0|B),e=0==(0|V),C=0|kf[A>>2];do if(0!=(V|B|0)?(I=(0|C)==(0|V),P=(0|C)==(0|B),M&I|e&P):!0)U=C,G=C;else{if(M?(c=0|kf[p>>2],(0|c)<(0|V)):0){U=0,G=(c<<1)-V|0;break}if(P?(P=0|kf[p>>2],(0|P)>(0|V)):0){U=B,G=(P<<1)-V|0;break}if(I?(I=0|kf[p>>2],(0|I)>(0|B)):0){U=(I<<1)-B|0,G=V;break}e?(I=0|kf[p>>2],U=(0|I)<(0|B)?(I<<1)-B|0:B,G=0):(U=B,G=V)}while(0);if(kf[o>>2]=U,kf[m>>2]=G,C=w<<1,e=t+(C<<2)|0,M=i+(C<<2)|0,(0|kf[v>>2])>0){for(C=U,I=0;;){if(P=0|kf[y>>2],(0|C)>(0|P)?(c=0|kf[g>>2],kf[c+(I<<2)>>2]=P,W=c):(c=0|kf[b>>2],P=0|kf[g>>2],kf[P+(I<<2)>>2]=(0|C)<(0|c)?c:C,W=P),P=I+1|0,z=0|kf[v>>2],(0|P)>=(0|z))break;C=0|kf[o+(P<<2)>>2],I=P}if((0|z)>0){I=0;do C=(0|kf[e+(I<<2)>>2])+(0|kf[W+(I<<2)>>2])|0,P=M+(I<<2)|0,kf[P>>2]=C,(0|C)<=(0|kf[y>>2])?(0|C)<(0|kf[b>>2])&&(H=(0|kf[E>>2])+C|0,j=40):(H=C-(0|kf[E>>2])|0,j=40),40==(0|j)&&(j=0,kf[P>>2]=H),I=I+1|0;while((0|I)<(0|kf[v>>2]))}}if(w=w+1|0,(0|w)>=(0|u)){j=3;break}if(I=0|kf[s>>2],S=0|kf[I>>2],(0|kf[I+4>>2])-S>>2>>>0<=w>>>0){T=I,j=4;break}}return 3==(0|j)?(Xf=r,1):(4==(0|j)&&Du(T),0)}function yn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0;if(r=Xf,Xf=Xf+32|0,n=r+28|0,a=r+16|0,o=r+8|0,h=r,l=e+60|0,kf[e+68>>2]=s,s=e+56|0,c=0|kf[s>>2],d=(0|kf[c+4>>2])-(0|kf[c>>2])|0,u=d>>2,kf[a>>2]=0,kf[a+4>>2]=0,kf[a+8>>2]=0,(0|d)<=0)return Xf=r,1;for(d=a+4|0,f=a+8|0,p=e+104|0,_=e+108|0,m=o+4|0,A=e+100|0,v=e+8|0,y=e+16|0,g=e+32|0,b=e+12|0,E=e+20|0,e=0|kf[c>>2],(0|kf[c+4>>2])==(0|e)?(T=c,Du(T)):(S=e,w=0);;){kf[h>>2]=kf[S+(w<<2)>>2],kf[n>>2]=kf[h>>2],Ki(l,n,a),e=0|kf[a>>2],c=(0|e)>-1?e:0-e|0,C=0|kf[d>>2],M=(0|C)>-1?C:0-C|0,P=0|tc(0|M,((0|M)<0)<<31>>31|0,0|c,((0|c)<0)<<31>>31|0),c=0|kf[f>>2],M=(0|c)>-1,I=M?c:0-c|0,c=0|tc(0|P,0|qf,0|I,((0|I)<0)<<31>>31|0),I=qf,P=0|kf[p>>2],0==(0|c)&0==(0|I)?(R=a,x=P):(O=((0|P)<0)<<31>>31,k=0|pl(0|P,0|O,0|e,((0|e)<0)<<31>>31|0),e=0|Ya(0|k,0|qf,0|c,0|I),kf[a>>2]=e,k=0|pl(0|P,0|O,0|C,((0|C)<0)<<31>>31|0),C=0|Ya(0|k,0|qf,0|c,0|I),kf[d>>2]=C,I=P-((0|e)>-1?e:0-e|0)-((0|C)>-1?C:0-C|0)|0,R=f,x=M?I:0-I|0),kf[R>>2]=x,I=0|Qa(_),M=0|kf[a>>2],I?(I=0-M|0,C=0-(0|kf[d>>2])|0,e=0-(0|kf[f>>2])|0,kf[a>>2]=I,kf[d>>2]=C,kf[f>>2]=e,D=I,L=C,N=e):(D=M,L=0|kf[d>>2],N=0|kf[f>>2]),(0|D)<=-1?(M=(0|N)>-1?N:0-N|0,F=(0|L)<0?M:(0|kf[A>>2])-M|0,M=(0|L)>-1?L:0-L|0,(0|N)<0?(B=F,V=M):(B=F,V=(0|kf[A>>2])-M|0)):(M=0|kf[p>>2],B=M+L|0,V=M+N|0),M=0==(0|B),e=0==(0|V),C=0|kf[A>>2];do if(0!=(V|B|0)?(I=(0|C)==(0|V),P=(0|C)==(0|B),M&I|e&P):!0)U=C,G=C;else{if(M?(c=0|kf[p>>2],(0|c)<(0|V)):0){U=0,G=(c<<1)-V|0;break}if(P?(P=0|kf[p>>2],(0|P)>(0|V)):0){U=B,G=(P<<1)-V|0;break}if(I?(I=0|kf[p>>2],(0|I)>(0|B)):0){U=(I<<1)-B|0,G=V;break}e?(I=0|kf[p>>2],U=(0|I)<(0|B)?(I<<1)-B|0:B,G=0):(U=B,G=V)}while(0);if(kf[o>>2]=U,kf[m>>2]=G,C=w<<1,e=t+(C<<2)|0,M=i+(C<<2)|0,(0|kf[v>>2])>0){for(C=U,I=0;;){if(P=0|kf[y>>2],(0|C)>(0|P)?(c=0|kf[g>>2],kf[c+(I<<2)>>2]=P,W=c):(c=0|kf[b>>2],P=0|kf[g>>2],kf[P+(I<<2)>>2]=(0|C)<(0|c)?c:C,W=P),P=I+1|0,z=0|kf[v>>2],(0|P)>=(0|z))break;C=0|kf[o+(P<<2)>>2],I=P}if((0|z)>0){I=0;do C=(0|kf[e+(I<<2)>>2])+(0|kf[W+(I<<2)>>2])|0,P=M+(I<<2)|0,kf[P>>2]=C,(0|C)<=(0|kf[y>>2])?(0|C)<(0|kf[b>>2])&&(H=(0|kf[E>>2])+C|0,j=40):(H=C-(0|kf[E>>2])|0,j=40),40==(0|j)&&(j=0,kf[P>>2]=H),I=I+1|0;while((0|I)<(0|kf[v>>2]))}}if(w=w+1|0,(0|w)>=(0|u)){j=3;break}if(I=0|kf[s>>2],S=0|kf[I>>2],(0|kf[I+4>>2])-S>>2>>>0<=w>>>0){T=I,j=4;break}}return 3==(0|j)?(Xf=r,1):(4==(0|j)&&Du(T),0)}function gn(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(t=Xf,Xf=Xf+32|0,i=t+4|0,n=t,r=e+16|0,s=0|kf[r>>2],s>>>0>340){kf[r>>2]=s+-341,s=e+4|0,r=0|kf[s>>2],a=0|kf[r>>2],o=r+4|0,kf[s>>2]=o,r=e+8|0,h=0|kf[r>>2],l=e+12|0,c=0|kf[l>>2],d=c,u=h;do if((0|h)==(0|c)){if(f=0|kf[e>>2],p=f,o>>>0>f>>>0){_=o,m=((_-p>>2)+1|0)/-2|0,A=o+(m<<2)|0,v=u-_|0,_=v>>2,_?(0|Sh(0|A,0|o,0|v),y=0|kf[s>>2]):y=o,v=A+(_<<2)|0,kf[r>>2]=v,kf[s>>2]=y+(m<<2),g=v;break}if(v=d-p>>1,p=0==(0|v)?1:v,p>>>0>1073741823&&(v=0|dp(8),cd(v,13392),kf[v>>2]=4748,fp(0|v,1128,101)),v=0|sl(p<<2),m=v,_=v+(p>>>2<<2)|0,A=_,b=v+(p<<2)|0,(0|o)==(0|h))E=f,T=A;else{f=_,_=o,p=A;do kf[f>>2]=kf[_>>2],f=p+4|0,p=f,_=_+4|0;while((0|_)!=(0|h));E=0|kf[e>>2],T=p}kf[e>>2]=m,kf[s>>2]=A,kf[r>>2]=T,kf[l>>2]=b,E?(mf(E),g=0|kf[r>>2]):g=T}else g=h;while(0);return kf[g>>2]=a,kf[r>>2]=(0|kf[r>>2])+4,void(Xf=t)}if(r=e+8|0,a=0|kf[r>>2],g=e+4|0,h=a-(0|kf[g>>2])|0,E=e+12|0,T=0|kf[E>>2],l=T-(0|kf[e>>2])|0,h>>>0>=l>>>0){for(s=l>>1,l=0==(0|s)?1:s,kf[i+12>>2]=0,kf[i+16>>2]=e+12,l>>>0>1073741823&&(s=0|dp(8),cd(s,13392),kf[s>>2]=4748,fp(0|s,1128,101)),s=0|sl(l<<2),kf[i>>2]=s,o=s+(h>>2<<2)|0,h=i+8|0,kf[h>>2]=o,d=i+4|0,kf[d>>2]=o,o=i+12|0,kf[o>>2]=s+(l<<2),l=0|sl(4092),kf[n>>2]=l,Bt(i,n),n=0|kf[r>>2];;){if(S=0|kf[g>>2],(0|n)==(0|S))break;l=n+-4|0,kt(i,l),n=l}return l=S,S=0|kf[e>>2],kf[e>>2]=kf[i>>2],kf[i>>2]=S,kf[g>>2]=kf[d>>2],kf[d>>2]=l,d=0|kf[r>>2],kf[r>>2]=kf[h>>2],kf[h>>2]=d,s=0|kf[E>>2],kf[E>>2]=kf[o>>2],kf[o>>2]=s,s=d,(0|s)!=(0|n)&&(kf[h>>2]=s+(~((s+-4-l|0)>>>2)<<2)),0|S&&mf(S),void(Xf=t)}if((0|T)!=(0|a))return a=0|sl(4092),kf[i>>2]=a,Bt(e,i),void(Xf=t);a=0|sl(4092),kf[i>>2]=a,kt(e,i),i=0|kf[g>>2],a=0|kf[i>>2],T=i+4|0,kf[g>>2]=T,i=0|kf[r>>2],S=0|kf[E>>2],l=S,s=i;do if((0|i)==(0|S)){if(h=0|kf[e>>2],n=h,T>>>0>h>>>0){d=T,o=((d-n>>2)+1|0)/-2|0,y=T+(o<<2)|0,u=s-d|0,d=u>>2,d?(0|Sh(0|y,0|T,0|u),w=0|kf[g>>2]):w=T,u=y+(d<<2)|0,kf[r>>2]=u,kf[g>>2]=w+(o<<2),C=u;break}if(u=l-n>>1,n=0==(0|u)?1:u,n>>>0>1073741823&&(u=0|dp(8),cd(u,13392),kf[u>>2]=4748,fp(0|u,1128,101)),u=0|sl(n<<2),o=u,d=u+(n>>>2<<2)|0,y=d,c=u+(n<<2)|0,(0|T)==(0|i))M=h,P=y;else{h=d,d=T,n=y;do kf[h>>2]=kf[d>>2],h=n+4|0,n=h,d=d+4|0;while((0|d)!=(0|i));M=0|kf[e>>2],P=n}kf[e>>2]=o,kf[g>>2]=y,kf[r>>2]=P,kf[E>>2]=c,M?(mf(M),C=0|kf[r>>2]):C=P}else C=i;while(0);kf[C>>2]=a,kf[r>>2]=(0|kf[r>>2])+4,Xf=t}function bn(e,t,i,n,r,s,a){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a;var o=0,h=0;switch(0|i){case 1:return i=0|sl(60),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=2012,o=i,void(kf[e>>2]=o);case 2:return i=0|sl(60),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=2068,o=i,void(kf[e>>2]=o);case 4:i=0|sl(112),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=2124,t=i+60|0,h=t+52|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|h));return o=i,void(kf[e>>2]=o);case 3:return i=0|sl(92),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=2180,t=i+60|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0,kf[t+24>>2]=0,kf[i+88>>2]=65535&a,o=i,void(kf[e>>2]=o);case 5:return i=0|sl(104),kf[i>>2]=1536,kf[i+4>>2]=n,a=i+8|0,kf[a>>2]=kf[r>>2],kf[a+4>>2]=kf[r+4>>2],kf[a+8>>2]=kf[r+8>>2],kf[a+12>>2]=kf[r+12>>2],kf[a+16>>2]=kf[r+16>>2],kf[a+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),a=i+44|0,kf[a>>2]=kf[s>>2],kf[a+4>>2]=kf[s+4>>2],kf[a+8>>2]=kf[s+8>>2],kf[a+12>>2]=kf[s+12>>2],kf[i>>2]=2236,kf[i+60>>2]=0,kf[i+64>>2]=0,kf[i+76>>2]=0,kf[i+80>>2]=0,kf[i+84>>2]=0,a=i+88|0,kf[a>>2]=kf[s>>2],kf[a+4>>2]=kf[s+4>>2],kf[a+8>>2]=kf[s+8>>2],kf[a+12>>2]=kf[s+12>>2],o=i,void(kf[e>>2]=o);case 6:return i=0|sl(124),kf[i>>2]=1536,kf[i+4>>2]=n,n=i+8|0,kf[n>>2]=kf[r>>2],kf[n+4>>2]=kf[r+4>>2],kf[n+8>>2]=kf[r+8>>2],kf[n+12>>2]=kf[r+12>>2],kf[n+16>>2]=kf[r+16>>2],kf[n+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),r=i+44|0,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[r+8>>2]=kf[s+8>>2],kf[r+12>>2]=kf[s+12>>2],kf[i>>2]=2292,kf[i+64>>2]=0,kf[i+68>>2]=0,r=i+72|0,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[r+8>>2]=kf[s+8>>2],kf[r+12>>2]=kf[s+12>>2],kf[i+60>>2]=2348,kf[i+88>>2]=1,s=i+92|0,kf[s>>2]=-1,kf[s+4>>2]=-1,kf[s+8>>2]=-1,kf[s+12>>2]=-1,rd(i+108|0),o=i,void(kf[e>>2]=o);default:return o=0,void(kf[e>>2]=o)}}function En(e,t,i,n,r,s,a){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a;var o=0,h=0;switch(0|i){case 1:return i=0|sl(60),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=1648,o=i,void(kf[e>>2]=o);case 2:return i=0|sl(60),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=1704,o=i,void(kf[e>>2]=o);case 4:i=0|sl(112),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=1760,t=i+60|0,h=t+52|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|h));return o=i,void(kf[e>>2]=o);case 3:return i=0|sl(92),kf[i>>2]=1536,kf[i+4>>2]=n,t=i+8|0,kf[t>>2]=kf[r>>2],kf[t+4>>2]=kf[r+4>>2],kf[t+8>>2]=kf[r+8>>2],kf[t+12>>2]=kf[r+12>>2],kf[t+16>>2]=kf[r+16>>2],kf[t+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),t=i+44|0,kf[t>>2]=kf[s>>2],kf[t+4>>2]=kf[s+4>>2],kf[t+8>>2]=kf[s+8>>2],kf[t+12>>2]=kf[s+12>>2],kf[i>>2]=1816,t=i+60|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0,kf[t+24>>2]=0,kf[i+88>>2]=65535&a,o=i,void(kf[e>>2]=o);case 5:return i=0|sl(104),kf[i>>2]=1536,kf[i+4>>2]=n,a=i+8|0,kf[a>>2]=kf[r>>2],kf[a+4>>2]=kf[r+4>>2],kf[a+8>>2]=kf[r+8>>2],kf[a+12>>2]=kf[r+12>>2],kf[a+16>>2]=kf[r+16>>2],kf[a+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),a=i+44|0,kf[a>>2]=kf[s>>2],kf[a+4>>2]=kf[s+4>>2],kf[a+8>>2]=kf[s+8>>2],kf[a+12>>2]=kf[s+12>>2],kf[i>>2]=1872,kf[i+60>>2]=0,kf[i+64>>2]=0,kf[i+76>>2]=0,kf[i+80>>2]=0,kf[i+84>>2]=0,a=i+88|0,kf[a>>2]=kf[s>>2],kf[a+4>>2]=kf[s+4>>2],kf[a+8>>2]=kf[s+8>>2],kf[a+12>>2]=kf[s+12>>2],o=i,void(kf[e>>2]=o);case 6:return i=0|sl(124),kf[i>>2]=1536,kf[i+4>>2]=n,n=i+8|0,kf[n>>2]=kf[r>>2],kf[n+4>>2]=kf[r+4>>2],kf[n+8>>2]=kf[r+8>>2],kf[n+12>>2]=kf[r+12>>2],kf[n+16>>2]=kf[r+16>>2],kf[n+20>>2]=kf[r+20>>2],Sa(i+32|0,r+24|0),r=i+44|0,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[r+8>>2]=kf[s+8>>2],kf[r+12>>2]=kf[s+12>>2],kf[i>>2]=1928,kf[i+64>>2]=0,kf[i+68>>2]=0,r=i+72|0,kf[r>>2]=kf[s>>2],kf[r+4>>2]=kf[s+4>>2],kf[r+8>>2]=kf[s+8>>2],kf[r+12>>2]=kf[s+12>>2],kf[i+60>>2]=1984,kf[i+88>>2]=1,s=i+92|0,kf[s>>2]=-1,kf[s+4>>2]=-1,kf[s+8>>2]=-1,kf[s+12>>2]=-1,rd(i+108|0),o=i,void(kf[e>>2]=o);default:return o=0,void(kf[e>>2]=o)}}function Tn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0;if(r=Xf,Xf=Xf+48|0,n=r+32|0,a=r+24|0,o=r+16|0,l=r,c=r+12|0,d=e+8|0,u=0|kf[d>>2],(u+-2|0)>>>0<=28&&(kf[e+72>>2]=u,f=1<<u,kf[e+76>>2]=f+-1,u=f+-2|0,kf[e+80>>2]=u,kf[e+84>>2]=(0|u)/2|0),u=e+40|0,kf[e+48>>2]=s,s=e+36|0,f=0|kf[s>>2],p=(0|kf[f+4>>2])-(0|kf[f>>2])|0,_=p>>2,kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,(0|p)<=0)return Xf=r,1;for(p=l+4|0,m=l+8|0,A=e+84|0,v=e+88|0,y=e+80|0,e=a+4|0,g=o+4|0,b=n+4|0,E=0|kf[f>>2],(0|kf[f+4>>2])==(0|E)?(T=f,Du(T)):(S=E,w=0);;){kf[c>>2]=kf[S+(w<<2)>>2],kf[n>>2]=kf[c>>2],Ji(u,n,l),E=0|kf[l>>2],f=(0|E)>-1?E:0-E|0,C=0|kf[p>>2],M=(0|C)>-1?C:0-C|0,P=0|tc(0|M,((0|M)<0)<<31>>31|0,0|f,((0|f)<0)<<31>>31|0),f=0|kf[m>>2],M=(0|f)>-1,I=M?f:0-f|0,f=0|tc(0|P,0|qf,0|I,((0|I)<0)<<31>>31|0),I=qf,P=0|kf[A>>2],0==(0|f)&0==(0|I)?(R=l,x=P):(O=((0|P)<0)<<31>>31,k=0|pl(0|P,0|O,0|E,((0|E)<0)<<31>>31|0),E=0|Ya(0|k,0|qf,0|f,0|I),kf[l>>2]=E,k=0|pl(0|P,0|O,0|C,((0|C)<0)<<31>>31|0),C=0|Ya(0|k,0|qf,0|f,0|I),kf[p>>2]=C,I=P-((0|E)>-1?E:0-E|0)-((0|C)>-1?C:0-C|0)|0,R=m,x=M?I:0-I|0),kf[R>>2]=x,I=0|Qa(v),M=0|kf[l>>2],I?(I=0-M|0,C=0-(0|kf[p>>2])|0,E=0-(0|kf[m>>2])|0,kf[l>>2]=I,kf[p>>2]=C,kf[m>>2]=E,D=I,L=C,N=E):(D=M,L=0|kf[p>>2],N=0|kf[m>>2]),(0|D)<=-1?(M=(0|N)>-1?N:0-N|0,F=(0|L)<0?M:(0|kf[y>>2])-M|0,M=(0|L)>-1?L:0-L|0,(0|N)<0?(B=F,V=M):(B=F,V=(0|kf[y>>2])-M|0)):(M=0|kf[A>>2],B=M+L|0,V=M+N|0),M=0==(0|B),E=0==(0|V),C=0|kf[y>>2];do if(0!=(V|B|0)?(I=(0|C)==(0|V),P=(0|C)==(0|B),M&I|E&P):!0)U=C,
G=C;else{if(M?(f=0|kf[A>>2],(0|f)<(0|V)):0){U=0,G=(f<<1)-V|0;break}if(P?(P=0|kf[A>>2],(0|P)>(0|V)):0){U=B,G=(P<<1)-V|0;break}if(I?(I=0|kf[A>>2],(0|I)>(0|B)):0){U=(I<<1)-B|0,G=V;break}E?(I=0|kf[A>>2],U=(0|I)<(0|B)?(I<<1)-B|0:B,G=0):(U=B,G=V)}while(0);if(C=w<<1,E=t+(C<<2)|0,M=i+(C<<2)|0,C=0|kf[E>>2],I=0|kf[E+4>>2],kf[a>>2]=U,kf[e>>2]=G,kf[o>>2]=C,kf[g>>2]=I,h(n,d,a,o),kf[M>>2]=kf[n>>2],kf[M+4>>2]=kf[b>>2],w=w+1|0,(0|w)>=(0|_)){W=5;break}if(M=0|kf[s>>2],S=0|kf[M>>2],(0|kf[M+4>>2])-S>>2>>>0<=w>>>0){T=M,W=6;break}}return 5==(0|W)?(Xf=r,1):(6==(0|W)&&Du(T),0)}function Sn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0;if(i=Xf,Xf=Xf+16|0,t=i+8|0,n=i+4|0,r=i,s=e+64|0,a=0|kf[s>>2],(0|kf[a+28>>2])==(0|kf[a+24>>2]))return void(Xf=i);for(o=e+52|0,h=e+56|0,l=e+60|0,c=e+12|0,d=e+28|0,u=e+40|0,f=e+44|0,p=e+48|0,_=a,a=0,m=0;;){if(A=0|kf[(0|kf[_+24>>2])+(m<<2)>>2],(0|A)==-1)v=_,y=a;else{g=a+1|0,kf[t>>2]=a,b=0|kf[h>>2],(0|b)==(0|kf[l>>2])?us(o,t):(kf[b>>2]=a,kf[h>>2]=b+4),kf[n>>2]=A,kf[r>>2]=0;e:do if(kf[(0|kf[c>>2])+(m>>>5<<2)>>2]&1<<(31&m)){if(b=A+1|0,T=0==((b>>>0)%3|0|0)?A+-2|0:b,((0|T)!=-1?0==(kf[(0|kf[e>>2])+(T>>>5<<2)>>2]&1<<(31&T)|0):0)?(b=0|kf[(0|kf[(0|kf[s>>2])+12>>2])+(T<<2)>>2],T=b+1|0,(0|b)!=-1):0){if(S=0==((T>>>0)%3|0|0)?b+-2|0:T,kf[r>>2]=S,(0|S)==-1){E=A;break}for(w=S;;){if(kf[n>>2]=w,S=w+1|0,T=0==((S>>>0)%3|0|0)?w+-2|0:S,(0|T)==-1)break;if(kf[(0|kf[e>>2])+(T>>>5<<2)>>2]&1<<(31&T)|0)break;if(S=0|kf[(0|kf[(0|kf[s>>2])+12>>2])+(T<<2)>>2],T=S+1|0,(0|S)==-1)break;if(b=0==((T>>>0)%3|0|0)?S+-2|0:T,kf[r>>2]=b,(0|b)==-1){E=w;break e}w=b}kf[r>>2]=-1,E=w;break}kf[r>>2]=-1,E=A}else E=A;while(0);kf[(0|kf[d>>2])+(E<<2)>>2]=kf[t>>2],A=0|kf[f>>2],(0|A)==(0|kf[p>>2])?us(u,n):(kf[A>>2]=kf[n>>2],kf[f>>2]=A+4),A=0|kf[s>>2],b=0|kf[n>>2];e:do if(((0|b)!=-1?(T=(0==((b>>>0)%3|0|0)?2:-1)+b|0,(0|T)!=-1):0)?(S=0|kf[(0|kf[A+12>>2])+(T<<2)>>2],(0|S)!=-1):0)if(T=S+(0==((S>>>0)%3|0|0)?2:-1)|0,kf[r>>2]=T,(0|T)!=-1&(0|T)!=(0|b)){for(S=g,C=T;;){T=C+1|0,M=0==((T>>>0)%3|0|0)?C+-2|0:T;do{if(kf[(0|kf[e>>2])+(M>>>5<<2)>>2]&1<<(31&M)){if(T=S+1|0,kf[t>>2]=S,P=0|kf[h>>2],(0|P)==(0|kf[l>>2])?us(o,t):(kf[P>>2]=S,kf[h>>2]=P+4),P=0|kf[f>>2],(0|P)==(0|kf[p>>2])){us(u,r),I=T;break}kf[P>>2]=kf[r>>2],kf[f>>2]=P+4,I=T;break}I=S}while(0);if(kf[(0|kf[d>>2])+(kf[r>>2]<<2)>>2]=kf[t>>2],R=0|kf[s>>2],M=0|kf[r>>2],(0|M)==-1)break;if(T=(0==((M>>>0)%3|0|0)?2:-1)+M|0,(0|T)==-1)break;if(M=0|kf[(0|kf[R+12>>2])+(T<<2)>>2],(0|M)==-1)break;if(C=M+(0==((M>>>0)%3|0|0)?2:-1)|0,kf[r>>2]=C,(0|C)==-1||(0|C)==(0|kf[n>>2])){x=R,O=I;break e}S=I}kf[r>>2]=-1,x=R,O=I}else x=A,O=g;else k=26;while(0);26==(0|k)&&(k=0,kf[r>>2]=-1,x=A,O=g),v=x,y=O}if(m=m+1|0,m>>>0>=(0|kf[v+28>>2])-(0|kf[v+24>>2])>>2>>>0)break;_=v,a=y}Xf=i}function wn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0;if(r=Xf,Xf=Xf+48|0,n=r+32|0,a=r+24|0,o=r+16|0,l=r,c=r+12|0,d=e+8|0,u=0|kf[d>>2],(u+-2|0)>>>0<=28&&(kf[e+72>>2]=u,f=1<<u,kf[e+76>>2]=f+-1,u=f+-2|0,kf[e+80>>2]=u,kf[e+84>>2]=(0|u)/2|0),u=e+40|0,kf[e+48>>2]=s,s=e+36|0,f=0|kf[s>>2],p=(0|kf[f+4>>2])-(0|kf[f>>2])|0,_=p>>2,kf[l>>2]=0,kf[l+4>>2]=0,kf[l+8>>2]=0,(0|p)<=0)return Xf=r,1;for(p=l+4|0,m=l+8|0,A=e+84|0,v=e+88|0,y=e+80|0,e=a+4|0,g=o+4|0,b=n+4|0,E=0|kf[f>>2],(0|kf[f+4>>2])==(0|E)?(T=f,Du(T)):(S=E,w=0);;){kf[c>>2]=kf[S+(w<<2)>>2],kf[n>>2]=kf[c>>2],Ki(u,n,l),E=0|kf[l>>2],f=(0|E)>-1?E:0-E|0,C=0|kf[p>>2],M=(0|C)>-1?C:0-C|0,P=0|tc(0|M,((0|M)<0)<<31>>31|0,0|f,((0|f)<0)<<31>>31|0),f=0|kf[m>>2],M=(0|f)>-1,I=M?f:0-f|0,f=0|tc(0|P,0|qf,0|I,((0|I)<0)<<31>>31|0),I=qf,P=0|kf[A>>2],0==(0|f)&0==(0|I)?(R=l,x=P):(O=((0|P)<0)<<31>>31,k=0|pl(0|P,0|O,0|E,((0|E)<0)<<31>>31|0),E=0|Ya(0|k,0|qf,0|f,0|I),kf[l>>2]=E,k=0|pl(0|P,0|O,0|C,((0|C)<0)<<31>>31|0),C=0|Ya(0|k,0|qf,0|f,0|I),kf[p>>2]=C,I=P-((0|E)>-1?E:0-E|0)-((0|C)>-1?C:0-C|0)|0,R=m,x=M?I:0-I|0),kf[R>>2]=x,I=0|Qa(v),M=0|kf[l>>2],I?(I=0-M|0,C=0-(0|kf[p>>2])|0,E=0-(0|kf[m>>2])|0,kf[l>>2]=I,kf[p>>2]=C,kf[m>>2]=E,D=I,L=C,N=E):(D=M,L=0|kf[p>>2],N=0|kf[m>>2]),(0|D)<=-1?(M=(0|N)>-1?N:0-N|0,F=(0|L)<0?M:(0|kf[y>>2])-M|0,M=(0|L)>-1?L:0-L|0,(0|N)<0?(B=F,V=M):(B=F,V=(0|kf[y>>2])-M|0)):(M=0|kf[A>>2],B=M+L|0,V=M+N|0),M=0==(0|B),E=0==(0|V),C=0|kf[y>>2];do if(0!=(V|B|0)?(I=(0|C)==(0|V),P=(0|C)==(0|B),M&I|E&P):!0)U=C,G=C;else{if(M?(f=0|kf[A>>2],(0|f)<(0|V)):0){U=0,G=(f<<1)-V|0;break}if(P?(P=0|kf[A>>2],(0|P)>(0|V)):0){U=B,G=(P<<1)-V|0;break}if(I?(I=0|kf[A>>2],(0|I)>(0|B)):0){U=(I<<1)-B|0,G=V;break}E?(I=0|kf[A>>2],U=(0|I)<(0|B)?(I<<1)-B|0:B,G=0):(U=B,G=V)}while(0);if(C=w<<1,E=t+(C<<2)|0,M=i+(C<<2)|0,C=0|kf[E>>2],I=0|kf[E+4>>2],kf[a>>2]=U,kf[e>>2]=G,kf[o>>2]=C,kf[g>>2]=I,h(n,d,a,o),kf[M>>2]=kf[n>>2],kf[M+4>>2]=kf[b>>2],w=w+1|0,(0|w)>=(0|_)){W=5;break}if(M=0|kf[s>>2],S=0|kf[M>>2],(0|kf[M+4>>2])-S>>2>>>0<=w>>>0){T=M,W=6;break}}return 5==(0|W)?(Xf=r,1):(6==(0|W)&&Du(T),0)}function Cn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0;if(r=Xf,Xf=Xf+48|0,n=r+32|0,a=r+24|0,o=r+16|0,h=r,l=r+12|0,c=e+8|0,d=0|kf[c>>2],(d+-2|0)>>>0<=28&&(kf[e+72>>2]=d,u=1<<d,kf[e+76>>2]=u+-1,d=u+-2|0,kf[e+80>>2]=d,kf[e+84>>2]=(0|d)/2|0),d=e+40|0,kf[e+48>>2]=s,s=e+36|0,u=0|kf[s>>2],f=(0|kf[u+4>>2])-(0|kf[u>>2])|0,p=f>>2,kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,(0|f)<=0)return Xf=r,1;for(f=h+4|0,_=h+8|0,m=e+84|0,A=e+88|0,v=e+80|0,e=n+4|0,y=o+4|0,g=a+4|0,b=0|kf[u>>2],(0|kf[u+4>>2])==(0|b)?(E=u,Du(E)):(T=b,S=0);;){kf[l>>2]=kf[T+(S<<2)>>2],kf[n>>2]=kf[l>>2],Ji(d,n,h),b=0|kf[h>>2],u=(0|b)>-1?b:0-b|0,w=0|kf[f>>2],C=(0|w)>-1?w:0-w|0,M=0|tc(0|C,((0|C)<0)<<31>>31|0,0|u,((0|u)<0)<<31>>31|0),u=0|kf[_>>2],C=(0|u)>-1,P=C?u:0-u|0,u=0|tc(0|M,0|qf,0|P,((0|P)<0)<<31>>31|0),P=qf,M=0|kf[m>>2],0==(0|u)&0==(0|P)?(I=h,R=M):(x=((0|M)<0)<<31>>31,O=0|pl(0|M,0|x,0|b,((0|b)<0)<<31>>31|0),b=0|Ya(0|O,0|qf,0|u,0|P),kf[h>>2]=b,O=0|pl(0|M,0|x,0|w,((0|w)<0)<<31>>31|0),w=0|Ya(0|O,0|qf,0|u,0|P),kf[f>>2]=w,P=M-((0|b)>-1?b:0-b|0)-((0|w)>-1?w:0-w|0)|0,I=_,R=C?P:0-P|0),kf[I>>2]=R,P=0|Qa(A),C=0|kf[h>>2],P?(P=0-C|0,w=0-(0|kf[f>>2])|0,b=0-(0|kf[_>>2])|0,kf[h>>2]=P,kf[f>>2]=w,kf[_>>2]=b,k=P,D=w,L=b):(k=C,D=0|kf[f>>2],L=0|kf[_>>2]),(0|k)<=-1?(C=(0|L)>-1?L:0-L|0,N=(0|D)<0?C:(0|kf[v>>2])-C|0,C=(0|D)>-1?D:0-D|0,(0|L)<0?(F=N,B=C):(F=N,B=(0|kf[v>>2])-C|0)):(C=0|kf[m>>2],F=C+D|0,B=C+L|0),C=0==(0|F),b=0==(0|B),w=0|kf[v>>2];do if(0!=(B|F|0)?(P=(0|w)==(0|B),M=(0|w)==(0|F),C&P|b&M):!0)V=w,U=w;else{if(C?(u=0|kf[m>>2],(0|u)<(0|B)):0){V=0,U=(u<<1)-B|0;break}if(M?(M=0|kf[m>>2],(0|M)>(0|B)):0){V=F,U=(M<<1)-B|0;break}if(P?(P=0|kf[m>>2],(0|P)>(0|F)):0){V=(P<<1)-F|0,U=B;break}b?(P=0|kf[m>>2],V=(0|P)<(0|F)?(P<<1)-F|0:F,U=0):(V=F,U=B)}while(0);if(w=S<<1,b=t+(w<<2)|0,C=i+(w<<2)|0,w=0|kf[b+4>>2],kf[n>>2]=kf[b>>2],kf[e>>2]=w,kf[o>>2]=V,kf[y>>2]=U,te(a,c,o,n),kf[C>>2]=kf[a>>2],kf[C+4>>2]=kf[g>>2],S=S+1|0,(0|S)>=(0|p)){G=5;break}if(C=0|kf[s>>2],T=0|kf[C>>2],(0|kf[C+4>>2])-T>>2>>>0<=S>>>0){E=C,G=6;break}}return 5==(0|G)?(Xf=r,1):(6==(0|G)&&Du(E),0)}function Mn(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0;if(r=Xf,Xf=Xf+48|0,n=r+32|0,a=r+24|0,o=r+16|0,h=r,l=r+12|0,c=e+8|0,d=0|kf[c>>2],(d+-2|0)>>>0<=28&&(kf[e+72>>2]=d,u=1<<d,kf[e+76>>2]=u+-1,d=u+-2|0,kf[e+80>>2]=d,kf[e+84>>2]=(0|d)/2|0),d=e+40|0,kf[e+48>>2]=s,s=e+36|0,u=0|kf[s>>2],f=(0|kf[u+4>>2])-(0|kf[u>>2])|0,p=f>>2,kf[h>>2]=0,kf[h+4>>2]=0,kf[h+8>>2]=0,(0|f)<=0)return Xf=r,1;for(f=h+4|0,_=h+8|0,m=e+84|0,A=e+88|0,v=e+80|0,e=n+4|0,y=o+4|0,g=a+4|0,b=0|kf[u>>2],(0|kf[u+4>>2])==(0|b)?(E=u,Du(E)):(T=b,S=0);;){kf[l>>2]=kf[T+(S<<2)>>2],kf[n>>2]=kf[l>>2],Ki(d,n,h),b=0|kf[h>>2],u=(0|b)>-1?b:0-b|0,w=0|kf[f>>2],C=(0|w)>-1?w:0-w|0,M=0|tc(0|C,((0|C)<0)<<31>>31|0,0|u,((0|u)<0)<<31>>31|0),u=0|kf[_>>2],C=(0|u)>-1,P=C?u:0-u|0,u=0|tc(0|M,0|qf,0|P,((0|P)<0)<<31>>31|0),P=qf,M=0|kf[m>>2],0==(0|u)&0==(0|P)?(I=h,R=M):(x=((0|M)<0)<<31>>31,O=0|pl(0|M,0|x,0|b,((0|b)<0)<<31>>31|0),b=0|Ya(0|O,0|qf,0|u,0|P),kf[h>>2]=b,O=0|pl(0|M,0|x,0|w,((0|w)<0)<<31>>31|0),w=0|Ya(0|O,0|qf,0|u,0|P),kf[f>>2]=w,P=M-((0|b)>-1?b:0-b|0)-((0|w)>-1?w:0-w|0)|0,I=_,R=C?P:0-P|0),kf[I>>2]=R,P=0|Qa(A),C=0|kf[h>>2],P?(P=0-C|0,w=0-(0|kf[f>>2])|0,b=0-(0|kf[_>>2])|0,kf[h>>2]=P,kf[f>>2]=w,kf[_>>2]=b,k=P,D=w,L=b):(k=C,D=0|kf[f>>2],L=0|kf[_>>2]),(0|k)<=-1?(C=(0|L)>-1?L:0-L|0,N=(0|D)<0?C:(0|kf[v>>2])-C|0,C=(0|D)>-1?D:0-D|0,(0|L)<0?(F=N,B=C):(F=N,B=(0|kf[v>>2])-C|0)):(C=0|kf[m>>2],F=C+D|0,B=C+L|0),C=0==(0|F),b=0==(0|B),w=0|kf[v>>2];do if(0!=(B|F|0)?(P=(0|w)==(0|B),M=(0|w)==(0|F),C&P|b&M):!0)V=w,U=w;else{if(C?(u=0|kf[m>>2],(0|u)<(0|B)):0){V=0,U=(u<<1)-B|0;break}if(M?(M=0|kf[m>>2],(0|M)>(0|B)):0){V=F,U=(M<<1)-B|0;break}if(P?(P=0|kf[m>>2],(0|P)>(0|F)):0){V=(P<<1)-F|0,U=B;break}b?(P=0|kf[m>>2],V=(0|P)<(0|F)?(P<<1)-F|0:F,U=0):(V=F,U=B)}while(0);if(w=S<<1,b=t+(w<<2)|0,C=i+(w<<2)|0,w=0|kf[b+4>>2],kf[n>>2]=kf[b>>2],kf[e>>2]=w,kf[o>>2]=V,kf[y>>2]=U,te(a,c,o,n),kf[C>>2]=kf[a>>2],kf[C+4>>2]=kf[g>>2],S=S+1|0,(0|S)>=(0|p)){G=5;break}if(C=0|kf[s>>2],T=0|kf[C>>2],(0|kf[C+4>>2])-T>>2>>>0<=S>>>0){E=C,G=6;break}}return 5==(0|G)?(Xf=r,1):(6==(0|G)&&Du(E),0)}function Pn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0;if(n=0|Cp[127&kf[(0|kf[e>>2])+44>>2]](e),(0|n)<1)return r=0,0|r;if(s=(0|kf[t+4>>2])-(0|kf[t>>2])>>2,a=0|np(s,n),ii(e,s,n),s=e+16|0,o=0|kf[s>>2],!(0|kf[o+80>>2]))return r=0,0|r;if(h=(0|kf[kf[o>>2]>>2])+(0|kf[o+48>>2])|0,!h)return r=0,0|r;if(o=i+8|0,l=o,c=0|kf[l>>2],d=0|kf[l+4>>2],l=i+16|0,u=l,f=0|kf[u>>2],p=0|kf[u+4>>2],!((0|d)>(0|p)|(0|d)==(0|p)&c>>>0>f>>>0))return r=0,0|r;u=0|kf[i>>2],_=0|If[u+f>>0],m=0|tc(0|f,0|p,1,0),A=qf,v=l,kf[v>>2]=m,kf[v+4>>2]=A;e:do if(_<<24>>24){if(!(0|ks(a,n,i,h)))return r=0,0|r;M=20}else{if(!((0|d)>(0|A)|(0|d)==(0|A)&c>>>0>m>>>0))return r=0,0|r;if(v=0|If[u+m>>0],y=0|tc(0|f,0|p,2,0),g=l,kf[g>>2]=y,kf[g+4>>2]=qf,g=255&v,y=(0|g)==(0|oh(5)),b=0|kf[(0|kf[s>>2])+64>>2],E=(0|kf[b+4>>2])-(0|kf[b>>2])|0,y){if(y=a<<2,E>>>0<y>>>0)return r=0,0|r;if(b=o,T=0|kf[b>>2],S=0|kf[b+4>>2],b=l,w=0|kf[b>>2],C=0|tc(0|w,0|kf[b+4>>2],0|y,0),b=qf,(0|S)<(0|b)|(0|S)==(0|b)&T>>>0<C>>>0)return r=0,0|r;0|ui(0|h,(0|kf[i>>2])+w|0,0|y),w=l,C=0|tc(0|kf[w>>2],0|kf[w+4>>2],0|y,0),y=l,kf[y>>2]=C,kf[y+4>>2]=qf,M=20;break}if(y=0|np(g,a),E>>>0<y>>>0)return r=0,0|r;if(E=o,C=0|kf[E>>2],w=0|kf[E+4>>2],E=l,T=0|kf[E>>2],b=0|kf[E+4>>2],E=0|nc(0|C,0|w,0|T,0|b),S=qf,(0|S)<0|0==(0|S)&E>>>0<y>>>0)return r=0,0|r;if(a)for(y=255&v,v=T,T=b,b=w,w=C,C=0;;){if(E=0|tc(0|v,0|T,0|y,0),S=qf,(0|b)<(0|S)|(0|b)==(0|S)&w>>>0<E>>>0?(P=v,I=T):(0|ui(h+(C<<2)|0,(0|kf[i>>2])+v|0,0|g),E=l,S=0|tc(0|kf[E>>2],0|kf[E+4>>2],0|y,0),E=qf,R=l,kf[R>>2]=S,kf[R+4>>2]=E,P=S,I=E),E=C+1|0,(0|E)==(0|a)){M=20;break e}S=o,v=P,T=I,b=0|kf[S+4>>2],w=0|kf[S>>2],C=E}else M=21}while(0);do if(20==(0|M))if(a){if(I=e+20|0,P=0|kf[I>>2],0|P?0|Cp[127&kf[(0|kf[P>>2])+32>>2]](P):0){x=I,O=1;break}Ph(h,a,h),x=I,O=1}else M=21;while(0);if(21==(0|M)&&(x=e+20|0,O=0),e=0|kf[x>>2],0|e){if(!(0|Mp[127&kf[(0|kf[e>>2])+40>>2]](e,i)))return r=0,0|r;if(O?(O=0|kf[x>>2],!(0|Ip[31&kf[(0|kf[O>>2])+44>>2]](O,h,h,a,n,0|kf[t>>2]))):0)return r=0,0|r}return r=1,0|r}function In(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(i=e+4|0,!t)return n=0|kf[e>>2],kf[e>>2]=0,0|n&&mf(n),void(kf[i>>2]=0);t>>>0>1073741823&&(n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)),n=0|sl(t<<2),r=0|kf[e>>2],kf[e>>2]=n,0|r&&mf(r),kf[i>>2]=t,i=0;do kf[(0|kf[e>>2])+(i<<2)>>2]=0,i=i+1|0;while((0|i)!=(0|t));if(i=e+8|0,r=0|kf[i>>2],r&&(n=0|kf[r+4>>2],s=t+-1|0,a=0==(s&t|0),o=a?n&s:n>>>0<t>>>0?n:(n>>>0)%(t>>>0)|0,kf[(0|kf[e>>2])+(o<<2)>>2]=i,i=0|kf[r>>2])){h=r,l=i,c=o,d=r;e:for(;;){r=h,o=l,i=d;t:for(;;){for(u=o;;){if(n=0|kf[u+4>>2],f=a?n&s:n>>>0<t>>>0?n:(n>>>0)%(t>>>0)|0,(0|f)==(0|c))break;if(p=(0|kf[e>>2])+(f<<2)|0,!(0|kf[p>>2]))break t;n=0|kf[u>>2];i:do if(n){if(m=u+8|0,A=0|If[m+11>>0],v=A<<24>>24<0,y=255&A,A=v?0|kf[u+12>>2]:y,g=0==(0|A),v)for(v=n,b=u;;){if(E=v+8|0,T=0|If[E+11>>0],S=T<<24>>24<0,(0|A)!=(0|(S?0|kf[v+12>>2]:255&T))){_=b;break i}if(g?0:0|fo(0|kf[m>>2],S?0|kf[E>>2]:E,A)){_=b;break i}if(E=0|kf[v>>2],!E){_=v;break i}S=v,v=E,b=S}if(g)for(b=n,v=u;;){if(S=0|If[b+8+11>>0],0|(S<<24>>24<0?0|kf[b+12>>2]:255&S)){_=v;break i}if(S=0|kf[b>>2],!S){_=b;break i}E=b,b=S,v=E}for(v=n,b=u;;){if(g=v+8|0,E=0|If[g+11>>0],S=E<<24>>24<0,(0|A)!=(0|(S?0|kf[v+12>>2]:255&E))){_=b;break i}if(E=S?0|kf[g>>2]:g,(255&kf[m>>2])<<24>>24!=(0|If[E>>0])){_=b;break i}for(w=y,C=m,M=E;;){if(w=w+-1|0,C=C+1|0,!w)break;if(M=M+1|0,(0|If[C>>0])!=(0|If[M>>0])){_=b;break i}}if(E=0|kf[v>>2],!E){_=v;break}g=v,v=E,b=g}}else _=u;while(0);if(kf[i>>2]=kf[_>>2],kf[_>>2]=kf[kf[(0|kf[e>>2])+(f<<2)>>2]>>2],kf[kf[(0|kf[e>>2])+(f<<2)>>2]>>2]=u,n=0|kf[r>>2],!n){P=43;break e}u=n}if(o=0|kf[u>>2],!o){P=43;break e}r=u,i=u}if(kf[p>>2]=i,l=0|kf[u>>2],!l){P=43;break}h=u,c=f,d=u}}}function Rn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0;for(n=Xf,Xf=Xf+16|0,r=n+12|0,s=n+4|0,a=n+8|0,o=n,h=e+8+(12*t|0)|0,l=0|kf[h>>2],c=e+8+(12*t|0)+4|0,d=0|kf[c>>2],(0|d)!=(0|l)&&(kf[c>>2]=d+(~((d+-4-l|0)>>>2)<<2)),l=0|kf[i>>2],d=e+4|0,kf[s>>2]=(0|l)==-1?-1:(l>>>0)/3|0,u=e+56|0,f=e+8+(12*t|0)+8|0,p=l,_=0,m=l;;){if(l=1==(0|_)){A=(0|m)==-1;do{if(!A){if((m>>>0)%3|0){v=m+-1|0;break}v=m+2|0;break}v=-1}while(0);if(kf[a>>2]=v,kf[r>>2]=kf[a>>2],(0|jt(e,r))==-1){y=m;break}if(g=m+1|0,A){b=12;break}if(E=0==((g>>>0)%3|0|0)?m+-2|0:g,kf[i>>2]=E,g=E+1|0,(0|E)==-1){T=m,b=16;break}if(S=0==((g>>>0)%3|0|0)?E+-2|0:g,(0|S)==-1){T=m,b=16;break}if(g=0|kf[(0|kf[(0|kf[d>>2])+12>>2])+(S<<2)>>2],S=g+1|0,(0|g)==-1){T=m,b=16;break}if(E=0==((S>>>0)%3|0|0)?g+-2|0:S,kf[i>>2]=E,(0|E)==-1){y=m;break}w=0,C=m,M=E,b=18}else P=0|kf[s>>2],I=p,R=0,x=m;for(;;){if(18==(0|b)&&(b=0,E=(M>>>0)/3|0,kf[s>>2]=E,P=E,I=M,R=w,x=C),E=(0|kf[u>>2])+(P>>>5<<2)|0,S=1<<(31&P),g=0|kf[E>>2],S&g|0){O=I,k=R,D=x;break}if(kf[E>>2]=g|S,S=0|kf[c>>2],(0|S)==(0|kf[f>>2])?us(h,s):(kf[S>>2]=kf[s>>2],kf[c>>2]=S+4),S=R+1|0,(0|R)>0){do if(1&S)g=I+1|0,(0|I)==-1?(L=-1,N=x):(L=0==((g>>>0)%3|0|0)?I+-2|0:g,N=x);else{if(g=l?I:x,(0|I)!=-1){if((I>>>0)%3|0){L=I+-1|0,N=g;break}L=I+2|0,N=g;break}L=-1,N=g}while(0);kf[i>>2]=L,F=L,B=N}else F=I,B=x;if(kf[o>>2]=F,kf[r>>2]=kf[o>>2],M=0|jt(e,r),kf[i>>2]=M,(0|M)==-1){O=-1,k=S,D=B;break}w=S,C=B,b=18}if(0==(1&k|0)|1^l||(A=0|kf[c>>2],g=0|kf[A+-4>>2],E=(0|kf[u>>2])+(g>>>5<<2)|0,kf[E>>2]=kf[E>>2]&~(1<<(31&g)),kf[c>>2]=A+-4),_=_+1|0,(0|_)>=2){y=D;break}p=O,m=D}if(12==(0|b)&&(kf[i>>2]=-1,T=-1,b=16),16==(0|b)&&(kf[i>>2]=-1,y=T),kf[e+44+(t<<2)>>2]=y,y=0|kf[c>>2],c=0|kf[h>>2],h=c,(0|y)==(0|c))return void(Xf=n);t=0|kf[u>>2],u=y-c>>2,c=0;do y=0|kf[h+(c<<2)>>2],e=t+(y>>>5<<2)|0,kf[e>>2]=kf[e>>2]&~(1<<(31&y)),c=c+1|0;while(c>>>0<u>>>0);Xf=n}function xn(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0;if(s=Xf,Xf=Xf+32|0,a=s+12|0,o=s,kf[t+40>>2]=i,i=t+32|0,kf[i>>2]=n,kf[t+4>>2]=r,un(e,n,a),0|kf[e>>2])return void(Xf=s);if(n=e+4|0,r=n+11|0,(0|If[r>>0])<0&&mf(0|kf[n>>2]),h=0|If[a+7>>0],(255&h|0)!=(0|Cp[127&kf[(0|kf[t>>2])+8>>2]](t))){l=0|sl(64),kf[o>>2]=l,kf[o+8>>2]=-2147483584,kf[o+4>>2]=50,c=l,d=13026,u=c+50|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));return If[l+50>>0]=0,kf[e>>2]=-1,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),void(Xf=s)}if(l=0|If[a+5>>0],If[t+36>>0]=l,f=0|If[a+6>>0],If[t+37>>0]=f,(l+-1&255)>1){p=0|sl(32),kf[o>>2]=p,kf[o+8>>2]=-2147483616,kf[o+4>>2]=22,c=p,d=13077,u=c+22|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));return If[p+22>>0]=0,kf[e>>2]=-5,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),void(Xf=s)}if(p=255&f,l<<24>>24==2&p>>>0>(h<<24>>24==0?3:2)>>>0){h=0|sl(32),kf[o>>2]=h,kf[o+8>>2]=-2147483616,kf[o+4>>2]=22,c=h,d=13100,u=c+22|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));return If[h+22>>0]=0,kf[e>>2]=-5,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),void(Xf=s)}if(h=65535&(p|(255&l)<<8),xf[(0|kf[i>>2])+38>>1]=h,(65535&h)>258?(0|xf[a+10>>1])<0:0){if(ge(e,t),0|kf[e>>2])return void(Xf=s);(0|If[r>>0])<0&&mf(0|kf[n>>2])}if(!(0|Cp[127&kf[(0|kf[t>>2])+12>>2]](t))){r=0|sl(48),kf[o>>2]=r,kf[o+8>>2]=-2147483600,kf[o+4>>2]=33,c=r,d=13123,u=c+33|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));return If[r+33>>0]=0,kf[e>>2]=-1,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),void(Xf=s)}if(!(0|Cp[127&kf[(0|kf[t>>2])+20>>2]](t))){r=0|sl(32),kf[o>>2]=r,kf[o+8>>2]=-2147483616,kf[o+4>>2]=31,c=r,d=13157,u=c+31|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));return If[r+31>>0]=0,kf[e>>2]=-1,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),void(Xf=s)}if(0|Cp[127&kf[(0|kf[t>>2])+24>>2]](t))return kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,void(Xf=s);t=0|sl(48),kf[o>>2]=t,kf[o+8>>2]=-2147483600,kf[o+4>>2]=34,c=t,d=13189,u=c+34|0;do If[c>>0]=0|If[d>>0],c=c+1|0,d=d+1|0;while((0|c)<(0|u));If[t+34>>0]=0,kf[e>>2]=-1,Ds(n,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),Xf=s}function On(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;if(i=Xf,Xf=Xf+48|0,n=i+32|0,r=i+28|0,s=i+16|0,a=i,o=e+16|0,h=0|kf[o>>2],0|h){l=0|kf[t>>2],c=o,d=h;e:for(;;){for(h=d;;){if((0|kf[h+16>>2])>=(0|l))break;if(u=0|kf[h+4>>2],!u){f=c;break e}h=u}if(d=0|kf[h>>2],!d){f=h;break}c=h}if((0|f)!=(0|o)?(0|l)>=(0|kf[f+16>>2]):0)return p=f,_=p+20|0,Xf=i,0|_}if(Xd(s),kf[a>>2]=kf[t>>2],t=a+4|0,kf[a+8>>2]=0,f=a+12|0,kf[f>>2]=0,l=a+8|0,kf[t>>2]=l,c=0|kf[s>>2],d=s+4|0,(0|c)!=(0|d))for(u=l,m=c;;){if(c=m+16|0,kf[r>>2]=u,kf[n>>2]=kf[r>>2],0|_i(t,n,c,c),c=0|kf[m+4>>2]){for(v=c;;){if(h=0|kf[v>>2],!h)break;v=h}y=v}else if(A=m+8|0,v=0|kf[A>>2],(0|kf[v>>2])==(0|m))y=v;else{v=A;do A=0|kf[v>>2],v=A+8|0,g=0|kf[v>>2];while((0|kf[g>>2])!=(0|A));y=g}if((0|y)==(0|d))break;m=y}y=e+12|0,m=0|kf[o>>2];do if(m){for(n=0|kf[a>>2],r=m,u=e+16|0;;){if(c=0|kf[r+16>>2],(0|n)<(0|c)){if(h=0|kf[r>>2],!h){b=23;break}E=h,T=r}else{if((0|c)>=(0|n)){b=27;break}if(S=r+4|0,c=0|kf[S>>2],!c){b=26;break}E=c,T=S}r=E,u=T}if(23==(0|b)){w=r,C=r;break}if(26==(0|b)){w=r,C=S;break}if(27==(0|b)){w=r,C=u;break}}else w=o,C=o;while(0);return o=0|kf[C>>2],o?P=o:(b=0|sl(32),kf[b+16>>2]=kf[a>>2],S=b+20|0,kf[S>>2]=kf[t>>2],T=b+24|0,E=0|kf[a+8>>2],kf[T>>2]=E,m=0|kf[f>>2],kf[b+28>>2]=m,m?(kf[E+8>>2]=T,kf[t>>2]=l,kf[l>>2]=0,kf[f>>2]=0):kf[S>>2]=T,kf[b>>2]=0,kf[b+4>>2]=0,kf[b+8>>2]=w,kf[C>>2]=b,w=0|kf[kf[y>>2]>>2],w?(kf[y>>2]=w,M=0|kf[C>>2]):M=b,re(0|kf[e+16>>2],M),M=e+20|0,kf[M>>2]=(0|kf[M>>2])+1,P=b),Js(a+4|0,0|kf[l>>2]),Js(s,0|kf[d>>2]),p=P,_=p+20|0,Xf=i,0|_}function kn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0;if(i=0|If[t+11>>0],n=i<<24>>24<0,r=n?0|kf[t>>2]:t,s=n?0|kf[t+4>>2]:255&i,s>>>0>3){for(i=r,t=s,n=s;;){if(a=0|np(Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,1540483477),t=(0|np(a>>>24^a,1540483477))^(0|np(t,1540483477)),n=n+-4|0,n>>>0<=3)break;i=i+4|0}i=s+-4|0,n=i&-4,o=r+(n+4)|0,h=t,l=i-n|0}else o=r,h=s,l=s;switch(0|l){case 3:c=Lf[o+2>>0]<<16^h,d=6;break;case 2:c=h,d=6;break;case 1:u=h,d=7;break;default:f=h}if(6==(0|d)&&(u=Lf[o+1>>0]<<8^c,d=7),7==(0|d)&&(f=0|np(Lf[o>>0]^u,1540483477)),u=0|np(f>>>13^f,1540483477),f=u>>>15^u,u=0|kf[e+4>>2],!u)return p=0,0|p;if(o=u+-1|0,c=0==(o&u|0),_=c?f&o:f>>>0<u>>>0?f:(f>>>0)%(u>>>0)|0,h=0|kf[(0|kf[e>>2])+(_<<2)>>2],!h)return p=0,0|p;if(e=0|kf[h>>2],!e)return p=0,0|p;if(h=0==(0|s),c){c=e;e:for(;;){if(l=0|kf[c+4>>2],n=(0|f)==(0|l),!(n|(l&o|0)==(0|_))){p=0,d=41;break}do if(n?(l=c+8|0,i=0|If[l+11>>0],t=i<<24>>24<0,a=255&i,(0|(t?0|kf[c+12>>2]:a))==(0|s)):0){if(i=0|kf[l>>2],m=t?i:l,t){if(h){p=c,d=41;break e}if(0|fo(m,r,s))break;p=c,d=41;break e}if(h){p=c,d=41;break e}if((255&i)<<24>>24==(0|If[r>>0])){i=a,a=l,l=r;do{if(i=i+-1|0,a=a+1|0,!i){p=c,d=41;break e}l=l+1|0}while((0|If[a>>0])==(0|If[l>>0]))}}while(0);if(c=0|kf[c>>2],!c){p=0,d=41;break}}if(41==(0|d))return 0|p}else A=e;e:for(;;){if(e=0|kf[A+4>>2],c=(0|f)==(0|e))d=33;else{if(v=e>>>0<u>>>0?e:(e>>>0)%(u>>>0)|0,(0|v)!=(0|_)){p=0,d=41;break}c&&(d=33)}do if(33==(0|d)?(d=0,c=A+8|0,e=0|If[c+11>>0],o=e<<24>>24<0,n=255&e,(0|(o?0|kf[A+12>>2]:n))==(0|s)):0){if(e=0|kf[c>>2],l=o?e:c,o){if(h){p=A,d=41;break e}if(0|fo(l,r,s))break;p=A,d=41;break e}if(h){p=A,d=41;break e}if((255&e)<<24>>24==(0|If[r>>0])){e=n,n=c,c=r;do{if(e=e+-1|0,n=n+1|0,!e){p=A,d=41;break e}c=c+1|0}while((0|If[n>>0])==(0|If[c>>0]))}}while(0);if(A=0|kf[A>>2],!A){p=0,d=41;break}}return 41==(0|d)?0|p:0}function Dn(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0;t=Xf,Xf=Xf+16|0,i=t;do if(e>>>0<245){if(n=e>>>0<11?16:e+11&-8,r=n>>>3,s=0|kf[4116],a=s>>>r,3&a|0)return o=(1&a^1)+r|0,h=16504+(o<<1<<2)|0,l=h+8|0,c=0|kf[l>>2],d=c+8|0,u=0|kf[d>>2],(0|h)==(0|u)?kf[4116]=s&~(1<<o):(kf[u+12>>2]=h,kf[l>>2]=u),u=o<<3,kf[c+4>>2]=3|u,o=c+u+4|0,kf[o>>2]=1|kf[o>>2],f=d,Xf=t,0|f;if(d=0|kf[4118],n>>>0>d>>>0){if(0|a)return o=2<<r,u=a<<r&(o|0-o),o=(u&0-u)+-1|0,u=o>>>12&16,r=o>>>u,o=r>>>5&8,a=r>>>o,r=a>>>2&4,c=a>>>r,a=c>>>1&2,l=c>>>a,c=l>>>1&1,h=(o|u|r|a|c)+(l>>>c)|0,c=16504+(h<<1<<2)|0,l=c+8|0,a=0|kf[l>>2],r=a+8|0,u=0|kf[r>>2],(0|c)==(0|u)?(o=s&~(1<<h),kf[4116]=o,p=o):(kf[u+12>>2]=c,kf[l>>2]=u,p=s),u=(h<<3)-n|0,kf[a+4>>2]=3|n,h=a+n|0,kf[h+4>>2]=1|u,kf[h+u>>2]=u,0|d&&(a=0|kf[4121],l=d>>>3,c=16504+(l<<1<<2)|0,o=1<<l,p&o?(o=c+8|0,_=o,m=0|kf[o>>2]):(kf[4116]=p|o,_=c+8|0,m=c),kf[_>>2]=a,kf[m+12>>2]=a,kf[a+8>>2]=m,kf[a+12>>2]=c),kf[4118]=u,kf[4121]=h,f=r,Xf=t,0|f;if(r=0|kf[4117]){if(h=(r&0-r)+-1|0,u=h>>>12&16,c=h>>>u,h=c>>>5&8,a=c>>>h,c=a>>>2&4,o=a>>>c,a=o>>>1&2,l=o>>>a,o=l>>>1&1,A=0|kf[16768+((h|u|c|a|o)+(l>>>o)<<2)>>2],o=(kf[A+4>>2]&-8)-n|0,l=0|kf[A+16+((0==(0|kf[A+16>>2])&1)<<2)>>2])for(a=l,l=o,o=A;;){if(A=(kf[a+4>>2]&-8)-n|0,c=A>>>0<l>>>0,u=c?A:l,A=c?a:o,a=0|kf[a+16+((0==(0|kf[a+16>>2])&1)<<2)>>2],!a){v=u,y=A;break}l=u,o=A}else v=o,y=A;if(o=y+n|0,y>>>0<o>>>0){l=0|kf[y+24>>2],a=0|kf[y+12>>2];do if((0|a)==(0|y)){if(A=y+20|0,u=0|kf[A>>2])b=u,E=A;else{if(c=y+16|0,h=0|kf[c>>2],!h){g=0;break}b=h,E=c}for(;;)if(A=b+20|0,u=0|kf[A>>2],0|u)b=u,E=A;else{if(A=b+16|0,u=0|kf[A>>2],!u)break;b=u,E=A}kf[E>>2]=0,g=b}else A=0|kf[y+8>>2],kf[A+12>>2]=a,kf[a+8>>2]=A,g=a;while(0);do if(0|l){if(a=0|kf[y+28>>2],A=16768+(a<<2)|0,(0|y)==(0|kf[A>>2])){if(kf[A>>2]=g,!g){kf[4117]=r&~(1<<a);break}}else if(kf[l+16+(((0|kf[l+16>>2])!=(0|y)&1)<<2)>>2]=g,!g)break;kf[g+24>>2]=l,a=0|kf[y+16>>2],0|a&&(kf[g+16>>2]=a,kf[a+24>>2]=g),a=0|kf[y+20>>2],0|a&&(kf[g+20>>2]=a,kf[a+24>>2]=g)}while(0);return v>>>0<16?(l=v+n|0,kf[y+4>>2]=3|l,r=y+l+4|0,kf[r>>2]=1|kf[r>>2]):(kf[y+4>>2]=3|n,kf[o+4>>2]=1|v,kf[o+v>>2]=v,0|d&&(r=0|kf[4121],l=d>>>3,a=16504+(l<<1<<2)|0,A=1<<l,s&A?(A=a+8|0,T=A,S=0|kf[A>>2]):(kf[4116]=s|A,T=a+8|0,S=a),kf[T>>2]=r,kf[S+12>>2]=r,kf[r+8>>2]=S,kf[r+12>>2]=a),kf[4118]=v,kf[4121]=o),f=y+8|0,Xf=t,0|f}w=n}else w=n}else w=n}else if(e>>>0<=4294967231)if(a=e+11|0,r=a&-8,A=0|kf[4117]){l=0-r|0,u=a>>>8,u?r>>>0>16777215?C=31:(a=(u+1048320|0)>>>16&8,c=u<<a,u=(c+520192|0)>>>16&4,h=c<<u,c=(h+245760|0)>>>16&2,M=14-(u|a|c)+(h<<c>>>15)|0,C=r>>>(M+7|0)&1|M<<1):C=0,M=0|kf[16768+(C<<2)>>2];e:do if(M)for(c=l,h=0,a=r<<(31==(0|C)?0:25-(C>>>1)|0),u=M,O=0;;){if(k=(kf[u+4>>2]&-8)-r|0,k>>>0<c>>>0){if(!k){D=0,L=u,N=u,x=61;break e}F=k,B=u}else F=c,B=O;if(k=0|kf[u+20>>2],u=0|kf[u+16+(a>>>31<<2)>>2],V=0==(0|k)|(0|k)==(0|u)?h:k,k=0==(0|u)){P=F,I=V,R=B,x=57;break}c=F,h=V,a<<=1&(1^k),O=B}else P=l,I=0,R=0,x=57;while(0);if(57==(0|x)){if(0==(0|I)&0==(0|R)){if(M=2<<C,l=A&(M|0-M),!l){w=r;break}M=(l&0-l)+-1|0,l=M>>>12&16,n=M>>>l,M=n>>>5&8,o=n>>>M,n=o>>>2&4,s=o>>>n,o=s>>>1&2,d=s>>>o,s=d>>>1&1,U=0|kf[16768+((M|l|n|o|s)+(d>>>s)<<2)>>2],G=0}else U=I,G=R;U?(D=P,L=U,N=G,x=61):(W=P,z=G)}if(61==(0|x))for(;;){if(x=0,s=(kf[L+4>>2]&-8)-r|0,d=s>>>0<D>>>0,o=d?s:D,s=d?L:N,L=0|kf[L+16+((0==(0|kf[L+16>>2])&1)<<2)>>2],!L){W=o,z=s;break}D=o,N=s,x=61}if(0!=(0|z)?W>>>0<((0|kf[4118])-r|0)>>>0:0){if(s=z+r|0,z>>>0>=s>>>0)return f=0,Xf=t,0|f;o=0|kf[z+24>>2],d=0|kf[z+12>>2];do if((0|d)==(0|z)){if(n=z+20|0,l=0|kf[n>>2])j=l,Y=n;else{if(M=z+16|0,O=0|kf[M>>2],!O){H=0;break}j=O,Y=M}for(;;)if(n=j+20|0,l=0|kf[n>>2],0|l)j=l,Y=n;else{if(n=j+16|0,l=0|kf[n>>2],!l)break;j=l,Y=n}kf[Y>>2]=0,H=j}else n=0|kf[z+8>>2],kf[n+12>>2]=d,kf[d+8>>2]=n,H=d;while(0);do if(o){if(d=0|kf[z+28>>2],n=16768+(d<<2)|0,(0|z)==(0|kf[n>>2])){if(kf[n>>2]=H,!H){n=A&~(1<<d),kf[4117]=n,X=n;break}}else if(kf[o+16+(((0|kf[o+16>>2])!=(0|z)&1)<<2)>>2]=H,!H){X=A;break}kf[H+24>>2]=o,n=0|kf[z+16>>2],0|n&&(kf[H+16>>2]=n,kf[n+24>>2]=H),n=0|kf[z+20>>2],n?(kf[H+20>>2]=n,kf[n+24>>2]=H,X=A):X=A}else X=A;while(0);do if(W>>>0>=16){if(kf[z+4>>2]=3|r,kf[s+4>>2]=1|W,kf[s+W>>2]=W,A=W>>>3,W>>>0<256){o=16504+(A<<1<<2)|0,n=0|kf[4116],d=1<<A,n&d?(d=o+8|0,Z=d,K=0|kf[d>>2]):(kf[4116]=n|d,Z=o+8|0,K=o),kf[Z>>2]=s,kf[K+12>>2]=s,kf[s+8>>2]=K,kf[s+12>>2]=o;break}if(o=W>>>8,o?W>>>0>16777215?Q=31:(d=(o+1048320|0)>>>16&8,n=o<<d,o=(n+520192|0)>>>16&4,A=n<<o,n=(A+245760|0)>>>16&2,l=14-(o|d|n)+(A<<n>>>15)|0,Q=W>>>(l+7|0)&1|l<<1):Q=0,l=16768+(Q<<2)|0,kf[s+28>>2]=Q,n=s+16|0,kf[n+4>>2]=0,kf[n>>2]=0,n=1<<Q,!(X&n)){kf[4117]=X|n,kf[l>>2]=s,kf[s+24>>2]=l,kf[s+12>>2]=s,kf[s+8>>2]=s;break}for(n=W<<(31==(0|Q)?0:25-(Q>>>1)|0),A=0|kf[l>>2];;){if((kf[A+4>>2]&-8|0)==(0|W)){x=97;break}if(J=A+16+(n>>>31<<2)|0,l=0|kf[J>>2],!l){x=96;break}n<<=1,A=l}if(96==(0|x)){kf[J>>2]=s,kf[s+24>>2]=A,kf[s+12>>2]=s,kf[s+8>>2]=s;break}if(97==(0|x)){n=A+8|0,l=0|kf[n>>2],kf[l+12>>2]=s,kf[n>>2]=s,kf[s+8>>2]=l,kf[s+12>>2]=A,kf[s+24>>2]=0;break}}else l=W+r|0,kf[z+4>>2]=3|l,n=z+l+4|0,kf[n>>2]=1|kf[n>>2];while(0);return f=z+8|0,Xf=t,0|f}w=r}else w=r;else w=-1;while(0);if(z=0|kf[4118],z>>>0>=w>>>0)return W=z-w|0,J=0|kf[4121],W>>>0>15?(Q=J+w|0,kf[4121]=Q,kf[4118]=W,kf[Q+4>>2]=1|W,kf[Q+W>>2]=W,kf[J+4>>2]=3|w):(kf[4118]=0,kf[4121]=0,kf[J+4>>2]=3|z,W=J+z+4|0,kf[W>>2]=1|kf[W>>2]),f=J+8|0,Xf=t,0|f;if(J=0|kf[4119],J>>>0>w>>>0)return W=J-w|0,kf[4119]=W,z=0|kf[4122],Q=z+w|0,kf[4122]=Q,kf[Q+4>>2]=1|W,kf[z+4>>2]=3|w,f=z+8|0,Xf=t,0|f;if(0|kf[4234]?q=0|kf[4236]:(kf[4236]=4096,kf[4235]=4096,kf[4237]=-1,kf[4238]=-1,kf[4239]=0,kf[4227]=0,z=i&-16^1431655768,kf[i>>2]=z,kf[4234]=z,q=4096),z=w+48|0,i=w+47|0,W=q+i|0,Q=0-q|0,q=W&Q,q>>>0<=w>>>0)return f=0,Xf=t,0|f;if(X=0|kf[4226],0|X?(K=0|kf[4224],Z=K+q|0,Z>>>0<=K>>>0|Z>>>0>X>>>0):0)return f=0,Xf=t,0|f;e:do if(4&kf[4227])se=0,x=133;else{X=0|kf[4122];t:do if(X){for(Z=16912;;){if(K=0|kf[Z>>2],K>>>0<=X>>>0?($=Z+4|0,(K+(0|kf[$>>2])|0)>>>0>X>>>0):0)break;if(K=0|kf[Z+8>>2],!K){x=118;break t}Z=K}if(A=W-J&Q,A>>>0<2147483647)if(K=0|Yo(0|A),(0|K)==((0|kf[Z>>2])+(0|kf[$>>2])|0)){if((0|K)!=-1){te=K,ie=A,x=135;break e}ee=A}else ne=K,re=A,x=126;else ee=0}else x=118;while(0);do if(118==(0|x))if(X=0|Yo(0),(0|X)!=-1?(r=X,A=0|kf[4235],K=A+-1|0,H=(0==(K&r|0)?0:(K+r&0-A)-r|0)+q|0,r=0|kf[4224],A=H+r|0,H>>>0>w>>>0&H>>>0<2147483647):0){if(K=0|kf[4226],0|K?A>>>0<=r>>>0|A>>>0>K>>>0:0){ee=0;break}if(K=0|Yo(0|H),(0|K)==(0|X)){te=X,ie=H,x=135;break e}ne=K,re=H,x=126}else ee=0;while(0);do if(126==(0|x)){if(H=0-re|0,!(z>>>0>re>>>0&(re>>>0<2147483647&(0|ne)!=-1))){if((0|ne)==-1){ee=0;break}te=ne,ie=re,x=135;break e}if(K=0|kf[4236],X=i-re+K&0-K,X>>>0>=2147483647){te=ne,ie=re,x=135;break e}if((0|Yo(0|X))==-1){0|Yo(0|H),ee=0;break}te=ne,ie=X+re|0,x=135;break e}while(0);kf[4227]=4|kf[4227],se=ee,x=133}while(0);if(!(133==(0|x)?q>>>0<2147483647:0)||(ee=0|Yo(0|q),q=0|Yo(0),re=q-ee|0,ne=re>>>0>(w+40|0)>>>0,(0|ee)==-1|1^ne|ee>>>0<q>>>0&((0|ee)!=-1&(0|q)!=-1)^1)||(te=ee,ie=ne?re:se,x=135),135==(0|x)){se=(0|kf[4224])+ie|0,kf[4224]=se,se>>>0>(0|kf[4225])>>>0&&(kf[4225]=se),se=0|kf[4122];do if(se){for(re=16912;;){if(ae=0|kf[re>>2],oe=re+4|0,he=0|kf[oe>>2],(0|te)==(ae+he|0)){x=145;break}if(ne=0|kf[re+8>>2],!ne)break;re=ne}if((145==(0|x)?0==(8&kf[re+12>>2]|0):0)?se>>>0<te>>>0&se>>>0>=ae>>>0:0){kf[oe>>2]=he+ie,ne=se+8|0,ee=0==(7&ne|0)?0:0-ne&7,ne=se+ee|0,q=(0|kf[4119])+(ie-ee)|0,kf[4122]=ne,kf[4119]=q,kf[ne+4>>2]=1|q,kf[ne+q+4>>2]=40,kf[4123]=kf[4238];break}for(te>>>0<(0|kf[4120])>>>0&&(kf[4120]=te),q=te+ie|0,ne=16912;;){if((0|kf[ne>>2])==(0|q)){x=153;break}if(ee=0|kf[ne+8>>2],!ee)break;ne=ee}if(153==(0|x)?0==(8&kf[ne+12>>2]|0):0){kf[ne>>2]=te,re=ne+4|0,kf[re>>2]=(0|kf[re>>2])+ie,re=te+8|0,ee=te+(0==(7&re|0)?0:0-re&7)|0,re=q+8|0,i=q+(0==(7&re|0)?0:0-re&7)|0,re=ee+w|0,z=i-ee-w|0,kf[ee+4>>2]=3|w;do if((0|i)!=(0|se)){if((0|i)==(0|kf[4121])){$=(0|kf[4118])+z|0,kf[4118]=$,kf[4121]=re,kf[re+4>>2]=1|$,kf[re+$>>2]=$;break}if($=0|kf[i+4>>2],1==(3&$|0)){Q=$&-8,J=$>>>3;e:do{if($>>>0<256){if(W=0|kf[i+8>>2],X=0|kf[i+12>>2],(0|X)==(0|W)){kf[4116]=kf[4116]&~(1<<J);break}kf[W+12>>2]=X,kf[X+8>>2]=W;break}W=0|kf[i+24>>2],X=0|kf[i+12>>2];do if((0|X)==(0|i)){if(H=i+16|0,K=H+4|0,A=0|kf[K>>2])ce=A,de=K;else{if(r=0|kf[H>>2],!r){le=0;break}ce=r,de=H}for(;;)if(K=ce+20|0,A=0|kf[K>>2],0|A)ce=A,de=K;else{if(K=ce+16|0,A=0|kf[K>>2],!A)break;ce=A,de=K}kf[de>>2]=0,le=ce}else K=0|kf[i+8>>2],kf[K+12>>2]=X,kf[X+8>>2]=K,le=X;while(0);if(!W)break;X=0|kf[i+28>>2],K=16768+(X<<2)|0;do{if((0|i)==(0|kf[K>>2])){if(kf[K>>2]=le,0|le)break;kf[4117]=kf[4117]&~(1<<X);break e}if(kf[W+16+(((0|kf[W+16>>2])!=(0|i)&1)<<2)>>2]=le,!le)break e}while(0);if(kf[le+24>>2]=W,X=i+16|0,K=0|kf[X>>2],0|K&&(kf[le+16>>2]=K,kf[K+24>>2]=le),K=0|kf[X+4>>2],!K)break;kf[le+20>>2]=K,kf[K+24>>2]=le}while(0);ue=i+Q|0,fe=Q+z|0}else ue=i,fe=z;if(J=ue+4|0,kf[J>>2]=kf[J>>2]&-2,kf[re+4>>2]=1|fe,kf[re+fe>>2]=fe,J=fe>>>3,fe>>>0<256){$=16504+(J<<1<<2)|0,Z=0|kf[4116],K=1<<J,Z&K?(K=$+8|0,pe=K,_e=0|kf[K>>2]):(kf[4116]=Z|K,pe=$+8|0,_e=$),kf[pe>>2]=re,kf[_e+12>>2]=re,kf[re+8>>2]=_e,kf[re+12>>2]=$;break}$=fe>>>8;do if($){if(fe>>>0>16777215){me=31;break}K=($+1048320|0)>>>16&8,Z=$<<K,J=(Z+520192|0)>>>16&4,X=Z<<J,Z=(X+245760|0)>>>16&2,A=14-(J|K|Z)+(X<<Z>>>15)|0,me=fe>>>(A+7|0)&1|A<<1}else me=0;while(0);if($=16768+(me<<2)|0,kf[re+28>>2]=me,Q=re+16|0,kf[Q+4>>2]=0,kf[Q>>2]=0,Q=0|kf[4117],A=1<<me,!(Q&A)){kf[4117]=Q|A,kf[$>>2]=re,kf[re+24>>2]=$,kf[re+12>>2]=re,kf[re+8>>2]=re;break}for(A=fe<<(31==(0|me)?0:25-(me>>>1)|0),Q=0|kf[$>>2];;){if((kf[Q+4>>2]&-8|0)==(0|fe)){x=194;break}if(Ae=Q+16+(A>>>31<<2)|0,$=0|kf[Ae>>2],!$){x=193;break}A<<=1,Q=$}if(193==(0|x)){kf[Ae>>2]=re,kf[re+24>>2]=Q,kf[re+12>>2]=re,kf[re+8>>2]=re;break}if(194==(0|x)){A=Q+8|0,$=0|kf[A>>2],kf[$+12>>2]=re,kf[A>>2]=re,kf[re+8>>2]=$,kf[re+12>>2]=Q,kf[re+24>>2]=0;break}}else $=(0|kf[4119])+z|0,kf[4119]=$,kf[4122]=re,kf[re+4>>2]=1|$;while(0);return f=ee+8|0,Xf=t,0|f}for(re=16912;;){if(z=0|kf[re>>2],z>>>0<=se>>>0?(ve=z+(0|kf[re+4>>2])|0,ve>>>0>se>>>0):0)break;re=0|kf[re+8>>2]}re=ve+-47|0,ee=re+8|0,z=re+(0==(7&ee|0)?0:0-ee&7)|0,ee=se+16|0,re=z>>>0<ee>>>0?se:z,z=re+8|0,i=te+8|0,q=0==(7&i|0)?0:0-i&7,i=te+q|0,ne=ie+-40-q|0,kf[4122]=i,kf[4119]=ne,kf[i+4>>2]=1|ne,kf[i+ne+4>>2]=40,kf[4123]=kf[4238],ne=re+4|0,kf[ne>>2]=27,kf[z>>2]=kf[4228],kf[z+4>>2]=kf[4229],kf[z+8>>2]=kf[4230],kf[z+12>>2]=kf[4231],kf[4228]=te,kf[4229]=ie,kf[4231]=0,kf[4230]=z,z=re+24|0;do i=z,z=z+4|0,kf[z>>2]=7;while((i+8|0)>>>0<ve>>>0);if((0|re)!=(0|se)){if(z=re-se|0,kf[ne>>2]=kf[ne>>2]&-2,kf[se+4>>2]=1|z,kf[re>>2]=z,i=z>>>3,z>>>0<256){q=16504+(i<<1<<2)|0,$=0|kf[4116],A=1<<i,$&A?(A=q+8|0,ye=A,ge=0|kf[A>>2]):(kf[4116]=$|A,ye=q+8|0,ge=q),kf[ye>>2]=se,kf[ge+12>>2]=se,kf[se+8>>2]=ge,kf[se+12>>2]=q;break}if(q=z>>>8,q?z>>>0>16777215?be=31:(A=(q+1048320|0)>>>16&8,$=q<<A,q=($+520192|0)>>>16&4,i=$<<q,$=(i+245760|0)>>>16&2,Z=14-(q|A|$)+(i<<$>>>15)|0,be=z>>>(Z+7|0)&1|Z<<1):be=0,Z=16768+(be<<2)|0,kf[se+28>>2]=be,kf[se+20>>2]=0,kf[ee>>2]=0,$=0|kf[4117],i=1<<be,!($&i)){kf[4117]=$|i,kf[Z>>2]=se,kf[se+24>>2]=Z,kf[se+12>>2]=se,kf[se+8>>2]=se;break}for(i=z<<(31==(0|be)?0:25-(be>>>1)|0),$=0|kf[Z>>2];;){if((kf[$+4>>2]&-8|0)==(0|z)){x=216;break}if(Ee=$+16+(i>>>31<<2)|0,Z=0|kf[Ee>>2],
!Z){x=215;break}i<<=1,$=Z}if(215==(0|x)){kf[Ee>>2]=se,kf[se+24>>2]=$,kf[se+12>>2]=se,kf[se+8>>2]=se;break}if(216==(0|x)){i=$+8|0,z=0|kf[i>>2],kf[z+12>>2]=se,kf[i>>2]=se,kf[se+8>>2]=z,kf[se+12>>2]=$,kf[se+24>>2]=0;break}}}else{z=0|kf[4120],0==(0|z)|te>>>0<z>>>0&&(kf[4120]=te),kf[4228]=te,kf[4229]=ie,kf[4231]=0,kf[4125]=kf[4234],kf[4124]=-1,z=0;do i=16504+(z<<1<<2)|0,kf[i+12>>2]=i,kf[i+8>>2]=i,z=z+1|0;while(32!=(0|z));z=te+8|0,$=0==(7&z|0)?0:0-z&7,z=te+$|0,i=ie+-40-$|0,kf[4122]=z,kf[4119]=i,kf[z+4>>2]=1|i,kf[z+i+4>>2]=40,kf[4123]=kf[4238]}while(0);if(ie=0|kf[4119],ie>>>0>w>>>0)return te=ie-w|0,kf[4119]=te,ie=0|kf[4122],se=ie+w|0,kf[4122]=se,kf[se+4>>2]=1|te,kf[ie+4>>2]=3|w,f=ie+8|0,Xf=t,0|f}return ie=0|nf(),kf[ie>>2]=12,f=0,Xf=t,0|f}function Ln(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0,Le=0,Ne=0,Fe=0,Be=0,Ve=0,Ue=0,Ge=0,We=0,ze=0,He=0,je=0,Ye=0,Xe=0;i=Xf,Xf=Xf+80|0,n=i+56|0,r=i+40|0,s=i+16|0,a=i+4|0,o=i+36|0,h=i,kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,kf[r+8>>2]=0,kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,Gf[s+16>>2]=ap(1),kf[a>>2]=0,c=a+4|0,kf[c>>2]=0,kf[a+8>>2]=0,d=(0|kf[e+216>>2])==(0|kf[e+220>>2]),u=e+120|0,f=0|kf[e+124>>2];e:do if((0|t)>0){_=e+232|0,m=e+420|0,A=e+308|0,v=e+416|0,y=e+304|0,g=e+296|0,b=e+300|0,E=e+8|0,T=s+4|0,S=e+388|0,w=a+8|0,C=r+8|0,P=e+36|0,I=e+40|0,R=t+-1|0,x=e+400|0,O=0;t:for(;;){k=O+1|0,((0|kf[m>>2])!=-1?0|Qa(x):0)?(D=0|kf[m>>2],kf[v>>2]=D,D?(N=D,L=32):L=17):L=6;i:do if(6==(0|L)){L=0;do{if(0|If[A>>0]){if(D=0|kf[y>>2],B=0|kf[g>>2],V=0|kf[b>>2],U=B+(D>>>3)|0,U>>>0<V>>>0?(G=0|Lf[U>>0],U=D+1|0,kf[y>>2]=U,G&1<<(7&D)|0):0){G=B+(U>>>3)|0,G>>>0<V>>>0?(W=(0|Lf[G>>0])>>>(7&U)&1,G=D+2|0,kf[y>>2]=G,z=G,H=W):(z=U,H=0),U=B+(z>>>3)|0,U>>>0<V>>>0?(V=(0|Lf[U>>0])>>>(7&z),kf[y>>2]=z+1,j=V<<1&2):j=0,F=(j|H)<<1|1;break}kf[v>>2]=0,L=17;break i}F=1}while(0);kf[v>>2]=F,N=F,L=32}while(0);i:do if(17==(0|L)){if(L=0,V=0|kf[l>>2],(0|kf[r>>2])==(0|V)){Y=-1,L=189;break e}U=V+-4|0,B=0|kf[U>>2],W=0|kf[E>>2],G=(0|B)==-1,D=B+1|0,Z=(G?0:(X=0==((D>>>0)%3|0|0)?B+-2|0:D,(0|X)!=-1))?0|kf[(0|kf[W>>2])+(X<<2)>>2]:-1,X=0|kf[W+24>>2],D=0|kf[X+(Z<<2)>>2],K=D+1|0,Q=(0|D)==-1?-1:0==((K>>>0)%3|0|0)?D+-2|0:K,K=3*O|0,D=K+1|0,J=0|kf[W+12>>2],kf[J+(B<<2)>>2]=D,kf[J+(D<<2)>>2]=B,q=K+2|0,kf[J+(Q<<2)>>2]=q,kf[J+(q<<2)>>2]=Q,J=0|kf[W>>2],kf[J+(K<<2)>>2]=Z,W=Q+1|0,ee=((0|Q)!=-1?($=0==((W>>>0)%3|0|0)?Q+-2|0:W,(0|$)!=-1):0)?0|kf[J+($<<2)>>2]:-1,kf[J+(D<<2)>>2]=ee,(G?0:(G=(0==((B>>>0)%3|0|0)?2:-1)+B|0,(0|G)!=-1))?(B=0|kf[J+(G<<2)>>2],kf[J+(q<<2)>>2]=B,(0|B)!=-1&&(kf[X+(B<<2)>>2]=q)):kf[J+(q<<2)>>2]=-1,q=(0|kf[u>>2])+(Z>>>5<<2)|0,kf[q>>2]=kf[q>>2]&~(1<<(31&Z)),kf[U>>2]=K,kf[o>>2]=kf[V+-4>>2],kf[n>>2]=kf[o>>2],p(_,n)}else if(32==(0|L)){switch(L=0,V=5==(0|N),0|N){case 3:case 5:if(K=0|kf[l>>2],(0|kf[r>>2])==(0|K)){Y=-1,L=189;break e}if(U=0|kf[K+-4>>2],K=3*O|0,q=V?K:K+2|0,J=(1&V)+K|0,B=(V?2:1)+K|0,V=0|kf[E>>2],X=0|kf[V+12>>2],kf[X+(B<<2)>>2]=U,kf[X+(U<<2)>>2]=B,X=V+24|0,G=V+28|0,D=0|kf[G>>2],(0|D)==(0|kf[V+32>>2])?(us(X,3112),te=0|kf[G>>2]):(kf[D>>2]=-1,V=D+4|0,kf[G>>2]=V,te=V),V=te-(0|kf[X>>2])>>2,X=V+-1|0,G=0|kf[E>>2],D=0|kf[G+24>>2],$=D,((0|kf[G+28>>2])-D>>2|0)>(0|f)){Y=-1,L=189;break e}D=0|kf[G>>2],kf[D+(B<<2)>>2]=X,0|V&&(kf[$+(X<<2)>>2]=B),(0|U)!=-1?(B=(0==((U>>>0)%3|0|0)?2:-1)+U|0,(0|B)!=-1?(X=0|kf[D+(B<<2)>>2],kf[D+(q<<2)>>2]=X,(0|X)!=-1&&(kf[$+(X<<2)>>2]=q)):kf[D+(q<<2)>>2]=-1,X=U+1|0,$=0==((X>>>0)%3|0|0)?U+-2|0:X,ie=(0|$)==-1?-1:0|kf[D+($<<2)>>2]):(kf[D+(q<<2)>>2]=-1,ie=-1),kf[D+(J<<2)>>2]=ie,J=0|kf[l>>2],kf[J+-4>>2]=K,ne=J;break;case 1:if(J=0|kf[r>>2],K=0|kf[l>>2],(0|J)==(0|K)){Y=-1,L=189;break e}D=K+-4|0,q=0|kf[D>>2],kf[l>>2]=D,$=0|kf[T>>2];n:do if($){if(X=$+-1|0,U=0==(X&$|0),re=U?X&O:O>>>0<$>>>0?O:(O>>>0)%($>>>0)|0,B=0|kf[(0|kf[s>>2])+(re<<2)>>2],0!=(0|B)?(V=0|kf[B>>2],0!=(0|V)):0){r:do if(U)for(B=V;;){if(G=0|kf[B+4>>2],W=(0|G)==(0|O),!(W|(G&X|0)==(0|re))){se=J,ae=D;break n}if(W?(0|kf[B+8>>2])==(0|O):0){oe=B;break r}if(B=0|kf[B>>2],!B){se=J,ae=D;break n}}else for(B=V;;){if(W=0|kf[B+4>>2],(0|W)==(0|O)){if((0|kf[B+8>>2])==(0|O)){oe=B;break r}}else if(he=W>>>0<$>>>0?W:(W>>>0)%($>>>0)|0,(0|he)!=(0|re)){se=J,ae=D;break n}if(B=0|kf[B>>2],!B){se=J,ae=D;break n}}while(0);if(V=oe+12|0,(0|D)==(0|kf[C>>2])){us(r,V),se=0|kf[r>>2],ae=0|kf[l>>2];break}kf[D>>2]=kf[V>>2],kf[l>>2]=K,se=J,ae=K;break}se=J,ae=D}else se=J,ae=D;while(0);if((0|se)==(0|ae)){Y=-1,L=189;break e}if(D=0|kf[ae+-4>>2],J=(0|D)==-1,J?0:(0|kf[(0|kf[(0|kf[E>>2])+12>>2])+(D<<2)>>2])!=-1){Y=-1,L=189;break e}if(K=(0|q)==-1,$=0|kf[E>>2],V=0|kf[$+12>>2],K?0:(0|kf[V+(q<<2)>>2])!=-1){Y=-1,L=189;break e}X=3*O|0,U=X+2|0,kf[V+(D<<2)>>2]=U,kf[V+(U<<2)>>2]=D,B=X+1|0,kf[V+(q<<2)>>2]=B,kf[V+(B<<2)>>2]=q,J?(G=0|kf[$>>2],kf[G+(X<<2)>>2]=-1,ce=G,de=$,ue=-1,fe=-1):(J=(0==((D>>>0)%3|0|0)?2:-1)+D|0,le=(0|J)==-1?-1:0|kf[(0|kf[$>>2])+(J<<2)>>2],J=0|kf[$>>2],kf[J+(X<<2)>>2]=le,W=D+1|0,G=0==((W>>>0)%3|0|0)?D+-2|0:W,(0|G)==-1?(ce=J,de=$,ue=-1,fe=le):(ce=J,de=$,ue=0|kf[J+(G<<2)>>2],fe=le)),kf[ce+(B<<2)>>2]=ue,K?(kf[ce+(U<<2)>>2]=-1,pe=-1,_e=-1):(K=(0==((q>>>0)%3|0|0)?2:-1)+q|0,(0|K)!=-1?(B=0|kf[ce+(K<<2)>>2],kf[ce+(U<<2)>>2]=B,(0|B)!=-1&&(kf[(0|kf[$+24>>2])+(B<<2)>>2]=U)):kf[ce+(U<<2)>>2]=-1,B=q+1|0,K=0==((B>>>0)%3|0|0)?q+-2|0:B,(0|K)==-1?(pe=-1,_e=-1):(pe=K,_e=0|kf[ce+(K<<2)>>2])),kf[n>>2]=_e,U=0|kf[S>>2],K=U+(fe<<2)|0,kf[K>>2]=(0|kf[K>>2])+(0|kf[U+(_e<<2)>>2]),U=0|kf[$+24>>2],(0|fe)!=-1&&(kf[U+(fe<<2)>>2]=kf[U+(kf[n>>2]<<2)>>2]);n:do if((0|pe)!=-1){$=0|kf[de>>2],K=pe;do{if(kf[$+(K<<2)>>2]=fe,B=K+1|0,G=0==((B>>>0)%3|0|0)?K+-2|0:B,(0|G)==-1)break n;if(B=0|kf[V+(G<<2)>>2],G=B+1|0,(0|B)==-1)break n;K=0==((G>>>0)%3|0|0)?B+-2|0:G}while((0|K)!=-1)}while(0);kf[U+(kf[n>>2]<<2)>>2]=-1;do{if(d){if(V=0|kf[c>>2],(0|V)==(0|kf[w>>2])){us(a,n),me=0|kf[l>>2];break}kf[V>>2]=kf[n>>2],kf[c>>2]=V+4,me=ae;break}me=ae}while(0);kf[me+-4>>2]=X,kf[o>>2]=kf[me+-4>>2],kf[n>>2]=kf[o>>2],p(_,n);break i;case 7:if(kf[n>>2]=3*O,U=0|kf[E>>2],V=U+24|0,q=U+28|0,K=0|kf[q>>2],(0|K)==(0|kf[U+32>>2])?(us(V,3112),Ae=0|kf[q>>2]):(kf[K>>2]=-1,U=K+4|0,kf[q>>2]=U,Ae=U),U=Ae-(0|kf[V>>2])>>2,V=U+-1|0,q=0|kf[E>>2],K=0|kf[n>>2],$=0|kf[q>>2],kf[$+(K<<2)>>2]=V,G=q+24|0,B=q+28|0,J=0|kf[B>>2],(0|J)==(0|kf[q+32>>2])?(us(G,3112),ve=0|kf[B>>2],ye=0|kf[q>>2]):(kf[J>>2]=-1,q=J+4|0,kf[B>>2]=q,ve=q,ye=$),kf[ye+(K+1<<2)>>2]=(ve-(0|kf[G>>2])>>2)+-1,G=0|kf[E>>2],K=(0|kf[n>>2])+2|0,$=G+24|0,q=G+28|0,B=0|kf[q>>2],(0|B)==(0|kf[G+32>>2])?(us($,3112),ge=0|kf[q>>2]):(kf[B>>2]=-1,J=B+4|0,kf[q>>2]=J,ge=J),kf[(0|kf[G>>2])+(K<<2)>>2]=(ge-(0|kf[$>>2])>>2)+-1,$=0|kf[E>>2],K=0|kf[$+24>>2],G=K,((0|kf[$+28>>2])-K>>2|0)>(0|f))break t;K=0|kf[n>>2],U?(kf[G+(V<<2)>>2]=K,(0|U)!=-1?(kf[G+(U<<2)>>2]=(0|kf[n>>2])+1,V=U+1|0,(0|V)!=-1&&(be=V,L=116)):(be=0,L=116)):(kf[G+(U<<2)>>2]=K+1,be=1,L=116),116==(0|L)&&(L=0,kf[G+(be<<2)>>2]=(0|kf[n>>2])+2),G=0|kf[l>>2],(0|G)==(0|kf[C>>2])?(us(r,n),Ee=0|kf[l>>2]):(kf[G>>2]=kf[n>>2],K=G+4|0,kf[l>>2]=K,Ee=K),ne=Ee;break;default:Y=-1,L=189;break e}if(kf[o>>2]=kf[ne+-4>>2],kf[n>>2]=kf[o>>2],p(_,n),K=t-O+-1|0,G=0|kf[I>>2],(0|G)!=(0|kf[P>>2])){U=G;do{if(G=U,V=0|kf[G+-8>>2],V>>>0>K>>>0){Y=-1,L=189;break e}if((0|V)!=(0|K))break i;if(V=0|If[G+-4>>0],$=0|kf[G+-12>>2],kf[I>>2]=G+-12,(0|$)<0){Y=-1,L=189;break e}G=0|kf[(0|kf[l>>2])+-4>>2],J=(0|G)==-1;do if(1&V)q=G+1|0,Te=J?-1:0==((q>>>0)%3|0|0)?G+-2|0:q;else{if(!J){if((G>>>0)%3|0){Te=G+-1|0;break}Te=G+2|0;break}Te=-1}while(0);kf[n>>2]=R-$,G=0|M(s,n),kf[G>>2]=Te,U=0|kf[I>>2]}while((0|U)!=(0|kf[P>>2]))}}while(0);if(!((0|k)<(0|t))){Se=E,we=k,L=135;break e}O=k}Y=-1,L=189}else Se=e+8|0,we=0,L=135;while(0);e:do if(135==(0|L))if(t=0|kf[Se>>2],((0|kf[t+28>>2])-(0|kf[t+24>>2])>>2|0)<=(0|f)){Te=0|kf[l>>2];do if((0|Te)!=(0|kf[r>>2])){o=e+270|0,ne=e+364|0,Ee=e+360|0,be=e+352|0,ge=e+356|0,ve=e+60|0,ye=e+64|0,Ae=e+68|0,me=e+76|0,ae=e+80|0,d=e+72|0,fe=e+312|0,pe=Te,de=we;t:for(;;){_e=pe,kf[n>>2]=kf[_e+-4>>2],kf[l>>2]=_e+-4,(0|Ff[o>>1])<514?0|If[ne>>0]?(_e=0|kf[Ee>>2],ce=(0|kf[be>>2])+(_e>>>3)|0,ce>>>0<(0|kf[ge>>2])>>>0?(ue=(0|Lf[ce>>0])>>>(7&_e)&1,kf[Ee>>2]=_e+1,Ce=ue,L=143):L=166):L=144:(Ce=1&(0|Qa(fe)),L=143),143==(0|L)&&(L=0,L=Ce?144:166);do if(144==(0|L)){if(L=0,ue=0|kf[Se>>2],_e=0|kf[ue>>2],ce=_e,(0|de)>=(((0|kf[ue+4>>2])-_e>>2>>>0)/3|0|0)){L=174;break t}if(_e=0|kf[n>>2],le=_e+1|0,Me=((0|_e)!=-1?(se=0==((le>>>0)%3|0|0)?_e+-2|0:le,(0|se)!=-1):0)?0|kf[ce+(se<<2)>>2]:-1,se=0|kf[ue+24>>2],le=0|kf[se+(Me<<2)>>2],oe=le+1|0,((0|le)!=-1?(re=0==((oe>>>0)%3|0|0)?le+-2|0:oe,oe=re+1|0,(0|re)!=-1):0)?(le=0==((oe>>>0)%3|0|0)?re+-2|0:oe,(0|le)==-1?(Pe=re,Ie=-1):(Pe=re,Ie=0|kf[ce+(le<<2)>>2])):(Pe=-1,Ie=-1),le=0|kf[se+(Ie<<2)>>2],se=le+1|0,((0|le)!=-1?(re=0==((se>>>0)%3|0|0)?le+-2|0:se,se=re+1|0,(0|re)!=-1):0)?(le=0==((se>>>0)%3|0|0)?re+-2|0:se,(0|le)==-1?(Re=re,xe=-1):(Re=re,xe=0|kf[ce+(le<<2)>>2])):(Re=-1,xe=-1),le=3*de|0,kf[h>>2]=le,re=0|kf[ue+12>>2],kf[re+(le<<2)>>2]=_e,kf[re+(_e<<2)>>2]=le,le=(0|kf[h>>2])+1|0,kf[re+(le<<2)>>2]=Pe,kf[re+(Pe<<2)>>2]=le,le=(0|kf[h>>2])+2|0,kf[re+(le<<2)>>2]=Re,kf[re+(Re<<2)>>2]=le,le=0|kf[h>>2],re=ce+(le<<2)|0,kf[re>>2]=Ie,kf[ce+(le+1<<2)>>2]=xe,kf[ce+(le+2<<2)>>2]=Me,Oe=(0|le)==-1?-1:0|kf[re>>2],re=0|kf[u>>2],le=re+(Oe>>>5<<2)|0,kf[le>>2]=kf[le>>2]&~(1<<(31&Oe)),le=(0|kf[h>>2])+1|0,ke=(0|le)==-1?-1:0|kf[ce+(le<<2)>>2],le=re+(ke>>>5<<2)|0,kf[le>>2]=kf[le>>2]&~(1<<(31&ke)),le=(0|kf[h>>2])+2|0,De=(0|le)==-1?-1:0|kf[ce+(le<<2)>>2],le=re+(De>>>5<<2)|0,kf[le>>2]=kf[le>>2]&~(1<<(31&De)),le=de+1|0,re=0|kf[ye>>2],ce=0|kf[Ae>>2],(0|re)==(ce<<5|0)){if((re+1|0)<0){L=158;break t}_e=ce<<6,ce=re+32&-32,Hr(ve,re>>>0<1073741823?_e>>>0<ce>>>0?ce:_e:2147483647),Le=0|kf[ye>>2]}else Le=re;kf[ye>>2]=Le+1,re=(0|kf[ve>>2])+(Le>>>5<<2)|0,kf[re>>2]=kf[re>>2]|1<<(31&Le),re=0|kf[me>>2],(0|re)==(0|kf[ae>>2])?us(d,h):(kf[re>>2]=kf[h>>2],kf[me>>2]=re+4),Ne=le}else if(166==(0|L)){if(L=0,le=0|kf[ye>>2],re=0|kf[Ae>>2],(0|le)==(re<<5|0)){if((le+1|0)<0){L=168;break t}_e=re<<6,re=le+32&-32,Hr(ve,le>>>0<1073741823?_e>>>0<re>>>0?re:_e:2147483647),Fe=0|kf[ye>>2]}else Fe=le;if(kf[ye>>2]=Fe+1,le=(0|kf[ve>>2])+(Fe>>>5<<2)|0,kf[le>>2]=kf[le>>2]&~(1<<(31&Fe)),le=0|kf[me>>2],(0|le)==(0|kf[ae>>2])){us(d,n),Ne=de;break}kf[le>>2]=kf[n>>2],kf[me>>2]=le+4,Ne=de;break}while(0);if(pe=0|kf[l>>2],(0|pe)==(0|kf[r>>2])){L=175;break}de=Ne}if(158==(0|L))Du(ve);else if(168==(0|L))Du(ve);else{if(174==(0|L)){Y=-1,L=189;break e}if(175==(0|L)){Be=0|kf[Se>>2],Ve=Ne;break}}}else Be=t,Ve=we;while(0);if((0|Ve)==(((0|kf[Be+4>>2])-(0|kf[Be>>2])>>2>>>0)/3|0|0))if(t=(0|kf[Be+28>>2])-(0|kf[Be+24>>2])>>2,Te=0|kf[a>>2],de=0|kf[c>>2],(0|Te)==(0|de))Ue=Te,Ge=t;else for(pe=n+4|0,me=n+8|0,d=n+12|0,ae=Be,ye=Te,Te=t;;){if(t=0|kf[ye>>2],Ae=Te+-1|0,fe=0|kf[ae+24>>2],(0|kf[fe+(Ae<<2)>>2])==-1)for(Ee=Te;;){if(ge=Ee+-1|0,be=Ee+-2|0,(0|kf[fe+(be<<2)>>2])!=-1){We=ge,ze=be;break}Ee=ge}else We=Te,ze=Ae;if(ze>>>0<t>>>0)He=ae,je=We;else{if(kf[n>>2]=ae,Ee=0|kf[fe+(ze<<2)>>2],kf[pe>>2]=Ee,kf[me>>2]=Ee,If[d>>0]=1,(0|Ee)==-1)Ye=ae;else for(ve=ae,be=Ee;;){if(kf[(0|kf[ve>>2])+(be<<2)>>2]=t,pr(n),be=0|kf[me>>2],Ee=0|kf[Se>>2],(0|be)==-1){Ye=Ee;break}ve=Ee}ve=0|kf[Ye+24>>2],(0|t)==-1?Xe=ve+(ze<<2)|0:(be=ve+(ze<<2)|0,kf[ve+(t<<2)>>2]=kf[be>>2],Xe=be),kf[Xe>>2]=-1,be=0|kf[u>>2],ve=be+(ze>>>5<<2)|0,fe=1<<(31&ze),Ae=be+(t>>>5<<2)|0,be=1<<(31&t),Ee=0|kf[Ae>>2],kf[Ae>>2]=kf[ve>>2]&fe|0?Ee|be:Ee&~be,kf[ve>>2]=kf[ve>>2]&~fe,He=Ye,je=We+-1|0}if(ye=ye+4|0,(0|ye)==(0|de)){Y=je,L=189;break}ae=He,Te=je}else Y=-1,L=189}else Y=-1,L=189;while(0);if(189==(0|L)&&(Ue=0|kf[a>>2],Ge=Y),0|Ue&&(Y=0|kf[c>>2],(0|Y)!=(0|Ue)&&(kf[c>>2]=Y+(~((Y+-4-Ue|0)>>>2)<<2)),mf(Ue)),Ue=0|kf[s+8>>2],0|Ue){Y=Ue;do Ue=Y,Y=0|kf[Y>>2],mf(Ue);while(0!=(0|Y))}return Y=0|kf[s>>2],kf[s>>2]=0,0|Y&&mf(Y),(Y=0|kf[r>>2])?(r=0|kf[l>>2],(0|r)!=(0|Y)&&(kf[l>>2]=r+(~((r+-4-Y|0)>>>2)<<2)),mf(Y),Xf=i,0|Ge):(Xf=i,0|Ge)}function Nn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,S=0,w=0,C=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0,Le=0,Ne=0,Fe=0;i=Xf,Xf=Xf+80|0,n=i+56|0,r=i+40|0,s=i+16|0,a=i+4|0,o=i+36|0,h=i,kf[r>>2]=0,l=r+4|0,kf[l>>2]=0,kf[r+8>>2]=0,kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,Gf[s+16>>2]=ap(1),kf[a>>2]=0,c=a+4|0,kf[c>>2]=0,kf[a+8>>2]=0,d=(0|kf[e+216>>2])==(0|kf[e+220>>2]),u=e+120|0,f=0|kf[e+124>>2];e:do if((0|t)>0){p=e+232|0,_=e+8|0,m=e+36|0,A=e+40|0,v=t+-1|0,y=s+4|0,g=e+388|0,b=a+8|0,E=r+8|0,S=0;t:for(;;){w=S+1|0,C=0|ai(p);i:do if(C){switch(P=5==(0|C),0|C){case 3:case 5:if(I=0|kf[l>>2],(0|kf[r>>2])==(0|I)){R=-1,x=177;break e}if(O=0|kf[I+-4>>2],I=3*S|0,k=P?I:I+2|0,D=(1&P)+I|0,L=(P?2:1)+I|0,P=0|kf[_>>2],N=0|kf[P+12>>2],kf[N+(L<<2)>>2]=O,kf[N+(O<<2)>>2]=L,N=P+24|0,F=P+28|0,B=0|kf[F>>2],(0|B)==(0|kf[P+32>>2])?(us(N,3112),V=0|kf[F>>2]):(kf[B>>2]=-1,P=B+4|0,kf[F>>2]=P,V=P),P=V-(0|kf[N>>2])>>2,N=P+-1|0,F=0|kf[_>>2],B=0|kf[F+24>>2],U=B,((0|kf[F+28>>2])-B>>2|0)>(0|f)){R=-1,x=177;break e}B=0|kf[F>>2],kf[B+(L<<2)>>2]=N,0|P&&(kf[U+(N<<2)>>2]=L),(0|O)!=-1?(L=(0==((O>>>0)%3|0|0)?2:-1)+O|0,(0|L)!=-1?(N=0|kf[B+(L<<2)>>2],kf[B+(k<<2)>>2]=N,(0|N)!=-1&&(kf[U+(N<<2)>>2]=k)):kf[B+(k<<2)>>2]=-1,N=O+1|0,U=0==((N>>>0)%3|0|0)?O+-2|0:N,G=(0|U)==-1?-1:0|kf[B+(U<<2)>>2]):(kf[B+(k<<2)>>2]=-1,G=-1),kf[B+(D<<2)>>2]=G,D=0|kf[l>>2],kf[D+-4>>2]=I,W=D;break;case 1:if(D=0|kf[r>>2],I=0|kf[l>>2],(0|D)==(0|I)){R=-1,x=177;break e}B=I+-4|0,k=0|kf[B>>2],kf[l>>2]=B,U=0|kf[y>>2];n:do if(U){if(N=U+-1|0,O=0==(N&U|0),z=O?N&S:S>>>0<U>>>0?S:(S>>>0)%(U>>>0)|0,L=0|kf[(0|kf[s>>2])+(z<<2)>>2],0!=(0|L)?(P=0|kf[L>>2],0!=(0|P)):0){r:do if(O)for(L=P;;){if(F=0|kf[L+4>>2],H=(0|F)==(0|S),!(H|(F&N|0)==(0|z))){j=D,Y=B;break n}if(H?(0|kf[L+8>>2])==(0|S):0){X=L;break r}if(L=0|kf[L>>2],!L){j=D,Y=B;break n}}else for(L=P;;){if(H=0|kf[L+4>>2],(0|H)==(0|S)){if((0|kf[L+8>>2])==(0|S)){X=L;break r}}else if(Z=H>>>0<U>>>0?H:(H>>>0)%(U>>>0)|0,(0|Z)!=(0|z)){j=D,Y=B;break n}if(L=0|kf[L>>2],!L){j=D,Y=B;break n}}while(0);if(P=X+12|0,(0|B)==(0|kf[E>>2])){us(r,P),j=0|kf[r>>2],Y=0|kf[l>>2];break}kf[B>>2]=kf[P>>2],kf[l>>2]=I,j=D,Y=I;break}j=D,Y=B}else j=D,Y=B;while(0);if((0|j)==(0|Y)){R=-1,x=177;break e}if(B=0|kf[Y+-4>>2],D=(0|B)==-1,D?0:(0|kf[(0|kf[(0|kf[_>>2])+12>>2])+(B<<2)>>2])!=-1){R=-1,x=177;break e}if(I=(0|k)==-1,U=0|kf[_>>2],P=0|kf[U+12>>2],I?0:(0|kf[P+(k<<2)>>2])!=-1){R=-1,x=177;break e}N=3*S|0,O=N+2|0,kf[P+(B<<2)>>2]=O,kf[P+(O<<2)>>2]=B,L=N+1|0,kf[P+(k<<2)>>2]=L,kf[P+(L<<2)>>2]=k,D?(F=0|kf[U>>2],kf[F+(N<<2)>>2]=-1,Q=F,J=U,q=-1,$=-1):(D=(0==((B>>>0)%3|0|0)?2:-1)+B|0,K=(0|D)==-1?-1:0|kf[(0|kf[U>>2])+(D<<2)>>2],D=0|kf[U>>2],kf[D+(N<<2)>>2]=K,H=B+1|0,F=0==((H>>>0)%3|0|0)?B+-2|0:H,(0|F)==-1?(Q=D,J=U,q=-1,$=K):(Q=D,J=U,q=0|kf[D+(F<<2)>>2],$=K)),kf[Q+(L<<2)>>2]=q,I?(kf[Q+(O<<2)>>2]=-1,ee=-1,te=-1):(I=(0==((k>>>0)%3|0|0)?2:-1)+k|0,(0|I)!=-1?(L=0|kf[Q+(I<<2)>>2],kf[Q+(O<<2)>>2]=L,(0|L)!=-1&&(kf[(0|kf[U+24>>2])+(L<<2)>>2]=O)):kf[Q+(O<<2)>>2]=-1,L=k+1|0,I=0==((L>>>0)%3|0|0)?k+-2|0:L,(0|I)==-1?(ee=-1,te=-1):(ee=I,te=0|kf[Q+(I<<2)>>2])),kf[n>>2]=te,O=0|kf[g>>2],I=O+($<<2)|0,kf[I>>2]=(0|kf[I>>2])+(0|kf[O+(te<<2)>>2]),O=0|kf[U+24>>2],(0|$)!=-1&&(kf[O+($<<2)>>2]=kf[O+(kf[n>>2]<<2)>>2]);n:do if((0|ee)!=-1){U=0|kf[J>>2],I=ee;do{if(kf[U+(I<<2)>>2]=$,L=I+1|0,F=0==((L>>>0)%3|0|0)?I+-2|0:L,(0|F)==-1)break n;if(L=0|kf[P+(F<<2)>>2],F=L+1|0,(0|L)==-1)break n;I=0==((F>>>0)%3|0|0)?L+-2|0:F}while((0|I)!=-1)}while(0);kf[O+(kf[n>>2]<<2)>>2]=-1;do{if(d){if(P=0|kf[c>>2],(0|P)==(0|kf[b>>2])){us(a,n),ie=0|kf[l>>2];break}kf[P>>2]=kf[n>>2],kf[c>>2]=P+4,ie=Y;break}ie=Y}while(0);kf[ie+-4>>2]=N,kf[o>>2]=kf[ie+-4>>2],kf[n>>2]=kf[o>>2],T(p,n);break i;case 7:if(kf[n>>2]=3*S,O=0|kf[_>>2],P=O+24|0,k=O+28|0,I=0|kf[k>>2],(0|I)==(0|kf[O+32>>2])?(us(P,3112),ne=0|kf[k>>2]):(kf[I>>2]=-1,O=I+4|0,kf[k>>2]=O,ne=O),O=ne-(0|kf[P>>2])>>2,P=O+-1|0,k=0|kf[_>>2],I=0|kf[n>>2],U=0|kf[k>>2],kf[U+(I<<2)>>2]=P,F=k+24|0,L=k+28|0,D=0|kf[L>>2],(0|D)==(0|kf[k+32>>2])?(us(F,3112),re=0|kf[L>>2],se=0|kf[k>>2]):(kf[D>>2]=-1,k=D+4|0,kf[L>>2]=k,re=k,se=U),kf[se+(I+1<<2)>>2]=(re-(0|kf[F>>2])>>2)+-1,F=0|kf[_>>2],I=(0|kf[n>>2])+2|0,U=F+24|0,k=F+28|0,L=0|kf[k>>2],(0|L)==(0|kf[F+32>>2])?(us(U,3112),ae=0|kf[k>>2]):(kf[L>>2]=-1,D=L+4|0,kf[k>>2]=D,ae=D),kf[(0|kf[F>>2])+(I<<2)>>2]=(ae-(0|kf[U>>2])>>2)+-1,U=0|kf[_>>2],I=0|kf[U+24>>2],F=I,((0|kf[U+28>>2])-I>>2|0)>(0|f))break t;I=0|kf[n>>2],O?(kf[F+(P<<2)>>2]=I,(0|O)!=-1?(kf[F+(O<<2)>>2]=(0|kf[n>>2])+1,P=O+1|0,(0|P)!=-1&&(oe=P,x=104)):(oe=0,x=104)):(kf[F+(O<<2)>>2]=I+1,oe=1,x=104),104==(0|x)&&(x=0,kf[F+(oe<<2)>>2]=(0|kf[n>>2])+2),F=0|kf[l>>2],(0|F)==(0|kf[E>>2])?(us(r,n),he=0|kf[l>>2]):(kf[F>>2]=kf[n>>2],I=F+4|0,kf[l>>2]=I,he=I),W=he;break;default:R=-1,x=177;break e}if(kf[o>>2]=kf[W+-4>>2],kf[n>>2]=kf[o>>2],T(p,n),I=t-S+-1|0,F=0|kf[A>>2],(0|F)!=(0|kf[m>>2])){O=F;do{if(F=O,P=0|kf[F+-8>>2],P>>>0>I>>>0){R=-1,x=177;break e}if((0|P)!=(0|I))break i;if(P=0|If[F+-4>>0],U=0|kf[F+-12>>2],kf[A>>2]=F+-12,(0|U)<0){R=-1,x=177;break e}F=0|kf[(0|kf[l>>2])+-4>>2],D=(0|F)==-1;do if(1&P)k=F+1|0,le=D?-1:0==((k>>>0)%3|0|0)?F+-2|0:k;else{if(!D){if((F>>>0)%3|0){le=F+-1|0;break}le=F+2|0;break}le=-1}while(0);kf[n>>2]=v-U,F=0|M(s,n),kf[F>>2]=le,O=0|kf[A>>2]}while((0|O)!=(0|kf[m>>2]))}}else{if(O=0|kf[l>>2],(0|kf[r>>2])==(0|O)){R=-1,x=177;break e}I=O+-4|0,N=0|kf[I>>2],F=0|kf[_>>2],D=(0|N)==-1,P=N+1|0,ce=(D?0:(k=0==((P>>>0)%3|0|0)?N+-2|0:P,(0|k)!=-1))?0|kf[(0|kf[F>>2])+(k<<2)>>2]:-1,k=0|kf[F+24>>2],P=0|kf[k+(ce<<2)>>2],L=P+1|0,de=(0|P)==-1?-1:0==((L>>>0)%3|0|0)?P+-2|0:L,L=3*S|0,P=L+1|0,H=0|kf[F+12>>2],kf[H+(N<<2)>>2]=P,kf[H+(P<<2)>>2]=N,B=L+2|0,kf[H+(de<<2)>>2]=B,kf[H+(B<<2)>>2]=de,H=0|kf[F>>2],kf[H+(L<<2)>>2]=ce,F=de+1|0,fe=((0|de)!=-1?(ue=0==((F>>>0)%3|0|0)?de+-2|0:F,(0|ue)!=-1):0)?0|kf[H+(ue<<2)>>2]:-1,kf[H+(P<<2)>>2]=fe,(D?0:(D=(0==((N>>>0)%3|0|0)?2:-1)+N|0,(0|D)!=-1))?(N=0|kf[H+(D<<2)>>2],kf[H+(B<<2)>>2]=N,(0|N)!=-1&&(kf[k+(N<<2)>>2]=B)):kf[H+(B<<2)>>2]=-1,B=(0|kf[u>>2])+(ce>>>5<<2)|0,kf[B>>2]=kf[B>>2]&~(1<<(31&ce)),kf[I>>2]=L,kf[o>>2]=kf[O+-4>>2],kf[n>>2]=kf[o>>2],T(p,n)}while(0);if(!((0|w)<(0|t))){pe=_,_e=w,x=123;break e}S=w}R=-1,x=177}else pe=e+8|0,_e=0,x=123;while(0);e:do if(123==(0|x))if(t=0|kf[pe>>2],((0|kf[t+28>>2])-(0|kf[t+24>>2])>>2|0)<=(0|f)){o=0|kf[l>>2];do if((0|o)!=(0|kf[r>>2])){ce=e+270|0,fe=e+364|0,de=e+360|0,le=e+352|0,W=e+356|0,he=e+60|0,oe=e+64|0,ae=e+68|0,re=e+76|0,se=e+80|0,ne=e+72|0,ie=e+312|0,Y=o,d=_e;t:for(;;){$=Y,kf[n>>2]=kf[$+-4>>2],kf[l>>2]=$+-4,(0|Ff[ce>>1])<514?0|If[fe>>0]?($=0|kf[de>>2],ee=(0|kf[le>>2])+($>>>3)|0,ee>>>0<(0|kf[W>>2])>>>0?(J=(0|Lf[ee>>0])>>>(7&$)&1,kf[de>>2]=$+1,me=J,x=131):x=154):x=132:(me=1&(0|Qa(ie)),x=131),131==(0|x)&&(x=0,x=me?132:154);do if(132==(0|x)){if(x=0,J=0|kf[pe>>2],$=0|kf[J>>2],ee=$,(0|d)>=(((0|kf[J+4>>2])-$>>2>>>0)/3|0|0)){x=162;break t}if($=0|kf[n>>2],te=$+1|0,Ae=((0|$)!=-1?(Q=0==((te>>>0)%3|0|0)?$+-2|0:te,(0|Q)!=-1):0)?0|kf[ee+(Q<<2)>>2]:-1,Q=0|kf[J+24>>2],te=0|kf[Q+(Ae<<2)>>2],q=te+1|0,((0|te)!=-1?(K=0==((q>>>0)%3|0|0)?te+-2|0:q,q=K+1|0,(0|K)!=-1):0)?(te=0==((q>>>0)%3|0|0)?K+-2|0:q,(0|te)==-1?(ve=K,ye=-1):(ve=K,ye=0|kf[ee+(te<<2)>>2])):(ve=-1,ye=-1),te=0|kf[Q+(ye<<2)>>2],Q=te+1|0,((0|te)!=-1?(K=0==((Q>>>0)%3|0|0)?te+-2|0:Q,Q=K+1|0,(0|K)!=-1):0)?(te=0==((Q>>>0)%3|0|0)?K+-2|0:Q,(0|te)==-1?(ge=K,be=-1):(ge=K,be=0|kf[ee+(te<<2)>>2])):(ge=-1,be=-1),te=3*d|0,kf[h>>2]=te,K=0|kf[J+12>>2],kf[K+(te<<2)>>2]=$,kf[K+($<<2)>>2]=te,te=(0|kf[h>>2])+1|0,kf[K+(te<<2)>>2]=ve,kf[K+(ve<<2)>>2]=te,te=(0|kf[h>>2])+2|0,kf[K+(te<<2)>>2]=ge,kf[K+(ge<<2)>>2]=te,te=0|kf[h>>2],K=ee+(te<<2)|0,kf[K>>2]=ye,kf[ee+(te+1<<2)>>2]=be,kf[ee+(te+2<<2)>>2]=Ae,Ee=(0|te)==-1?-1:0|kf[K>>2],K=0|kf[u>>2],te=K+(Ee>>>5<<2)|0,kf[te>>2]=kf[te>>2]&~(1<<(31&Ee)),te=(0|kf[h>>2])+1|0,Te=(0|te)==-1?-1:0|kf[ee+(te<<2)>>2],te=K+(Te>>>5<<2)|0,kf[te>>2]=kf[te>>2]&~(1<<(31&Te)),te=(0|kf[h>>2])+2|0,Se=(0|te)==-1?-1:0|kf[ee+(te<<2)>>2],te=K+(Se>>>5<<2)|0,kf[te>>2]=kf[te>>2]&~(1<<(31&Se)),te=d+1|0,K=0|kf[oe>>2],ee=0|kf[ae>>2],(0|K)==(ee<<5|0)){if((K+1|0)<0){x=146;break t}$=ee<<6,ee=K+32&-32,Hr(he,K>>>0<1073741823?$>>>0<ee>>>0?ee:$:2147483647),we=0|kf[oe>>2]}else we=K;kf[oe>>2]=we+1,K=(0|kf[he>>2])+(we>>>5<<2)|0,kf[K>>2]=kf[K>>2]|1<<(31&we),K=0|kf[re>>2],(0|K)==(0|kf[se>>2])?us(ne,h):(kf[K>>2]=kf[h>>2],kf[re>>2]=K+4),Ce=te}else if(154==(0|x)){if(x=0,te=0|kf[oe>>2],K=0|kf[ae>>2],(0|te)==(K<<5|0)){if((te+1|0)<0){x=156;break t}$=K<<6,K=te+32&-32,Hr(he,te>>>0<1073741823?$>>>0<K>>>0?K:$:2147483647),Me=0|kf[oe>>2]}else Me=te;if(kf[oe>>2]=Me+1,te=(0|kf[he>>2])+(Me>>>5<<2)|0,kf[te>>2]=kf[te>>2]&~(1<<(31&Me)),te=0|kf[re>>2],(0|te)==(0|kf[se>>2])){us(ne,n),Ce=d;break}kf[te>>2]=kf[n>>2],kf[re>>2]=te+4,Ce=d;break}while(0);if(Y=0|kf[l>>2],(0|Y)==(0|kf[r>>2])){x=163;break}d=Ce}if(146==(0|x))Du(he);else if(156==(0|x))Du(he);else{if(162==(0|x)){R=-1,x=177;break e}if(163==(0|x)){Pe=0|kf[pe>>2],Ie=Ce;break}}}else Pe=t,Ie=_e;while(0);if((0|Ie)==(((0|kf[Pe+4>>2])-(0|kf[Pe>>2])>>2>>>0)/3|0|0))if(t=(0|kf[Pe+28>>2])-(0|kf[Pe+24>>2])>>2,o=0|kf[a>>2],d=0|kf[c>>2],(0|o)==(0|d))Re=o,xe=t;else for(Y=n+4|0,re=n+8|0,ne=n+12|0,se=Pe,oe=o,o=t;;){if(t=0|kf[oe>>2],ae=o+-1|0,ie=0|kf[se+24>>2],(0|kf[ie+(ae<<2)>>2])==-1)for(de=o;;){if(W=de+-1|0,le=de+-2|0,(0|kf[ie+(le<<2)>>2])!=-1){Oe=W,ke=le;break}de=W}else Oe=o,ke=ae;if(ke>>>0<t>>>0)De=se,Le=Oe;else{if(kf[n>>2]=se,de=0|kf[ie+(ke<<2)>>2],kf[Y>>2]=de,kf[re>>2]=de,If[ne>>0]=1,(0|de)==-1)Ne=se;else for(he=se,le=de;;){if(kf[(0|kf[he>>2])+(le<<2)>>2]=t,pr(n),le=0|kf[re>>2],de=0|kf[pe>>2],(0|le)==-1){Ne=de;break}he=de}he=0|kf[Ne+24>>2],(0|t)==-1?Fe=he+(ke<<2)|0:(le=he+(ke<<2)|0,kf[he+(t<<2)>>2]=kf[le>>2],Fe=le),kf[Fe>>2]=-1,le=0|kf[u>>2],he=le+(ke>>>5<<2)|0,ie=1<<(31&ke),ae=le+(t>>>5<<2)|0,le=1<<(31&t),de=0|kf[ae>>2],kf[ae>>2]=kf[he>>2]&ie|0?de|le:de&~le,kf[he>>2]=kf[he>>2]&~ie,De=Ne,Le=Oe+-1|0}if(oe=oe+4|0,(0|oe)==(0|d)){R=Le,x=177;break}se=De,o=Le}else R=-1,x=177}else R=-1,x=177;while(0);if(177==(0|x)&&(Re=0|kf[a>>2],xe=R),0|Re&&(R=0|kf[c>>2],(0|R)!=(0|Re)&&(kf[c>>2]=R+(~((R+-4-Re|0)>>>2)<<2)),mf(Re)),Re=0|kf[s+8>>2],0|Re){R=Re;do Re=R,R=0|kf[R>>2],mf(Re);while(0!=(0|R))}return R=0|kf[s>>2],kf[s>>2]=0,0|R&&mf(R),(R=0|kf[r>>2])?(r=0|kf[l>>2],(0|r)!=(0|R)&&(kf[l>>2]=r+(~((r+-4-R|0)>>>2)<<2)),mf(R),Xf=i,0|xe):(Xf=i,0|xe)}function Fn(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0,Le=0,Ne=0,Fe=0,Be=0;i=Xf,Xf=Xf+80|0,n=i+56|0,r=i+36|0,s=i+24|0,a=i+8|0,o=i,kf[n>>2]=0,h=n+4|0,kf[h>>2]=0,kf[n+8>>2]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,Gf[r+16>>2]=ap(1),kf[s>>2]=0,l=s+4|0,kf[l>>2]=0,kf[s+8>>2]=0,c=(0|kf[e+216>>2])==(0|kf[e+220>>2]),d=e+120|0,u=0|kf[e+124>>2];e:do if((0|t)>0){f=e+308|0,p=r+4|0,_=e+8|0,m=s+8|0,A=n+8|0,v=e+304|0,y=e+296|0,g=e+300|0,b=e+36|0,E=e+40|0,T=t+-1|0,S=0;t:for(;;){w=S+1|0;i:do if(0|If[f>>0]){if(P=0|kf[v>>2],I=0|kf[y>>2],R=0|kf[g>>2],x=I+(P>>>3)|0,x>>>0<R>>>0?(O=0|Lf[x>>0],x=P+1|0,kf[v>>2]=x,O&1<<(7&P)|0):0){switch(O=I+(x>>>3)|0,O>>>0<R>>>0?(k=(0|Lf[O>>0])>>>(7&x)&1,O=P+2|0,kf[v>>2]=O,D=O,L=k):(D=x,L=0),x=I+(D>>>3)|0,x>>>0<R>>>0?(R=(0|Lf[x>>0])>>>(7&D),kf[v>>2]=D+1,N=R<<1&2):N=0,R=(N|L)<<1|1,x=5==(0|R),7&R){case 1:C=43;break i;case 3:case 5:if(R=0|kf[h>>2],(0|kf[n>>2])==(0|R)){F=-1,C=184;break e}if(I=0|kf[R+-4>>2],R=3*S|0,k=x?R:R+2|0,O=(1&x)+R|0,P=(x?2:1)+R|0,x=0|kf[_>>2],B=0|kf[x+12>>2],kf[B+(P<<2)>>2]=I,kf[B+(I<<2)>>2]=P,B=x+24|0,V=x+28|0,U=0|kf[V>>2],(0|U)==(0|kf[x+32>>2])?(us(B,3112),G=0|kf[V>>2]):(kf[U>>2]=-1,x=U+4|0,kf[V>>2]=x,G=x),x=G-(0|kf[B>>2])>>2,B=x+-1|0,V=0|kf[_>>2],U=0|kf[V+24>>2],W=U,((0|kf[V+28>>2])-U>>2|0)>(0|u)){F=-1,C=184;break e}U=0|kf[V>>2],kf[U+(P<<2)>>2]=B,0|x&&(kf[W+(B<<2)>>2]=P),(0|I)!=-1?(P=(0==((I>>>0)%3|0|0)?2:-1)+I|0,(0|P)!=-1?(B=0|kf[U+(P<<2)>>2],kf[U+(k<<2)>>2]=B,(0|B)!=-1&&(kf[W+(B<<2)>>2]=k)):kf[U+(k<<2)>>2]=-1,B=I+1|0,W=0==((B>>>0)%3|0|0)?I+-2|0:B,z=(0|W)==-1?-1:0|kf[U+(W<<2)>>2]):(kf[U+(k<<2)>>2]=-1,z=-1),kf[U+(O<<2)>>2]=z,kf[(0|kf[h>>2])+-4>>2]=R;break;case 7:if(kf[a>>2]=3*S,R=0|kf[_>>2],O=R+24|0,U=R+28|0,k=0|kf[U>>2],(0|k)==(0|kf[R+32>>2])?(us(O,3112),H=0|kf[U>>2]):(kf[k>>2]=-1,R=k+4|0,kf[U>>2]=R,H=R),R=H-(0|kf[O>>2])>>2,O=R+-1|0,U=0|kf[_>>2],k=0|kf[a>>2],W=0|kf[U>>2],kf[W+(k<<2)>>2]=O,B=U+24|0,I=U+28|0,P=0|kf[I>>2],(0|P)==(0|kf[U+32>>2])?(us(B,3112),j=0|kf[I>>2],Y=0|kf[U>>2]):(kf[P>>2]=-1,U=P+4|0,kf[I>>2]=U,j=U,Y=W),kf[Y+(k+1<<2)>>2]=(j-(0|kf[B>>2])>>2)+-1,B=0|kf[_>>2],k=(0|kf[a>>2])+2|0,W=B+24|0,U=B+28|0,I=0|kf[U>>2],(0|I)==(0|kf[B+32>>2])?(us(W,3112),X=0|kf[U>>2]):(kf[I>>2]=-1,P=I+4|0,kf[U>>2]=P,X=P),kf[(0|kf[B>>2])+(k<<2)>>2]=(X-(0|kf[W>>2])>>2)+-1,W=0|kf[_>>2],k=0|kf[W+24>>2],B=k,((0|kf[W+28>>2])-k>>2|0)>(0|u)){C=114;break t}k=0|kf[a>>2],R?(kf[B+(O<<2)>>2]=k,(0|R)!=-1?(kf[B+(R<<2)>>2]=(0|kf[a>>2])+1,O=R+1|0,(0|O)!=-1&&(Z=O,C=109)):(Z=0,C=109)):(kf[B+(R<<2)>>2]=k+1,Z=1,C=109),109==(0|C)&&(C=0,kf[B+(Z<<2)>>2]=(0|kf[a>>2])+2),B=0|kf[h>>2],(0|B)==(0|kf[A>>2])?us(n,a):(kf[B>>2]=kf[a>>2],kf[h>>2]=B+4);break;default:C=183;break t}if(B=t-S+-1|0,k=0|kf[E>>2],(0|k)==(0|kf[b>>2]))break;for(K=k;;){if(k=K,R=0|kf[k+-8>>2],R>>>0>B>>>0){F=-1,C=184;break e}if((0|R)!=(0|B))break i;if(R=0|If[k+-4>>0],O=0|kf[k+-12>>2],kf[E>>2]=k+-12,(0|O)<0){F=-1,C=184;break e}k=0|kf[(0|kf[h>>2])+-4>>2],W=(0|k)==-1;do if(1&R)P=k+1|0,Q=W?-1:0==((P>>>0)%3|0|0)?k+-2|0:P;else{if(!W){if((k>>>0)%3|0){Q=k+-1|0;break}Q=k+2|0;break}Q=-1}while(0);if(kf[a>>2]=T-O,k=0|M(r,a),kf[k>>2]=Q,K=0|kf[E>>2],(0|K)==(0|kf[b>>2]))break i}}if(B=0|kf[h>>2],(0|kf[n>>2])==(0|B)){F=-1,C=184;break e}k=B+-4|0,B=0|kf[k>>2],W=0|kf[_>>2],R=(0|B)==-1,P=B+1|0,J=(R?0:(U=0==((P>>>0)%3|0|0)?B+-2|0:P,(0|U)!=-1))?0|kf[(0|kf[W>>2])+(U<<2)>>2]:-1,U=0|kf[W+24>>2],P=0|kf[U+(J<<2)>>2],I=P+1|0,q=(0|P)==-1?-1:0==((I>>>0)%3|0|0)?P+-2|0:I,I=3*S|0,P=I+1|0,x=0|kf[W+12>>2],kf[x+(B<<2)>>2]=P,kf[x+(P<<2)>>2]=B,V=I+2|0,kf[x+(q<<2)>>2]=V,kf[x+(V<<2)>>2]=q,x=0|kf[W>>2],kf[x+(I<<2)>>2]=J,W=q+1|0,ee=((0|q)!=-1?($=0==((W>>>0)%3|0|0)?q+-2|0:W,(0|$)!=-1):0)?0|kf[x+($<<2)>>2]:-1,kf[x+(P<<2)>>2]=ee,(R?0:(R=(0==((B>>>0)%3|0|0)?2:-1)+B|0,(0|R)!=-1))?(B=0|kf[x+(R<<2)>>2],kf[x+(V<<2)>>2]=B,(0|B)!=-1&&(kf[U+(B<<2)>>2]=V)):kf[x+(V<<2)>>2]=-1,V=(0|kf[d>>2])+(J>>>5<<2)|0,kf[V>>2]=kf[V>>2]&~(1<<(31&J)),kf[k>>2]=I}else C=43;while(0);if(43==(0|C)){if(C=0,I=0|kf[n>>2],k=0|kf[h>>2],(0|I)==(0|k)){F=-1,C=184;break e}V=k+-4|0,x=0|kf[V>>2],kf[h>>2]=V,B=0|kf[p>>2];i:do if(B){if(U=B+-1|0,R=0==(U&B|0),te=R?U&S:S>>>0<B>>>0?S:(S>>>0)%(B>>>0)|0,P=0|kf[(0|kf[r>>2])+(te<<2)>>2],0!=(0|P)?($=0|kf[P>>2],0!=(0|$)):0){n:do if(R)for(P=$;;){if(W=0|kf[P+4>>2],ie=(0|W)==(0|S),!(ie|(W&U|0)==(0|te))){ne=I,re=V;break i}if(ie?(0|kf[P+8>>2])==(0|S):0){se=P;break n}if(P=0|kf[P>>2],!P){ne=I,re=V;break i}}else for(P=$;;){if(O=0|kf[P+4>>2],(0|O)==(0|S)){if((0|kf[P+8>>2])==(0|S)){se=P;break n}}else if(ae=O>>>0<B>>>0?O:(O>>>0)%(B>>>0)|0,(0|ae)!=(0|te)){ne=I,re=V;break i}if(P=0|kf[P>>2],!P){ne=I,re=V;break i}}while(0);if($=se+12|0,(0|V)==(0|kf[A>>2])){us(n,$),ne=0|kf[n>>2],re=0|kf[h>>2];break}kf[V>>2]=kf[$>>2],kf[h>>2]=k,ne=I,re=k;break}ne=I,re=V}else ne=I,re=V;while(0);if((0|ne)==(0|re)){F=-1,C=184;break e}if(V=0|kf[re+-4>>2],I=(0|V)==-1,I?0:(0|kf[(0|kf[(0|kf[_>>2])+12>>2])+(V<<2)>>2])!=-1){F=-1,C=184;break e}if(k=(0|x)==-1,B=0|kf[_>>2],$=0|kf[B+12>>2],k?0:(0|kf[$+(x<<2)>>2])!=-1){F=-1,C=184;break e}U=3*S|0,R=U+2|0,kf[$+(V<<2)>>2]=R,kf[$+(R<<2)>>2]=V,P=U+1|0,kf[$+(x<<2)>>2]=P,kf[$+(P<<2)>>2]=x,I?(ie=0|kf[B>>2],kf[ie+(U<<2)>>2]=-1,he=ie,le=B,ce=-1,de=-1):(I=(0==((V>>>0)%3|0|0)?2:-1)+V|0,oe=(0|I)==-1?-1:0|kf[(0|kf[B>>2])+(I<<2)>>2],I=0|kf[B>>2],kf[I+(U<<2)>>2]=oe,O=V+1|0,ie=0==((O>>>0)%3|0|0)?V+-2|0:O,(0|ie)==-1?(he=I,le=B,ce=-1,de=oe):(he=I,le=B,ce=0|kf[I+(ie<<2)>>2],de=oe)),kf[he+(P<<2)>>2]=ce,k?(kf[he+(R<<2)>>2]=-1,ue=-1,fe=-1):(k=(0==((x>>>0)%3|0|0)?2:-1)+x|0,(0|k)!=-1?(P=0|kf[he+(k<<2)>>2],kf[he+(R<<2)>>2]=P,(0|P)!=-1&&(kf[(0|kf[B+24>>2])+(P<<2)>>2]=R)):kf[he+(R<<2)>>2]=-1,P=x+1|0,k=0==((P>>>0)%3|0|0)?x+-2|0:P,(0|k)==-1?(ue=-1,fe=-1):(ue=k,fe=0|kf[he+(k<<2)>>2])),kf[a>>2]=fe,R=0|kf[B+24>>2],(0|de)!=-1&&(kf[R+(de<<2)>>2]=kf[R+(fe<<2)>>2]);i:do if((0|ue)!=-1){B=0|kf[le>>2],k=ue;do{if(kf[B+(k<<2)>>2]=de,P=k+1|0,ie=0==((P>>>0)%3|0|0)?k+-2|0:P,(0|ie)==-1)break i;if(P=0|kf[$+(ie<<2)>>2],ie=P+1|0,(0|P)==-1)break i;k=0==((ie>>>0)%3|0|0)?P+-2|0:ie}while((0|k)!=-1)}while(0);kf[R+(kf[a>>2]<<2)>>2]=-1;do{if(c){if($=0|kf[l>>2],(0|$)==(0|kf[m>>2])){us(s,a),pe=0|kf[h>>2];break}kf[$>>2]=kf[a>>2],kf[l>>2]=$+4,pe=re;break}pe=re}while(0);kf[pe+-4>>2]=U}if(!((0|w)<(0|t))){_e=_,me=w,C=129;break e}S=w}if(114==(0|C)){F=-1,C=184;break}}else _e=e+8|0,me=0,C=129;while(0);e:do if(129==(0|C))if(t=0|kf[_e>>2],((0|kf[t+28>>2])-(0|kf[t+24>>2])>>2|0)<=(0|u)){pe=0|kf[h>>2];do if((0|pe)!=(0|kf[n>>2])){re=e+270|0,c=e+364|0,de=e+360|0,ue=e+352|0,le=e+356|0,fe=e+60|0,he=e+64|0,ce=e+68|0,oe=e+76|0,ne=e+80|0,se=e+72|0,te=e+312|0,ae=pe,J=me;t:for(;;){ee=ae,kf[a>>2]=kf[ee+-4>>2],kf[h>>2]=ee+-4,(0|Ff[re>>1])<514?0|If[c>>0]?(ee=0|kf[de>>2],q=(0|kf[ue>>2])+(ee>>>3)|0,q>>>0<(0|kf[le>>2])>>>0?(K=(0|Lf[q>>0])>>>(7&ee)&1,kf[de>>2]=ee+1,Ae=K,C=137):C=160):C=138:(Ae=1&(0|Qa(te)),C=137),137==(0|C)&&(C=0,C=Ae?138:160);do if(138==(0|C)){if(C=0,K=0|kf[_e>>2],ee=0|kf[K>>2],q=ee,(0|J)>=(((0|kf[K+4>>2])-ee>>2>>>0)/3|0|0)){C=168;break t}if(ee=0|kf[a>>2],Q=ee+1|0,ve=((0|ee)!=-1?(Z=0==((Q>>>0)%3|0|0)?ee+-2|0:Q,(0|Z)!=-1):0)?0|kf[q+(Z<<2)>>2]:-1,Z=0|kf[K+24>>2],Q=0|kf[Z+(ve<<2)>>2],X=Q+1|0,((0|Q)!=-1?(j=0==((X>>>0)%3|0|0)?Q+-2|0:X,X=j+1|0,(0|j)!=-1):0)?(Q=0==((X>>>0)%3|0|0)?j+-2|0:X,(0|Q)==-1?(ye=j,ge=-1):(ye=j,ge=0|kf[q+(Q<<2)>>2])):(ye=-1,ge=-1),Q=0|kf[Z+(ge<<2)>>2],Z=Q+1|0,((0|Q)!=-1?(j=0==((Z>>>0)%3|0|0)?Q+-2|0:Z,Z=j+1|0,(0|j)!=-1):0)?(Q=0==((Z>>>0)%3|0|0)?j+-2|0:Z,(0|Q)==-1?(be=j,Ee=-1):(be=j,Ee=0|kf[q+(Q<<2)>>2])):(be=-1,Ee=-1),Q=3*J|0,kf[o>>2]=Q,j=0|kf[K+12>>2],kf[j+(Q<<2)>>2]=ee,kf[j+(ee<<2)>>2]=Q,Q=(0|kf[o>>2])+1|0,kf[j+(Q<<2)>>2]=ye,kf[j+(ye<<2)>>2]=Q,Q=(0|kf[o>>2])+2|0,kf[j+(Q<<2)>>2]=be,kf[j+(be<<2)>>2]=Q,Q=0|kf[o>>2],j=q+(Q<<2)|0,kf[j>>2]=ge,kf[q+(Q+1<<2)>>2]=Ee,kf[q+(Q+2<<2)>>2]=ve,Te=(0|Q)==-1?-1:0|kf[j>>2],j=0|kf[d>>2],Q=j+(Te>>>5<<2)|0,kf[Q>>2]=kf[Q>>2]&~(1<<(31&Te)),Q=(0|kf[o>>2])+1|0,Se=(0|Q)==-1?-1:0|kf[q+(Q<<2)>>2],Q=j+(Se>>>5<<2)|0,kf[Q>>2]=kf[Q>>2]&~(1<<(31&Se)),Q=(0|kf[o>>2])+2|0,we=(0|Q)==-1?-1:0|kf[q+(Q<<2)>>2],Q=j+(we>>>5<<2)|0,kf[Q>>2]=kf[Q>>2]&~(1<<(31&we)),Q=J+1|0,j=0|kf[he>>2],q=0|kf[ce>>2],(0|j)==(q<<5|0)){if((j+1|0)<0){C=152;break t}ee=q<<6,q=j+32&-32,Hr(fe,j>>>0<1073741823?ee>>>0<q>>>0?q:ee:2147483647),Ce=0|kf[he>>2]}else Ce=j;kf[he>>2]=Ce+1,j=(0|kf[fe>>2])+(Ce>>>5<<2)|0,kf[j>>2]=kf[j>>2]|1<<(31&Ce),j=0|kf[oe>>2],(0|j)==(0|kf[ne>>2])?us(se,o):(kf[j>>2]=kf[o>>2],kf[oe>>2]=j+4),Me=Q}else if(160==(0|C)){if(C=0,Q=0|kf[he>>2],j=0|kf[ce>>2],(0|Q)==(j<<5|0)){if((Q+1|0)<0){C=162;break t}ee=j<<6,j=Q+32&-32,Hr(fe,Q>>>0<1073741823?ee>>>0<j>>>0?j:ee:2147483647),Pe=0|kf[he>>2]}else Pe=Q;if(kf[he>>2]=Pe+1,Q=(0|kf[fe>>2])+(Pe>>>5<<2)|0,kf[Q>>2]=kf[Q>>2]&~(1<<(31&Pe)),Q=0|kf[oe>>2],(0|Q)==(0|kf[ne>>2])){us(se,a),Me=J;break}kf[Q>>2]=kf[a>>2],kf[oe>>2]=Q+4,Me=J;break}while(0);if(ae=0|kf[h>>2],(0|ae)==(0|kf[n>>2])){C=169;break}J=Me}if(152==(0|C))Du(fe);else if(162==(0|C))Du(fe);else{if(168==(0|C)){F=-1,C=184;break e}if(169==(0|C)){Ie=0|kf[_e>>2],Re=Me;break}}}else Ie=t,Re=me;while(0);if((0|Re)==(((0|kf[Ie+4>>2])-(0|kf[Ie>>2])>>2>>>0)/3|0|0))if(t=(0|kf[Ie+28>>2])-(0|kf[Ie+24>>2])>>2,pe=0|kf[s>>2],J=0|kf[l>>2],(0|pe)==(0|J))xe=pe,Oe=t;else for(ae=a+4|0,oe=a+8|0,se=a+12|0,ne=Ie,he=pe,pe=t;;){if(t=0|kf[he>>2],ce=pe+-1|0,te=0|kf[ne+24>>2],(0|kf[te+(ce<<2)>>2])==-1)for(de=pe;;){if(le=de+-1|0,ue=de+-2|0,(0|kf[te+(ue<<2)>>2])!=-1){ke=le,De=ue;break}de=le}else ke=pe,De=ce;if(De>>>0<t>>>0)Le=ne,Ne=ke;else{if(kf[a>>2]=ne,de=0|kf[te+(De<<2)>>2],kf[ae>>2]=de,kf[oe>>2]=de,If[se>>0]=1,
(0|de)==-1)Fe=ne;else for(fe=ne,ue=de;;){if(kf[(0|kf[fe>>2])+(ue<<2)>>2]=t,pr(a),ue=0|kf[oe>>2],de=0|kf[_e>>2],(0|ue)==-1){Fe=de;break}fe=de}fe=0|kf[Fe+24>>2],(0|t)==-1?Be=fe+(De<<2)|0:(ue=fe+(De<<2)|0,kf[fe+(t<<2)>>2]=kf[ue>>2],Be=ue),kf[Be>>2]=-1,ue=0|kf[d>>2],fe=ue+(De>>>5<<2)|0,te=1<<(31&De),ce=ue+(t>>>5<<2)|0,ue=1<<(31&t),de=0|kf[ce>>2],kf[ce>>2]=kf[fe>>2]&te|0?de|ue:de&~ue,kf[fe>>2]=kf[fe>>2]&~te,Le=Fe,Ne=ke+-1|0}if(he=he+4|0,(0|he)==(0|J)){F=Ne,C=184;break}ne=Le,pe=Ne}else F=-1,C=184}else F=-1,C=184;while(0);if(184==(0|C)&&(xe=0|kf[s>>2],Oe=F),0|xe&&(F=0|kf[l>>2],(0|F)!=(0|xe)&&(kf[l>>2]=F+(~((F+-4-xe|0)>>>2)<<2)),mf(xe)),xe=0|kf[r+8>>2],0|xe){F=xe;do xe=F,F=0|kf[F>>2],mf(xe);while(0!=(0|F))}return F=0|kf[r>>2],kf[r>>2]=0,0|F&&mf(F),(F=0|kf[n>>2])?(n=0|kf[h>>2],(0|n)!=(0|F)&&(kf[h>>2]=n+(~((n+-4-F|0)>>>2)<<2)),mf(F),Xf=i,0|Oe):(Xf=i,0|Oe)}function Bn(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0;t=Xf,Xf=Xf+16|0,i=t,n=t+8|0,r=t+4|0,kf[n>>2]=e;do if(e>>>0>=212){s=(e>>>0)/210|0,a=210*s|0,kf[r>>2]=e-a,o=(0|Xo(4440,4632,r,i))-4440>>2,h=s,s=a,a=0;e:for(;;){for(l=(0|kf[4440+(o<<2)>>2])+s|0,c=5;;){if(c>>>0>=47){d=211,u=a,f=8;break}if(p=0|kf[4248+(c<<2)>>2],_=(l>>>0)/(p>>>0)|0,_>>>0<p>>>0){f=106;break e}if((0|l)==(0|np(_,p))){m=a;break}c=c+1|0}t:do if(8==(0|f)){i:for(;;){f=0,c=(l>>>0)/(d>>>0)|0;do if(c>>>0>=d>>>0)if((0|l)!=(0|np(c,d)))if(p=d+10|0,_=(l>>>0)/(p>>>0)|0,_>>>0>=p>>>0)if((0|l)!=(0|np(_,p)))if(_=d+12|0,A=(l>>>0)/(_>>>0)|0,A>>>0>=_>>>0)if((0|l)!=(0|np(A,_)))if(A=d+16|0,v=(l>>>0)/(A>>>0)|0,v>>>0>=A>>>0)if((0|l)!=(0|np(v,A)))if(v=d+18|0,y=(l>>>0)/(v>>>0)|0,y>>>0>=v>>>0)if((0|l)!=(0|np(y,v)))if(y=d+22|0,g=(l>>>0)/(y>>>0)|0,g>>>0>=y>>>0)if((0|l)!=(0|np(g,y)))if(g=d+28|0,b=(l>>>0)/(g>>>0)|0,b>>>0>=g>>>0)if((0|l)==(0|np(b,g)))E=9,T=g,S=u;else{if(b=d+30|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+36|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+40|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+42|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+46|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+52|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+58|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+60|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+66|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+70|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+72|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+78|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+82|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+88|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+96|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+100|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+102|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+106|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+108|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+112|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+120|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+126|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+130|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+136|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+138|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+142|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+148|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+150|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+156|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+162|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+166|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+168|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+172|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+178|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+180|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+186|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+190|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+192|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+196|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}if(b=d+198|0,w=(l>>>0)/(b>>>0)|0,w>>>0<b>>>0){E=1,T=b,S=l;break}if((0|l)==(0|np(w,b))){E=9,T=b,S=u;break}b=d+208|0,w=(l>>>0)/(b>>>0)|0,C=w>>>0<b>>>0,M=(0|l)==(0|np(w,b)),E=C?1:M?9:0,T=C|M?b:d+210|0,S=C?l:u}else E=1,T=g,S=l;else E=9,T=y,S=u;else E=1,T=y,S=l;else E=9,T=v,S=u;else E=1,T=v,S=l;else E=9,T=A,S=u;else E=1,T=A,S=l;else E=9,T=_,S=u;else E=1,T=_,S=l;else E=9,T=p,S=u;else E=1,T=p,S=l;else E=9,T=d,S=u;else E=1,T=d,S=l;while(0);switch(15&E){case 9:m=S;break t;case 0:d=T,u=S,f=8;break;default:break i}}if(E){f=107;break e}m=S}while(0);c=o+1|0,p=48==(0|c),_=(1&p)+h|0,o=p?0:c,h=_,s=210*_|0,a=m}if(106==(0|f)){kf[n>>2]=l,P=l;break}if(107==(0|f)){kf[n>>2]=l,P=S;break}}else a=0|Xo(4248,4440,n,i),P=0|kf[a>>2];while(0);return Xf=t,0|P}function Vn(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0;if(t=Xf,Xf=Xf+80|0,i=t+68|0,n=t+64|0,r=t+60|0,s=t+52|0,a=t+44|0,o=t,h=t+56|0,l=t+48|0,c=t+40|0,d=e+132|0,kf[d>>2]=0,u=e+148|0,0|kf[u>>2]){if(f=e+144|0,p=0|kf[f>>2],0|p){_=p;do p=_,_=0|kf[_>>2],mf(p);while(0!=(0|_))}if(kf[f>>2]=0,f=0|kf[e+140>>2],0|f){_=e+136|0,p=0;do kf[(0|kf[_>>2])+(p<<2)>>2]=0,p=p+1|0;while((0|p)!=(0|f))}kf[u>>2]=0}u=e+4|0,f=0|kf[u>>2],p=0|If[f+36>>0],_=(255&p)<<8;do{if((65535&(_|Lf[f+37>>0]))<514){if(m=0|kf[f+32>>2],(65535&_)<512?(A=m+8|0,v=0|kf[A>>2],y=0|kf[A+4>>2],A=m+16|0,g=A,b=0|kf[g>>2],E=0|tc(0|b,0|kf[g+4>>2],4,0),g=qf,(0|y)<(0|g)|(0|y)==(0|g)&v>>>0<E>>>0||(v=(0|kf[m>>2])+b|0,b=Lf[v>>0]|Lf[v+1>>0]<<8|Lf[v+2>>0]<<16|Lf[v+3>>0]<<24,kf[i>>2]=b,v=A,kf[v>>2]=E,kf[v+4>>2]=g,T=f,S=p,w=b,C=14)):0|Qs(i,m)&&(m=0|kf[u>>2],T=m,S=0|If[m+36>>0],w=0|kf[i>>2],C=14),14==(0|C)){kf[d>>2]=w,M=S,P=T;break}return I=0,Xf=t,0|I}M=p,P=f}while(0);if(f=0|kf[P+32>>2],((255&M)<<8&65535)<512?(P=f+8|0,p=0|kf[P>>2],T=0|kf[P+4>>2],P=f+16|0,S=P,w=0|kf[S>>2],d=0|tc(0|w,0|kf[S+4>>2],4,0),S=qf,(0|T)<(0|S)|(0|T)==(0|S)&p>>>0<d>>>0?R=0:(p=(0|kf[f>>2])+w|0,w=Lf[p>>0]|Lf[p+1>>0]<<8|Lf[p+2>>0]<<16|Lf[p+3>>0]<<24,kf[n>>2]=w,p=P,kf[p>>2]=d,kf[p+4>>2]=S,x=w,O=M,k=f,C=21)):0|Qs(n,f)?(f=0|kf[u>>2],x=0|kf[n>>2],O=0|If[f+36>>0],k=0|kf[f+32>>2],C=21):R=0,21==(0|C)){if(f=e+156|0,kf[f>>2]=x,((255&O)<<8&65535)<512?(O=k+8|0,x=0|kf[O>>2],n=0|kf[O+4>>2],O=k+16|0,M=O,w=0|kf[M>>2],S=0|tc(0|w,0|kf[M+4>>2],4,0),M=qf,(0|n)<(0|M)|(0|n)==(0|M)&x>>>0<S>>>0?D=0:(x=(0|kf[k>>2])+w|0,w=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[r>>2]=w,x=O,kf[x>>2]=S,kf[x+4>>2]=M,L=w,C=26)):0|Qs(r,k)?(L=0|kf[r>>2],C=26):D=0,26==(0|C))if((L>>>0<=1431655765?(0|kf[f>>2])>>>0<=(3*L|0)>>>0:0)?(k=0|kf[u>>2],w=0|kf[k+32>>2],M=w+8|0,x=0|kf[M>>2],S=0|kf[M+4>>2],M=w+16|0,O=M,n=0|kf[O>>2],p=0|kf[O+4>>2],(0|S)>(0|p)|(0|S)==(0|p)&x>>>0>n>>>0):0){if(O=0|kf[w>>2],d=0|If[O+n>>0],P=0|tc(0|n,0|p,1,0),T=M,kf[T>>2]=P,kf[T+4>>2]=qf,(Lf[k+36>>0]<<8&65535)<512?(k=0|tc(0|n,0|p,5,0),p=qf,(0|S)<(0|p)|(0|S)==(0|p)&x>>>0<k>>>0?N=0:(x=O+P|0,P=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[s>>2]=P,x=M,kf[x>>2]=k,kf[x+4>>2]=p,F=L,B=P,C=34)):0|Qs(s,w)?(F=0|kf[r>>2],B=0|kf[s>>2],C=34):N=0,34==(0|C))if(F>>>0>=B>>>0?F>>>0<=(((B>>>0)/3|0)+B|0)>>>0:0){F=0|kf[u>>2],w=0|kf[F+32>>2],(Lf[F+36>>0]<<8&65535)<512?(F=w+8|0,P=0|kf[F>>2],L=0|kf[F+4>>2],F=w+16|0,p=F,x=0|kf[p>>2],k=0|tc(0|x,0|kf[p+4>>2],4,0),p=qf,(0|L)<(0|p)|(0|L)==(0|p)&P>>>0<k>>>0?V=0:(P=(0|kf[w>>2])+x|0,x=Lf[P>>0]|Lf[P+1>>0]<<8|Lf[P+2>>0]<<16|Lf[P+3>>0]<<24,kf[a>>2]=x,P=F,kf[P>>2]=k,kf[P+4>>2]=p,U=x,G=B,C=41)):0|Qs(a,w)?(U=0|kf[a>>2],G=0|kf[s>>2],C=41):V=0;e:do if(41==(0|C))if(U>>>0>G>>>0)V=0;else{if(w=0|kf[e+24>>2],B=e+28|0,x=0|kf[B>>2],(0|x)!=(0|w)&&(kf[B>>2]=x+(~((x+-4-w|0)>>>2)<<2)),w=0|sl(88),ch(w),x=e+8|0,B=0|kf[x>>2],kf[x>>2]=w,0|B?(is(B),mf(B),0==(0|kf[x>>2])):0){V=0;break}if(B=e+160|0,w=0|kf[B>>2],p=e+164|0,P=0|kf[p>>2],(0|P)!=(0|w)&&(kf[p>>2]=P+(~((P+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=e+172|0,w=0|kf[B>>2],P=e+176|0,p=0|kf[P>>2],(0|p)!=(0|w)&&(kf[P>>2]=p+(~((p+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=0|kf[e+36>>2],w=e+40|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(12*~(((p+-12-B|0)>>>0)/12|0)|0)),B=0|kf[e+48>>2],p=e+52|0,w=0|kf[p>>2],(0|w)!=(0|B)&&(kf[p>>2]=w+(~((w+-4-B|0)>>>2)<<2)),kf[e+64>>2]=0,B=0|kf[e+72>>2],w=e+76|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(~((p+-4-B|0)>>>2)<<2)),kf[e+84>>2]=-1,kf[e+92>>2]=-1,kf[e+88>>2]=-1,B=e+216|0,p=0|kf[B>>2],w=e+220|0,P=0|kf[w>>2],(0|P)!=(0|p)){k=P;do kf[w>>2]=k+-144,P=0|kf[k+-12>>2],0|P&&(F=k+-8|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-28>>2],0|P&&(L=k+-24|0,F=0|kf[L>>2],(0|F)!=(0|P)&&(kf[L>>2]=F+(~((F+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-40>>2],0|P&&(F=k+-36|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),ls(k+-140|0),k=0|kf[w>>2];while((0|k)!=(0|p))}if(p=255&d,Sr(B,p),!(0|Ss(0|kf[x>>2],0|kf[r>>2],(0|kf[a>>2])+(0|kf[f>>2])|0))){V=0;break}k=(0|kf[a>>2])+(0|kf[f>>2])|0,If[i>>0]=1,pi(e+120|0,k,i),k=0|kf[u>>2],P=Lf[k+36>>0]<<8;t:do{if(!((65535&(P|Lf[k+37>>0]))>=514)){L=0|kf[k+32>>2];do if((65535&P)<512){if(F=L+8|0,M=0|kf[F>>2],O=0|kf[F+4>>2],F=L+16|0,S=F,n=0|kf[S>>2],T=0|tc(0|n,0|kf[S+4>>2],4,0),S=qf,(0|O)<(0|S)|(0|O)==(0|S)&M>>>0<T>>>0)break;M=(0|kf[L>>2])+n|0,n=Lf[M>>0]|Lf[M+1>>0]<<8|Lf[M+2>>0]<<16|Lf[M+3>>0]<<24,kf[i>>2]=n,M=F,kf[M>>2]=T,kf[M+4>>2]=S,z=n,C=77}else{if(!(0|Qs(i,L)))break;z=0|kf[i>>2],C=77}while(0);do if(77==(0|C)){if(!z)break;if(L=0|kf[(0|kf[u>>2])+32>>2],n=L+8|0,S=L+16|0,L=0|nc(0|kf[n>>2],0|kf[n+4>>2],0|kf[S>>2],0|kf[S+4>>2]),S=qf,0>(0|S)|0==(0|S)&z>>>0>L>>>0)break;if(Dh(o),L=0|kf[(0|kf[u>>2])+32>>2],S=L+16|0,n=0|kf[S>>2],M=0|kf[i>>2],T=(0|kf[L>>2])+n+M|0,F=L+8|0,O=0|nc(0|kf[F>>2],0|kf[F+4>>2],0|n,0|kf[S+4>>2]),S=0|nc(0|O,0|qf,0|M,0),qh(o,T,S,0|xf[L+38>>1]),L=0|qi(e,o),bf(o+24|0),(0|L)==-1)break;W=L;break t}while(0);V=0;break e}if((0|qi(e,0|kf[k+32>>2]))==-1){V=0;break e}W=-1}while(0);P=e+232|0,kf[e+376>>2]=e,k=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,L=0|kf[k>>2],k=(0|kf[L>>2])+(0|kf[L+16>>2])|0,L=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,S=0|kf[L>>2],L=S+8|0,T=S+16|0,S=0|nc(0|kf[L>>2],0|kf[L+4>>2],0|kf[T>>2],0|kf[T+4>>2]),T=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,qh(P,k,S,0|xf[(0|kf[T>>2])+38>>1]),T=0|Cp[127&kf[(0|kf[e>>2])+36>>2]](e),kf[e+380>>2]=T,kf[e+384>>2]=(0|kf[a>>2])+(0|kf[f>>2]),kf[e+372>>2]=p,Dh(o);t:do if(0|Si(P,o)){if(T=0|Ln(e,0|kf[s>>2]),(0|T)==-1){H=0;break}S=0|kf[(0|kf[u>>2])+32>>2],k=o+16|0,L=0|kf[k>>2],M=(0|kf[o>>2])+L|0,O=o+8|0,n=0|nc(0|kf[O>>2],0|kf[O+4>>2],0|L,0|kf[k+4>>2]),qh(S,M,n,0|xf[S+38>>1]),S=0|kf[u>>2],n=65535&(Lf[S+36>>0]<<8|Lf[S+37>>0]),(65535&n)<514&&(M=(0|kf[S+32>>2])+16|0,S=M,k=0|tc(0|kf[S>>2],0|kf[S+4>>2],0|W,((0|W)<0)<<31>>31|0),S=M,kf[S>>2]=k,kf[S+4>>2]=qf);do if((0|kf[w>>2])!=(0|kf[B>>2]))if(S=0|kf[x>>2],k=(0|kf[S+4>>2])!=(0|kf[S>>2]),(65535&n)<513){if(!k)break;S=0;do{if(kf[h>>2]=S,kf[i>>2]=kf[h>>2],S=S+3|0,!(0|xe(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}else{if(!k)break;S=0;do{if(kf[l>>2]=S,kf[i>>2]=kf[l>>2],S=S+3|0,!(0|be(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}while(0);if(0|If[e+308>>0]&&hh(e+272|0),(0|Ff[e+270>>1])<514&&hh(e+328|0),n=0|kf[B>>2],(0|kf[w>>2])!=(0|n)){S=n,n=0;do{if(0|Mi(S+(144*n|0)+4|0,0|kf[x>>2]),k=0|kf[B>>2],M=0|kf[k+(144*n|0)+132>>2],L=0|kf[k+(144*n|0)+136>>2],(0|M)==(0|L))j=k;else for(O=k,k=M;;){if(kf[c>>2]=kf[k>>2],kf[i>>2]=kf[c>>2],ni(O+(144*n|0)+4|0,i),k=k+4|0,M=0|kf[B>>2],(0|k)==(0|L)){j=M;break}O=M}zo(j+(144*n|0)+4|0,0,0),n=n+1|0,S=0|kf[B>>2]}while(n>>>0<(((0|kf[w>>2])-S|0)/144|0)>>>0)}S=0|kf[x>>2],n=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=e+196|0,O=e+200|0,L=0|kf[O>>2],k=0|kf[S>>2],M=L-k>>2,F=k,k=L;do if(n>>>0>M>>>0)Kr(S,n-M|0);else{if(n>>>0>=M>>>0)break;if(L=F+(n<<2)|0,(0|k)==(0|L))break;kf[O>>2]=k+(~((k+-4-L|0)>>>2)<<2)}while(0);if(pa(e+184|0,n),k=0|kf[B>>2],(0|kf[w>>2])!=(0|k)){O=k,k=0;do{F=O,M=(0|kf[F+(144*k|0)+60>>2])-(0|kf[F+(144*k|0)+56>>2])>>2,S=0|kf[x>>2],L=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=(0|M)<(0|L)?L:M,M=F+(144*k|0)+116|0,L=F+(144*k|0)+120|0,_=0|kf[L>>2],m=0|kf[M>>2],b=_-m>>2,g=m,m=_;do if(S>>>0>b>>>0)Kr(M,S-b|0);else{if(S>>>0>=b>>>0)break;if(_=g+(S<<2)|0,(0|m)==(0|_))break;kf[L>>2]=m+(~((m+-4-_|0)>>>2)<<2)}while(0);pa(F+(144*k|0)+104|0,S),k=k+1|0,O=0|kf[B>>2]}while(k>>>0<(((0|kf[w>>2])-O|0)/144|0)>>>0)}H=0|ki(e,T)}else H=0;while(0);bf(o+24|0),V=H}while(0);N=V}else N=0;D=N}else D=0;R=D}return I=R,Xf=t,0|I}function Un(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0;if(t=Xf,Xf=Xf+80|0,i=t+68|0,n=t+64|0,r=t+60|0,s=t+52|0,a=t+44|0,o=t,h=t+56|0,l=t+48|0,c=t+40|0,d=e+132|0,kf[d>>2]=0,u=e+148|0,0|kf[u>>2]){if(f=e+144|0,p=0|kf[f>>2],0|p){_=p;do p=_,_=0|kf[_>>2],mf(p);while(0!=(0|_))}if(kf[f>>2]=0,f=0|kf[e+140>>2],0|f){_=e+136|0,p=0;do kf[(0|kf[_>>2])+(p<<2)>>2]=0,p=p+1|0;while((0|p)!=(0|f))}kf[u>>2]=0}u=e+4|0,f=0|kf[u>>2],p=0|If[f+36>>0],_=(255&p)<<8;do{if((65535&(_|Lf[f+37>>0]))<514){if(m=0|kf[f+32>>2],(65535&_)<512?(A=m+8|0,v=0|kf[A>>2],y=0|kf[A+4>>2],A=m+16|0,g=A,b=0|kf[g>>2],E=0|tc(0|b,0|kf[g+4>>2],4,0),g=qf,(0|y)<(0|g)|(0|y)==(0|g)&v>>>0<E>>>0||(v=(0|kf[m>>2])+b|0,b=Lf[v>>0]|Lf[v+1>>0]<<8|Lf[v+2>>0]<<16|Lf[v+3>>0]<<24,kf[i>>2]=b,v=A,kf[v>>2]=E,kf[v+4>>2]=g,T=f,S=p,w=b,C=14)):0|Qs(i,m)&&(m=0|kf[u>>2],T=m,S=0|If[m+36>>0],w=0|kf[i>>2],C=14),14==(0|C)){kf[d>>2]=w,M=S,P=T;break}return I=0,Xf=t,0|I}M=p,P=f}while(0);if(f=0|kf[P+32>>2],((255&M)<<8&65535)<512?(P=f+8|0,p=0|kf[P>>2],T=0|kf[P+4>>2],P=f+16|0,S=P,w=0|kf[S>>2],d=0|tc(0|w,0|kf[S+4>>2],4,0),S=qf,(0|T)<(0|S)|(0|T)==(0|S)&p>>>0<d>>>0?R=0:(p=(0|kf[f>>2])+w|0,w=Lf[p>>0]|Lf[p+1>>0]<<8|Lf[p+2>>0]<<16|Lf[p+3>>0]<<24,kf[n>>2]=w,p=P,kf[p>>2]=d,kf[p+4>>2]=S,x=w,O=M,k=f,C=21)):0|Qs(n,f)?(f=0|kf[u>>2],x=0|kf[n>>2],O=0|If[f+36>>0],k=0|kf[f+32>>2],C=21):R=0,21==(0|C)){if(f=e+156|0,kf[f>>2]=x,((255&O)<<8&65535)<512?(O=k+8|0,x=0|kf[O>>2],n=0|kf[O+4>>2],O=k+16|0,M=O,w=0|kf[M>>2],S=0|tc(0|w,0|kf[M+4>>2],4,0),M=qf,(0|n)<(0|M)|(0|n)==(0|M)&x>>>0<S>>>0?D=0:(x=(0|kf[k>>2])+w|0,w=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[r>>2]=w,x=O,kf[x>>2]=S,kf[x+4>>2]=M,L=w,C=26)):0|Qs(r,k)?(L=0|kf[r>>2],C=26):D=0,26==(0|C))if((L>>>0<=1431655765?(0|kf[f>>2])>>>0<=(3*L|0)>>>0:0)?(k=0|kf[u>>2],w=0|kf[k+32>>2],M=w+8|0,x=0|kf[M>>2],S=0|kf[M+4>>2],M=w+16|0,O=M,n=0|kf[O>>2],p=0|kf[O+4>>2],(0|S)>(0|p)|(0|S)==(0|p)&x>>>0>n>>>0):0){if(O=0|kf[w>>2],d=0|If[O+n>>0],P=0|tc(0|n,0|p,1,0),T=M,kf[T>>2]=P,kf[T+4>>2]=qf,(Lf[k+36>>0]<<8&65535)<512?(k=0|tc(0|n,0|p,5,0),p=qf,(0|S)<(0|p)|(0|S)==(0|p)&x>>>0<k>>>0?N=0:(x=O+P|0,P=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[s>>2]=P,x=M,kf[x>>2]=k,kf[x+4>>2]=p,F=L,B=P,C=34)):0|Qs(s,w)?(F=0|kf[r>>2],B=0|kf[s>>2],C=34):N=0,34==(0|C))if(F>>>0>=B>>>0?F>>>0<=(((B>>>0)/3|0)+B|0)>>>0:0){F=0|kf[u>>2],w=0|kf[F+32>>2],(Lf[F+36>>0]<<8&65535)<512?(F=w+8|0,P=0|kf[F>>2],L=0|kf[F+4>>2],F=w+16|0,p=F,x=0|kf[p>>2],k=0|tc(0|x,0|kf[p+4>>2],4,0),p=qf,(0|L)<(0|p)|(0|L)==(0|p)&P>>>0<k>>>0?V=0:(P=(0|kf[w>>2])+x|0,x=Lf[P>>0]|Lf[P+1>>0]<<8|Lf[P+2>>0]<<16|Lf[P+3>>0]<<24,kf[a>>2]=x,P=F,kf[P>>2]=k,kf[P+4>>2]=p,U=x,G=B,C=41)):0|Qs(a,w)?(U=0|kf[a>>2],G=0|kf[s>>2],C=41):V=0;e:do if(41==(0|C))if(U>>>0>G>>>0)V=0;else{if(w=0|kf[e+24>>2],B=e+28|0,x=0|kf[B>>2],(0|x)!=(0|w)&&(kf[B>>2]=x+(~((x+-4-w|0)>>>2)<<2)),w=0|sl(88),ch(w),x=e+8|0,B=0|kf[x>>2],kf[x>>2]=w,0|B?(is(B),mf(B),0==(0|kf[x>>2])):0){V=0;break}if(B=e+160|0,w=0|kf[B>>2],p=e+164|0,P=0|kf[p>>2],(0|P)!=(0|w)&&(kf[p>>2]=P+(~((P+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=e+172|0,w=0|kf[B>>2],P=e+176|0,p=0|kf[P>>2],(0|p)!=(0|w)&&(kf[P>>2]=p+(~((p+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=0|kf[e+36>>2],w=e+40|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(12*~(((p+-12-B|0)>>>0)/12|0)|0)),B=0|kf[e+48>>2],p=e+52|0,w=0|kf[p>>2],(0|w)!=(0|B)&&(kf[p>>2]=w+(~((w+-4-B|0)>>>2)<<2)),kf[e+64>>2]=0,B=0|kf[e+72>>2],w=e+76|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(~((p+-4-B|0)>>>2)<<2)),kf[e+84>>2]=-1,kf[e+92>>2]=-1,kf[e+88>>2]=-1,B=e+216|0,p=0|kf[B>>2],w=e+220|0,P=0|kf[w>>2],(0|P)!=(0|p)){k=P;do kf[w>>2]=k+-144,P=0|kf[k+-12>>2],0|P&&(F=k+-8|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-28>>2],0|P&&(L=k+-24|0,F=0|kf[L>>2],(0|F)!=(0|P)&&(kf[L>>2]=F+(~((F+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-40>>2],0|P&&(F=k+-36|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),ls(k+-140|0),k=0|kf[w>>2];while((0|k)!=(0|p))}if(p=255&d,Sr(B,p),!(0|Ss(0|kf[x>>2],0|kf[r>>2],(0|kf[a>>2])+(0|kf[f>>2])|0))){V=0;break}k=(0|kf[a>>2])+(0|kf[f>>2])|0,If[i>>0]=1,pi(e+120|0,k,i),k=0|kf[u>>2],P=Lf[k+36>>0]<<8;t:do{if(!((65535&(P|Lf[k+37>>0]))>=514)){L=0|kf[k+32>>2];do if((65535&P)<512){if(F=L+8|0,M=0|kf[F>>2],O=0|kf[F+4>>2],F=L+16|0,S=F,n=0|kf[S>>2],T=0|tc(0|n,0|kf[S+4>>2],4,0),S=qf,(0|O)<(0|S)|(0|O)==(0|S)&M>>>0<T>>>0)break;M=(0|kf[L>>2])+n|0,n=Lf[M>>0]|Lf[M+1>>0]<<8|Lf[M+2>>0]<<16|Lf[M+3>>0]<<24,kf[i>>2]=n,M=F,kf[M>>2]=T,kf[M+4>>2]=S,z=n,C=77}else{if(!(0|Qs(i,L)))break;z=0|kf[i>>2],C=77}while(0);do if(77==(0|C)){if(!z)break;if(L=0|kf[(0|kf[u>>2])+32>>2],n=L+8|0,S=L+16|0,L=0|nc(0|kf[n>>2],0|kf[n+4>>2],0|kf[S>>2],0|kf[S+4>>2]),S=qf,0>(0|S)|0==(0|S)&z>>>0>L>>>0)break;if(Dh(o),L=0|kf[(0|kf[u>>2])+32>>2],S=L+16|0,n=0|kf[S>>2],M=0|kf[i>>2],T=(0|kf[L>>2])+n+M|0,F=L+8|0,O=0|nc(0|kf[F>>2],0|kf[F+4>>2],0|n,0|kf[S+4>>2]),S=0|nc(0|O,0|qf,0|M,0),qh(o,T,S,0|xf[L+38>>1]),L=0|qi(e,o),bf(o+24|0),(0|L)==-1)break;W=L;break t}while(0);V=0;break e}if((0|qi(e,0|kf[k+32>>2]))==-1){V=0;break e}W=-1}while(0);P=e+232|0,kf[e+376>>2]=e,k=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,L=0|kf[k>>2],k=(0|kf[L>>2])+(0|kf[L+16>>2])|0,L=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,S=0|kf[L>>2],L=S+8|0,T=S+16|0,S=0|nc(0|kf[L>>2],0|kf[L+4>>2],0|kf[T>>2],0|kf[T+4>>2]),T=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,qh(P,k,S,0|xf[(0|kf[T>>2])+38>>1]),T=0|Cp[127&kf[(0|kf[e>>2])+36>>2]](e),kf[e+380>>2]=T,kf[e+384>>2]=(0|kf[a>>2])+(0|kf[f>>2]),kf[e+372>>2]=p,Dh(o);t:do if(0|an(P,o)){if(T=0|Nn(e,0|kf[s>>2]),(0|T)==-1){H=0;break}S=0|kf[(0|kf[u>>2])+32>>2],k=o+16|0,L=0|kf[k>>2],M=(0|kf[o>>2])+L|0,O=o+8|0,n=0|nc(0|kf[O>>2],0|kf[O+4>>2],0|L,0|kf[k+4>>2]),qh(S,M,n,0|xf[S+38>>1]),S=0|kf[u>>2],n=65535&(Lf[S+36>>0]<<8|Lf[S+37>>0]),(65535&n)<514&&(M=(0|kf[S+32>>2])+16|0,S=M,k=0|tc(0|kf[S>>2],0|kf[S+4>>2],0|W,((0|W)<0)<<31>>31|0),S=M,kf[S>>2]=k,kf[S+4>>2]=qf);do if((0|kf[w>>2])!=(0|kf[B>>2]))if(S=0|kf[x>>2],k=(0|kf[S+4>>2])!=(0|kf[S>>2]),(65535&n)<513){if(!k)break;S=0;do{if(kf[h>>2]=S,kf[i>>2]=kf[h>>2],S=S+3|0,!(0|xe(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}else{if(!k)break;S=0;do{if(kf[l>>2]=S,kf[i>>2]=kf[l>>2],S=S+3|0,!(0|be(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}while(0);if(0|If[e+308>>0]&&hh(e+272|0),(0|Ff[e+270>>1])<514&&hh(e+328|0),n=0|kf[B>>2],(0|kf[w>>2])!=(0|n)){S=n,n=0;do{if(0|Mi(S+(144*n|0)+4|0,0|kf[x>>2]),k=0|kf[B>>2],M=0|kf[k+(144*n|0)+132>>2],L=0|kf[k+(144*n|0)+136>>2],(0|M)==(0|L))j=k;else for(O=k,k=M;;){if(kf[c>>2]=kf[k>>2],kf[i>>2]=kf[c>>2],ni(O+(144*n|0)+4|0,i),k=k+4|0,M=0|kf[B>>2],(0|k)==(0|L)){j=M;break}O=M}zo(j+(144*n|0)+4|0,0,0),n=n+1|0,S=0|kf[B>>2]}while(n>>>0<(((0|kf[w>>2])-S|0)/144|0)>>>0)}S=0|kf[x>>2],n=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=e+196|0,O=e+200|0,L=0|kf[O>>2],k=0|kf[S>>2],M=L-k>>2,F=k,k=L;do if(n>>>0>M>>>0)Kr(S,n-M|0);else{if(n>>>0>=M>>>0)break;if(L=F+(n<<2)|0,(0|k)==(0|L))break;kf[O>>2]=k+(~((k+-4-L|0)>>>2)<<2)}while(0);if(pa(e+184|0,n),k=0|kf[B>>2],(0|kf[w>>2])!=(0|k)){O=k,k=0;do{F=O,M=(0|kf[F+(144*k|0)+60>>2])-(0|kf[F+(144*k|0)+56>>2])>>2,S=0|kf[x>>2],L=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=(0|M)<(0|L)?L:M,M=F+(144*k|0)+116|0,L=F+(144*k|0)+120|0,_=0|kf[L>>2],m=0|kf[M>>2],b=_-m>>2,g=m,m=_;do if(S>>>0>b>>>0)Kr(M,S-b|0);else{if(S>>>0>=b>>>0)break;if(_=g+(S<<2)|0,(0|m)==(0|_))break;kf[L>>2]=m+(~((m+-4-_|0)>>>2)<<2)}while(0);pa(F+(144*k|0)+104|0,S),k=k+1|0,O=0|kf[B>>2]}while(k>>>0<(((0|kf[w>>2])-O|0)/144|0)>>>0)}H=0|ki(e,T)}else H=0;while(0);bf(o+24|0),V=H}while(0);N=V}else N=0;D=N}else D=0;R=D}return I=R,Xf=t,0|I}function Gn(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0;if(t=Xf,Xf=Xf+80|0,i=t+68|0,n=t+64|0,r=t+60|0,s=t+52|0,a=t+44|0,o=t,h=t+56|0,l=t+48|0,c=t+40|0,d=e+132|0,kf[d>>2]=0,u=e+148|0,0|kf[u>>2]){if(f=e+144|0,p=0|kf[f>>2],0|p){_=p;do p=_,_=0|kf[_>>2],mf(p);while(0!=(0|_))}if(kf[f>>2]=0,f=0|kf[e+140>>2],0|f){_=e+136|0,p=0;do kf[(0|kf[_>>2])+(p<<2)>>2]=0,p=p+1|0;while((0|p)!=(0|f))}kf[u>>2]=0}u=e+4|0,f=0|kf[u>>2],p=0|If[f+36>>0],_=(255&p)<<8;do{if((65535&(_|Lf[f+37>>0]))<514){if(m=0|kf[f+32>>2],(65535&_)<512?(A=m+8|0,v=0|kf[A>>2],y=0|kf[A+4>>2],A=m+16|0,g=A,b=0|kf[g>>2],E=0|tc(0|b,0|kf[g+4>>2],4,0),g=qf,(0|y)<(0|g)|(0|y)==(0|g)&v>>>0<E>>>0||(v=(0|kf[m>>2])+b|0,b=Lf[v>>0]|Lf[v+1>>0]<<8|Lf[v+2>>0]<<16|Lf[v+3>>0]<<24,kf[i>>2]=b,v=A,kf[v>>2]=E,kf[v+4>>2]=g,T=f,S=p,w=b,C=14)):0|Qs(i,m)&&(m=0|kf[u>>2],T=m,S=0|If[m+36>>0],w=0|kf[i>>2],C=14),14==(0|C)){kf[d>>2]=w,M=S,P=T;break}return I=0,Xf=t,0|I}M=p,P=f}while(0);if(f=0|kf[P+32>>2],((255&M)<<8&65535)<512?(P=f+8|0,p=0|kf[P>>2],T=0|kf[P+4>>2],P=f+16|0,S=P,w=0|kf[S>>2],d=0|tc(0|w,0|kf[S+4>>2],4,0),S=qf,(0|T)<(0|S)|(0|T)==(0|S)&p>>>0<d>>>0?R=0:(p=(0|kf[f>>2])+w|0,w=Lf[p>>0]|Lf[p+1>>0]<<8|Lf[p+2>>0]<<16|Lf[p+3>>0]<<24,kf[n>>2]=w,p=P,kf[p>>2]=d,kf[p+4>>2]=S,x=w,O=M,k=f,C=21)):0|Qs(n,f)?(f=0|kf[u>>2],x=0|kf[n>>2],O=0|If[f+36>>0],k=0|kf[f+32>>2],C=21):R=0,21==(0|C)){if(f=e+156|0,kf[f>>2]=x,((255&O)<<8&65535)<512?(O=k+8|0,x=0|kf[O>>2],n=0|kf[O+4>>2],O=k+16|0,M=O,w=0|kf[M>>2],S=0|tc(0|w,0|kf[M+4>>2],4,0),M=qf,(0|n)<(0|M)|(0|n)==(0|M)&x>>>0<S>>>0?D=0:(x=(0|kf[k>>2])+w|0,w=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[r>>2]=w,x=O,kf[x>>2]=S,kf[x+4>>2]=M,L=w,C=26)):0|Qs(r,k)?(L=0|kf[r>>2],C=26):D=0,26==(0|C))if((L>>>0<=1431655765?(0|kf[f>>2])>>>0<=(3*L|0)>>>0:0)?(k=0|kf[u>>2],w=0|kf[k+32>>2],M=w+8|0,x=0|kf[M>>2],S=0|kf[M+4>>2],M=w+16|0,O=M,n=0|kf[O>>2],p=0|kf[O+4>>2],(0|S)>(0|p)|(0|S)==(0|p)&x>>>0>n>>>0):0){if(O=0|kf[w>>2],d=0|If[O+n>>0],P=0|tc(0|n,0|p,1,0),T=M,kf[T>>2]=P,kf[T+4>>2]=qf,(Lf[k+36>>0]<<8&65535)<512?(k=0|tc(0|n,0|p,5,0),p=qf,(0|S)<(0|p)|(0|S)==(0|p)&x>>>0<k>>>0?N=0:(x=O+P|0,P=Lf[x>>0]|Lf[x+1>>0]<<8|Lf[x+2>>0]<<16|Lf[x+3>>0]<<24,kf[s>>2]=P,x=M,kf[x>>2]=k,kf[x+4>>2]=p,F=L,B=P,C=34)):0|Qs(s,w)?(F=0|kf[r>>2],B=0|kf[s>>2],C=34):N=0,34==(0|C))if(F>>>0>=B>>>0?F>>>0<=(((B>>>0)/3|0)+B|0)>>>0:0){F=0|kf[u>>2],w=0|kf[F+32>>2],(Lf[F+36>>0]<<8&65535)<512?(F=w+8|0,P=0|kf[F>>2],L=0|kf[F+4>>2],F=w+16|0,p=F,x=0|kf[p>>2],k=0|tc(0|x,0|kf[p+4>>2],4,0),p=qf,(0|L)<(0|p)|(0|L)==(0|p)&P>>>0<k>>>0?V=0:(P=(0|kf[w>>2])+x|0,x=Lf[P>>0]|Lf[P+1>>0]<<8|Lf[P+2>>0]<<16|Lf[P+3>>0]<<24,kf[a>>2]=x,P=F,kf[P>>2]=k,kf[P+4>>2]=p,U=x,G=B,C=41)):0|Qs(a,w)?(U=0|kf[a>>2],G=0|kf[s>>2],C=41):V=0;e:do if(41==(0|C))if(U>>>0>G>>>0)V=0;else{if(w=0|kf[e+24>>2],B=e+28|0,x=0|kf[B>>2],(0|x)!=(0|w)&&(kf[B>>2]=x+(~((x+-4-w|0)>>>2)<<2)),w=0|sl(88),ch(w),x=e+8|0,B=0|kf[x>>2],kf[x>>2]=w,0|B?(is(B),mf(B),0==(0|kf[x>>2])):0){V=0;break}if(B=e+160|0,w=0|kf[B>>2],p=e+164|0,P=0|kf[p>>2],(0|P)!=(0|w)&&(kf[p>>2]=P+(~((P+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=e+172|0,w=0|kf[B>>2],P=e+176|0,p=0|kf[P>>2],(0|p)!=(0|w)&&(kf[P>>2]=p+(~((p+-4-w|0)>>>2)<<2)),pa(B,0|kf[r>>2]),B=0|kf[e+36>>2],w=e+40|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(12*~(((p+-12-B|0)>>>0)/12|0)|0)),B=0|kf[e+48>>2],p=e+52|0,w=0|kf[p>>2],(0|w)!=(0|B)&&(kf[p>>2]=w+(~((w+-4-B|0)>>>2)<<2)),kf[e+64>>2]=0,B=0|kf[e+72>>2],w=e+76|0,p=0|kf[w>>2],(0|p)!=(0|B)&&(kf[w>>2]=p+(~((p+-4-B|0)>>>2)<<2)),kf[e+84>>2]=-1,kf[e+92>>2]=-1,kf[e+88>>2]=-1,B=e+216|0,p=0|kf[B>>2],w=e+220|0,P=0|kf[w>>2],(0|P)!=(0|p)){k=P;do kf[w>>2]=k+-144,P=0|kf[k+-12>>2],0|P&&(F=k+-8|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-28>>2],0|P&&(L=k+-24|0,F=0|kf[L>>2],(0|F)!=(0|P)&&(kf[L>>2]=F+(~((F+-4-P|0)>>>2)<<2)),mf(P)),P=0|kf[k+-40>>2],0|P&&(F=k+-36|0,L=0|kf[F>>2],(0|L)!=(0|P)&&(kf[F>>2]=L+(~((L+-4-P|0)>>>2)<<2)),mf(P)),ls(k+-140|0),k=0|kf[w>>2];while((0|k)!=(0|p))}if(p=255&d,Sr(B,p),!(0|Ss(0|kf[x>>2],0|kf[r>>2],(0|kf[a>>2])+(0|kf[f>>2])|0))){V=0;break}k=(0|kf[a>>2])+(0|kf[f>>2])|0,If[i>>0]=1,pi(e+120|0,k,i),k=0|kf[u>>2],P=Lf[k+36>>0]<<8;t:do{if(!((65535&(P|Lf[k+37>>0]))>=514)){L=0|kf[k+32>>2];do if((65535&P)<512){if(F=L+8|0,M=0|kf[F>>2],O=0|kf[F+4>>2],F=L+16|0,S=F,n=0|kf[S>>2],T=0|tc(0|n,0|kf[S+4>>2],4,0),S=qf,(0|O)<(0|S)|(0|O)==(0|S)&M>>>0<T>>>0)break;M=(0|kf[L>>2])+n|0,n=Lf[M>>0]|Lf[M+1>>0]<<8|Lf[M+2>>0]<<16|Lf[M+3>>0]<<24,kf[i>>2]=n,M=F,kf[M>>2]=T,kf[M+4>>2]=S,z=n,C=77}else{if(!(0|Qs(i,L)))break;z=0|kf[i>>2],C=77}while(0);do if(77==(0|C)){if(!z)break;if(L=0|kf[(0|kf[u>>2])+32>>2],n=L+8|0,S=L+16|0,L=0|nc(0|kf[n>>2],0|kf[n+4>>2],0|kf[S>>2],0|kf[S+4>>2]),S=qf,0>(0|S)|0==(0|S)&z>>>0>L>>>0)break;if(Dh(o),L=0|kf[(0|kf[u>>2])+32>>2],S=L+16|0,n=0|kf[S>>2],M=0|kf[i>>2],T=(0|kf[L>>2])+n+M|0,F=L+8|0,O=0|nc(0|kf[F>>2],0|kf[F+4>>2],0|n,0|kf[S+4>>2]),S=0|nc(0|O,0|qf,0|M,0),qh(o,T,S,0|xf[L+38>>1]),L=0|qi(e,o),bf(o+24|0),(0|L)==-1)break;W=L;break t}while(0);V=0;break e}if((0|qi(e,0|kf[k+32>>2]))==-1){V=0;break e}W=-1}while(0);P=e+232|0,kf[e+376>>2]=e,k=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,L=0|kf[k>>2],k=(0|kf[L>>2])+(0|kf[L+16>>2])|0,L=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,S=0|kf[L>>2],L=S+8|0,T=S+16|0,S=0|nc(0|kf[L>>2],0|kf[L+4>>2],0|kf[T>>2],0|kf[T+4>>2]),T=(0|Cp[127&kf[(0|kf[e>>2])+32>>2]](e))+32|0,qh(P,k,S,0|xf[(0|kf[T>>2])+38>>1]),kf[e+372>>2]=p,Dh(o);t:do if(0|ve(P,o)){if(T=0|Fn(e,0|kf[s>>2]),(0|T)==-1){H=0;break}S=0|kf[(0|kf[u>>2])+32>>2],k=o+16|0,L=0|kf[k>>2],M=(0|kf[o>>2])+L|0,O=o+8|0,n=0|nc(0|kf[O>>2],0|kf[O+4>>2],0|L,0|kf[k+4>>2]),qh(S,M,n,0|xf[S+38>>1]),S=0|kf[u>>2],n=65535&(Lf[S+36>>0]<<8|Lf[S+37>>0]),(65535&n)<514&&(M=(0|kf[S+32>>2])+16|0,S=M,k=0|tc(0|kf[S>>2],0|kf[S+4>>2],0|W,((0|W)<0)<<31>>31|0),S=M,kf[S>>2]=k,kf[S+4>>2]=qf);do if((0|kf[w>>2])!=(0|kf[B>>2]))if(S=0|kf[x>>2],k=(0|kf[S+4>>2])!=(0|kf[S>>2]),(65535&n)<513){if(!k)break;S=0;do{if(kf[h>>2]=S,kf[i>>2]=kf[h>>2],S=S+3|0,!(0|xe(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}else{if(!k)break;S=0;do{if(kf[l>>2]=S,kf[i>>2]=kf[l>>2],S=S+3|0,!(0|be(e,i))){H=0;break t}M=0|kf[x>>2]}while(S>>>0<(0|kf[M+4>>2])-(0|kf[M>>2])>>2>>>0)}while(0);if(0|If[e+308>>0]&&hh(e+272|0),(0|Ff[e+270>>1])<514&&hh(e+328|0),n=0|kf[B>>2],(0|kf[w>>2])!=(0|n)){S=n,n=0;do{if(0|Mi(S+(144*n|0)+4|0,0|kf[x>>2]),k=0|kf[B>>2],M=0|kf[k+(144*n|0)+132>>2],L=0|kf[k+(144*n|0)+136>>2],(0|M)==(0|L))j=k;else for(O=k,k=M;;){if(kf[c>>2]=kf[k>>2],kf[i>>2]=kf[c>>2],ni(O+(144*n|0)+4|0,i),k=k+4|0,M=0|kf[B>>2],(0|k)==(0|L)){j=M;break}O=M}zo(j+(144*n|0)+4|0,0,0),n=n+1|0,S=0|kf[B>>2]}while(n>>>0<(((0|kf[w>>2])-S|0)/144|0)>>>0)}S=0|kf[x>>2],n=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=e+196|0,O=e+200|0,L=0|kf[O>>2],k=0|kf[S>>2],M=L-k>>2,F=k,k=L;do if(n>>>0>M>>>0)Kr(S,n-M|0);else{if(n>>>0>=M>>>0)break;if(L=F+(n<<2)|0,(0|k)==(0|L))break;kf[O>>2]=k+(~((k+-4-L|0)>>>2)<<2)}while(0);if(pa(e+184|0,n),k=0|kf[B>>2],(0|kf[w>>2])!=(0|k)){O=k,k=0;do{F=O,M=(0|kf[F+(144*k|0)+60>>2])-(0|kf[F+(144*k|0)+56>>2])>>2,S=0|kf[x>>2],L=(0|kf[S+28>>2])-(0|kf[S+24>>2])>>2,S=(0|M)<(0|L)?L:M,M=F+(144*k|0)+116|0,L=F+(144*k|0)+120|0,_=0|kf[L>>2],m=0|kf[M>>2],b=_-m>>2,g=m,m=_;do if(S>>>0>b>>>0)Kr(M,S-b|0);else{if(S>>>0>=b>>>0)break;if(_=g+(S<<2)|0,(0|m)==(0|_))break;kf[L>>2]=m+(~((m+-4-_|0)>>>2)<<2)}while(0);pa(F+(144*k|0)+104|0,S),k=k+1|0,O=0|kf[B>>2]}while(k>>>0<(((0|kf[w>>2])-O|0)/144|0)>>>0)}H=0|ki(e,T)}else H=0;while(0);bf(o+24|0),V=H}while(0);N=V}else N=0;D=N}else D=0;R=D}return I=R,Xf=t,0|I}function Wn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0,Le=0,Ne=0,Fe=0;n=Xf,Xf=Xf+32|0,r=n,s=e+12|0,a=0|kf[s>>2],kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0;do if(a){if(!(a>>>0>1073741823)){h=a<<2,l=0|sl(h),kf[r>>2]=l,c=l+(a<<2)|0,kf[r+8>>2]=c,0|Bs(0|l,0,0|h),kf[o>>2]=c,d=c,u=l;break}Du(r)}else d=0,u=0;while(0);l=e+120|0,c=0|kf[l>>2],h=0|kf[c>>2],f=c+4|0,h?(a=0|kf[f>>2],(0|a)!=(0|h)&&(kf[f>>2]=a+(~((a+-4-h|0)>>>2)<<2)),mf(h),h=c+8|0,kf[h>>2]=0,kf[f>>2]=0,kf[c>>2]=0,p=0|kf[r>>2],_=0|kf[o>>2],m=0|kf[s>>2],A=h):(p=u,_=d,m=a,A=c+8|0),kf[c>>2]=p,kf[f>>2]=_,kf[A>>2]=kf[r+8>>2],kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,kf[r+8>>2]=0;do if(m){if(!(m>>>0>1073741823)){_=m<<2,f=0|sl(_),kf[r>>2]=f,p=f+(m<<2)|0,kf[r+8>>2]=p,0|Bs(0|f,0,0|_),kf[A>>2]=p,v=p,y=f;break}Du(r)}else v=0,y=0;while(0);m=e+132|0,f=0|kf[m>>2],p=0|kf[f>>2],_=f+4|0,p?(v=0|kf[_>>2],(0|v)!=(0|p)&&(kf[_>>2]=v+(~((v+-4-p|0)>>>2)<<2)),mf(p),p=f+8|0,kf[p>>2]=0,kf[_>>2]=0,kf[f>>2]=0,g=0|kf[r>>2],b=0|kf[A>>2],E=p):(g=y,b=v,E=f+8|0),kf[f>>2]=g,kf[_>>2]=b,kf[E>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,E=r+8|0,b=r+4|0,_=r+16|0,g=r+20|0,gn(r),f=0|kf[b>>2],p=(0|kf[g>>2])+(0|kf[_>>2])|0,T=(0|kf[E>>2])==(0|f)?0:(0|kf[f+(((p>>>0)/341|0)<<2)>>2])+(12*((p>>>0)%341|0)|0)|0,kf[T>>2]=t,kf[T+4>>2]=0,kf[T+8>>2]=0,T=(0|kf[g>>2])+1|0,kf[g>>2]=T;e:do if(T)for(p=e+108|0,f=i+16|0,A=i+20|0,v=i+28|0,y=e+8|0,c=i+12|0,h=e+96|0,o=e+52|0,a=e+48|0,d=e+40|0,u=e+4|0,w=e+32|0,C=e+28|0,M=e+20|0,P=e+92|0,I=e+80|0,R=e+88|0,x=T;;){if(O=0|kf[_>>2],k=x+-1|0,D=O+k|0,L=0|kf[b>>2],N=0|kf[L+(((D>>>0)/341|0)<<2)>>2],F=(D>>>0)%341|0,D=0|kf[N+(12*F|0)>>2],B=0|kf[N+(12*F|0)+4>>2],V=0|kf[N+(12*F|0)+8>>2],kf[g>>2]=k,k=0|kf[E>>2],F=k-L>>2,(1-x-O+(0==(0|F)?0:(341*F|0)+-1|0)|0)>>>0>681&&(mf(0|kf[k+-4>>2]),kf[E>>2]=(0|kf[E>>2])+-4),k=0|kf[l>>2],F=k+(12*V|0)|0,O=(0|kf[m>>2])+(12*V|0)|0,D>>>0>t>>>0){S=0;break e}if(L=0|Rl(e,D,O,B),L>>>0>=(0|kf[s>>2])>>>0){S=0;break e}B=(0|kf[e>>2])-(0|kf[(0|kf[O>>2])+(L<<2)>>2])|0;t:do if(B){if(!(D>>>0<3)){if((0|kf[y>>2])>>>0>(0|kf[u>>2])>>>0){S=0;break e}Y=V+1|0,W=0|kf[l>>2],G=W+(12*Y|0)|0,(0|G)==(0|F)?_e=W:(Wt(G,0|kf[F>>2],0|kf[k+(12*V|0)+4>>2]),_e=0|kf[l>>2]),G=(0|kf[_e+(12*Y|0)>>2])+(L<<2)|0,
kf[G>>2]=(0|kf[G>>2])+(1<<B+-1),G=31^(0|sp(0|D)),W=0|kf[w>>2],X=32-W|0;do if((0|G)>(0|X))N=0|kf[C>>2],Z=N+4|0,(0|Z)==(0|kf[M>>2])?me=0:(H=kf[N>>2]<<W,N=G-X|0,kf[w>>2]=N,kf[C>>2]=Z,Q=32-N|0,me=(0|kf[Z>>2])>>>Q|H>>>(Q-X|0));else if(Q=0|kf[C>>2],(0|Q)==(0|kf[M>>2]))me=0;else{if(H=kf[Q>>2]<<W>>>(32-G|0),Z=W+G|0,kf[w>>2]=Z,32!=(0|Z)){me=H;break}kf[C>>2]=Q+4,kf[w>>2]=0,me=H}while(0);G=(D>>>1)-me|0,W=D-G|0;i:do if((0|G)==(0|W))Ae=G,ve=G;else{X=0|kf[P>>2],H=0|kf[R>>2];do if((0|H)!=(0|kf[I>>2])){if(Q=0!=(kf[H>>2]&1<<31-X|0),Z=X+1|0,kf[P>>2]=Z,32==(0|Z)){if(kf[R>>2]=H+4,kf[P>>2]=0,Q){Ae=G,ve=W;break i}break}if(Q){Ae=G,ve=W;break i}break}while(0);Ae=W,ve=G}while(0);if(G=0|kf[m>>2],W=0|kf[G+(12*V|0)>>2],H=W+(L<<2)|0,kf[H>>2]=(0|kf[H>>2])+1,Wt(G+(12*Y|0)|0,W,0|kf[G+(12*V|0)+4>>2]),0|Ae&&(G=0|kf[E>>2],W=0|kf[b>>2],H=G-W>>2,X=0|kf[_>>2],Q=0|kf[g>>2],(0|(0==(0|H)?0:(341*H|0)+-1|0))==(Q+X|0)?(gn(r),ye=0|kf[_>>2],ge=0|kf[g>>2],be=0|kf[E>>2],Ee=0|kf[b>>2]):(ye=X,ge=Q,be=G,Ee=W),W=ge+ye|0,Te=(0|be)==(0|Ee)?0:(0|kf[Ee+(((W>>>0)/341|0)<<2)>>2])+(12*((W>>>0)%341|0)|0)|0,kf[Te>>2]=Ae,kf[Te+4>>2]=L,kf[Te+8>>2]=V,kf[g>>2]=(0|kf[g>>2])+1),!ve){U=23;break}W=0|kf[E>>2],G=0|kf[b>>2],Q=W-G>>2,X=0|kf[_>>2],H=0|kf[g>>2],(0|(0==(0|Q)?0:(341*Q|0)+-1|0))==(H+X|0)?(gn(r),Se=0|kf[_>>2],we=0|kf[g>>2],Ce=0|kf[E>>2],Me=0|kf[b>>2]):(Se=X,we=H,Ce=W,Me=G),G=we+Se|0,Pe=(0|Ce)==(0|Me)?0:(0|kf[Me+(((G>>>0)/341|0)<<2)>>2])+(12*((G>>>0)%341|0)|0)|0,kf[Pe>>2]=ve,kf[Pe+4>>2]=L,kf[Pe+8>>2]=Y,G=(0|kf[g>>2])+1|0,kf[g>>2]=G,Ie=G;break}if(N=0|kf[p>>2],kf[N>>2]=L,G=0|kf[s>>2],G>>>0>1)for(W=G,z=L,Y=1;;){if(z=(0|z)==(W+-1|0)?0:z+1|0,kf[N+(Y<<2)>>2]=z,Y=Y+1|0,Z=0|kf[s>>2],Y>>>0>=Z>>>0){te=Z;break}W=Z}else te=G;if(!D){U=23;break}for(W=te,Y=0;;){if(0|W){z=0|kf[p>>2],N=0|kf[h>>2],Z=0|kf[O>>2],X=0;do{H=z+(X<<2)|0,kf[N+(kf[H>>2]<<2)>>2]=0,Q=0|kf[H>>2],ie=(0|kf[e>>2])-(0|kf[Z+(Q<<2)>>2])|0;do if(0|ie){if(ne=N+(Q<<2)|0,re=0|kf[o>>2],se=32-re|0,(0|ie)>(0|se)){if(ae=0|kf[a>>2],oe=ae+4|0,(0|oe)==(0|kf[d>>2])){kf[ne>>2]=0;break}he=kf[ae>>2]<<re,ae=ie-se|0,kf[o>>2]=ae,kf[a>>2]=oe,le=32-ae|0,kf[ne>>2]=(0|kf[oe>>2])>>>le|he>>>(le-se|0);break}if(se=0|kf[a>>2],(0|se)==(0|kf[d>>2])){kf[ne>>2]=0;break}if(kf[ne>>2]=kf[se>>2]<<re>>>(32-ie|0),re=(0|kf[o>>2])+ie|0,kf[o>>2]=re,32!=(0|re))break;kf[a>>2]=se+4,kf[o>>2]=0}while(0);ie=0|kf[H>>2],Q=N+(ie<<2)|0,kf[Q>>2]=kf[Q>>2]|kf[(0|kf[F>>2])+(ie<<2)>>2],X=X+1|0}while(X>>>0<(0|kf[s>>2])>>>0)}X=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|X)){N=X,Z=0;do{z=N,ie=0|kf[z+(20*Z|0)>>2],Q=z+(20*Z|0)+12|0,se=z+(20*Z|0)+16|0,re=(0|kf[h>>2])+(kf[z+(20*Z|0)+4>>2]<<2)|0,z=0|kf[Q>>2];do if(4==(0|z))ce=re;else{if(ne=0|kf[c>>2],!(0|kf[se>>2])){ce=ne;break}for(de=z,ue=ne,fe=0;;){if(0|ui(0|ue,re+(fe<<2)|0,0|de),fe=fe+1|0,ne=0|kf[Q>>2],fe>>>0>=(0|kf[se>>2])>>>0)break;de=ne,ue=ue+ne|0}ce=0|kf[c>>2]}while(0);if(se=0|kf[v>>2],pe=0|If[ie+84>>0]?se:0|kf[(0|kf[ie+68>>2])+(se<<2)>>2],pe>>>0>=(0|kf[ie+80>>2])>>>0)break i;se=ie+40|0,Q=0|kf[se>>2],re=0|pl(0|Q,0|kf[se+4>>2],0|pe,0),0|ui((0|kf[kf[ie+64>>2]>>2])+re|0,0|ce,0|Q),Z=Z+1|0,N=0|kf[f>>2]}while(Z>>>0<(((0|kf[A>>2])-N|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,X=Y+1|0,(0|X)==(0|D)){U=23;break t}W=0|kf[s>>2],Y=X}}else if(D)for(N=0;;){G=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|G)){W=G,z=0;do{H=W,j=0|kf[H+(20*z|0)>>2],Y=H+(20*z|0)+12|0,X=H+(20*z|0)+16|0,Z=(0|kf[F>>2])+(kf[H+(20*z|0)+4>>2]<<2)|0,H=0|kf[Y>>2];do if(4==(0|H))K=Z;else{if(Q=0|kf[c>>2],!(0|kf[X>>2])){K=Q;break}for(J=H,q=Q,$=0;;){if(0|ui(0|q,Z+($<<2)|0,0|J),$=$+1|0,Q=0|kf[Y>>2],$>>>0>=(0|kf[X>>2])>>>0)break;J=Q,q=q+Q|0}K=0|kf[c>>2]}while(0);if(X=0|kf[v>>2],ee=0|If[j+84>>0]?X:0|kf[(0|kf[j+68>>2])+(X<<2)>>2],ee>>>0>=(0|kf[j+80>>2])>>>0)break i;X=j+40|0,Y=0|kf[X>>2],Z=0|pl(0|Y,0|kf[X+4>>2],0|ee,0),0|ui((0|kf[kf[j+64>>2]>>2])+Z|0,0|K,0|Y),z=z+1|0,W=0|kf[f>>2]}while(z>>>0<(((0|kf[A>>2])-W|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,N=N+1|0,(0|N)==(0|D)){U=23;break}}else U=23;while(0);if(23==(0|U)&&(U=0,Ie=0|kf[g>>2]),!Ie){S=1;break}x=Ie}else S=1;while(0);Ie=0|kf[b>>2],Pe=0|kf[_>>2],ve=Ie+(((Pe>>>0)/341|0)<<2)|0,Me=0|kf[E>>2],Ce=Me,Se=Ie,(0|Me)==(0|Ie)?(Re=0,xe=0):(we=(0|kf[g>>2])+Pe|0,Re=(0|kf[Ie+(((we>>>0)/341|0)<<2)>>2])+(12*((we>>>0)%341|0)|0)|0,xe=(0|kf[ve>>2])+(12*((Pe>>>0)%341|0)|0)|0),Pe=ve,ve=xe;e:for(;;){xe=ve;do{if(we=xe,(0|we)==(0|Re))break e;xe=we+12|0}while(4092!=(xe-(0|kf[Pe>>2])|0));xe=Pe+4|0,Pe=xe,ve=0|kf[xe>>2]}if(kf[g>>2]=0,g=Ce-Se>>2,g>>>0>2){Se=Ie;do mf(0|kf[Se>>2]),Se=(0|kf[b>>2])+4|0,kf[b>>2]=Se,Oe=0|kf[E>>2],ke=Oe-Se>>2;while(ke>>>0>2);De=Se,Le=Oe,Ne=ke}else De=Ie,Le=Me,Ne=g;switch(0|Ne){case 1:Fe=170,U=109;break;case 2:Fe=341,U=109}if(109==(0|U)&&(kf[_>>2]=Fe),(0|De)!=(0|Le)){Fe=De;do mf(0|kf[Fe>>2]),Fe=Fe+4|0;while((0|Fe)!=(0|Le));Le=0|kf[b>>2],b=0|kf[E>>2],(0|b)!=(0|Le)&&(kf[E>>2]=b+(~((b+-4-Le|0)>>>2)<<2))}return(Le=0|kf[r>>2])?(mf(Le),Xf=n,0|S):(Xf=n,0|S)}function zn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0,Le=0,Ne=0;n=Xf,Xf=Xf+32|0,r=n,s=e+12|0,a=0|kf[s>>2],kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0;do if(a){if(!(a>>>0>1073741823)){h=a<<2,l=0|sl(h),kf[r>>2]=l,c=l+(a<<2)|0,kf[r+8>>2]=c,0|Bs(0|l,0,0|h),kf[o>>2]=c,d=c,u=l;break}Du(r)}else d=0,u=0;while(0);l=e+120|0,c=0|kf[l>>2],h=0|kf[c>>2],f=c+4|0,h?(a=0|kf[f>>2],(0|a)!=(0|h)&&(kf[f>>2]=a+(~((a+-4-h|0)>>>2)<<2)),mf(h),h=c+8|0,kf[h>>2]=0,kf[f>>2]=0,kf[c>>2]=0,p=0|kf[r>>2],_=0|kf[o>>2],m=0|kf[s>>2],A=h):(p=u,_=d,m=a,A=c+8|0),kf[c>>2]=p,kf[f>>2]=_,kf[A>>2]=kf[r+8>>2],kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,kf[r+8>>2]=0;do if(m){if(!(m>>>0>1073741823)){_=m<<2,f=0|sl(_),kf[r>>2]=f,p=f+(m<<2)|0,kf[r+8>>2]=p,0|Bs(0|f,0,0|_),kf[A>>2]=p,v=p,y=f;break}Du(r)}else v=0,y=0;while(0);m=e+132|0,f=0|kf[m>>2],p=0|kf[f>>2],_=f+4|0,p?(v=0|kf[_>>2],(0|v)!=(0|p)&&(kf[_>>2]=v+(~((v+-4-p|0)>>>2)<<2)),mf(p),p=f+8|0,kf[p>>2]=0,kf[_>>2]=0,kf[f>>2]=0,g=0|kf[r>>2],b=0|kf[A>>2],E=p):(g=y,b=v,E=f+8|0),kf[f>>2]=g,kf[_>>2]=b,kf[E>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,E=r+8|0,b=r+4|0,_=r+16|0,g=r+20|0,gn(r),f=0|kf[b>>2],p=(0|kf[g>>2])+(0|kf[_>>2])|0,T=(0|kf[E>>2])==(0|f)?0:(0|kf[f+(((p>>>0)/341|0)<<2)>>2])+(12*((p>>>0)%341|0)|0)|0,kf[T>>2]=t,kf[T+4>>2]=0,kf[T+8>>2]=0,T=(0|kf[g>>2])+1|0,kf[g>>2]=T;e:do if(T)for(p=e+108|0,f=i+16|0,A=i+20|0,v=i+28|0,y=e+8|0,c=i+12|0,h=e+96|0,o=e+52|0,a=e+48|0,d=e+40|0,u=e+4|0,w=e+32|0,C=e+28|0,M=e+20|0,P=e+92|0,I=e+80|0,R=e+88|0,x=T;;){if(O=0|kf[_>>2],k=x+-1|0,D=O+k|0,L=0|kf[b>>2],N=0|kf[L+(((D>>>0)/341|0)<<2)>>2],F=(D>>>0)%341|0,D=0|kf[N+(12*F|0)>>2],B=0|kf[N+(12*F|0)+4>>2],V=0|kf[N+(12*F|0)+8>>2],kf[g>>2]=k,k=0|kf[E>>2],F=k-L>>2,(1-x-O+(0==(0|F)?0:(341*F|0)+-1|0)|0)>>>0>681&&(mf(0|kf[k+-4>>2]),kf[E>>2]=(0|kf[E>>2])+-4),k=0|kf[l>>2],F=k+(12*V|0)|0,D>>>0>t>>>0){S=0;break e}if(O=0|kf[s>>2],L=(O+-1|0)==(0|B)?0:B+1|0,L>>>0>=O>>>0){S=0;break e}O=(0|kf[m>>2])+(12*V|0)|0,B=(0|kf[e>>2])-(0|kf[(0|kf[O>>2])+(L<<2)>>2])|0;t:do if(B){if(D>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[u>>2])>>>0){S=0;break e}N=V+1|0,Wt(k+(12*N|0)|0,0|kf[F>>2],0|kf[k+(12*V|0)+4>>2]),G=(0|kf[(0|kf[l>>2])+(12*N|0)>>2])+(L<<2)|0,kf[G>>2]=(0|kf[G>>2])+(1<<B+-1),G=31^(0|sp(0|D)),W=0|kf[w>>2],z=32-W|0,(0|G)>(0|z)?(Y=0|kf[C>>2],Z=Y+4|0,(0|Z)==(0|kf[M>>2])?te=0:(X=kf[Y>>2]<<W,Y=G-z|0,kf[w>>2]=Y,kf[C>>2]=Z,H=32-Y|0,te=(0|kf[Z>>2])>>>H|X>>>(H-z|0))):(z=0|kf[C>>2],(0|z)!=(0|kf[M>>2])?(H=kf[z>>2]<<W>>>(32-G|0),X=W+G|0,kf[w>>2]=X,32==(0|X)?(kf[C>>2]=z+4,kf[w>>2]=0,te=H):te=H):te=0),H=(D>>>1)-te|0,z=D-H|0;i:do if((0|H)==(0|z))ie=H,ne=H;else{X=0|kf[P>>2],G=0|kf[R>>2];do if((0|G)!=(0|kf[I>>2])){if(W=0!=(kf[G>>2]&1<<31-X|0),Z=X+1|0,kf[P>>2]=Z,32==(0|Z)){if(kf[R>>2]=G+4,kf[P>>2]=0,W){ie=H,ne=z;break i}break}if(W){ie=H,ne=z;break i}break}while(0);ie=z,ne=H}while(0);if(H=0|kf[m>>2],z=0|kf[H+(12*V|0)>>2],G=z+(L<<2)|0,kf[G>>2]=(0|kf[G>>2])+1,Wt(H+(12*N|0)|0,z,0|kf[H+(12*V|0)+4>>2]),0|ie&&(H=0|kf[E>>2],z=0|kf[b>>2],G=H-z>>2,X=0|kf[_>>2],W=0|kf[g>>2],(0|(0==(0|G)?0:(341*G|0)+-1|0))==(W+X|0)?(gn(r),re=0|kf[_>>2],se=0|kf[g>>2],ae=0|kf[E>>2],oe=0|kf[b>>2]):(re=X,se=W,ae=H,oe=z),z=se+re|0,he=(0|ae)==(0|oe)?0:(0|kf[oe+(((z>>>0)/341|0)<<2)>>2])+(12*((z>>>0)%341|0)|0)|0,kf[he>>2]=ie,kf[he+4>>2]=L,kf[he+8>>2]=V,kf[g>>2]=(0|kf[g>>2])+1),!ne){U=23;break}z=0|kf[E>>2],H=0|kf[b>>2],W=z-H>>2,X=0|kf[_>>2],G=0|kf[g>>2],(0|(0==(0|W)?0:(341*W|0)+-1|0))==(G+X|0)?(gn(r),le=0|kf[_>>2],ce=0|kf[g>>2],de=0|kf[E>>2],ue=0|kf[b>>2]):(le=X,ce=G,de=z,ue=H),H=ce+le|0,fe=(0|de)==(0|ue)?0:(0|kf[ue+(((H>>>0)/341|0)<<2)>>2])+(12*((H>>>0)%341|0)|0)|0,kf[fe>>2]=ne,kf[fe+4>>2]=L,kf[fe+8>>2]=N,H=(0|kf[g>>2])+1|0,kf[g>>2]=H,pe=H;break}if(H=0|kf[p>>2],kf[H>>2]=L,z=0|kf[s>>2],z>>>0>1)for(G=z,X=L,W=1;;){if(X=(0|X)==(G+-1|0)?0:X+1|0,kf[H+(W<<2)>>2]=X,W=W+1|0,Z=0|kf[s>>2],W>>>0>=Z>>>0){_e=Z;break}G=Z}else _e=z;if(D)for(G=_e,W=0;;){if(0|G){X=0|kf[p>>2],H=0|kf[h>>2],N=0|kf[O>>2],Z=0;do{Y=X+(Z<<2)|0,kf[H+(kf[Y>>2]<<2)>>2]=0,Q=0|kf[Y>>2],me=(0|kf[e>>2])-(0|kf[N+(Q<<2)>>2])|0;do if(0|me){if(Ae=H+(Q<<2)|0,ve=0|kf[o>>2],ye=32-ve|0,(0|me)>(0|ye)){if(ge=0|kf[a>>2],be=ge+4|0,(0|be)==(0|kf[d>>2])){kf[Ae>>2]=0;break}Ee=kf[ge>>2]<<ve,ge=me-ye|0,kf[o>>2]=ge,kf[a>>2]=be,Te=32-ge|0,kf[Ae>>2]=(0|kf[be>>2])>>>Te|Ee>>>(Te-ye|0);break}if(ye=0|kf[a>>2],(0|ye)==(0|kf[d>>2])){kf[Ae>>2]=0;break}if(kf[Ae>>2]=kf[ye>>2]<<ve>>>(32-me|0),ve=(0|kf[o>>2])+me|0,kf[o>>2]=ve,32!=(0|ve))break;kf[a>>2]=ye+4,kf[o>>2]=0}while(0);me=0|kf[Y>>2],Q=H+(me<<2)|0,kf[Q>>2]=kf[Q>>2]|kf[(0|kf[F>>2])+(me<<2)>>2],Z=Z+1|0}while(Z>>>0<(0|kf[s>>2])>>>0)}Z=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|Z)){H=Z,N=0;do{X=H,me=0|kf[X+(20*N|0)>>2],Q=X+(20*N|0)+12|0,ye=X+(20*N|0)+16|0,ve=(0|kf[h>>2])+(kf[X+(20*N|0)+4>>2]<<2)|0,X=0|kf[Q>>2];do if(4==(0|X))Se=ve;else{if(Ae=0|kf[c>>2],!(0|kf[ye>>2])){Se=Ae;break}for(we=X,Ce=Ae,Me=0;;){if(0|ui(0|Ce,ve+(Me<<2)|0,0|we),Me=Me+1|0,Ae=0|kf[Q>>2],Me>>>0>=(0|kf[ye>>2])>>>0)break;we=Ae,Ce=Ce+Ae|0}Se=0|kf[c>>2]}while(0);if(ye=0|kf[v>>2],Pe=0|If[me+84>>0]?ye:0|kf[(0|kf[me+68>>2])+(ye<<2)>>2],Pe>>>0>=(0|kf[me+80>>2])>>>0)break i;ye=me+40|0,Q=0|kf[ye>>2],ve=0|pl(0|Q,0|kf[ye+4>>2],0|Pe,0),0|ui((0|kf[kf[me+64>>2]>>2])+ve|0,0|Se,0|Q),N=N+1|0,H=0|kf[f>>2]}while(N>>>0<(((0|kf[A>>2])-H|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,Z=W+1|0,(0|Z)==(0|D)){U=23;break t}G=0|kf[s>>2],W=Z}else U=23}else if(D)for(N=0;;){G=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|G)){W=G,z=0;do{H=W,j=0|kf[H+(20*z|0)>>2],Y=H+(20*z|0)+12|0,X=H+(20*z|0)+16|0,Z=(0|kf[F>>2])+(kf[H+(20*z|0)+4>>2]<<2)|0,H=0|kf[Y>>2];do if(4==(0|H))K=Z;else{if(Q=0|kf[c>>2],!(0|kf[X>>2])){K=Q;break}for(J=H,q=Q,$=0;;){if(0|ui(0|q,Z+($<<2)|0,0|J),$=$+1|0,Q=0|kf[Y>>2],$>>>0>=(0|kf[X>>2])>>>0)break;J=Q,q=q+Q|0}K=0|kf[c>>2]}while(0);if(X=0|kf[v>>2],ee=0|If[j+84>>0]?X:0|kf[(0|kf[j+68>>2])+(X<<2)>>2],ee>>>0>=(0|kf[j+80>>2])>>>0)break i;X=j+40|0,Y=0|kf[X>>2],Z=0|pl(0|Y,0|kf[X+4>>2],0|ee,0),0|ui((0|kf[kf[j+64>>2]>>2])+Z|0,0|K,0|Y),z=z+1|0,W=0|kf[f>>2]}while(z>>>0<(((0|kf[A>>2])-W|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,N=N+1|0,(0|N)==(0|D)){U=23;break}}else U=23;while(0);if(23==(0|U)&&(U=0,pe=0|kf[g>>2]),!pe){S=1;break}x=pe}else S=1;while(0);pe=0|kf[b>>2],s=0|kf[_>>2],Se=pe+(((s>>>0)/341|0)<<2)|0,Pe=0|kf[E>>2],Ce=Pe,we=pe,(0|Pe)==(0|pe)?(Ie=0,Re=0):(Me=(0|kf[g>>2])+s|0,Ie=(0|kf[pe+(((Me>>>0)/341|0)<<2)>>2])+(12*((Me>>>0)%341|0)|0)|0,Re=(0|kf[Se>>2])+(12*((s>>>0)%341|0)|0)|0),s=Se,Se=Re;e:for(;;){Re=Se;do{if(Me=Re,(0|Me)==(0|Ie))break e;Re=Me+12|0}while(4092!=(Re-(0|kf[s>>2])|0));Re=s+4|0,s=Re,Se=0|kf[Re>>2]}if(kf[g>>2]=0,g=Ce-we>>2,g>>>0>2){we=pe;do mf(0|kf[we>>2]),we=(0|kf[b>>2])+4|0,kf[b>>2]=we,xe=0|kf[E>>2],Oe=xe-we>>2;while(Oe>>>0>2);ke=we,De=xe,Le=Oe}else ke=pe,De=Pe,Le=g;switch(0|Le){case 1:Ne=170,U=107;break;case 2:Ne=341,U=107}if(107==(0|U)&&(kf[_>>2]=Ne),(0|ke)!=(0|De)){Ne=ke;do mf(0|kf[Ne>>2]),Ne=Ne+4|0;while((0|Ne)!=(0|De));De=0|kf[b>>2],b=0|kf[E>>2],(0|b)!=(0|De)&&(kf[E>>2]=b+(~((b+-4-De|0)>>>2)<<2))}return(De=0|kf[r>>2])?(mf(De),Xf=n,0|S):(Xf=n,0|S)}function Hn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0;n=Xf,Xf=Xf+32|0,r=n,s=e+12|0,a=0|kf[s>>2],kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0;do if(a){if(!(a>>>0>1073741823)){h=a<<2,l=0|sl(h),kf[r>>2]=l,c=l+(a<<2)|0,kf[r+8>>2]=c,0|Bs(0|l,0,0|h),kf[o>>2]=c,d=c,u=l;break}Du(r)}else d=0,u=0;while(0);l=e+628|0,c=0|kf[l>>2],h=0|kf[c>>2],f=c+4|0,h?(a=0|kf[f>>2],(0|a)!=(0|h)&&(kf[f>>2]=a+(~((a+-4-h|0)>>>2)<<2)),mf(h),h=c+8|0,kf[h>>2]=0,kf[f>>2]=0,kf[c>>2]=0,p=0|kf[r>>2],_=0|kf[o>>2],m=0|kf[s>>2],A=h):(p=u,_=d,m=a,A=c+8|0),kf[c>>2]=p,kf[f>>2]=_,kf[A>>2]=kf[r+8>>2],kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,kf[r+8>>2]=0;do if(m){if(!(m>>>0>1073741823)){_=m<<2,f=0|sl(_),kf[r>>2]=f,p=f+(m<<2)|0,kf[r+8>>2]=p,0|Bs(0|f,0,0|_),kf[A>>2]=p,v=p,y=f;break}Du(r)}else v=0,y=0;while(0);m=e+640|0,f=0|kf[m>>2],p=0|kf[f>>2],_=f+4|0,p?(v=0|kf[_>>2],(0|v)!=(0|p)&&(kf[_>>2]=v+(~((v+-4-p|0)>>>2)<<2)),mf(p),p=f+8|0,kf[p>>2]=0,kf[_>>2]=0,kf[f>>2]=0,g=0|kf[r>>2],b=0|kf[A>>2],E=p):(g=y,b=v,E=f+8|0),kf[f>>2]=g,kf[_>>2]=b,kf[E>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,E=r+8|0,b=r+4|0,_=r+16|0,g=r+20|0,gn(r),f=0|kf[b>>2],p=(0|kf[g>>2])+(0|kf[_>>2])|0,T=(0|kf[E>>2])==(0|f)?0:(0|kf[f+(((p>>>0)/341|0)<<2)>>2])+(12*((p>>>0)%341|0)|0)|0,kf[T>>2]=t,kf[T+4>>2]=0,kf[T+8>>2]=0,T=(0|kf[g>>2])+1|0,kf[g>>2]=T;e:do if(T)for(p=e+616|0,f=i+16|0,A=i+20|0,v=i+28|0,y=e+8|0,c=i+12|0,h=e+604|0,o=e+560|0,a=e+556|0,d=e+548|0,u=e+4|0,w=e+600|0,C=e+588|0,M=e+596|0,P=T;;){if(I=0|kf[_>>2],R=P+-1|0,x=I+R|0,O=0|kf[b>>2],k=0|kf[O+(((x>>>0)/341|0)<<2)>>2],D=(x>>>0)%341|0,x=0|kf[k+(12*D|0)>>2],L=0|kf[k+(12*D|0)+4>>2],N=0|kf[k+(12*D|0)+8>>2],kf[g>>2]=R,R=0|kf[E>>2],D=R-O>>2,(1-P-I+(0==(0|D)?0:(341*D|0)+-1|0)|0)>>>0>681&&(mf(0|kf[R+-4>>2]),kf[E>>2]=(0|kf[E>>2])+-4),R=0|kf[l>>2],D=R+(12*N|0)|0,I=(0|kf[m>>2])+(12*N|0)|0,x>>>0>t>>>0){S=0;break e}if(O=0|Gr(e,x,I,L),O>>>0>=(0|kf[s>>2])>>>0){S=0;break e}L=(0|kf[e>>2])-(0|kf[(0|kf[I>>2])+(O<<2)>>2])|0;t:do if(L){if(x>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[u>>2])>>>0){S=0;break e}if(k=N+1|0,B=0|kf[l>>2],V=B+(12*k|0)|0,(0|V)==(0|D)?q=B:(Wt(V,0|kf[D>>2],0|kf[R+(12*N|0)+4>>2]),q=0|kf[l>>2]),V=(0|kf[q+(12*k|0)>>2])+(O<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<L+-1),V=31^(0|sp(0|x)))for(B=0,U=0;;){if(z=1&(0|Qa(e+16+(B<<4)|0))|U<<1,B=B+1|0,(0|B)==(0|V)){$=z;break}U=z}else $=0;U=(x>>>1)-$|0,V=x-U|0;i:do if((0|U)==(0|V))ee=U,te=U;else{B=0|kf[w>>2],z=0|kf[M>>2];do if((0|z)!=(0|kf[C>>2])){if(j=0!=(kf[z>>2]&1<<31-B|0),H=B+1|0,kf[w>>2]=H,32==(0|H)){if(kf[M>>2]=z+4,kf[w>>2]=0,j){ee=U,te=V;break i}break}if(j){ee=U,te=V;break i}break}while(0);ee=V,te=U}while(0);if(U=0|kf[m>>2],V=0|kf[U+(12*N|0)>>2],z=V+(O<<2)|0,kf[z>>2]=(0|kf[z>>2])+1,Wt(U+(12*k|0)|0,V,0|kf[U+(12*N|0)+4>>2]),0|ee&&(U=0|kf[E>>2],V=0|kf[b>>2],z=U-V>>2,B=0|kf[_>>2],j=0|kf[g>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(j+B|0)?(gn(r),ie=0|kf[_>>2],ne=0|kf[g>>2],re=0|kf[E>>2],se=0|kf[b>>2]):(ie=B,ne=j,re=U,se=V),V=ne+ie|0,ae=(0|re)==(0|se)?0:(0|kf[se+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[ae>>2]=ee,kf[ae+4>>2]=O,kf[ae+8>>2]=N,kf[g>>2]=(0|kf[g>>2])+1),!te){F=23;break}V=0|kf[E>>2],U=0|kf[b>>2],j=V-U>>2,B=0|kf[_>>2],z=0|kf[g>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(z+B|0)?(gn(r),oe=0|kf[_>>2],he=0|kf[g>>2],le=0|kf[E>>2],ce=0|kf[b>>2]):(oe=B,he=z,le=V,ce=U),U=he+oe|0,de=(0|le)==(0|ce)?0:(0|kf[ce+(((U>>>0)/341|0)<<2)>>2])+(12*((U>>>0)%341|0)|0)|0,kf[de>>2]=te,kf[de+4>>2]=O,kf[de+8>>2]=k,U=(0|kf[g>>2])+1|0,kf[g>>2]=U,ue=U;break}if(U=0|kf[p>>2],kf[U>>2]=O,V=0|kf[s>>2],V>>>0>1)for(z=V,B=O,j=1;;){if(B=(0|B)==(z+-1|0)?0:B+1|0,kf[U+(j<<2)>>2]=B,j=j+1|0,H=0|kf[s>>2],j>>>0>=H>>>0){fe=H;break}z=H}else fe=V;if(x)for(z=fe,j=0;;){if(0|z){B=0|kf[p>>2],U=0|kf[h>>2],k=0|kf[I>>2],H=0;do{G=B+(H<<2)|0,kf[U+(kf[G>>2]<<2)>>2]=0,X=0|kf[G>>2],pe=(0|kf[e>>2])-(0|kf[k+(X<<2)>>2])|0;do if(0|pe){if(_e=U+(X<<2)|0,me=0|kf[o>>2],Ae=32-me|0,(0|pe)>(0|Ae)){if(ve=0|kf[a>>2],ye=ve+4|0,(0|ye)==(0|kf[d>>2])){kf[_e>>2]=0;break}ge=kf[ve>>2]<<me,ve=pe-Ae|0,kf[o>>2]=ve,kf[a>>2]=ye,be=32-ve|0,kf[_e>>2]=(0|kf[ye>>2])>>>be|ge>>>(be-Ae|0);break}if(Ae=0|kf[a>>2],(0|Ae)==(0|kf[d>>2])){kf[_e>>2]=0;break}if(kf[_e>>2]=kf[Ae>>2]<<me>>>(32-pe|0),me=(0|kf[o>>2])+pe|0,kf[o>>2]=me,32!=(0|me))break;kf[a>>2]=Ae+4,kf[o>>2]=0}while(0);pe=0|kf[G>>2],X=U+(pe<<2)|0,kf[X>>2]=kf[X>>2]|kf[(0|kf[D>>2])+(pe<<2)>>2],H=H+1|0}while(H>>>0<(0|kf[s>>2])>>>0)}H=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|H)){U=H,k=0;do{B=U,pe=0|kf[B+(20*k|0)>>2],X=B+(20*k|0)+12|0,Ae=B+(20*k|0)+16|0,me=(0|kf[h>>2])+(kf[B+(20*k|0)+4>>2]<<2)|0,B=0|kf[X>>2];do if(4==(0|B))Ee=me;else{if(_e=0|kf[c>>2],!(0|kf[Ae>>2])){Ee=_e;break}for(Te=B,Se=_e,we=0;;){if(0|ui(0|Se,me+(we<<2)|0,0|Te),we=we+1|0,_e=0|kf[X>>2],we>>>0>=(0|kf[Ae>>2])>>>0)break;Te=_e,Se=Se+_e|0}Ee=0|kf[c>>2]}while(0);if(Ae=0|kf[v>>2],Ce=0|If[pe+84>>0]?Ae:0|kf[(0|kf[pe+68>>2])+(Ae<<2)>>2],Ce>>>0>=(0|kf[pe+80>>2])>>>0)break i;Ae=pe+40|0,X=0|kf[Ae>>2],me=0|pl(0|X,0|kf[Ae+4>>2],0|Ce,0),0|ui((0|kf[kf[pe+64>>2]>>2])+me|0,0|Ee,0|X),k=k+1|0,U=0|kf[f>>2]}while(k>>>0<(((0|kf[A>>2])-U|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,H=j+1|0,(0|H)==(0|x)){F=23;break t}z=0|kf[s>>2],j=H}else F=23}else if(x)for(k=0;;){B=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|B)){V=B,U=0;do{G=V,W=0|kf[G+(20*U|0)>>2],z=G+(20*U|0)+12|0,H=G+(20*U|0)+16|0,j=(0|kf[D>>2])+(kf[G+(20*U|0)+4>>2]<<2)|0,G=0|kf[z>>2];do if(4==(0|G))Y=j;else{if(X=0|kf[c>>2],!(0|kf[H>>2])){Y=X;break}for(Z=G,K=X,Q=0;;){if(0|ui(0|K,j+(Q<<2)|0,0|Z),Q=Q+1|0,X=0|kf[z>>2],Q>>>0>=(0|kf[H>>2])>>>0)break;Z=X,K=K+X|0}Y=0|kf[c>>2]}while(0);if(H=0|kf[v>>2],J=0|If[W+84>>0]?H:0|kf[(0|kf[W+68>>2])+(H<<2)>>2],J>>>0>=(0|kf[W+80>>2])>>>0)break i;H=W+40|0,z=0|kf[H>>2],j=0|pl(0|z,0|kf[H+4>>2],0|J,0),0|ui((0|kf[kf[W+64>>2]>>2])+j|0,0|Y,0|z),U=U+1|0,V=0|kf[f>>2]}while(U>>>0<(((0|kf[A>>2])-V|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,k=k+1|0,(0|k)==(0|x)){F=23;break}}else F=23;while(0);if(23==(0|F)&&(F=0,ue=0|kf[g>>2]),!ue){S=1;break}P=ue}else S=1;while(0);ue=0|kf[b>>2],s=0|kf[_>>2],Ee=ue+(((s>>>0)/341|0)<<2)|0,Ce=0|kf[E>>2],Se=Ce,Te=ue,(0|Ce)==(0|ue)?(Me=0,Pe=0):(we=(0|kf[g>>2])+s|0,Me=(0|kf[ue+(((we>>>0)/341|0)<<2)>>2])+(12*((we>>>0)%341|0)|0)|0,Pe=(0|kf[Ee>>2])+(12*((s>>>0)%341|0)|0)|0),s=Ee,Ee=Pe;e:for(;;){Pe=Ee;do{if(we=Pe,(0|we)==(0|Me))break e;Pe=we+12|0}while(4092!=(Pe-(0|kf[s>>2])|0));Pe=s+4|0,s=Pe,Ee=0|kf[Pe>>2]}if(kf[g>>2]=0,g=Se-Te>>2,g>>>0>2){Te=ue;do mf(0|kf[Te>>2]),Te=(0|kf[b>>2])+4|0,kf[b>>2]=Te,Ie=0|kf[E>>2],Re=Ie-Te>>2;while(Re>>>0>2);xe=Te,Oe=Ie,ke=Re}else xe=ue,Oe=Ce,ke=g;switch(0|ke){case 1:De=170,F=105;break;case 2:De=341,F=105}if(105==(0|F)&&(kf[_>>2]=De),(0|xe)!=(0|Oe)){De=xe;do mf(0|kf[De>>2]),De=De+4|0;while((0|De)!=(0|Oe));Oe=0|kf[b>>2],b=0|kf[E>>2],(0|b)!=(0|Oe)&&(kf[E>>2]=b+(~((b+-4-Oe|0)>>>2)<<2))}return(Oe=0|kf[r>>2])?(mf(Oe),Xf=n,0|S):(Xf=n,0|S)}function jn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0;n=Xf,Xf=Xf+32|0,r=n,s=e+12|0,a=0|kf[s>>2],kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0;do if(a){if(!(a>>>0>1073741823)){h=a<<2,l=0|sl(h),kf[r>>2]=l,c=l+(a<<2)|0,kf[r+8>>2]=c,0|Bs(0|l,0,0|h),kf[o>>2]=c,d=c,u=l;break}Du(r)}else d=0,u=0;while(0);l=e+628|0,c=0|kf[l>>2],h=0|kf[c>>2],f=c+4|0,h?(a=0|kf[f>>2],(0|a)!=(0|h)&&(kf[f>>2]=a+(~((a+-4-h|0)>>>2)<<2)),mf(h),h=c+8|0,kf[h>>2]=0,kf[f>>2]=0,kf[c>>2]=0,p=0|kf[r>>2],_=0|kf[o>>2],m=0|kf[s>>2],A=h):(p=u,_=d,m=a,A=c+8|0),kf[c>>2]=p,kf[f>>2]=_,kf[A>>2]=kf[r+8>>2],kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,kf[r+8>>2]=0;do if(m){if(!(m>>>0>1073741823)){_=m<<2,f=0|sl(_),kf[r>>2]=f,p=f+(m<<2)|0,kf[r+8>>2]=p,0|Bs(0|f,0,0|_),kf[A>>2]=p,v=p,y=f;break}Du(r)}else v=0,y=0;while(0);m=e+640|0,f=0|kf[m>>2],p=0|kf[f>>2],_=f+4|0,p?(v=0|kf[_>>2],(0|v)!=(0|p)&&(kf[_>>2]=v+(~((v+-4-p|0)>>>2)<<2)),mf(p),p=f+8|0,kf[p>>2]=0,kf[_>>2]=0,kf[f>>2]=0,g=0|kf[r>>2],b=0|kf[A>>2],E=p):(g=y,b=v,E=f+8|0),kf[f>>2]=g,kf[_>>2]=b,kf[E>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,E=r+8|0,b=r+4|0,_=r+16|0,g=r+20|0,gn(r),f=0|kf[b>>2],p=(0|kf[g>>2])+(0|kf[_>>2])|0,T=(0|kf[E>>2])==(0|f)?0:(0|kf[f+(((p>>>0)/341|0)<<2)>>2])+(12*((p>>>0)%341|0)|0)|0,kf[T>>2]=t,kf[T+4>>2]=0,kf[T+8>>2]=0,T=(0|kf[g>>2])+1|0,kf[g>>2]=T;e:do if(T)for(p=e+616|0,f=i+16|0,A=i+20|0,v=i+28|0,y=e+8|0,c=i+12|0,h=e+604|0,o=e+560|0,a=e+556|0,d=e+548|0,u=e+4|0,w=e+600|0,C=e+588|0,M=e+596|0,P=T;;){if(I=0|kf[_>>2],R=P+-1|0,x=I+R|0,O=0|kf[b>>2],k=0|kf[O+(((x>>>0)/341|0)<<2)>>2],D=(x>>>0)%341|0,x=0|kf[k+(12*D|0)>>2],L=0|kf[k+(12*D|0)+4>>2],N=0|kf[k+(12*D|0)+8>>2],kf[g>>2]=R,R=0|kf[E>>2],D=R-O>>2,(1-P-I+(0==(0|D)?0:(341*D|0)+-1|0)|0)>>>0>681&&(mf(0|kf[R+-4>>2]),kf[E>>2]=(0|kf[E>>2])+-4),R=0|kf[l>>2],D=R+(12*N|0)|0,I=(0|kf[m>>2])+(12*N|0)|0,x>>>0>t>>>0){S=0;break e}if(O=0|Rl(e,x,I,L),O>>>0>=(0|kf[s>>2])>>>0){S=0;break e}L=(0|kf[e>>2])-(0|kf[(0|kf[I>>2])+(O<<2)>>2])|0;t:do if(L){if(x>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[u>>2])>>>0){S=0;break e}if(k=N+1|0,B=0|kf[l>>2],V=B+(12*k|0)|0,(0|V)==(0|D)?q=B:(Wt(V,0|kf[D>>2],0|kf[R+(12*N|0)+4>>2]),q=0|kf[l>>2]),V=(0|kf[q+(12*k|0)>>2])+(O<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<L+-1),V=31^(0|sp(0|x)))for(B=0,U=0;;){if(z=1&(0|Qa(e+16+(B<<4)|0))|U<<1,B=B+1|0,(0|B)==(0|V)){$=z;break}U=z}else $=0;U=(x>>>1)-$|0,V=x-U|0;i:do if((0|U)==(0|V))ee=U,te=U;else{B=0|kf[w>>2],z=0|kf[M>>2];do if((0|z)!=(0|kf[C>>2])){if(j=0!=(kf[z>>2]&1<<31-B|0),H=B+1|0,kf[w>>2]=H,32==(0|H)){if(kf[M>>2]=z+4,kf[w>>2]=0,j){ee=U,te=V;break i}break}if(j){ee=U,te=V;break i}break}while(0);ee=V,te=U}while(0);if(U=0|kf[m>>2],V=0|kf[U+(12*N|0)>>2],z=V+(O<<2)|0,kf[z>>2]=(0|kf[z>>2])+1,Wt(U+(12*k|0)|0,V,0|kf[U+(12*N|0)+4>>2]),0|ee&&(U=0|kf[E>>2],V=0|kf[b>>2],z=U-V>>2,B=0|kf[_>>2],j=0|kf[g>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(j+B|0)?(gn(r),ie=0|kf[_>>2],ne=0|kf[g>>2],re=0|kf[E>>2],se=0|kf[b>>2]):(ie=B,ne=j,re=U,se=V),V=ne+ie|0,ae=(0|re)==(0|se)?0:(0|kf[se+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[ae>>2]=ee,kf[ae+4>>2]=O,kf[ae+8>>2]=N,kf[g>>2]=(0|kf[g>>2])+1),!te){F=23;break}V=0|kf[E>>2],U=0|kf[b>>2],j=V-U>>2,B=0|kf[_>>2],z=0|kf[g>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(z+B|0)?(gn(r),oe=0|kf[_>>2],he=0|kf[g>>2],le=0|kf[E>>2],ce=0|kf[b>>2]):(oe=B,he=z,le=V,ce=U),U=he+oe|0,de=(0|le)==(0|ce)?0:(0|kf[ce+(((U>>>0)/341|0)<<2)>>2])+(12*((U>>>0)%341|0)|0)|0,kf[de>>2]=te,kf[de+4>>2]=O,kf[de+8>>2]=k,U=(0|kf[g>>2])+1|0,kf[g>>2]=U,ue=U;break}if(U=0|kf[p>>2],kf[U>>2]=O,V=0|kf[s>>2],V>>>0>1)for(z=V,B=O,j=1;;){if(B=(0|B)==(z+-1|0)?0:B+1|0,kf[U+(j<<2)>>2]=B,j=j+1|0,H=0|kf[s>>2],j>>>0>=H>>>0){fe=H;break}z=H}else fe=V;if(x)for(z=fe,j=0;;){if(0|z){B=0|kf[p>>2],U=0|kf[h>>2],k=0|kf[I>>2],H=0;do{G=B+(H<<2)|0,kf[U+(kf[G>>2]<<2)>>2]=0,X=0|kf[G>>2],pe=(0|kf[e>>2])-(0|kf[k+(X<<2)>>2])|0;do if(0|pe){if(_e=U+(X<<2)|0,me=0|kf[o>>2],Ae=32-me|0,(0|pe)>(0|Ae)){if(ve=0|kf[a>>2],ye=ve+4|0,(0|ye)==(0|kf[d>>2])){kf[_e>>2]=0;break}ge=kf[ve>>2]<<me,ve=pe-Ae|0,kf[o>>2]=ve,kf[a>>2]=ye,be=32-ve|0,kf[_e>>2]=(0|kf[ye>>2])>>>be|ge>>>(be-Ae|0);break}if(Ae=0|kf[a>>2],(0|Ae)==(0|kf[d>>2])){kf[_e>>2]=0;break}if(kf[_e>>2]=kf[Ae>>2]<<me>>>(32-pe|0),me=(0|kf[o>>2])+pe|0,kf[o>>2]=me,32!=(0|me))break;kf[a>>2]=Ae+4,kf[o>>2]=0}while(0);pe=0|kf[G>>2],X=U+(pe<<2)|0,kf[X>>2]=kf[X>>2]|kf[(0|kf[D>>2])+(pe<<2)>>2],H=H+1|0}while(H>>>0<(0|kf[s>>2])>>>0)}H=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|H)){U=H,k=0;do{B=U,pe=0|kf[B+(20*k|0)>>2],X=B+(20*k|0)+12|0,Ae=B+(20*k|0)+16|0,me=(0|kf[h>>2])+(kf[B+(20*k|0)+4>>2]<<2)|0,B=0|kf[X>>2];do if(4==(0|B))Ee=me;else{if(_e=0|kf[c>>2],!(0|kf[Ae>>2])){Ee=_e;break}for(Te=B,Se=_e,we=0;;){if(0|ui(0|Se,me+(we<<2)|0,0|Te),we=we+1|0,_e=0|kf[X>>2],we>>>0>=(0|kf[Ae>>2])>>>0)break;Te=_e,Se=Se+_e|0}Ee=0|kf[c>>2]}while(0);if(Ae=0|kf[v>>2],Ce=0|If[pe+84>>0]?Ae:0|kf[(0|kf[pe+68>>2])+(Ae<<2)>>2],Ce>>>0>=(0|kf[pe+80>>2])>>>0)break i;Ae=pe+40|0,X=0|kf[Ae>>2],me=0|pl(0|X,0|kf[Ae+4>>2],0|Ce,0),0|ui((0|kf[kf[pe+64>>2]>>2])+me|0,0|Ee,0|X),k=k+1|0,U=0|kf[f>>2]}while(k>>>0<(((0|kf[A>>2])-U|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,H=j+1|0,(0|H)==(0|x)){F=23;break t}z=0|kf[s>>2],j=H}else F=23}else if(x)for(k=0;;){B=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|B)){V=B,U=0;do{G=V,W=0|kf[G+(20*U|0)>>2],z=G+(20*U|0)+12|0,H=G+(20*U|0)+16|0,j=(0|kf[D>>2])+(kf[G+(20*U|0)+4>>2]<<2)|0,G=0|kf[z>>2];do if(4==(0|G))Y=j;else{if(X=0|kf[c>>2],!(0|kf[H>>2])){Y=X;break}for(Z=G,K=X,Q=0;;){if(0|ui(0|K,j+(Q<<2)|0,0|Z),Q=Q+1|0,X=0|kf[z>>2],Q>>>0>=(0|kf[H>>2])>>>0)break;Z=X,K=K+X|0}Y=0|kf[c>>2]}while(0);if(H=0|kf[v>>2],J=0|If[W+84>>0]?H:0|kf[(0|kf[W+68>>2])+(H<<2)>>2],J>>>0>=(0|kf[W+80>>2])>>>0)break i;H=W+40|0,z=0|kf[H>>2],j=0|pl(0|z,0|kf[H+4>>2],0|J,0),0|ui((0|kf[kf[W+64>>2]>>2])+j|0,0|Y,0|z),U=U+1|0,V=0|kf[f>>2]}while(U>>>0<(((0|kf[A>>2])-V|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,k=k+1|0,(0|k)==(0|x)){F=23;break}}else F=23;while(0);if(23==(0|F)&&(F=0,ue=0|kf[g>>2]),!ue){S=1;break}P=ue}else S=1;while(0);ue=0|kf[b>>2],s=0|kf[_>>2],Ee=ue+(((s>>>0)/341|0)<<2)|0,Ce=0|kf[E>>2],Se=Ce,Te=ue,(0|Ce)==(0|ue)?(Me=0,Pe=0):(we=(0|kf[g>>2])+s|0,Me=(0|kf[ue+(((we>>>0)/341|0)<<2)>>2])+(12*((we>>>0)%341|0)|0)|0,Pe=(0|kf[Ee>>2])+(12*((s>>>0)%341|0)|0)|0),s=Ee,Ee=Pe;e:for(;;){Pe=Ee;do{if(we=Pe,(0|we)==(0|Me))break e;Pe=we+12|0}while(4092!=(Pe-(0|kf[s>>2])|0));Pe=s+4|0,s=Pe,Ee=0|kf[Pe>>2]}if(kf[g>>2]=0,g=Se-Te>>2,g>>>0>2){Te=ue;do mf(0|kf[Te>>2]),Te=(0|kf[b>>2])+4|0,kf[b>>2]=Te,Ie=0|kf[E>>2],Re=Ie-Te>>2;while(Re>>>0>2);xe=Te,Oe=Ie,ke=Re}else xe=ue,Oe=Ce,ke=g;switch(0|ke){case 1:De=170,F=105;break;case 2:De=341,F=105}if(105==(0|F)&&(kf[_>>2]=De),(0|xe)!=(0|Oe)){De=xe;do mf(0|kf[De>>2]),De=De+4|0;while((0|De)!=(0|Oe));Oe=0|kf[b>>2],b=0|kf[E>>2],(0|b)!=(0|Oe)&&(kf[E>>2]=b+(~((b+-4-Oe|0)>>>2)<<2))}return(Oe=0|kf[r>>2])?(mf(Oe),Xf=n,0|S):(Xf=n,0|S)}function Yn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0;n=Xf,Xf=Xf+32|0,r=n,s=e+12|0,a=0|kf[s>>2],kf[r>>2]=0,o=r+4|0,kf[o>>2]=0,kf[r+8>>2]=0;do if(a){if(!(a>>>0>1073741823)){h=a<<2,l=0|sl(h),kf[r>>2]=l,c=l+(a<<2)|0,kf[r+8>>2]=c,0|Bs(0|l,0,0|h),kf[o>>2]=c,d=c,u=l;break}Du(r)}else d=0,u=0;while(0);l=e+628|0,c=0|kf[l>>2],h=0|kf[c>>2],f=c+4|0,h?(a=0|kf[f>>2],(0|a)!=(0|h)&&(kf[f>>2]=a+(~((a+-4-h|0)>>>2)<<2)),mf(h),h=c+8|0,kf[h>>2]=0,kf[f>>2]=0,kf[c>>2]=0,p=0|kf[r>>2],_=0|kf[o>>2],m=0|kf[s>>2],A=h):(p=u,_=d,m=a,A=c+8|0),kf[c>>2]=p,kf[f>>2]=_,kf[A>>2]=kf[r+8>>2],kf[r>>2]=0,A=r+4|0,kf[A>>2]=0,kf[r+8>>2]=0;do if(m){if(!(m>>>0>1073741823)){_=m<<2,f=0|sl(_),kf[r>>2]=f,p=f+(m<<2)|0,kf[r+8>>2]=p,0|Bs(0|f,0,0|_),kf[A>>2]=p,v=p,y=f;break}Du(r)}else v=0,y=0;while(0);m=e+640|0,f=0|kf[m>>2],p=0|kf[f>>2],_=f+4|0,p?(v=0|kf[_>>2],(0|v)!=(0|p)&&(kf[_>>2]=v+(~((v+-4-p|0)>>>2)<<2)),mf(p),p=f+8|0,kf[p>>2]=0,kf[_>>2]=0,kf[f>>2]=0,g=0|kf[r>>2],b=0|kf[A>>2],E=p):(g=y,b=v,E=f+8|0),kf[f>>2]=g,kf[_>>2]=b,kf[E>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,E=r+8|0,b=r+4|0,_=r+16|0,g=r+20|0,gn(r),f=0|kf[b>>2],p=(0|kf[g>>2])+(0|kf[_>>2])|0,T=(0|kf[E>>2])==(0|f)?0:(0|kf[f+(((p>>>0)/341|0)<<2)>>2])+(12*((p>>>0)%341|0)|0)|0,kf[T>>2]=t,kf[T+4>>2]=0,kf[T+8>>2]=0,T=(0|kf[g>>2])+1|0,kf[g>>2]=T;e:do if(T)for(p=e+616|0,f=i+16|0,A=i+20|0,v=i+28|0,y=e+8|0,c=i+12|0,h=e+604|0,o=e+560|0,a=e+556|0,d=e+548|0,u=e+4|0,w=e+600|0,C=e+588|0,M=e+596|0,P=T;;){if(I=0|kf[_>>2],R=P+-1|0,x=I+R|0,O=0|kf[b>>2],k=0|kf[O+(((x>>>0)/341|0)<<2)>>2],D=(x>>>0)%341|0,x=0|kf[k+(12*D|0)>>2],L=0|kf[k+(12*D|0)+4>>2],N=0|kf[k+(12*D|0)+8>>2],kf[g>>2]=R,R=0|kf[E>>2],D=R-O>>2,(1-P-I+(0==(0|D)?0:(341*D|0)+-1|0)|0)>>>0>681&&(mf(0|kf[R+-4>>2]),kf[E>>2]=(0|kf[E>>2])+-4),R=0|kf[l>>2],D=R+(12*N|0)|0,x>>>0>t>>>0){S=0;break e}if(I=0|kf[s>>2],O=(I+-1|0)==(0|L)?0:L+1|0,O>>>0>=I>>>0){S=0;break e}I=(0|kf[m>>2])+(12*N|0)|0,L=(0|kf[e>>2])-(0|kf[(0|kf[I>>2])+(O<<2)>>2])|0;t:do if(L){if(x>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[u>>2])>>>0){S=0;break e}if(k=N+1|0,Wt(R+(12*k|0)|0,0|kf[D>>2],0|kf[R+(12*N|0)+4>>2]),B=(0|kf[(0|kf[l>>2])+(12*k|0)>>2])+(O<<2)|0,kf[B>>2]=(0|kf[B>>2])+(1<<L+-1),B=31^(0|sp(0|x)))for(V=0,U=0;;){if(z=1&(0|Qa(e+16+(V<<4)|0))|U<<1,V=V+1|0,(0|V)==(0|B)){q=z;break}U=z}else q=0;U=(x>>>1)-q|0,B=x-U|0;i:do if((0|U)==(0|B))$=U,ee=U;else{V=0|kf[w>>2],z=0|kf[M>>2];do if((0|z)!=(0|kf[C>>2])){if(j=0!=(kf[z>>2]&1<<31-V|0),H=V+1|0,kf[w>>2]=H,32==(0|H)){if(kf[M>>2]=z+4,kf[w>>2]=0,j){$=U,ee=B;break i}break}if(j){$=U,ee=B;break i}break}while(0);$=B,ee=U}while(0);if(U=0|kf[m>>2],B=0|kf[U+(12*N|0)>>2],z=B+(O<<2)|0,kf[z>>2]=(0|kf[z>>2])+1,Wt(U+(12*k|0)|0,B,0|kf[U+(12*N|0)+4>>2]),0|$&&(U=0|kf[E>>2],B=0|kf[b>>2],z=U-B>>2,V=0|kf[_>>2],j=0|kf[g>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(j+V|0)?(gn(r),te=0|kf[_>>2],ie=0|kf[g>>2],ne=0|kf[E>>2],re=0|kf[b>>2]):(te=V,ie=j,ne=U,re=B),B=ie+te|0,se=(0|ne)==(0|re)?0:(0|kf[re+(((B>>>0)/341|0)<<2)>>2])+(12*((B>>>0)%341|0)|0)|0,kf[se>>2]=$,kf[se+4>>2]=O,kf[se+8>>2]=N,kf[g>>2]=(0|kf[g>>2])+1),!ee){F=23;break}B=0|kf[E>>2],U=0|kf[b>>2],j=B-U>>2,V=0|kf[_>>2],z=0|kf[g>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(z+V|0)?(gn(r),ae=0|kf[_>>2],oe=0|kf[g>>2],he=0|kf[E>>2],le=0|kf[b>>2]):(ae=V,oe=z,he=B,le=U),U=oe+ae|0,ce=(0|he)==(0|le)?0:(0|kf[le+(((U>>>0)/341|0)<<2)>>2])+(12*((U>>>0)%341|0)|0)|0,kf[ce>>2]=ee,kf[ce+4>>2]=O,kf[ce+8>>2]=k,U=(0|kf[g>>2])+1|0,kf[g>>2]=U,de=U;break}if(U=0|kf[p>>2],kf[U>>2]=O,B=0|kf[s>>2],B>>>0>1)for(z=B,V=O,j=1;;){if(V=(0|V)==(z+-1|0)?0:V+1|0,kf[U+(j<<2)>>2]=V,j=j+1|0,H=0|kf[s>>2],j>>>0>=H>>>0){ue=H;break}z=H}else ue=B;if(x)for(z=ue,j=0;;){if(0|z){V=0|kf[p>>2],U=0|kf[h>>2],k=0|kf[I>>2],H=0;do{G=V+(H<<2)|0,kf[U+(kf[G>>2]<<2)>>2]=0,X=0|kf[G>>2],fe=(0|kf[e>>2])-(0|kf[k+(X<<2)>>2])|0;do if(0|fe){if(pe=U+(X<<2)|0,_e=0|kf[o>>2],me=32-_e|0,(0|fe)>(0|me)){if(Ae=0|kf[a>>2],ve=Ae+4|0,(0|ve)==(0|kf[d>>2])){kf[pe>>2]=0;break}ye=kf[Ae>>2]<<_e,Ae=fe-me|0,kf[o>>2]=Ae,kf[a>>2]=ve,ge=32-Ae|0,kf[pe>>2]=(0|kf[ve>>2])>>>ge|ye>>>(ge-me|0);break}if(me=0|kf[a>>2],(0|me)==(0|kf[d>>2])){kf[pe>>2]=0;break}if(kf[pe>>2]=kf[me>>2]<<_e>>>(32-fe|0),_e=(0|kf[o>>2])+fe|0,kf[o>>2]=_e,32!=(0|_e))break;kf[a>>2]=me+4,kf[o>>2]=0}while(0);fe=0|kf[G>>2],X=U+(fe<<2)|0,kf[X>>2]=kf[X>>2]|kf[(0|kf[D>>2])+(fe<<2)>>2],H=H+1|0}while(H>>>0<(0|kf[s>>2])>>>0)}H=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|H)){U=H,k=0;do{V=U,fe=0|kf[V+(20*k|0)>>2],X=V+(20*k|0)+12|0,me=V+(20*k|0)+16|0,_e=(0|kf[h>>2])+(kf[V+(20*k|0)+4>>2]<<2)|0,V=0|kf[X>>2];do if(4==(0|V))be=_e;else{if(pe=0|kf[c>>2],!(0|kf[me>>2])){be=pe;break}for(Ee=V,Te=pe,Se=0;;){if(0|ui(0|Te,_e+(Se<<2)|0,0|Ee),Se=Se+1|0,pe=0|kf[X>>2],Se>>>0>=(0|kf[me>>2])>>>0)break;Ee=pe,Te=Te+pe|0}be=0|kf[c>>2]}while(0);if(me=0|kf[v>>2],we=0|If[fe+84>>0]?me:0|kf[(0|kf[fe+68>>2])+(me<<2)>>2],we>>>0>=(0|kf[fe+80>>2])>>>0)break i;me=fe+40|0,X=0|kf[me>>2],_e=0|pl(0|X,0|kf[me+4>>2],0|we,0),0|ui((0|kf[kf[fe+64>>2]>>2])+_e|0,0|be,0|X),k=k+1|0,U=0|kf[f>>2]}while(k>>>0<(((0|kf[A>>2])-U|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,H=j+1|0,(0|H)==(0|x)){F=23;break t}z=0|kf[s>>2],j=H}else F=23}else if(x)for(k=0;;){B=0|kf[f>>2];i:do if((0|kf[A>>2])!=(0|B)){V=B,U=0;do{G=V,W=0|kf[G+(20*U|0)>>2],
z=G+(20*U|0)+12|0,H=G+(20*U|0)+16|0,j=(0|kf[D>>2])+(kf[G+(20*U|0)+4>>2]<<2)|0,G=0|kf[z>>2];do if(4==(0|G))Y=j;else{if(X=0|kf[c>>2],!(0|kf[H>>2])){Y=X;break}for(Z=G,K=X,Q=0;;){if(0|ui(0|K,j+(Q<<2)|0,0|Z),Q=Q+1|0,X=0|kf[z>>2],Q>>>0>=(0|kf[H>>2])>>>0)break;Z=X,K=K+X|0}Y=0|kf[c>>2]}while(0);if(H=0|kf[v>>2],J=0|If[W+84>>0]?H:0|kf[(0|kf[W+68>>2])+(H<<2)>>2],J>>>0>=(0|kf[W+80>>2])>>>0)break i;H=W+40|0,z=0|kf[H>>2],j=0|pl(0|z,0|kf[H+4>>2],0|J,0),0|ui((0|kf[kf[W+64>>2]>>2])+j|0,0|Y,0|z),U=U+1|0,V=0|kf[f>>2]}while(U>>>0<(((0|kf[A>>2])-V|0)/20|0)>>>0)}while(0);if(kf[v>>2]=(0|kf[v>>2])+1,kf[y>>2]=(0|kf[y>>2])+1,k=k+1|0,(0|k)==(0|x)){F=23;break}}else F=23;while(0);if(23==(0|F)&&(F=0,de=0|kf[g>>2]),!de){S=1;break}P=de}else S=1;while(0);de=0|kf[b>>2],s=0|kf[_>>2],be=de+(((s>>>0)/341|0)<<2)|0,we=0|kf[E>>2],Te=we,Ee=de,(0|we)==(0|de)?(Ce=0,Me=0):(Se=(0|kf[g>>2])+s|0,Ce=(0|kf[de+(((Se>>>0)/341|0)<<2)>>2])+(12*((Se>>>0)%341|0)|0)|0,Me=(0|kf[be>>2])+(12*((s>>>0)%341|0)|0)|0),s=be,be=Me;e:for(;;){Me=be;do{if(Se=Me,(0|Se)==(0|Ce))break e;Me=Se+12|0}while(4092!=(Me-(0|kf[s>>2])|0));Me=s+4|0,s=Me,be=0|kf[Me>>2]}if(kf[g>>2]=0,g=Te-Ee>>2,g>>>0>2){Ee=de;do mf(0|kf[Ee>>2]),Ee=(0|kf[b>>2])+4|0,kf[b>>2]=Ee,Pe=0|kf[E>>2],Ie=Pe-Ee>>2;while(Ie>>>0>2);Re=Ee,xe=Pe,Oe=Ie}else Re=de,xe=we,Oe=g;switch(0|Oe){case 1:ke=170,F=103;break;case 2:ke=341,F=103}if(103==(0|F)&&(kf[_>>2]=ke),(0|Re)!=(0|xe)){ke=Re;do mf(0|kf[ke>>2]),ke=ke+4|0;while((0|ke)!=(0|xe));xe=0|kf[b>>2],b=0|kf[E>>2],(0|b)!=(0|xe)&&(kf[E>>2]=b+(~((b+-4-xe|0)>>>2)<<2))}return(xe=0|kf[r>>2])?(mf(xe),Xf=n,0|S):(Xf=n,0|S)}function Xn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0,De=0;n=Xf,Xf=Xf+32|0,r=n+8|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+116|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+128|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,T=r+8|0,E=r+4|0,m=r+16|0,b=r+20|0,gn(r),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+104|0,p=i+16|0,v=i+20|0,y=i+28|0,g=e+8|0,d=i+12|0,l=e+92|0,h=e+48|0,o=e+44|0,u=e+36|0,f=e+4|0,C=e+16|0,M=e+88|0,P=e+76|0,I=e+84|0,R=S;;){if(x=0|kf[m>>2],O=R+-1|0,k=x+O|0,D=0|kf[E>>2],L=0|kf[D+(((k>>>0)/341|0)<<2)>>2],N=(k>>>0)%341|0,k=0|kf[L+(12*N|0)>>2],F=0|kf[L+(12*N|0)+4>>2],B=0|kf[L+(12*N|0)+8>>2],kf[b>>2]=O,O=0|kf[T>>2],N=O-D>>2,(1-R-x+(0==(0|N)?0:(341*N|0)+-1|0)|0)>>>0>681&&(mf(0|kf[O+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),O=0|kf[c>>2],N=O+(12*B|0)|0,x=(0|kf[A>>2])+(12*B|0)|0,k>>>0>t>>>0){w=0;break e}if(D=0|Rl(e,k,x,F),D>>>0>=(0|kf[a>>2])>>>0){w=0;break e}F=(0|kf[e>>2])-(0|kf[(0|kf[x>>2])+(D<<2)>>2])|0;t:do if(F){if(k>>>0>=3){if((0|kf[g>>2])>>>0>(0|kf[f>>2])>>>0){w=0;break e}L=B+1|0,V=0|kf[c>>2],U=V+(12*L|0)|0,(0|U)==(0|N)?$=V:(Wt(U,0|kf[N>>2],0|kf[O+(12*B|0)+4>>2]),$=0|kf[c>>2]),U=(0|kf[$+(12*L|0)>>2])+(D<<2)|0,kf[U>>2]=(0|kf[U>>2])+(1<<F+-1),U=31^(0|sp(0|k)),kf[s>>2]=0,Vs(C,U,s),U=(k>>>1)-(0|kf[s>>2])|0,V=k-U|0;i:do if((0|U)==(0|V))ee=U,te=U;else{G=0|kf[M>>2],H=0|kf[I>>2];do if((0|H)!=(0|kf[P>>2])){if(Y=0!=(kf[H>>2]&1<<31-G|0),j=G+1|0,kf[M>>2]=j,32==(0|j)){if(kf[I>>2]=H+4,kf[M>>2]=0,Y){ee=U,te=V;break i}break}if(Y){ee=U,te=V;break i}break}while(0);ee=V,te=U}while(0);U=0|kf[A>>2],V=0|kf[U+(12*B|0)>>2],H=V+(D<<2)|0,kf[H>>2]=(0|kf[H>>2])+1,Wt(U+(12*L|0)|0,V,0|kf[U+(12*B|0)+4>>2]),0|ee&&(U=0|kf[T>>2],V=0|kf[E>>2],H=U-V>>2,G=0|kf[m>>2],Y=0|kf[b>>2],(0|(0==(0|H)?0:(341*H|0)+-1|0))==(Y+G|0)?(gn(r),ie=0|kf[m>>2],ne=0|kf[b>>2],re=0|kf[T>>2],se=0|kf[E>>2]):(ie=G,ne=Y,re=U,se=V),V=ne+ie|0,ae=(0|re)==(0|se)?0:(0|kf[se+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[ae>>2]=ee,kf[ae+4>>2]=D,kf[ae+8>>2]=B,kf[b>>2]=(0|kf[b>>2])+1),0|te&&(V=0|kf[T>>2],U=0|kf[E>>2],Y=V-U>>2,G=0|kf[m>>2],H=0|kf[b>>2],(0|(0==(0|Y)?0:(341*Y|0)+-1|0))==(H+G|0)?(gn(r),oe=0|kf[m>>2],he=0|kf[b>>2],le=0|kf[T>>2],ce=0|kf[E>>2]):(oe=G,he=H,le=V,ce=U),U=he+oe|0,de=(0|le)==(0|ce)?0:(0|kf[ce+(((U>>>0)/341|0)<<2)>>2])+(12*((U>>>0)%341|0)|0)|0,kf[de>>2]=te,kf[de+4>>2]=D,kf[de+8>>2]=L,kf[b>>2]=(0|kf[b>>2])+1);break}if(U=0|kf[_>>2],kf[U>>2]=D,V=0|kf[a>>2],V>>>0>1)for(H=V,G=D,Y=1;;){if(G=(0|G)==(H+-1|0)?0:G+1|0,kf[U+(Y<<2)>>2]=G,Y=Y+1|0,j=0|kf[a>>2],Y>>>0>=j>>>0){ue=j;break}H=j}else ue=V;if(0|k)for(H=ue,Y=0;;){if(0|H){G=0|kf[_>>2],U=0|kf[l>>2],L=0|kf[x>>2],j=0;do{W=G+(j<<2)|0,kf[U+(kf[W>>2]<<2)>>2]=0,Z=0|kf[W>>2],fe=(0|kf[e>>2])-(0|kf[L+(Z<<2)>>2])|0;do if(0|fe){if(pe=U+(Z<<2)|0,_e=0|kf[h>>2],me=32-_e|0,(0|fe)>(0|me)){if(Ae=0|kf[o>>2],ve=Ae+4|0,(0|ve)==(0|kf[u>>2])){kf[pe>>2]=0;break}ye=kf[Ae>>2]<<_e,Ae=fe-me|0,kf[h>>2]=Ae,kf[o>>2]=ve,ge=32-Ae|0,kf[pe>>2]=(0|kf[ve>>2])>>>ge|ye>>>(ge-me|0);break}if(me=0|kf[o>>2],(0|me)==(0|kf[u>>2])){kf[pe>>2]=0;break}if(kf[pe>>2]=kf[me>>2]<<_e>>>(32-fe|0),_e=(0|kf[h>>2])+fe|0,kf[h>>2]=_e,32!=(0|_e))break;kf[o>>2]=me+4,kf[h>>2]=0}while(0);fe=0|kf[W>>2],Z=U+(fe<<2)|0,kf[Z>>2]=kf[Z>>2]|kf[(0|kf[N>>2])+(fe<<2)>>2],j=j+1|0}while(j>>>0<(0|kf[a>>2])>>>0)}j=0|kf[p>>2];i:do if((0|kf[v>>2])!=(0|j)){U=j,L=0;do{G=U,fe=0|kf[G+(20*L|0)>>2],Z=G+(20*L|0)+12|0,me=G+(20*L|0)+16|0,_e=(0|kf[l>>2])+(kf[G+(20*L|0)+4>>2]<<2)|0,G=0|kf[Z>>2];do if(4==(0|G))be=_e;else{if(pe=0|kf[d>>2],!(0|kf[me>>2])){be=pe;break}for(Ee=G,Te=pe,Se=0;;){if(0|ui(0|Te,_e+(Se<<2)|0,0|Ee),Se=Se+1|0,pe=0|kf[Z>>2],Se>>>0>=(0|kf[me>>2])>>>0)break;Ee=pe,Te=Te+pe|0}be=0|kf[d>>2]}while(0);if(me=0|kf[y>>2],we=0|If[fe+84>>0]?me:0|kf[(0|kf[fe+68>>2])+(me<<2)>>2],we>>>0>=(0|kf[fe+80>>2])>>>0)break i;me=fe+40|0,Z=0|kf[me>>2],_e=0|pl(0|Z,0|kf[me+4>>2],0|we,0),0|ui((0|kf[kf[fe+64>>2]>>2])+_e|0,0|be,0|Z),L=L+1|0,U=0|kf[p>>2]}while(L>>>0<(((0|kf[v>>2])-U|0)/20|0)>>>0)}while(0);if(kf[y>>2]=(0|kf[y>>2])+1,kf[g>>2]=(0|kf[g>>2])+1,j=Y+1|0,(0|j)==(0|k))break t;H=0|kf[a>>2],Y=j}}else if(0|k){L=0;do{V=0|kf[p>>2];i:do if((0|kf[v>>2])!=(0|V)){U=V,G=0;do{W=U,z=0|kf[W+(20*G|0)>>2],H=W+(20*G|0)+12|0,j=W+(20*G|0)+16|0,Y=(0|kf[N>>2])+(kf[W+(20*G|0)+4>>2]<<2)|0,W=0|kf[H>>2];do if(4==(0|W))X=Y;else{if(Z=0|kf[d>>2],!(0|kf[j>>2])){X=Z;break}for(K=W,Q=Z,J=0;;){if(0|ui(0|Q,Y+(J<<2)|0,0|K),J=J+1|0,Z=0|kf[H>>2],J>>>0>=(0|kf[j>>2])>>>0)break;K=Z,Q=Q+Z|0}X=0|kf[d>>2]}while(0);if(j=0|kf[y>>2],q=0|If[z+84>>0]?j:0|kf[(0|kf[z+68>>2])+(j<<2)>>2],q>>>0>=(0|kf[z+80>>2])>>>0)break i;j=z+40|0,H=0|kf[j>>2],Y=0|pl(0|H,0|kf[j+4>>2],0|q,0),0|ui((0|kf[kf[z+64>>2]>>2])+Y|0,0|X,0|H),G=G+1|0,U=0|kf[p>>2]}while(G>>>0<(((0|kf[v>>2])-U|0)/20|0)>>>0)}while(0);kf[y>>2]=(0|kf[y>>2])+1,kf[g>>2]=(0|kf[g>>2])+1,L=L+1|0}while((0|L)!=(0|k))}while(0);if(R=0|kf[b>>2],!R){w=1;break}}else w=1;while(0);a=0|kf[E>>2],be=0|kf[m>>2],we=a+(((be>>>0)/341|0)<<2)|0,Te=0|kf[T>>2],Ee=Te,Se=a,(0|Te)==(0|a)?(Ce=0,Me=0):(e=(0|kf[b>>2])+be|0,Ce=(0|kf[a+(((e>>>0)/341|0)<<2)>>2])+(12*((e>>>0)%341|0)|0)|0,Me=(0|kf[we>>2])+(12*((be>>>0)%341|0)|0)|0),be=we,we=Me;e:for(;;){Me=we;do{if(e=Me,(0|e)==(0|Ce))break e;Me=e+12|0}while(4092!=(Me-(0|kf[be>>2])|0));Me=be+4|0,be=Me,we=0|kf[Me>>2]}if(kf[b>>2]=0,b=Ee-Se>>2,b>>>0>2){Se=a;do mf(0|kf[Se>>2]),Se=(0|kf[E>>2])+4|0,kf[E>>2]=Se,Pe=0|kf[T>>2],Ie=Pe-Se>>2;while(Ie>>>0>2);Re=Se,xe=Pe,Oe=Ie}else Re=a,xe=Te,Oe=b;switch(0|Oe){case 1:ke=170,De=103;break;case 2:ke=341,De=103}if(103==(0|De)&&(kf[m>>2]=ke),(0|Re)!=(0|xe)){ke=Re;do mf(0|kf[ke>>2]),ke=ke+4|0;while((0|ke)!=(0|xe));xe=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|xe)&&(kf[T>>2]=E+(~((E+-4-xe|0)>>>2)<<2))}return(xe=0|kf[r>>2])?(mf(xe),Xf=n,0|w):(Xf=n,0|w)}function Zn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0,Ie=0,Re=0,xe=0,Oe=0,ke=0;n=Xf,Xf=Xf+32|0,r=n+8|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+116|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+128|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,kf[r+16>>2]=0,kf[r+20>>2]=0,T=r+8|0,E=r+4|0,m=r+16|0,b=r+20|0,gn(r),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+104|0,p=i+16|0,v=i+20|0,y=i+28|0,g=e+8|0,d=i+12|0,l=e+92|0,h=e+48|0,o=e+44|0,u=e+36|0,f=e+4|0,C=e+16|0,M=e+88|0,P=e+76|0,I=e+84|0,R=S;;){if(x=0|kf[m>>2],O=R+-1|0,k=x+O|0,D=0|kf[E>>2],L=0|kf[D+(((k>>>0)/341|0)<<2)>>2],N=(k>>>0)%341|0,k=0|kf[L+(12*N|0)>>2],F=0|kf[L+(12*N|0)+4>>2],B=0|kf[L+(12*N|0)+8>>2],kf[b>>2]=O,O=0|kf[T>>2],N=O-D>>2,(1-R-x+(0==(0|N)?0:(341*N|0)+-1|0)|0)>>>0>681&&(mf(0|kf[O+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),O=0|kf[c>>2],N=O+(12*B|0)|0,k>>>0>t>>>0){w=0;break e}if(x=0|kf[a>>2],D=(x+-1|0)==(0|F)?0:F+1|0,D>>>0>=x>>>0){w=0;break e}x=(0|kf[A>>2])+(12*B|0)|0,F=(0|kf[e>>2])-(0|kf[(0|kf[x>>2])+(D<<2)>>2])|0;t:do if(F){if(k>>>0>=3){if((0|kf[g>>2])>>>0>(0|kf[f>>2])>>>0){w=0;break e}L=B+1|0,Wt(O+(12*L|0)|0,0|kf[N>>2],0|kf[O+(12*B|0)+4>>2]),V=(0|kf[(0|kf[c>>2])+(12*L|0)>>2])+(D<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<F+-1),V=31^(0|sp(0|k)),kf[s>>2]=0,Vs(C,V,s),V=(k>>>1)-(0|kf[s>>2])|0,U=k-V|0;i:do if((0|V)==(0|U))$=V,ee=V;else{G=0|kf[M>>2],H=0|kf[I>>2];do if((0|H)!=(0|kf[P>>2])){if(Y=0!=(kf[H>>2]&1<<31-G|0),j=G+1|0,kf[M>>2]=j,32==(0|j)){if(kf[I>>2]=H+4,kf[M>>2]=0,Y){$=V,ee=U;break i}break}if(Y){$=V,ee=U;break i}break}while(0);$=U,ee=V}while(0);V=0|kf[A>>2],U=0|kf[V+(12*B|0)>>2],H=U+(D<<2)|0,kf[H>>2]=(0|kf[H>>2])+1,Wt(V+(12*L|0)|0,U,0|kf[V+(12*B|0)+4>>2]),0|$&&(V=0|kf[T>>2],U=0|kf[E>>2],H=V-U>>2,G=0|kf[m>>2],Y=0|kf[b>>2],(0|(0==(0|H)?0:(341*H|0)+-1|0))==(Y+G|0)?(gn(r),te=0|kf[m>>2],ie=0|kf[b>>2],ne=0|kf[T>>2],re=0|kf[E>>2]):(te=G,ie=Y,ne=V,re=U),U=ie+te|0,se=(0|ne)==(0|re)?0:(0|kf[re+(((U>>>0)/341|0)<<2)>>2])+(12*((U>>>0)%341|0)|0)|0,kf[se>>2]=$,kf[se+4>>2]=D,kf[se+8>>2]=B,kf[b>>2]=(0|kf[b>>2])+1),0|ee&&(U=0|kf[T>>2],V=0|kf[E>>2],Y=U-V>>2,G=0|kf[m>>2],H=0|kf[b>>2],(0|(0==(0|Y)?0:(341*Y|0)+-1|0))==(H+G|0)?(gn(r),ae=0|kf[m>>2],oe=0|kf[b>>2],he=0|kf[T>>2],le=0|kf[E>>2]):(ae=G,oe=H,he=U,le=V),V=oe+ae|0,ce=(0|he)==(0|le)?0:(0|kf[le+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[ce>>2]=ee,kf[ce+4>>2]=D,kf[ce+8>>2]=L,kf[b>>2]=(0|kf[b>>2])+1);break}if(V=0|kf[_>>2],kf[V>>2]=D,U=0|kf[a>>2],U>>>0>1)for(H=U,G=D,Y=1;;){if(G=(0|G)==(H+-1|0)?0:G+1|0,kf[V+(Y<<2)>>2]=G,Y=Y+1|0,j=0|kf[a>>2],Y>>>0>=j>>>0){de=j;break}H=j}else de=U;if(0|k)for(H=de,Y=0;;){if(0|H){G=0|kf[_>>2],V=0|kf[l>>2],L=0|kf[x>>2],j=0;do{W=G+(j<<2)|0,kf[V+(kf[W>>2]<<2)>>2]=0,Z=0|kf[W>>2],ue=(0|kf[e>>2])-(0|kf[L+(Z<<2)>>2])|0;do if(0|ue){if(fe=V+(Z<<2)|0,pe=0|kf[h>>2],_e=32-pe|0,(0|ue)>(0|_e)){if(me=0|kf[o>>2],Ae=me+4|0,(0|Ae)==(0|kf[u>>2])){kf[fe>>2]=0;break}ve=kf[me>>2]<<pe,me=ue-_e|0,kf[h>>2]=me,kf[o>>2]=Ae,ye=32-me|0,kf[fe>>2]=(0|kf[Ae>>2])>>>ye|ve>>>(ye-_e|0);break}if(_e=0|kf[o>>2],(0|_e)==(0|kf[u>>2])){kf[fe>>2]=0;break}if(kf[fe>>2]=kf[_e>>2]<<pe>>>(32-ue|0),pe=(0|kf[h>>2])+ue|0,kf[h>>2]=pe,32!=(0|pe))break;kf[o>>2]=_e+4,kf[h>>2]=0}while(0);ue=0|kf[W>>2],Z=V+(ue<<2)|0,kf[Z>>2]=kf[Z>>2]|kf[(0|kf[N>>2])+(ue<<2)>>2],j=j+1|0}while(j>>>0<(0|kf[a>>2])>>>0)}j=0|kf[p>>2];i:do if((0|kf[v>>2])!=(0|j)){V=j,L=0;do{G=V,ue=0|kf[G+(20*L|0)>>2],Z=G+(20*L|0)+12|0,_e=G+(20*L|0)+16|0,pe=(0|kf[l>>2])+(kf[G+(20*L|0)+4>>2]<<2)|0,G=0|kf[Z>>2];do if(4==(0|G))ge=pe;else{if(fe=0|kf[d>>2],!(0|kf[_e>>2])){ge=fe;break}for(be=G,Ee=fe,Te=0;;){if(0|ui(0|Ee,pe+(Te<<2)|0,0|be),Te=Te+1|0,fe=0|kf[Z>>2],Te>>>0>=(0|kf[_e>>2])>>>0)break;be=fe,Ee=Ee+fe|0}ge=0|kf[d>>2]}while(0);if(_e=0|kf[y>>2],Se=0|If[ue+84>>0]?_e:0|kf[(0|kf[ue+68>>2])+(_e<<2)>>2],Se>>>0>=(0|kf[ue+80>>2])>>>0)break i;_e=ue+40|0,Z=0|kf[_e>>2],pe=0|pl(0|Z,0|kf[_e+4>>2],0|Se,0),0|ui((0|kf[kf[ue+64>>2]>>2])+pe|0,0|ge,0|Z),L=L+1|0,V=0|kf[p>>2]}while(L>>>0<(((0|kf[v>>2])-V|0)/20|0)>>>0)}while(0);if(kf[y>>2]=(0|kf[y>>2])+1,kf[g>>2]=(0|kf[g>>2])+1,j=Y+1|0,(0|j)==(0|k))break t;H=0|kf[a>>2],Y=j}}else if(0|k){L=0;do{V=0|kf[p>>2];i:do if((0|kf[v>>2])!=(0|V)){U=V,G=0;do{W=U,z=0|kf[W+(20*G|0)>>2],H=W+(20*G|0)+12|0,j=W+(20*G|0)+16|0,Y=(0|kf[N>>2])+(kf[W+(20*G|0)+4>>2]<<2)|0,W=0|kf[H>>2];do if(4==(0|W))X=Y;else{if(Z=0|kf[d>>2],!(0|kf[j>>2])){X=Z;break}for(K=W,Q=Z,J=0;;){if(0|ui(0|Q,Y+(J<<2)|0,0|K),J=J+1|0,Z=0|kf[H>>2],J>>>0>=(0|kf[j>>2])>>>0)break;K=Z,Q=Q+Z|0}X=0|kf[d>>2]}while(0);if(j=0|kf[y>>2],q=0|If[z+84>>0]?j:0|kf[(0|kf[z+68>>2])+(j<<2)>>2],q>>>0>=(0|kf[z+80>>2])>>>0)break i;j=z+40|0,H=0|kf[j>>2],Y=0|pl(0|H,0|kf[j+4>>2],0|q,0),0|ui((0|kf[kf[z+64>>2]>>2])+Y|0,0|X,0|H),G=G+1|0,U=0|kf[p>>2]}while(G>>>0<(((0|kf[v>>2])-U|0)/20|0)>>>0)}while(0);kf[y>>2]=(0|kf[y>>2])+1,kf[g>>2]=(0|kf[g>>2])+1,L=L+1|0}while((0|L)!=(0|k))}while(0);if(R=0|kf[b>>2],!R){w=1;break}}else w=1;while(0);a=0|kf[E>>2],ge=0|kf[m>>2],Se=a+(((ge>>>0)/341|0)<<2)|0,Ee=0|kf[T>>2],be=Ee,Te=a,(0|Ee)==(0|a)?(we=0,Ce=0):(e=(0|kf[b>>2])+ge|0,we=(0|kf[a+(((e>>>0)/341|0)<<2)>>2])+(12*((e>>>0)%341|0)|0)|0,Ce=(0|kf[Se>>2])+(12*((ge>>>0)%341|0)|0)|0),ge=Se,Se=Ce;e:for(;;){Ce=Se;do{if(e=Ce,(0|e)==(0|we))break e;Ce=e+12|0}while(4092!=(Ce-(0|kf[ge>>2])|0));Ce=ge+4|0,ge=Ce,Se=0|kf[Ce>>2]}if(kf[b>>2]=0,b=be-Te>>2,b>>>0>2){Te=a;do mf(0|kf[Te>>2]),Te=(0|kf[E>>2])+4|0,kf[E>>2]=Te,Me=0|kf[T>>2],Pe=Me-Te>>2;while(Pe>>>0>2);Ie=Te,Re=Me,xe=Pe}else Ie=a,Re=Ee,xe=b;switch(0|xe){case 1:Oe=170,ke=101;break;case 2:Oe=341,ke=101}if(101==(0|ke)&&(kf[m>>2]=Oe),(0|Ie)!=(0|Re)){Oe=Ie;do mf(0|kf[Oe>>2]),Oe=Oe+4|0;while((0|Oe)!=(0|Re));Re=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|Re)&&(kf[T>>2]=E+(~((E+-4-Re|0)>>>2)<<2))}return(Re=0|kf[r>>2])?(mf(Re),Xf=n,0|w):(Xf=n,0|w)}function Kn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0,Pe=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+120|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+132|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+108|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+96|0,d=e+52|0,l=e+48|0,h=e+40|0,o=e+4|0,u=e+32|0,f=e+28|0,C=e+20|0,M=e+92|0,P=e+80|0,I=e+88|0,R=r+4|0,x=r+8|0,O=S;;){if(k=0|kf[m>>2],D=O+-1|0,L=k+D|0,N=0|kf[E>>2],F=0|kf[N+(((L>>>0)/341|0)<<2)>>2],B=(L>>>0)%341|0,L=0|kf[F+(12*B|0)>>2],V=0|kf[F+(12*B|0)+4>>2],U=0|kf[F+(12*B|0)+8>>2],kf[b>>2]=D,D=0|kf[T>>2],B=D-N>>2,(1-O-k+(0==(0|B)?0:(341*B|0)+-1|0)|0)>>>0>681&&(mf(0|kf[D+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),D=0|kf[c>>2],B=D+(12*U|0)|0,k=(0|kf[A>>2])+(12*U|0)|0,L>>>0>t>>>0){w=0;break e}if(N=0|Rl(e,L,k,V),N>>>0>=(0|kf[a>>2])>>>0){w=0;break e}V=(0|kf[e>>2])-(0|kf[(0|kf[k>>2])+(N<<2)>>2])|0;t:do if(V){if(L>>>0<3){if(F=0|kf[_>>2],kf[F>>2]=N,W=0|kf[a>>2],W>>>0>1)for(j=W,H=N,z=1;;){if(H=(0|H)==(j+-1|0)?0:H+1|0,kf[F+(z<<2)>>2]=H,z=z+1|0,Y=0|kf[a>>2],z>>>0>=Y>>>0){X=Y;break}j=Y}else X=W;if(!L){G=23;break}for(j=X,z=0;;){if(j){H=0|kf[_>>2],F=0|kf[g>>2],Y=0|kf[k>>2],K=0;do{Q=H+(K<<2)|0,kf[F+(kf[Q>>2]<<2)>>2]=0,J=0|kf[Q>>2],q=(0|kf[e>>2])-(0|kf[Y+(J<<2)>>2])|0;do if(0|q){if($=F+(J<<2)|0,ee=0|kf[d>>2],te=32-ee|0,(0|q)>(0|te)){if(ie=0|kf[l>>2],ne=ie+4|0,(0|ne)==(0|kf[h>>2])){kf[$>>2]=0;break}re=kf[ie>>2]<<ee,ie=q-te|0,kf[d>>2]=ie,kf[l>>2]=ne,se=32-ie|0,kf[$>>2]=(0|kf[ne>>2])>>>se|re>>>(se-te|0);break}if(te=0|kf[l>>2],(0|te)==(0|kf[h>>2])){kf[$>>2]=0;break}if(kf[$>>2]=kf[te>>2]<<ee>>>(32-q|0),ee=(0|kf[d>>2])+q|0,kf[d>>2]=ee,32!=(0|ee))break;kf[l>>2]=te+4,kf[d>>2]=0}while(0);q=0|kf[Q>>2],J=F+(q<<2)|0,kf[J>>2]=kf[J>>2]|kf[(0|kf[B>>2])+(q<<2)>>2],K=K+1|0}while(K>>>0<(0|kf[a>>2])>>>0);Z=F}else Z=0|kf[g>>2];if(F=0|kf[Z>>2],kf[r>>2]=F,kf[p>>2]=kf[Z+4>>2],kf[v>>2]=kf[Z+8>>2],K=0|kf[i>>2],Y=K+4|0,H=0|kf[Y>>2],H>>>0<(0|kf[K+8>>2])>>>0?(kf[H>>2]=F,kf[H+4>>2]=kf[p>>2],kf[H+8>>2]=kf[v>>2],kf[Y>>2]=H+12):Ai(K,r),kf[y>>2]=(0|kf[y>>2])+1,K=z+1|0,K>>>0>=L>>>0){G=23;break t}j=0|kf[a>>2],z=K}}if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}z=U+1|0,j=0|kf[c>>2],W=j+(12*z|0)|0,(0|W)==(0|B)?ae=j:(Wt(W,0|kf[B>>2],0|kf[D+(12*U|0)+4>>2]),ae=0|kf[c>>2]),W=(0|kf[ae+(12*z|0)>>2])+(N<<2)|0,kf[W>>2]=(0|kf[W>>2])+(1<<V+-1),W=31^(0|sp(0|L)),j=0|kf[u>>2],K=32-j|0,(0|W)>(0|K)?(H=0|kf[f>>2],Y=H+4|0,(0|Y)==(0|kf[C>>2])?oe=0:(F=kf[H>>2]<<j,H=W-K|0,kf[u>>2]=H,kf[f>>2]=Y,q=32-H|0,oe=(0|kf[Y>>2])>>>q|F>>>(q-K|0))):(K=0|kf[f>>2],(0|K)!=(0|kf[C>>2])?(q=kf[K>>2]<<j>>>(32-W|0),F=j+W|0,kf[u>>2]=F,32==(0|F)?(kf[f>>2]=K+4,kf[u>>2]=0,oe=q):oe=q):oe=0),q=(L>>>1)-oe|0,K=L-q|0;i:do if((0|q)==(0|K))he=q,le=q;else{F=0|kf[M>>2],W=0|kf[I>>2];do if((0|W)!=(0|kf[P>>2])){if(j=0!=(kf[W>>2]&1<<31-F|0),Y=F+1|0,kf[M>>2]=Y,32==(0|Y)){if(kf[I>>2]=W+4,kf[M>>2]=0,j){he=q,le=K;break i}break}if(j){he=q,le=K;break i}break}while(0);he=K,le=q}while(0);q=0|kf[A>>2],K=0|kf[q+(12*U|0)>>2],W=K+(N<<2)|0,kf[W>>2]=(0|kf[W>>2])+1,Wt(q+(12*z|0)|0,K,0|kf[q+(12*U|0)+4>>2]),0|he&&(q=0|kf[T>>2],K=0|kf[E>>2],W=q-K>>2,F=0|kf[m>>2],j=0|kf[b>>2],(0|(0==(0|W)?0:(341*W|0)+-1|0))==(j+F|0)?(gn(s),ce=0|kf[m>>2],de=0|kf[b>>2],ue=0|kf[T>>2],fe=0|kf[E>>2]):(ce=F,de=j,ue=q,fe=K),K=de+ce|0,pe=(0|ue)==(0|fe)?0:(0|kf[fe+(((K>>>0)/341|0)<<2)>>2])+(12*((K>>>0)%341|0)|0)|0,kf[pe>>2]=he,kf[pe+4>>2]=N,kf[pe+8>>2]=U,kf[b>>2]=(0|kf[b>>2])+1),le?(K=0|kf[T>>2],q=0|kf[E>>2],j=K-q>>2,F=0|kf[m>>2],W=0|kf[b>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(W+F|0)?(gn(s),_e=0|kf[m>>2],me=0|kf[b>>2],Ae=0|kf[T>>2],ve=0|kf[E>>2]):(_e=F,me=W,Ae=K,ve=q),q=me+_e|0,ye=(0|Ae)==(0|ve)?0:(0|kf[ve+(((q>>>0)/341|0)<<2)>>2])+(12*((q>>>0)%341|0)|0)|0,kf[ye>>2]=le,kf[ye+4>>2]=N,kf[ye+8>>2]=z,q=(0|kf[b>>2])+1|0,kf[b>>2]=q,ge=q):G=23}else if(L){F=0;do W=0|kf[B>>2],z=0|kf[W>>2],kf[r>>2]=z,kf[R>>2]=kf[W+4>>2],kf[x>>2]=kf[W+8>>2],W=0|kf[i>>2],H=W+4|0,j=0|kf[H>>2],j>>>0<(0|kf[W+8>>2])>>>0?(kf[j>>2]=z,kf[j+4>>2]=kf[R>>2],kf[j+8>>2]=kf[x>>2],kf[H>>2]=j+12):Ai(W,r),kf[y>>2]=(0|kf[y>>2])+1,F=F+1|0;while(F>>>0<L>>>0);G=23}else G=23;while(0);if(23==(0|G)&&(G=0,ge=0|kf[b>>2]),!ge){w=1;break}O=ge}else w=1;while(0);ge=0|kf[E>>2],ye=0|kf[m>>2],le=ge+(((ye>>>0)/341|0)<<2)|0,ve=0|kf[T>>2],Ae=ve,_e=ge,(0|ve)==(0|ge)?(be=0,Ee=0):(me=(0|kf[b>>2])+ye|0,be=(0|kf[ge+(((me>>>0)/341|0)<<2)>>2])+(12*((me>>>0)%341|0)|0)|0,Ee=(0|kf[le>>2])+(12*((ye>>>0)%341|0)|0)|0),ye=le,le=Ee;e:for(;;){Ee=le;do{if(me=Ee,(0|me)==(0|be))break e;Ee=me+12|0}while(4092!=(Ee-(0|kf[ye>>2])|0));Ee=ye+4|0,ye=Ee,le=0|kf[Ee>>2]}if(kf[b>>2]=0,b=Ae-_e>>2,b>>>0>2){_e=ge;do mf(0|kf[_e>>2]),_e=(0|kf[E>>2])+4|0,kf[E>>2]=_e,Te=0|kf[T>>2],Se=Te-_e>>2;while(Se>>>0>2);we=_e,Ce=Te,Me=Se}else we=ge,Ce=ve,Me=b;switch(0|Me){case 1:Pe=170,G=98;break;case 2:Pe=341,G=98}if(98==(0|G)&&(kf[m>>2]=Pe),(0|we)!=(0|Ce)){Pe=we;do mf(0|kf[Pe>>2]),Pe=Pe+4|0;while((0|Pe)!=(0|Ce));Ce=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|Ce)&&(kf[T>>2]=E+(~((E+-4-Ce|0)>>>2)<<2))}return(Ce=0|kf[s>>2])?(mf(Ce),Xf=n,0|w):(Xf=n,0|w)}function Qn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0,Ce=0,Me=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+120|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+132|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+108|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+96|0,d=e+52|0,l=e+48|0,h=e+40|0,o=e+4|0,u=e+32|0,f=e+28|0,C=e+20|0,M=e+92|0,P=e+80|0,I=e+88|0,R=r+4|0,x=r+8|0,O=S;;){if(k=0|kf[m>>2],D=O+-1|0,L=k+D|0,N=0|kf[E>>2],F=0|kf[N+(((L>>>0)/341|0)<<2)>>2],B=(L>>>0)%341|0,L=0|kf[F+(12*B|0)>>2],V=0|kf[F+(12*B|0)+4>>2],U=0|kf[F+(12*B|0)+8>>2],kf[b>>2]=D,D=0|kf[T>>2],B=D-N>>2,(1-O-k+(0==(0|B)?0:(341*B|0)+-1|0)|0)>>>0>681&&(mf(0|kf[D+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),D=0|kf[c>>2],B=D+(12*U|0)|0,L>>>0>t>>>0){w=0;break e}if(k=0|kf[a>>2],N=(k+-1|0)==(0|V)?0:V+1|0,N>>>0>=k>>>0){w=0;break e}k=(0|kf[A>>2])+(12*U|0)|0,V=(0|kf[e>>2])-(0|kf[(0|kf[k>>2])+(N<<2)>>2])|0;t:do if(V){if(L>>>0<3){if(F=0|kf[_>>2],kf[F>>2]=N,W=0|kf[a>>2],W>>>0>1)for(j=W,H=N,z=1;;){if(H=(0|H)==(j+-1|0)?0:H+1|0,kf[F+(z<<2)>>2]=H,z=z+1|0,Y=0|kf[a>>2],z>>>0>=Y>>>0){X=Y;break}j=Y}else X=W;if(!L){G=23;break}for(j=X,z=0;;){if(j){H=0|kf[_>>2],F=0|kf[g>>2],Y=0|kf[k>>2],K=0;do{Q=H+(K<<2)|0,kf[F+(kf[Q>>2]<<2)>>2]=0,J=0|kf[Q>>2],q=(0|kf[e>>2])-(0|kf[Y+(J<<2)>>2])|0;do if(0|q){if($=F+(J<<2)|0,ee=0|kf[d>>2],te=32-ee|0,(0|q)>(0|te)){if(ie=0|kf[l>>2],ne=ie+4|0,(0|ne)==(0|kf[h>>2])){kf[$>>2]=0;break}re=kf[ie>>2]<<ee,ie=q-te|0,kf[d>>2]=ie,kf[l>>2]=ne,se=32-ie|0,kf[$>>2]=(0|kf[ne>>2])>>>se|re>>>(se-te|0);break}if(te=0|kf[l>>2],(0|te)==(0|kf[h>>2])){kf[$>>2]=0;break}if(kf[$>>2]=kf[te>>2]<<ee>>>(32-q|0),ee=(0|kf[d>>2])+q|0,kf[d>>2]=ee,32!=(0|ee))break;kf[l>>2]=te+4,kf[d>>2]=0}while(0);q=0|kf[Q>>2],J=F+(q<<2)|0,kf[J>>2]=kf[J>>2]|kf[(0|kf[B>>2])+(q<<2)>>2],K=K+1|0}while(K>>>0<(0|kf[a>>2])>>>0);Z=F}else Z=0|kf[g>>2];if(F=0|kf[Z>>2],kf[r>>2]=F,kf[p>>2]=kf[Z+4>>2],kf[v>>2]=kf[Z+8>>2],K=0|kf[i>>2],Y=K+4|0,H=0|kf[Y>>2],H>>>0<(0|kf[K+8>>2])>>>0?(kf[H>>2]=F,kf[H+4>>2]=kf[p>>2],kf[H+8>>2]=kf[v>>2],kf[Y>>2]=H+12):Ai(K,r),kf[y>>2]=(0|kf[y>>2])+1,K=z+1|0,K>>>0>=L>>>0){G=23;break t}j=0|kf[a>>2],z=K}}if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}z=U+1|0,Wt(D+(12*z|0)|0,0|kf[B>>2],0|kf[D+(12*U|0)+4>>2]),j=(0|kf[(0|kf[c>>2])+(12*z|0)>>2])+(N<<2)|0,kf[j>>2]=(0|kf[j>>2])+(1<<V+-1),j=31^(0|sp(0|L)),W=0|kf[u>>2],K=32-W|0,(0|j)>(0|K)?(H=0|kf[f>>2],Y=H+4|0,(0|Y)==(0|kf[C>>2])?ae=0:(F=kf[H>>2]<<W,H=j-K|0,kf[u>>2]=H,kf[f>>2]=Y,q=32-H|0,ae=(0|kf[Y>>2])>>>q|F>>>(q-K|0))):(K=0|kf[f>>2],(0|K)!=(0|kf[C>>2])?(q=kf[K>>2]<<W>>>(32-j|0),F=W+j|0,kf[u>>2]=F,32==(0|F)?(kf[f>>2]=K+4,kf[u>>2]=0,ae=q):ae=q):ae=0),q=(L>>>1)-ae|0,K=L-q|0;i:do if((0|q)==(0|K))oe=q,he=q;else{F=0|kf[M>>2],j=0|kf[I>>2];do if((0|j)!=(0|kf[P>>2])){if(W=0!=(kf[j>>2]&1<<31-F|0),Y=F+1|0,kf[M>>2]=Y,32==(0|Y)){if(kf[I>>2]=j+4,kf[M>>2]=0,W){oe=q,he=K;break i}break}if(W){oe=q,he=K;break i}break}while(0);oe=K,he=q}while(0);q=0|kf[A>>2],K=0|kf[q+(12*U|0)>>2],j=K+(N<<2)|0,kf[j>>2]=(0|kf[j>>2])+1,Wt(q+(12*z|0)|0,K,0|kf[q+(12*U|0)+4>>2]),0|oe&&(q=0|kf[T>>2],K=0|kf[E>>2],j=q-K>>2,F=0|kf[m>>2],W=0|kf[b>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(W+F|0)?(gn(s),le=0|kf[m>>2],ce=0|kf[b>>2],de=0|kf[T>>2],ue=0|kf[E>>2]):(le=F,ce=W,de=q,ue=K),K=ce+le|0,fe=(0|de)==(0|ue)?0:(0|kf[ue+(((K>>>0)/341|0)<<2)>>2])+(12*((K>>>0)%341|0)|0)|0,kf[fe>>2]=oe,kf[fe+4>>2]=N,kf[fe+8>>2]=U,kf[b>>2]=(0|kf[b>>2])+1),he?(K=0|kf[T>>2],q=0|kf[E>>2],W=K-q>>2,F=0|kf[m>>2],j=0|kf[b>>2],(0|(0==(0|W)?0:(341*W|0)+-1|0))==(j+F|0)?(gn(s),pe=0|kf[m>>2],_e=0|kf[b>>2],me=0|kf[T>>2],Ae=0|kf[E>>2]):(pe=F,_e=j,me=K,Ae=q),q=_e+pe|0,ve=(0|me)==(0|Ae)?0:(0|kf[Ae+(((q>>>0)/341|0)<<2)>>2])+(12*((q>>>0)%341|0)|0)|0,kf[ve>>2]=he,kf[ve+4>>2]=N,kf[ve+8>>2]=z,q=(0|kf[b>>2])+1|0,kf[b>>2]=q,ye=q):G=23}else if(L){F=0;do W=0|kf[B>>2],z=0|kf[W>>2],kf[r>>2]=z,kf[R>>2]=kf[W+4>>2],kf[x>>2]=kf[W+8>>2],W=0|kf[i>>2],H=W+4|0,j=0|kf[H>>2],j>>>0<(0|kf[W+8>>2])>>>0?(kf[j>>2]=z,kf[j+4>>2]=kf[R>>2],kf[j+8>>2]=kf[x>>2],kf[H>>2]=j+12):Ai(W,r),kf[y>>2]=(0|kf[y>>2])+1,F=F+1|0;while(F>>>0<L>>>0);G=23}else G=23;while(0);if(23==(0|G)&&(G=0,ye=0|kf[b>>2]),!ye){w=1;break}O=ye}else w=1;while(0);ye=0|kf[E>>2],ve=0|kf[m>>2],he=ye+(((ve>>>0)/341|0)<<2)|0,Ae=0|kf[T>>2],me=Ae,pe=ye,(0|Ae)==(0|ye)?(ge=0,be=0):(_e=(0|kf[b>>2])+ve|0,ge=(0|kf[ye+(((_e>>>0)/341|0)<<2)>>2])+(12*((_e>>>0)%341|0)|0)|0,be=(0|kf[he>>2])+(12*((ve>>>0)%341|0)|0)|0),ve=he,he=be;e:for(;;){be=he;do{if(_e=be,(0|_e)==(0|ge))break e;be=_e+12|0}while(4092!=(be-(0|kf[ve>>2])|0));be=ve+4|0,ve=be,he=0|kf[be>>2]}if(kf[b>>2]=0,b=me-pe>>2,b>>>0>2){pe=ye;do mf(0|kf[pe>>2]),pe=(0|kf[E>>2])+4|0,kf[E>>2]=pe,Ee=0|kf[T>>2],Te=Ee-pe>>2;while(Te>>>0>2);Se=pe,we=Ee,Ce=Te}else Se=ye,we=Ae,Ce=b;switch(0|Ce){case 1:Me=170,G=96;break;case 2:Me=341,G=96}if(96==(0|G)&&(kf[m>>2]=Me),(0|Se)!=(0|we)){Me=Se;do mf(0|kf[Me>>2]),Me=Me+4|0;while((0|Me)!=(0|we));we=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|we)&&(kf[T>>2]=E+(~((E+-4-we|0)>>>2)<<2))}return(we=0|kf[s>>2])?(mf(we),Xf=n,0|w):(Xf=n,0|w)}function Jn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+628|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+640|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+616|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+604|0,d=e+560|0,l=e+556|0,h=e+548|0,o=e+4|0,u=e+600|0,f=e+588|0,C=e+596|0,M=r+4|0,P=r+8|0,I=S;;){if(R=0|kf[m>>2],x=I+-1|0,O=R+x|0,k=0|kf[E>>2],D=0|kf[k+(((O>>>0)/341|0)<<2)>>2],L=(O>>>0)%341|0,O=0|kf[D+(12*L|0)>>2],N=0|kf[D+(12*L|0)+4>>2],F=0|kf[D+(12*L|0)+8>>2],kf[b>>2]=x,x=0|kf[T>>2],L=x-k>>2,(1-I-R+(0==(0|L)?0:(341*L|0)+-1|0)|0)>>>0>681&&(mf(0|kf[x+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),x=0|kf[c>>2],L=x+(12*F|0)|0,R=(0|kf[A>>2])+(12*F|0)|0,O>>>0>t>>>0){w=0;break e}if(k=0|Gr(e,O,R,N),k>>>0>=(0|kf[a>>2])>>>0){w=0;break e}N=(0|kf[e>>2])-(0|kf[(0|kf[R>>2])+(k<<2)>>2])|0;t:do if(N){if(O>>>0<3){if(D=0|kf[_>>2],kf[D>>2]=k,V=0|kf[a>>2],V>>>0>1)for(W=V,G=k,U=1;;){if(G=(0|G)==(W+-1|0)?0:G+1|0,kf[D+(U<<2)>>2]=G,U=U+1|0,z=0|kf[a>>2],U>>>0>=z>>>0){H=z;break}W=z}else H=V;if(!O){B=23;break}for(W=H,U=0;;){if(W){G=0|kf[_>>2],D=0|kf[g>>2],z=0|kf[R>>2],Y=0;do{X=G+(Y<<2)|0,kf[D+(kf[X>>2]<<2)>>2]=0,Z=0|kf[X>>2],K=(0|kf[e>>2])-(0|kf[z+(Z<<2)>>2])|0;do if(0|K){if(Q=D+(Z<<2)|0,J=0|kf[d>>2],q=32-J|0,(0|K)>(0|q)){if($=0|kf[l>>2],ee=$+4|0,(0|ee)==(0|kf[h>>2])){kf[Q>>2]=0;break}te=kf[$>>2]<<J,$=K-q|0,kf[d>>2]=$,kf[l>>2]=ee,ie=32-$|0,kf[Q>>2]=(0|kf[ee>>2])>>>ie|te>>>(ie-q|0);break}if(q=0|kf[l>>2],(0|q)==(0|kf[h>>2])){kf[Q>>2]=0;break}if(kf[Q>>2]=kf[q>>2]<<J>>>(32-K|0),J=(0|kf[d>>2])+K|0,kf[d>>2]=J,32!=(0|J))break;kf[l>>2]=q+4,kf[d>>2]=0}while(0);K=0|kf[X>>2],Z=D+(K<<2)|0,kf[Z>>2]=kf[Z>>2]|kf[(0|kf[L>>2])+(K<<2)>>2],Y=Y+1|0}while(Y>>>0<(0|kf[a>>2])>>>0);j=D}else j=0|kf[g>>2];if(D=0|kf[j>>2],kf[r>>2]=D,kf[p>>2]=kf[j+4>>2],kf[v>>2]=kf[j+8>>2],Y=0|kf[i>>2],z=Y+4|0,G=0|kf[z>>2],G>>>0<(0|kf[Y+8>>2])>>>0?(kf[G>>2]=D,kf[G+4>>2]=kf[p>>2],kf[G+8>>2]=kf[v>>2],kf[z>>2]=G+12):Ai(Y,r),kf[y>>2]=(0|kf[y>>2])+1,Y=U+1|0,Y>>>0>=O>>>0){B=23;break t}W=0|kf[a>>2],U=Y}}if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}if(U=F+1|0,W=0|kf[c>>2],V=W+(12*U|0)|0,(0|V)==(0|L)?ne=W:(Wt(V,0|kf[L>>2],0|kf[x+(12*F|0)+4>>2]),ne=0|kf[c>>2]),V=(0|kf[ne+(12*U|0)>>2])+(k<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<N+-1),V=31^(0|sp(0|O)))for(W=0,Y=0;;){if(G=1&(0|Qa(e+16+(W<<4)|0))|Y<<1,W=W+1|0,
(0|W)==(0|V)){re=G;break}Y=G}else re=0;Y=(O>>>1)-re|0,V=O-Y|0;i:do if((0|Y)==(0|V))se=Y,ae=Y;else{W=0|kf[u>>2],G=0|kf[C>>2];do if((0|G)!=(0|kf[f>>2])){if(z=0!=(kf[G>>2]&1<<31-W|0),D=W+1|0,kf[u>>2]=D,32==(0|D)){if(kf[C>>2]=G+4,kf[u>>2]=0,z){se=Y,ae=V;break i}break}if(z){se=Y,ae=V;break i}break}while(0);se=V,ae=Y}while(0);Y=0|kf[A>>2],V=0|kf[Y+(12*F|0)>>2],G=V+(k<<2)|0,kf[G>>2]=(0|kf[G>>2])+1,Wt(Y+(12*U|0)|0,V,0|kf[Y+(12*F|0)+4>>2]),0|se&&(Y=0|kf[T>>2],V=0|kf[E>>2],G=Y-V>>2,W=0|kf[m>>2],z=0|kf[b>>2],(0|(0==(0|G)?0:(341*G|0)+-1|0))==(z+W|0)?(gn(s),oe=0|kf[m>>2],he=0|kf[b>>2],le=0|kf[T>>2],ce=0|kf[E>>2]):(oe=W,he=z,le=Y,ce=V),V=he+oe|0,de=(0|le)==(0|ce)?0:(0|kf[ce+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[de>>2]=se,kf[de+4>>2]=k,kf[de+8>>2]=F,kf[b>>2]=(0|kf[b>>2])+1),ae?(V=0|kf[T>>2],Y=0|kf[E>>2],z=V-Y>>2,W=0|kf[m>>2],G=0|kf[b>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(G+W|0)?(gn(s),ue=0|kf[m>>2],fe=0|kf[b>>2],pe=0|kf[T>>2],_e=0|kf[E>>2]):(ue=W,fe=G,pe=V,_e=Y),Y=fe+ue|0,me=(0|pe)==(0|_e)?0:(0|kf[_e+(((Y>>>0)/341|0)<<2)>>2])+(12*((Y>>>0)%341|0)|0)|0,kf[me>>2]=ae,kf[me+4>>2]=k,kf[me+8>>2]=U,Y=(0|kf[b>>2])+1|0,kf[b>>2]=Y,Ae=Y):B=23}else if(O){D=0;do V=0|kf[L>>2],U=0|kf[V>>2],kf[r>>2]=U,kf[M>>2]=kf[V+4>>2],kf[P>>2]=kf[V+8>>2],V=0|kf[i>>2],G=V+4|0,W=0|kf[G>>2],W>>>0<(0|kf[V+8>>2])>>>0?(kf[W>>2]=U,kf[W+4>>2]=kf[M>>2],kf[W+8>>2]=kf[P>>2],kf[G>>2]=W+12):Ai(V,r),kf[y>>2]=(0|kf[y>>2])+1,D=D+1|0;while(D>>>0<O>>>0);B=23}else B=23;while(0);if(23==(0|B)&&(B=0,Ae=0|kf[b>>2]),!Ae){w=1;break}I=Ae}else w=1;while(0);Ae=0|kf[E>>2],me=0|kf[m>>2],ae=Ae+(((me>>>0)/341|0)<<2)|0,_e=0|kf[T>>2],pe=_e,ue=Ae,(0|_e)==(0|Ae)?(ve=0,ye=0):(fe=(0|kf[b>>2])+me|0,ve=(0|kf[Ae+(((fe>>>0)/341|0)<<2)>>2])+(12*((fe>>>0)%341|0)|0)|0,ye=(0|kf[ae>>2])+(12*((me>>>0)%341|0)|0)|0),me=ae,ae=ye;e:for(;;){ye=ae;do{if(fe=ye,(0|fe)==(0|ve))break e;ye=fe+12|0}while(4092!=(ye-(0|kf[me>>2])|0));ye=me+4|0,me=ye,ae=0|kf[ye>>2]}if(kf[b>>2]=0,b=pe-ue>>2,b>>>0>2){ue=Ae;do mf(0|kf[ue>>2]),ue=(0|kf[E>>2])+4|0,kf[E>>2]=ue,ge=0|kf[T>>2],be=ge-ue>>2;while(be>>>0>2);Ee=ue,Te=ge,Se=be}else Ee=Ae,Te=_e,Se=b;switch(0|Se){case 1:we=170,B=94;break;case 2:we=341,B=94}if(94==(0|B)&&(kf[m>>2]=we),(0|Ee)!=(0|Te)){we=Ee;do mf(0|kf[we>>2]),we=we+4|0;while((0|we)!=(0|Te));Te=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|Te)&&(kf[T>>2]=E+(~((E+-4-Te|0)>>>2)<<2))}return(Te=0|kf[s>>2])?(mf(Te),Xf=n,0|w):(Xf=n,0|w)}function qn(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0,we=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+628|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+640|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+616|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+604|0,d=e+560|0,l=e+556|0,h=e+548|0,o=e+4|0,u=e+600|0,f=e+588|0,C=e+596|0,M=r+4|0,P=r+8|0,I=S;;){if(R=0|kf[m>>2],x=I+-1|0,O=R+x|0,k=0|kf[E>>2],D=0|kf[k+(((O>>>0)/341|0)<<2)>>2],L=(O>>>0)%341|0,O=0|kf[D+(12*L|0)>>2],N=0|kf[D+(12*L|0)+4>>2],F=0|kf[D+(12*L|0)+8>>2],kf[b>>2]=x,x=0|kf[T>>2],L=x-k>>2,(1-I-R+(0==(0|L)?0:(341*L|0)+-1|0)|0)>>>0>681&&(mf(0|kf[x+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),x=0|kf[c>>2],L=x+(12*F|0)|0,R=(0|kf[A>>2])+(12*F|0)|0,O>>>0>t>>>0){w=0;break e}if(k=0|Rl(e,O,R,N),k>>>0>=(0|kf[a>>2])>>>0){w=0;break e}N=(0|kf[e>>2])-(0|kf[(0|kf[R>>2])+(k<<2)>>2])|0;t:do if(N){if(O>>>0<3){if(D=0|kf[_>>2],kf[D>>2]=k,V=0|kf[a>>2],V>>>0>1)for(W=V,G=k,U=1;;){if(G=(0|G)==(W+-1|0)?0:G+1|0,kf[D+(U<<2)>>2]=G,U=U+1|0,z=0|kf[a>>2],U>>>0>=z>>>0){H=z;break}W=z}else H=V;if(!O){B=23;break}for(W=H,U=0;;){if(W){G=0|kf[_>>2],D=0|kf[g>>2],z=0|kf[R>>2],Y=0;do{X=G+(Y<<2)|0,kf[D+(kf[X>>2]<<2)>>2]=0,Z=0|kf[X>>2],K=(0|kf[e>>2])-(0|kf[z+(Z<<2)>>2])|0;do if(0|K){if(Q=D+(Z<<2)|0,J=0|kf[d>>2],q=32-J|0,(0|K)>(0|q)){if($=0|kf[l>>2],ee=$+4|0,(0|ee)==(0|kf[h>>2])){kf[Q>>2]=0;break}te=kf[$>>2]<<J,$=K-q|0,kf[d>>2]=$,kf[l>>2]=ee,ie=32-$|0,kf[Q>>2]=(0|kf[ee>>2])>>>ie|te>>>(ie-q|0);break}if(q=0|kf[l>>2],(0|q)==(0|kf[h>>2])){kf[Q>>2]=0;break}if(kf[Q>>2]=kf[q>>2]<<J>>>(32-K|0),J=(0|kf[d>>2])+K|0,kf[d>>2]=J,32!=(0|J))break;kf[l>>2]=q+4,kf[d>>2]=0}while(0);K=0|kf[X>>2],Z=D+(K<<2)|0,kf[Z>>2]=kf[Z>>2]|kf[(0|kf[L>>2])+(K<<2)>>2],Y=Y+1|0}while(Y>>>0<(0|kf[a>>2])>>>0);j=D}else j=0|kf[g>>2];if(D=0|kf[j>>2],kf[r>>2]=D,kf[p>>2]=kf[j+4>>2],kf[v>>2]=kf[j+8>>2],Y=0|kf[i>>2],z=Y+4|0,G=0|kf[z>>2],G>>>0<(0|kf[Y+8>>2])>>>0?(kf[G>>2]=D,kf[G+4>>2]=kf[p>>2],kf[G+8>>2]=kf[v>>2],kf[z>>2]=G+12):Ai(Y,r),kf[y>>2]=(0|kf[y>>2])+1,Y=U+1|0,Y>>>0>=O>>>0){B=23;break t}W=0|kf[a>>2],U=Y}}if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}if(U=F+1|0,W=0|kf[c>>2],V=W+(12*U|0)|0,(0|V)==(0|L)?ne=W:(Wt(V,0|kf[L>>2],0|kf[x+(12*F|0)+4>>2]),ne=0|kf[c>>2]),V=(0|kf[ne+(12*U|0)>>2])+(k<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<N+-1),V=31^(0|sp(0|O)))for(W=0,Y=0;;){if(G=1&(0|Qa(e+16+(W<<4)|0))|Y<<1,W=W+1|0,(0|W)==(0|V)){re=G;break}Y=G}else re=0;Y=(O>>>1)-re|0,V=O-Y|0;i:do if((0|Y)==(0|V))se=Y,ae=Y;else{W=0|kf[u>>2],G=0|kf[C>>2];do if((0|G)!=(0|kf[f>>2])){if(z=0!=(kf[G>>2]&1<<31-W|0),D=W+1|0,kf[u>>2]=D,32==(0|D)){if(kf[C>>2]=G+4,kf[u>>2]=0,z){se=Y,ae=V;break i}break}if(z){se=Y,ae=V;break i}break}while(0);se=V,ae=Y}while(0);Y=0|kf[A>>2],V=0|kf[Y+(12*F|0)>>2],G=V+(k<<2)|0,kf[G>>2]=(0|kf[G>>2])+1,Wt(Y+(12*U|0)|0,V,0|kf[Y+(12*F|0)+4>>2]),0|se&&(Y=0|kf[T>>2],V=0|kf[E>>2],G=Y-V>>2,W=0|kf[m>>2],z=0|kf[b>>2],(0|(0==(0|G)?0:(341*G|0)+-1|0))==(z+W|0)?(gn(s),oe=0|kf[m>>2],he=0|kf[b>>2],le=0|kf[T>>2],ce=0|kf[E>>2]):(oe=W,he=z,le=Y,ce=V),V=he+oe|0,de=(0|le)==(0|ce)?0:(0|kf[ce+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[de>>2]=se,kf[de+4>>2]=k,kf[de+8>>2]=F,kf[b>>2]=(0|kf[b>>2])+1),ae?(V=0|kf[T>>2],Y=0|kf[E>>2],z=V-Y>>2,W=0|kf[m>>2],G=0|kf[b>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(G+W|0)?(gn(s),ue=0|kf[m>>2],fe=0|kf[b>>2],pe=0|kf[T>>2],_e=0|kf[E>>2]):(ue=W,fe=G,pe=V,_e=Y),Y=fe+ue|0,me=(0|pe)==(0|_e)?0:(0|kf[_e+(((Y>>>0)/341|0)<<2)>>2])+(12*((Y>>>0)%341|0)|0)|0,kf[me>>2]=ae,kf[me+4>>2]=k,kf[me+8>>2]=U,Y=(0|kf[b>>2])+1|0,kf[b>>2]=Y,Ae=Y):B=23}else if(O){D=0;do V=0|kf[L>>2],U=0|kf[V>>2],kf[r>>2]=U,kf[M>>2]=kf[V+4>>2],kf[P>>2]=kf[V+8>>2],V=0|kf[i>>2],G=V+4|0,W=0|kf[G>>2],W>>>0<(0|kf[V+8>>2])>>>0?(kf[W>>2]=U,kf[W+4>>2]=kf[M>>2],kf[W+8>>2]=kf[P>>2],kf[G>>2]=W+12):Ai(V,r),kf[y>>2]=(0|kf[y>>2])+1,D=D+1|0;while(D>>>0<O>>>0);B=23}else B=23;while(0);if(23==(0|B)&&(B=0,Ae=0|kf[b>>2]),!Ae){w=1;break}I=Ae}else w=1;while(0);Ae=0|kf[E>>2],me=0|kf[m>>2],ae=Ae+(((me>>>0)/341|0)<<2)|0,_e=0|kf[T>>2],pe=_e,ue=Ae,(0|_e)==(0|Ae)?(ve=0,ye=0):(fe=(0|kf[b>>2])+me|0,ve=(0|kf[Ae+(((fe>>>0)/341|0)<<2)>>2])+(12*((fe>>>0)%341|0)|0)|0,ye=(0|kf[ae>>2])+(12*((me>>>0)%341|0)|0)|0),me=ae,ae=ye;e:for(;;){ye=ae;do{if(fe=ye,(0|fe)==(0|ve))break e;ye=fe+12|0}while(4092!=(ye-(0|kf[me>>2])|0));ye=me+4|0,me=ye,ae=0|kf[ye>>2]}if(kf[b>>2]=0,b=pe-ue>>2,b>>>0>2){ue=Ae;do mf(0|kf[ue>>2]),ue=(0|kf[E>>2])+4|0,kf[E>>2]=ue,ge=0|kf[T>>2],be=ge-ue>>2;while(be>>>0>2);Ee=ue,Te=ge,Se=be}else Ee=Ae,Te=_e,Se=b;switch(0|Se){case 1:we=170,B=94;break;case 2:we=341,B=94}if(94==(0|B)&&(kf[m>>2]=we),(0|Ee)!=(0|Te)){we=Ee;do mf(0|kf[we>>2]),we=we+4|0;while((0|we)!=(0|Te));Te=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|Te)&&(kf[T>>2]=E+(~((E+-4-Te|0)>>>2)<<2))}return(Te=0|kf[s>>2])?(mf(Te),Xf=n,0|w):(Xf=n,0|w)}function $n(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+628|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+640|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+616|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+604|0,d=e+560|0,l=e+556|0,h=e+548|0,o=e+4|0,u=e+600|0,f=e+588|0,C=e+596|0,M=r+4|0,P=r+8|0,I=S;;){if(R=0|kf[m>>2],x=I+-1|0,O=R+x|0,k=0|kf[E>>2],D=0|kf[k+(((O>>>0)/341|0)<<2)>>2],L=(O>>>0)%341|0,O=0|kf[D+(12*L|0)>>2],N=0|kf[D+(12*L|0)+4>>2],F=0|kf[D+(12*L|0)+8>>2],kf[b>>2]=x,x=0|kf[T>>2],L=x-k>>2,(1-I-R+(0==(0|L)?0:(341*L|0)+-1|0)|0)>>>0>681&&(mf(0|kf[x+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),x=0|kf[c>>2],L=x+(12*F|0)|0,O>>>0>t>>>0){w=0;break e}if(R=0|kf[a>>2],k=(R+-1|0)==(0|N)?0:N+1|0,k>>>0>=R>>>0){w=0;break e}R=(0|kf[A>>2])+(12*F|0)|0,N=(0|kf[e>>2])-(0|kf[(0|kf[R>>2])+(k<<2)>>2])|0;t:do if(N){if(O>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}if(D=F+1|0,Wt(x+(12*D|0)|0,0|kf[L>>2],0|kf[x+(12*F|0)+4>>2]),V=(0|kf[(0|kf[c>>2])+(12*D|0)>>2])+(k<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<N+-1),V=31^(0|sp(0|O)))for(W=0,G=0;;){if(U=1&(0|Qa(e+16+(W<<4)|0))|G<<1,W=W+1|0,(0|W)==(0|V)){z=U;break}G=U}else z=0;G=(O>>>1)-z|0,V=O-G|0;i:do if((0|G)==(0|V))H=G,j=G;else{W=0|kf[u>>2],U=0|kf[C>>2];do if((0|U)!=(0|kf[f>>2])){if(Y=0!=(kf[U>>2]&1<<31-W|0),X=W+1|0,kf[u>>2]=X,32==(0|X)){if(kf[C>>2]=U+4,kf[u>>2]=0,Y){H=G,j=V;break i}break}if(Y){H=G,j=V;break i}break}while(0);H=V,j=G}while(0);if(G=0|kf[A>>2],V=0|kf[G+(12*F|0)>>2],U=V+(k<<2)|0,kf[U>>2]=(0|kf[U>>2])+1,Wt(G+(12*D|0)|0,V,0|kf[G+(12*F|0)+4>>2]),0|H&&(G=0|kf[T>>2],V=0|kf[E>>2],U=G-V>>2,W=0|kf[m>>2],Y=0|kf[b>>2],(0|(0==(0|U)?0:(341*U|0)+-1|0))==(Y+W|0)?(gn(s),Z=0|kf[m>>2],K=0|kf[b>>2],Q=0|kf[T>>2],J=0|kf[E>>2]):(Z=W,K=Y,Q=G,J=V),V=K+Z|0,q=(0|Q)==(0|J)?0:(0|kf[J+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[q>>2]=H,kf[q+4>>2]=k,kf[q+8>>2]=F,kf[b>>2]=(0|kf[b>>2])+1),!j){B=23;break}V=0|kf[T>>2],G=0|kf[E>>2],Y=V-G>>2,W=0|kf[m>>2],U=0|kf[b>>2],(0|(0==(0|Y)?0:(341*Y|0)+-1|0))==(U+W|0)?(gn(s),$=0|kf[m>>2],ee=0|kf[b>>2],te=0|kf[T>>2],ie=0|kf[E>>2]):($=W,ee=U,te=V,ie=G),G=ee+$|0,ne=(0|te)==(0|ie)?0:(0|kf[ie+(((G>>>0)/341|0)<<2)>>2])+(12*((G>>>0)%341|0)|0)|0,kf[ne>>2]=j,kf[ne+4>>2]=k,kf[ne+8>>2]=D,G=(0|kf[b>>2])+1|0,kf[b>>2]=G,re=G;break}if(G=0|kf[_>>2],kf[G>>2]=k,V=0|kf[a>>2],V>>>0>1)for(U=V,W=k,Y=1;;){if(W=(0|W)==(U+-1|0)?0:W+1|0,kf[G+(Y<<2)>>2]=W,Y=Y+1|0,X=0|kf[a>>2],Y>>>0>=X>>>0){se=X;break}U=X}else se=V;if(O)for(U=se,Y=0;;){if(U){W=0|kf[_>>2],G=0|kf[g>>2],D=0|kf[R>>2],X=0;do{oe=W+(X<<2)|0,kf[G+(kf[oe>>2]<<2)>>2]=0,he=0|kf[oe>>2],le=(0|kf[e>>2])-(0|kf[D+(he<<2)>>2])|0;do if(0|le){if(ce=G+(he<<2)|0,de=0|kf[d>>2],ue=32-de|0,(0|le)>(0|ue)){if(fe=0|kf[l>>2],pe=fe+4|0,(0|pe)==(0|kf[h>>2])){kf[ce>>2]=0;break}_e=kf[fe>>2]<<de,fe=le-ue|0,kf[d>>2]=fe,kf[l>>2]=pe,me=32-fe|0,kf[ce>>2]=(0|kf[pe>>2])>>>me|_e>>>(me-ue|0);break}if(ue=0|kf[l>>2],(0|ue)==(0|kf[h>>2])){kf[ce>>2]=0;break}if(kf[ce>>2]=kf[ue>>2]<<de>>>(32-le|0),de=(0|kf[d>>2])+le|0,kf[d>>2]=de,32!=(0|de))break;kf[l>>2]=ue+4,kf[d>>2]=0}while(0);le=0|kf[oe>>2],he=G+(le<<2)|0,kf[he>>2]=kf[he>>2]|kf[(0|kf[L>>2])+(le<<2)>>2],X=X+1|0}while(X>>>0<(0|kf[a>>2])>>>0);ae=G}else ae=0|kf[g>>2];if(G=0|kf[ae>>2],kf[r>>2]=G,kf[p>>2]=kf[ae+4>>2],kf[v>>2]=kf[ae+8>>2],X=0|kf[i>>2],D=X+4|0,W=0|kf[D>>2],W>>>0<(0|kf[X+8>>2])>>>0?(kf[W>>2]=G,kf[W+4>>2]=kf[p>>2],kf[W+8>>2]=kf[v>>2],kf[D>>2]=W+12):Ai(X,r),kf[y>>2]=(0|kf[y>>2])+1,X=Y+1|0,X>>>0>=O>>>0){B=23;break t}U=0|kf[a>>2],Y=X}else B=23}else if(O){D=0;do V=0|kf[L>>2],U=0|kf[V>>2],kf[r>>2]=U,kf[M>>2]=kf[V+4>>2],kf[P>>2]=kf[V+8>>2],V=0|kf[i>>2],G=V+4|0,W=0|kf[G>>2],W>>>0<(0|kf[V+8>>2])>>>0?(kf[W>>2]=U,kf[W+4>>2]=kf[M>>2],kf[W+8>>2]=kf[P>>2],kf[G>>2]=W+12):Ai(V,r),kf[y>>2]=(0|kf[y>>2])+1,D=D+1|0;while(D>>>0<O>>>0);B=23}else B=23;while(0);if(23==(0|B)&&(B=0,re=0|kf[b>>2]),!re){w=1;break}I=re}else w=1;while(0);re=0|kf[E>>2],a=0|kf[m>>2],r=re+(((a>>>0)/341|0)<<2)|0,i=0|kf[T>>2],ae=i,e=re,(0|i)==(0|re)?(Ae=0,ve=0):(se=(0|kf[b>>2])+a|0,Ae=(0|kf[re+(((se>>>0)/341|0)<<2)>>2])+(12*((se>>>0)%341|0)|0)|0,ve=(0|kf[r>>2])+(12*((a>>>0)%341|0)|0)|0),a=r,r=ve;e:for(;;){ve=r;do{if(se=ve,(0|se)==(0|Ae))break e;ve=se+12|0}while(4092!=(ve-(0|kf[a>>2])|0));ve=a+4|0,a=ve,r=0|kf[ve>>2]}if(kf[b>>2]=0,b=ae-e>>2,b>>>0>2){e=re;do mf(0|kf[e>>2]),e=(0|kf[E>>2])+4|0,kf[E>>2]=e,ye=0|kf[T>>2],ge=ye-e>>2;while(ge>>>0>2);be=e,Ee=ye,Te=ge}else be=re,Ee=i,Te=b;switch(0|Te){case 1:Se=170,B=92;break;case 2:Se=341,B=92}if(92==(0|B)&&(kf[m>>2]=Se),(0|be)!=(0|Ee)){Se=be;do mf(0|kf[Se>>2]),Se=Se+4|0;while((0|Se)!=(0|Ee));Ee=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|Ee)&&(kf[T>>2]=E+(~((E+-4-Ee|0)>>>2)<<2))}return(Ee=0|kf[s>>2])?(mf(Ee),Xf=n,0|w):(Xf=n,0|w)}function er(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0,Se=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+116|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+128|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+104|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+92|0,d=e+48|0,l=e+44|0,h=e+36|0,o=e+4|0,u=e+16|0,f=e+88|0,C=e+76|0,M=e+84|0,P=r+4|0,I=r+8|0,R=S;;){if(x=0|kf[m>>2],O=R+-1|0,k=x+O|0,D=0|kf[E>>2],L=0|kf[D+(((k>>>0)/341|0)<<2)>>2],N=(k>>>0)%341|0,k=0|kf[L+(12*N|0)>>2],F=0|kf[L+(12*N|0)+4>>2],B=0|kf[L+(12*N|0)+8>>2],kf[b>>2]=O,O=0|kf[T>>2],N=O-D>>2,(1-R-x+(0==(0|N)?0:(341*N|0)+-1|0)|0)>>>0>681&&(mf(0|kf[O+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),O=0|kf[c>>2],N=O+(12*B|0)|0,x=(0|kf[A>>2])+(12*B|0)|0,k>>>0>t>>>0){w=0;break e}if(D=0|Rl(e,k,x,F),D>>>0>=(0|kf[a>>2])>>>0){w=0;break e}F=(0|kf[e>>2])-(0|kf[(0|kf[x>>2])+(D<<2)>>2])|0;t:do if(F){if(!(k>>>0<3)){if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}U=B+1|0,W=0|kf[c>>2],V=W+(12*U|0)|0,(0|V)==(0|N)?ne=W:(Wt(V,0|kf[N>>2],0|kf[O+(12*B|0)+4>>2]),ne=0|kf[c>>2]),V=(0|kf[ne+(12*U|0)>>2])+(D<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<F+-1),V=31^(0|sp(0|k)),kf[r>>2]=0,Vs(u,V,r),V=(k>>>1)-(0|kf[r>>2])|0,W=k-V|0;i:do if((0|V)==(0|W))re=V,se=V;else{Y=0|kf[f>>2],G=0|kf[M>>2];do if((0|G)!=(0|kf[C>>2])){if(z=0!=(kf[G>>2]&1<<31-Y|0),L=Y+1|0,kf[f>>2]=L,32==(0|L)){if(kf[M>>2]=G+4,kf[f>>2]=0,z){re=V,se=W;break i}break}if(z){re=V,se=W;break i}break}while(0);re=W,se=V}while(0);V=0|kf[A>>2],W=0|kf[V+(12*B|0)>>2],G=W+(D<<2)|0,kf[G>>2]=(0|kf[G>>2])+1,Wt(V+(12*U|0)|0,W,0|kf[V+(12*B|0)+4>>2]),0|re&&(V=0|kf[T>>2],W=0|kf[E>>2],G=V-W>>2,Y=0|kf[m>>2],z=0|kf[b>>2],(0|(0==(0|G)?0:(341*G|0)+-1|0))==(z+Y|0)?(gn(s),ae=0|kf[m>>2],oe=0|kf[b>>2],he=0|kf[T>>2],le=0|kf[E>>2]):(ae=Y,oe=z,he=V,le=W),W=oe+ae|0,ce=(0|he)==(0|le)?0:(0|kf[le+(((W>>>0)/341|0)<<2)>>2])+(12*((W>>>0)%341|0)|0)|0,kf[ce>>2]=re,kf[ce+4>>2]=D,kf[ce+8>>2]=B,kf[b>>2]=(0|kf[b>>2])+1),0|se&&(W=0|kf[T>>2],V=0|kf[E>>2],z=W-V>>2,Y=0|kf[m>>2],G=0|kf[b>>2],(0|(0==(0|z)?0:(341*z|0)+-1|0))==(G+Y|0)?(gn(s),de=0|kf[m>>2],ue=0|kf[b>>2],fe=0|kf[T>>2],pe=0|kf[E>>2]):(de=Y,ue=G,fe=W,pe=V),V=ue+de|0,_e=(0|fe)==(0|pe)?0:(0|kf[pe+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[_e>>2]=se,kf[_e+4>>2]=D,kf[_e+8>>2]=U,kf[b>>2]=(0|kf[b>>2])+1);break}if(L=0|kf[_>>2],kf[L>>2]=D,V=0|kf[a>>2],V>>>0>1)for(W=V,G=D,U=1;;){if(G=(0|G)==(W+-1|0)?0:G+1|0,kf[L+(U<<2)>>2]=G,U=U+1|0,z=0|kf[a>>2],U>>>0>=z>>>0){H=z;break}W=z}else H=V;if(!k)break;for(W=H,U=0;;){if(W){G=0|kf[_>>2],L=0|kf[g>>2],z=0|kf[x>>2],Y=0;do{X=G+(Y<<2)|0,kf[L+(kf[X>>2]<<2)>>2]=0,Z=0|kf[X>>2],K=(0|kf[e>>2])-(0|kf[z+(Z<<2)>>2])|0;do if(0|K){if(Q=L+(Z<<2)|0,J=0|kf[d>>2],q=32-J|0,(0|K)>(0|q)){if($=0|kf[l>>2],ee=$+4|0,(0|ee)==(0|kf[h>>2])){kf[Q>>2]=0;break}te=kf[$>>2]<<J,$=K-q|0,kf[d>>2]=$,kf[l>>2]=ee,ie=32-$|0,kf[Q>>2]=(0|kf[ee>>2])>>>ie|te>>>(ie-q|0);break}if(q=0|kf[l>>2],(0|q)==(0|kf[h>>2])){kf[Q>>2]=0;break}if(kf[Q>>2]=kf[q>>2]<<J>>>(32-K|0),J=(0|kf[d>>2])+K|0,kf[d>>2]=J,32!=(0|J))break;kf[l>>2]=q+4,kf[d>>2]=0}while(0);K=0|kf[X>>2],Z=L+(K<<2)|0,kf[Z>>2]=kf[Z>>2]|kf[(0|kf[N>>2])+(K<<2)>>2],Y=Y+1|0}while(Y>>>0<(0|kf[a>>2])>>>0);j=L}else j=0|kf[g>>2];if(L=0|kf[j>>2],kf[r>>2]=L,kf[p>>2]=kf[j+4>>2],kf[v>>2]=kf[j+8>>2],Y=0|kf[i>>2],z=Y+4|0,G=0|kf[z>>2],G>>>0<(0|kf[Y+8>>2])>>>0?(kf[G>>2]=L,kf[G+4>>2]=kf[p>>2],kf[G+8>>2]=kf[v>>2],kf[z>>2]=G+12):Ai(Y,r),kf[y>>2]=(0|kf[y>>2])+1,Y=U+1|0,Y>>>0>=k>>>0)break t;W=0|kf[a>>2],U=Y}}else if(0|k){L=0;do V=0|kf[N>>2],U=0|kf[V>>2],kf[r>>2]=U,kf[P>>2]=kf[V+4>>2],kf[I>>2]=kf[V+8>>2],V=0|kf[i>>2],G=V+4|0,W=0|kf[G>>2],W>>>0<(0|kf[V+8>>2])>>>0?(kf[W>>2]=U,kf[W+4>>2]=kf[P>>2],kf[W+8>>2]=kf[I>>2],kf[G>>2]=W+12):Ai(V,r),kf[y>>2]=(0|kf[y>>2])+1,L=L+1|0;while(L>>>0<k>>>0)}while(0);if(R=0|kf[b>>2],!R){w=1;break}}else w=1;while(0);_e=0|kf[E>>2],se=0|kf[m>>2],pe=_e+(((se>>>0)/341|0)<<2)|0,fe=0|kf[T>>2],de=fe,ue=_e,(0|fe)==(0|_e)?(me=0,Ae=0):(ce=(0|kf[b>>2])+se|0,me=(0|kf[_e+(((ce>>>0)/341|0)<<2)>>2])+(12*((ce>>>0)%341|0)|0)|0,Ae=(0|kf[pe>>2])+(12*((se>>>0)%341|0)|0)|0),se=pe,pe=Ae;e:for(;;){Ae=pe;do{if(ce=Ae,(0|ce)==(0|me))break e;Ae=ce+12|0}while(4092!=(Ae-(0|kf[se>>2])|0));Ae=se+4|0,se=Ae,pe=0|kf[Ae>>2]}if(kf[b>>2]=0,b=de-ue>>2,b>>>0>2){ue=_e;do mf(0|kf[ue>>2]),ue=(0|kf[E>>2])+4|0,kf[E>>2]=ue,ve=0|kf[T>>2],ye=ve-ue>>2;while(ye>>>0>2);ge=ue,be=ve,Ee=ye}else ge=_e,be=fe,Ee=b;switch(0|Ee){case 1:Te=170,Se=92;break;case 2:Te=341,Se=92}if(92==(0|Se)&&(kf[m>>2]=Te),(0|ge)!=(0|be)){Te=ge;do mf(0|kf[Te>>2]),Te=Te+4|0;while((0|Te)!=(0|be));be=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|be)&&(kf[T>>2]=E+(~((E+-4-be|0)>>>2)<<2))}return(be=0|kf[s>>2])?(mf(be),Xf=n,0|w):(Xf=n,0|w)}function tr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=wp,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0;if(i=Xf,Xf=Xf+720|0,n=i,r=i+688|0,s=i+656|0,a=i+4|0,(0|Ff[t+38>>1])>514){kf[s>>2]=0,o=s+4|0,kf[o>>2]=0,kf[s+8>>2]=0,h=t+8|0,l=t+16|0,c=r+4|0,d=r+8|0,u=e+36|0,f=e+40|0,p=e+60|0,_=e+44|0,m=r+8|0,A=r+12|0,v=r+20|0,y=0;e:for(;;){if((0|y)>=(0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e))){g=4;break}if(b=0|Mp[127&kf[(0|kf[e>>2])+20>>2]](e,y),E=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,T=0|kf[(0|kf[(0|kf[E>>2])+8>>2])+(b<<2)>>2],9==(0|kf[T+28>>2])){if(b=0|If[T+24>>0],T=0|kf[o>>2],E=0|kf[s>>2],S=T-E>>2,w=E,E=T,b>>>0<=S>>>0?(b>>>0<S>>>0?(T=w+(b<<2)|0,(0|E)!=(0|T)):0)&&(kf[o>>2]=E+(~((E+-4-T|0)>>>2)<<2)):Kr(s,b-S|0),S=b<<2,T=h,E=0|kf[T>>2],w=0|kf[T+4>>2],T=l,C=0|kf[T>>2],M=0|tc(0|C,0|kf[T+4>>2],0|S,0),T=qf,(0|w)<(0|T)|(0|w)==(0|T)&E>>>0<M>>>0){P=0;break}if(0|ui(0|kf[s>>2],(0|kf[t>>2])+C|0,0|S),C=l,M=0|tc(0|kf[C>>2],0|kf[C+4>>2],0|S,0),S=qf,C=l,kf[C>>2]=M,kf[C+4>>2]=S,C=h,E=0|kf[C>>2],T=0|kf[C+4>>2],C=0|tc(0|M,0|S,4,0),w=qf,(0|T)<(0|w)|(0|T)==(0|w)&E>>>0<C>>>0){P=0;break}if(I=0|kf[t>>2],R=I+M|0,If[Yf>>0]=If[R>>0],If[Yf+1>>0]=If[R+1>>0],If[Yf+2>>0]=If[R+2>>0],If[Yf+3>>0]=If[R+3>>0],x=ap(Gf[Yf>>2]),R=l,kf[R>>2]=C,kf[R+4>>2]=w,!((0|T)>(0|w)|(0|T)==(0|w)&E>>>0>C>>>0)){P=0;break}if(E=0|If[I+C>>0],C=0|tc(0|M,0|S,5,0),S=l,kf[S>>2]=C,kf[S+4>>2]=qf,(255&E)>31){P=0;break}kf[r>>2]=1228,kf[c>>2]=-1,kf[d>>2]=0,kf[d+4>>2]=0,kf[d+8>>2]=0,kf[d+12>>2]=0,Ho(r,255&E,0|kf[s>>2],b,x);do if(0|ho(r,0|kf[(0|kf[p>>2])+((((0|kf[f>>2])-(0|kf[u>>2])|0)/24|0)<<2)>>2])){if(b=0|kf[f>>2],(0|b)==(0|kf[_>>2])){ht(u,r),O=0;break}if(kf[b>>2]=1228,kf[b+4>>2]=kf[c>>2],k=b+8|0,kf[k>>2]=0,E=b+12|0,kf[E>>2]=0,kf[b+16>>2]=0,S=(0|kf[A>>2])-(0|kf[m>>2])|0,C=S>>2,0|C){if(C>>>0>1073741823){g=20;break e}M=0|sl(S),kf[E>>2]=M,kf[k>>2]=M,kf[b+16>>2]=M+(C<<2),C=0|kf[m>>2],S=(0|kf[A>>2])-C|0,(0|S)>0&&(0|ui(0|M,0|C,0|S),kf[E>>2]=M+(S>>>2<<2))}kf[b+20>>2]=kf[v>>2],kf[f>>2]=(0|kf[f>>2])+24,O=0}else O=1;while(0);if(kf[r>>2]=1228,b=0|kf[d>>2],0|b&&(S=0|kf[A>>2],(0|S)!=(0|b)&&(kf[A>>2]=S+(~((S+-4-b|0)>>>2)<<2)),mf(b)),0|O){P=0;break}}y=y+1|0}if(20==(0|g)&&Du(k),4==(0|g))if(k=e+48|0,y=e+52|0,(0|kf[y>>2])==(0|kf[k>>2]))P=1;else for(O=0,A=0;;){if(0|Qs(r,t)?(d=0|kf[r>>2],D=d<<31>>31^d>>>1):D=A,d=0|kf[k>>2],kf[d+(O<<2)>>2]=D,O=O+1|0,O>>>0>=(0|kf[y>>2])-d>>2>>>0){P=1;break}A=D}return D=0|kf[s>>2],0|D&&(A=0|kf[o>>2],(0|A)!=(0|D)&&(kf[o>>2]=A+(~((A+-4-D|0)>>>2)<<2)),mf(D)),L=P,Xf=i,0|L}if(P=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),kf[r>>2]=0,D=r+4|0,kf[D>>2]=0,kf[r+8>>2]=0,A=0==(0|P))N=0|kf[(0|kf[e>>2])+20>>2],F=e,B=0;else for(P>>>0>214748364&&Du(r),o=20*P|0,y=0|sl(o),kf[r>>2]=y,kf[r+8>>2]=y+(20*P|0),0|Bs(0|y,0,0|o),kf[D>>2]=y+o,o=0|kf[(0|kf[e>>2])+20>>2],y=0,O=0;;){if(k=0|Mp[127&o](e,y),d=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,f=0|kf[(0|kf[(0|kf[d>>2])+8>>2])+(k<<2)>>2],k=0|kf[f+28>>2],d=0|oh(k),v=0|If[f+24>>0],m=0|kf[r>>2],kf[m+(20*y|0)>>2]=f,kf[m+(20*y|0)+4>>2]=O,kf[m+(20*y|0)+8>>2]=k,kf[m+(20*y|0)+12>>2]=(0|d)>0?d:0,kf[m+(20*y|0)+16>>2]=v,m=v+O|0,y=y+1|0,v=0|kf[(0|kf[e>>2])+20>>2],y>>>0>=P>>>0){N=v,F=e,B=m;break}o=v,O=m}O=0|Mp[127&N](e,0),N=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,o=0|kf[(0|kf[(0|kf[N>>2])+8>>2])+(O<<2)>>2],If[o+84>>0]=1,O=0|kf[o+68>>2],N=o+72|0,y=0|kf[N>>2],(0|y)!=(0|O)&&(kf[N>>2]=y+(~((y+-4-O|0)>>>2)<<2)),O=t+8|0,y=0|kf[O>>2],N=0|kf[O+4>>2],O=t+16|0,m=O,v=0|kf[m>>2],d=0|kf[m+4>>2];e:do if((0|N)>(0|d)|(0|N)==(0|d)&y>>>0>v>>>0){switch(m=0|kf[t>>2],k=0|If[m+v>>0],f=0|tc(0|v,0|d,1,0),c=qf,u=O,kf[u>>2]=f,kf[u+4>>2]=c,k<<24>>24){case 0:if(!((0|N)>(0|c)|(0|N)==(0|c)&y>>>0>f>>>0)){V=0;break e}if(k=0|tc(0|v,0|d,2,0),u=O,kf[u>>2]=k,kf[u+4>>2]=qf,u=0|tc(0|v,0|d,6,0),_=qf,(0|N)<(0|_)|(0|N)==(0|_)&y>>>0<u>>>0){V=0;break e}if(p=m+k|0,k=Lf[p>>0]|Lf[p+1>>0]<<8|Lf[p+2>>0]<<16|Lf[p+3>>0]<<24,p=O,kf[p>>2]=u,kf[p+4>>2]=_,0|Ys(o,k),Vc(s),rr(a,r),k=0|Ce(s,t,a),_=0|kf[a+16>>2],0|_&&(p=a+20|0,u=0|kf[p>>2],(0|u)!=(0|_)&&(kf[p>>2]=u+(20*~(((u+-20-_|0)>>>0)/20|0)|0)),mf(_)),_=0|kf[a>>2],0|_&&(u=a+4|0,(0|kf[u>>2])!=(0|_)&&(kf[u>>2]=_),mf(_)),!k){V=0;break e}break;case 1:if(!((0|N)>(0|c)|(0|N)==(0|c)&y>>>0>f>>>0)){V=0;break e}if(c=0|If[m+f>>0],f=0|tc(0|v,0|d,2,0),k=O,kf[k>>2]=f,kf[k+4>>2]=qf,(255&c)>6){kf[n>>2]=255&c,0|Xl(4934,n),V=0;break e}if(k=0|tc(0|v,0|d,6,0),_=qf,(0|N)<(0|_)|(0|N)==(0|_)&y>>>0<k>>>0){V=0;break e}if(u=m+f|0,f=Lf[u>>0]|Lf[u+1>>0]<<8|Lf[u+2>>0]<<16|Lf[u+3>>0]<<24,u=O,kf[u>>2]=k,kf[u+4>>2]=_,!A){_=0;do u=0|Mp[127&kf[(0|kf[F>>2])+20>>2]](e,_),k=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,m=0|kf[(0|kf[(0|kf[k>>2])+8>>2])+(u<<2)>>2],0|Ys(m,f),If[m+84>>0]=1,u=0|kf[m+68>>2],k=m+72|0,m=0|kf[k>>2],(0|m)!=(0|u)&&(kf[k>>2]=m+(~((m+-4-u|0)>>>2)<<2)),_=_+1|0;while(_>>>0<P>>>0)}switch(rr(s,r),c<<24>>24){case 0:it(a,B),_=0|Fe(a,t,s),st(a),_?g=77:U=1;break;case 1:it(a,B),_=0|Ne(a,t,s),st(a),_?g=77:U=1;break;case 2:rt(a,B),_=0|Ve(a,t,s),dt(a),_?g=77:U=1;break;case 3:rt(a,B),_=0|Be(a,t,s),dt(a),_?g=77:U=1;break;case 4:et(a,B),_=0|_e(a,t,s),Je(a),_?g=77:U=1;break;case 5:et(a,B),_=0|pe(a,t,s),Je(a),_?g=77:U=1;break;case 6:et(a,B),_=0|fe(a,t,s),Je(a),_?g=77:U=1;break;default:U=1}if(77==(0|g)&&(U=0),_=0|kf[s+16>>2],0|_&&(f=s+20|0,u=0|kf[f>>2],(0|u)!=(0|_)&&(kf[f>>2]=u+(20*~(((u+-20-_|0)>>>0)/20|0)|0)),mf(_)),_=0|kf[s>>2],0|_&&(u=s+4|0,(0|kf[u>>2])!=(0|_)&&(kf[u>>2]=_),mf(_)),0|U){V=0;break e}break;default:V=0;break e}V=1}else V=0;while(0);return U=0|kf[r>>2],0|U&&(r=0|kf[D>>2],(0|r)!=(0|U)&&(kf[D>>2]=r+(20*~(((r+-20-U|0)>>>0)/20|0)|0)),mf(U)),L=V,Xf=i,0|L}function ir(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=wp,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0;if(!n)return r=0,0|r;do switch(0|kf[e+28>>2]){case 1:if(s=e+24|0,a=0|If[s>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)if(o=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,c=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=o+c|0,0|If[e+32>>0])for(o=0,c=h;;){if(d=ap(ap(0|If[c>>0])/ap(127)),Gf[n+(o<<2)>>2]=d,o=o+1|0,l=0|If[s>>0],(0|o)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){u=l;break}c=c+1|0}else for(c=0,o=h;;){if(d=ap(0|If[o>>0]),Gf[n+(c<<2)>>2]=d,c=c+1|0,l=0|If[s>>0],(0|c)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){u=l;break}o=o+1|0}else u=a;return c=u<<24>>24,u<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(c<<2)|0,0,(i<<24>>24)-c<<2|0),r=1,0|r);case 2:if(c=e+24|0,o=0|If[c>>0],(o<<24>>24>i<<24>>24?i:o)<<24>>24>0)if(s=0|kf[kf[e>>2]>>2],h=e+40|0,l=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,f=0|tc(0|l,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=s+f|0,0|If[e+32>>0])for(s=0,f=h;;){if(d=ap(ap(0|Lf[f>>0])/ap(255)),Gf[n+(s<<2)>>2]=d,s=s+1|0,a=0|If[c>>0],(0|s)>=((a<<24>>24>i<<24>>24?i:a)<<24>>24|0)){p=a;break}f=f+1|0}else for(f=0,s=h;;){if(d=ap(0|Lf[s>>0]),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){p=l;break}s=s+1|0}else p=o;return f=p<<24>>24,p<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 3:if(f=e+48|0,s=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|s,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,s=0|If[c>>0],(s<<24>>24>i<<24>>24?i:s)<<24>>24>0)if(0|If[e+32>>0])for(a=0,f=h;;){if(d=ap(ap(0|xf[f>>1])/ap(32767)),Gf[n+(a<<2)>>2]=d,a=a+1|0,o=0|If[c>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){_=o;break}f=f+2|0}else for(f=0,a=h;;){if(d=ap(0|xf[a>>1]),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){_=l;break}a=a+2|0}else _=s;return f=_<<24>>24,_<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 4:if(f=e+48|0,a=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|a,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,a=0|If[c>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)if(0|If[e+32>>0])for(o=0,f=h;;){if(d=ap(ap(0|Ff[f>>1])/ap(65535)),Gf[n+(o<<2)>>2]=d,o=o+1|0,s=0|If[c>>0],(0|o)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){m=s;break}f=f+2|0}else for(f=0,o=h;;){if(d=ap(0|Ff[o>>1]),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){m=l;break}o=o+2|0}else m=a;return f=m<<24>>24,m<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 5:if(f=e+48|0,o=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|o,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,o=0|If[c>>0],(o<<24>>24>i<<24>>24?i:o)<<24>>24>0)if(0|If[e+32>>0])for(s=0,f=h;;){if(d=ap(ap(0|kf[f>>2])*ap(4.65661287e-10)),Gf[n+(s<<2)>>2]=d,s=s+1|0,a=0|If[c>>0],(0|s)>=((a<<24>>24>i<<24>>24?i:a)<<24>>24|0)){A=a;break}f=f+4|0}else for(f=0,s=h;;){if(d=ap(0|kf[s>>2]),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){A=l;break}s=s+4|0}else A=o;return f=A<<24>>24,A<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 6:if(f=e+48|0,s=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|s,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,s=0|If[c>>0],(s<<24>>24>i<<24>>24?i:s)<<24>>24>0)if(0|If[e+32>>0])for(a=0,f=h;;){if(d=ap(ap((0|kf[f>>2])>>>0)*ap(2.32830644e-10)),Gf[n+(a<<2)>>2]=d,a=a+1|0,o=0|If[c>>0],(0|a)>=((o<<24>>24>i<<24>>24?i:o)<<24>>24|0)){v=o;break}f=f+4|0}else for(f=0,a=h;;){if(d=ap((0|kf[a>>2])>>>0),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){v=l;break}a=a+4|0}else v=s;return f=v<<24>>24,v<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 7:if(f=e+48|0,a=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|a,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,a=0|If[c>>0],(a<<24>>24>i<<24>>24?i:a)<<24>>24>0)if(0|If[e+32>>0])for(o=0,f=h;;){if(s=f,d=ap(ap(+((0|kf[s>>2])>>>0)+4294967296*+(0|kf[s+4>>2]))*ap(1.08420217e-19)),Gf[n+(o<<2)>>2]=d,o=o+1|0,s=0|If[c>>0],(0|o)>=((s<<24>>24>i<<24>>24?i:s)<<24>>24|0)){y=s;break}f=f+8|0}else for(f=0,o=h;;){if(l=o,d=ap(+((0|kf[l>>2])>>>0)+4294967296*+(0|kf[l+4>>2])),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){y=l;break}o=o+8|0}else y=a;return f=y<<24>>24,y<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 8:if(f=e+48|0,o=0|kf[f>>2],c=0|kf[f+4>>2],f=e+40|0,h=(0|tc(0|pl(0|kf[f>>2],0|kf[f+4>>2],0|kf[t>>2],0),0|qf,0|o,0|c))+(0|kf[kf[e>>2]>>2])|0,c=e+24|0,o=0|If[c>>0],(o<<24>>24>i<<24>>24?i:o)<<24>>24>0)if(0|If[e+32>>0])for(s=0,f=h;;){if(a=f,d=ap(ap(+((0|kf[a>>2])>>>0)+4294967296*+((0|kf[a+4>>2])>>>0))*ap(5.42101086e-20)),Gf[n+(s<<2)>>2]=d,s=s+1|0,a=0|If[c>>0],(0|s)>=((a<<24>>24>i<<24>>24?i:a)<<24>>24|0)){g=a;break}f=f+8|0}else for(f=0,s=h;;){if(l=s,d=ap(+((0|kf[l>>2])>>>0)+4294967296*+((0|kf[l+4>>2])>>>0)),Gf[n+(f<<2)>>2]=d,f=f+1|0,l=0|If[c>>0],(0|f)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){g=l;break}s=s+8|0}else g=o;return f=g<<24>>24,g<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(f<<2)|0,0,(i<<24>>24)-f<<2|0),r=1,0|r);case 9:if(f=e+24|0,s=0|If[f>>0],(s<<24>>24>i<<24>>24?i:s)<<24>>24>0)for(c=0|kf[kf[e>>2]>>2],h=e+40|0,a=0|pl(0|kf[h>>2],0|kf[h+4>>2],0|kf[t>>2],0),h=e+48|0,l=0|tc(0|a,0|qf,0|kf[h>>2],0|kf[h+4>>2]),h=0,a=c+l|0;;){if(kf[n+(h<<2)>>2]=kf[a>>2],h=h+1|0,l=0|If[f>>0],(0|h)>=((l<<24>>24>i<<24>>24?i:l)<<24>>24|0)){b=l;break}a=a+4|0}else b=s;return a=b<<24>>24,b<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(a<<2)|0,0,(i<<24>>24)-a<<2|0),r=1,0|r);case 10:if(a=e+24|0,h=0|If[a>>0],(h<<24>>24>i<<24>>24?i:h)<<24>>24>0)for(f=0|kf[kf[e>>2]>>2],o=e+40|0,
l=0|pl(0|kf[o>>2],0|kf[o+4>>2],0|kf[t>>2],0),o=e+48|0,c=0|tc(0|l,0|qf,0|kf[o>>2],0|kf[o+4>>2]),o=0,l=f+c|0;;){if(d=ap(+zf[l>>3]),Gf[n+(o<<2)>>2]=d,o=o+1|0,c=0|If[a>>0],(0|o)>=((c<<24>>24>i<<24>>24?i:c)<<24>>24|0)){E=c;break}l=l+8|0}else E=h;return l=E<<24>>24,E<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(l<<2)|0,0,(i<<24>>24)-l<<2|0),r=1,0|r);case 11:if(l=e+24|0,o=0|If[l>>0],(o<<24>>24>i<<24>>24?i:o)<<24>>24>0)for(a=0|kf[kf[e>>2]>>2],s=e+40|0,c=0|pl(0|kf[s>>2],0|kf[s+4>>2],0|kf[t>>2],0),s=e+48|0,f=0|tc(0|c,0|qf,0|kf[s>>2],0|kf[s+4>>2]),s=0,c=a+f|0;;){if(d=ap(0!=(0|If[c>>0])&1),Gf[n+(s<<2)>>2]=d,s=s+1|0,f=0|If[l>>0],(0|s)>=((f<<24>>24>i<<24>>24?i:f)<<24>>24|0)){T=f;break}c=c+1|0}else T=o;return c=T<<24>>24,T<<24>>24>=i<<24>>24?(r=1,0|r):(0|Bs(n+(c<<2)|0,0,(i<<24>>24)-c<<2|0),r=1,0|r);default:return r=0,0|r}while(0);return 0}function nr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0,v=0,y=0,g=0,b=0,E=0,T=0,S=0,w=0,C=0,M=0,P=0,I=0,R=0,x=0,O=0,k=0,D=0,L=0,N=0,F=0,B=0,V=0,U=0,G=0,W=0,z=0,H=0,j=0,Y=0,X=0,Z=0,K=0,Q=0,J=0,q=0,$=0,ee=0,te=0,ie=0,ne=0,re=0,se=0,ae=0,oe=0,he=0,le=0,ce=0,de=0,ue=0,fe=0,pe=0,_e=0,me=0,Ae=0,ve=0,ye=0,ge=0,be=0,Ee=0,Te=0;n=Xf,Xf=Xf+48|0,r=n+24|0,s=n,a=e+12|0,o=0|kf[a>>2],kf[r>>2]=0,h=r+4|0,kf[h>>2]=0,kf[r+8>>2]=0;do if(o){if(!(o>>>0>1073741823)){l=o<<2,c=0|sl(l),kf[r>>2]=c,d=c+(o<<2)|0,kf[r+8>>2]=d,0|Bs(0|c,0,0|l),kf[h>>2]=d,u=d,f=c;break}Du(r)}else u=0,f=0;while(0);c=e+116|0,d=0|kf[c>>2],l=0|kf[d>>2],p=d+4|0,l?(o=0|kf[p>>2],(0|o)!=(0|l)&&(kf[p>>2]=o+(~((o+-4-l|0)>>>2)<<2)),mf(l),l=d+8|0,kf[l>>2]=0,kf[p>>2]=0,kf[d>>2]=0,_=0|kf[r>>2],m=0|kf[h>>2],A=0|kf[a>>2],v=l):(_=f,m=u,A=o,v=d+8|0),kf[d>>2]=_,kf[p>>2]=m,kf[v>>2]=kf[r+8>>2],kf[r>>2]=0,v=r+4|0,kf[v>>2]=0,kf[r+8>>2]=0;do if(A){if(!(A>>>0>1073741823)){m=A<<2,p=0|sl(m),kf[r>>2]=p,_=p+(A<<2)|0,kf[r+8>>2]=_,0|Bs(0|p,0,0|m),kf[v>>2]=_,y=_,g=p;break}Du(r)}else y=0,g=0;while(0);A=e+128|0,p=0|kf[A>>2],_=0|kf[p>>2],m=p+4|0,_?(y=0|kf[m>>2],(0|y)!=(0|_)&&(kf[m>>2]=y+(~((y+-4-_|0)>>>2)<<2)),mf(_),_=p+8|0,kf[_>>2]=0,kf[m>>2]=0,kf[p>>2]=0,b=0|kf[r>>2],E=0|kf[v>>2],T=_):(b=g,E=y,T=p+8|0),kf[p>>2]=b,kf[m>>2]=E,kf[T>>2]=kf[r+8>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=0,kf[s+12>>2]=0,kf[s+16>>2]=0,kf[s+20>>2]=0,T=s+8|0,E=s+4|0,m=s+16|0,b=s+20|0,gn(s),p=0|kf[E>>2],_=(0|kf[b>>2])+(0|kf[m>>2])|0,S=(0|kf[T>>2])==(0|p)?0:(0|kf[p+(((_>>>0)/341|0)<<2)>>2])+(12*((_>>>0)%341|0)|0)|0,kf[S>>2]=t,kf[S+4>>2]=0,kf[S+8>>2]=0,S=(0|kf[b>>2])+1|0,kf[b>>2]=S;e:do if(S)for(_=e+104|0,p=r+4|0,v=r+8|0,y=e+8|0,g=e+92|0,d=e+48|0,l=e+44|0,h=e+36|0,o=e+4|0,u=e+16|0,f=e+88|0,C=e+76|0,M=e+84|0,P=r+4|0,I=r+8|0,R=S;;){if(x=0|kf[m>>2],O=R+-1|0,k=x+O|0,D=0|kf[E>>2],L=0|kf[D+(((k>>>0)/341|0)<<2)>>2],N=(k>>>0)%341|0,k=0|kf[L+(12*N|0)>>2],F=0|kf[L+(12*N|0)+4>>2],B=0|kf[L+(12*N|0)+8>>2],kf[b>>2]=O,O=0|kf[T>>2],N=O-D>>2,(1-R-x+(0==(0|N)?0:(341*N|0)+-1|0)|0)>>>0>681&&(mf(0|kf[O+-4>>2]),kf[T>>2]=(0|kf[T>>2])+-4),O=0|kf[c>>2],N=O+(12*B|0)|0,k>>>0>t>>>0){w=0;break e}if(x=0|kf[a>>2],D=(x+-1|0)==(0|F)?0:F+1|0,D>>>0>=x>>>0){w=0;break e}x=(0|kf[A>>2])+(12*B|0)|0,F=(0|kf[e>>2])-(0|kf[(0|kf[x>>2])+(D<<2)>>2])|0;t:do if(F){if(k>>>0>=3){if((0|kf[y>>2])>>>0>(0|kf[o>>2])>>>0){w=0;break e}L=B+1|0,Wt(O+(12*L|0)|0,0|kf[N>>2],0|kf[O+(12*B|0)+4>>2]),V=(0|kf[(0|kf[c>>2])+(12*L|0)>>2])+(D<<2)|0,kf[V>>2]=(0|kf[V>>2])+(1<<F+-1),V=31^(0|sp(0|k)),kf[r>>2]=0,Vs(u,V,r),V=(k>>>1)-(0|kf[r>>2])|0,W=k-V|0;i:do if((0|V)==(0|W))z=V,H=V;else{G=0|kf[f>>2],U=0|kf[M>>2];do if((0|U)!=(0|kf[C>>2])){if(j=0!=(kf[U>>2]&1<<31-G|0),Y=G+1|0,kf[f>>2]=Y,32==(0|Y)){if(kf[M>>2]=U+4,kf[f>>2]=0,j){z=V,H=W;break i}break}if(j){z=V,H=W;break i}break}while(0);z=W,H=V}while(0);V=0|kf[A>>2],W=0|kf[V+(12*B|0)>>2],U=W+(D<<2)|0,kf[U>>2]=(0|kf[U>>2])+1,Wt(V+(12*L|0)|0,W,0|kf[V+(12*B|0)+4>>2]),0|z&&(V=0|kf[T>>2],W=0|kf[E>>2],U=V-W>>2,G=0|kf[m>>2],j=0|kf[b>>2],(0|(0==(0|U)?0:(341*U|0)+-1|0))==(j+G|0)?(gn(s),X=0|kf[m>>2],Z=0|kf[b>>2],K=0|kf[T>>2],Q=0|kf[E>>2]):(X=G,Z=j,K=V,Q=W),W=Z+X|0,J=(0|K)==(0|Q)?0:(0|kf[Q+(((W>>>0)/341|0)<<2)>>2])+(12*((W>>>0)%341|0)|0)|0,kf[J>>2]=z,kf[J+4>>2]=D,kf[J+8>>2]=B,kf[b>>2]=(0|kf[b>>2])+1),0|H&&(W=0|kf[T>>2],V=0|kf[E>>2],j=W-V>>2,G=0|kf[m>>2],U=0|kf[b>>2],(0|(0==(0|j)?0:(341*j|0)+-1|0))==(U+G|0)?(gn(s),q=0|kf[m>>2],$=0|kf[b>>2],ee=0|kf[T>>2],te=0|kf[E>>2]):(q=G,$=U,ee=W,te=V),V=$+q|0,ie=(0|ee)==(0|te)?0:(0|kf[te+(((V>>>0)/341|0)<<2)>>2])+(12*((V>>>0)%341|0)|0)|0,kf[ie>>2]=H,kf[ie+4>>2]=D,kf[ie+8>>2]=L,kf[b>>2]=(0|kf[b>>2])+1);break}if(V=0|kf[_>>2],kf[V>>2]=D,W=0|kf[a>>2],W>>>0>1)for(U=W,G=D,j=1;;){if(G=(0|G)==(U+-1|0)?0:G+1|0,kf[V+(j<<2)>>2]=G,j=j+1|0,Y=0|kf[a>>2],j>>>0>=Y>>>0){ne=Y;break}U=Y}else ne=W;if(0|k)for(U=ne,j=0;;){if(U){G=0|kf[_>>2],V=0|kf[g>>2],L=0|kf[x>>2],Y=0;do{se=G+(Y<<2)|0,kf[V+(kf[se>>2]<<2)>>2]=0,ae=0|kf[se>>2],oe=(0|kf[e>>2])-(0|kf[L+(ae<<2)>>2])|0;do if(0|oe){if(he=V+(ae<<2)|0,le=0|kf[d>>2],ce=32-le|0,(0|oe)>(0|ce)){if(de=0|kf[l>>2],ue=de+4|0,(0|ue)==(0|kf[h>>2])){kf[he>>2]=0;break}fe=kf[de>>2]<<le,de=oe-ce|0,kf[d>>2]=de,kf[l>>2]=ue,pe=32-de|0,kf[he>>2]=(0|kf[ue>>2])>>>pe|fe>>>(pe-ce|0);break}if(ce=0|kf[l>>2],(0|ce)==(0|kf[h>>2])){kf[he>>2]=0;break}if(kf[he>>2]=kf[ce>>2]<<le>>>(32-oe|0),le=(0|kf[d>>2])+oe|0,kf[d>>2]=le,32!=(0|le))break;kf[l>>2]=ce+4,kf[d>>2]=0}while(0);oe=0|kf[se>>2],ae=V+(oe<<2)|0,kf[ae>>2]=kf[ae>>2]|kf[(0|kf[N>>2])+(oe<<2)>>2],Y=Y+1|0}while(Y>>>0<(0|kf[a>>2])>>>0);re=V}else re=0|kf[g>>2];if(V=0|kf[re>>2],kf[r>>2]=V,kf[p>>2]=kf[re+4>>2],kf[v>>2]=kf[re+8>>2],Y=0|kf[i>>2],L=Y+4|0,G=0|kf[L>>2],G>>>0<(0|kf[Y+8>>2])>>>0?(kf[G>>2]=V,kf[G+4>>2]=kf[p>>2],kf[G+8>>2]=kf[v>>2],kf[L>>2]=G+12):Ai(Y,r),kf[y>>2]=(0|kf[y>>2])+1,Y=j+1|0,Y>>>0>=k>>>0)break t;U=0|kf[a>>2],j=Y}}else if(0|k){L=0;do V=0|kf[N>>2],U=0|kf[V>>2],kf[r>>2]=U,kf[P>>2]=kf[V+4>>2],kf[I>>2]=kf[V+8>>2],V=0|kf[i>>2],G=V+4|0,W=0|kf[G>>2],W>>>0<(0|kf[V+8>>2])>>>0?(kf[W>>2]=U,kf[W+4>>2]=kf[P>>2],kf[W+8>>2]=kf[I>>2],kf[G>>2]=W+12):Ai(V,r),kf[y>>2]=(0|kf[y>>2])+1,L=L+1|0;while(L>>>0<k>>>0)}while(0);if(R=0|kf[b>>2],!R){w=1;break}}else w=1;while(0);a=0|kf[E>>2],r=0|kf[m>>2],i=a+(((r>>>0)/341|0)<<2)|0,re=0|kf[T>>2],e=re,ne=a,(0|re)==(0|a)?(_e=0,me=0):(ie=(0|kf[b>>2])+r|0,_e=(0|kf[a+(((ie>>>0)/341|0)<<2)>>2])+(12*((ie>>>0)%341|0)|0)|0,me=(0|kf[i>>2])+(12*((r>>>0)%341|0)|0)|0),r=i,i=me;e:for(;;){me=i;do{if(ie=me,(0|ie)==(0|_e))break e;me=ie+12|0}while(4092!=(me-(0|kf[r>>2])|0));me=r+4|0,r=me,i=0|kf[me>>2]}if(kf[b>>2]=0,b=e-ne>>2,b>>>0>2){ne=a;do mf(0|kf[ne>>2]),ne=(0|kf[E>>2])+4|0,kf[E>>2]=ne,Ae=0|kf[T>>2],ve=Ae-ne>>2;while(ve>>>0>2);ye=ne,ge=Ae,be=ve}else ye=a,ge=re,be=b;switch(0|be){case 1:Ee=170,Te=90;break;case 2:Ee=341,Te=90}if(90==(0|Te)&&(kf[m>>2]=Ee),(0|ye)!=(0|ge)){Ee=ye;do mf(0|kf[Ee>>2]),Ee=Ee+4|0;while((0|Ee)!=(0|ge));ge=0|kf[E>>2],E=0|kf[T>>2],(0|E)!=(0|ge)&&(kf[T>>2]=E+(~((E+-4-ge|0)>>>2)<<2))}return(ge=0|kf[s>>2])?(mf(ge),Xf=n,0|w):(Xf=n,0|w)}function rr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;if(kf[e>>2]=0,i=e+4|0,kf[i>>2]=0,kf[e+8>>2]=0,n=e+16|0,da(n,t),kf[e+28>>2]=0,t=0|kf[e+20>>2],r=0|kf[n>>2],n=r,(0|t)!=(0|r)){s=(t-r|0)/20|0,r=0,t=0;do a=0|np(0|kf[n+(20*r|0)+16>>2],0|kf[n+(20*r|0)+12>>2]),t=t>>>0<a>>>0?a:t,r=r+1|0;while(r>>>0<s>>>0);if(s=0|kf[i>>2],r=0|kf[e>>2],n=s-r|0,t>>>0>n>>>0)return qr(e,t-n|0),o=0|kf[e>>2],h=e+12|0,void(kf[h>>2]=o);l=s,c=r,d=t,u=n}else n=0|kf[i>>2],t=0|kf[e>>2],l=n,c=t,d=0,u=n-t|0;return d>>>0>=u>>>0?(o=c,h=e+12|0,void(kf[h>>2]=o)):(u=c+d|0,(0|l)==(0|u)?(o=c,h=e+12|0,void(kf[h>>2]=o)):(kf[i>>2]=u,o=c,h=e+12|0,void(kf[h>>2]=o)))}function sr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=8192?(8192!=(0|a)?(r=o+32768|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,8192-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>8192){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=8192==(0|a),0|l)}function ar(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(n=e+4|0,r=0|kf[n>>2],s=0|kf[e>>2],a=r-s>>2,o=s,s=r,a>>>0>=4096?(4096!=(0|a)?(r=o+16384|0,(0|s)!=(0|r)):0)&&(kf[n>>2]=s+(~((s+-4-r|0)>>>2)<<2)):Kr(e,4096-a|0),a=e+12|0,r=e+16|0,s=0|kf[r>>2],n=0|kf[a>>2],o=s-n>>3,h=n,n=s,o>>>0>=i>>>0){if((o>>>0>i>>>0?(s=h+(i<<3)|0,(0|n)!=(0|s)):0)&&(kf[r>>2]=n+(~((n+-8-s|0)>>>3)<<3)),!i)return l=0,0|l}else Ei(a,i-o|0);o=0|kf[a>>2],a=0,s=0;do{if(n=t+(s<<2)|0,kf[o+(s<<3)>>2]=kf[n>>2],kf[o+(s<<3)+4>>2]=a,r=a,a=(0|kf[n>>2])+a|0,a>>>0>4096){l=0,c=19;break}if(r>>>0<a>>>0){n=0|kf[e>>2],h=r;do kf[n+(h<<2)>>2]=s,h=h+1|0;while((0|h)!=(0|a))}s=s+1|0}while(s>>>0<i>>>0);return 19==(0|c)?0|l:(l=4096==(0|a),0|l)}function or(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=Xf,Xf=Xf+224|0,r=n+120|0,s=n+80|0,a=n,o=n+136|0,h=s,l=h+40|0;do kf[h>>2]=0,h=h+4|0;while((0|h)<(0|l));return kf[r>>2]=kf[i>>2],(0|Di(0,t,r,a,s))<0?c=-1:(d=(0|kf[e+76>>2])>-1?0|Ef(e):0,i=0|kf[e>>2],h=32&i,(0|If[e+74>>0])<1&&(kf[e>>2]=i&-33),i=e+48|0,0|kf[i>>2]?m=0|Di(e,t,r,a,s):(l=e+44|0,u=0|kf[l>>2],kf[l>>2]=o,f=e+28|0,kf[f>>2]=o,p=e+20|0,kf[p>>2]=o,kf[i>>2]=80,_=e+16|0,kf[_>>2]=o+80,o=0|Di(e,t,r,a,s),u?(0|Pp[31&kf[e+36>>2]](e,0,0),A=0==(0|kf[p>>2])?-1:o,kf[l>>2]=u,kf[i>>2]=0,kf[_>>2]=0,kf[f>>2]=0,kf[p>>2]=0,m=A):m=o),s=0|kf[e>>2],kf[e>>2]=s|h,0|d&&bf(e),c=0==(32&s|0)?m:-1),Xf=n,0|c}function hr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;if(i=e+4|0,n=0|kf[i>>2],r=0|kf[e>>2],s=n-r>>2,a=n,s>>>0<t>>>0)return void mt(e,t-s|0);if(!(s>>>0<=t>>>0)&&(s=r+(t<<2)|0,(0|a)!=(0|s))){o=a;do a=o+-4|0,kf[i>>2]=a,t=0|kf[a>>2],kf[a>>2]=0,0|t&&(a=t+88|0,r=0|kf[a>>2],kf[a>>2]=0,0|r&&(a=0|kf[r+8>>2],0|a&&(e=r+12|0,(0|kf[e>>2])!=(0|a)&&(kf[e>>2]=a),mf(a)),mf(r)),r=0|kf[t+68>>2],0|r&&(a=t+72|0,e=0|kf[a>>2],(0|e)!=(0|r)&&(kf[a>>2]=e+(~((e+-4-r|0)>>>2)<<2)),mf(r)),r=t+64|0,e=0|kf[r>>2],kf[r>>2]=0,0|e&&(r=0|kf[e>>2],0|r&&(a=e+4|0,(0|kf[a>>2])!=(0|r)&&(kf[a>>2]=r),mf(r)),mf(e)),mf(t)),o=0|kf[i>>2];while((0|o)!=(0|s))}}function lr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0;if(n=e+8|0,r=0|kf[n>>2],s=e+4|0,a=0|kf[s>>2],o=a,r-a>>2>>>0>=t>>>0){for(h=o,l=t;;){if(kf[h>>2]=kf[i>>2],l=l+-1|0,!l)break;h=h+4|0}return void(kf[s>>2]=o+(t<<2))}o=0|kf[e>>2],h=a-o|0,a=h>>2,l=a+t|0,l>>>0>1073741823&&Du(e),c=r-o|0,r=c>>1,d=c>>2>>>0<536870911?r>>>0<l>>>0?l:r:1073741823;do if(d){if(!(d>>>0>1073741823)){u=0|sl(d<<2);break}r=0|dp(8),cd(r,13392),kf[r>>2]=4748,fp(0|r,1128,101)}else u=0;while(0);for(r=u+(a<<2)|0,l=u+(d<<2)|0,d=r,u=t;;){if(kf[d>>2]=kf[i>>2],u=u+-1|0,!u)break;d=d+4|0}d=r+(0-a<<2)|0,(0|h)>0&&0|ui(0|d,0|o,0|h),kf[e>>2]=d,kf[s>>2]=r+(t<<2),kf[n>>2]=l,o&&mf(o)}function cr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0,m=0,A=0;n=(0|kf[e>>2])+1794895138|0,r=0|Gd(0|kf[e+8>>2],n),s=0|Gd(0|kf[e+12>>2],n),a=0|Gd(0|kf[e+16>>2],n);e:do if((r>>>0<t>>>2>>>0?(o=t-(r<<2)|0,s>>>0<o>>>0&a>>>0<o>>>0):0)?0==(3&(a|s)|0):0){for(o=s>>>2,h=a>>>2,l=0,c=r;;){if(d=c>>>1,u=l+d|0,f=u<<1,p=f+o|0,_=0|Gd(0|kf[e+(p<<2)>>2],n),m=0|Gd(0|kf[e+(p+1<<2)>>2],n),!(m>>>0<t>>>0&_>>>0<(t-m|0)>>>0)){A=0;break e}if(0|If[e+(m+_)>>0]){A=0;break e}if(_=0|Co(i,e+m|0),!_)break;if(m=(0|_)<0,1==(0|c)){A=0;break e}l=m?l:u,c=m?d:c-d|0}c=f+h|0,l=0|Gd(0|kf[e+(c<<2)>>2],n),o=0|Gd(0|kf[e+(c+1<<2)>>2],n),A=o>>>0<t>>>0&l>>>0<(t-o|0)>>>0&&0==(0|If[e+(o+l)>>0])?e+o|0:0}else A=0;while(0);return 0|A}function dr(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;r=Xf,Xf=Xf+64|0,s=r,a=0|kf[e>>2],o=e+(0|kf[a+-8>>2])|0,h=0|kf[a+-4>>2],kf[s>>2]=i,kf[s+4>>2]=e,kf[s+8>>2]=t,kf[s+12>>2]=n,n=s+16|0,t=s+20|0,e=s+24|0,a=s+28|0,l=s+32|0,c=s+40|0,d=n,u=d+36|0;do kf[d>>2]=0,d=d+4|0;while((0|d)<(0|u));xf[n+36>>1]=0,If[n+38>>0]=0;e:do if(0|Ud(h,i,0))kf[s+48>>2]=1,Np[3&kf[(0|kf[h>>2])+20>>2]](h,s,o,o,1,0),f=1==(0|kf[e>>2])?o:0;else{switch(Lp[3&kf[(0|kf[h>>2])+24>>2]](h,s,o,1,0),0|kf[s+36>>2]){case 0:f=1==(0|kf[c>>2])&1==(0|kf[a>>2])&1==(0|kf[l>>2])?0|kf[t>>2]:0;break e;case 1:break;default:f=0;break e}if(1!=(0|kf[e>>2])?!(0==(0|kf[c>>2])&1==(0|kf[a>>2])&1==(0|kf[l>>2])):0){f=0;break}f=0|kf[n>>2]}while(0);return Xf=r,0|f}function ur(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=wp,p=0;if(i=Xf,Xf=Xf+32|0,n=i+16|0,r=i,s=e+8|0,a=If[(0|kf[s>>2])+24>>0]<<2,o=0|kf[e+16>>2],h=0|kf[o+80>>2]?(0|kf[kf[o>>2]>>2])+(0|kf[o+48>>2])|0:0,kf[r>>2]=-1,kf[r+4>>2]=-1,kf[r+8>>2]=-1,kf[r+12>>2]=-1,o=0|kf[e+24>>2],(o+-2|0)>>>0>28)return l=0,Xf=i,0|l;if(kf[r>>2]=o,e=1<<o,kf[r+4>>2]=e+-1,o=e+-2|0,e=r+8|0,kf[e>>2]=o,kf[r+12>>2]=(0|o)/2|0,!t)return l=1,Xf=i,0|l;for(c=o,o=0,d=0,u=0;;){if(f=ap(ap(1)/ap(0|c)),xt(r,ap(ap(0|kf[h+(u<<2)>>2])*f),ap(ap(0|kf[h+((1|u)<<2)>>2])*f),n),0|ui((0|kf[kf[(0|kf[s>>2])+64>>2]>>2])+d|0,0|n,0|a),p=o+1|0,(0|p)==(0|t)){l=1;break}c=0|kf[e>>2],o=p,d=d+a|0,u=u+2|0}return Xf=i,0|l}function fr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return(n=0|kn(e,t))?(t=0|kf[n+20>>2],8!=((0|kf[n+24>>2])-t|0)?(r=0,0|r):(n=t,If[Yf>>0]=If[n>>0],If[Yf+1>>0]=If[n+1>>0],If[Yf+2>>0]=If[n+2>>0],If[Yf+3>>0]=If[n+3>>0],If[Yf+4>>0]=If[n+4>>0],If[Yf+5>>0]=If[n+5>>0],If[Yf+6>>0]=If[n+6>>0],If[Yf+7>>0]=If[n+7>>0],zf[Yf>>3]=+zf[Yf>>3],If[i>>0]=If[Yf>>0],If[i+1>>0]=If[Yf+1>>0],If[i+2>>0]=If[Yf+2>>0],If[i+3>>0]=If[Yf+3>>0],If[i+4>>0]=If[Yf+4>>0],If[i+5>>0]=If[Yf+5>>0],If[i+6>>0]=If[Yf+6>>0],If[i+7>>0]=If[Yf+7>>0],r=1,0|r)):(r=0,0|r)}function pr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(t=e+12|0,i=0|kf[e>>2],n=e+8|0,r=0|kf[n>>2],s=(0|r)==-1,!(0|If[t>>0])){do{if((s?0:(a=(0==((r>>>0)%3|0|0)?2:-1)+r|0,(0|a)!=-1))?(o=0|kf[(0|kf[i+12>>2])+(a<<2)>>2],(0|o)!=-1):0){if((o>>>0)%3|0){h=o+-1|0;break}h=o+2|0;break}h=-1}while(0);return void(kf[n>>2]=h)}if(h=r+1|0,(s?0:(s=0==((h>>>0)%3|0|0)?r+-2|0:h,(0|s)!=-1))?(h=0|kf[(0|kf[i+12>>2])+(s<<2)>>2],s=h+1|0,(0|h)!=-1):0){if(r=0==((s>>>0)%3|0|0)?h+-2|0:s,kf[n>>2]=r,(0|r)!=-1){if((0|r)!=(0|kf[e+4>>2]))return;return void(kf[n>>2]=-1)}}else kf[n>>2]=-1;r=0|kf[e+4>>2];do{if(((0|r)!=-1?(e=(0==((r>>>0)%3|0|0)?2:-1)+r|0,(0|e)!=-1):0)?(s=0|kf[(0|kf[i+12>>2])+(e<<2)>>2],(0|s)!=-1):0){if((s>>>0)%3|0){l=s+-1|0;break}l=s+2|0;break}l=-1}while(0);kf[n>>2]=l,If[t>>0]=0}function _r(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],a=s,n-s>>2>>>0>=t>>>0){for(o=a,h=t;;){if(kf[o>>2]=1,h=h+-1|0,!h)break;o=o+4|0}return void(kf[r>>2]=a+(t<<2))}a=0|kf[e>>2],o=s-a|0,s=o>>2,h=s+t|0,h>>>0>1073741823&&Du(e),l=n-a|0,n=l>>1,c=l>>2>>>0<536870911?n>>>0<h>>>0?h:n:1073741823;do if(c){if(!(c>>>0>1073741823)){d=0|sl(c<<2);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else d=0;while(0);for(n=d+(s<<2)|0,h=d+(c<<2)|0,c=n,d=t;;){if(kf[c>>2]=1,d=d+-1|0,!d)break;c=c+4|0}c=n+(0-s<<2)|0,(0|o)>0&&0|ui(0|c,0|a,0|o),kf[e>>2]=c,kf[r>>2]=n+(t<<2),kf[i>>2]=h,a&&mf(a)}function mr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=0|kf[e+4>>2],!i)return n=0,0|n;for(e=0|If[t+11>>0],r=e<<24>>24<0,s=r?0|kf[t+4>>2]:255&e,e=r?0|kf[t>>2]:t,t=i;;){if(i=t+16|0,r=0|If[i+11>>0],a=r<<24>>24<0,o=a?0|kf[t+20>>2]:255&r,r=o>>>0<s>>>0,h=r?o:s,c=(0!=(0|h)?(l=0|fo(e,a?0|kf[i>>2]:i,h),0!=(0|l)):0)?(0|l)<0?7:8:s>>>0<o>>>0?7:8,7==(0|c))c=0,d=t;else if(8==(0|c)){if(c=0,l=s>>>0<o>>>0?s:o,0!=(0|l)?(o=0|fo(a?0|kf[i>>2]:i,e,l),0!=(0|o)):0){if((0|o)>=0){n=1,c=14;break}}else c=10;if(10==(0|c)?(c=0,!r):0){n=1,c=14;break}d=t+4|0}if(t=0|kf[d>>2],!t){n=0,c=14;break}}return 14==(0|c)?0|n:0}function Ar(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return i=Xf,Xf=Xf+32|0,n=i+12|0,r=i,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,s=0|qs(t),s>>>0>4294967279&&Du(n),s>>>0<11?(If[n+11>>0]=s,s?(o=n,h=6):a=n):(l=s+16&-16,c=0|sl(l),kf[n>>2]=c,kf[n+8>>2]=l|-2147483648,kf[n+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|t,0|s),a=o),If[a+s>>0]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=r+11|0,If[s>>0]=4,kf[r>>2]=1701667182,If[r+4>>0]=0,a=0|kf[e+4>>2],d=(0!=(0|a)?(o=0|Ie(a,r,n),0!=(0|o)):0)?0|uo(e,0|kf[o+40>>2]):-1,(0|If[s>>0])<0&&mf(0|kf[r>>2]),(0|If[n+11>>0])>=0?(Xf=i,0|d):(mf(0|kf[n>>2]),Xf=i,0|d)}function vr(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0;if((0|t)==-2)s=0;else{a=0|kf[(0|kf[(0|kf[n+4>>2])+8>>2])+(i<<2)>>2];do if(1==(0|Cp[127&kf[(0|kf[n>>2])+8>>2]](n))){if(Et(e,n,t,i,r,65535&((0|Lf[n+36>>0])<<8|(0|Lf[n+37>>0]))),0|kf[e>>2])return;kf[e>>2]=0;break}while(0);n=0|sl(44),kf[n>>2]=1536,kf[n+4>>2]=a,a=n+8|0,kf[a>>2]=kf[r>>2],kf[a+4>>2]=kf[r+4>>2],kf[a+8>>2]=kf[r+8>>2],kf[a+12>>2]=kf[r+12>>2],kf[a+16>>2]=kf[r+16>>2],kf[a+20>>2]=kf[r+20>>2],Sa(n+32|0,r+24|0),kf[n>>2]=1592,s=n}kf[e>>2]=s}function yr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(t=e+8|0,i=0|kf[t>>2],n=e+16|0,0|If[i+84>>0])return r=0|kf[n>>2],0|r;if(e=0|kf[n>>2],!e)return r=0|kf[n>>2],0|r;if(s=e+84|0,!(0|If[s>>0]))return r=0|kf[n>>2],0|r;if(a=(0|kf[i+72>>2])-(0|kf[i+68>>2])>>2,If[s>>0]=0,s=e+68|0,o=e+72|0,e=0|kf[o>>2],h=0|kf[s>>2],l=e-h>>2,c=h,h=e,a>>>0<=l>>>0?(a>>>0<l>>>0?(e=c+(a<<2)|0,(0|h)!=(0|e)):0)?(kf[o>>2]=h+(~((h+-4-e|0)>>>2)<<2),d=i):d=i:(lr(s,a-l|0,1404),d=0|kf[t>>2]),0|If[d+84>>0])return r=0|kf[n>>2],0|r;if(t=0|kf[d+68>>2],l=t,a=(0|kf[d+72>>2])-t>>2,!a)return r=0|kf[n>>2],0|r;t=0|kf[(0|kf[n>>2])+68>>2],d=0;do kf[t+(d<<2)>>2]=kf[l+(d<<2)>>2],d=d+1|0;while(d>>>0<a>>>0);return r=0|kf[n>>2],0|r}function gr(e){e=0|e,rd(e),rd(e+16|0),rd(e+32|0),rd(e+48|0),rd(e+64|0),rd(e+80|0),rd(e+96|0),rd(e+112|0),rd(e+128|0),rd(e+144|0),rd(e+160|0),rd(e+176|0),rd(e+192|0),rd(e+208|0),rd(e+224|0),rd(e+240|0),rd(e+256|0),rd(e+272|0),rd(e+288|0),rd(e+304|0),rd(e+320|0),rd(e+336|0),rd(e+352|0),rd(e+368|0),rd(e+384|0),rd(e+400|0),rd(e+416|0),rd(e+432|0),rd(e+448|0),rd(e+464|0),rd(e+480|0),rd(e+496|0)}function br(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(i=e+8|0,n=0|kf[i>>2],r=0|If[n+24>>0],s=r<<24>>24,a=s<<1,o=0|ff(s>>>0>2147483647?-1:s<<1),h=0|kf[e+16>>2],l=0|kf[h+80>>2]?(0|kf[kf[h>>2]>>2])+(0|kf[h+48>>2])|0:0,!t)return void pf(o);if(r<<24>>24>0){for(r=0,h=0,e=0;;){for(c=0,d=e;;){if(xf[o+(c<<1)>>1]=kf[l+(d<<2)>>2],c=c+1|0,(0|c)==(0|s))break;d=d+1|0}if(0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+h|0,0|o,0|a),r=r+1|0,(0|r)==(0|t))break;h=h+a|0,e=s+e|0}return void pf(o)}if(0|ui(0|kf[kf[n+64>>2]>>2],0|o,0|a),1==(0|t))return void pf(o);u=1,f=0;do f=f+a|0,0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+f|0,0|o,0|a),u=u+1|0;while((0|u)!=(0|t));return void pf(o)}function Er(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(i=e+8|0,n=0|kf[i>>2],r=0|If[n+24>>0],s=r<<24>>24,a=s<<2,o=0|ff(s>>>0>1073741823?-1:s<<2),h=0|kf[e+16>>2],l=0|kf[h+80>>2]?(0|kf[kf[h>>2]>>2])+(0|kf[h+48>>2])|0:0,!t)return void pf(o);if(r<<24>>24>0){for(r=0,h=0,e=0;;){for(c=0,d=e;;){if(kf[o+(c<<2)>>2]=kf[l+(d<<2)>>2],c=c+1|0,(0|c)==(0|s))break;d=d+1|0}if(0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+h|0,0|o,0|a),r=r+1|0,(0|r)==(0|t))break;h=h+a|0,e=s+e|0}return void pf(o)}if(0|ui(0|kf[kf[n+64>>2]>>2],0|o,0|a),1==(0|t))return void pf(o);u=1,f=0;do f=f+a|0,0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+f|0,0|o,0|a),u=u+1|0;while((0|u)!=(0|t));return void pf(o)}function Tr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;switch(i=Xf,Xf=Xf+32|0,n=i+16|0,r=i,t<<24>>24){case 0:return t=0|sl(48),ru(t),kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=t,void(Xf=i);case 1:return t=0|sl(52),od(t),kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=t,void(Xf=i);default:t=0|sl(32),kf[r>>2]=t,kf[r+8>>2]=-2147483616,kf[r+4>>2]=28,s=t,a=11693,o=s+28|0;do If[s>>0]=0|If[a>>0],s=s+1|0,a=a+1|0;while((0|s)<(0|o));return If[t+28>>0]=0,kf[n>>2]=-1,t=n+4|0,Ds(t,r),kf[e>>2]=kf[n>>2],Ds(e+4|0,t),kf[e+16>>2]=0,(0|If[t+11>>0])<0&&mf(0|kf[t>>2]),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),void(Xf=i)}}function Sr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;if(i=e+4|0,n=0|kf[i>>2],r=0|kf[e>>2],s=(n-r|0)/144|0,a=n,s>>>0<t>>>0)return void ne(e,t-s|0);if(!(s>>>0<=t>>>0)&&(s=r+(144*t|0)|0,(0|a)!=(0|s))){o=a;do kf[i>>2]=o+-144,a=0|kf[o+-12>>2],0|a&&(t=o+-8|0,r=0|kf[t>>2],(0|r)!=(0|a)&&(kf[t>>2]=r+(~((r+-4-a|0)>>>2)<<2)),mf(a)),a=0|kf[o+-28>>2],0|a&&(r=o+-24|0,t=0|kf[r>>2],(0|t)!=(0|a)&&(kf[r>>2]=t+(~((t+-4-a|0)>>>2)<<2)),mf(a)),a=0|kf[o+-40>>2],0|a&&(t=o+-36|0,r=0|kf[t>>2],(0|r)!=(0|a)&&(kf[t>>2]=r+(~((r+-4-a|0)>>>2)<<2)),mf(a)),ls(o+-140|0),o=0|kf[i>>2];while((0|o)!=(0|s))}}function wr(e,t){e=0|e,t=0|t;var i=0,n=wp,r=0,s=0;return i=1!=(0|t)?t+-1&t?0|Bn(t):t:2,t=0|kf[e+4>>2],i>>>0>t>>>0?void In(e,i):void(i>>>0>=t>>>0||(n=ap((0|kf[e+12>>2])>>>0),r=~~ap(ip(ap(n/ap(Gf[e+16>>2]))))>>>0,s=t>>>0>2&0==(t+-1&t|0)?1<<32-(0|sp(r+-1|0)):0|Bn(r),r=i>>>0<s>>>0?s:i,r>>>0>=t>>>0||In(e,r)))}function Cr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(kf[e>>2]=1416,t=e+60|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&xp[127&kf[(0|kf[i>>2])+4>>2]](i),i=0|kf[e+48>>2],0|i&&(t=e+52|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=e+36|0,n=0|kf[i>>2],0|n){if(t=e+40|0,r=0|kf[t>>2],(0|r)==(0|n))s=n;else{a=r;do r=a+-4|0,kf[t>>2]=r,o=0|kf[r>>2],kf[r>>2]=0,0|o&&xp[127&kf[(0|kf[o>>2])+4>>2]](o),a=0|kf[t>>2];while((0|a)!=(0|n));s=0|kf[i>>2]}mf(s)}kf[e>>2]=1256,s=0|kf[e+16>>2],0|s&&(i=e+20|0,n=0|kf[i>>2],(0|n)!=(0|s)&&(kf[i>>2]=n+(~((n+-4-s|0)>>>2)<<2)),mf(s)),s=0|kf[e+4>>2],s&&(n=e+8|0,e=0|kf[n>>2],(0|e)!=(0|s)&&(kf[n>>2]=e+(~((e+-4-s|0)>>>2)<<2)),mf(s))}function Mr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0;if(t=0|kf[e>>2]){if(i=e+4|0,n=0|kf[i>>2],(0|n)==(0|t))r=t;else{s=n;do n=s+-4|0,kf[i>>2]=n,a=0|kf[n>>2],kf[n>>2]=0,0|a&&(n=a+88|0,o=0|kf[n>>2],kf[n>>2]=0,0|o&&(n=0|kf[o+8>>2],0|n&&(h=o+12|0,(0|kf[h>>2])!=(0|n)&&(kf[h>>2]=n),mf(n)),mf(o)),o=0|kf[a+68>>2],0|o&&(n=a+72|0,h=0|kf[n>>2],(0|h)!=(0|o)&&(kf[n>>2]=h+(~((h+-4-o|0)>>>2)<<2)),mf(o)),o=a+64|0,h=0|kf[o>>2],kf[o>>2]=0,0|h&&(o=0|kf[h>>2],0|o&&(n=h+4|0,(0|kf[n>>2])!=(0|o)&&(kf[n>>2]=o),mf(o)),mf(h)),mf(a)),s=0|kf[i>>2];while((0|s)!=(0|t));r=0|kf[e>>2]}mf(r)}}function Pr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0)return l=0,0|l;c=(0|kf[t>>2])+a|0,d=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,c=i,kf[c>>2]=s,kf[c+4>>2]=h;do if((0|Ff[t+38>>1])<514){if(h=0|tc(0|a,0|o,8,0),c=qf,(0|r)<(0|c)|(0|r)==(0|c)&n>>>0<h>>>0)return l=0,0|l;s=i,kf[s>>2]=h,kf[s+4>>2]=c;break}while(0);return 1&d?(i=31^(0|sp(0|d)),(i+-1|0)>>>0>28?(l=0,0|l):(kf[e+8>>2]=i+1,d=2<<i,kf[e+12>>2]=d+-1,i=d+-2|0,kf[e+16>>2]=i,kf[e+20>>2]=(0|i)/2|0,l=1,0|l)):(l=0,0|l)}function Ir(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(t=0|kf[e+4>>2],i=e+8|0,n=0|kf[i>>2],(0|n)!=(0|t)){r=n;do n=r+-4|0,kf[i>>2]=n,s=0|kf[n>>2],kf[n>>2]=0,0|s&&(n=s+88|0,a=0|kf[n>>2],kf[n>>2]=0,0|a&&(n=0|kf[a+8>>2],0|n&&(o=a+12|0,(0|kf[o>>2])!=(0|n)&&(kf[o>>2]=n),mf(n)),mf(a)),a=0|kf[s+68>>2],0|a&&(n=s+72|0,o=0|kf[n>>2],(0|o)!=(0|a)&&(kf[n>>2]=o+(~((o+-4-a|0)>>>2)<<2)),mf(a)),a=s+64|0,o=0|kf[a>>2],kf[a>>2]=0,0|o&&(a=0|kf[o>>2],0|a&&(n=o+4|0,(0|kf[n>>2])!=(0|a)&&(kf[n>>2]=a),mf(a)),mf(o)),mf(s)),r=0|kf[i>>2];while((0|r)!=(0|t))}t=0|kf[e>>2],t&&mf(t)}function Rr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=e+8|0,n=0|kf[i>>2],r=0|If[n+24>>0],s=r<<24>>24,a=0|ff((0|s)>-1?s:-1),o=0|kf[e+16>>2],h=0|kf[o+80>>2]?(0|kf[kf[o>>2]>>2])+(0|kf[o+48>>2])|0:0,!t)return void pf(a);if(r<<24>>24>0){for(r=0,o=0;;){for(e=0,l=o;;){if(If[a+e>>0]=kf[h+(l<<2)>>2],e=e+1|0,(0|e)==(0|s))break;l=l+1|0}if(0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+o|0,0|a,0|s),r=r+1|0,(0|r)==(0|t))break;o=o+s|0}return void pf(a)}if(0|ui(0|kf[kf[n+64>>2]>>2],0|a,0|s),1==(0|t))return void pf(a);c=1,d=0;do d=d+s|0,0|ui((0|kf[kf[(0|kf[i>>2])+64>>2]>>2])+d|0,0|a,0|s),c=c+1|0;while((0|c)!=(0|t));return void pf(a)}function xr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=0|sl(72),El(i),n=i,(0|t)<0)return xp[127&kf[(0|kf[i>>2])+4>>2]](i),r=0,0|r;i=e+8|0,s=e+12|0,e=0|kf[s>>2],a=0|kf[i>>2],o=e-a>>2;do if((0|o)<=(0|t)){if(h=t+1|0,l=e,h>>>0>o>>>0){Ut(i,h-o|0);break}if(h>>>0<o>>>0?(c=a+(h<<2)|0,(0|l)!=(0|c)):0){h=l;do l=h+-4|0,kf[s>>2]=l,d=0|kf[l>>2],kf[l>>2]=0,0|d&&xp[127&kf[(0|kf[d>>2])+4>>2]](d),h=0|kf[s>>2];while((0|h)!=(0|c))}}while(0);return s=(0|kf[i>>2])+(t<<2)|0,t=0|kf[s>>2],kf[s>>2]=n,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),r=1,0|r):(r=1,0|r)}function Or(e,t){e=0|e,t=0|t;var i=0,n=wp,r=0,s=0;return i=1!=(0|t)?t+-1&t?0|Bn(t):t:2,t=0|kf[e+4>>2],i>>>0>t>>>0?void l(e,i):void(i>>>0>=t>>>0||(n=ap((0|kf[e+12>>2])>>>0),r=~~ap(ip(ap(n/ap(Gf[e+16>>2]))))>>>0,s=t>>>0>2&0==(t+-1&t|0)?1<<32-(0|sp(r+-1|0)):0|Bn(r),r=i>>>0<s>>>0?s:i,r>>>0>=t>>>0||l(e,r)))}function kr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;if(i=e+60|0,n=0|kf[i>>2],!n)return r=0,0|r;if(kf[n+4>>2]=e+48,!(0|Cp[127&kf[(0|kf[n>>2])+12>>2]](n)))return r=0,0|r;n=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e);e:do if((0|n)>0){for(s=0;;){if(a=(0|Cp[127&kf[(0|kf[e>>2])+28>>2]](e))+4|0,o=0|kf[a>>2],a=0|Mp[127&kf[(0|kf[e>>2])+20>>2]](e,s),h=0|kf[i>>2],s=s+1|0,!(0|Mp[127&kf[(0|kf[h>>2])+8>>2]](h,0|kf[(0|kf[o+8>>2])+(a<<2)>>2]))){r=0;break}if((0|s)>=(0|n))break e}return 0|r}while(0);return 0|Mp[127&kf[(0|kf[e>>2])+36>>2]](e,t)&&0|Mp[127&kf[(0|kf[e>>2])+40>>2]](e,t)?(r=0|Cp[127&kf[(0|kf[e>>2])+44>>2]](e),0|r):(r=0,0|r)}function Dr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return e=Xf,Xf=Xf+32|0,n=e+12|0,r=e,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,0|Ls(t,r,n),t=n+11|0,s=0|If[t>>0],a=s<<24>>24<0?0|kf[n>>2]:n,(0|If[r+11>>0])<0?(mf(0|kf[r>>2]),d=0|If[t>>0]):d=s,d<<24>>24>=0?(Xf=e,0|a):(mf(0|kf[n>>2]),Xf=e,0|a)}function Lr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;n=i+16|0,r=0|kf[n>>2],r?(s=r,a=5):0|Fo(i)?o=0:(s=0|kf[n>>2],a=5);e:do if(5==(0|a)){if(r=i+20|0,n=0|kf[r>>2],h=n,(s-n|0)>>>0<t>>>0){o=0|Pp[31&kf[i+36>>2]](i,e,t);break}t:do if((0|If[i+75>>0])>-1){for(n=t;;){if(!n){l=h,c=0,d=t,u=e;break t}if(f=n+-1|0,10==(0|If[e+f>>0]))break;n=f}if(f=0|Pp[31&kf[i+36>>2]](i,e,n),f>>>0<n>>>0){o=f;break e}l=0|kf[r>>2],c=n,d=t-n|0,u=e+n|0}else l=h,c=0,d=t,u=e;while(0);0|ui(0|l,0|u,0|d),kf[r>>2]=(0|kf[r>>2])+d,o=c+d|0}while(0);return 0|o}function Nr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(t=e+12|0,i=0|kf[t>>2],kf[t>>2]=0,0|i){if(t=0|kf[i+28>>2],0|t){n=t;do t=n,n=0|kf[n>>2],Nr(t+8|0),mf(t);while(0!=(0|n))}if(n=i+20|0,t=0|kf[n>>2],kf[n>>2]=0,0|t&&mf(t),t=0|kf[i+8>>2],0|t){n=t;do t=n,n=0|kf[n>>2],r=t+8|0,s=0|kf[t+20>>2],0|s&&(a=t+24|0,(0|kf[a>>2])!=(0|s)&&(kf[a>>2]=s),mf(s)),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),mf(t);while(0!=(0|n))}n=0|kf[i>>2],kf[i>>2]=0,0|n&&mf(n),mf(i)}(0|If[e+11>>0])>=0||mf(0|kf[e>>2])}function Fr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;if(i=e+4|0,(0|Cp[127&kf[(0|kf[t>>2])+20>>2]](t))<=0)return n=1,0|n;for(e=0;;){if(r=0|kf[(0|kf[i>>2])+4>>2],s=0|vh(r,0|Mp[127&kf[(0|kf[t>>2])+24>>2]](t,e)),(0|s)==-1){n=0,a=9;break}if(r=0|kf[i>>2],((0|Lf[r+36>>0])<<8&65535)<512){if(!(0|Mp[127&kf[(0|kf[t>>2])+28>>2]](t,0|kf[(0|kf[(0|kf[r+4>>2])+8>>2])+(s<<2)>>2]))){n=0,a=9;break}}else{if(o=0|wo(r,s),!o){n=0,a=9;break}if(!(0|Mp[127&kf[(0|kf[t>>2])+28>>2]](t,o))){n=0,a=9;break}}if(e=e+1|0,(0|e)>=(0|Cp[127&kf[(0|kf[t>>2])+20>>2]](t))){n=1,a=9;break}}return 9==(0|a)?0|n:0}function Br(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0,p=0,_=0;if(n=(0|kf[t+4>>2])-(0|kf[t>>2])|0,t=n>>2,r=e+8|0,e=0|kf[(0|kf[r>>2])+40>>2],s=0|ff((0|e)>-1?e:-1),a=i+8|0,(0|n)<=0)return o=1,pf(s),0|o;for(n=i+16|0,h=0,l=0;;){if(c=a,d=0|kf[c>>2],u=0|kf[c+4>>2],c=n,f=0|kf[c>>2],p=0|tc(0|f,0|kf[c+4>>2],0|e,0),c=qf,(0|u)<(0|c)|(0|u)==(0|c)&d>>>0<p>>>0){o=0,_=5;break}if(0|ui(0|s,(0|kf[i>>2])+f|0,0|e),f=n,kf[f>>2]=p,kf[f+4>>2]=c,0|ui((0|kf[kf[(0|kf[r>>2])+64>>2]>>2])+l|0,0|s,0|e),h=h+1|0,(0|h)>=(0|t)){o=1,_=5;break}l=l+e|0}return 5==(0|_)?(pf(s),0|o):0}function Vr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(i=e+216|0,n=e+220|0,r=0|kf[i>>2],(0|kf[n>>2])==(0|r))return s=0,0|s;a=e+4|0,e=r,r=0;e:for(;;){if(o=0|kf[e+(144*r|0)>>2],((0|o)>=0?(h=0|kf[a>>2],l=0|kf[h+8>>2],(0|o)<((0|kf[h+12>>2])-l>>2|0)):0)?(h=0|kf[l+(o<<2)>>2],(0|Cp[127&kf[(0|kf[h>>2])+24>>2]](h))>0):0){o=0;do{if((0|Mp[127&kf[(0|kf[h>>2])+20>>2]](h,o))==(0|t))break e;o=o+1|0}while((0|o)<(0|Cp[127&kf[(0|kf[h>>2])+24>>2]](h)))}if(h=r+1|0,e=0|kf[i>>2],h>>>0>=(((0|kf[n>>2])-e|0)/144|0)>>>0){s=0,c=11;break}r=h}return 11==(0|c)?0|s:(c=0|kf[i>>2],s=0==(0|If[c+(144*r|0)+100>>0])?0:c+(144*r|0)+4|0,0|s)}function Ur(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|kf[s+4>>2],s=0|tc(0|a,0|o,4,0),h=qf,(0|r)<(0|h)|(0|r)==(0|h)&n>>>0<s>>>0?(l=0,0|l):(c=(0|kf[t>>2])+a|0,t=Lf[c>>0]|Lf[c+1>>0]<<8|Lf[c+2>>0]<<16|Lf[c+3>>0]<<24,c=i,kf[c>>2]=s,kf[c+4>>2]=h,h=0|tc(0|a,0|o,8,0),o=qf,(0|r)<(0|o)|(0|r)==(0|o)&n>>>0<h>>>0?(l=0,0|l):(n=i,kf[n>>2]=h,kf[n+4>>2]=o,1&t?(o=31^(0|sp(0|t)),(o+-1|0)>>>0>28?(l=0,0|l):(kf[e+8>>2]=o+1,t=2<<o,kf[e+12>>2]=t+-1,o=t+-2|0,kf[e+16>>2]=o,kf[e+20>>2]=(0|o)/2|0,l=1,0|l)):(l=0,0|l)))}function Gr(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0;if(t>>>0<64){if(t=0|kf[e+12>>2],t>>>0<=1)return r=0,0|r;for(n=0|kf[i>>2],i=1,s=0;;){if(a=(0|kf[n+(s<<2)>>2])>>>0>(0|kf[n+(i<<2)>>2])>>>0?i:s,i=i+1|0,i>>>0>=t>>>0){r=a;break}s=a}return 0|r}return s=e+580|0,t=0|kf[s>>2],i=32-t|0,n=e+576|0,(0|i)<4?(a=0|kf[n>>2],o=a+4|0,(0|o)==(0|kf[e+568>>2])?(r=0,0|r):(h=kf[a>>2]<<t,a=4-i|0,kf[s>>2]=a,kf[n>>2]=o,l=32-a|0,r=(0|kf[o>>2])>>>l|h>>>(l-i|0),0|r)):(i=0|kf[n>>2],(0|i)==(0|kf[e+568>>2])?(r=0,0|r):(e=kf[i>>2]<<t>>>28,l=t+4|0,kf[s>>2]=l,32!=(0|l)?(r=e,0|r):(kf[n>>2]=i+4,kf[s>>2]=0,r=e,0|r)))}function Wr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;i=e+216|0,n=e+220|0,r=0|kf[i>>2];e:do if((0|kf[n>>2])!=(0|r)){s=e+4|0,a=r,o=0;t:for(;;){if(h=0|kf[a+(144*o|0)>>2],((0|h)>=0?(l=0|kf[s>>2],c=0|kf[l+8>>2],(0|h)<((0|kf[l+12>>2])-c>>2|0)):0)?(l=0|kf[c+(h<<2)>>2],(0|Cp[127&kf[(0|kf[l>>2])+24>>2]](l))>0):0){h=0;do{if((0|Mp[127&kf[(0|kf[l>>2])+20>>2]](l,h))==(0|t))break t;h=h+1|0}while((0|h)<(0|Cp[127&kf[(0|kf[l>>2])+24>>2]](l)))}if(l=o+1|0,a=0|kf[i>>2],l>>>0>=(((0|kf[n>>2])-a|0)/144|0)>>>0)break e;o=l}return d=(0|kf[i>>2])+(144*o|0)+104|0,0|d}while(0);return d=e+184|0,0|d}function zr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(kf[e>>2]=1312,Mr(e+60|0),t=0|kf[e+48>>2],0|t&&(i=e+52|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+36|0,n=0|kf[t>>2],0|n){if(i=e+40|0,r=0|kf[i>>2],(0|r)==(0|n))s=n;else{a=r;do r=a+-24|0,kf[i>>2]=r,xp[127&kf[kf[r>>2]>>2]](r),a=0|kf[i>>2];while((0|a)!=(0|n));s=0|kf[t>>2]}mf(s)}kf[e>>2]=1256,s=0|kf[e+16>>2],0|s&&(t=e+20|0,n=0|kf[t>>2],(0|n)!=(0|s)&&(kf[t>>2]=n+(~((n+-4-s|0)>>>2)<<2)),mf(s)),s=0|kf[e+4>>2],s&&(n=e+8|0,e=0|kf[n>>2],(0|e)!=(0|s)&&(kf[n>>2]=e+(~((e+-4-s|0)>>>2)<<2)),mf(s))}function Hr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return i=Xf,Xf=Xf+32|0,n=i+16|0,r=i+8|0,s=i,a=e+8|0,kf[a>>2]<<5>>>0>=t>>>0?void(Xf=i):(kf[n>>2]=0,o=n+4|0,kf[o>>2]=0,h=n+8|0,kf[h>>2]=0,(0|t)<0&&Du(n),l=((t+-1|0)>>>5)+1|0,t=0|sl(l<<2),kf[n>>2]=t,kf[o>>2]=0,kf[h>>2]=l,l=0|kf[e>>2],kf[r>>2]=l,kf[r+4>>2]=0,t=e+4|0,c=0|kf[t>>2],kf[s>>2]=l+(c>>>5<<2),kf[s+4>>2]=31&c,Lt(n,r,s),s=0|kf[e>>2],kf[e>>2]=kf[n>>2],kf[n>>2]=s,n=0|kf[t>>2],kf[t>>2]=kf[o>>2],kf[o>>2]=n,n=0|kf[a>>2],kf[a>>2]=kf[h>>2],kf[h>>2]=n,0|s&&mf(s),void(Xf=i))}function jr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;t=Xf,Xf=Xf+16|0,n=t;do{if(((0|Lf[(0|kf[e+4>>2])+36>>0])<<8&65535)>511){if(r=i+8|0,s=0|kf[r+4>>2],a=i+16|0,o=a,h=0|kf[o>>2],l=0|kf[o+4>>2],(0|s)>(0|l)|((0|s)==(0|l)?(0|kf[r>>2])>>>0>h>>>0:0)){r=0|If[(0|kf[i>>2])+h>>0],s=0|tc(0|h,0|l,1,0),l=a,kf[l>>2]=s,kf[l+4>>2]=qf,l=255&r,kf[e+24>>2]=l,c=l;break}return d=0,Xf=t,0|d}c=0|kf[e+24>>2]}while(0);return kf[n>>2]=1200,kf[n+4>>2]=-1,jd(n,c),d=0|ho(n,0|kf[e+16>>2]),Xf=t,0|d}
function Yr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;i=e+4|0,n=0|kf[e>>2],r=(0|kf[i>>2])-n|0,s=(0|r)/12|0,a=s+1|0,a>>>0>357913941&&Du(e),o=e+8|0,h=((0|kf[o>>2])-n|0)/12|0,l=h<<1,c=h>>>0<178956970?l>>>0<a>>>0?a:l:357913941;do if(c){if(!(c>>>0>357913941)){d=0|sl(12*c|0);break}l=0|dp(8),cd(l,13392),kf[l>>2]=4748,fp(0|l,1128,101)}else d=0;while(0);l=d+(12*s|0)|0,kf[l>>2]=kf[t>>2],kf[l+4>>2]=kf[t+4>>2],kf[l+8>>2]=kf[t+8>>2],t=l+(12*((0|r)/-12|0)|0)|0,(0|r)>0&&0|ui(0|t,0|n,0|r),kf[e>>2]=t,kf[i>>2]=l+12,kf[o>>2]=d+(12*c|0),n&&mf(n)}function Xr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;return i=Xf,Xf=Xf+16|0,n=i,r=0|Dt(e,n,t),s=0|kf[r>>2],0|s?(a=s,o=a+28|0,Xf=i,0|o):(s=0|sl(40),Ds(s+16|0,t),t=s+28|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,t=0|kf[n>>2],kf[s>>2]=0,kf[s+4>>2]=0,kf[s+8>>2]=t,kf[r>>2]=s,t=0|kf[kf[e>>2]>>2],t?(kf[e>>2]=t,h=0|kf[r>>2]):h=s,re(0|kf[e+4>>2],h),h=e+8|0,kf[h>>2]=(0|kf[h>>2])+1,a=s,o=a+28|0,Xf=i,0|o)}function Zr(e,t,i,n,r,s,a,o){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a,o=0|o;var h=0,l=0,c=0,d=0,u=0,f=0;h=Xf,Xf=Xf+16|0,l=h,(-18-t|0)>>>0<i>>>0&&Du(e),c=(0|If[e+11>>0])<0?0|kf[e>>2]:e,t>>>0<2147483623?(d=i+t|0,i=t<<1,u=d>>>0<i>>>0?i:d,f=u>>>0<11?11:u+16&-16):f=-17,u=0|sl(f),0|r&&0|ed(u,c,r),0|a&&0|ed(u+r|0,o,a),o=n-s|0,n=o-r|0,0|n&&0|ed(u+r+a|0,c+r+s|0,n),10!=(0|t)&&mf(c),kf[e>>2]=u,kf[e+8>>2]=f|-2147483648,f=o+a|0,kf[e+4>>2]=f,If[l>>0]=0,su(u+f|0,l),Xf=h}function Kr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],n-s>>2>>>0>=t>>>0)return 0|Bs(0|s,0,t<<2|0),void(kf[r>>2]=s+(t<<2));a=0|kf[e>>2],o=s-a|0,s=o>>2,h=s+t|0,h>>>0>1073741823&&Du(e),l=n-a|0,n=l>>1,c=l>>2>>>0<536870911?n>>>0<h>>>0?h:n:1073741823;do if(c){if(!(c>>>0>1073741823)){d=0|sl(c<<2);break}n=0|dp(8),cd(n,13392),kf[n>>2]=4748,fp(0|n,1128,101)}else d=0;while(0);n=d+(s<<2)|0,0|Bs(0|n,0,t<<2|0),h=n+(0-s<<2)|0,(0|o)>0&&0|ui(0|h,0|a,0|o),kf[e>>2]=h,kf[r>>2]=n+(t<<2),kf[i>>2]=d+(c<<2),a&&mf(a)}function Qr(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(t=0|kf[e>>2]){if(i=e+4|0,n=0|kf[i>>2],(0|n)==(0|t))r=t;else{s=n;do kf[i>>2]=s+-144,n=0|kf[s+-12>>2],0|n&&(a=s+-8|0,o=0|kf[a>>2],(0|o)!=(0|n)&&(kf[a>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[s+-28>>2],0|n&&(o=s+-24|0,a=0|kf[o>>2],(0|a)!=(0|n)&&(kf[o>>2]=a+(~((a+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[s+-40>>2],0|n&&(a=s+-36|0,o=0|kf[a>>2],(0|o)!=(0|n)&&(kf[a>>2]=o+(~((o+-4-n|0)>>>2)<<2)),mf(n)),ls(s+-140|0),s=0|kf[i>>2];while((0|s)!=(0|t));r=0|kf[e>>2]}mf(r)}}function Jr(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0;return e=Xf,Xf=Xf+16|0,n=e,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,r=0|qs(i),r>>>0>4294967279&&Du(n),r>>>0<11?(If[n+11>>0]=r,r?(a=n,o=6):s=n):(h=r+16&-16,l=0|sl(h),kf[n>>2]=l,kf[n+8>>2]=h|-2147483648,kf[n+4>>2]=r,a=l,o=6),6==(0|o)&&(0|ui(0|a,0|i,0|r),s=a),If[s+r>>0]=0,r=0!=(0|kn(t,n)),(0|If[n+11>>0])>=0?(Xf=e,0|r):(mf(0|kf[n>>2]),Xf=e,0|r)}function qr(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(i=e+8|0,n=0|kf[i>>2],r=e+4|0,s=0|kf[r>>2],(n-s|0)>>>0>=t>>>0){a=s,o=t;do If[a>>0]=0,a=(0|kf[r>>2])+1|0,kf[r>>2]=a,o=o+-1|0;while(0!=(0|o))}else{o=0|kf[e>>2],a=s-o|0,s=a+t|0,(0|s)<0&&Du(e),h=n-o|0,o=h<<1,n=h>>>0<1073741823?o>>>0<s>>>0?s:o:2147483647,l=n?0|sl(n):0,o=l+a|0,a=l+n|0,n=o,l=t,t=o;do If[n>>0]=0,n=t+1|0,t=n,l=l+-1|0;while(0!=(0|l));l=0|kf[e>>2],n=(0|kf[r>>2])-l|0,s=o+(0-n)|0,(0|n)>0&&0|ui(0|s,0|l,0|n),kf[e>>2]=s,kf[r>>2]=t,kf[i>>2]=a,l&&mf(l)}}function $r(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=3288,t=e+84|0,i=e+4|0,n=i+80|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+88>>2]=-1,kf[e+92>>2]=-1,t=e+152|0,i=e+96|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));Gf[t>>2]=ap(1),t=e+212|0,i=e+156|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+216>>2]=0,kf[e+220>>2]=0,kf[e+224>>2]=0,Fh(e+232|0),t=e+380|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[e+400>>2]=-1,kf[e+404>>2]=-1,kf[e+408>>2]=2,kf[e+412>>2]=7,t=e+416|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0}function es(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;return i=Xf,Xf=Xf+32|0,t=i,!((Lf[(0|kf[e+4>>2])+36>>0]<<8&65535)>511)||0|Cp[127&kf[(0|kf[e>>2])+52>>2]](e)?(kf[t>>2]=1228,kf[t+4>>2]=-1,r=t+8|0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,kf[r+12>>2]=0,Ho(t,0|kf[e+24>>2],0|kf[e+28>>2],0|If[(0|kf[e+8>>2])+24>>0],ap(Gf[e+32>>2])),s=0|ho(t,0|kf[e+16>>2]),kf[t>>2]=1228,e=0|kf[r>>2],0|e&&(r=t+12|0,t=0|kf[r>>2],(0|t)!=(0|e)&&(kf[r>>2]=t+(~((t+-4-e|0)>>>2)<<2)),mf(e)),n=s,Xf=i,0|n):(n=0,Xf=i,0|n)}function ts(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(t=0|kf[e+4>>2],i=e+8|0,n=0|kf[i>>2],(0|n)!=(0|t)){r=n;do kf[i>>2]=r+-144,n=0|kf[r+-12>>2],0|n&&(s=r+-8|0,a=0|kf[s>>2],(0|a)!=(0|n)&&(kf[s>>2]=a+(~((a+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[r+-28>>2],0|n&&(a=r+-24|0,s=0|kf[a>>2],(0|s)!=(0|n)&&(kf[a>>2]=s+(~((s+-4-n|0)>>>2)<<2)),mf(n)),n=0|kf[r+-40>>2],0|n&&(s=r+-36|0,a=0|kf[s>>2],(0|a)!=(0|n)&&(kf[s>>2]=a+(~((a+-4-n|0)>>>2)<<2)),mf(n)),ls(r+-140|0),r=0|kf[i>>2];while((0|r)!=(0|t))}t=0|kf[e>>2],t&&mf(t)}function is(e){e=0|e;var t=0,i=0,n=0;t=0|kf[e+76>>2],0|t&&(i=e+80|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+64>>2],0|t&&(n=e+68|0,(0|kf[n>>2])!=(0|t)&&(kf[n>>2]=t),mf(t)),t=0|kf[e+48>>2],0|t&&(n=e+52|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+24>>2],0|t&&(i=e+28|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+12>>2],0|t&&(n=e+16|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e>>2],t&&(i=e+4|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function ns(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return e=Xf,Xf=Xf+32|0,n=e+12|0,r=e,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,s=0|Ls(t,r,n),(0|If[r+11>>0])<0&&mf(0|kf[r>>2]),(0|If[n+11>>0])>=0?(Xf=e,0|s):(mf(0|kf[n>>2]),Xf=e,0|s)}function rs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;for(n=Xf,Xf=Xf+16|0,r=n,s=t+11|0,a=0|If[s>>0],o=a<<24>>24<0?0|kf[t+4>>2]:255&a,h=a,a=o;;){if(l=h<<24>>24<0?0|kf[t>>2]:t,kf[r>>2]=i,c=0|xl(l,a+1|0,15886,r),(0|c)>-1){if(!(c>>>0>a>>>0))break;d=c}else d=a<<1|1;ea(t,d,0),h=0|If[s>>0],a=d}for(ea(t,c,0),kf[e>>2]=kf[t>>2],kf[e+4>>2]=kf[t+4>>2],kf[e+8>>2]=kf[t+8>>2],e=0;;){if(3==(0|e))break;kf[t+(e<<2)>>2]=0,e=e+1|0}Xf=n}function ss(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(t=e+8|0,i=0|kf[t>>2],(0|i)<0)return n=0,0|n;if(r=e+4|0,e=0|kf[r>>2],s=e+4|0,a=0|kf[s>>2],o=0|kf[e>>2],h=a-o>>2,l=o,o=a,i>>>0<=h>>>0?(i>>>0<h>>>0?(a=l+(i<<2)|0,(0|o)!=(0|a)):0)?(kf[s>>2]=o+(~((o+-4-a|0)>>>2)<<2),c=i):c=i:(Kr(e,i-h|0),c=0|kf[t>>2]),(0|c)<=0)return n=1,0|n;for(t=0|kf[r>>2],r=0|kf[t>>2],h=(0|kf[t+4>>2])-r>>2,i=r,r=0;;){if(h>>>0<=r>>>0){d=10;break}if(kf[i+(r<<2)>>2]=r,r=r+1|0,(0|r)>=(0|c)){n=1,d=12;break}}if(10==(0|d))Du(t);else if(12==(0|d))return 0|n;return 0}function as(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0;if(t=e+140|0,i=0|kf[t>>2],(0|i)<=0)return n=1,0|n;r=i<<4,s=0|ff(i>>>0>268435455|r>>>0>4294967291?-1:r+4|0),kf[s>>2]=i,r=s+4|0,s=r+(i<<4)|0,i=r;do rd(i),i=i+16|0;while((0|i)!=(0|s));if(s=e+136|0,i=0|kf[s>>2],kf[s>>2]=r,0|i){if(r=i+-4|0,a=0|kf[r>>2],0|a){o=i+(a<<4)|0;do o=o+-16|0,bf(o);while((0|o)!=(0|i))}pf(r)}if((0|kf[t>>2])<=0)return n=1,0|n;for(r=0;;){if(!(0|ie((0|kf[s>>2])+(r<<4)|0,e))){n=0,h=13;break}if(r=r+1|0,(0|r)>=(0|kf[t>>2])){n=1,h=13;break}}return 13==(0|h)?0|n:0}function os(){var e=0,t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;e=Xf,Xf=Xf+48|0,t=e+32|0,i=e+24|0,n=e+16|0,r=e,s=e+36|0,e=0|ul(),(0|e?(a=0|kf[e>>2],0|a):0)&&(e=a+48|0,o=0|kf[e>>2],h=0|kf[e+4>>2],1126902528==(o&-256|0)&1129074247==(0|h)||(kf[i>>2]=kf[1159],Nl(15975,i)),l=1126902529==(0|o)&1129074247==(0|h)?0|kf[a+44>>2]:a+80|0,kf[s>>2]=l,l=0|kf[a>>2],a=0|kf[l+4>>2],h=0|Pp[31&kf[(0|kf[262])+16>>2]](1048,l,s),l=0|kf[1159],h?(h=0|kf[s>>2],s=0|Cp[127&kf[(0|kf[h>>2])+8>>2]](h),kf[r>>2]=l,kf[r+4>>2]=a,kf[r+8>>2]=s,Nl(15889,r)):(kf[n>>2]=l,kf[n+4>>2]=a,Nl(15934,n))),Nl(16013,t)}function hs(e){e=0|e;var t=0,i=0,n=0,r=0,s=0;if(t=0|kf[e>>2],kf[e>>2]=0,t){if(e=0|kf[t+28>>2],0|e){i=e;do e=i,i=0|kf[i>>2],n=e+8|0,hs(e+20|0),(0|If[n+11>>0])<0&&mf(0|kf[n>>2]),mf(e);while(0!=(0|i))}if(i=t+20|0,e=0|kf[i>>2],kf[i>>2]=0,0|e&&mf(e),e=0|kf[t+8>>2],0|e){i=e;do e=i,i=0|kf[i>>2],n=e+8|0,r=0|kf[e+20>>2],0|r&&(s=e+24|0,(0|kf[s>>2])!=(0|r)&&(kf[s>>2]=r),mf(r)),(0|If[n+11>>0])<0&&mf(0|kf[n>>2]),mf(e);while(0!=(0|i))}i=0|kf[t>>2],kf[t>>2]=0,0|i&&mf(i),mf(t)}}function ls(e){e=0|e;var t=0,i=0,n=0;t=0|kf[e+84>>2],0|t&&(i=e+88|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+72>>2],0|t&&(n=e+76|0,(0|kf[n>>2])!=(0|t)&&(kf[n>>2]=t),mf(t)),t=0|kf[e+52>>2],0|t&&(n=e+56|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+40>>2],0|t&&(i=e+44|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+28>>2],0|t&&(n=e+32|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+12>>2],0|t&&mf(t),t=0|kf[e>>2],t&&mf(t)}function cs(e){e=0|e;var t=0,i=0,n=0;t=0|kf[e+92>>2],0|t&&(i=e+96|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+76>>2],0|t&&(n=e+80|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+64>>2],0|t&&(i=e+68|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+52>>2],0|t&&(n=e+56|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t)),kf[e+4>>2]=3196,t=0|kf[e+24>>2],0|t&&mf(t),t=0|kf[e+12>>2],t&&mf(t)}function ds(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;do{if(e){if(t>>>0<128){If[e>>0]=t,n=1;break}if(i=(0|uf())+188|0,!(0|kf[kf[i>>2]>>2])){if(57216==(t&-128|0)){If[e>>0]=t,n=1;break}i=0|nf(),kf[i>>2]=84,n=-1;break}if(t>>>0<2048){If[e>>0]=t>>>6|192,If[e+1>>0]=63&t|128,n=2;break}if(t>>>0<55296|57344==(t&-8192|0)){If[e>>0]=t>>>12|224,If[e+1>>0]=t>>>6&63|128,If[e+2>>0]=63&t|128,n=3;break}if((t+-65536|0)>>>0<1048576){If[e>>0]=t>>>18|240,If[e+1>>0]=t>>>12&63|128,If[e+2>>0]=t>>>6&63|128,If[e+3>>0]=63&t|128,n=4;break}i=0|nf(),kf[i>>2]=84,n=-1;break}n=1}while(0);return 0|n}function us(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;i=e+4|0,n=0|kf[e>>2],r=(0|kf[i>>2])-n|0,s=r>>2,a=s+1|0,a>>>0>1073741823&&Du(e),o=e+8|0,h=(0|kf[o>>2])-n|0,l=h>>1,c=h>>2>>>0<536870911?l>>>0<a>>>0?a:l:1073741823;do if(c){if(!(c>>>0>1073741823)){d=0|sl(c<<2);break}l=0|dp(8),cd(l,13392),kf[l>>2]=4748,fp(0|l,1128,101)}else d=0;while(0);l=d+(s<<2)|0,kf[l>>2]=kf[t>>2],t=l+(0-s<<2)|0,(0|r)>0&&0|ui(0|t,0|n,0|r),kf[e>>2]=t,kf[i>>2]=l+4,kf[o>>2]=d+(c<<2),n&&mf(n)}function fs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return e=Xf,Xf=Xf+32|0,n=e,r=e+8|0,zf[n>>3]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,0|fr(t,r,n),d=+zf[n>>3],(0|If[r+11>>0])>=0?(Xf=e,+d):(mf(0|kf[r>>2]),Xf=e,+d)}function ps(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;r=Xf,Xf=Xf+128|0,s=r+124|0,a=r,o=a,h=4124,l=o+124|0;do kf[o>>2]=kf[h>>2],o=o+4|0,h=h+4|0;while((0|o)<(0|l));return(t+-1|0)>>>0>2147483646?t?(s=0|nf(),kf[s>>2]=75,f=-1):(c=1,d=s,u=4):(c=t,d=e,u=4),4==(0|u)&&(u=-2-d|0,e=c>>>0>u>>>0?u:c,kf[a+48>>2]=e,c=a+20|0,kf[c>>2]=d,kf[a+44>>2]=d,u=d+e|0,d=a+16|0,kf[d>>2]=u,kf[a+28>>2]=u,u=0|or(a,i,n),e?(e=0|kf[c>>2],If[e+(((0|e)==(0|kf[d>>2]))<<31>>31)>>0]=0,f=u):f=u),Xf=r,0|f}function _s(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;i=Xf,Xf=Xf+80|0,n=i,r=i+56|0,s=i+40|0,a=n,o=t,t=a+40|0;do kf[a>>2]=kf[o>>2],a=a+4|0,o=o+4|0;while((0|a)<(0|t));return un(s,n,r),o=0|kf[s>>2],o?(kf[e>>2]=o,o=s+4|0,Ds(e+4|0,o),(0|If[o+11>>0])<0&&mf(0|kf[o>>2]),h=n+24|0,bf(h),void(Xf=i)):(a=s+4|0,(0|If[a+11>>0])<0&&mf(0|kf[a>>2]),a=0|Lf[r+7>>0],kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=a,h=n+24|0,bf(h),void(Xf=i))}function ms(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return e=Xf,Xf=Xf+16|0,n=e+12|0,r=e,kf[n>>2]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,0|Ks(t,r,n),t=0|kf[n>>2],(0|If[r+11>>0])>=0?(Xf=e,0|t):(mf(0|kf[r>>2]),Xf=e,0|t)}function As(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;if(i=e+8|0,n=0|kf[e>>2],r=n,!((((0|kf[i>>2])-n|0)/12|0)>>>0>=t>>>0)){if(s=e+4|0,t>>>0>357913941&&(a=0|dp(8),cd(a,13392),kf[a>>2]=4748,fp(0|a,1128,101)),a=0|kf[s>>2],o=0|sl(12*t|0),h=o+(12*((a-n|0)/12|0)|0)|0,l=h,c=o+(12*t|0)|0,t=a,(0|t)==(0|r))d=l;else{a=h,h=t;do t=h,h=h+-12|0,kf[a+-12>>2]=kf[h>>2],kf[a+-8>>2]=kf[t+-8>>2],kf[a+-4>>2]=kf[t+-4>>2],a=a+-12|0;while((0|h)!=(0|r));d=a}kf[e>>2]=d,kf[s>>2]=l,kf[i>>2]=c,n&&mf(n)}}function vs(e){e=0|e;var t=0,i=0,n=0,r=0,s=0;if(t=0|kf[e+28>>2],0|t){i=t;do t=i,i=0|kf[i>>2],n=t+8|0,r=t+20|0,s=0|kf[r>>2],kf[r>>2]=0,0|s&&(vs(s),mf(s)),(0|If[n+11>>0])<0&&mf(0|kf[n>>2]),mf(t);while(0!=(0|i))}if(i=e+20|0,t=0|kf[i>>2],kf[i>>2]=0,0|t&&mf(t),t=0|kf[e+8>>2],0|t){i=t;do t=i,i=0|kf[i>>2],n=t+8|0,s=0|kf[t+20>>2],0|s&&(r=t+24|0,(0|kf[r>>2])!=(0|s)&&(kf[r>>2]=s),mf(s)),(0|If[n+11>>0])<0&&mf(0|kf[n>>2]),mf(t);while(0!=(0|i))}i=0|kf[e>>2],kf[e>>2]=0,i&&mf(i)}function ys(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return e=Xf,Xf=Xf+32|0,n=e,r=e+8|0,zf[n>>3]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,s=0|fr(t,r,n),(0|If[r+11>>0])>=0?(Xf=e,0|s):(mf(0|kf[r>>2]),Xf=e,0|s)}function gs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;return e=Xf,Xf=Xf+16|0,n=e+12|0,r=e,kf[n>>2]=0,kf[r>>2]=0,kf[r+4>>2]=0,kf[r+8>>2]=0,s=0|qs(i),s>>>0>4294967279&&Du(r),s>>>0<11?(If[r+11>>0]=s,s?(o=r,h=6):a=r):(l=s+16&-16,c=0|sl(l),kf[r>>2]=c,kf[r+8>>2]=l|-2147483648,kf[r+4>>2]=s,o=c,h=6),6==(0|h)&&(0|ui(0|o,0|i,0|s),a=o),If[a+s>>0]=0,s=0|Ks(t,r,n),(0|If[r+11>>0])>=0?(Xf=e,0|s):(mf(0|kf[r>>2]),Xf=e,0|s)}function bs(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=3240,t=e+84|0,i=e+4|0,n=i+80|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+88>>2]=-1,kf[e+92>>2]=-1,t=e+152|0,i=e+96|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));Gf[t>>2]=ap(1),t=e+212|0,i=e+156|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+216>>2]=0,kf[e+220>>2]=0,kf[e+224>>2]=0,Fh(e+232|0),t=e+380|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,rd(e+400|0),kf[e+416>>2]=-1,kf[e+420>>2]=-1}function Es(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;if(i=t+8|0,n=0|kf[i+4>>2],r=t+16|0,s=r,a=0|kf[s>>2],o=0|kf[s+4>>2],!((0|n)>(0|o)|((0|n)==(0|o)?(0|kf[i>>2])>>>0>a>>>0:0)))return h=0,0|h;i=0|If[(0|kf[t>>2])+a>>0],n=0|tc(0|a,0|o,1,0),o=r,kf[o>>2]=n,kf[o+4>>2]=qf;do{if(i<<24>>24<0){if(0|Es(e,t)){o=e,n=0|ql(0|kf[o>>2],0|kf[o+4>>2],7),o=qf,r=e,kf[r>>2]=n,kf[r+4>>2]=o,l=n|127&i,c=o;break}return h=0,0|h}l=255&i,c=0}while(0);return i=e,kf[i>>2]=l,kf[i+4>>2]=c,h=1,0|h}function Ts(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0;do if(((0|Lf[(0|kf[e+4>>2])+36>>0])<<8&65535)<512){if(n=i+8|0,r=0|kf[n+4>>2],s=i+16|0,a=s,o=0|kf[a>>2],h=0|kf[a+4>>2],(0|r)>(0|h)|((0|r)==(0|h)?(0|kf[n>>2])>>>0>o>>>0:0)){n=0|If[(0|kf[i>>2])+o>>0],r=0|tc(0|o,0|h,1,0),h=s,kf[h>>2]=r,kf[h+4>>2]=qf,kf[e+24>>2]=255&n;break}return l=0,0|l}while(0);return l=0|Pn(e,t,i),0|l}function Ss(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;return t>>>0>1431655765|(i|t|0)<0?(n=0,0|n):(r=3*t|0,yt(e,r,3568),yt(e+12|0,r,3564),pa(e+24|0,i),i=e+76|0,r=0|kf[i>>2],t=e+80|0,s=0|kf[t>>2],(0|s)!=(0|r)&&(kf[t>>2]=s+(~((s+-4-r|0)>>>2)<<2)),kf[i>>2]=0,kf[t>>2]=0,kf[e+84>>2]=0,0|r&&mf(r),r=e+64|0,t=0|kf[r>>2],i=e+68|0,(0|kf[i>>2])!=(0|t)&&(kf[i>>2]=t),kf[r>>2]=0,kf[i>>2]=0,kf[e+72>>2]=0,t?(mf(t),n=1,0|n):(n=1,0|n))}function ws(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0;if(r=Xf,Xf=Xf+48|0,s=r+4|0,a=r,1!=(0|n))return kf[e>>2]=0,void(Xf=r);n=0|kf[t+12>>2],o=0|kf[t+4>>2],t=s,h=t+36|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|h));vr(a,i,n,o,s),o=0|kf[s+24>>2],0|o&&(n=s+28|0,s=0|kf[n>>2],(0|s)!=(0|o)&&(kf[n>>2]=s+(~((s+-4-o|0)>>>2)<<2)),mf(o)),kf[e>>2]=kf[a>>2],Xf=r}function Cs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0;return n=Xf,Xf=Xf+16|0,r=n,0|t&&(s=e+11|0,a=0|If[s>>0],a<<24>>24<0?(o=0|kf[e+4>>2],h=(2147483647&kf[e+8>>2])+-1|0):(o=255&a,h=10),l=o+t|0,(h-o|0)>>>0<t>>>0?(Hs(e,h,l-h|0,o,o,0,0),c=0|If[s>>0]):c=a,d=c<<24>>24<0?0|kf[e>>2]:e,0|Ql(d+o|0,t,i),(0|If[s>>0])<0?kf[e+4>>2]=l:If[s>>0]=l,If[r>>0]=0,su(d+l|0,r)),Xf=n,0|e}function Ms(e,t){e=0|e,t=0|t;var i=0,n=0;i=e+16|0,e=0|kf[t>>2],kf[t>>2]=0,t=0|kf[i>>2],kf[i>>2]=e,t&&(e=t+88|0,i=0|kf[e>>2],kf[e>>2]=0,0|i&&(e=0|kf[i+8>>2],0|e&&(n=i+12|0,(0|kf[n>>2])!=(0|e)&&(kf[n>>2]=e),mf(e)),mf(i)),i=0|kf[t+68>>2],0|i&&(e=t+72|0,n=0|kf[e>>2],(0|n)!=(0|i)&&(kf[e>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=t+64|0,n=0|kf[i>>2],kf[i>>2]=0,0|n&&(i=0|kf[n>>2],0|i&&(e=n+4|0,(0|kf[e>>2])!=(0|i)&&(kf[e>>2]=i),mf(i)),mf(n)),mf(t))}function Ps(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;n=Xf,Xf=Xf+16|0,r=n,s=e+11|0,a=0|If[s>>0],o=a<<24>>24<0,h=o?(2147483647&kf[e+8>>2])+-1|0:10;do{if(h>>>0>=i>>>0){if(l=o?0|kf[e>>2]:e,0|qc(l,t,i),If[r>>0]=0,su(l+i|0,r),(0|If[s>>0])<0){kf[e+4>>2]=i;break}If[s>>0]=i;break}c=o?0|kf[e+4>>2]:255&a,Zr(e,h,i-h|0,c,0,c,i,t)}while(0);return Xf=n,0|e}function Is(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(kf[e>>2]=3012,t=e+48|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&xp[127&kf[(0|kf[i>>2])+4>>2]](i),kf[e>>2]=3440,i=0|kf[e+20>>2],0|i&&(t=e+24|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=e+8|0,n=0|kf[i>>2],!n)return void mf(e);if(t=e+12|0,r=0|kf[t>>2],(0|r)==(0|n))s=n;else{a=r;do r=a+-4|0,kf[t>>2]=r,o=0|kf[r>>2],kf[r>>2]=0,0|o&&xp[127&kf[(0|kf[o>>2])+4>>2]](o),a=0|kf[t>>2];while((0|a)!=(0|n));s=0|kf[i>>2]}mf(s),mf(e)}function Rs(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;return(i=0|kf[e>>2])&&(r=0|kf[t>>2])?(s=0|kf[r>>2],0|Ws(i,s,(0|kf[r+4>>2])-s|0,0),If[e+24>>0]=0|If[t+24>>0],kf[e+28>>2]=kf[t+28>>2],If[e+32>>0]=0|If[t+32>>0],s=t+40|0,r=0|kf[s+4>>2],i=e+40|0,kf[i>>2]=kf[s>>2],kf[i+4>>2]=r,r=t+48|0,i=0|kf[r+4>>2],s=e+48|0,kf[s>>2]=kf[r>>2],kf[s+4>>2]=i,kf[e+56>>2]=kf[t+56>>2],i=t+8|0,t=e+8|0,kf[t>>2]=kf[i>>2],kf[t+4>>2]=kf[i+4>>2],kf[t+8>>2]=kf[i+8>>2],kf[t+12>>2]=kf[i+12>>2],n=1,0|n):(n=0,0|n)}function xs(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0,h=0,l=0,c=0;If[t+53>>0]=1;do if((0|kf[t+4>>2])==(0|n)){if(If[t+52>>0]=1,e=t+16|0,s=0|kf[e>>2],a=t+54|0,o=t+48|0,h=t+24|0,l=t+36|0,!s){if(kf[e>>2]=i,kf[h>>2]=r,kf[l>>2]=1,!(1==(0|kf[o>>2])&1==(0|r)))break;If[a>>0]=1;break}if((0|s)!=(0|i)){kf[l>>2]=(0|kf[l>>2])+1,If[a>>0]=1;break}l=0|kf[h>>2],2==(0|l)?(kf[h>>2]=r,c=r):c=l,1==(0|kf[o>>2])&1==(0|c)&&(If[a>>0]=1)}while(0)}function Os(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(kf[e>>2]=3012,t=e+48|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&xp[127&kf[(0|kf[i>>2])+4>>2]](i),kf[e>>2]=3440,i=0|kf[e+20>>2],0|i&&(t=e+24|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=e+8|0,n=0|kf[i>>2]){if(t=e+12|0,e=0|kf[t>>2],(0|e)==(0|n))r=n;else{s=e;do e=s+-4|0,kf[t>>2]=e,a=0|kf[e>>2],kf[e>>2]=0,0|a&&xp[127&kf[(0|kf[a>>2])+4>>2]](a),s=0|kf[t>>2];while((0|s)!=(0|n));r=0|kf[i>>2]}mf(r)}}function ks(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,o=0,h=0,l=0,c=0,d=0;if(!e)return r=1,0|r;if(s=i+8|0,o=0|kf[s+4>>2],h=i+16|0,l=h,c=0|kf[l>>2],d=0|kf[l+4>>2],!((0|o)>(0|d)|((0|o)==(0|d)?(0|kf[s>>2])>>>0>c>>>0:0)))return r=0,0|r;switch(s=0|If[(0|kf[i>>2])+c>>0],o=0|tc(0|c,0|d,1,0),d=h,kf[d>>2]=o,kf[d+4>>2]=qf,s<<24>>24){case 0:return r=0|a(e,t,i,n),0|r;case 1:return r=0|N(e,i,n),0|r;default:return r=0,0|r}return 0}function Ds(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;i=Xf,Xf=Xf+16|0,n=i,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,(0|If[t+11>>0])<0?(r=0|kf[t>>2],s=0|kf[t+4>>2],s>>>0>4294967279&&Du(e),s>>>0<11?(If[e+11>>0]=s,a=e):(o=s+16&-16,h=0|sl(o),kf[e>>2]=h,kf[e+8>>2]=o|-2147483648,kf[e+4>>2]=s,a=h),0|ed(a,r,s),If[n>>0]=0,su(a+s|0,n)):(kf[e>>2]=kf[t>>2],kf[e+4>>2]=kf[t+4>>2],kf[e+8>>2]=kf[t+8>>2]),Xf=i}function Ls(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;return(n=0|kn(e,t))?(t=n+20|0,e=0|kf[t>>2],s=n+24|0,n=0|kf[s>>2],(0|e)==(0|n)?(r=0,0|r):(ea(i,n-e|0,0),e=0|Go(i,0),i=0|kf[t>>2],0|ui(0|e,0|i,(0|kf[s>>2])-i|0),r=1,0|r)):(r=0,0|r)}function Ns(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0;do if(0|Ud(e,0|kf[t+8>>2],r))Qh(0,t,i,n);else if(0|Ud(e,0|kf[t>>2],r)){if(s=t+32|0,(0|kf[t+16>>2])!=(0|i)?(a=t+20|0,(0|kf[a>>2])!=(0|i)):0){kf[s>>2]=n,kf[a>>2]=i,a=t+40|0,kf[a>>2]=(0|kf[a>>2])+1,(1==(0|kf[t+36>>2])?2==(0|kf[t+24>>2]):0)&&(If[t+54>>0]=1),kf[t+44>>2]=4;break}1==(0|n)&&(kf[s>>2]=1)}while(0)}function Fs(e){e=0|e,bf(e+496|0),bf(e+480|0),bf(e+464|0),bf(e+448|0),bf(e+432|0),bf(e+416|0),bf(e+400|0),bf(e+384|0),bf(e+368|0),bf(e+352|0),bf(e+336|0),bf(e+320|0),bf(e+304|0),bf(e+288|0),bf(e+272|0),bf(e+256|0),bf(e+240|0),bf(e+224|0),bf(e+208|0),bf(e+192|0),bf(e+176|0),bf(e+160|0),bf(e+144|0),bf(e+128|0),bf(e+112|0),bf(e+96|0),bf(e+80|0),bf(e+64|0),bf(e+48|0),bf(e+32|0),bf(e+16|0),bf(e)}function Bs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0;if(n=e+i|0,t=255&t,(0|i)>=67){for(;3&e;)If[e>>0]=t,e=e+1|0;for(r=n&-4|0,s=r-64|0,a=t|t<<8|t<<16|t<<24;(0|e)<=(0|s);)kf[e>>2]=a,kf[e+4>>2]=a,kf[e+8>>2]=a,kf[e+12>>2]=a,kf[e+16>>2]=a,kf[e+20>>2]=a,kf[e+24>>2]=a,kf[e+28>>2]=a,kf[e+32>>2]=a,kf[e+36>>2]=a,kf[e+40>>2]=a,kf[e+44>>2]=a,kf[e+48>>2]=a,kf[e+52>>2]=a,kf[e+56>>2]=a,kf[e+60>>2]=a,e=e+64|0;for(;(0|e)<(0|r);)kf[e>>2]=a,e=e+4|0}for(;(0|e)<(0|n);)If[e>>0]=t,e=e+1|0;return n-i|0}function Vs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0,d=0,u=0,f=0;if(!t)return n=0,void(kf[i>>2]=n);for(r=e+8|0,s=e+4|0,a=0-(0|Lf[e+12>>0])&255,o=0|kf[r>>2],h=t,t=0;;){if(l=t<<1,(o>>>0<4096?(c=0|kf[s>>2],(0|c)>0):0)?(d=0|kf[e>>2],u=c+-1|0,kf[s>>2]=u,c=0|Lf[d+u>>0]|o<<8,kf[r>>2]=c,f=c):f=o,c=255&f,u=0|np(f>>>8,a),d=c>>>0<a>>>0,o=d?u+c|0:f-a-u|0,kf[r>>2]=o,u=1&d|l,h=h+-1|0,!h){n=u;break}t=u}kf[i>>2]=n}function Us(e,t){e=0|e,t=0|t;var i=0;switch(0|kf[(0|kf[e+8>>2])+28>>2]){case 2:return Rr(e,t),i=1,0|i;case 1:return Rr(e,t),i=1,0|i;case 4:return br(e,t),i=1,0|i;case 3:return br(e,t),i=1,0|i;case 6:return Er(e,t),i=1,0|i;case 5:return Er(e,t),i=1,0|i;default:return i=0,0|i}return 0}function Gs(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;return i=Xf,Xf=Xf+16|0,n=i,kf[e>>2]=t,kf[e+68>>2]=0,kf[e+72>>2]=0,Oe(n,t),r=e+4|0,s=0|kf[n>>2],kf[n>>2]=0,a=0|kf[r>>2],kf[r>>2]=s,a?(is(a),mf(a),a=0|kf[n>>2],kf[n>>2]=0,0|a&&(is(a),mf(a))):kf[n>>2]=0,0|kf[r>>2]?(r=((0|kf[t+100>>2])-(0|kf[t+96>>2])|0)/12|0,If[n>>0]=0,pi(e+56|0,r,n),o=1,Xf=i,0|o):(o=0,Xf=i,0|o)}function Ws(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0;if((0|n)<0)return r=0,0|r;do if(t)Vt(e,t,t+i|0);else{if(n=e+4|0,s=0|kf[n>>2],a=0|kf[e>>2],o=s-a|0,i>>>0>o>>>0){qr(e,i-o|0);break}(i>>>0<o>>>0?(o=a+i|0,(0|s)!=(0|o)):0)&&(kf[n>>2]=o)}while(0);return i=e+24|0,e=i,t=0|tc(0|kf[e>>2],0|kf[e+4>>2],1,0),e=i,kf[e>>2]=t,kf[e+4>>2]=qf,r=1,0|r}function zs(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=1368,t=e+16|0,e=0|kf[t>>2],kf[t>>2]=0,e&&(t=e+88|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&(t=0|kf[i+8>>2],0|t&&(n=i+12|0,(0|kf[n>>2])!=(0|t)&&(kf[n>>2]=t),mf(t)),mf(i)),i=0|kf[e+68>>2],0|i&&(t=e+72|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=e+64|0,n=0|kf[i>>2],kf[i>>2]=0,0|n&&(i=0|kf[n>>2],0|i&&(t=n+4|0,(0|kf[t>>2])!=(0|i)&&(kf[t>>2]=i),mf(i)),mf(n)),mf(e))}function Hs(e,t,i,n,r,s,a){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a;var o=0,h=0,l=0,c=0;(-17-t|0)>>>0<i>>>0&&Du(e),o=(0|If[e+11>>0])<0?0|kf[e>>2]:e,t>>>0<2147483623?(h=i+t|0,i=t<<1,l=h>>>0<i>>>0?i:h,c=l>>>0<11?11:l+16&-16):c=-17,l=0|sl(c),0|r&&0|ed(l,o,r),h=n-s-r|0,0|h&&0|ed(l+r+a|0,o+r+s|0,h),10!=(0|t)&&mf(o),kf[e>>2]=l,kf[e+8>>2]=c|-2147483648}function js(e,t){return e=0|e,t=0|t,t?(js(e,0|kf[t>>2]),js(e,0|kf[t+4>>2]),Js(t+20|0,0|kf[t+24>>2]),void mf(t)):void 0}function Ys(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;return i=e+64|0,(0==(0|kf[i>>2])?(n=0|sl(32),wl(n),r=0|kf[i>>2],kf[i>>2]=n,0|r):0)&&(n=0|kf[r>>2],0|n&&(s=r+4|0,(0|kf[s>>2])!=(0|n)&&(kf[s>>2]=n),mf(n)),mf(r)),r=0|oh(0|kf[e+28>>2]),n=0|np(0|If[e+24>>0],r),r=((0|n)<0)<<31>>31,s=0|kf[i>>2],a=0|pl(0|n,0|r,0|t,0),0|Ws(s,0,a,qf)?(Ka(e,0|kf[i>>2],n,r,0,0),kf[e+80>>2]=t,o=1,0|o):(o=0,0|o)}function Xs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;return n=Xf,Xf=Xf+32|0,r=n+20|0,s=n+16|0,a=n,o=0|If[e+24>>0],kf[a>>2]=kf[294],kf[a+4>>2]=kf[295],kf[a+8>>2]=kf[296],kf[a+12>>2]=kf[297],kf[s>>2]=t,kf[r>>2]=kf[s>>2],0|ir(e,r,o,a)?(At(i,a,a+(o<<24>>24<<2)|0),h=1,Xf=n,0|h):(h=0,Xf=n,0|h)}function Zs(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;if(n=Xf,Xf=Xf+64|0,r=n,0|Ud(e,t,0))h=1;else if(0!=(0|t)?(s=0|dr(t,1072,1056,0),0!=(0|s)):0){t=r+4|0,a=t+52|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|a));kf[r>>2]=s,kf[r+8>>2]=e,kf[r+12>>2]=-1,kf[r+48>>2]=1,Dp[7&kf[(0|kf[s>>2])+28>>2]](s,r,0|kf[i>>2],1),1==(0|kf[r+24>>2])?(kf[i>>2]=kf[r+16>>2],o=1):o=0,h=o}else h=0;return Xf=n,0|h}function Ks(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return(n=0|kn(e,t))?(t=0|kf[n+20>>2],4!=((0|kf[n+24>>2])-t|0)?(r=0,0|r):(n=t,t=Lf[n>>0]|Lf[n+1>>0]<<8|Lf[n+2>>0]<<16|Lf[n+3>>0]<<24,If[i>>0]=t,If[i+1>>0]=t>>8,If[i+2>>0]=t>>16,If[i+3>>0]=t>>24,r=1,0|r)):(r=0,0|r)}function Qs(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;if(i=t+8|0,n=0|kf[i+4>>2],r=t+16|0,s=r,a=0|kf[s>>2],o=0|kf[s+4>>2],!((0|n)>(0|o)|((0|n)==(0|o)?(0|kf[i>>2])>>>0>a>>>0:0)))return h=0,0|h;i=0|If[(0|kf[t>>2])+a>>0],n=0|tc(0|a,0|o,1,0),o=r,kf[o>>2]=n,kf[o+4>>2]=qf,o=255&i;do{if(128&o){if(0|Qs(e,t)){n=kf[e>>2]<<7,kf[e>>2]=n,l=n|127&i;break}return h=0,0|h}l=o}while(0);return kf[e>>2]=l,h=1,0|h}function Js(e,t){e=0|e,t=0|t;var i=0;t&&(Js(e,0|kf[t>>2]),Js(e,0|kf[t+4>>2]),e=t+16|0,i=t+28|0,(0|If[i+11>>0])<0&&mf(0|kf[i>>2]),(0|If[e+11>>0])<0&&mf(0|kf[e>>2]),mf(t))}function qs(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;t=e;e:do if(3&t)for(r=t,s=e;;){if(!(0|If[s>>0])){a=r;break e}if(o=s+1|0,r=o,!(3&r)){i=o,n=4;break}s=o}else i=e,n=4;while(0);if(4==(0|n)){for(n=i;;){if(h=0|kf[n>>2],(h&-2139062144^-2139062144)&h+-16843009)break;n=n+4|0}if((255&h)<<24>>24)for(h=n;;){if(n=h+1|0,!(0|If[n>>0])){l=n;break}h=n}else l=n;a=l}return a-t|0}function $s(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;if(kf[e>>2]=3440,t=0|kf[e+20>>2],0|t&&(i=e+24|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+8|0,n=0|kf[t>>2],!n)return void mf(e);if(i=e+12|0,r=0|kf[i>>2],(0|r)==(0|n))s=n;else{a=r;do r=a+-4|0,kf[i>>2]=r,o=0|kf[r>>2],kf[r>>2]=0,0|o&&xp[127&kf[(0|kf[o>>2])+4>>2]](o),a=0|kf[i>>2];while((0|a)!=(0|n));s=0|kf[t>>2]}mf(s),mf(e)}function ea(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;n=Xf,Xf=Xf+16|0,r=n,s=e+11|0,a=0|If[s>>0],o=a<<24>>24<0,h=o?0|kf[e+4>>2]:255&a;do{if(h>>>0>=t>>>0){if(o){a=(0|kf[e>>2])+t|0,If[r>>0]=0,su(a,r),kf[e+4>>2]=t;break}If[r>>0]=0,su(e+t|0,r),If[s>>0]=t;break}0|Cs(e,t-h|0,i)}while(0);Xf=n}function ta(e){e=0|e;var t=0,i=0,n=0;e&&(t=e+88|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&(t=0|kf[i+8>>2],0|t&&(n=i+12|0,(0|kf[n>>2])!=(0|t)&&(kf[n>>2]=t),mf(t)),mf(i)),i=0|kf[e+68>>2],0|i&&(t=e+72|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i)),i=e+64|0,n=0|kf[i>>2],kf[i>>2]=0,0|n&&(i=0|kf[n>>2],0|i&&(t=n+4|0,(0|kf[t>>2])!=(0|i)&&(kf[t>>2]=i),mf(i)),mf(n)),mf(e))}function ia(e,t,i,n,r,s,a,o,h,l){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a,o=0|o,h=0|h,l=0|l;var c=0,d=0,u=0;kf[e>>2]=i,0|i&&(c=i+16|0,d=0|kf[c+4>>2],u=e+8|0,kf[u>>2]=kf[c>>2],kf[u+4>>2]=d,d=i+24|0,i=0|kf[d+4>>2],u=e+16|0,kf[u>>2]=kf[d>>2],kf[u+4>>2]=i),If[e+24>>0]=n,kf[e+28>>2]=r,If[e+32>>0]=1&s,s=e+40|0,kf[s>>2]=a,kf[s+4>>2]=o,o=e+48|0,kf[o>>2]=h,kf[o+4>>2]=l,kf[e+56>>2]=t}function na(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;i=0|sl(88),n=i+60|0,r=i,s=r+60|0;do kf[r>>2]=0,r=r+4|0;while((0|r)<(0|s));kf[n>>2]=i,n=i+64|0,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,kf[n+12>>2]=0,kf[n+16>>2]=0,kf[n+20>>2]=0,n=0|Tt(i,t),kf[e>>2]=n?i:0,e=n?0:i,n||(is(e),mf(e))}function ra(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;i=Xf,Xf=Xf+16|0,n=i,r=255&t,If[n>>0]=r,s=e+16|0,a=0|kf[s>>2],a?(o=a,h=4):0|Fo(e)?l=-1:(o=0|kf[s>>2],h=4);do if(4==(0|h)){if(a=e+20|0,s=0|kf[a>>2],s>>>0<o>>>0?(c=255&t,(0|c)!=(0|If[e+75>>0])):0){kf[a>>2]=s+1,If[s>>0]=r,l=c;break}l=1==(0|Pp[31&kf[e+36>>2]](e,n,1))?0|Lf[n>>0]:-1}while(0);return Xf=i,0|l}function sa(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;i=Xf,Xf=Xf+16|0,n=i,r=i+4|0,kf[n>>2]=t,t=0|sl(32),kf[r>>2]=t,kf[r+8>>2]=-2147483616,kf[r+4>>2]=24,s=t,a=11771,o=s+24|0;do If[s>>0]=0|If[a>>0],s=s+1|0,a=a+1|0;while((0|s)<(0|o));return If[t+24>>0]=0,fa(0|On(e,n),r,1),(0|If[r+11>>0])>=0?void(Xf=i):(mf(0|kf[r>>2]),void(Xf=i))}function aa(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0,c=0;for(t=e;;){if(i=0|If[t>>0],n=i<<24>>24,r=t+1|0,!(0|Nu(n)))break;t=r}switch(0|n){case 45:s=1,a=5;break;case 43:s=0,a=5;break;default:o=i,h=0,l=t}if(5==(0|a)&&(o=0|If[r>>0],h=s,l=r),r=(o<<24>>24)+-48|0,r>>>0<10)for(o=r,r=0,s=l;;){if(s=s+1|0,l=(10*r|0)-o|0,o=(0|If[s>>0])+-48|0,o>>>0>=10){c=l;break}r=l}else c=0;return 0|(0|h?c:0-c|0)}function oa(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(kf[e>>2]=3440,t=0|kf[e+20>>2],0|t&&(i=e+24|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+8|0,n=0|kf[t>>2]){if(i=e+12|0,e=0|kf[i>>2],(0|e)==(0|n))r=n;else{s=e;do e=s+-4|0,kf[i>>2]=e,a=0|kf[e>>2],kf[e>>2]=0,0|a&&xp[127&kf[(0|kf[a>>2])+4>>2]](a),s=0|kf[i>>2];while((0|s)!=(0|n));r=0|kf[t>>2]}mf(r)}}function ha(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=3072,t=e+84|0,i=e+4|0,n=i+80|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+88>>2]=-1,kf[e+92>>2]=-1,t=e+152|0,i=e+96|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));Gf[t>>2]=ap(1),t=e+212|0,i=e+156|0,n=i+56|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=-1,kf[e+216>>2]=0,kf[e+220>>2]=0,kf[e+224>>2]=0,Fh(e+232|0)}function la(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;i=255&e,n=255&e,((0|kf[t+76>>2])>=0?0!=(0|Ef(t)):0)?(((0|n)!=(0|If[t+75>>0])?(r=t+20|0,s=0|kf[r>>2],s>>>0<(0|kf[t+16>>2])>>>0):0)?(kf[r>>2]=s+1,If[s>>0]=i,a=n):a=0|ra(t,e),bf(t),o=a):h=3;do if(3==(0|h)){if((0|n)!=(0|If[t+75>>0])?(a=t+20|0,s=0|kf[a>>2],s>>>0<(0|kf[t+16>>2])>>>0):0){kf[a>>2]=s+1,If[s>>0]=i,o=n;break}o=0|ra(t,e)}while(0);return 0|o}function ca(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;if(t>>>0>0|0==(0|t)&e>>>0>4294967295){for(n=e,r=t,t=i;;){if(s=0|nl(0|n,0|r,10,0),t=t+-1|0,If[t>>0]=255&s|48,s=n,n=0|Yd(0|n,0|r,10,0),!(r>>>0>9|9==(0|r)&s>>>0>4294967295))break;r=qf}a=t,o=n}else a=i,o=e;if(o)for(e=a,a=o;;){if(o=e+-1|0,If[o>>0]=(a>>>0)%10|0|48,a>>>0<10){h=o;break}e=o,a=(a>>>0)/10|0}else h=a;return 0|h}function da(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0;kf[e>>2]=0,i=e+4|0,kf[i>>2]=0,kf[e+8>>2]=0,n=t+4|0,r=(0|kf[n>>2])-(0|kf[t>>2])|0,s=(0|r)/20|0,r&&(s>>>0>214748364&&Du(e),a=0|sl(r),kf[i>>2]=a,kf[e>>2]=a,kf[e+8>>2]=a+(20*s|0),s=0|kf[t>>2],t=(0|kf[n>>2])-s|0,(0|t)<=0||(0|ui(0|a,0|s,0|t),kf[i>>2]=a+(20*((t>>>0)/20|0)|0)))}function ua(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0;return t=0|kf[e+32>>2],i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|tc(0|a,0|kf[s+4>>2],4,0),s=qf,(0|r)<(0|s)|(0|r)==(0|s)&n>>>0<o>>>0?(h=0,0|h):(n=(0|kf[t>>2])+a|0,a=Lf[n>>0]|Lf[n+1>>0]<<8|Lf[n+2>>0]<<16|Lf[n+3>>0]<<24,n=i,kf[n>>2]=o,kf[n+4>>2]=s,(0|a)<0?(h=0,0|h):(kf[(0|kf[e+4>>2])+80>>2]=a,h=1,0|h))}function fa(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;n=Xf,Xf=Xf+16|0,r=n,Po(r,1&i),i=0|Xr(e,t),t=i+11|0,(0|If[t>>0])<0?(If[kf[i>>2]>>0]=0,kf[i+4>>2]=0):(If[i>>0]=0,If[t>>0]=0),yi(i,0),kf[i>>2]=kf[r>>2],kf[i+4>>2]=kf[r+4>>2],kf[i+8>>2]=kf[r+8>>2],Xf=n}function pa(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0,l=0;
i=e+8|0,n=0|kf[e>>2],(0|kf[i>>2])-n>>2>>>0>=t>>>0||(r=e+4|0,t>>>0>1073741823&&(s=0|dp(8),cd(s,13392),kf[s>>2]=4748,fp(0|s,1128,101)),s=(0|kf[r>>2])-n|0,a=s>>2,o=0|sl(t<<2),h=o+(a<<2)|0,l=h+(0-a<<2)|0,(0|s)>0&&0|ui(0|l,0|n,0|s),kf[e>>2]=l,kf[r>>2]=h,kf[i>>2]=o+(t<<2),n&&mf(n))}function _a(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=2124,t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+84>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&mf(t),t=0|kf[e+60>>2],0|t&&mf(t),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function ma(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;return n=0|Jt(e,t),(0|n)==(e+4|0)?(r=-1,s=(0|r)==-1,a=0!=(0|r),o=s?i:a,0|o):(e=n+28|0,h=(0|If[e+11>>0])<0?0|kf[e>>2]:e,r=0|aa(h),s=(0|r)==-1,a=0!=(0|r),o=s?i:a,0|o)}function Aa(e){e=0|e;var t=0,i=0,n=0,r=0;if(bf(e+168|0),t=0|kf[e+156>>2],0|t&&(i=e+160|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=e+136|0,n=0|kf[t>>2],kf[t>>2]=0,0|n){if(t=n+-4|0,i=0|kf[t>>2],0|i){r=n+(i<<4)|0;do r=r+-16|0,bf(r);while((0|r)!=(0|n))}pf(t)}bf(e+120|0),bf(e+80|0),bf(e+64|0),bf(e+24|0)}function va(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1760,t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+84>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&mf(t),t=0|kf[e+60>>2],0|t&&mf(t),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function ya(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;for(i=0;;){if((0|Lf[13994+i>>0])==(0|e)){n=2;break}if(r=i+1|0,87==(0|r)){s=87,a=14082,n=5;break}i=r}if(2==(0|n)&&(i?(s=i,a=14082,n=5):o=14082),5==(0|n))for(;;){n=0,i=a;do e=i,i=i+1|0;while(0!=(0|If[e>>0]));if(s=s+-1|0,!s){o=i;break}a=i,n=5}return 0|Gu(o,0|kf[t+20>>2])}function ga(e,t){e=+e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0,h=0;switch(zf[Yf>>3]=e,i=0|kf[Yf>>2],n=0|kf[Yf+4>>2],r=0|rc(0|i,0|n,52),2047&r){case 0:0!=e?(s=+ga(0x10000000000000000*e,t),a=(0|kf[t>>2])+-64|0,o=s):(a=0,o=e),kf[t>>2]=a,h=o;break;case 2047:h=e;break;default:kf[t>>2]=(2047&r)+-1022,kf[Yf>>2]=i,kf[Yf+4>>2]=n&-2146435073|1071644672,h=+zf[Yf>>3]}return+h}function ba(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0,h=0;return t=0|kf[e+32>>2],i=t+8|0,n=0|kf[i>>2],r=0|kf[i+4>>2],i=t+16|0,s=i,a=0|kf[s>>2],o=0|tc(0|a,0|kf[s+4>>2],4,0),s=qf,(0|r)<(0|s)|(0|r)==(0|s)&n>>>0<o>>>0?(h=0,0|h):(n=(0|kf[t>>2])+a|0,a=Lf[n>>0]|Lf[n+1>>0]<<8|Lf[n+2>>0]<<16|Lf[n+3>>0]<<24,n=i,kf[n>>2]=o,kf[n+4>>2]=s,kf[(0|kf[e+4>>2])+80>>2]=a,h=1,0|h)}function Ea(e){e=0|e;var t=0,i=0;kf[e>>2]=2124,t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+84>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&mf(t),t=0|kf[e+60>>2],0|t&&mf(t),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Ta(e){e=0|e;var t=0,i=0;kf[e>>2]=1760,t=0|kf[e+96>>2],0|t&&mf(t),t=0|kf[e+84>>2],0|t&&mf(t),t=0|kf[e+72>>2],0|t&&mf(t),t=0|kf[e+60>>2],0|t&&mf(t),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Sa(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0;kf[e>>2]=0,i=e+4|0,kf[i>>2]=0,kf[e+8>>2]=0,n=t+4|0,r=(0|kf[n>>2])-(0|kf[t>>2])|0,s=r>>2,s&&(s>>>0>1073741823&&Du(e),a=0|sl(r),kf[i>>2]=a,kf[e>>2]=a,kf[e+8>>2]=a+(s<<2),s=0|kf[t>>2],t=(0|kf[n>>2])-s|0,(0|t)<=0||(0|ui(0|a,0|s,0|t),kf[i>>2]=a+(t>>>2<<2)))}function wa(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0;if(e=0|kf[t+4>>2],!e)return n=0,0|n;if(r=0|kf[(0|kf[(0|kf[t+8>>2])+(i<<2)>>2])+60>>2],i=0|kf[e+40>>2],t=0|kf[e+44>>2],(0|i)==(0|t))return n=0,0|n;for(s=i;;){if(i=0|kf[s>>2],s=s+4|0,(0|kf[i+40>>2])==(0|r)){n=i,a=5;break}if((0|s)==(0|t)){n=0,a=5;break}}return 5==(0|a)?0|n:0}function Ca(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;if(i=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),(0|i)<=0)return n=1,0|n;for(r=e+36|0,s=e+48|0,e=0;;){if(a=0|kf[(0|kf[r>>2])+(e<<2)>>2],e=e+1|0,!(0|Pp[31&kf[(0|kf[a>>2])+20>>2]](a,s,t))){n=0,o=5;break}if((0|e)>=(0|i)){n=1,o=5;break}}return 5==(0|o)?0|n:0}function Ma(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;switch(i<<24>>24){case 0:i=0|sl(20),_c(i),n=i;break;case 1:i=0|sl(24),zc(i),n=i;break;case 2:i=0|sl(36),Cl(i),n=i;break;case 3:i=0|sl(28),Dc(i),n=i;break;default:n=0}kf[e>>2]=n}function Pa(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0,o=0;if(i=0|Cp[127&kf[(0|kf[e>>2])+24>>2]](e),(0|i)<=0)return n=1,0|n;for(r=e+36|0,s=e+48|0,e=0;;){if(a=0|kf[(0|kf[r>>2])+(e<<2)>>2],e=e+1|0,!(0|Pp[31&kf[(0|kf[a>>2])+16>>2]](a,s,t))){n=0,o=5;break}if((0|e)>=(0|i)){n=1,o=5;break}}return 5==(0|o)?0|n:0}function Ia(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;if(kf[e>>2]=0,n=e+4|0,kf[n>>2]=0,kf[e+8>>2]=0,t){t>>>0>357913941&&Du(e),r=0|sl(12*t|0),kf[n>>2]=r,kf[e>>2]=r,kf[e+8>>2]=r+(12*t|0),e=r,r=t;do Sa(e,i),e=(0|kf[n>>2])+12|0,kf[n>>2]=e,r=r+-1|0;while(0!=(0|r))}}function Ra(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;return(i=0|kf[t>>2])?(r=e+44|0,s=0|kf[r>>2],s>>>0<(0|kf[e+48>>2])>>>0?(kf[t>>2]=0,kf[s>>2]=i,kf[r>>2]=(0|kf[r>>2])+4,n=1,0|n):(ti(e+40|0,t),n=1,0|n)):(n=0,0|n)}function xa(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=3124,t=0|kf[e+64>>2],0|t&&(i=e+68|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),kf[e+12>>2]=3148,t=0|kf[e+32>>2],0|t&&mf(t),(t=0|kf[e+20>>2])?(mf(t),void mf(e)):void mf(e)}function Oa(e){e=0|e;var t=0;return 0|kf[e+44>>2]&&0|kf[e+48>>2]&&0|kf[e+24>>2]&&0|kf[e+28>>2]&&0|kf[e+32>>2]&&0|kf[e+36>>2]?(t=(0|kf[e+72>>2])!=-1,0|t):(t=0,0|t)}function ka(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;kf[t>>2]=2,i=e+4|0,e=t+8|0,n=0|kf[e>>2],r=(0|kf[t+12>>2])-n|0,r>>>0<4294967292?(Ja(e,r+4|0,0),s=0|kf[e>>2]):s=n,n=s+r|0,r=Lf[i>>0]|Lf[i+1>>0]<<8|Lf[i+2>>0]<<16|Lf[i+3>>0]<<24,If[n>>0]=r,If[n+1>>0]=r>>8,If[n+2>>0]=r>>16,If[n+3>>0]=r>>24}function Da(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=3216,t=0|kf[e+64>>2],0|t&&(i=e+68|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),kf[e+12>>2]=3196,t=0|kf[e+32>>2],0|t&&mf(t),(t=0|kf[e+20>>2])?(mf(t),void mf(e)):void mf(e)}function La(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=2180,t=0|kf[e+76>>2],0|t&&mf(t),t=e+68|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1536,(i=0|kf[e+32>>2])?(t=e+36|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i),void mf(e)):void mf(e)}function Na(e){e=0|e;var t=0;return 0|kf[e+64>>2]&&0|kf[e+68>>2]&&0|kf[e+44>>2]&&0|kf[e+48>>2]&&0|kf[e+52>>2]&&0|kf[e+56>>2]?(t=(0|kf[e+92>>2])!=-1,0|t):(t=0,0|t)}function Fa(e){e=0|e;var t=0;e&&(t=e+28|0,(0|If[t+11>>0])<0&&mf(0|kf[t>>2]),js(e+12|0,0|kf[e+16>>2]),Js(e,0|kf[e+4>>2]),mf(e))}function Ba(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=3124,t=0|kf[e+64>>2],0|t&&(i=e+68|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),kf[e+12>>2]=3148,t=0|kf[e+32>>2],0|t&&mf(t),t=0|kf[e+20>>2],t&&mf(t)}function Va(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1816,t=0|kf[e+76>>2],0|t&&mf(t),t=e+68|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1536,(i=0|kf[e+32>>2])?(t=e+36|0,n=0|kf[t>>2],(0|n)!=(0|i)&&(kf[t>>2]=n+(~((n+-4-i|0)>>>2)<<2)),mf(i),void mf(e)):void mf(e)}function Ua(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;if(e){if(t=0|kf[e>>2],0|t){if(i=e+4|0,n=0|kf[i>>2],(0|n)==(0|t))r=t;else{for(s=n;;){if(n=s+-12|0,kf[i>>2]=n,(0|If[n+11>>0])<0?(mf(0|kf[n>>2]),a=0|kf[i>>2]):a=n,(0|a)==(0|t))break;s=a}r=0|kf[e>>2]}mf(r)}mf(e)}}function Ga(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0;pn(e,t),(0|t)<=-1||(i=e+88|0,n=0|kf[i>>2],r=0|kf[e+84>>2],(n-r>>2|0)<=(0|t)||(e=r+(t<<2)|0,t=e+4|0,r=n-t|0,s=r>>2,s?(0|Sh(0|e,0|t,0|r),a=0|kf[i>>2]):a=n,r=e+(s<<2)|0,(0|a)!=(0|r)&&(kf[i>>2]=a+(~((a+-4-r|0)>>>2)<<2))))}function Wa(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=3216,t=0|kf[e+64>>2],0|t&&(i=e+68|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),kf[e+12>>2]=3196,t=0|kf[e+32>>2],0|t&&mf(t),t=0|kf[e+20>>2],t&&mf(t)}function za(e){e=0|e;var t=0,i=0;kf[e>>2]=2180,t=0|kf[e+76>>2],0|t&&mf(t),t=e+68|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1536,i=0|kf[e+32>>2],i&&(t=e+36|0,e=0|kf[t>>2],(0|e)!=(0|i)&&(kf[t>>2]=e+(~((e+-4-i|0)>>>2)<<2)),mf(i))}function Ha(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=3580,t=0|kf[e+96>>2],0|t&&(i=e+100|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(12*~(((n+-12-t|0)>>>0)/12|0)|0)),mf(t)),(t=0|kf[e+84>>2])?(n=e+88|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t),Zt(e),void mf(e)):(Zt(e),void mf(e))}function ja(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;return!(((0|Lf[(0|kf[e+4>>2])+36>>0])<<8&65535)<512)||0|Cp[127&kf[(0|kf[e>>2])+52>>2]](e)?(n=0|Pn(e,t,i),0|n):(n=0,0|n)}function Ya(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,h=0,l=0;return r=t>>31|((0|t)<0?-1:0)<<1,s=((0|t)<0?-1:0)>>31|((0|t)<0?-1:0)<<1,a=n>>31|((0|n)<0?-1:0)<<1,h=((0|n)<0?-1:0)>>31|((0|n)<0?-1:0)<<1,l=0|nc(r^e|0,s^t|0,0|r,0|s),t=qf,e=a^r,r=h^s,0|nc((0|o(l,t,0|nc(a^i|0,h^n|0,0|a,0|h),qf,0))^e|0,qf^r|0,0|e,0|r)}function Xa(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0;e=t+16|0,r=0|kf[e>>2],s=t+36|0,a=t+24|0;do if(r){if((0|r)!=(0|i)){kf[s>>2]=(0|kf[s>>2])+1,kf[a>>2]=2,If[t+54>>0]=1;break}2==(0|kf[a>>2])&&(kf[a>>2]=n)}else kf[e>>2]=i,kf[a>>2]=n,kf[s>>2]=1;while(0)}function Za(e){e=0|e;var t=0,i=0;kf[e>>2]=1816,t=0|kf[e+76>>2],0|t&&mf(t),t=e+68|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1536,i=0|kf[e+32>>2],i&&(t=e+36|0,e=0|kf[t>>2],(0|e)!=(0|i)&&(kf[t>>2]=e+(~((e+-4-i|0)>>>2)<<2)),mf(i))}function Ka(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0,o=0,h=0;kf[e>>2]=t,a=t+16|0,o=0|kf[a+4>>2],h=e+8|0,kf[h>>2]=kf[a>>2],kf[h+4>>2]=o,o=t+24|0,t=0|kf[o+4>>2],h=e+16|0,kf[h>>2]=kf[o>>2],kf[h+4>>2]=t,t=e+40|0,kf[t>>2]=i,kf[t+4>>2]=n,n=e+48|0,kf[n>>2]=r,kf[n+4>>2]=s}function Qa(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0,o=0;return t=0|Lf[e+12>>0],i=e+8|0,n=0|kf[i>>2],(n>>>0<4096?(r=e+4|0,s=0|kf[r>>2],(0|s)>0):0)?(a=0|kf[e>>2],e=s+-1|0,kf[r>>2]=e,r=0|Lf[a+e>>0]|n<<8,kf[i>>2]=r,o=r):o=n,n=255&o,r=0-t&255,t=0|np(o>>>8,r),e=n>>>0<r>>>0,kf[i>>2]=e?t+n|0:o-r-t|0,0|e}function Ja(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0;i=e+4|0,n=0|kf[i>>2],r=0|kf[e>>2],s=n-r|0,a=r,r=n,t>>>0<=s>>>0?(t>>>0<s>>>0?(n=a+t|0,(0|r)!=(0|n)):0)&&(kf[i>>2]=n):qr(e,t-s|0),s=e+24|0,e=s,t=0|tc(0|kf[e>>2],0|kf[e+4>>2],1,0),e=s,kf[e>>2]=t,kf[e+4>>2]=qf}function qa(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return n=Xf,Xf=Xf+16|0,r=n,qe(r,e,t,i),i=e+24|0,kf[i>>2]=kf[r>>2],t=r+4|0,0|ph(e+28|0,t),(0|If[t+11>>0])>=0?(Xf=n,0|i):(mf(0|kf[t>>2]),Xf=n,0|i)}function $a(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=3580,t=0|kf[e+96>>2],0|t&&(i=e+100|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(12*~(((n+-12-t|0)>>>0)/12|0)|0)),mf(t)),(t=0|kf[e+84>>2])?(n=e+88|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t),void Zt(e)):void Zt(e)}function eo(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=0,kf[e+20>>2]=0,If[e+24>>0]=1,t=e+68|0,i=e+28|0,n=i+40|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=e,t=e+72|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0}function to(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return n=Xf,Xf=Xf+16|0,r=n,$e(r,e,t,i),i=e+24|0,kf[i>>2]=kf[r>>2],t=r+4|0,0|ph(e+28|0,t),(0|If[t+11>>0])>=0?(Xf=n,0|i):(mf(0|kf[t>>2]),Xf=n,0|i)}function io(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=2236,t=0|kf[e+76>>2],0|t&&mf(t),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function no(e){e=0|e;var t=0,i=0,n=0,r=0,s=0;if(t=0|kf[e+8>>2],i=0|kf[e+12>>2],(0|t)==(0|i))return n=1,0|n;for(r=e+32|0,e=t;;){if(t=0|kf[e>>2],e=e+4|0,!(0|Mp[127&kf[(0|kf[t>>2])+16>>2]](t,0|kf[r>>2]))){n=0,s=5;break}if((0|e)==(0|i)){n=1,s=5;break}}return 5==(0|s)?0|n:0}function ro(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return n=0|kf[e+8>>2],(0|If[n+24>>0])<1?(r=0,0|r):0|Ys(n,(0|kf[t+4>>2])-(0|kf[t>>2])>>2)?(r=0|Pp[31&kf[(0|kf[e>>2])+32>>2]](e,t,i),0|r):(r=0,0|r)}function so(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r;var s=0,a=0,o=0;if(s=Xf,Xf=Xf+256|0,a=s,(0|i)>(0|n)&0==(73728&r|0)){if(r=i-n|0,0|Bs(0|a,0|t,0|(r>>>0<256?r:256)),r>>>0>255){t=i-n|0,n=r;do Td(e,a,256),n=n+-256|0;while(n>>>0>255);o=255&t}else o=r;Td(e,a,o)}Xf=s}function ao(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1872,t=0|kf[e+76>>2],0|t&&mf(t),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function oo(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s;var a=0;0|Ud(e,0|kf[t+8>>2],s)?xs(0,t,i,n,r):(a=0|kf[e+8>>2],Np[3&kf[(0|kf[a>>2])+20>>2]](a,t,i,n,r,s))}function ho(e,t){e=0|e,t=0|t;var i=0;return i=0|sl(40),kf[i>>2]=-1,wl(i+8|0),Op[7&kf[(0|kf[e>>2])+16>>2]](e,i),e=t+88|0,t=0|kf[e>>2],kf[e>>2]=i,t?(i=0|kf[t+8>>2],0|i&&(e=t+12|0,(0|kf[e>>2])!=(0|i)&&(kf[e>>2]=i),mf(i)),mf(t),1):1}function lo(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0;if(i=0|kf[e+12>>2],n=0|kf[e+8>>2],e=n,(0|i)==(0|n))return r=0,0|r;for(s=i-n>>2,n=0;;){if(i=0|kf[e+(n<<2)>>2],(0|kf[i+60>>2])==(0|t)){r=i,a=5;break}if(n=n+1|0,n>>>0>=s>>>0){r=0,a=5;break}}return 5==(0|a)?0|r:0}function co(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1256,t=0|kf[e+16>>2],0|t&&(i=e+20|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),(t=0|kf[e+4>>2])?(n=e+8|0,i=0|kf[n>>2],(0|i)!=(0|t)&&(kf[n>>2]=i+(~((i+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function uo(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0,a=0;if(i=0|kf[e+12>>2],n=0|kf[e+8>>2],e=n,(0|i)==(0|n))return r=-1,0|r;for(s=i-n>>2,n=0;;){if((0|kf[(0|kf[e+(n<<2)>>2])+60>>2])==(0|t)){r=n,a=5;break}if(n=n+1|0,n>>>0>=s>>>0){r=-1,a=5;break}}return 5==(0|a)?0|r:0}function fo(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0,o=0,h=0;e:do if(i){for(r=e,s=i,a=t;;){if(o=0|If[r>>0],h=0|If[a>>0],o<<24>>24!=h<<24>>24)break;if(s=s+-1|0,!s){n=0;break e}r=r+1|0,a=a+1|0}n=(255&o)-(255&h)|0}else n=0;while(0);return 0|n}function po(e){e=0|e;var t=0,i=0;kf[e>>2]=2236,t=0|kf[e+76>>2],0|t&&mf(t),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function _o(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=2292,bf(e+108|0),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function mo(e){e=0|e;var t=0,i=0;return kf[e>>2]=2884,t=e+28|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1476,i=e+20|0,t=0|kf[i>>2],kf[i>>2]=0,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),zs(e),void mf(e)):(zs(e),void mf(e))}function Ao(e){e=0|e;var t=0,i=0;for(kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,t=0;;){if(3==(0|t))break;kf[e+(t<<2)>>2]=0,t=t+1|0}i=(0|If[e+11>>0])<0?(2147483647&kf[e+8>>2])+-1|0:10,ea(e,i,0)}function vo(e){e=0|e;var t=0,i=0;kf[e>>2]=1872,t=0|kf[e+76>>2],0|t&&mf(t),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function yo(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1928,bf(e+108|0),kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function go(e){e=0|e;var t=0,i=0,n=0;kf[e>>2]=1256,t=0|kf[e+16>>2],0|t&&(i=e+20|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),t=0|kf[e+4>>2],t&&(n=e+8|0,e=0|kf[n>>2],(0|e)!=(0|t)&&(kf[n>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function bo(e){e=0|e;var t=0,i=0,n=0,r=0,s=0,a=0;t=0|kf[e>>2],i=e+4|0,n=0|kf[i>>2],r=t,s=n+(~((n+-4-r|0)>>>2)<<2)|0,(0|n)==(0|t)?a=t:(kf[i>>2]=s,a=s),kf[e+16>>2]=0,kf[e+12>>2]=a,t&&((0|a)!=(0|t)&&(kf[i>>2]=a+(~((a+-4-r|0)>>>2)<<2)),mf(t))}function Eo(e){e=0|e;var t=0,i=0;return kf[e>>2]=2884,t=e+28|0,i=0|kf[t>>2],kf[t>>2]=0,0|i&&pf(i),kf[e>>2]=1476,i=e+20|0,t=0|kf[i>>2],kf[i>>2]=0,t?(xp[127&kf[(0|kf[t>>2])+4>>2]](t),void zs(e)):void zs(e)}function To(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0;0|Ud(e,0|kf[t+8>>2],0)?Xa(0,t,i,n):(r=0|kf[e+8>>2],Dp[7&kf[(0|kf[r>>2])+28>>2]](r,t,i,n))}function So(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0,a=0,o=0,h=0;return r=0|np(i,t),s=0==(0|t)?0:i,(0|kf[n+76>>2])>-1?(i=0==(0|Ef(n)),a=0|Lr(e,r,n),i?o=a:(bf(n),o=a)):o=0|Lr(e,r,n),h=(0|o)==(0|r)?s:(o>>>0)/(t>>>0)|0,0|h}function wo(e,t){e=0|e,t=0|t;var i=0,n=0;return(0|t)<0?(i=0,0|i):(n=0|kf[e+4>>2],((0|kf[n+12>>2])-(0|kf[n+8>>2])>>2|0)<=(0|t)?(i=0,0|i):(n=0|kf[(0|kf[e+8>>2])+(kf[(0|kf[e+20>>2])+(t<<2)>>2]<<2)>>2],i=0|Mp[127&kf[(0|kf[n>>2])+32>>2]](n,t),0|i))}function Co(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;if(i=0|If[e>>0],n=0|If[t>>0],i<<24>>24==0?1:i<<24>>24!=n<<24>>24)r=n,s=i;else{i=e,e=t;do i=i+1|0,e=e+1|0,t=0|If[i>>0],n=0|If[e>>0];while(!(t<<24>>24==0?1:t<<24>>24!=n<<24>>24));r=n,s=t}return(255&s)-(255&r)|0}function Mo(e){e=0|e;var t=0,i=0;kf[e>>2]=2292,bf(e+108|0),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Po(e,t){e=0|e,t=0|t;var i=0,n=0;i=Xf,Xf=Xf+16|0,n=i,Ao(n),rs(e,n,t),Zc(n),Xf=i}function Io(e){e=0|e;var t=0,i=0;kf[e>>2]=1928,bf(e+108|0),kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Ro(e,t){e=0|e,t=0|t;var i=0,n=0;return i=0|kf[e+4>>2],(0|i?((0|Lf[i+36>>0])<<8&65535)<512:0)?(n=1,0|n):(n=0|Mp[127&kf[(0|kf[e>>2])+48>>2]](e,(0|kf[t+4>>2])-(0|kf[t>>2])>>2),0|n)}function xo(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0,a=0;return n=Xf,Xf=Xf+32|0,r=n,s=n+20|0,kf[r>>2]=kf[e+60>>2],kf[r+4>>2]=0,kf[r+8>>2]=t,kf[r+12>>2]=s,kf[r+16>>2]=i,(0|gc(0|_p(140,0|r)))<0?(kf[s>>2]=-1,a=-1):a=0|kf[s>>2],Xf=n,0|a}function Oo(e,t){e=0|e,t=0|t;var i=0,n=0;return(0|t)==-1|(0|t)>4?(i=0,0|i):(n=0|kf[e+20+(12*t|0)>>2],((0|kf[e+20+(12*t|0)+4>>2])-n|0)<=0?(i=0,0|i):(t=0|kf[n>>2],(0|t)==-1?(i=0,0|i):(i=0|kf[(0|kf[e+8>>2])+(t<<2)>>2],0|i)))}function ko(e,t){e=0|e,t=0|t;var i=0,n=0,r=0;return i=0|kf[e+16>>2],((0|kf[e+20>>2])-i>>2|0)<=(0|t)?(n=0,0|n):(r=0|kf[i+(t<<2)>>2],(0|r)<0?(n=0,0|n):(n=0|yr(0|kf[(0|kf[e+36>>2])+(r<<2)>>2]),0|n))}function Do(e,t){e=0|e,t=0|t;var i=0;Uh(e),kf[e>>2]=1416,i=e+36|0,kf[i>>2]=0,kf[i+4>>2]=0,kf[i+8>>2]=0,kf[i+12>>2]=0,kf[i+16>>2]=0,kf[i+20>>2]=0,i=0|kf[t>>2],kf[t>>2]=0,kf[e+60>>2]=i}function Lo(e,t){e=0|e,t=0|t;var i=0,n=0;i=e,n=t,t=i+64|0;do kf[i>>2]=kf[n>>2],i=i+4|0,n=n+4|0;while((0|i)<(0|t));n=e+64|0,kf[e+88>>2]=0,kf[n>>2]=0,kf[n+4>>2]=0,kf[n+8>>2]=0,kf[n+12>>2]=0,kf[n+16>>2]=0,If[n+20>>0]=0}function No(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0;if(0==(0|e)&0==(0|t))r=i;else for(s=e,e=t,t=i;;){if(i=t+-1|0,If[i>>0]=0|Lf[13976+(15&s)>>0]|n,s=0|rc(0|s,0|e,4),e=qf,0==(0|s)&0==(0|e)){r=i;break}t=i}return 0|r}function Fo(e){e=0|e;var t=0,i=0,n=0;return t=e+74|0,i=0|If[t>>0],If[t>>0]=i+255|i,i=0|kf[e>>2],8&i?(kf[e>>2]=32|i,n=-1):(kf[e+8>>2]=0,kf[e+4>>2]=0,t=0|kf[e+44>>2],kf[e+28>>2]=t,kf[e+20>>2]=t,kf[e+16>>2]=t+(0|kf[e+48>>2]),n=0),0|n}function Bo(e){return e=0|e,0|kf[e+60>>2]&&0|kf[e+44>>2]&&0|kf[e+48>>2]&&0|kf[e+52>>2]?0!=(0|kf[e+56>>2])|0:0}function Vo(e,t){e=0|e,t=0|t;var i=0,n=0;return(i=0|kf[t+88>>2])?2!=(0|kf[i>>2])?(n=0,0|n):(t=0|kf[i+8>>2],kf[e+4>>2]=Lf[t>>0]|Lf[t+1>>0]<<8|Lf[t+2>>0]<<16|Lf[t+3>>0]<<24,n=1,0|n):(n=0,0|n)}function Uo(e){e=0|e;var t=0;return 0|kf[e+44>>2]&&0|kf[e+48>>2]&&0|kf[e+52>>2]?(t=0!=(0|kf[e+56>>2]),0|t):(t=0,0|t)}function Go(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;return i=0|If[e+11>>0],n=i<<24>>24<0,r=n?0|kf[e+4>>2]:255&i,r>>>0<=t>>>0&&Du(e),s=n?0|kf[e>>2]:e,s+t|0}function Wo(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;return n=Xf,Xf=Xf+32|0,r=n,kf[e+36>>2]=15,(0==(64&kf[e>>2]|0)?(kf[r>>2]=kf[e+60>>2],kf[r+4>>2]=21523,kf[r+8>>2]=n+16,0|Ap(54,0|r)):0)&&(If[e+75>>0]=-1),r=0|Qt(e,t,i),Xf=n,0|r}function zo(e,t,i){return e=0|e,t=0|t,i=0|i,0!=(0|t)&0!=(0|i)?void An(e,t,i):void Sn(e,0,0)}function Ho(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=ap(r),kf[e+4>>2]=t,At(e+8|0,i,i+(n<<2)|0),Gf[e+20>>2]=r}function jo(e,t){e=0|e,t=0|t;var i=0;return 0|Mp[127&kf[(0|kf[e>>2])+36>>2]](e,t)&&0|Mp[127&kf[(0|kf[e>>2])+40>>2]](e,t)?(i=0|Cp[127&kf[(0|kf[e>>2])+44>>2]](e),0|i):(i=0,0|i)}function Yo(e){e=0|e;var t=0,i=0;return e=e+15&-16|0,t=0|kf[jf>>2],i=t+e|0,(0|e)>0&(0|i)<(0|t)|(0|i)<0?(0|cp(),pp(12),-1):(kf[jf>>2]=i,((0|i)>(0|lp())?0==(0|hp()):0)?(kf[jf>>2]=t,pp(12),-1):0|t)}function Xo(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0;for(n=0|kf[i>>2],i=e,r=t-e>>2;;){if(!r)break;e=(0|r)/2|0,t=i+(e<<2)|0,s=(0|kf[t>>2])>>>0<n>>>0,i=s?t+4|0:i,r=s?r+-1-e|0:e}return 0|i}function Zo(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;return 0|Dl(e,t,i)?(i=0|kf[e+8>>2],3!=(0|If[i+24>>0])?(n=0,0|n):(n=9==(0|kf[i+28>>2]),0|n)):(n=0,0|n)}function Ko(e){e=0|e;var t=0,i=0,n=0,r=0,s=0;if(t=0|kf[e>>2],i=(0|If[t>>0])+-48|0,i>>>0<10)for(n=t,t=0,r=i;;){if(i=r+(10*t|0)|0,n=n+1|0,kf[e>>2]=n,r=(0|If[n>>0])+-48|0,r>>>0>=10){s=i;break}t=i}else s=0;return 0|s}function Qo(e){e=0|e;var t=0;kf[e>>2]=0,t=e+8|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,If[e+24>>0]=1,kf[e+28>>2]=9,t=e+40|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[e+56>>2]=-1,kf[e+60>>2]=0}function Jo(e,t){e=0|e,t=0|t;var i=0;return 0|kf[t+56>>2]?(i=0,0|i):3!=(0|If[t+24>>0])?(i=0,0|i):(kf[e+44>>2]=t,i=1,0|i)}function qo(e,t){e=0|e,t=0|t;var i=0,n=0;return e=Xf,Xf=Xf+32|0,i=e,_s(i,t),t=0|kf[i+16>>2],n=i+4|0,(0|If[n+11>>0])>=0?(Xf=e,0|t):(mf(0|kf[n>>2]),Xf=e,0|t)}function $o(e,t){e=0|e,t=0|t;var i=0;return 0|kf[t+56>>2]?(i=0,0|i):3!=(0|If[t+24>>0])?(i=0,0|i):(kf[e+64>>2]=t,i=1,0|i)}function eh(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;return 0|Dl(e,t,i)?(n=9==(0|kf[(0|kf[(0|kf[(0|kf[t+4>>2])+8>>2])+(i<<2)>>2])+28>>2]),0|n):(n=0,0|n)}function th(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;if(0==(0|e)&0==(0|t))n=i;else for(r=e,e=t,t=i;;){if(i=t+-1|0,If[i>>0]=7&r|48,r=0|rc(0|r,0|e,3),e=qf,0==(0|r)&0==(0|e)){n=i;break}t=i}return 0|n}function ih(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,0|Ud(e,0|kf[t+8>>2],s)&&xs(0,t,i,n,r)}function nh(e){e=0|e;var t=0,i=0;return kf[e>>2]=1476,t=e+20|0,i=0|kf[t>>2],kf[t>>2]=0,i?(xp[127&kf[(0|kf[i>>2])+4>>2]](i),zs(e),void mf(e)):(zs(e),void mf(e))}function rh(e){e=0|e;var t=0,i=0,n=0,r=0;t=Xf,Xf=Xf+16|0,i=t,n=0|kf[e+4>>2],r=(0|kf[n+56>>2])-(0|kf[n+52>>2])>>2,If[i>>0]=0,pi(e+20|0,r,i),Xf=t}function sh(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1536,(t=0|kf[e+32>>2])?(i=e+36|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function ah(e,t){e=0|e,t=0|t;var i=0;return((0!=(0|t)?0==(0|kf[t+56>>2]):0)?3==(0|If[t+24>>0]):0)?(kf[e+60>>2]=t,i=1):i=0,0|i}function oh(e){e=0|e;var t=0;switch(0|e){case 11:case 2:case 1:t=1;break;case 4:case 3:t=2;break;case 6:case 5:t=4;break;case 8:case 7:t=8;break;case 9:t=4;break;case 10:t=8;break;default:t=-1}return 0|t}function hh(e){e=0|e;var t=0,i=0,n=0;If[e+36>>0]=0,t=0|tc(0|kf[e+32>>2],0,7,0),i=0|rc(0|t,0|qf,3),t=e+16|0,e=t,n=0|tc(0|i,0|qf,0|kf[e>>2],0|kf[e+4>>2]),e=t,kf[e>>2]=n,kf[e+4>>2]=qf}function lh(e){e=0|e;var t=0,i=0,n=0,r=0;t=Xf,Xf=Xf+16|0,i=t,n=0|kf[e+4>>2],r=(0|kf[n+28>>2])-(0|kf[n+24>>2])>>2,If[i>>0]=0,pi(e+20|0,r,i),Xf=t}function ch(e){e=0|e;var t=0,i=0,n=0;t=e+60|0,i=e,n=i+60|0;do kf[i>>2]=0,i=i+4|0;while((0|i)<(0|n));kf[t>>2]=e,t=e+64|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0}function dh(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;return n=(0|kf[e+96>>2])+(12*t|0)|0,bt(i,n,n+12|0),1}function uh(){var e=0,t=0;return e=0|sl(40),kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,Gf[e+16>>2]=ap(1),t=e+20|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,Gf[e+36>>2]=ap(1),0|e}function fh(e){e=0|e,kf[e>>2]=3172,cs(e+8|0),mf(e)}function ph(e,t){e=0|e,t=0|t;var i=0,n=0;return(0|e)!=(0|t)&&(i=0|If[t+11>>0],n=i<<24>>24<0,0|Ps(e,n?0|kf[t>>2]:t,n?0|kf[t+4>>2]:255&i)),0|e}function _h(e,t){e=0|e,t=0|t;var i=0,n=0,r=0,s=0;return i=65535&e,n=65535&t,r=0|np(n,i),s=e>>>16,e=(r>>>16)+(0|np(n,s))|0,n=t>>>16,t=0|np(n,i),0|(qf=(e>>>16)+(0|np(n,s))+(((65535&e)+t|0)>>>16)|0,e+t<<16|65535&r|0)}function mh(e,t){e=0|e,t=0|t;var i=0,n=0,r=0;i=0|qs(t),n=0|sl(i+13|0),kf[n>>2]=i,kf[n+4>>2]=i,kf[n+8>>2]=0,r=0|fu(n),0|ui(0|r,0|t,i+1|0),kf[e>>2]=r}function Ah(e){e=0|e;var t=0,i=0;return kf[e>>2]=1476,t=e+20|0,i=0|kf[t>>2],kf[t>>2]=0,i?(xp[127&kf[(0|kf[i>>2])+4>>2]](i),void zs(e)):void zs(e)}function vh(e,t){e=0|e,t=0|t;var i=0,n=0;return(0|t)==-1|(0|t)>4?(i=-1,0|i):(n=0|kf[e+20+(12*t|0)>>2],((0|kf[e+20+(12*t|0)+4>>2])-n|0)<=0?(i=-1,0|i):(i=0|kf[n>>2],0|i))}function yh(e){e=0|e,kf[e>>2]=3172,cs(e+8|0)}function gh(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,kf[t+44>>2]=r,xn(e,t,i,n,r)}function bh(e){e=0|e;var t=0,i=0;kf[e>>2]=1536,t=0|kf[e+32>>2],t&&(i=e+36|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Eh(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n,0|Ud(e,0|kf[t+8>>2],0)&&Xa(0,t,i,n)}function Th(e){e=0|e;var t=0;kf[e>>2]=3440,t=e+4|0,kf[e+40>>2]=0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0,kf[t+24>>2]=0,kf[t+28>>2]=0,xf[t+32>>1]=0}function Sh(e,t,i){e=0|e,t=0|t,i=0|i;var n=0;if((0|t)<(0|e)&(0|e)<(t+i|0)){for(n=e,t=t+i|0,e=e+i|0;(0|i)>0;)e=e-1|0,t=t-1|0,i=i-1|0,If[e>>0]=0|If[t>>0];e=n}else 0|ui(e,t,i);return 0|e}function wh(e){e=0|e;var t=0,i=0,n=0;return kf[e>>2]=1228,(t=0|kf[e+8>>2])?(i=e+12|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t),void mf(e)):void mf(e)}function Ch(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;return n=Xf,Xf=Xf+16|0,r=n,kf[r>>2]=kf[i>>2],s=0|Pp[31&kf[(0|kf[e>>2])+16>>2]](e,t,r),s&&(kf[i>>2]=kf[r>>2]),Xf=n,1&s|0}function Mh(e,t){e=0|e,t=0|t;var i=0;return t>>>0>=2?(i=0,0|i):(kf[e+28>>2]=t,i=1,0|i)}function Ph(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0;if((0|t)>0){n=0;do r=0|kf[e+(n<<2)>>2],kf[i+(n<<2)>>2]=r<<31>>31^r>>>1,n=n+1|0;while((0|n)!=(0|t))}}function Ih(e){e=0|e;var t=0;return t=0|If[Kf+(255&e)>>0],(0|t)<8?0|t:(t=0|If[Kf+(e>>8&255)>>0],(0|t)<8?t+8|0:(t=0|If[Kf+(e>>16&255)>>0],(0|t)<8?t+16|0:(0|If[Kf+(e>>>24)>>0])+24|0))}function Rh(e){e=0|e;var t=0,i=0,n=0;e&&(t=0|kf[e>>2],0|t&&(i=e+4|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-4-t|0)>>>2)<<2)),mf(t)),mf(e))}function xh(e){e=0|e;var t=0,i=0,n=0;e&&(t=0|kf[e>>2],0|t&&(i=e+4|0,n=0|kf[i>>2],(0|n)!=(0|t)&&(kf[i>>2]=n+(~((n+-2-t|0)>>>1)<<1)),mf(t)),mf(e))}function Oh(e,t){e=0|e,t=0|t;var i=0;return If[t+84>>0]=1,e=0|kf[t+68>>2],i=t+72|0,t=0|kf[i>>2],(0|t)==(0|e)?1:(kf[i>>2]=t+(~((t+-4-e|0)>>>2)<<2),1)}function kh(e){e=0|e;var t=0,i=0;(0|Xu(e)?(t=0|yu(0|kf[e>>2]),e=t+8|0,i=0|kf[e>>2],kf[e>>2]=i+-1,(i+-1|0)<0):0)&&mf(t)}function Dh(e){e=0|e;var t=0;kf[e>>2]=0,t=e+8|0,xf[e+38>>1]=0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0,kf[t+24>>2]=0,If[t+28>>0]=0}function Lh(e){e=0|e;var t=0,i=0;kf[e>>2]=1228,t=0|kf[e+8>>2],t&&(i=e+12|0,e=0|kf[i>>2],(0|e)!=(0|t)&&(kf[i>>2]=e+(~((e+-4-t|0)>>>2)<<2)),mf(t))}function Nh(e,t,i){e=0|e,t=0|t,i=0|i,Qi(e,t,i)}function Fh(e){e=0|e,Dh(e),Dh(e+40|0),rd(e+80|0),Dh(e+96|0),kf[e+136>>2]=0,kf[e+140>>2]=0,kf[e+144>>2]=0}function Bh(e,t,i){return e=0|e,t=0|t,i=0|i,0|D(e,t,5,6,i)}function Vh(e,t,i){return e=0|e,t=0|t,i=0|i,0|O(e,t,3,4,i)}function Uh(e){e=0|e;var t=0;kf[e>>2]=1256,t=e+4|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0,kf[t+24>>2]=0,kf[t+28>>2]=0}function Gh(e,t,i){return e=0|e,t=0|t,i=0|i,0|F(e,t,1,2,i)}function Wh(e,t,i){return e=0|e,t=0|t,i=0|i,0|k(e,t,3,4,i)}function zh(e,t,i){return e=0|e,t=0|t,i=0|i,0|L(e,t,5,6,i)}function Hh(e,t,i){e=0|e,t=0|t,i=0|i;var n=0,r=0,s=0;return n=e+20|0,r=0|kf[n>>2],s=(0|kf[e+16>>2])-r|0,e=s>>>0>i>>>0?i:s,0|ui(0|r,0|t,0|e),kf[n>>2]=(0|kf[n>>2])+e,0|i}function jh(e,t,i){return e=0|e,t=0|t,i=0|i,0|B(e,t,1,2,i)}function Yh(e){e=0|e;var t=0;return kf[e>>2]=3148,t=0|kf[e+20>>2],0|t&&mf(t),(t=0|kf[e+8>>2])?(mf(t),void mf(e)):void mf(e)}function Xh(){var e=0,t=0;return e=0|sl(24),kf[e>>2]=1228,kf[e+4>>2]=-1,t=e+8|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,0|e}function Zh(e){e=0|e;var t=0;Qo(e),t=e+64|0,kf[e+88>>2]=0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,If[t+20>>0]=0}function Kh(e){e=0|e;var t=0,i=0;e&&(t=0|kf[e+8>>2],0|t&&(i=e+12|0,(0|kf[i>>2])!=(0|t)&&(kf[i>>2]=t),mf(t)),mf(e))}function Qh(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n,((0|kf[t+4>>2])==(0|i)?(i=t+28|0,1!=(0|kf[i>>2])):0)&&(kf[i>>2]=n)}function Jh(e){e=0|e;var t=0;return kf[e>>2]=3196,t=0|kf[e+20>>2],0|t&&mf(t),(t=0|kf[e+8>>2])?(mf(t),void mf(e)):void mf(e)}function qh(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n,kf[e>>2]=t,t=e+8|0,kf[t>>2]=i,kf[t+4>>2]=0,xf[e+38>>1]=n,n=e+16|0,kf[n>>2]=0,kf[n+4>>2]=0}function $h(e,t,i){e=0|e,t=ap(t),i=0|i;var n=0,r=wp;return(0|i)<1?(n=0,0|n):(r=ap(ap(1)/ap(0|i)),Gf[e+4>>2]=r,Gf[e>>2]=t,n=1,0|n)}function el(e,t,i){return e=0|e,t=0|t,i=0|i,kf[e+4>>2]=t,kf[e+8>>2]=kf[(0|kf[(0|kf[t+4>>2])+8>>2])+(i<<2)>>2],kf[e+12>>2]=i,1}function tl(e){e=0|e;var t=0,i=0;e&&(t=0|kf[e>>2],0|t&&(i=e+4|0,(0|kf[i>>2])!=(0|t)&&(kf[i>>2]=t),mf(t)),mf(e))}function il(e){e=0|e;var t=0;Xd(e),kf[e+16>>2]=0,kf[e+20>>2]=0,kf[e+12>>2]=e+16,t=e+24|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0}function nl(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0;return r=Xf,Xf=Xf+16|0,s=0|r,0|o(e,t,i,n,s),Xf=r,0|(qf=0|kf[s+4>>2],0|kf[s>>2])}function rl(e){e=0|e;var t=0;hc(e),kf[e>>2]=3580,t=e+84|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0,kf[t+16>>2]=0,kf[t+20>>2]=0}function sl(e){e=0|e;var t=0,i=0;for(t=0==(0|e)?1:e;;){if(e=0|Dn(t),0|e){i=e;break}if(e=0|bu(),!e){i=0;break}Rp[3&e]()}return 0|i}function al(e){e=0|e,kf[e>>2]=2548,bf(e+88|0),mf(e)}function ol(e){e=0|e;var t=0;kf[e>>2]=3148,t=0|kf[e+20>>2],0|t&&mf(t),t=0|kf[e+8>>2],t&&mf(t)}function hl(e){e=0|e,kf[e>>2]=2632,bf(e+88|0),mf(e)}function ll(e){e=0|e,kf[e>>2]=2716,bf(e+88|0),mf(e)}function cl(e){e=0|e;var t=0,i=0,n=0;return t=Xf,Xf=Xf+16|0,i=t,n=0|yf(0|kf[e+60>>2]),kf[i>>2]=n,n=0|gc(0|vp(6,0|i)),Xf=t,0|n}function dl(e){e=0|e,kf[e>>2]=2548,bf(e+88|0)}function ul(){var e=0,t=0;return e=Xf,Xf=Xf+16|0,0|Tp(17024,3)?(Nl(16164,e),0):(t=0|bp(0|kf[4257]),Xf=e,0|t)}function fl(e){e=0|e;var t=0;kf[e>>2]=3196,t=0|kf[e+20>>2],0|t&&mf(t),t=0|kf[e+8>>2],t&&mf(t)}function pl(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0;return r=e,e=i,i=0|_h(r,e),s=qf,0|(qf=(0|np(t,e))+(0|np(n,r))+s|0&s,0|i|0)}function _l(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Bh(t,i,n)}function ml(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Vh(t,i,n)}function Al(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Le(t,i,n)}function vl(e){e=0|e,kf[e>>2]=2800,bf(e+88|0),mf(e)}function yl(e){e=0|e;var t=0;return t=Xf,Xf=Xf+16|0,on(e),0|Sp(0|kf[4257],0)?void Nl(16263,t):void(Xf=t)}function gl(e){e=0|e,kf[e>>2]=2632,bf(e+88|0)}function bl(e){e=0|e,kf[e>>2]=2716,bf(e+88|0)}function El(e){e=0|e;var t=0;Uh(e),kf[e>>2]=1312,t=e+36|0,e=t+36|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|e))}function Tl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Gh(t,i,n)}function Sl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Wh(t,i,n)}function wl(e){e=0|e;var t=0;kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,t=e+16|0,kf[t>>2]=0,kf[t+4>>2]=0,kf[t+8>>2]=0,kf[t+12>>2]=0}function Cl(e){e=0|e,zc(e),kf[e>>2]=2884,kf[e+24>>2]=-1,kf[e+28>>2]=0,Gf[e+32>>2]=ap(0)}function Ml(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|jh(t,i,n)}function Pl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|zh(t,i,n)}function Il(e,t,i){e=0|e,t=0|t,i=0|i,kf[e>>2]=t,t=e+8|0,kf[t>>2]=i,kf[t+4>>2]=0,t=e+16|0,kf[t>>2]=0,kf[t+4>>2]=0}function Rl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|(((0|kf[e+12>>2])+-1|0)==(0|n)?0:n+1|0)}function xl(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0,s=0;return r=Xf,Xf=Xf+16|0,s=r,kf[s>>2]=n,n=0|ps(e,t,i,s),Xf=r,0|n}function Ol(e){e=0|e,kf[e>>2]=2800,bf(e+88|0)}function kl(e,t,i){return e=0|e,t=0|t,i=0|i,1}function Dl(e,t,i){return e=0|e,t=0|t,i=0|i,0|el(e,t,i)}function Ll(e,t,i,n,r,s,a){return e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a,0|Ip[31&e](0|t,0|i,0|n,0|r,0|s,0|a)}function Nl(e,t){e=0|e,t=0|t;var i=0,n=0;i=Xf,Xf=Xf+16|0,n=i,kf[n>>2]=t,t=0|kf[906],0|or(t,e,n),0|la(10,t),yp()}function Fl(e,t){e=0|e,t=0|t;var i=0;return i=0|kf[e+48>>2],0|Mp[127&kf[(0|kf[i>>2])+16>>2]](i,t)}function Bl(e,t,i){return e=0|e,t=0|t,i=0|i,0|vh(t,i)}function Vl(e,t){e=0|e,t=0|t;var i=0;return i=0|kf[e+48>>2],0|Mp[127&kf[(0|kf[i>>2])+12>>2]](i,t)}function Ul(e){e=0|e,me(e),mf(e)}function Gl(e,t){e=0|e,t=0|t;var i=0;return i=0|kf[e+48>>2],0|Mp[127&kf[(0|kf[i>>2])+20>>2]](i,t)}function Wl(e){e=0|e;var t=0,i=0;return t=e+4|0,(0|If[t+11>>0])<0?(i=0|kf[t>>2],0|i):(i=t,0|i)}function zl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Ft(t,i,n)}function Hl(){var e=0;return e=Xf,Xf=Xf+16|0,0|Ep(17028,104)?void Nl(16213,e):void(Xf=e);
}function jl(e){e=0|e,Ae(e),mf(e)}function Yl(e,t,i,n,r,s,a){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,a=0|a,Np[3&e](0|t,0|i,0|n,0|r,0|s,0|a)}function Xl(e,t){e=0|e,t=0|t;var i=0,n=0;return i=Xf,Xf=Xf+16|0,n=i,kf[n>>2]=t,t=0|or(0|kf[999],e,n),Xf=i,0|t}function Zl(e){return e=0|e,0|kf[e+44>>2]?0|Cp[127&kf[(0|kf[e>>2])+48>>2]](e):0}function Kl(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Xs(t,i,n)}function Ql(e,t,i){return e=0|e,t=0|t,i=0|i,0|t&&0|Bs(0|e,255&(0|Wu(i))|0,0|t),0|e}function Jl(e){return e=0|e,4}function ql(e,t,i){return e=0|e,t=0|t,i=0|i,(0|i)<32?(qf=t<<i|(e&(1<<i)-1<<32-i)>>>32-i,e<<i):(qf=e<<i-32,0)}function $l(e){e=0|e;var t=0;e&&(t=e+4|0,(0|If[t+11>>0])<0&&mf(0|kf[t>>2]),mf(e))}function ec(){}function tc(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0;return r=e+i>>>0,0|(qf=t+n+(r>>>0<e>>>0|0)>>>0,0|r)}function ic(e,t){e=0|e,t=0|t;var i=0;return i=t?0|cr(0|kf[t>>2],0|kf[t+4>>2],e):0,0|(0|i?i:e)}function nc(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n;var r=0;return r=t-n>>>0,r=t-n-(i>>>0>e>>>0|0)>>>0,0|(qf=r,e-i>>>0|0)}function rc(e,t,i){return e=0|e,t=0|t,i=0|i,(0|i)<32?(qf=t>>>i,e>>>i|(t&(1<<i)-1)<<32-i):(qf=0,t>>>i-32|0)}function sc(e,t,i){return e=0|e,t=0|t,i=0|i,0|qa(e,t,i)}function ac(e){e=0|e,q(e),mf(e)}function oc(e){return e=0|e,5}function hc(e){e=0|e;var t=0;kf[e>>2]=3608,t=e+4|0,e=t+80|0;do kf[t>>2]=0,t=t+4|0;while((0|t)<(0|e))}function lc(e){return e=0|e,6}function cc(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|dh(t,i,n)}function dc(e,t,i){return e=0|e,t=0|t,i=0|i,kf[e+28>>2]=t,kf[e+32>>2]=i,1}function uc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Bl(e,t,i)}function fc(e){e=0|e;var t=0;return t=0|kf[e+48>>2],0|Cp[127&kf[(0|kf[t>>2])+28>>2]](t)}function pc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Rt(t,i)}function _c(e){e=0|e,kf[e>>2]=1368,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=-1,kf[e+16>>2]=0}function mc(e){e=0|e;var t=0;return t=0|kf[e+48>>2],0|Cp[127&kf[(0|kf[t>>2])+24>>2]](t)}function Ac(e,t){e=0|e,t=0|t,sa(e,t)}function vc(e){e=0|e;var t=0;return t=0|kf[e+48>>2],0|Cp[127&kf[(0|kf[t>>2])+36>>2]](t)}function yc(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,Lp[3&e](0|t,0|i,0|n,0|r,0|s)}function gc(e){e=0|e;var t=0,i=0;return e>>>0>4294963200?(t=0|nf(),kf[t>>2]=0-e,i=-1):i=e,0|i}function bc(e,t,i){return e=0|e,t=0|t,i=0|i,0|to(e,t,i)}function Ec(e,t,i){return e=0|e,t=0|t,i=0|i,0|ns(e,t,i)}function Tc(e,t,i){return e=0|e,t=0|t,i=0|i,0|ys(e,t,i)}function Sc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Dr(e,t,i)}function wc(e,t,i){return e=0|e,t=0|t,i=0|i,+ +fs(e,t,i)}function Cc(e,t){return e=0|e,t=0|t,0|Mp[127&kf[(0|kf[e>>2])+12>>2]](e,t)}function Mc(e,t){return e=0|e,t=0|t,0|Mp[127&kf[(0|kf[e>>2])+56>>2]](e,t)}function Pc(e){e=0|e,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0,kf[e+16>>2]=0}function Ic(e,t,i){return e=0|e,t=0|t,i=0|i,0|wa(e,t,i)}function Rc(e,t){return e=0|e,t=0|t,kf[e+4>>2]=t,1}function xc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Qc(t,i)}function Oc(e,t,i){return e=0|e,t=0|t,i=0|i,0|gs(e,t,i)}function kc(e,t,i){return e=0|e,t=0|t,i=0|i,0|ms(e,t,i)}function Dc(e){e=0|e,zc(e),kf[e>>2]=2376,kf[e+24>>2]=-1}function Lc(e,t){return e=0|e,t=0|t,kf[e+8>>2]=t,kf[e+12>>2]=-1,1}function Nc(e,t,i){return e=0|e,t=0|t,i=0|i,0|gi(e,t,i)}function Fc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Ar(t,i)}function Bc(e){e=+e;var t=0;return zf[Yf>>3]=e,t=0|kf[Yf>>2],qf=0|kf[Yf+4>>2],0|t}function Vc(e){e=0|e,kf[e+12>>2]=0,kf[e+16>>2]=0,kf[e>>2]=0,Gf[e+4>>2]=ap(0)}function Uc(){var e=0;return e=0|sl(40),kf[e>>2]=-1,wl(e+8|0),0|e}function Gc(){var e=0;return e=0|sl(8),kf[e>>2]=1200,kf[e+4>>2]=-1,0|e}function Wc(e,t,i){return e=0|e,t=0|t,i=0|i,0|Jr(e,t,i)}function zc(e){e=0|e,_c(e),kf[e>>2]=1476,kf[e+20>>2]=0}function Hc(e,t){e=0|e,t=0|t,Ac(e,t)}function jc(e){e=0|e;var t=0;return t=e?0!=(0|dr(e,1072,1160,0)):0,1&t|0}function Yc(e,t){return e=0|e,t=0|t,ap(Gf[(0|kf[e+8>>2])+(t<<2)>>2])}function Xc(e,t){return e=0|e,t=0|t,0|qo(e,t)}function Zc(e){e=0|e,(0|If[e+11>>0])<0&&mf(0|kf[e>>2])}function Kc(e){e=0|e,e&&xp[127&kf[(0|kf[e>>2])+4>>2]](e)}function Qc(e,t){return e=0|e,t=0|t,0|lo(e,t)}function Jc(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,Dp[7&e](0|t,0|i,0|n,0|r)}function qc(e,t,i){return e=0|e,t=0|t,i=0|i,0|i&&0|Sh(0|e,0|t,0|i),0|e}function $c(e,t,i){return e=0|e,t=0|t,i=0|i,0|dd(t,i)}function ed(e,t,i){return e=0|e,t=0|t,i=0|i,0|i&&0|ui(0|e,0|t,0|i),0|e}function td(e,t){return e=0|e,t=0|t,-1}function id(e){return e=0|e,3}function nd(e,t){return e=0|e,t=0|t,0|eu(e,t)}function rd(e){e=0|e,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,If[e+12>>0]=0}function sd(e){e=0|e,Cr(e),mf(e)}function ad(e){e=0|e,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e+12>>2]=0}function od(e){e=0|e,vd(e),kf[e>>2]=3012,kf[e+48>>2]=0}function hd(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|Pp[31&e](0|t,0|i,0|n)}function ld(e,t,i){e=0|e,t=0|t,i=0|i,Il(e,t,i)}function cd(e,t){e=0|e,t=0|t,kf[e>>2]=4728,mh(e+4|0,t)}function dd(e,t){return e=0|e,t=0|t,0|kf[(0|kf[e+8>>2])+(t<<2)>>2]}function ud(e,t){e=0|e,t=0|t;var i=0;return i=e?0|ds(e,t,0):0,0|i}function fd(e){e=0|e,e&&(bf(e+24|0),mf(e))}function pd(e,t){return e=0|e,t=0|t,0|kf[(0|kf[e+4>>2])+(t<<2)>>2]}function _d(){var e=0;return e=0|sl(64),Qo(e),0|e}function md(e,t){return e=0|e,t=0|t,ap(Ed(e,t))}function Ad(e){return e=0|e,0|kf[e+8>>2]}function vd(e){e=0|e,Th(e),kf[e>>2]=2952,kf[e+44>>2]=0}function yd(e){e=0|e,e&&(vs(e),mf(e))}function gd(e,t){return e=0|e,t=0|t,0|hu(e,t)}function bd(e){return e=0|e,0|If[(0|kf[e+8>>2])+24>>0]}function Ed(e,t){return e=0|e,t=0|t,ap(Gf[(0|kf[e>>2])+(t<<2)>>2])}function Td(e,t,i){e=0|e,t=0|t,i=0|i,32&kf[e>>2]||0|Lr(t,i,e)}function Sd(e){return e=0|e,(0|kf[e+8>>2])-(0|kf[e+4>>2])>>2|0}function wd(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n,kp[15&e](0|t,0|i,0|n)}function Cd(){var e=0;return e=0|sl(96),Zh(e),0|e}function Md(e){e=0|e;var t=0;return t=Xf,Xf=Xf+e|0,Xf=Xf+15&-16,0|t}function Pd(e){return e=0|e,((0|kf[e+100>>2])-(0|kf[e+96>>2])|0)/12|0|0}function Id(e){e=0|e;var t=0;return t=(0|uf())+188|0,0|ya(e,0|kf[t>>2])}function Rd(){var e=0;return e=0|sl(16),ad(e),0|e}function xd(){var e=0;return e=0|sl(40),Dh(e),0|e}function Od(e,t){return e=0|e,t=0|t,1}function kd(e,t){return e=0|e,t=0|t,0|zd(e,t)}function Dd(e,t){return e=0|e,t=0|t,0|Hd(e,t)}function Ld(e,t,i,n,r,s){return e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,op(3),0}function Nd(e,t){return e=0|e,t=0|t,0|au(e,t)}function Fd(){var e=0;return e=0|sl(12),qd(e),0|e}function Bd(e){e=0|e,zs(e),mf(e)}function Vd(e){e=0|e,Gf[e>>2]=ap(1),Gf[e+4>>2]=ap(1)}function Ud(e,t,i){return e=0|e,t=0|t,i=0|i,(0|e)==(0|t)|0}function Gd(e,t){e=0|e,t=0|t;var i=0;return i=0|nu(0|e),0|(0==(0|t)?e:i)}function Wd(e){return e=0|e,(0|kf[e+12>>2])-(0|kf[e+8>>2])>>2|0}function zd(e,t){return e=0|e,t=0|t,0|kf[(0|kf[e>>2])+(t<<2)>>2]}function Hd(e,t){return e=0|e,t=0|t,0|xf[(0|kf[e>>2])+(t<<1)>>1]}function jd(e,t){e=0|e,t=0|t,kf[e+4>>2]=t}function Yd(e,t,i,n){return e=0|e,t=0|t,i=0|i,n=0|n,0|o(e,t,i,n,0)}function Xd(e){e=0|e,kf[e+4>>2]=0,kf[e+8>>2]=0,kf[e>>2]=e+4}function Zd(){var e=0;return e=0|sl(84),hc(e),0|e}function Kd(e){e=0|e,zr(e),mf(e)}function Qd(e){return e=0|e,(0|kf[e+4>>2])-(0|kf[e>>2])>>2|0}function Jd(e){return e=0|e,(0|kf[e+4>>2])-(0|kf[e>>2])>>1|0}function qd(e){e=0|e,kf[e>>2]=0,kf[e+4>>2]=0,kf[e+8>>2]=0}function $d(e){e=0|e,kf[e>>2]=4728,kh(e+4|0)}function eu(e,t){return e=0|e,t=0|t,0|kf[t+12>>2]}function tu(e,t,i){return e=0|e,t=0|t,i=0|i,0|Mp[127&e](0|t,0|i)}function iu(e,t,i,n,r,s){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,s=0|s,op(10)}function nu(e){return e=0|e,(255&e)<<24|(e>>8&255)<<16|(e>>16&255)<<8|e>>>24|0}function ru(e){e=0|e,vd(e),kf[e>>2]=3356}function su(e,t){e=0|e,t=0|t,If[e>>0]=0|If[t>>0]}function au(e,t){return e=0|e,t=0|t,0|If[(0|kf[e>>2])+t>>0]}function ou(e){return e=0|e,(0|kf[e+4>>2])-(0|kf[e>>2])|0}function hu(e,t){return e=0|e,t=0|t,0|kf[t+4>>2]}function lu(e){return e=0|e,ap(Gf[e+20>>2])}function cu(e){return e=0|e,0|kf[e+4>>2]}function du(e){e=0|e,e&&mf(e)}function uu(e,t){e=0|e,t=0|t,Qf||(Qf=e,Jf=t)}function fu(e){return e=0|e,e+12|0}function pu(e){return e=0|e,0|kf[e+88>>2]}function _u(e,t,i){e=0|e,t=0|t,i=0|i,Op[7&e](0|t,0|i)}function mu(){var e=0;return e=0|sl(40),il(e),0|e}function Au(){var e=0;return e=0|sl(108),rl(e),0|e}function vu(e){return e=0|e,0!=(0|If[e+32>>0])|0}function yu(e){return e=0|e,e+-12|0}function gu(e,t,i,n,r){e=0|e,t=0|t,i=0|i,n=0|n,r=0|r,op(9)}function bu(){var e=0;return e=0|kf[4258],kf[4258]=e+0,0|e}function Eu(e){return e=0|e,0|ju(e+4|0)}function Tu(e){return e=0|e,0|kf[e+56>>2]}function Su(e){e=0|e,Zt(e),mf(e)}function wu(e){e=0|e,bf(e),mf(e)}function Cu(e){return e=0|e,0|If[e+24>>0]}function Mu(e,t){return e=0|e,t=0|t,0}function Pu(e){return e=0|e,0|kf[e+40>>2]}function Iu(e){return e=0|e,0|kf[e+48>>2]}function Ru(e,t){return e=0|e,t=0|t,0|Cp[127&e](0|t)}function xu(e){return e=0|e,0|kf[e+60>>2]}function Ou(e){return e=0|e,0|kf[e+28>>2]}function ku(e){e=0|e,$d(e),mf(e)}function Du(e){e=0|e,yp()}function Lu(e,t){e=0|e,t=0|t,Xf=e,Zf=t}function Nu(e){return e=0|e,1&(32==(0|e)|(e+-9|0)>>>0<5)|0}function Fu(e){return e=0|e,0==(0|kf[e>>2])|0}function Bu(e){return e=0|e,0|kf[e+80>>2]}function Vu(e,t,i,n){e=0|e,t=0|t,i=0|i,n=0|n,op(8)}function Uu(e,t){e=0|e,t=0|t,xp[127&e](0|t)}function Gu(e,t){return e=0|e,t=0|t,0|ic(e,t)}function Wu(e){return e=0|e,255&e|0}function zu(e){e=0|e,kf[e>>2]=0}function Hu(e,t,i){return e=0|e,t=0|t,i=0|i,op(2),0}function ju(e){return e=0|e,0|kf[e>>2]}function Yu(e){return e=0|e,2}function Xu(e){return e=0|e,1}function Zu(e,t){return e=+e,t=0|t,+ +ga(e,t)}function Ku(){return 3}function Qu(e,t,i){e=0|e,t=0|t,i=0|i,op(7)}function Ju(){return-4}function qu(){return 4}function $u(){return-3}function ef(){return 1}function tf(){return 2}function nf(){return(0|uf())+64|0}function rf(){return-5}function sf(e,t){return e=0|e,t=0|t,op(1),0}function af(e){e=0|e,Rp[3&e]()}function of(){return-2}function hf(){up()}function lf(){return-1}function cf(e,t){e=0|e,t=0|t,op(6)}function df(){return 0}function uf(){return 0|Cf()}function ff(e){return e=0|e,0|sl(e)}function pf(e){e=0|e,mf(e)}function _f(e){e=0|e,Xf=e}function mf(e){e=0|e,on(e)}function Af(e){e=0|e,qf=e}function vf(){return 16960}function yf(e){return e=0|e,0|e}function gf(e){return e=0|e,op(0),0}function bf(e){e=0|e}function Ef(e){return e=0|e,0}function Tf(){return 0|qf}function Sf(){return 0|Xf}function wf(e){e=0|e,op(5)}function Cf(){return 3752}function Mf(){op(4)}var Pf=e.Int8Array,If=new Pf(i),Rf=e.Int16Array,xf=new Rf(i),Of=e.Int32Array,kf=new Of(i),Df=e.Uint8Array,Lf=new Df(i),Nf=e.Uint16Array,Ff=new Nf(i),Bf=e.Uint32Array,Vf=new Bf(i),Uf=e.Float32Array,Gf=new Uf(i),Wf=e.Float64Array,zf=new Wf(i),Hf=e.byteLength,jf=0|t.DYNAMICTOP_PTR,Yf=0|t.tempDoublePtr,Xf=(0|t.ABORT,0|t.STACKTOP),Zf=0|t.STACK_MAX,Kf=0|t.cttz_i8,Qf=0,Jf=0,qf=(e.NaN,e.Infinity,0),$f=e.Math.floor,ep=e.Math.abs,tp=e.Math.sqrt,ip=(e.Math.pow,e.Math.cos,e.Math.sin,e.Math.tan,e.Math.acos,e.Math.asin,e.Math.atan,e.Math.atan2,e.Math.exp,e.Math.log,e.Math.ceil),np=e.Math.imul,rp=e.Math.min,sp=(e.Math.max,e.Math.clz32),ap=e.Math.fround,op=t.abort,hp=(t.assert,t.enlargeMemory),lp=t.getTotalMemory,cp=t.abortOnCannotGrowMemory,dp=(t.invoke_ii,t.invoke_iii,t.invoke_iiii,t.invoke_iiiiiii,t.invoke_v,t.invoke_vi,t.invoke_vii,t.invoke_viii,t.invoke_viiii,t.invoke_viiiii,t.invoke_viiiiii,t.__ZSt18uncaught_exceptionv,t.___cxa_allocate_exception),up=(t.___cxa_begin_catch,t.___cxa_find_matching_catch,t.___cxa_pure_virtual),fp=t.___cxa_throw,pp=(t.___gxx_personality_v0,t.___resumeException,t.___setErrNo),_p=t.___syscall140,mp=t.___syscall146,Ap=t.___syscall54,vp=t.___syscall6,yp=t._abort,gp=t._emscripten_memcpy_big,bp=t._pthread_getspecific,Ep=t._pthread_key_create,Tp=t._pthread_once,Sp=t._pthread_setspecific;ap(0);const wp=ap(0);var Cp=[gf,Yu,Xu,Sd,Ou,Xu,en,$,bd,cu,Ef,Ef,Xu,Ef,Xu,Xu,Uo,Yu,Uo,Jl,Uo,id,Bo,Xu,oc,Bo,Xu,lc,Na,Xu,Ou,Xu,Uo,Yu,Uo,Jl,Uo,id,Bo,Xu,oc,Bo,Xu,lc,Na,Xu,Ou,Yu,Ef,cu,Xu,Ef,Xu,Yu,Ef,cu,Xu,Ef,Xu,id,lc,Oa,Xu,Ou,lc,Oa,Xu,Ou,lc,Oa,Xu,Ou,lc,Oa,Xu,Ou,pt,Xu,Xu,Zl,J,no,Xu,Ef,Nt,fc,vc,mc,Gn,Xu,cu,Ad,Ct,De,It,Vn,Xu,cu,Ad,Un,Xu,cu,Ad,Li,ss,Ef,Xu,ua,ba,cl,Eu,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf,gf],Mp=[sf,Vo,fi,fn,jo,pd,Mu,Od,$i,tr,Lc,Od,Fr,ye,kr,ko,Pa,Ca,Ro,Us,td,Mu,mi,V,Mu,ah,G,Mu,ah,he,Mu,$o,vt,Mh,V,Mu,ah,G,Mu,ah,he,Mu,$o,vt,Mh,ur,td,Mu,Pr,td,Mu,Ur,Mu,Jo,zt,Mh,Mu,Jo,zt,Mh,Mu,Jo,Pt,Mh,Mu,Jo,Pt,Mh,Mc,ut,Mu,Mu,Gl,Vl,Fl,Rc,Vr,Wr,sn,at,Ge,Ue,Rc,Vr,Wr,sn,Rc,Vr,Wr,sn,Ht,Oh,xr,Ht,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf,sf],Pp=[Hu,dc,el,ro,kl,Br,Dl,nt,Pn,Zo,jr,Ts,eh,es,ja,Qt,xo,Wo,Hh,Zs,Hu,Hu,Hu,Hu,Hu,Hu,Hu,Hu,Hu,Hu,Hu,Hu],Ip=[Ld,u,ln,nn,xi,C,x,yn,cn,rn,Ri,S,R,vn,hi,ri,Tn,wn,Cn,Mn,Ld,Ld,Ld,Ld,Ld,Ld,Ld,Ld,Ld,Ld,Ld,Ld],Rp=[Mf,hf,os,Hl],xp=[wf,bf,pf,Lh,wh,go,co,zr,Kd,zs,Bd,Cr,sd,Ah,nh,bh,sh,sh,sh,sh,Ta,va,Za,Va,vo,ao,Io,yo,bf,pf,sh,sh,Ea,_a,za,La,po,io,Mo,_o,bf,pf,nh,bf,pf,pf,dl,al,bf,pf,gl,hl,bf,pf,bl,ll,bf,pf,Ol,vl,bf,pf,Eo,mo,oa,$s,Os,Is,q,ac,Ba,xa,ol,Yh,rh,yh,fh,fl,Jh,lh,Wa,Da,me,Ul,Ae,jl,$s,bf,pf,$s,$s,$s,$a,Ha,Zt,Su,bf,wu,bf,bf,wu,$d,ku,ku,yl,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf,wf],Op=[cf,ka,wt,Ga,pn,cf,cf,cf],kp=[Qu,Ma,Ki,Ji,Ji,Ki,Ji,Ki,si,Xt,Qu,Qu,Qu,Qu,Qu,Qu],Dp=[Vu,ws,I,Eh,To,Vu,Vu,Vu],Lp=[gu,Ns,di,gu],Np=[iu,ih,oo,iu];return{___cxa_can_catch:Ch,___cxa_is_pointer_type:jc,___divdi3:Ya,___muldi3:pl,___udivdi3:Yd,___uremdi3:nl,_bitshift64Lshr:rc,_bitshift64Shl:ql,_emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0:Gc,_emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1:Cc,_emscripten_bind_AttributeOctahedronTransform___destroy___0:Kc,_emscripten_bind_AttributeOctahedronTransform_quantization_bits_0:cu,_emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0:Xh,_emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1:Cc,_emscripten_bind_AttributeQuantizationTransform___destroy___0:Kc,_emscripten_bind_AttributeQuantizationTransform_min_value_1:Yc,_emscripten_bind_AttributeQuantizationTransform_quantization_bits_0:cu,_emscripten_bind_AttributeQuantizationTransform_range_0:lu,_emscripten_bind_AttributeTransformData_AttributeTransformData_0:Uc,_emscripten_bind_AttributeTransformData___destroy___0:Kh,_emscripten_bind_AttributeTransformData_transform_type_0:ju,_emscripten_bind_DecoderBuffer_DecoderBuffer_0:xd,_emscripten_bind_DecoderBuffer_Init_2:ld,_emscripten_bind_DecoderBuffer___destroy___0:fd,_emscripten_bind_Decoder_DecodeBufferToMesh_2:bc,_emscripten_bind_Decoder_DecodeBufferToPointCloud_2:sc,_emscripten_bind_Decoder_Decoder_0:mu,_emscripten_bind_Decoder_GetAttributeByUniqueId_2:xc,_emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3:Al,_emscripten_bind_Decoder_GetAttributeFloat_3:Kl,_emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3:zl,_emscripten_bind_Decoder_GetAttributeIdByName_2:Fc,_emscripten_bind_Decoder_GetAttributeId_2:uc,_emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3:Sl,_emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3:Pl,_emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3:Ml,_emscripten_bind_Decoder_GetAttributeIntForAllPoints_3:Pl,_emscripten_bind_Decoder_GetAttributeMetadata_2:Ic,_emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3:ml,_emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3:_l,_emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3:Tl,_emscripten_bind_Decoder_GetAttribute_2:$c,_emscripten_bind_Decoder_GetEncodedGeometryType_1:Xc,_emscripten_bind_Decoder_GetFaceFromMesh_3:cc,_emscripten_bind_Decoder_GetMetadata_1:gd,_emscripten_bind_Decoder_GetTriangleStripsFromMesh_2:pc,_emscripten_bind_Decoder_SkipAttributeTransform_1:Hc,_emscripten_bind_Decoder___destroy___0:Fa,_emscripten_bind_DracoFloat32Array_DracoFloat32Array_0:Fd,_emscripten_bind_DracoFloat32Array_GetValue_1:md,_emscripten_bind_DracoFloat32Array___destroy___0:Rh,_emscripten_bind_DracoFloat32Array_size_0:Qd,_emscripten_bind_DracoInt16Array_DracoInt16Array_0:Fd,_emscripten_bind_DracoInt16Array_GetValue_1:Dd,_emscripten_bind_DracoInt16Array___destroy___0:xh,_emscripten_bind_DracoInt16Array_size_0:Jd,_emscripten_bind_DracoInt32Array_DracoInt32Array_0:Fd,_emscripten_bind_DracoInt32Array_GetValue_1:kd,_emscripten_bind_DracoInt32Array___destroy___0:Rh,_emscripten_bind_DracoInt32Array_size_0:Qd,_emscripten_bind_DracoInt8Array_DracoInt8Array_0:Fd,_emscripten_bind_DracoInt8Array_GetValue_1:Nd,_emscripten_bind_DracoInt8Array___destroy___0:tl,_emscripten_bind_DracoInt8Array_size_0:ou,_emscripten_bind_DracoUInt16Array_DracoUInt16Array_0:Fd,_emscripten_bind_DracoUInt16Array_GetValue_1:Dd,_emscripten_bind_DracoUInt16Array___destroy___0:xh,_emscripten_bind_DracoUInt16Array_size_0:Jd,_emscripten_bind_DracoUInt32Array_DracoUInt32Array_0:Fd,_emscripten_bind_DracoUInt32Array_GetValue_1:kd,_emscripten_bind_DracoUInt32Array___destroy___0:Rh,_emscripten_bind_DracoUInt32Array_size_0:Qd,_emscripten_bind_DracoUInt8Array_DracoUInt8Array_0:Fd,_emscripten_bind_DracoUInt8Array_GetValue_1:Nd,_emscripten_bind_DracoUInt8Array___destroy___0:tl,_emscripten_bind_DracoUInt8Array_size_0:ou,_emscripten_bind_GeometryAttribute_GeometryAttribute_0:_d,_emscripten_bind_GeometryAttribute___destroy___0:du,_emscripten_bind_Mesh_Mesh_0:Au,_emscripten_bind_Mesh___destroy___0:Kc,_emscripten_bind_Mesh_num_attributes_0:Wd,_emscripten_bind_Mesh_num_faces_0:Pd,_emscripten_bind_Mesh_num_points_0:Bu,_emscripten_bind_MetadataQuerier_GetDoubleEntry_2:wc,_emscripten_bind_MetadataQuerier_GetEntryName_2:Nc,_emscripten_bind_MetadataQuerier_GetIntEntry_2:kc,_emscripten_bind_MetadataQuerier_GetStringEntry_2:Sc,_emscripten_bind_MetadataQuerier_HasDoubleEntry_2:Tc,_emscripten_bind_MetadataQuerier_HasEntry_2:Wc,_emscripten_bind_MetadataQuerier_HasIntEntry_2:Oc,_emscripten_bind_MetadataQuerier_HasStringEntry_2:Ec,_emscripten_bind_MetadataQuerier_MetadataQuerier_0:Rd,_emscripten_bind_MetadataQuerier_NumEntries_1:nd,_emscripten_bind_MetadataQuerier___destroy___0:Ua,_emscripten_bind_Metadata_Metadata_0:uh,_emscripten_bind_Metadata___destroy___0:yd,_emscripten_bind_PointAttribute_GetAttributeTransformData_0:pu,_emscripten_bind_PointAttribute_PointAttribute_0:Cd,_emscripten_bind_PointAttribute___destroy___0:ta,_emscripten_bind_PointAttribute_attribute_type_0:Tu,_emscripten_bind_PointAttribute_byte_offset_0:Iu,_emscripten_bind_PointAttribute_byte_stride_0:Pu,_emscripten_bind_PointAttribute_data_type_0:Ou,_emscripten_bind_PointAttribute_normalized_0:vu,_emscripten_bind_PointAttribute_num_components_0:Cu,_emscripten_bind_PointAttribute_size_0:Bu,_emscripten_bind_PointAttribute_unique_id_0:xu,_emscripten_bind_PointCloud_PointCloud_0:Zd,_emscripten_bind_PointCloud___destroy___0:Kc,_emscripten_bind_PointCloud_num_attributes_0:Wd,_emscripten_bind_PointCloud_num_points_0:Bu,_emscripten_bind_Status___destroy___0:$l,_emscripten_bind_Status_code_0:ju,_emscripten_bind_Status_error_msg_0:Wl,_emscripten_bind_Status_ok_0:Fu,_emscripten_bind_VoidPtr___destroy___0:du,_emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM:lf,_emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM:df,_emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM:tf,_emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM:ef,_emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE:lf,_emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD:df,_emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH:ef,_emscripten_enum_draco_GeometryAttribute_Type_COLOR:tf,_emscripten_enum_draco_GeometryAttribute_Type_GENERIC:qu,_emscripten_enum_draco_GeometryAttribute_Type_INVALID:lf,_emscripten_enum_draco_GeometryAttribute_Type_NORMAL:ef,_emscripten_enum_draco_GeometryAttribute_Type_POSITION:df,_emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD:Ku,_emscripten_enum_draco_StatusCode_ERROR:lf,_emscripten_enum_draco_StatusCode_INVALID_PARAMETER:$u,_emscripten_enum_draco_StatusCode_IO_ERROR:of,_emscripten_enum_draco_StatusCode_OK:df,_emscripten_enum_draco_StatusCode_UNKNOWN_VERSION:rf,_emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION:Ju,_emscripten_get_global_libc:vf,_emscripten_replace_memory:n,_free:on,_i64Add:tc,_i64Subtract:nc,_llvm_bswap_i32:nu,_malloc:Dn,_memcpy:ui,_memmove:Sh,_memset:Bs,_sbrk:Yo,dynCall_ii:Ru,dynCall_iii:tu,dynCall_iiii:hd,dynCall_iiiiiii:Ll,dynCall_v:af,dynCall_vi:Uu,dynCall_vii:_u,dynCall_viii:wd,dynCall_viiii:Jc,dynCall_viiiii:yc,dynCall_viiiiii:Yl,establishStackSpace:Lu,getTempRet0:Tf,runPostSets:ec,setTempRet0:Af,setThrew:uu,stackAlloc:Md,stackRestore:_f,stackSave:Sf}}(Ze.asmGlobalArg,Ze.asmLibraryArg,ot),ci=(Ze.___cxa_can_catch=li.___cxa_can_catch,Ze.___cxa_is_pointer_type=li.___cxa_is_pointer_type,Ze.___divdi3=li.___divdi3,Ze.___muldi3=li.___muldi3,Ze.___udivdi3=li.___udivdi3,Ze.___uremdi3=li.___uremdi3,Ze._bitshift64Lshr=li._bitshift64Lshr,Ze._bitshift64Shl=li._bitshift64Shl,Ze._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=li._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0),di=Ze._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=li._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1,ui=Ze._emscripten_bind_AttributeOctahedronTransform___destroy___0=li._emscripten_bind_AttributeOctahedronTransform___destroy___0,fi=Ze._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=li._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0,pi=Ze._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=li._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0,_i=Ze._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=li._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1,mi=Ze._emscripten_bind_AttributeQuantizationTransform___destroy___0=li._emscripten_bind_AttributeQuantizationTransform___destroy___0,Ai=Ze._emscripten_bind_AttributeQuantizationTransform_min_value_1=li._emscripten_bind_AttributeQuantizationTransform_min_value_1,vi=Ze._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=li._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0,yi=Ze._emscripten_bind_AttributeQuantizationTransform_range_0=li._emscripten_bind_AttributeQuantizationTransform_range_0,gi=Ze._emscripten_bind_AttributeTransformData_AttributeTransformData_0=li._emscripten_bind_AttributeTransformData_AttributeTransformData_0,bi=Ze._emscripten_bind_AttributeTransformData___destroy___0=li._emscripten_bind_AttributeTransformData___destroy___0,Ei=Ze._emscripten_bind_AttributeTransformData_transform_type_0=li._emscripten_bind_AttributeTransformData_transform_type_0,Ti=Ze._emscripten_bind_DecoderBuffer_DecoderBuffer_0=li._emscripten_bind_DecoderBuffer_DecoderBuffer_0,Si=Ze._emscripten_bind_DecoderBuffer_Init_2=li._emscripten_bind_DecoderBuffer_Init_2,wi=Ze._emscripten_bind_DecoderBuffer___destroy___0=li._emscripten_bind_DecoderBuffer___destroy___0,Ci=Ze._emscripten_bind_Decoder_DecodeBufferToMesh_2=li._emscripten_bind_Decoder_DecodeBufferToMesh_2,Mi=Ze._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=li._emscripten_bind_Decoder_DecodeBufferToPointCloud_2,Pi=Ze._emscripten_bind_Decoder_Decoder_0=li._emscripten_bind_Decoder_Decoder_0,Ii=Ze._emscripten_bind_Decoder_GetAttributeByUniqueId_2=li._emscripten_bind_Decoder_GetAttributeByUniqueId_2,Ri=Ze._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3,xi=Ze._emscripten_bind_Decoder_GetAttributeFloat_3=li._emscripten_bind_Decoder_GetAttributeFloat_3,Oi=Ze._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=li._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3,ki=Ze._emscripten_bind_Decoder_GetAttributeIdByName_2=li._emscripten_bind_Decoder_GetAttributeIdByName_2,Di=Ze._emscripten_bind_Decoder_GetAttributeId_2=li._emscripten_bind_Decoder_GetAttributeId_2,Li=Ze._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3,Ni=Ze._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3,Fi=Ze._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3,Bi=Ze._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3,Vi=Ze._emscripten_bind_Decoder_GetAttributeMetadata_2=li._emscripten_bind_Decoder_GetAttributeMetadata_2,Ui=Ze._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3,Gi=Ze._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3,Wi=Ze._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=li._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3,zi=Ze._emscripten_bind_Decoder_GetAttribute_2=li._emscripten_bind_Decoder_GetAttribute_2,Hi=Ze._emscripten_bind_Decoder_GetEncodedGeometryType_1=li._emscripten_bind_Decoder_GetEncodedGeometryType_1,ji=Ze._emscripten_bind_Decoder_GetFaceFromMesh_3=li._emscripten_bind_Decoder_GetFaceFromMesh_3,Yi=Ze._emscripten_bind_Decoder_GetMetadata_1=li._emscripten_bind_Decoder_GetMetadata_1,Xi=Ze._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=li._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2,Zi=Ze._emscripten_bind_Decoder_SkipAttributeTransform_1=li._emscripten_bind_Decoder_SkipAttributeTransform_1,Ki=Ze._emscripten_bind_Decoder___destroy___0=li._emscripten_bind_Decoder___destroy___0,Qi=Ze._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=li._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0,Ji=Ze._emscripten_bind_DracoFloat32Array_GetValue_1=li._emscripten_bind_DracoFloat32Array_GetValue_1,qi=Ze._emscripten_bind_DracoFloat32Array___destroy___0=li._emscripten_bind_DracoFloat32Array___destroy___0,$i=Ze._emscripten_bind_DracoFloat32Array_size_0=li._emscripten_bind_DracoFloat32Array_size_0,en=Ze._emscripten_bind_DracoInt16Array_DracoInt16Array_0=li._emscripten_bind_DracoInt16Array_DracoInt16Array_0,tn=Ze._emscripten_bind_DracoInt16Array_GetValue_1=li._emscripten_bind_DracoInt16Array_GetValue_1,nn=Ze._emscripten_bind_DracoInt16Array___destroy___0=li._emscripten_bind_DracoInt16Array___destroy___0,rn=Ze._emscripten_bind_DracoInt16Array_size_0=li._emscripten_bind_DracoInt16Array_size_0,sn=Ze._emscripten_bind_DracoInt32Array_DracoInt32Array_0=li._emscripten_bind_DracoInt32Array_DracoInt32Array_0,an=Ze._emscripten_bind_DracoInt32Array_GetValue_1=li._emscripten_bind_DracoInt32Array_GetValue_1,on=Ze._emscripten_bind_DracoInt32Array___destroy___0=li._emscripten_bind_DracoInt32Array___destroy___0,hn=Ze._emscripten_bind_DracoInt32Array_size_0=li._emscripten_bind_DracoInt32Array_size_0,ln=Ze._emscripten_bind_DracoInt8Array_DracoInt8Array_0=li._emscripten_bind_DracoInt8Array_DracoInt8Array_0,cn=Ze._emscripten_bind_DracoInt8Array_GetValue_1=li._emscripten_bind_DracoInt8Array_GetValue_1,dn=Ze._emscripten_bind_DracoInt8Array___destroy___0=li._emscripten_bind_DracoInt8Array___destroy___0,un=Ze._emscripten_bind_DracoInt8Array_size_0=li._emscripten_bind_DracoInt8Array_size_0,fn=Ze._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=li._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0,pn=Ze._emscripten_bind_DracoUInt16Array_GetValue_1=li._emscripten_bind_DracoUInt16Array_GetValue_1,_n=Ze._emscripten_bind_DracoUInt16Array___destroy___0=li._emscripten_bind_DracoUInt16Array___destroy___0,mn=Ze._emscripten_bind_DracoUInt16Array_size_0=li._emscripten_bind_DracoUInt16Array_size_0,An=Ze._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=li._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0,vn=Ze._emscripten_bind_DracoUInt32Array_GetValue_1=li._emscripten_bind_DracoUInt32Array_GetValue_1,yn=Ze._emscripten_bind_DracoUInt32Array___destroy___0=li._emscripten_bind_DracoUInt32Array___destroy___0,gn=Ze._emscripten_bind_DracoUInt32Array_size_0=li._emscripten_bind_DracoUInt32Array_size_0,bn=Ze._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=li._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0,En=Ze._emscripten_bind_DracoUInt8Array_GetValue_1=li._emscripten_bind_DracoUInt8Array_GetValue_1,Tn=Ze._emscripten_bind_DracoUInt8Array___destroy___0=li._emscripten_bind_DracoUInt8Array___destroy___0,Sn=Ze._emscripten_bind_DracoUInt8Array_size_0=li._emscripten_bind_DracoUInt8Array_size_0,wn=Ze._emscripten_bind_GeometryAttribute_GeometryAttribute_0=li._emscripten_bind_GeometryAttribute_GeometryAttribute_0,Cn=Ze._emscripten_bind_GeometryAttribute___destroy___0=li._emscripten_bind_GeometryAttribute___destroy___0,Mn=Ze._emscripten_bind_Mesh_Mesh_0=li._emscripten_bind_Mesh_Mesh_0,Pn=Ze._emscripten_bind_Mesh___destroy___0=li._emscripten_bind_Mesh___destroy___0,In=Ze._emscripten_bind_Mesh_num_attributes_0=li._emscripten_bind_Mesh_num_attributes_0,Rn=Ze._emscripten_bind_Mesh_num_faces_0=li._emscripten_bind_Mesh_num_faces_0,xn=Ze._emscripten_bind_Mesh_num_points_0=li._emscripten_bind_Mesh_num_points_0,On=Ze._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=li._emscripten_bind_MetadataQuerier_GetDoubleEntry_2,kn=Ze._emscripten_bind_MetadataQuerier_GetEntryName_2=li._emscripten_bind_MetadataQuerier_GetEntryName_2,Dn=Ze._emscripten_bind_MetadataQuerier_GetIntEntry_2=li._emscripten_bind_MetadataQuerier_GetIntEntry_2,Ln=Ze._emscripten_bind_MetadataQuerier_GetStringEntry_2=li._emscripten_bind_MetadataQuerier_GetStringEntry_2,Nn=Ze._emscripten_bind_MetadataQuerier_HasDoubleEntry_2=li._emscripten_bind_MetadataQuerier_HasDoubleEntry_2,Fn=Ze._emscripten_bind_MetadataQuerier_HasEntry_2=li._emscripten_bind_MetadataQuerier_HasEntry_2,Bn=Ze._emscripten_bind_MetadataQuerier_HasIntEntry_2=li._emscripten_bind_MetadataQuerier_HasIntEntry_2,Vn=Ze._emscripten_bind_MetadataQuerier_HasStringEntry_2=li._emscripten_bind_MetadataQuerier_HasStringEntry_2,Un=Ze._emscripten_bind_MetadataQuerier_MetadataQuerier_0=li._emscripten_bind_MetadataQuerier_MetadataQuerier_0,Gn=Ze._emscripten_bind_MetadataQuerier_NumEntries_1=li._emscripten_bind_MetadataQuerier_NumEntries_1,Wn=Ze._emscripten_bind_MetadataQuerier___destroy___0=li._emscripten_bind_MetadataQuerier___destroy___0,zn=Ze._emscripten_bind_Metadata_Metadata_0=li._emscripten_bind_Metadata_Metadata_0,Hn=Ze._emscripten_bind_Metadata___destroy___0=li._emscripten_bind_Metadata___destroy___0,jn=Ze._emscripten_bind_PointAttribute_GetAttributeTransformData_0=li._emscripten_bind_PointAttribute_GetAttributeTransformData_0,Yn=Ze._emscripten_bind_PointAttribute_PointAttribute_0=li._emscripten_bind_PointAttribute_PointAttribute_0,Xn=Ze._emscripten_bind_PointAttribute___destroy___0=li._emscripten_bind_PointAttribute___destroy___0,Zn=Ze._emscripten_bind_PointAttribute_attribute_type_0=li._emscripten_bind_PointAttribute_attribute_type_0,Kn=Ze._emscripten_bind_PointAttribute_byte_offset_0=li._emscripten_bind_PointAttribute_byte_offset_0,Qn=Ze._emscripten_bind_PointAttribute_byte_stride_0=li._emscripten_bind_PointAttribute_byte_stride_0,Jn=Ze._emscripten_bind_PointAttribute_data_type_0=li._emscripten_bind_PointAttribute_data_type_0,qn=Ze._emscripten_bind_PointAttribute_normalized_0=li._emscripten_bind_PointAttribute_normalized_0,$n=Ze._emscripten_bind_PointAttribute_num_components_0=li._emscripten_bind_PointAttribute_num_components_0,er=Ze._emscripten_bind_PointAttribute_size_0=li._emscripten_bind_PointAttribute_size_0,tr=Ze._emscripten_bind_PointAttribute_unique_id_0=li._emscripten_bind_PointAttribute_unique_id_0,ir=Ze._emscripten_bind_PointCloud_PointCloud_0=li._emscripten_bind_PointCloud_PointCloud_0,nr=Ze._emscripten_bind_PointCloud___destroy___0=li._emscripten_bind_PointCloud___destroy___0,rr=Ze._emscripten_bind_PointCloud_num_attributes_0=li._emscripten_bind_PointCloud_num_attributes_0,sr=Ze._emscripten_bind_PointCloud_num_points_0=li._emscripten_bind_PointCloud_num_points_0,ar=Ze._emscripten_bind_Status___destroy___0=li._emscripten_bind_Status___destroy___0,or=Ze._emscripten_bind_Status_code_0=li._emscripten_bind_Status_code_0,hr=Ze._emscripten_bind_Status_error_msg_0=li._emscripten_bind_Status_error_msg_0,lr=Ze._emscripten_bind_Status_ok_0=li._emscripten_bind_Status_ok_0,cr=Ze._emscripten_bind_VoidPtr___destroy___0=li._emscripten_bind_VoidPtr___destroy___0,dr=Ze._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=li._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM,ur=Ze._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=li._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM,fr=Ze._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=li._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM,pr=Ze._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=li._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM,_r=Ze._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=li._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE,mr=Ze._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=li._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD,Ar=Ze._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=li._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH,vr=Ze._emscripten_enum_draco_GeometryAttribute_Type_COLOR=li._emscripten_enum_draco_GeometryAttribute_Type_COLOR,yr=Ze._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=li._emscripten_enum_draco_GeometryAttribute_Type_GENERIC,gr=Ze._emscripten_enum_draco_GeometryAttribute_Type_INVALID=li._emscripten_enum_draco_GeometryAttribute_Type_INVALID,br=Ze._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=li._emscripten_enum_draco_GeometryAttribute_Type_NORMAL,Er=Ze._emscripten_enum_draco_GeometryAttribute_Type_POSITION=li._emscripten_enum_draco_GeometryAttribute_Type_POSITION,Tr=Ze._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=li._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD,Sr=Ze._emscripten_enum_draco_StatusCode_ERROR=li._emscripten_enum_draco_StatusCode_ERROR,wr=Ze._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=li._emscripten_enum_draco_StatusCode_INVALID_PARAMETER,Cr=Ze._emscripten_enum_draco_StatusCode_IO_ERROR=li._emscripten_enum_draco_StatusCode_IO_ERROR,Mr=Ze._emscripten_enum_draco_StatusCode_OK=li._emscripten_enum_draco_StatusCode_OK,Pr=Ze._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=li._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION,Ir=Ze._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=li._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION,Rr=(Ze._emscripten_get_global_libc=li._emscripten_get_global_libc,
Ze._emscripten_replace_memory=li._emscripten_replace_memory),xr=(Ze._free=li._free,Ze._i64Add=li._i64Add,Ze._i64Subtract=li._i64Subtract,Ze._llvm_bswap_i32=li._llvm_bswap_i32,Ze._malloc=li._malloc);Ze._memcpy=li._memcpy,Ze._memmove=li._memmove,Ze._memset=li._memset,Ze._sbrk=li._sbrk,Ze.establishStackSpace=li.establishStackSpace,Ze.getTempRet0=li.getTempRet0,Ze.runPostSets=li.runPostSets,Ze.setTempRet0=li.setTempRet0,Ze.setThrew=li.setThrew,Ze.stackAlloc=li.stackAlloc,Ze.stackRestore=li.stackRestore,Ze.stackSave=li.stackSave,Ze.dynCall_ii=li.dynCall_ii,Ze.dynCall_iii=li.dynCall_iii,Ze.dynCall_iiii=li.dynCall_iiii,Ze.dynCall_iiiiiii=li.dynCall_iiiiiii,Ze.dynCall_v=li.dynCall_v,Ze.dynCall_vi=li.dynCall_vi,Ze.dynCall_vii=li.dynCall_vii,Ze.dynCall_viii=li.dynCall_viii,Ze.dynCall_viiii=li.dynCall_viiii,Ze.dynCall_viiiii=li.dynCall_viiiii,Ze.dynCall_viiiiii=li.dynCall_viiiiii;if(St.stackAlloc=Ze.stackAlloc,St.stackSave=Ze.stackSave,St.stackRestore=Ze.stackRestore,St.establishStackSpace=Ze.establishStackSpace,St.setTempRet0=Ze.setTempRet0,St.getTempRet0=Ze.getTempRet0,Ze.asm=li,qt)if("function"==typeof Ze.locateFile?qt=Ze.locateFile(qt):Ze.memoryInitializerPrefixURL&&(qt=Ze.memoryInitializerPrefixURL+qt),tt||it){var Or=Ze.readBinary(qt);lt.set(Or,St.GLOBAL_BASE)}else{R("memory initializer");var kr=function(e){e.byteLength&&(e=new Uint8Array(e)),lt.set(e,St.GLOBAL_BASE),Ze.memoryInitializerRequest&&delete Ze.memoryInitializerRequest.response,x("memory initializer")},Dr=ee(qt);Dr?kr(Dr.buffer):Ze.memoryInitializerRequest?Ze.memoryInitializerRequest.response?setTimeout(fe,0):Ze.memoryInitializerRequest.addEventListener("load",fe):ue()}Ze.then=function(e){if(Ze.calledRun)e(Ze);else{var t=Ze.onRuntimeInitialized;Ze.onRuntimeInitialized=function(){t&&t(),e(Ze)}}return Ze},pe.prototype=new Error,pe.prototype.constructor=pe;var Lr,Nr=null;Jt=function Vr(){Ze.calledRun||_e(),Ze.calledRun||(Jt=Vr)},Ze.run=_e,Ze.exit=me;var Fr=[];if(Ze.abort=Ae,Ze.preInit)for("function"==typeof Ze.preInit&&(Ze.preInit=[Ze.preInit]);Ze.preInit.length>0;)Ze.preInit.pop()();_e(),ve.prototype=Object.create(ve.prototype),ve.prototype.constructor=ve,ve.prototype.__class__=ve,ve.__cache__={},Ze.WrapperObject=ve,Ze.getCache=ye,Ze.wrapPointer=ge,Ze.castObject=be,Ze.NULL=ge(0),Ze.destroy=Ee,Ze.compare=Te,Ze.getPointer=Se,Ze.getClass=we;var Br={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Br.needed){for(var e=0;e<Br.temps.length;e++)Ze._free(Br.temps[e]);Br.temps.length=0,Ze._free(Br.buffer),Br.buffer=0,Br.size+=Br.needed,Br.needed=0}Br.buffer||(Br.size+=128,Br.buffer=Ze._malloc(Br.size),i(Br.buffer)),Br.pos=0},alloc:function(e,t){i(Br.buffer);var n=t.BYTES_PER_ELEMENT,r=e.length*n;r=r+7&-8;var s;return Br.pos+r>=Br.size?(i(r>0),Br.needed+=r,s=Ze._malloc(r),Br.temps.push(s)):(s=Br.buffer+Br.pos,Br.pos+=r),s},copy:function(e,t,i){var n=i,r=t.BYTES_PER_ELEMENT;switch(r){case 2:n>>=1;break;case 4:n>>=2;break;case 8:n>>=3}for(var s=0;s<e.length;s++)t[n+s]=e[s]}};return Pe.prototype=Object.create(ve.prototype),Pe.prototype.constructor=Pe,Pe.prototype.__class__=Pe,Pe.__cache__={},Ze.Status=Pe,Pe.prototype.code=Pe.prototype.code=function(){var e=this.ptr;return or(e)},Pe.prototype.ok=Pe.prototype.ok=function(){var e=this.ptr;return!!lr(e)},Pe.prototype.error_msg=Pe.prototype.error_msg=function(){var e=this.ptr;return s(hr(e))},Pe.prototype.__destroy__=Pe.prototype.__destroy__=function(){var e=this.ptr;ar(e)},Ie.prototype=Object.create(ve.prototype),Ie.prototype.constructor=Ie,Ie.prototype.__class__=Ie,Ie.__cache__={},Ze.DracoUInt16Array=Ie,Ie.prototype.GetValue=Ie.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),pn(t,e)},Ie.prototype.size=Ie.prototype.size=function(){var e=this.ptr;return mn(e)},Ie.prototype.__destroy__=Ie.prototype.__destroy__=function(){var e=this.ptr;_n(e)},Re.prototype=Object.create(ve.prototype),Re.prototype.constructor=Re,Re.prototype.__class__=Re,Re.__cache__={},Ze.PointCloud=Re,Re.prototype.num_attributes=Re.prototype.num_attributes=function(){var e=this.ptr;return rr(e)},Re.prototype.num_points=Re.prototype.num_points=function(){var e=this.ptr;return sr(e)},Re.prototype.__destroy__=Re.prototype.__destroy__=function(){var e=this.ptr;nr(e)},xe.prototype=Object.create(ve.prototype),xe.prototype.constructor=xe,xe.prototype.__class__=xe,xe.__cache__={},Ze.DracoUInt8Array=xe,xe.prototype.GetValue=xe.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),En(t,e)},xe.prototype.size=xe.prototype.size=function(){var e=this.ptr;return Sn(e)},xe.prototype.__destroy__=xe.prototype.__destroy__=function(){var e=this.ptr;Tn(e)},Oe.prototype=Object.create(ve.prototype),Oe.prototype.constructor=Oe,Oe.prototype.__class__=Oe,Oe.__cache__={},Ze.DracoUInt32Array=Oe,Oe.prototype.GetValue=Oe.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),vn(t,e)},Oe.prototype.size=Oe.prototype.size=function(){var e=this.ptr;return gn(e)},Oe.prototype.__destroy__=Oe.prototype.__destroy__=function(){var e=this.ptr;yn(e)},ke.prototype=Object.create(ve.prototype),ke.prototype.constructor=ke,ke.prototype.__class__=ke,ke.__cache__={},Ze.AttributeOctahedronTransform=ke,ke.prototype.InitFromAttribute=ke.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!di(t,e)},ke.prototype.quantization_bits=ke.prototype.quantization_bits=function(){var e=this.ptr;return fi(e)},ke.prototype.__destroy__=ke.prototype.__destroy__=function(){var e=this.ptr;ui(e)},De.prototype=Object.create(ve.prototype),De.prototype.constructor=De,De.prototype.__class__=De,De.__cache__={},Ze.PointAttribute=De,De.prototype.size=De.prototype.size=function(){var e=this.ptr;return er(e)},De.prototype.GetAttributeTransformData=De.prototype.GetAttributeTransformData=function(){var e=this.ptr;return ge(jn(e),Le)},De.prototype.attribute_type=De.prototype.attribute_type=function(){var e=this.ptr;return Zn(e)},De.prototype.data_type=De.prototype.data_type=function(){var e=this.ptr;return Jn(e)},De.prototype.num_components=De.prototype.num_components=function(){var e=this.ptr;return $n(e)},De.prototype.normalized=De.prototype.normalized=function(){var e=this.ptr;return!!qn(e)},De.prototype.byte_stride=De.prototype.byte_stride=function(){var e=this.ptr;return Qn(e)},De.prototype.byte_offset=De.prototype.byte_offset=function(){var e=this.ptr;return Kn(e)},De.prototype.unique_id=De.prototype.unique_id=function(){var e=this.ptr;return tr(e)},De.prototype.__destroy__=De.prototype.__destroy__=function(){var e=this.ptr;Xn(e)},Le.prototype=Object.create(ve.prototype),Le.prototype.constructor=Le,Le.prototype.__class__=Le,Le.__cache__={},Ze.AttributeTransformData=Le,Le.prototype.transform_type=Le.prototype.transform_type=function(){var e=this.ptr;return Ei(e)},Le.prototype.__destroy__=Le.prototype.__destroy__=function(){var e=this.ptr;bi(e)},Ne.prototype=Object.create(ve.prototype),Ne.prototype.constructor=Ne,Ne.prototype.__class__=Ne,Ne.__cache__={},Ze.AttributeQuantizationTransform=Ne,Ne.prototype.InitFromAttribute=Ne.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!_i(t,e)},Ne.prototype.quantization_bits=Ne.prototype.quantization_bits=function(){var e=this.ptr;return vi(e)},Ne.prototype.min_value=Ne.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ai(t,e)},Ne.prototype.range=Ne.prototype.range=function(){var e=this.ptr;return yi(e)},Ne.prototype.__destroy__=Ne.prototype.__destroy__=function(){var e=this.ptr;mi(e)},Fe.prototype=Object.create(ve.prototype),Fe.prototype.constructor=Fe,Fe.prototype.__class__=Fe,Fe.__cache__={},Ze.DracoInt8Array=Fe,Fe.prototype.GetValue=Fe.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),cn(t,e)},Fe.prototype.size=Fe.prototype.size=function(){var e=this.ptr;return un(e)},Fe.prototype.__destroy__=Fe.prototype.__destroy__=function(){var e=this.ptr;dn(e)},Be.prototype=Object.create(ve.prototype),Be.prototype.constructor=Be,Be.prototype.__class__=Be,Be.__cache__={},Ze.MetadataQuerier=Be,Be.prototype.HasEntry=Be.prototype.HasEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),!!Fn(i,e,t)},Be.prototype.HasIntEntry=Be.prototype.HasIntEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),!!Bn(i,e,t)},Be.prototype.GetIntEntry=Be.prototype.GetIntEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),Dn(i,e,t)},Be.prototype.HasDoubleEntry=Be.prototype.HasDoubleEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),!!Nn(i,e,t)},Be.prototype.GetDoubleEntry=Be.prototype.GetDoubleEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),On(i,e,t)},Be.prototype.HasStringEntry=Be.prototype.HasStringEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),!!Vn(i,e,t)},Be.prototype.GetStringEntry=Be.prototype.GetStringEntry=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),s(Ln(i,e,t))},Be.prototype.NumEntries=Be.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Gn(t,e)},Be.prototype.GetEntryName=Be.prototype.GetEntryName=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),s(kn(i,e,t))},Be.prototype.__destroy__=Be.prototype.__destroy__=function(){var e=this.ptr;Wn(e)},Ve.prototype=Object.create(ve.prototype),Ve.prototype.constructor=Ve,Ve.prototype.__class__=Ve,Ve.__cache__={},Ze.DracoInt16Array=Ve,Ve.prototype.GetValue=Ve.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),tn(t,e)},Ve.prototype.size=Ve.prototype.size=function(){var e=this.ptr;return rn(e)},Ve.prototype.__destroy__=Ve.prototype.__destroy__=function(){var e=this.ptr;nn(e)},Ue.prototype=Object.create(ve.prototype),Ue.prototype.constructor=Ue,Ue.prototype.__class__=Ue,Ue.__cache__={},Ze.DracoFloat32Array=Ue,Ue.prototype.GetValue=Ue.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ji(t,e)},Ue.prototype.size=Ue.prototype.size=function(){var e=this.ptr;return $i(e)},Ue.prototype.__destroy__=Ue.prototype.__destroy__=function(){var e=this.ptr;qi(e)},Ge.prototype=Object.create(ve.prototype),Ge.prototype.constructor=Ge,Ge.prototype.__class__=Ge,Ge.__cache__={},Ze.GeometryAttribute=Ge,Ge.prototype.__destroy__=Ge.prototype.__destroy__=function(){var e=this.ptr;Cn(e)},We.prototype=Object.create(ve.prototype),We.prototype.constructor=We,We.prototype.__class__=We,We.__cache__={},Ze.DecoderBuffer=We,We.prototype.Init=We.prototype.Init=function(e,t){var i=this.ptr;Br.prepare(),"object"==typeof e&&(e=Me(e)),t&&"object"==typeof t&&(t=t.ptr),Si(i,e,t)},We.prototype.__destroy__=We.prototype.__destroy__=function(){var e=this.ptr;wi(e)},ze.prototype=Object.create(ve.prototype),ze.prototype.constructor=ze,ze.prototype.__class__=ze,ze.__cache__={},Ze.Decoder=ze,ze.prototype.GetEncodedGeometryType=ze.prototype.GetEncodedGeometryType=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Hi(t,e)},ze.prototype.DecodeBufferToPointCloud=ze.prototype.DecodeBufferToPointCloud=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),ge(Mi(i,e,t),Pe)},ze.prototype.DecodeBufferToMesh=ze.prototype.DecodeBufferToMesh=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),ge(Ci(i,e,t),Pe)},ze.prototype.GetAttributeId=ze.prototype.GetAttributeId=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Di(i,e,t)},ze.prototype.GetAttributeIdByName=ze.prototype.GetAttributeIdByName=function(e,t){var i=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),ki(i,e,t)},ze.prototype.GetAttributeIdByMetadataEntry=ze.prototype.GetAttributeIdByMetadataEntry=function(e,t,i){var n=this.ptr;return Br.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:Ce(t),i=i&&"object"==typeof i?i.ptr:Ce(i),Oi(n,e,t,i)},ze.prototype.GetAttribute=ze.prototype.GetAttribute=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),ge(zi(i,e,t),De)},ze.prototype.GetAttributeByUniqueId=ze.prototype.GetAttributeByUniqueId=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),ge(Ii(i,e,t),De)},ze.prototype.GetMetadata=ze.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ge(Yi(t,e),Xe)},ze.prototype.GetAttributeMetadata=ze.prototype.GetAttributeMetadata=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),ge(Vi(i,e,t),Xe)},ze.prototype.GetFaceFromMesh=ze.prototype.GetFaceFromMesh=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!ji(n,e,t,i)},ze.prototype.GetTriangleStripsFromMesh=ze.prototype.GetTriangleStripsFromMesh=function(e,t){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Xi(i,e,t)},ze.prototype.GetAttributeFloat=ze.prototype.GetAttributeFloat=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!xi(n,e,t,i)},ze.prototype.GetAttributeFloatForAllPoints=ze.prototype.GetAttributeFloatForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Ri(n,e,t,i)},ze.prototype.GetAttributeIntForAllPoints=ze.prototype.GetAttributeIntForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Bi(n,e,t,i)},ze.prototype.GetAttributeInt8ForAllPoints=ze.prototype.GetAttributeInt8ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Fi(n,e,t,i)},ze.prototype.GetAttributeUInt8ForAllPoints=ze.prototype.GetAttributeUInt8ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Wi(n,e,t,i)},ze.prototype.GetAttributeInt16ForAllPoints=ze.prototype.GetAttributeInt16ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Li(n,e,t,i)},ze.prototype.GetAttributeUInt16ForAllPoints=ze.prototype.GetAttributeUInt16ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Ui(n,e,t,i)},ze.prototype.GetAttributeInt32ForAllPoints=ze.prototype.GetAttributeInt32ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Ni(n,e,t,i)},ze.prototype.GetAttributeUInt32ForAllPoints=ze.prototype.GetAttributeUInt32ForAllPoints=function(e,t,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Gi(n,e,t,i)},ze.prototype.SkipAttributeTransform=ze.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),Zi(t,e)},ze.prototype.__destroy__=ze.prototype.__destroy__=function(){var e=this.ptr;Ki(e)},He.prototype=Object.create(ve.prototype),He.prototype.constructor=He,He.prototype.__class__=He,He.__cache__={},Ze.Mesh=He,He.prototype.num_faces=He.prototype.num_faces=function(){var e=this.ptr;return Rn(e)},He.prototype.num_attributes=He.prototype.num_attributes=function(){var e=this.ptr;return In(e)},He.prototype.num_points=He.prototype.num_points=function(){var e=this.ptr;return xn(e)},He.prototype.__destroy__=He.prototype.__destroy__=function(){var e=this.ptr;Pn(e)},je.prototype=Object.create(ve.prototype),je.prototype.constructor=je,je.prototype.__class__=je,je.__cache__={},Ze.VoidPtr=je,je.prototype.__destroy__=je.prototype.__destroy__=function(){var e=this.ptr;cr(e)},Ye.prototype=Object.create(ve.prototype),Ye.prototype.constructor=Ye,Ye.prototype.__class__=Ye,Ye.__cache__={},Ze.DracoInt32Array=Ye,Ye.prototype.GetValue=Ye.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),an(t,e)},Ye.prototype.size=Ye.prototype.size=function(){var e=this.ptr;return hn(e)},Ye.prototype.__destroy__=Ye.prototype.__destroy__=function(){var e=this.ptr;on(e)},Xe.prototype=Object.create(ve.prototype),Xe.prototype.constructor=Xe,Xe.prototype.__class__=Xe,Xe.__cache__={},Ze.Metadata=Xe,Xe.prototype.__destroy__=Xe.prototype.__destroy__=function(){var e=this.ptr;Hn(e)},function(){function e(){Ze.OK=Mr(),Ze.ERROR=Sr(),Ze.IO_ERROR=Cr(),Ze.INVALID_PARAMETER=wr(),Ze.UNSUPPORTED_VERSION=Ir(),Ze.UNKNOWN_VERSION=Pr(),Ze.INVALID_GEOMETRY_TYPE=_r(),Ze.POINT_CLOUD=mr(),Ze.TRIANGULAR_MESH=Ar(),Ze.ATTRIBUTE_INVALID_TRANSFORM=dr(),Ze.ATTRIBUTE_NO_TRANSFORM=ur(),Ze.ATTRIBUTE_QUANTIZATION_TRANSFORM=pr(),Ze.ATTRIBUTE_OCTAHEDRON_TRANSFORM=fr(),Ze.INVALID=gr(),Ze.POSITION=Er(),Ze.NORMAL=br(),Ze.COLOR=vr(),Ze.TEX_COORD=Tr(),Ze.GENERIC=yr()}Ze.calledRun?e():M(e)}(),"function"==typeof Ze.onModuleParsed&&Ze.onModuleParsed(),e};"object"==typeof module&&module.exports&&(module.exports=DracoDecoderModule);var AnimationKeyableType={NUM:0,VEC:1,QUAT:2},AnimationKeyable=function(e,t,i){this.init(e,t,i)};AnimationKeyable.prototype.init=function(e,t,i){if(this.type=e||AnimationKeyableType.NUM,this.time=t||0,i)this.value=i;else switch(e){case AnimationKeyableType.NUM:this.value=0;break;case AnimationKeyableType.VEC:this.value=new pc.Vec3;break;case AnimationKeyableType.QUAT:this.value=new pc.Quat}return this},AnimationKeyable.prototype.copy=function(e){if(!e)return this;var t=e.value;return(e.value instanceof pc.Vec3||e.value instanceof pc.Quat)&&(t=e.value.clone()),this.init(e.type,e.time,t),this},AnimationKeyable.prototype.clone=function(){var e=this.value;(this.value instanceof pc.Vec3||this.value instanceof pc.Quat)&&(e=this.value.clone());var t=new AnimationKeyable(this.type,this.time,e);return t},AnimationKeyable.sum=function(e,t){if(!e||!t||e.type!=t)return null;var i=new AnimationKeyable(e.type);switch(e.type){case AnimationKeyableType.NUM:i.value=e.value+t.value;break;case AnimationKeyableType.VEC:i.value.add2(e.value,t.value);break;case AnimationKeyableType.QUAT:i.value.x=e.value.x+t.value.x,i.value.y=e.value.y+t.value.y,i.value.z=e.value.z+t.value.z,i.value.w=e.value.w+t.value.w}return i},AnimationKeyable.minus=function(e,t){if(!e||!t||e.type!=t)return null;var i=new AnimationKeyable(e.type);switch(e.type){case AnimationKeyableType.NUM:i.value=e.value-t.value;break;case AnimationKeyableType.VEC:i.value.sub2(e.value,t.value);break;case AnimationKeyableType.QUAT:i.value.x=e.value.x-t.value.x,i.value.y=e.value.y-t.value.y,i.value.z=e.value.z-t.value.z,i.value.w=e.value.w-t.value.w}return i},AnimationKeyable.mul=function(e,t){if(!e)return null;var i=new AnimationKeyable;switch(i.copy(e),e.type){case AnimationKeyableType.NUM:i.value*=t;break;case AnimationKeyableType.VEC:i.value.scale(t);break;case AnimationKeyableType.QUAT:i.value.x*=t,i.value.y*=t,i.value.z*=t,i.value.w*=t}return i},AnimationKeyable.div=function(e,t){return 0===t?null:AnimationKeyable.mul(e,1/t)},AnimationKeyable.linearBlend=function(e,t,i){if(!e||!t||e.type!==t.type)return null;var n=new AnimationKeyable(e.type);if(0===i)return n.copy(e),n;if(1===i)return n.copy(t),n;switch(e.type){case AnimationKeyableType.NUM:n.value=(1-i)*e.value+i*t.value;break;case AnimationKeyableType.VEC:n.value.lerp(e.value,t.value,i);break;case AnimationKeyableType.QUAT:n.value.slerp(e.value,t.value,i)}return n},AnimationKeyable.linearBlendValue=function(e,t,i){var n;return"number"==typeof e&&"number"==typeof t?(1-i)*e+i*t:e instanceof pc.Vec3&&t instanceof pc.Vec3||e instanceof pc.Vec2&&t instanceof pc.Vec2||e instanceof pc.Vec4&&t instanceof pc.Vec4?(n=e.clone(),n.lerp(e,t,i),n):e instanceof pc.Quat&&t instanceof pc.Quat?(n=e.clone(),n.slerp(e,t,i),n):null};var AnimationTarget=function(e,t,i){this.targetNode=e,this.targetPath=t,this.targetProp=i};AnimationTarget.prototype.toString=function(){var e="";return this.targetNode&&(e+=this.targetNode.name),this.targetPath&&(e+="_"+this.targetPath),this.targetProp&&(e+="_"+this.targetProp),e},AnimationTarget.prototype.copy=function(e){return e&&(this.targetNode=e.targetNode,this.targetPath=e.targetPath,this.targetProp=e.targetProp),this},AnimationTarget.prototype.clone=function(){var e=new AnimationTarget(this.targetNode,this.targetPath,this.targetProp);return e},AnimationTarget.prototype.blendToTarget=function(e,t){if(!("undefined"==typeof e||t>1||t<=0)){if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),1===t)return void this.updateToTarget(e);if(this.targetNode&&this.targetNode.hasOwnProperty(this.targetPath)){var i;if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?(i=AnimationKeyable.linearBlendValue(this.targetNode[this.targetPath][this.targetProp],e,t),this.targetNode[this.targetPath][this.targetProp]=i):(i=AnimationKeyable.linearBlendValue(this.targetNode[this.targetPath],e,t),this.targetNode[this.targetPath]=i),"localEulerAngles"==this.targetPath){var n=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?n[this.targetProp]=i:n=i,this.targetNode.setLocalEulerAngles(n)}this.targetNode._dirtify(!0)}}},AnimationTarget.prototype.updateToTarget=function(e){if("undefined"!=typeof e){if("localPosition"===this.targetPath&&this.vScale instanceof pc.Vec3&&(e instanceof pc.Vec3?(e.x*=this.vScale.x,e.y*=this.vScale.y,e.z*=this.vScale.z):"number"==typeof e&&"number"==typeof this.vScale[this.targetProp]&&(e*=this.vScale[this.targetProp])),this.targetNode&&this.targetNode.hasOwnProperty(this.targetPath)){if(this.targetProp&&this.targetProp in this.targetNode[this.targetPath]?this.targetNode[this.targetPath][this.targetProp]=e:this.targetNode[this.targetPath]=e,"localEulerAngles"==this.targetPath){var t=new pc.Vec3;"x"===this.targetProp||"y"===this.targetProp||"z"===this.targetProp?t[this.targetProp]=e:t=e,this.targetNode.setLocalEulerAngles(t)}this.targetNode._dirtify(!0)}if(this.targetNode&&"weights"===this.targetPath&&this.targetNode.model)for(var i=this.targetNode.model.meshInstances,n=0;n<i.length;n++){var r=i[n].morphInstance;r&&r.setWeight(this.targetProp,e)}}},AnimationTarget.constructTargetNodes=function(e,t){if(e){var i=t||new pc.Vec3(1,1,1),n=new AnimationTarget(e);e.localScale&&(n.vScale=new pc.Vec3(e.localScale.x*i.x,e.localScale.y*i.y,e.localScale.z*i.z));for(var r=[n],s=0;s<e.children.length;s++){var a=AnimationTarget.constructTargetNodes(e.children[s],n.vScale);a&&(r=r.concat(a))}return r}},AnimationTarget.getLocalScale=function(e){if(e){for(var t=new pc.Vec3(1,1,1),i=e;i;)i.localScale&&(t.x*=i.localScale.x,t.y*=i.localScale.y,t.z*=i.localScale.z),i=i.parent;return t}};var AnimationCurveType={LINEAR:0,STEP:1,CUBIC:2},AnimationCurve=function e(){e.count++,this.name="curve"+e.count.toString(),this.type=AnimationCurveType.LINEAR,this.keyableType=AnimationKeyableType.NUM,this.tension=.5,this.animTargets=[],this.duration=0,this.animKeys=[],this.session=new AnimationSession(this)};AnimationCurve.count=0,Object.defineProperty(AnimationCurve.prototype,"isPlaying",{get:function(){return this.session.isPlaying},set:function(e){this.session.isPlaying=e}}),Object.defineProperty(AnimationCurve.prototype,"loop",{get:function(){return this.session.loop},set:function(e){this.session.loop=e}}),Object.defineProperty(AnimationCurve.prototype,"bySpeed",{get:function(){return this.session.bySpeed},set:function(e){this.session.bySpeed=e}}),AnimationCurve.prototype.copy=function(e){var t;for(this.name=e.name,this.type=e.type,this.keyableType=e.keyableType,this.tension=e.tension,this.duration=e.duration,this.animTargets=[],t=0;t<e.animTargets.length;t++)this.animTargets.push(e.animTargets[t].clone());for(this.animKeys=[],t=0;t<e.animKeys.length;t++){var i=new AnimationKeyable;i.copy(e.animKeys[t]),this.animKeys.push(i)}return this},AnimationCurve.prototype.clone=function(){var e=(new AnimationCurve).copy(this);return e},AnimationCurve.prototype.addTarget=function(e,t,i){var n=new AnimationTarget(e,t,i);this.animTargets.push(n)},AnimationCurve.prototype.setTarget=function(e,t,i){this.animTargets=[],this.addTarget(e,t,i)},AnimationCurve.prototype.clearTargets=function(){this.animTargets=[]},AnimationCurve.prototype.resetSession=function(){this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0},AnimationCurve.prototype.blendToTarget=function(e,t){this.session.blendToTarget(e,t)},AnimationCurve.prototype.updateToTarget=function(e){this.session.updateToTarget(e)},AnimationCurve.prototype.getAnimTargets=function(){var e={};return e[this.name]=this.animTargets,e},AnimationCurve.prototype.on=function(e,t,i,n,r){return this.session&&this.session.on(e,t,i,n,r),this},AnimationCurve.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},AnimationCurve.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},AnimationCurve.prototype.fadeIn=function(e){this.session.fadeIn(e,this)},AnimationCurve.prototype.fadeOut=function(e){this.session.fadeOut(e)},AnimationCurve.prototype.play=function(){this.session.play(this)},AnimationCurve.prototype.resume=function(){this.session.resume()},AnimationCurve.prototype.stop=function(){this.session.stop()},AnimationCurve.prototype.pause=function(){this.session.pause()},AnimationCurve.prototype.showAt=function(e,t,i,n,r){this.session.showAt(e,t,i,n,r)},AnimationCurve.prototype.setAnimKeys=function(e){this.animKeys=e},AnimationCurve.prototype.insertKey=function(e,t,i){if(this.keyableType==e){for(var n=0;n<this.animKeys.length&&this.animKeys[n].time<t;)n++;if(n<this.animKeys.length&&this.animKeys[n].time==t)return void(this.animKeys[n].value=i);var r=new AnimationKeyable(e,t,i);return n>=this.animKeys.length?(this.animKeys.push(r),void(this.duration=t)):void this.animKeys.splice(n,0,r)}},AnimationCurve.prototype.removeKey=function(e){e<=this.animKeys.length&&(e==this.animKeys.length-1&&(this.duration=e-1>=0?this.animKeys[e-1].time:0),this.animKeys.splice(e,1))},AnimationCurve.prototype.removeAllKeys=function(){this.animKeys=[],this.duration=0},AnimationCurve.prototype.shiftKeyTime=function(e){for(var t=0;t<this.animKeys.length;t++)this.animKeys[t].time+=e},AnimationCurve.prototype.getSubCurve=function(e,t){var i,n=new AnimationCurve;for(n.type=this.type,n.name=this.name+"_sub",n.keyableType=this.keyableType,n.animTargets=this.animTargets,n.tension=this.tension,n.animTargets=[],i=0;i<this.animTargets.length;i++)n.animTargets.push(this.animTargets[i].clone());var r=-1;for(i=0;i<this.animKeys.length;i++)if(this.animKeys[i].time>=e&&this.animKeys[i].time<=t){r<0&&(r=this.animKeys[i].time);var s=(new AnimationKeyable).copy(this.animKeys[i]);s.time-=r,n.animKeys.push(s)}return n.duration=r===-1?0:t-r,n},AnimationCurve.prototype.evalLINEAR=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var t,i,n=new AnimationKeyable,r=0;r<this.animKeys.length;r++){if(this.animKeys[r].time===e)return n.copy(this.animKeys[r]),n;if(this.animKeys[r].time>e){i=this.animKeys[r];break}t=this.animKeys[r]}if(!t||!i)return n.copy(t?t:i),n.time=e,n;var s=(e-t.time)/(i.time-t.time);return n=AnimationKeyable.linearBlend(t,i,s),n.time=e,n},AnimationCurve.prototype.evalSTEP=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var t=this.animKeys[0],i=1;i<this.animKeys.length&&this.animKeys[i].time<=e;i++)t=this.animKeys[i];var n=new AnimationKeyable;return n.copy(t),n.time=e,n},AnimationCurve.prototype.evalCUBIC=function(e){if(!this.animKeys||0===this.animKeys.length)return null;for(var t,i,n,r,s=new AnimationKeyable,a=0;a<this.animKeys.length;a++){if(this.animKeys[a].time===e)return s.copy(this.animKeys[a]),s;if(this.animKeys[a].time>e){n=this.animKeys[a],a+1<this.animKeys.length&&(r=this.animKeys[a+1]);break}i=this.animKeys[a],a-1>=0&&(t=this.animKeys[a-1])}return i&&n?i.type==AnimationKeyableType.NUM||i.type==AnimationKeyableType.VEC?(s=AnimationCurve.cubicCardinal(t,i,n,r,e,this.tension),s.time=e,s):null:(s.copy(i?i:n),s.time=e,s)},AnimationCurve.prototype.eval=function(e){if(!this.animKeys||0===this.animKeys.length)return null;switch(this.type){case AnimationCurveType.LINEAR:return this.evalLINEAR(e);case AnimationCurveType.STEP:return this.evalSTEP(e);case AnimationCurveType.CUBIC:return this.keyableType==AnimationKeyableType.QUAT?this.evalLINEAR(e):this.evalCUBIC(e)}return null},AnimationCurve.cubicHermite=function(e,t,i,n,r){var s=r*r,a=s*r,o=2*a-3*s+1,h=-2*a+3*s,l=a-2*s+r,c=a-s;return t*o+n*h+e*l+i*c},AnimationCurve.cubicCardinal=function(e,t,i,n,r,s){var a,o;if(!t||!i||t.type!=i.type)return null;if(t.type!=AnimationKeyableType.NUM&&t.type!=AnimationKeyableType.VEC)return null;var h=(r-t.time)/(i.time-t.time),l=new AnimationKeyable;l.type=t.type;var c=s*(i.time-t.time);if(t.type===AnimationKeyableType.NUM&&(a=c*(i.value-t.value)/(i.time-t.time),e&&(a=2*c*(i.value-e.value)/(i.time-e.time)),o=c*(i.value-t.value)/(i.time-t.time),n&&(o=2*c*(n.value-t.value)/(n.time-t.time)),l.value=AnimationCurve.cubicHermite(a,t.value,o,i.value,h)),t.type===AnimationKeyableType.VEC){l.value=t.value.clone();for(var d=0;d<l.value.data.length;d++)a=c*(i.value.data[d]-t.value.data[d])/(i.time-t.time),e&&(a=2*c*(i.value.data[d]-e.value.data[d])/(i.time-e.time)),o=c*(i.value.data[d]-t.value.data[d])/(i.time-t.time),n&&(o=2*c*(n.value.data[d]-t.value.data[d])/(n.time-t.time)),l.value.data[d]=AnimationCurve.cubicHermite(a,t.value.data[d],o,i.value.data[d],h)}return l};var AnimationClipSnapshot=function(){this.curveKeyable={}};AnimationClipSnapshot.prototype.copy=function(e){if(!e)return this;this.curveKeyable={};for(var t=Object.keys(e.curveKeyable),i=0;i<t.length;i++){var n=t[i];this.curveKeyable[n]=(new AnimationKeyable).copy(e.curveKeyable[n])}return this},AnimationClipSnapshot.prototype.clone=function(){var e=(new AnimationClipSnapshot).copy(this);return e},AnimationClipSnapshot.linearBlend=function(e,t,i){if(!e||!t)return null;if(0===i)return e;if(1===i)return t;var n=new AnimationClipSnapshot;n.copy(e);for(var r=Object.keys(t.curveKeyable),s=0;s<r.length;s++){var a=r[s];if(e.curveKeyable[a]){var o=AnimationKeyable.linearBlend(e.curveKeyable[a],t.curveKeyable[a],i);n.curveKeyable[a]=o}else n.curveKeyable[a]=t.curveKeyable[a]}return n};var AnimationClip=function t(e){t.count++,this.name="clip"+t.count.toString(),this.duration=0,this.animCurves={},this.root=null,e&&(this.root=e,this.constructFromRoot(e)),this.session=new AnimationSession(this)};AnimationClip.count=0,Object.defineProperty(AnimationClip.prototype,"isPlaying",{get:function(){return this.session.isPlaying},set:function(e){this.session.isPlaying=e}}),Object.defineProperty(AnimationClip.prototype,"loop",{get:function(){return this.session.loop},set:function(e){this.session.loop=e}}),Object.defineProperty(AnimationClip.prototype,"bySpeed",{get:function(){return this.session.bySpeed},set:function(e){
this.session.bySpeed=e}}),AnimationClip.prototype.copy=function(e){this.name=e.name,this.duration=e.duration,this.animCurves={};for(var t=Object.keys(e.animCurves),i=0;i<t.length;i++){var n=t[i],r=(new AnimationCurve).copy(e.animCurves[n]);this.animCurves[r.name]=r}return this},AnimationClip.prototype.clone=function(){var e=(new AnimationClip).copy(this);return e},AnimationClip.prototype.updateDuration=function(){this.duration=0;for(var e=Object.keys(this.animCurves),t=0;t<e.length;t++){var i=e[t];this.duration=Math.max(this.duration,this.animCurves[i].duration)}},AnimationClip.prototype.showAt=function(e,t,i,n,r){this.session.showAt(e,t,i,n,r)},AnimationClip.prototype.blendToTarget=function(e,t){this.session.blendToTarget(e,t)},AnimationClip.prototype.updateToTarget=function(e){this.session.updateToTarget(e)},AnimationClip.prototype.getAnimTargets=function(){for(var e={},t=Object.keys(this.animCurves),i=0;i<t.length;i++)if(t[i]&&this.animCurves[t[i]]){var n=this.animCurves[t[i]].getAnimTargets();e[t[i]]=n[t[i]]}return e},AnimationClip.prototype.resetSession=function(){this.session.playable=this,this.session.animTargets=this.getAnimTargets(),this.session.isPlaying=!0,this.session.begTime=0,this.session.endTime=this.duration,this.session.curTime=0,this.session.bySpeed=1,this.session.loop=!0},AnimationClip.prototype.play=function(){this.session.play(this)},AnimationClip.prototype.stop=function(){this.session.stop()},AnimationClip.prototype.pause=function(){this.session.pause()},AnimationClip.prototype.resume=function(){this.session.resume()},AnimationClip.prototype.fadeIn=function(e){this.session.fadeIn(e,this)},AnimationClip.prototype.fadeOut=function(e){this.session.fadeOut(e)},AnimationClip.prototype.fadeTo=function(e,t){this.session.fadeTo(e,t)},AnimationClip.prototype.addCurve=function(e){e&&e.name&&(this.animCurves[e.name]=e,e.duration>this.duration&&(this.duration=e.duration))},AnimationClip.prototype.removeCurve=function(e){e&&this.animCurves[e]&&(delete this.animCurves[e],this.updateDuration())},AnimationClip.prototype.removeAllCurves=function(){this.animCurves={},this.duration=0},AnimationClip.prototype.on=function(e,t,i,n,r){return this.session&&this.session.on(e,t,i,n,r),this},AnimationClip.prototype.off=function(e,t,i){return this.session&&this.session.off(e,t,i),this},AnimationClip.prototype.removeAllEvents=function(){return this.session&&this.session.removeAllEvents(),this},AnimationClip.prototype.getSubClip=function(e,t){var i=new AnimationClip;i.name=this.name+"_sub",i.root=this.root;for(var n=Object.keys(this.animCurves),r=0;r<n.length;r++)if(n[r]&&this.animCurves[n[r]]){var s=this.animCurves[n[r]].getSubCurve(e,t);i.addCurve(s)}return i},AnimationClip.prototype.eval=function(e){var t=new AnimationClipSnapshot;t.time=e;for(var i=Object.keys(this.animCurves),n=0;n<i.length;n++)if(i[n]&&this.animCurves[i[n]]){var r=this.animCurves[i[n]].eval(e);t.curveKeyable[i[n]]=r}return t},AnimationClip.prototype.constructFromRoot=function(e){if(e){var t=new AnimationCurve;t.keyableType=AnimationKeyableType.VEC,t.name=e.name+".localScale",t.setTarget(e,"localScale"),this.addCurve(t);var i=new AnimationCurve;i.keyableType=AnimationKeyableType.VEC,i.name=e.name+".localPosition",i.setTarget(e,"localPosition"),this.addCurve(i);var n=new AnimationCurve;n.name=e.name+".localRotation.quat",n.keyableType=AnimationKeyableType.QUAT,n.setTarget(e,"localRotation"),this.addCurve(n);for(var r=0;r<e.children.length;r++)e.children[r]&&this.constructFromRoot(e.children[r])}},AnimationClip.prototype.transferToRoot=function(e){for(var t=AnimationTarget.constructTargetNodes(e),i=Object.keys(this.animCurves),n=0;n<i.length;n++)if(i[n]&&this.animCurves[i[n]])for(var r=this.animCurves[i[n]],s=0;s<r.animTargets.length;s++){for(var a=r.animTargets[s],o=!1,h=0;h<t.length;h++){var l=t[h];if(a.targetNode.name===l.targetNode.name){o=!0;var c=AnimationTarget.getLocalScale(a.targetNode);a.targetNode=l.targetNode,c&&l.vScale&&(a.vScale=new pc.Vec3(c.x,c.y,c.z),l.vScale.x&&(a.vScale.x/=l.vScale.x),l.vScale.y&&(a.vScale.y/=l.vScale.y),l.vScale.z&&(a.vScale.z/=l.vScale.z))}}o||console.warn("transferToRoot: "+a.targetNode.name+"in animation clip "+this.name+" has no transferred target under "+e.name)}},AnimationClip.prototype.updateCurveNameFromTarget=function(){for(var e=Object.keys(this.animCurves),t=0;t<e.length;t++){var i=e[t];if(i&&this.animCurves[i]){var n=this.animCurves[i];if(n.animTargets&&!(n.animTargets.length<1)){var r=n.animTargets[0].toString();n.name=r,this.animCurves[r]=n,delete this.animCurves[i]}}}},AnimationClip.prototype.removeEmptyCurves=function(){for(var e=Object.keys(this.animCurves),t=0;t<e.length;t++)this.animCurves[e[t]]&&this.animCurves[e[t]].animKeys&&0!=this.animCurves[e[t]].animKeys.length||delete this.animCurves[e[t]]},AnimationClip.prototype.setInterpolationType=function(e){for(var t=Object.keys(this.animCurves),i=0;i<t.length;i++)this.animCurves[t[i]]&&(this.animCurves[t[i]].type=e)};var AnimationEvent=function(e,t,i,n,r){this.name=e,this.triggerTime=t,this.fnCallback=i,this.context=n||this,this.parameter=r,this.triggered=!1};AnimationEvent.prototype.invoke=function(){this.fnCallback&&(this.fnCallback.call(this.context,this.parameter),this.triggered=!0)};var AnimationSession=function(e,t){this.begTime=-1,this.endTime=-1,this.curTime=0,this.accTime=0,this.bySpeed=1,this.isPlaying=!1,this.loop=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this.playable=null,this.animTargets={},e&&(this.playable=e,t||(this.animTargets=e.getAnimTargets())),t&&(this.animTargets=t),this.animEvents=[],this.blendables={},this.blendWeights={};var i=this;this.onTimer=function(e){if(i.curTime+=i.bySpeed*e,i.accTime+=i.bySpeed*e,!i.isPlaying||!i.loop&&(i.curTime<i.begTime||i.curTime>i.endTime))return i.invokeByTime(i.curTime),i.stop(),void i.invokeByName("stop");var t=i.endTime-i.begTime;if(i.curTime>i.endTime){i.invokeByTime(i.curTime),i.curTime-=t;for(var n=0;n<i.animEvents.length;n++)i.animEvents[n].triggered=!1}if(i.curTime<i.begTime&&(i.curTime+=t),i.fadeDir&&(i.fadeTime+=e,i.fadeTime>=i.fadeEndTime))if(1===i.fadeDir)i.fadeDir=0,i.fadeBegTime=-1,i.fadeEndTime=-1,i.fadeTime=-1;else if(i.fadeDir===-1)return void i.stop();i.showAt(i.curTime,i.fadeDir,i.fadeBegTime,i.fadeEndTime,i.fadeTime),i.invokeByTime(i.curTime)}};AnimationSession.app=null,AnimationSession.prototype.setBlend=function(e,t,i){if(e instanceof AnimationClip)return i&&""!==i||(i="__default__"),this.blendables[i]=e,void(this.blendWeights[i]=t);var n;"number"==typeof e?n=AnimationKeyableType.NUM:e instanceof pc.Vec3?n=AnimationKeyableType.VEC:e instanceof pc.Quat&&(n=AnimationKeyableType.QUAT),i&&""!==i&&"undefined"!=typeof n&&(this.blendWeights[i]=t,this.blendables[i]=new AnimationKeyable(n,0,e))},AnimationSession.prototype.unsetBlend=function(e){e&&""!==e||(e="__default__"),this.blendables[e]&&(delete this.blendables[e],delete this.blendWeights[e])},AnimationSession.prototype.on=function(e,t,i,n,r){if(e&&i){for(var s=new AnimationEvent(e,t,i,n,r),a=0;a<this.animEvents.length&&!(this.animEvents[a].triggerTime>t);a++);a>=this.animEvents.length?this.animEvents.push(s):this.animEvents.splice(a,0,s)}},AnimationSession.prototype.off=function(e,t,i){for(var n=0;n<this.animEvents.length;n++){var r=this.animEvents[n];if(r){if(r.name===e&&r.fnCallback===i)break;if(r.triggerTime===t&&r.fnCallback===i)break}}n<this.animEvents.length&&this.animEvents.splice(n,1)},AnimationSession.prototype.removeAllEvents=function(){this.animEvents=[]},AnimationSession.prototype.invokeByName=function(e){for(var t=0;t<this.animEvents.length;t++)this.animEvents[t]&&this.animEvents[t].name===e&&this.animEvents[t].invoke()},AnimationSession.prototype.invokeByTime=function(e){for(var t=0;t<this.animEvents.length;t++)if(this.animEvents[t]){if(this.animEvents[t].triggerTime>e)break;this.animEvents[t].triggered||this.animEvents[t].invoke()}},AnimationSession.prototype.blendToTarget=function(e,t){var i,n,r,s;if(!(!e||t>1||t<=0)){if(1===t)return void this.updateToTarget(e);if(this.playable instanceof AnimationCurve&&e instanceof AnimationKeyable){if(r=this.playable.name,s=this.animTargets[r],!s)return;for(n=0;n<s.length;n++)s[n].blendToTarget(e.value,t)}else if(this.playable instanceof AnimationClip&&e instanceof AnimationClipSnapshot){var a=Object.keys(e.curveKeyable);for(i=0;i<a.length;i++)if(r=a[i],r&&(s=this.animTargets[r]))for(n=0;n<s.length;n++)s[n].blendToTarget(e.curveKeyable[r].value,t)}}},AnimationSession.prototype.updateToTarget=function(e){var t,i,n,r;if(e)if(this.playable instanceof AnimationCurve&&e instanceof AnimationKeyable){if(n=this.playable.name,r=this.animTargets[n],!r)return;for(i=0;i<r.length;i++)r[i].updateToTarget(e.value)}else if(this.playable instanceof AnimationClip&&e instanceof AnimationClipSnapshot){var s=Object.keys(e.curveKeyable);for(t=0;t<s.length;t++)if(n=s[t],n&&(r=this.animTargets[n]))for(i=0;i<r.length;i++)r[i].updateToTarget(e.curveKeyable[n].value)}},AnimationSession.prototype.showAt=function(e,t,i,n,r){for(var s=this.playable.eval(e),a=Object.keys(this.blendables),o=0;o<a.length;o++){var h=a[o],l=this.blendWeights[h],c=this.blendables[h];if(c&&c instanceof AnimationClip&&"number"==typeof l){var d=c.eval(this.accTime%c.duration);s=AnimationClipSnapshot.linearBlend(s,d,l)}}for(var o=0;o<a.length;o++){var u=a[o],l=this.blendWeights[u],f=this.blendables[u];if(f&&s.curveKeyable[u]&&!(f instanceof AnimationClip)){var p=AnimationKeyable.linearBlend(s.curveKeyable[u],f,l);s.curveKeyable[u]=p}}if(0===t||r<i||r>n)this.updateToTarget(s);else{var l=(r-i)/(n-i);t===-1&&(l=1-l),this.blendToTarget(s,l)}},AnimationSession.prototype.play=function(e,t){if(e&&(this.playable=e),!(this.playable instanceof AnimationClip||this.playable instanceof AnimationCurve))return this;if(this.isPlaying)return this;this.begTime=0,this.endTime=e.duration,this.curTime=0,this.accTime=0,this.isPlaying=!0,this!==e.session&&(this.bySpeed=e.bySpeed,this.loop=e.loop),t||"function"!=typeof e.getAnimTargets?this.animTargets=t:this.animTargets=e.getAnimTargets();for(var i=0;i<this.animEvents.length;i++)this.animEvents[i].triggered=!1;for(var i=0;i<this.animEvents.length;i++)this.animEvents[i].triggered=!1;return AnimationSession.app&&AnimationSession.app.on("update",this.onTimer),this},AnimationSession.prototype.stop=function(){return AnimationSession.app&&AnimationSession.app.off("update",this.onTimer),this.curTime=0,this.isPlaying=!1,this.fadeBegTime=-1,this.fadeEndTime=-1,this.fadeTime=-1,this.fadeDir=0,this},AnimationSession.prototype.pause=function(){return AnimationSession.app&&AnimationSession.app.off("update",this.onTimer),this.isPlaying=!1,this},AnimationSession.prototype.resume=function(){this.isPlaying||(this.isPlaying=!0,AnimationSession.app&&AnimationSession.app.on("update",this.onTimer))},AnimationSession.prototype.fadeOut=function(e){this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=-1},AnimationSession.prototype.fadeIn=function(e,t){this.fadeBegTime=this.curTime,this.fadeTime=this.fadeBegTime,this.fadeEndTime=this.fadeBegTime+e,this.fadeDir=1,t&&(this.playable=t),this.play(t)},AnimationSession.prototype.fadeTo=function(e,t){this.fadeOut(t);var i=new AnimationSession;return i.fadeIn(t,e),i};var AnimationComponent=function(){this.name="",this.animClips={},this.curClip=""};AnimationComponent.prototype.clipCount=function(){var e=Object.keys(this.animClips);return e.length},AnimationComponent.prototype.getCurrentClip=function(){return this.animClips[this.curClip]},AnimationComponent.prototype.clipAt=function(e){var t=Object.keys(this.animClips);return t.length<=e?null:this.animClips[t[e]]},AnimationComponent.prototype.addClip=function(e){e&&e.name&&(this.animClips[e.name]=e)},AnimationComponent.prototype.removeClip=function(e){e&&this.animClips[e]&&delete this.animClips[e],this.curClip===e&&(this.curClip="")},AnimationComponent.prototype.playClip=function(e){this.animClips[e]&&(this.curClip=e,this.animClips[e].play())},AnimationComponent.prototype.stopClip=function(){this.animClips[this.curClip]&&(this.animClips[this.curClip].stop(),this.curClip="")},AnimationComponent.prototype.crossFadeToClip=function(e,t){this.animClips[this.curClip]&&this.animClips[e]?(this.animClips[this.curClip].fadeOut(t),this.animClips[e].fadeIn(t),this.curClip=e):this.animClips[this.curClip]?(this.animClips[this.curClip].fadeOut(t),this.curClip=""):this.animClips[e]&&(this.animClips[e].fadeIn(t),this.curClip=e)},AnimationComponent.prototype.setBlend=function(e,t,i){var n=this.getCurrentClip();n&&n.session&&n.session.setBlend(e,t,i)},AnimationComponent.prototype.unsetBlend=function(e){var t=this.getCurrentClip();t&&t.session&&t.session.unsetBlend(e)},function(){function e(){S||(S=pc.createScript("anim"),S.prototype.initialize=function(){this.animComponent&&0!==this.animComponent.clipCount()&&this.animComponent.getCurrentClip()&&this.animComponent.getCurrentClip().play()},S.prototype.update=function(e){!this.animComponent||0===this.animComponent.clipCount()||!this.animComponent.getCurrentClip()})}function t(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function i(e){return e&&0===(e&e-1)}function n(e){var t=pc.PRIMITIVE_TRIANGLES;if(e.hasOwnProperty("mode"))switch(e.mode){case 0:t=pc.PRIMITIVE_POINTS;break;case 1:t=pc.PRIMITIVE_LINES;break;case 2:t=pc.PRIMITIVE_LINELOOP;break;case 3:t=pc.PRIMITIVE_LINESTRIP;break;case 4:t=pc.PRIMITIVE_TRIANGLES;break;case 5:t=pc.PRIMITIVE_TRISTRIP;break;case 6:t=pc.PRIMITIVE_TRIFAN}return t}function r(e){var t=3;switch(e){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":t=4;break;case"MAT2":t=4;break;case"MAT3":t=9;break;case"MAT4":t=16}return t}function s(e){var t=pc.FILTER_LINEAR;switch(e){case 9728:t=pc.FILTER_NEAREST;break;case 9729:t=pc.FILTER_LINEAR;break;case 9984:t=pc.FILTER_NEAREST_MIPMAP_NEAREST;break;case 9985:t=pc.FILTER_LINEAR_MIPMAP_NEAREST;break;case 9986:t=pc.FILTER_NEAREST_MIPMAP_LINEAR;break;case 9987:t=pc.FILTER_LINEAR_MIPMAP_LINEAR}return t}function a(e){var t=pc.ADDRESS_REPEAT;switch(e){case 33071:t=pc.ADDRESS_CLAMP_TO_EDGE;break;case 33648:t=pc.ADDRESS_MIRRORED_REPEAT;break;case 10497:t=pc.ADDRESS_REPEAT}return t}function o(e){return/^data:.*,.*$/i.test(e)}function h(e,t,i){var n=e.bufferViews[t.bufferView],s=i[n.buffer],a=t.hasOwnProperty("byteOffset")?t.byteOffset:0,o=n.hasOwnProperty("byteOffset")?n.byteOffset:0,h=a+o,l=t.count*r(t.type),c=null;switch(t.componentType){case 5120:c=new Int8Array(s,h,l);break;case 5121:c=new Uint8Array(s,h,l);break;case 5122:c=new Int16Array(s,h,l);break;case 5123:c=new Uint16Array(s,h,l);break;case 5125:c=new Uint32Array(s,h,l);break;case 5126:c=new Float32Array(s,h,l)}return c}function l(e,t){var i=new AnimationClip;i.loop=!0,e.hasOwnProperty("name")&&(i.name=e.name);var n=t.gltf,r=null;return e.channels.forEach(function(s){var a,o,l,c,d,u,f=e.samplers[s.sampler],p=h(n,n.accessors[f.input],t.buffers),_=h(n,n.accessors[f.output],t.buffers),m=s.target,A=m.path,v=t.nodes[m.node],y=t.nodes[0];if(y.script||y.addComponent("script"),y.script.anim||(y.script.create("anim"),y.script.anim.animComponent=new AnimationComponent,AnimationSession.app=y.script.anim.app,y.script.anim.animComponent.curClip=i.name),r=y.script.anim.animComponent,"weights"===A){var g=_.length/p.length;for(d=0;d<g;d++){for(l=new AnimationCurve,c=AnimationKeyableType.NUM,l.keyableType=c,l.addTarget(v,A,d),"CUBIC"===f.interpolation?l.type=AnimationCurveType.CUBIC:"STEP"===f.interpolation&&(l.type=AnimationCurveType.STEP),u=0;u<p.length;u++)a=p[u],o=_[g*u+d],l.insertKey(c,a,o);i.addCurve(l)}}else{c=AnimationKeyableType.NUM;var b=A;switch(A){case"translation":c=AnimationKeyableType.VEC,b="localPosition";break;case"scale":c=AnimationKeyableType.VEC,b="localScale";break;case"rotation":c=AnimationKeyableType.QUAT,b="localRotation"}for(l=new AnimationCurve,l.keyableType=c,l.setTarget(v,b),"CUBIC"===f.interpolation?l.type=AnimationCurveType.CUBIC:"STEP"===f.interpolation&&(l.type=AnimationCurveType.STEP),d=0;d<p.length;d++)a=p[d],"translation"===A||"scale"===A?o=new pc.Vec3(_[3*d+0],_[3*d+1],_[3*d+2]):"rotation"===A&&(o=new pc.Quat(_[4*d+0],_[4*d+1],_[4*d+2],_[4*d+3])),l.insertKey(c,a,o);i.addCurve(l)}}),r&&r.addClip(i),i}function c(e){var i=e.width,n=e.height,r=t(i),s=t(n),a=document.createElement("canvas");a.width=r,a.height=s;var o=a.getContext("2d");return o.drawImage(e,0,0,i,n,0,0,r,s),a.toDataURL()}function d(e,t,n){var r=new Image;if(r.addEventListener("load",function(){var e=t.gltf,s=t.images.indexOf(r);e.textures.forEach(function(e,n){if(e.hasOwnProperty("source")&&e.source===s){var a=t.textures[n];if(i(r.width)&&i(r.width)||a.addressU!==pc.ADDRESS_REPEAT&&a.addressU!==pc.ADDRESS_MIRRORED_REPEAT&&a.addressV!==pc.ADDRESS_REPEAT&&a.addressV!==pc.ADDRESS_MIRRORED_REPEAT&&a.minFilter!==pc.FILTER_LINEAR_MIPMAP_LINEAR&&a.minFilter!==pc.FILTER_NEAREST_MIPMAP_LINEAR&&a.minFilter!==pc.FILTER_LINEAR_MIPMAP_NEAREST&&a.minFilter!==pc.FILTER_NEAREST_MIPMAP_NEAREST)a.setSource(r);else{var o=new Image;o.addEventListener("load",function(){a.setSource(o)}),o.src=c(r)}}}),t.imagesLoaded++,t.imagesLoaded===e.images.length&&n()},!1),e.hasOwnProperty("uri")&&(o(e.uri)?r.src=e.uri:t.processUri?t.processUri(e.uri,function(e){r.crossOrigin="anonymous",r.src=e}):(r.crossOrigin="anonymous",r.src=t.basePath+e.uri)),e.hasOwnProperty("bufferView")){var s=t.gltf,a=t.buffers,h=s.bufferViews[e.bufferView],l=a[h.buffer],d=h.hasOwnProperty("byteOffset")?h.byteOffset:0,u=l.slice(d,d+h.byteLength),f=new Blob([u],{type:e.mimeType});r.src=URL.createObjectURL(f)}return r}function u(e,t){var i=new pc.StandardMaterial;i.occludeSpecular=!0,i.diffuseTint=!0,i.diffuseVertexColor=!0,i.chunks.glossPS=w,e.hasOwnProperty("name")&&(i.name=e.name);var n;if(e.hasOwnProperty("pbrMetallicRoughness")){var r=e.pbrMetallicRoughness;if(r.hasOwnProperty("baseColorFactor")?(n=r.baseColorFactor,i.diffuse.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)),i.opacity=n[3]):(i.diffuse.set(1,1,1),i.opacity=1),r.hasOwnProperty("baseColorTexture")){var s=r.baseColorTexture,a=t.textures[s.index];i.diffuseMap=a,i.diffuseMapChannel="rgb",i.opacityMap=a,i.opacityMapChannel="a",s.hasOwnProperty("texCoord")&&(i.diffuseMapUv=s.texCoord,i.opacityMapUv=s.texCoord)}if(i.useMetalness=!0,r.hasOwnProperty("metallicFactor")?i.metalness=r.metallicFactor:i.metalness=1,r.hasOwnProperty("roughnessFactor")?i.shininess=100*r.roughnessFactor:i.shininess=100,r.hasOwnProperty("metallicRoughnessTexture")){var o=r.metallicRoughnessTexture;i.metalnessMap=t.textures[o.index],i.metalnessMapChannel="b",i.glossMap=t.textures[o.index],i.glossMapChannel="g",o.hasOwnProperty("texCoord")&&(i.glossMapUv=o.texCoord,i.metalnessMapUv=o.texCoord)}}if(e.hasOwnProperty("normalTexture")){var h=e.normalTexture;i.normalMap=t.textures[h.index],h.hasOwnProperty("texCoord")&&(i.normalMapUv=h.texCoord),h.hasOwnProperty("scale")&&(i.bumpiness=h.scale)}if(e.hasOwnProperty("occlusionTexture")){var l=e.occlusionTexture;i.aoMap=t.textures[l.index],i.aoMapChannel="r",l.hasOwnProperty("texCoord")&&(i.aoMapUv=l.texCoord)}if(e.hasOwnProperty("emissiveFactor")?(n=e.emissiveFactor,i.emissive.set(Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)),i.emissiveTint=!0):(i.emissive.set(0,0,0),i.emissiveTint=!1),e.hasOwnProperty("emissiveTexture")&&(i.emissiveMap=t.textures[e.emissiveTexture.index]),e.hasOwnProperty("alphaMode"))switch(e.alphaMode){case"MASK":i.blendType=pc.BLEND_NONE,e.hasOwnProperty("alphaCutoff")?i.alphaTest=e.alphaCutoff:i.alphaTest=.5;break;case"BLEND":i.blendType=pc.BLEND_NORMAL;break;default:case"OPAQUE":i.blendType=pc.BLEND_NONE}else i.blendType=pc.BLEND_NONE;return e.hasOwnProperty("doubleSided")?(i.twoSidedLighting=e.doubleSided,i.cull=e.doubleSided?pc.CULLFACE_NONE:pc.CULLFACE_BACK):(i.twoSidedLighting=!1,i.cull=pc.CULLFACE_BACK),i.update(),i}function f(e,t){var i=t.gltf,r=[];return e.primitives.forEach(function(e){var s,a=e.attributes,o=null,l=null,c=null,d=null,u=null,f=null,p=null,_=null,m=null;if(e.hasOwnProperty("extensions")){var A=e.extensions;if(A.hasOwnProperty("KHR_draco_mesh_compression")){var v=A.KHR_draco_mesh_compression,y=i.bufferViews[v.bufferView],g=t.buffers[y.buffer],b=y.hasOwnProperty("byteOffset")?y.byteOffset:0,E=new Int8Array(g,b,y.byteLength),T=t.decoderModule,S=new T.DecoderBuffer;S.Init(E,E.length);var w,C,M=new T.Decoder,P=M.GetEncodedGeometryType(S);switch(P){case T.INVALID_GEOMETRY_TYPE:console.error("Invalid geometry type");break;case T.POINT_CLOUD:w=new T.PointCloud,C=M.DecodeBufferToPointCloud(S,w);break;case T.TRIANGULAR_MESH:w=new T.Mesh,C=M.DecodeBufferToMesh(S,w)}if(!C.ok()||0==w.ptr){var I=C.error_msg();console.error(I)}var R=w.num_points(),x=w.num_faces();if(v.hasOwnProperty("attributes")){var O=function(e){var t=M.GetAttributeByUniqueId(w,e),i=new T.DracoFloat32Array;M.GetAttributeFloatForAllPoints(w,t,i);var n=R*t.num_components(),r=new Float32Array(n);for(s=0;s<n;s++)r[s]=i.GetValue(s);return T.destroy(i),r},k=v.attributes;k.hasOwnProperty("POSITION")&&(o=O(k.POSITION)),k.hasOwnProperty("NORMAL")&&(l=O(k.NORMAL)),k.hasOwnProperty("TANGENT")&&(c=O(k.TANGENT)),k.hasOwnProperty("TEXCOORD_0")&&(d=O(k.TEXCOORD_0)),k.hasOwnProperty("TEXCOORD_1")&&(u=O(k.TEXCOORD_1)),k.hasOwnProperty("COLOR_0")&&(f=O(k.COLOR_0)),k.hasOwnProperty("JOINTS_0")&&(p=O(k.JOINTS_0)),k.hasOwnProperty("WEIGHTS_0")&&(_=O(k.WEIGHTS_0))}if(P==T.TRIANGULAR_MESH){var D=new T.DracoInt32Array;for(m=new Uint16Array(3*x),s=0;s<x;++s)M.GetFaceFromMesh(w,s,D),m[3*s]=D.GetValue(0),m[3*s+1]=D.GetValue(1),m[3*s+2]=D.GetValue(2);T.destroy(D)}T.destroy(w),T.destroy(M),T.destroy(S)}}var L;a.hasOwnProperty("POSITION")&&null===o&&(L=i.accessors[e.attributes.POSITION],o=h(i,L,t.buffers)),a.hasOwnProperty("NORMAL")&&null===l&&(L=i.accessors[e.attributes.NORMAL],l=h(i,L,t.buffers)),a.hasOwnProperty("TANGENT")&&null===c&&(L=i.accessors[e.attributes.TANGENT],c=h(i,L,t.buffers)),a.hasOwnProperty("TEXCOORD_0")&&null===d&&(L=i.accessors[e.attributes.TEXCOORD_0],d=h(i,L,t.buffers)),a.hasOwnProperty("TEXCOORD_1")&&null===u&&(L=i.accessors[e.attributes.TEXCOORD_1],u=h(i,L,t.buffers)),a.hasOwnProperty("COLOR_0")&&null===f&&(L=i.accessors[e.attributes.COLOR_0],f=h(i,L,t.buffers)),a.hasOwnProperty("JOINTS_0")&&null===p&&(L=i.accessors[e.attributes.JOINTS_0],p=h(i,L,t.buffers)),a.hasOwnProperty("WEIGHTS_0")&&null===_&&(L=i.accessors[e.attributes.WEIGHTS_0],_=h(i,L,t.buffers)),e.hasOwnProperty("indices")&&null===m&&(L=i.accessors[e.indices],m=h(i,L,t.buffers));var N=o.length/3,F=function(){var e=new Uint16Array(N);for(s=0;s<N;s++)e[s]=s;return e};null!==o&&null===l&&(l=pc.calculateNormals(o,null===m?F():m)),null!==o&&null!==l&&null!==d&&null===c&&(c=pc.calculateTangents(o,l,d,null===m?F():m));var B=[];o&&B.push({semantic:pc.SEMANTIC_POSITION,components:3,type:pc.TYPE_FLOAT32}),l&&B.push({semantic:pc.SEMANTIC_NORMAL,components:3,type:pc.TYPE_FLOAT32}),c&&B.push({semantic:pc.SEMANTIC_TANGENT,components:4,type:pc.TYPE_FLOAT32}),d&&B.push({semantic:pc.SEMANTIC_TEXCOORD0,components:2,type:pc.TYPE_FLOAT32}),u&&B.push({semantic:pc.SEMANTIC_TEXCOORD1,components:2,type:pc.TYPE_FLOAT32}),f&&B.push({semantic:pc.SEMANTIC_COLOR,components:4,type:pc.TYPE_FLOAT32}),p&&B.push({semantic:pc.SEMANTIC_BLENDINDICES,components:4,type:pc.TYPE_UINT8}),_&&B.push({semantic:pc.SEMANTIC_BLENDWEIGHT,components:4,type:pc.TYPE_FLOAT32});var V,U,G,W,z,H=new pc.VertexFormat(t.device,B),j=new pc.VertexBuffer(t.device,H,N,pc.BUFFER_STATIC),Y=j.lock(),X=new Float32Array(Y),Z=new Uint8Array(Y),K=function(e){return H.elements.find(function(t){return t.name===e})};if(null!==o)for(G=K(pc.SEMANTIC_POSITION),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=3*s,X[V]=o[U],X[V+1]=o[U+1],X[V+2]=o[U+2];if(null!==l)for(G=K(pc.SEMANTIC_NORMAL),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=3*s,X[V]=l[U],X[V+1]=l[U+1],X[V+2]=l[U+2];if(null!==c)for(G=K(pc.SEMANTIC_TANGENT),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=4*s,X[V]=c[U],X[V+1]=c[U+1],X[V+2]=c[U+2],X[V+3]=c[U+3];if(null!==d)for(G=K(pc.SEMANTIC_TEXCOORD0),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=2*s,X[V]=d[U],X[V+1]=d[U+1];if(null!==u)for(G=K(pc.SEMANTIC_TEXCOORD1),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=2*s,X[V]=u[U],X[V+1]=u[U+1];if(null!==f)for(G=K(pc.SEMANTIC_COLOR),W=G.offset/4,z=G.stride/4,L=i.accessors[e.attributes.COLOR_0],s=0;s<N;s++)V=W+s*z,U="VEC4"===L.type?4*s:3*s,X[V]=f[U],X[V+1]=f[U+1],X[V+2]=f[U+2],X[V+3]="VEC4"===L.type?f[U+3]:1;if(null!==p)for(G=K(pc.SEMANTIC_BLENDINDICES),W=G.offset,z=G.stride,s=0;s<N;s++)V=W+s*z,U=4*s,Z[V]=p[U],Z[V+1]=p[U+1],Z[V+2]=p[U+2],Z[V+3]=p[U+3];if(null!==_)for(G=K(pc.SEMANTIC_BLENDWEIGHT),W=G.offset/4,z=G.stride/4,s=0;s<N;s++)V=W+s*z,U=4*s,X[V]=_[U],X[V+1]=_[U+1],X[V+2]=_[U+2],X[V+3]=_[U+3];j.unlock();var Q=new pc.Mesh;if(Q.vertexBuffer=j,Q.primitive[0].type=n(e),Q.primitive[0].base=0,Q.primitive[0].indexed=null!==m,null!==m){L=i.accessors[e.indices];var J;switch(L.componentType){case 5121:J=pc.INDEXFORMAT_UINT8;break;default:case 5123:J=pc.INDEXFORMAT_UINT16;break;case 5125:J=pc.INDEXFORMAT_UINT32}var q=m.length,$=new pc.IndexBuffer(t.device,J,q,pc.BUFFER_STATIC,m);Q.indexBuffer[0]=$,Q.primitive[0].count=m.length}else Q.primitive[0].count=N;Q.materialIndex=e.material,L=i.accessors[e.attributes.POSITION];var ee=L.min,te=L.max,ie=new pc.BoundingBox(new pc.Vec3((te[0]+ee[0])/2,(te[1]+ee[1])/2,(te[2]+ee[2])/2),new pc.Vec3((te[0]-ee[0])/2,(te[1]-ee[1])/2,(te[2]-ee[2])/2));if(Q.aabb=ie,e.hasOwnProperty("targets")){var ne=[];e.targets.forEach(function(e){var n={};e.hasOwnProperty("POSITION")&&(L=i.accessors[e.POSITION],n.deltaPositions=h(i,L,t.buffers)),e.hasOwnProperty("NORMAL")&&(L=i.accessors[e.NORMAL],n.deltaNormals=h(i,L,t.buffers)),e.hasOwnProperty("TANGENT")&&(L=i.accessors[e.TANGENT],n.deltaTangents=h(i,L,t.buffers)),ne.push(new pc.MorphTarget(n))}),Q.morph=new pc.Morph(ne)}r.push(Q)}),r}function p(e,t){var i=new pc.Entity;if(i.name=e.hasOwnProperty("name")?e.name:"",e.hasOwnProperty("matrix")&&(C.data.set(e.matrix),C.getTranslation(M),i.setLocalPosition(M),C.getEulerAngles(M),i.setLocalEulerAngles(M),C.getScale(M),i.setLocalScale(M)),e.hasOwnProperty("rotation")){var n=e.rotation;i.setLocalRotation(n[0],n[1],n[2],n[3])}if(e.hasOwnProperty("translation")){var r=e.translation;i.setLocalPosition(r[0],r[1],r[2])}if(e.hasOwnProperty("scale")){var s=e.scale;i.setLocalScale(s[0],s[1],s[2])}if(e.hasOwnProperty("camera")){var a=t.gltf,o=a.cameras[e.camera],h={};if("perspective"===o.type){if(h.type=pc.PROJECTION_PERSPECTIVE,o.hasOwnProperty("perspective")){var l=o.perspective;l.hasOwnProperty("aspectRatio")&&(h.aspectRatio=l.aspectRatio),h.fov=l.yfov,l.hasOwnProperty("zfar")&&(h.farClip=l.zfar),h.nearClip=l.znear}}else if("orthographic"===o.type&&(h.type=pc.PROJECTION_ORTHOGRAPHIC,o.hasOwnProperty("orthographic"))){var c=o.orthographic;h.aspectRatio=c.xmag/c.ymag,h.orthoHeight=.5*c.ymag,h.farClip=c.zfar,h.nearClip=c.znear}i.addComponent("camera",h),i.camera.enabled=!1}return i}function _(e,t){var i,n,r=t.gltf,s=e.joints,a=s.length,o=[];if(e.hasOwnProperty("inverseBindMatrices")){var l=e.inverseBindMatrices,c=h(r,r.accessors[l],t.buffers);for(i=0;i<a;i++)n=new pc.Mat4(c.slice(16*i,16*i+16)),o.push(n)}else for(i=0;i<a;i++)n=new pc.Mat4,o.push(n);var d=[];for(i=0;i<a;i++)d[i]=t.nodes[s[i]].name;var u=e.skeleton,f=new pc.Skin(t.device,o,d);for(f.skeleton=t.nodes[u],f.bones=[],i=0;i<s.length;i++)f.bones[i]=t.nodes[s[i]];return f}function m(e,t){var i=new pc.Texture(t.device,{flipY:!1});if(e.hasOwnProperty("name")&&(i.name=e.name),e.hasOwnProperty("sampler")){var n=t.gltf,r=n.samplers[e.sampler];r.hasOwnProperty("minFilter")&&(i.minFilter=s(r.minFilter)),r.hasOwnProperty("magFilter")&&(i.magFilter=s(r.magFilter)),r.hasOwnProperty("wrapS")&&(i.addressU=a(r.wrapS)),r.hasOwnProperty("wrapT")&&(i.addressV=a(r.wrapT))}return i}function A(e,t){if(e.buffers)return void t();var i=e.gltf;if(e.buffers=[],i.hasOwnProperty("buffers")){var n=0;i.buffers.forEach(function(r,s){if(r.hasOwnProperty("uri"))if(o(r.uri)){var a=atob(r.uri.split(",")[1]);e.buffers[s]=new ArrayBuffer(a.length);for(var h=new Uint8Array(e.buffers[s]),l=0;l<a.length;l++)h[l]=a.charCodeAt(l);i.buffers.length===++n&&t()}else if(e.processUri)e.processUri(r.uri,function(r){e.buffers[s]=r,i.buffers.length===++n&&t()});else{var c=new XMLHttpRequest;c.open("GET",e.basePath+r.uri,!0),c.responseType="arraybuffer",c.onload=function(r){e.buffers[s]=this.response,i.buffers.length===++n&&t()},c.send()}})}}function v(e,t,i,n){if(n){if(!i.gltf.hasOwnProperty(e))return void n();if(0===i.gltf[e].length)return void n()}i.gltf.hasOwnProperty(e)&&(i[e]=i.gltf[e].map(function(e){return t(e,i,n)}))}function y(e){var t=e.gltf;t.nodes.forEach(function(t,i){t.hasOwnProperty("children")&&t.children.forEach(function(t){var n=e.nodes[t];n.parent&&n.parent.removeChild(n);var r=e.nodes[i];r.addChild(n)})})}function g(e){e.gltf.nodes.forEach(function(t,i){if(t.hasOwnProperty("mesh")){var n=e.meshes[t.mesh];if(n.length>0){for(var r=new pc.Entity,s=[],a=[],o=[],h=0;h<n.length;h++){var l;l=void 0===n[h].materialIndex?e.defaultMaterial:e.materials[n[h].materialIndex];var c=new pc.MeshInstance(r,n[h],l);if(s.push(c),n[h].morph){var d=new pc.MorphInstance(n[h].morph);c.morphInstance=d,d.updateBounds(c.mesh),o.push(d)}if(t.hasOwnProperty("skin")){var u=e.skins[t.skin];n[h].skin=u;var f=new pc.SkinInstance(u);f.bones=u.bones,c.skinInstance=f,a.push(f)}}var p=new pc.Model;p.graph=r,p.meshInstances=s,p.morphInstances=o,p.skinInstances=a,r=e.nodes[i],r.addComponent("model"),r.model.model=p}}})}function b(e){var t=e.gltf,i=[];if(t.hasOwnProperty("scenes")){var n=0;t.hasOwnProperty("scene")&&(n=t.scene);for(var r=t.scenes[n].nodes,s=0;s<r.length;s++)i.push(e.nodes[r[s]])}else i.push(e.nodes[0]);return i}function E(t,i,n,r){e();var s=r?r.buffers:void 0,a=r?r.basePath:void 0,o=r?r.processUri:void 0,h={buffers:s,imagesLoaded:0,basePath:a,processUri:o,gltf:t,device:i,defaultMaterial:u({})};if(t.hasOwnProperty("extensionsUsed")){var c=t.extensionsUsed;c.indexOf("KHR_draco_mesh_compression")!==-1&&(h.decoderModule=DracoDecoderModule())}A(h,function(){v("textures",m,h),v("images",d,h,function(){if(v("materials",u,h),v("meshes",f,h),v("nodes",p,h),v("skins",_,h),v("animations",l,h),y(h),g(h),n(b(h)),t.hasOwnProperty("extensionsUsed")){var e=t.extensionsUsed;e.indexOf("KHR_draco_mesh_compression")!==-1&&(h.decoderModule=null)}})})}function T(e,t,i){var n=new DataView(e),r=n.getUint32(0,!0);if(1179937895!==r)return console.error("Invalid magic number found in glb header. Expected 0x46546C67, found 0x"+r.toString(16)),null;var s=(n.getUint32(4,!0),n.getUint32(8,!0)),a=n.getUint32(12,!0),o=n.getUint32(16,!0);if(1313821514!==o)return console.error("Invalid chunk type found in glb file. Expected 0x4E4F534A, found 0x"+o.toString(16)),null;for(var h=new Uint8Array(e,20,a),l=[],c=20+a;c<s;){if(a=n.getUint32(c,!0),o=n.getUint32(c+4,!0),5130562!==o)return console.error("Invalid chunk type found in glb file. Expected 0x004E4942, found 0x"+o.toString(16)),null;var d=e.slice(c+8,c+8+a);l.push(d),c+=a+8}var u=new TextDecoder("utf-8"),f=u.decode(h);f=JSON.parse(f),E(f,t,function(e){i(e)},{buffers:l})}var S,w=["#ifdef MAPFLOAT","uniform float material_shininess;","#endif","","#ifdef MAPTEXTURE","uniform sampler2D texture_glossMap;","#endif","","void getGlossiness() {","    dGlossiness = 1.0;","","#ifdef MAPFLOAT","    dGlossiness *= material_shininess;","#endif","","#ifdef MAPTEXTURE","    dGlossiness *= texture2D(texture_glossMap, $UV).$CH;","#endif","","#ifdef MAPVERTEX","    dGlossiness *= saturate(vVertexColor.$VC);","#endif","","    dGlossiness = 1.0 - dGlossiness;","","    dGlossiness += 0.0000001;","}"].join("\n"),C=new pc.Mat4,M=new pc.Vec3;window.loadGltf=E,window.loadGlb=T}(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Stats=t()}(this,function(){"use strict";var e=function(){
function t(e){return r.appendChild(e.dom),e}function i(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";n=e}var n=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;right:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),i(++n%r.children.length)},!1);var s=(performance||Date).now(),a=s,o=0,h=t(new e.Panel("FPS","#0f0")),l=t(new e.Panel("MS","#0ff"));if(self.performance&&self.performance.memory)var c=t(new e.Panel("MB","#f08"));return i(0),{REVISION:16,dom:r,addPanel:t,showPanel:i,begin:function(){s=(performance||Date).now()},end:function(){o++;var t=(performance||Date).now();if(l.update(t-s,200),t>a+1e3){var i=1e3*o/(t-a);if(i>=30?e.FpsForeground="#0f0":i>=24?e.FpsForeground="#ff0":e.FpsForeground="#f00",h.update(i,100),a=t,o=0,c){var n=performance.memory;c.update(n.usedJSHeapSize/1048576,n.jsHeapSizeLimit/1048576)}}return t},update:function(){s=this.end()},domElement:r,setMode:i}};return e.FpsForeground="#0f0",e.AllBackground="#222",e.Panel=function(t,i){var n=1/0,r=0,s=Math.round,a=s(window.devicePixelRatio||1),o=100*a,h=50*a,l=3*a,c=2*a,d=3*a,u=18*a,f=94*a,p=28*a,_=document.createElement("canvas");_.width=o,_.height=h,_.style.cssText="width:100px;height:50px";var m=_.getContext("2d");return m.font="bold "+12*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=e.AllBackground,m.fillRect(0,0,o,h),m.fillStyle="FPS"===t?e.FpsForeground:i,m.fillText(t,l,c),m.fillRect(d,u,f,p),m.fillStyle=e.AllBackground,m.globalAlpha=.9,m.fillRect(d,u,f,p),{dom:_,update:function(h,A){n=Math.min(n,h),r=Math.max(r,h),m.fillStyle=e.AllBackground,m.globalAlpha=1,m.fillRect(0,0,o,u),m.fillStyle="FPS"===t?e.FpsForeground:i,m.fillText(s(h)+" "+t+" ("+s(n)+"-"+s(r)+")",l,c),m.drawImage(_,d+a,u,f-a,p,d,u,f-a,p),m.fillRect(d+f-a,u,a,p),m.fillStyle=e.AllBackground,m.globalAlpha=.9,m.fillRect(d+f-a,u,a,s((1-h/A)*p))}}},e});var VirtualJoystick=function(e){e=e||{},this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._stickEl=e.stickElement||this._buildJoystickStick(),this._baseEl=e.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._useCssTransform=void 0!==e.useCssTransform&&e.useCssTransform,this._container.style.position="relative",this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,this._stationaryBase===!0&&(this._baseEl.style.display="",this._baseEl.style.left=this._baseX-this._baseEl.width/2+"px",this._baseEl.style.top=this._baseY-this._baseEl.height/2+"px"),this._transform=!!this._useCssTransform&&this._getTransformProperty(),this._has3d=this._check3D();var t=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=t(this._onTouchStart,this),this._$onTouchEnd=t(this._onTouchEnd,this),this._$onTouchMove=t(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=t(this._onMouseDown,this),this._$onMouseUp=t(this._onMouseUp,this),this._$onMouseMove=t(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};VirtualJoystick.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},VirtualJoystick.touchScreenAvailable=function(){return"createTouch"in document},function(e){e.addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},e.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)},e.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),i=0;i<t.length;i++){var n=t[i].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==n)return n}}}(VirtualJoystick.prototype),VirtualJoystick.prototype.deltaX=function(){return this._stickX-this._baseX},VirtualJoystick.prototype.deltaY=function(){return this._stickY-this._baseY},VirtualJoystick.prototype.up=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0)&&!(Math.abs(e)>2*Math.abs(t))},VirtualJoystick.prototype.down=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0)&&!(Math.abs(e)>2*Math.abs(t))},VirtualJoystick.prototype.right=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0)&&!(Math.abs(t)>2*Math.abs(e))},VirtualJoystick.prototype.left=function(){if(this._pressed===!1)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0)&&!(Math.abs(t)>2*Math.abs(e))},VirtualJoystick.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",0==this._stationaryBase&&(this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0)},VirtualJoystick.prototype._onDown=function(e,t){if(this._pressed=!0,0==this._stationaryBase&&(this._baseX=e,this._baseY=t,this._baseEl.style.display="",this._move(this._baseEl.style,this._baseX-this._baseEl.width/2,this._baseY-this._baseEl.height/2)),this._stickX=e,this._stickY=t,this._limitStickTravel===!0){var i=this.deltaX(),n=this.deltaY(),r=Math.sqrt(i*i+n*n);if(r>this._stickRadius){var s=i/r,a=n/r;this._stickX=s*this._stickRadius+this._baseX,this._stickY=a*this._stickRadius+this._baseY}}this._stickEl.style.display="",this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)},VirtualJoystick.prototype._onMove=function(e,t){if(this._pressed===!0){if(this._stickX=e,this._stickY=t,this._limitStickTravel===!0){var i=this.deltaX(),n=this.deltaY(),r=Math.sqrt(i*i+n*n);if(r>this._stickRadius){var s=i/r,a=n/r;this._stickX=s*this._stickRadius+this._baseX,this._stickY=a*this._stickRadius+this._baseY}}this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)}},VirtualJoystick.prototype._onMouseUp=function(e){return this._onUp()},VirtualJoystick.prototype._onMouseDown=function(e){e.preventDefault();var t=e.clientX,i=e.clientY;return this._onDown(t,i)},VirtualJoystick.prototype._onMouseMove=function(e){var t=e.clientX,i=e.clientY;return this._onMove(t,i)},VirtualJoystick.prototype._onTouchStart=function(e){if(null===this._touchIdx){var t=this.dispatchEvent("touchStartValidation",e);if(t!==!1){this.dispatchEvent("touchStart",e),e.preventDefault();var i=e.changedTouches[0];this._touchIdx=i.identifier;var n=i.pageX,r=i.pageY;return this._onDown(n,r)}}},VirtualJoystick.prototype._onTouchEnd=function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}},VirtualJoystick.prototype._onTouchMove=function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,i=0;i<t.length&&t[i].identifier!==this._touchIdx;i++);if(i!==t.length){var n=t[i];e.preventDefault();var r=n.pageX,s=n.pageY;return this._onMove(r,s)}}},VirtualJoystick.prototype._buildJoystickBase=function(){var e=document.createElement("canvas");e.width=126,e.height=126;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=2,t.arc(e.width/2,e.width/2,60,0,2*Math.PI,!0),t.stroke(),e},VirtualJoystick.prototype._buildJoystickStick=function(){var e=document.createElement("canvas");e.width=86,e.height=86;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,2*Math.PI,!0),t.stroke(),e},VirtualJoystick.prototype._move=function(e,t,i){this._transform?this._has3d?e[this._transform]="translate3d("+t+"px,"+i+"px, 0)":e[this._transform]="translate("+t+"px,"+i+"px)":(e.left=t+"px",e.top=i+"px")},VirtualJoystick.prototype._getTransformProperty=function(){for(var e,t=["webkitTransform","MozTransform","msTransform","OTransform","transform"],i=document.createElement("p"),n=0;n<t.length;n++)if(e=t[n],null!=i.style[e])return e},VirtualJoystick.prototype._check3D=function(){var e=this._getTransformProperty();if(!e||!window.getComputedStyle)return module.exports=!1;var t={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},i=document.createElement("div");i.style[e]="translate3d(1px,1px,1px)",document.body.insertBefore(i,null);var n=getComputedStyle(i).getPropertyValue(t[e]);document.body.removeChild(i);var r=null!=n&&n.length&&"none"!=n;return r};var CanvasScript=function(){function e(){}return e}(),createScript=function(e){return function(t){var i=new t;if(i&&i.constructor&&i.constructor.name){var n=i.constructor.name,r=pc.createScript(n,e),s=[];if(i.attributes)for(var a in i.attributes)s.push(a),r.attributes.add(a,i.attributes[a]);for(var o in i)"attributes"===o||"name"===o||s.includes(o)||(r.prototype[o]=i[o]);for(var o in t)r[o]=t[o]}else console.warn("Failed instantiate a PlayCanvas script class constructor.")}};